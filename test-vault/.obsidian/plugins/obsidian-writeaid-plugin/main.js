"use strict";var yr=Object.defineProperty;var kr=(r,e,t)=>e in r?yr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ve=(r,e,t)=>kr(r,typeof e!="symbol"?e+"":e,t);const A=require("obsidian"),Ne={ACTIVE_PROJECT_NOT_FOUND:"No active project found.",ACTIVE_DRAFT_NOT_FOUND:"No active draft found.",BACKUPS_NOT_FOUND_PROJECT:"No backups found for the current project.",BACKUPS_NOT_FOUND_DRAFT:"No backups found for the current draft."},Xt={DRAFTS:"drafts",MANUSCRIPTS:"manuscripts",BACKUPS:".writeaid-backups"},Tt={META:"meta.md",OUTLINE:"outline.md"},Ye={COMPACT:"compact",KEBAB:"kebab"},Ct={SINGLE:"single-file",MULTI:"multi-file"},xr=Object.values(Ct),ft="WriteAid",R=`${ft} debug:`,sn="pen-tool",st=".md",Kt=0,ve=5e3,be=250,_e=".zip",Ln=/_(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})\.zip$/,ht="---",Et=new RegExp(`^${ht}
([\\s\\S]*?)
${ht}`),qe=1024,Mn=["B","KB","MB","GB"];function mt(r){return(r==null?void 0:r.draftsFolderName)||Xt.DRAFTS}function on(r){return(r==null?void 0:r.manuscriptsFolderName)||Xt.MANUSCRIPTS}function ne(r){return(r==null?void 0:r.backupsFolderName)||Xt.BACKUPS}function jt(r){return(r==null?void 0:r.metaFileName)||Tt.META}function re(r){return(r==null?void 0:r.outlineFileName)||Tt.OUTLINE}function At(r,e=Ye.COMPACT){if(!r)return"";const t=r.trim();return e===Ye.KEBAB?t.replace(/\s+/g,"-").toLowerCase():t.replace(/\s+/g,"").toLowerCase()}async function ae(r,e){const t=await Promise.all(r.map(n=>Promise.resolve(e(n))));return r.filter((n,i)=>t[i])}function xt(r,...e){try{return r()}catch(t){if(e.length>0&&e.some(n=>t instanceof n)||e.length===0)return;throw t}}async function bt(r,...e){try{return await r()}catch(t){if(e.length>0&&e.some(n=>t instanceof n)||e.length===0)return;throw t}}function z(...r){xt(()=>{window.__WRITEAID_DEBUG__&&(console.debug||console.log).apply(console,r)})}function xe(r,e){return r?e?!0:(new A.Notice(Ne.ACTIVE_DRAFT_NOT_FOUND),!1):(new A.Notice(Ne.ACTIVE_PROJECT_NOT_FOUND),!1)}const Sr=Object.freeze(Object.defineProperty({__proto__:null,APP_NAME:ft,BACKUP_FILE_EXTENSION:_e,BACKUP_TIMESTAMP_REGEX:Ln,BYTES_PER_KILOBYTE:qe,DEBUG_PREFIX:R,FILES:Tt,FILE_SIZE_UNITS:Mn,FOLDERS:Xt,FRONTMATTER_DELIMITER:ht,FRONTMATTER_REGEX:Et,MARKDOWN_FILE_EXTENSION:st,PANEL_DEBOUNCE_DEFAULT:be,PANEL_DEBOUNCE_MAX:ve,PANEL_DEBOUNCE_MIN:Kt,PROJECT_TYPE:Ct,SLUG_STYLE:Ye,VALID_PROJECT_TYPES:xr,WRITE_AID_ICON_NAME:sn,asyncFilter:ae,checkActive:xe,debug:z,getBackupsFolderName:ne,getDraftsFolderName:mt,getManuscriptsFolderName:on,getMetaFileName:jt,getOutlineFileName:re,slugifyDraftName:At,suppress:xt,suppressAsync:bt},Symbol.toStringTag,{value:"Module"}));function Cr(r){return async()=>{const e=r.activeProject,t=r.activeDraft;if(z(`${R} Clear old backups command called`),z(`${R} Active project: ${e}, active draft: ${t}`),!xe(e,t))return;const n=mt(r.settings),i=`${e}/${n}/${t}`,s=r.projectFileService.backups.maxBackupAgeDays;await r.projectFileService.backups.clearOldBackups(i,r.settings),new A.Notice(`Old backups cleared (older than ${s} days).`)}}function Fr(r){return async()=>{const e=r.activeProject,t=r.activeDraft;if(z(`${R} Create backup command called`),z(`${R} Active project: ${e}, active draft: ${t}`),!xe(e,t))return;const n=mt(r.settings),i=`${e}/${n}/${t}`;await r.projectFileService.backups.createBackup(i,r.settings)?new A.Notice("Backup created successfully."):new A.Notice("Failed to create backup.")}}function Pr(r){return async()=>{const e=r.activeProject,t=r.activeDraft;if(z(`${R} Delete backup command called`),z(`${R} Active project: ${e}, active draft: ${t}`),!xe(e,t))return;const n=mt(r.settings),i=`${e}/${n}/${t}`,s=await r.projectFileService.backups.listBackups(i,r.settings);if(s.length===0){new A.Notice(Ne.BACKUPS_NOT_FOUND_DRAFT);return}const o=s[s.length-1];await r.projectFileService.backups.deleteBackup(i,o,r.settings)?new A.Notice(`Backup deleted successfully: ${o}.`):new A.Notice("Failed to delete backup.")}}class Un extends A.Modal{constructor(e,t,n=!1){super(e),this.path=t,this.isDraft=n,this.setTitle("Confirm Overwrite")}onOpen(){const{contentEl:e}=this,t=this.isDraft?"draft folder":"manuscript file";e.createEl("p",{text:`The ${t} "${this.path}" already exists. Do you want to overwrite it?`});const n=e.createDiv({cls:"modal-button-container"});new A.ButtonComponent(n).setButtonText("Cancel").onClick(()=>{this.resolve(!1),this.close()}),new A.ButtonComponent(n).setButtonText("Overwrite").setCta().onClick(()=>{this.resolve(!0),this.close()})}onClose(){const{contentEl:e}=this;e.empty()}open(){return new Promise(e=>{this.resolve=e,super.open()})}}class Er extends A.SuggestModal{constructor(e,t){super(e),this.manager=t,this.backups=[],this.draftFolder="",this.draftName="",this.setPlaceholder("Select a backup to restore..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to restore"},{command:"esc",purpose:"to cancel"}])}async onOpen(){const e=this.manager.activeProject;if(!e){new A.Notice("No active project found."),this.close();return}const t=mt(this.manager.settings);if(this.draftFolder=`${e}/${t}`,this.draftName=e,this.backups=await this.getBackupDetails(),this.backups.length===0){new A.Notice(Ne.BACKUPS_NOT_FOUND_PROJECT),this.close();return}this.setTitle(`Restore Backup for Project "${e}"`),super.onOpen()}async getBackupDetails(){const e=this.draftFolder.split("/")[0]||"unknown",t=`${ne(this.manager.settings)}/${e}`;try{const n=[],i=mt(this.manager.settings),s=`${t}/${i}`,o=await this.app.vault.adapter.list(s);for(const a of o.folders){const l=a.split("/").pop()||a,c=`${s}/${l}`,m=await this.app.vault.adapter.list(c),g=`${e}/${i}/${l}`;for(const b of m.files){const f=b.split("/").pop()||b,w=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),p=new RegExp(`^${w}_(\\d{4}-\\d{2}-\\d{2}T\\d{2}-\\d{2}-\\d{2})\\.zip$`),v=f.match(p);if(v){const d=await this.app.vault.adapter.stat(b),_=(d==null?void 0:d.size)||0,y=v[1],S=y.replace(/T(\d{2})-(\d{2})-(\d{2})/,"T$1:$2:$3"),$=new Date(S).toLocaleString(),P=this.formatFileSize(_);n.push({timestamp:y,size:_,displayText:`${l}: ${$} (${P})`,draftName:l,draftFolder:g})}}}return n.sort((a,l)=>l.timestamp.localeCompare(a.timestamp))}catch{return z(`${R} Backup directory does not exist yet for project '${t}' (this is normal for new projects)`),[]}}formatFileSize(e){if(e===0)return"0 B";const t=Math.floor(Math.log(e)/Math.log(qe));return parseFloat((e/Math.pow(qe,t)).toFixed(1))+" "+Mn[t]}getSuggestions(e){return this.backups.filter(t=>t.displayText.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.displayText})}async onChooseSuggestion(e,t){const n=this.app.vault.getAbstractFileByPath(e.draftFolder);if(n&&n instanceof A.TFolder&&!await new Un(this.app,e.draftFolder,!0).open())return;await this.manager.projectFileService.backups.restoreBackup(e.draftFolder,e.timestamp,this.manager.settings)?new A.Notice(`Backup restored successfully for "${e.draftName}" from ${e.displayText.split(": ")[1].split(" (")[0]}.`):new A.Notice("Failed to restore backup.")}}function Ar(r){return async()=>{z(`${R} List backups command called`),new Er(r.app,r).open()}}function $r(r){return()=>r.createNewDraftPrompt()}async function Dr(r){z(`${R} createOutlineCommand called`);try{const e=r.activeProject,t=r.activeDraft;if(!e||!t){new A.Notice("No active project or draft selected. Please select a project and draft first.");return}const n=r.projectFileService.drafts.getOutlineFile(e,t);if(n){new A.Notice(`Outline file already exists: ${n.path}`);return}await r.projectFileService.drafts.createOutline(e,t,r.settings.outlineTemplate),new A.Notice(`Outline created for draft: ${t}`),z(`${R} Outline created successfully for draft: ${t}`)}catch(e){z(`${R} Error creating outline:`,e),new A.Notice(`Failed to create outline: ${e.message}`)}}function Tr(r){return async()=>{var s;const e=r.projectFileService.drafts,t=r.activeProject,n=r.activeDraft;if(z(`${R} Generate manuscript command called`),z(`${R} Active project: ${t}, active draft: ${n}`),z(`${R} Manager settings manuscript template: ${(s=r.settings)==null?void 0:s.manuscriptNameTemplate}`),!xe(t,n))return;await e.generateManuscript(t,n,r.settings)?new A.Notice("Manuscript generated successfully."):new A.Notice("Failed to generate manuscript.")}}function jr(r){return()=>r.switchDraftPrompt()}function Nr(r){return async()=>{const e=r.app.workspace.getActiveFile();if(!e){new A.Notice("No file is currently open.");return}const t=e.path,n=mt(r.settings),i=t.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${st}$`));if(!i){new A.Notice("The current file is not a chapter.");return}const s=i[1],o=i[2],a=i[3];try{const l=await r.projectFileService.chapters.listChapters(s,o),c=l.findIndex(g=>g.name===a);if(c===-1){new A.Notice("Unable to find the current chapter in the draft.");return}if(c>=l.length-1)return;const m=l[c+1];await r.openChapter(s,o,m.name)}catch(l){z(`${R} Failed to navigate to next chapter:`,l),new A.Notice("Failed to navigate to next chapter.")}}}function Or(r){return async()=>{const e=r.app.workspace.getActiveFile();if(!e){new A.Notice("No file is currently open.");return}const t=e.path,n=mt(r.settings),i=t.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${st}$`));if(!i){new A.Notice("The current file is not a chapter.");return}const s=i[1],o=i[2],a=i[3];try{const l=await r.projectFileService.chapters.listChapters(s,o),c=l.findIndex(g=>g.name===a);if(c===-1){new A.Notice("Unable to find the current chapter in the draft.");return}if(c<=0)return;const m=l[c-1];await r.openChapter(s,o,m.name)}catch(l){z(`${R} Failed to navigate to previous chapter:`,l),new A.Notice("Failed to navigate to previous chapter.")}}}async function Qt(r,e){const t=r.vault.getAbstractFileByPath(e);if(!t||!(t instanceof A.TFile))return null;try{const n=await r.vault.read(t);return Br(n)}catch(n){return z(`${R} Error reading meta file:`,n),null}}async function ln(r,e,t){const n=Rr(t),i=r.vault.getAbstractFileByPath(e);i&&i instanceof A.TFile?await r.vault.modify(i,n):await r.vault.create(e,n)}async function ie(r,e,t,n,i){const s=`${e}/${jt(i)}`;let o=await Qt(r,s);o||(o={total_drafts:0});const a=mt(i),l=r.vault.getAbstractFileByPath(`${e}/${a}`);if(l&&l instanceof A.TFolder){const c=l.children.filter(m=>m instanceof A.TFolder);o.total_drafts=c.length}t!==void 0&&(o.current_active_draft=t,o.active_draft_last_modified=new Date().toISOString()),n&&Object.assign(o,n),o.total_drafts>0&&o.total_word_count&&(o.average_draft_word_count=Math.round(o.total_word_count/o.total_drafts)),await ln(r,s,o)}function Br(r){const e=r.match(new RegExp(`${ht}\\s*\\n([\\s\\S]*?)\\n${ht}`));if(!e)return null;const t=e[1],n={},i=t.split(`
`);for(const s of i){const o=s.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(o){const a=o[1];let l=o[2].trim();/^-?\d+(\.\d+)?$/.test(l)?l=Number(l):(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),n[a]=l}}return n}function Rr(r){const e=[ht];if(r.current_active_draft!==void 0&&e.push(`current_active_draft: "${r.current_active_draft}"`),e.push(`total_drafts: ${r.total_drafts}`),r.target_word_count!==void 0&&e.push(`target_word_count: ${r.target_word_count}`),r.active_draft_last_modified!==void 0&&e.push(`active_draft_last_modified: "${r.active_draft_last_modified}"`),r.total_word_count!==void 0&&e.push(`total_word_count: ${r.total_word_count}`),r.average_draft_word_count!==void 0&&e.push(`average_draft_word_count: ${r.average_draft_word_count}`),r.project_type!==void 0&&e.push(`project_type: ${r.project_type}`),e.push(ht),e.push(""),e.push("# Project Statistics"),e.push(""),r.current_active_draft&&e.push(`**Active Draft:** ${r.current_active_draft}`),e.push(`**Total Drafts:** ${r.total_drafts}`),r.target_word_count&&e.push(`**Target Word Count:** ${r.target_word_count.toLocaleString()}`),r.active_draft_last_modified){const t=new Date(r.active_draft_last_modified);e.push(`**Last Modified:** ${t.toLocaleString()}`)}return r.total_word_count&&e.push(`**Total Word Count:** ${r.total_word_count.toLocaleString()}`),r.average_draft_word_count&&e.push(`**Average Draft Word Count:** ${r.average_draft_word_count.toLocaleString()}`),e.push(""),e.join(`
`)}const Xe=Object.freeze(Object.defineProperty({__proto__:null,readMetaFile:Qt,updateMetaStats:ie,writeMetaFile:ln},Symbol.toStringTag,{value:"Module"}));async function zr(r,e,t){const n=`${e}/${jt(t)}`,i=await Qt(r,n);if(!i||i.project_type!==Ct.SINGLE)return new A.Notice(`Project is not a ${Ct.SINGLE} project.`),!1;i.project_type=Ct.MULTI,await ln(r,n,i);const s=mt(t),o=r.vault.getAbstractFileByPath(`${e}/${s}`);if(!o||!(o instanceof A.TFolder))return new A.Notice("Drafts folder not found."),!1;let a=!1;for(const l of o.children)if(l instanceof A.TFolder){const c=At(l.name),m=l.children.find(g=>g instanceof A.TFile&&g.name===`${c}${st}`);if(m){const g=`${l.path}/Chapter 1${st}`;if(m.path!==g){const b=await r.vault.read(m);await r.vault.create(g,b),await r.vault.delete(m),a=!0}}}return a?new A.Notice(`Converted to multi-file project. Draft files renamed to "Chapter 1${st}".`):new A.Notice("Converted to multi-file project. No draft files needed renaming."),!0}async function Ir(r,e,t){if(!e){new A.Notice("No active project selected.");return}await zr(r,e,t)}function Lr(r){return()=>r.createNewProjectPrompt()}function Mr(r){return()=>r.selectActiveProjectPrompt()}function Ur(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function $e(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Wn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(r,e){(function(t){r.exports=t()})(function(){return function t(n,i,s){function o(c,m){if(!i[c]){if(!n[c]){var g=typeof $e=="function"&&$e;if(!m&&g)return g(c,!0);if(a)return a(c,!0);var b=new Error("Cannot find module '"+c+"'");throw b.code="MODULE_NOT_FOUND",b}var f=i[c]={exports:{}};n[c][0].call(f.exports,function(w){var p=n[c][1][w];return o(p||w)},f,f.exports,t,n,i,s)}return i[c].exports}for(var a=typeof $e=="function"&&$e,l=0;l<s.length;l++)o(s[l]);return o}({1:[function(t,n,i){var s=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,m,g,b,f,w,p,v=[],d=0,_=l.length,y=_,S=s.getTypeOf(l)!=="string";d<l.length;)y=_-d,g=S?(c=l[d++],m=d<_?l[d++]:0,d<_?l[d++]:0):(c=l.charCodeAt(d++),m=d<_?l.charCodeAt(d++):0,d<_?l.charCodeAt(d++):0),b=c>>2,f=(3&c)<<4|m>>4,w=1<y?(15&m)<<2|g>>6:64,p=2<y?63&g:64,v.push(a.charAt(b)+a.charAt(f)+a.charAt(w)+a.charAt(p));return v.join("")},i.decode=function(l){var c,m,g,b,f,w,p=0,v=0,d="data:";if(l.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var _,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&y--,l.charAt(l.length-2)===a.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=o.uint8array?new Uint8Array(0|y):new Array(0|y);p<l.length;)c=a.indexOf(l.charAt(p++))<<2|(b=a.indexOf(l.charAt(p++)))>>4,m=(15&b)<<4|(f=a.indexOf(l.charAt(p++)))>>2,g=(3&f)<<6|(w=a.indexOf(l.charAt(p++))),_[v++]=c,f!==64&&(_[v++]=m),w!==64&&(_[v++]=g);return _}},{"./support":30,"./utils":32}],2:[function(t,n,i){var s=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(m,g,b,f,w){this.compressedSize=m,this.uncompressedSize=g,this.crc32=b,this.compression=f,this.compressedContent=w}c.prototype={getContentWorker:function(){var m=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),g=this;return m.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),m},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(m,g,b){return m.pipe(new a).pipe(new l("uncompressedSize")).pipe(g.compressWorker(b)).pipe(new l("compressedSize")).withStreamInfo("compression",g)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,n,i){var s=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,n,i){var s=t("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var m=0;m<8;m++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();n.exports=function(a,l){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(c,m,g,b){var f=o,w=b+g;c^=-1;for(var p=b;p<w;p++)c=c>>>8^f[255&(c^m[p])];return-1^c}(0|l,a,a.length,0):function(c,m,g,b){var f=o,w=b+g;c^=-1;for(var p=b;p<w;p++)c=c>>>8^f[255&(c^m.charCodeAt(p))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,n,i){var s=null;s=typeof Promise<"u"?Promise:t("lie"),n.exports={Promise:s}},{lie:37}],7:[function(t,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),c=s?"uint8array":"array";function m(g,b){l.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=b,this.meta={}}i.magic="\b\0",a.inherits(m,l),m.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,g.data),!1)},m.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},m.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},m.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(b){g.push({data:b,meta:g.meta})}},i.compressWorker=function(g){return new m("Deflate",g)},i.uncompressWorker=function(){return new m("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,n,i){function s(f,w){var p,v="";for(p=0;p<w;p++)v+=String.fromCharCode(255&f),f>>>=8;return v}function o(f,w,p,v,d,_){var y,S,F=f.file,$=f.compression,P=_!==c.utf8encode,I=a.transformTo("string",_(F.name)),D=a.transformTo("string",c.utf8encode(F.name)),V=F.comment,J=a.transformTo("string",_(V)),C=a.transformTo("string",c.utf8encode(V)),B=D.length!==F.name.length,h=C.length!==V.length,L="",tt="",Z="",et=F.dir,H=F.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};w&&!p||(rt.crc32=f.crc32,rt.compressedSize=f.compressedSize,rt.uncompressedSize=f.uncompressedSize);var N=0;w&&(N|=8),P||!B&&!h||(N|=2048);var j=0,M=0;et&&(j|=16),d==="UNIX"?(M=798,j|=function(q,ut){var wt=q;return q||(wt=ut?16893:33204),(65535&wt)<<16}(F.unixPermissions,et)):(M=20,j|=function(q){return 63&(q||0)}(F.dosPermissions)),y=H.getUTCHours(),y<<=6,y|=H.getUTCMinutes(),y<<=5,y|=H.getUTCSeconds()/2,S=H.getUTCFullYear()-1980,S<<=4,S|=H.getUTCMonth()+1,S<<=5,S|=H.getUTCDate(),B&&(tt=s(1,1)+s(m(I),4)+D,L+="up"+s(tt.length,2)+tt),h&&(Z=s(1,1)+s(m(J),4)+C,L+="uc"+s(Z.length,2)+Z);var X="";return X+=`
\0`,X+=s(N,2),X+=$.magic,X+=s(y,2),X+=s(S,2),X+=s(rt.crc32,4),X+=s(rt.compressedSize,4),X+=s(rt.uncompressedSize,4),X+=s(I.length,2),X+=s(L.length,2),{fileRecord:g.LOCAL_FILE_HEADER+X+I+L,dirRecord:g.CENTRAL_FILE_HEADER+s(M,2)+X+s(J.length,2)+"\0\0\0\0"+s(j,4)+s(v,4)+I+L+J}}var a=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),m=t("../crc32"),g=t("../signature");function b(f,w,p,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=p,this.encodeFileName=v,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(b,l),b.prototype.push=function(f){var w=f.meta.percent||0,p=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(w+100*(p-v-1))/p:100}}))},b.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var w=this.streamFiles&&!f.file.dir;if(w){var p=o(f,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(f){this.accumulate=!1;var w=this.streamFiles&&!f.file.dir,p=o(f,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),w)this.push({data:function(v){return g.DATA_DESCRIPTOR+s(v.crc32,4)+s(v.compressedSize,4)+s(v.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var f=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var p=this.bytesWritten-f,v=function(d,_,y,S,F){var $=a.transformTo("string",F(S));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(d,2)+s(d,2)+s(_,4)+s(y,4)+s($.length,2)+$}(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(f){this._sources.push(f);var w=this;return f.on("data",function(p){w.processChunk(p)}),f.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),f.on("error",function(p){w.error(p)}),this},b.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(f){var w=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var p=0;p<w.length;p++)try{w[p].error(f)}catch{}return!0},b.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,w=0;w<f.length;w++)f[w].lock()},n.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,n,i){var s=t("../compressions"),o=t("./ZipFileWorker");i.generateWorker=function(a,l,c){var m=new o(l.streamFiles,c,l.platform,l.encodeFileName),g=0;try{a.forEach(function(b,f){g++;var w=function(_,y){var S=_||y,F=s[S];if(!F)throw new Error(S+" is not a valid compression method !");return F}(f.options.compression,l.compression),p=f.options.compressionOptions||l.compressionOptions||{},v=f.dir,d=f.date;f._compressWorker(w,p).withStreamInfo("file",{name:b,dir:v,date:d,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(m)}),m.entriesCount=g}catch(b){m.error(b)}return m}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=t("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,n,i){var s=t("./utils"),o=t("./external"),a=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),m=t("./nodejsUtils");function g(b){return new o.Promise(function(f,w){var p=b.decompressed.getContentWorker().pipe(new c);p.on("error",function(v){w(v)}).on("end",function(){p.streamInfo.crc32!==b.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(b,f){var w=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),m.isNode&&m.isStream(b)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",b,!0,f.optimizedBinaryString,f.base64).then(function(p){var v=new l(f);return v.load(p),v}).then(function(p){var v=[o.Promise.resolve(p)],d=p.files;if(f.checkCRC32)for(var _=0;_<d.length;_++)v.push(g(d[_]));return o.Promise.all(v)}).then(function(p){for(var v=p.shift(),d=v.files,_=0;_<d.length;_++){var y=d[_],S=y.fileNameStr,F=s.resolve(y.fileNameStr);w.file(F,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:f.createFolders}),y.dir||(w.file(F).unsafeOriginalName=S)}return v.zipComment.length&&(w.comment=v.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,n,i){var s=t("../utils"),o=t("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}s.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(m){c.push({data:m,meta:{percent:0}})}).on("error",function(m){c.isPaused?this.generatedError=m:c.error(m)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,n,i){var s=t("readable-stream").Readable;function o(a,l,c){s.call(this,l),this._helper=a;var m=this;a.on("data",function(g,b){m.push(g)||m._helper.pause(),c&&c(b)}).on("error",function(g){m.emit("error",g)}).on("end",function(){m.push(null)})}t("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,n,i){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(t,n,i){function s(F,$,P){var I,D=a.getTypeOf($),V=a.extend(P||{},m);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(F=d(F)),V.createFolders&&(I=v(F))&&_.call(this,I,!0);var J=D==="string"&&V.binary===!1&&V.base64===!1;P&&P.binary!==void 0||(V.binary=!J),($ instanceof g&&$.uncompressedSize===0||V.dir||!$||$.length===0)&&(V.base64=!1,V.binary=!0,$="",V.compression="STORE",D="string");var C=null;C=$ instanceof g||$ instanceof l?$:w.isNode&&w.isStream($)?new p(F,$):a.prepareContent(F,$,V.binary,V.optimizedBinaryString,V.base64);var B=new b(F,C,V);this.files[F]=B}var o=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),m=t("./defaults"),g=t("./compressedObject"),b=t("./zipObject"),f=t("./generate"),w=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),v=function(F){F.slice(-1)==="/"&&(F=F.substring(0,F.length-1));var $=F.lastIndexOf("/");return 0<$?F.substring(0,$):""},d=function(F){return F.slice(-1)!=="/"&&(F+="/"),F},_=function(F,$){return $=$!==void 0?$:m.createFolders,F=d(F),this.files[F]||s.call(this,F,null,{dir:!0,createFolders:$}),this.files[F]};function y(F){return Object.prototype.toString.call(F)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(F){var $,P,I;for($ in this.files)I=this.files[$],(P=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&F(P,I)},filter:function(F){var $=[];return this.forEach(function(P,I){F(P,I)&&$.push(I)}),$},file:function(F,$,P){if(arguments.length!==1)return F=this.root+F,s.call(this,F,$,P),this;if(y(F)){var I=F;return this.filter(function(V,J){return!J.dir&&I.test(V)})}var D=this.files[this.root+F];return D&&!D.dir?D:null},folder:function(F){if(!F)return this;if(y(F))return this.filter(function(D,V){return V.dir&&F.test(D)});var $=this.root+F,P=_.call(this,$),I=this.clone();return I.root=P.name,I},remove:function(F){F=this.root+F;var $=this.files[F];if($||(F.slice(-1)!=="/"&&(F+="/"),$=this.files[F]),$&&!$.dir)delete this.files[F];else for(var P=this.filter(function(D,V){return V.name.slice(0,F.length)===F}),I=0;I<P.length;I++)delete this.files[P[I].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(F){var $,P={};try{if((P=a.extend(F||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");a.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var I=P.comment||this.comment||"";$=f.generateWorker(this,P,I)}catch(D){($=new l("error")).error(D)}return new c($,P.type||"string",P.mimeType)},generateAsync:function(F,$){return this.generateInternalStream(F).accumulate($)},generateNodeStream:function(F,$){return(F=F||{}).type||(F.type="nodebuffer"),this.generateInternalStream(F).toNodejsStream($)}};n.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,n,i){n.exports=t("stream")},{stream:void 0}],17:[function(t,n,i){var s=t("./DataReader");function o(a){s.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}t("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),m=a.charCodeAt(2),g=a.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===l&&this.data[b+1]===c&&this.data[b+2]===m&&this.data[b+3]===g)return b-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),m=a.charCodeAt(2),g=a.charCodeAt(3),b=this.readData(4);return l===b[0]&&c===b[1]&&m===b[2]&&g===b[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,n,i){var s=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(t,n,i){var s=t("./Uint8ArrayReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,n,i){var s=t("./DataReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,n,i){var s=t("./ArrayReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,n,i){var s=t("../utils"),o=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),m=t("./Uint8ArrayReader");n.exports=function(g){var b=s.getTypeOf(g);return s.checkSupport(b),b!=="string"||o.uint8array?b==="nodebuffer"?new c(g):o.uint8array?new m(s.transformTo("uint8array",g)):new a(s.transformTo("array",g)):new l(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,n,i){var s=t("./GenericWorker"),o=t("../utils");function a(l){s.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,s),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,n,i){var s=t("./GenericWorker"),o=t("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,s),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,n,i){var s=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}s.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,n,i){var s=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(m){c.dataIsReady=!0,c.data=m,c.max=m&&m.length||0,c.type=s.getTypeOf(m),c.isPaused||c._tickAndRepeat()},function(m){c.error(m)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(t,n,i){var s=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),c=t("../support"),m=t("../external"),g=null;if(c.nodestream)try{g=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(w,p){return new m.Promise(function(v,d){var _=[],y=w._internalType,S=w._outputType,F=w._mimeType;w.on("data",function($,P){_.push($),p&&p(P)}).on("error",function($){_=[],d($)}).on("end",function(){try{var $=function(P,I,D){switch(P){case"blob":return s.newBlob(s.transformTo("arraybuffer",I),D);case"base64":return l.encode(I);default:return s.transformTo(P,I)}}(S,function(P,I){var D,V=0,J=null,C=0;for(D=0;D<I.length;D++)C+=I[D].length;switch(P){case"string":return I.join("");case"array":return Array.prototype.concat.apply([],I);case"uint8array":for(J=new Uint8Array(C),D=0;D<I.length;D++)J.set(I[D],V),V+=I[D].length;return J;case"nodebuffer":return Buffer.concat(I);default:throw new Error("concat : unsupported type '"+P+"'")}}(y,_),F);v($)}catch(P){d(P)}_=[]}).resume()})}function f(w,p,v){var d=p;switch(p){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=p,this._mimeType=v,s.checkSupport(d),this._worker=w.pipe(new o(d)),w.lock()}catch(_){this._worker=new a("error"),this._worker.error(_)}}f.prototype={accumulate:function(w){return b(this,w)},on:function(w,p){var v=this;return w==="data"?this._worker.on(w,function(d){p.call(v,d.data,d.meta)}):this._worker.on(w,function(){s.delay(p,arguments,v)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},w)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,n,i){for(var s=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),m=0;m<256;m++)c[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;c[254]=c[254]=1;function g(){l.call(this,"utf-8 decode"),this.leftOver=null}function b(){l.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(w){var p,v,d,_,y,S=w.length,F=0;for(_=0;_<S;_++)(64512&(v=w.charCodeAt(_)))==55296&&_+1<S&&(64512&(d=w.charCodeAt(_+1)))==56320&&(v=65536+(v-55296<<10)+(d-56320),_++),F+=v<128?1:v<2048?2:v<65536?3:4;for(p=o.uint8array?new Uint8Array(F):new Array(F),_=y=0;y<F;_++)(64512&(v=w.charCodeAt(_)))==55296&&_+1<S&&(64512&(d=w.charCodeAt(_+1)))==56320&&(v=65536+(v-55296<<10)+(d-56320),_++),v<128?p[y++]=v:(v<2048?p[y++]=192|v>>>6:(v<65536?p[y++]=224|v>>>12:(p[y++]=240|v>>>18,p[y++]=128|v>>>12&63),p[y++]=128|v>>>6&63),p[y++]=128|63&v);return p}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(w){var p,v,d,_,y=w.length,S=new Array(2*y);for(p=v=0;p<y;)if((d=w[p++])<128)S[v++]=d;else if(4<(_=c[d]))S[v++]=65533,p+=_-1;else{for(d&=_===2?31:_===3?15:7;1<_&&p<y;)d=d<<6|63&w[p++],_--;1<_?S[v++]=65533:d<65536?S[v++]=d:(d-=65536,S[v++]=55296|d>>10&1023,S[v++]=56320|1023&d)}return S.length!==v&&(S.subarray?S=S.subarray(0,v):S.length=v),s.applyFromCharCode(S)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(g,l),g.prototype.processChunk=function(f){var w=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=w;(w=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),w.set(p,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var v=function(_,y){var S;for((y=y||_.length)>_.length&&(y=_.length),S=y-1;0<=S&&(192&_[S])==128;)S--;return S<0||S===0?y:S+c[_[S]]>y?S:y}(w),d=w;v!==w.length&&(o.uint8array?(d=w.subarray(0,v),this.leftOver=w.subarray(v,w.length)):(d=w.slice(0,v),this.leftOver=w.slice(v,w.length))),this.push({data:i.utf8decode(d),meta:f.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,s.inherits(b,l),b.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,n,i){var s=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function c(p){return p}function m(p,v){for(var d=0;d<p.length;++d)v[d]=255&p.charCodeAt(d);return v}t("setimmediate"),i.newBlob=function(p,v){i.checkSupport("blob");try{return new Blob([p],{type:v})}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return d.append(p),d.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(p,v,d){var _=[],y=0,S=p.length;if(S<=d)return String.fromCharCode.apply(null,p);for(;y<S;)v==="array"||v==="nodebuffer"?_.push(String.fromCharCode.apply(null,p.slice(y,Math.min(y+d,S)))):_.push(String.fromCharCode.apply(null,p.subarray(y,Math.min(y+d,S)))),y+=d;return _.join("")},stringifyByChar:function(p){for(var v="",d=0;d<p.length;d++)v+=String.fromCharCode(p[d]);return v},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function b(p){var v=65536,d=i.getTypeOf(p),_=!0;if(d==="uint8array"?_=g.applyCanBeUsed.uint8array:d==="nodebuffer"&&(_=g.applyCanBeUsed.nodebuffer),_)for(;1<v;)try{return g.stringifyByChunk(p,d,v)}catch{v=Math.floor(v/2)}return g.stringifyByChar(p)}function f(p,v){for(var d=0;d<p.length;d++)v[d]=p[d];return v}i.applyFromCharCode=b;var w={};w.string={string:c,array:function(p){return m(p,new Array(p.length))},arraybuffer:function(p){return w.string.uint8array(p).buffer},uint8array:function(p){return m(p,new Uint8Array(p.length))},nodebuffer:function(p){return m(p,a.allocBuffer(p.length))}},w.array={string:b,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},w.arraybuffer={string:function(p){return b(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},w.uint8array={string:b,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return a.newBufferFrom(p)}},w.nodebuffer={string:b,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return w.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:c},i.transformTo=function(p,v){if(v=v||"",!p)return v;i.checkSupport(p);var d=i.getTypeOf(v);return w[d][p](v)},i.resolve=function(p){for(var v=p.split("/"),d=[],_=0;_<v.length;_++){var y=v[_];y==="."||y===""&&_!==0&&_!==v.length-1||(y===".."?d.pop():d.push(y))}return d.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var v,d,_="";for(d=0;d<(p||"").length;d++)_+="\\x"+((v=p.charCodeAt(d))<16?"0":"")+v.toString(16).toUpperCase();return _},i.delay=function(p,v,d){setImmediate(function(){p.apply(d||null,v||[])})},i.inherits=function(p,v){function d(){}d.prototype=v.prototype,p.prototype=new d},i.extend=function(){var p,v,d={};for(p=0;p<arguments.length;p++)for(v in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],v)&&d[v]===void 0&&(d[v]=arguments[p][v]);return d},i.prepareContent=function(p,v,d,_,y){return l.Promise.resolve(v).then(function(S){return s.blob&&(S instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(S))!==-1)&&typeof FileReader<"u"?new l.Promise(function(F,$){var P=new FileReader;P.onload=function(I){F(I.target.result)},P.onerror=function(I){$(I.target.error)},P.readAsArrayBuffer(S)}):S}).then(function(S){var F=i.getTypeOf(S);return F?(F==="arraybuffer"?S=i.transformTo("uint8array",S):F==="string"&&(y?S=o.decode(S):d&&_!==!0&&(S=function($){return m($,s.uint8array?new Uint8Array($.length):new Array($.length))}(S))),S):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,n,i){var s=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");function m(g){this.files=[],this.loadOptions=g}m.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(b)+", expected "+o.pretty(g)+")")}},isSignature:function(g,b){var f=this.reader.index;this.reader.setIndex(g);var w=this.reader.readString(4)===b;return this.reader.setIndex(f),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),b=c.uint8array?"uint8array":"array",f=o.transformTo(b,g);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,b,f,w=this.zip64EndOfCentralSize-44;0<w;)g=this.reader.readInt(2),b=this.reader.readInt(4),f=this.reader.readData(b),this.zip64ExtensibleData[g]={id:g,length:b,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,b;for(g=0;g<this.files.length;g++)b=this.files[g],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(g=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var b=g;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var w=b-f;if(0<w)this.isSignature(b,a.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(g){this.reader=s(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=m},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,n,i){var s=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),m=t("./compressions"),g=t("./support");function b(f,w){this.options=f,this.loadOptions=w}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var w,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=function(v){for(var d in m)if(Object.prototype.hasOwnProperty.call(m,d)&&m[d].magic===v)return m[d];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,w,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var w=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(w),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var w,p,v,d=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<d;)w=f.readInt(2),p=f.readInt(2),v=f.readData(p),this.extraFields[w]={id:w,length:p,value:v};f.setIndex(d)},handleUTF8:function(){var f=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var p=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var d=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(d)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var w=s(f.value);return w.readInt(1)!==1||l(this.fileName)!==w.readInt(4)?null:c.utf8decode(w.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var w=s(f.value);return w.readInt(1)!==1||l(this.fileComment)!==w.readInt(4)?null:c.utf8decode(w.readData(f.length-5))}return null}},n.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,n,i){function s(w,p,v){this.name=w,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=p,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),m=t("./stream/GenericWorker");s.prototype={internalStream:function(w){var p=null,v="string";try{if(!w)throw new Error("No output type specified.");var d=(v=w.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),p=this._decompressWorker();var _=!this._dataBinary;_&&!d&&(p=p.pipe(new l.Utf8EncodeWorker)),!_&&d&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(y){(p=new m("error")).error(y)}return new o(p,v,"")},async:function(w,p){return this.internalStream(w).accumulate(p)},nodeStream:function(w,p){return this.internalStream(w||"nodebuffer").toNodejsStream(p)},_compressWorker:function(w,p){if(this._data instanceof c&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(v,w,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof m?this._data:new a(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<g.length;f++)s.prototype[g[f]]=b;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,n,i){(function(s){var o,a,l=s.MutationObserver||s.WebKitMutationObserver;if(l){var c=0,m=new l(w),g=s.document.createTextNode("");m.observe(g,{characterData:!0}),o=function(){g.data=c=++c%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){w(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(w,0)};else{var b=new s.MessageChannel;b.port1.onmessage=w,o=function(){b.port2.postMessage(0)}}var f=[];function w(){var p,v;a=!0;for(var d=f.length;d;){for(v=f,f=[],p=-1;++p<d;)v[p]();d=f.length}a=!1}n.exports=function(p){f.push(p)!==1||a||o()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,n,i){var s=t("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],m=["PENDING"];function g(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,d!==o&&p(this,d)}function b(d,_,y){this.promise=d,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function f(d,_,y){s(function(){var S;try{S=_(y)}catch(F){return a.reject(d,F)}S===d?a.reject(d,new TypeError("Cannot resolve promise with itself")):a.resolve(d,S)})}function w(d){var _=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof _=="function")return function(){_.apply(d,arguments)}}function p(d,_){var y=!1;function S(P){y||(y=!0,a.reject(d,P))}function F(P){y||(y=!0,a.resolve(d,P))}var $=v(function(){_(F,S)});$.status==="error"&&S($.value)}function v(d,_){var y={};try{y.value=d(_),y.status="success"}catch(S){y.status="error",y.value=S}return y}(n.exports=g).prototype.finally=function(d){if(typeof d!="function")return this;var _=this.constructor;return this.then(function(y){return _.resolve(d()).then(function(){return y})},function(y){return _.resolve(d()).then(function(){throw y})})},g.prototype.catch=function(d){return this.then(null,d)},g.prototype.then=function(d,_){if(typeof d!="function"&&this.state===c||typeof _!="function"&&this.state===l)return this;var y=new this.constructor(o);return this.state!==m?f(y,this.state===c?d:_,this.outcome):this.queue.push(new b(y,d,_)),y},b.prototype.callFulfilled=function(d){a.resolve(this.promise,d)},b.prototype.otherCallFulfilled=function(d){f(this.promise,this.onFulfilled,d)},b.prototype.callRejected=function(d){a.reject(this.promise,d)},b.prototype.otherCallRejected=function(d){f(this.promise,this.onRejected,d)},a.resolve=function(d,_){var y=v(w,_);if(y.status==="error")return a.reject(d,y.value);var S=y.value;if(S)p(d,S);else{d.state=c,d.outcome=_;for(var F=-1,$=d.queue.length;++F<$;)d.queue[F].callFulfilled(_)}return d},a.reject=function(d,_){d.state=l,d.outcome=_;for(var y=-1,S=d.queue.length;++y<S;)d.queue[y].callRejected(_);return d},g.resolve=function(d){return d instanceof this?d:a.resolve(new this(o),d)},g.reject=function(d){var _=new this(o);return a.reject(_,d)},g.all=function(d){var _=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=d.length,S=!1;if(!y)return this.resolve([]);for(var F=new Array(y),$=0,P=-1,I=new this(o);++P<y;)D(d[P],P);return I;function D(V,J){_.resolve(V).then(function(C){F[J]=C,++$!==y||S||(S=!0,a.resolve(I,F))},function(C){S||(S=!0,a.reject(I,C))})}},g.race=function(d){var _=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=d.length,S=!1;if(!y)return this.resolve([]);for(var F=-1,$=new this(o);++F<y;)P=d[F],_.resolve(P).then(function(I){S||(S=!0,a.resolve($,I))},function(I){S||(S=!0,a.reject($,I))});var P;return $}},{immediate:36}],38:[function(t,n,i){var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,n,i){var s=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),m=Object.prototype.toString,g=0,b=-1,f=0,w=8;function p(d){if(!(this instanceof p))return new p(d);this.options=o.assign({level:b,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},d||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=s.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(y!==g)throw new Error(l[y]);if(_.header&&s.deflateSetHeader(this.strm,_.header),_.dictionary){var S;if(S=typeof _.dictionary=="string"?a.string2buf(_.dictionary):m.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(y=s.deflateSetDictionary(this.strm,S))!==g)throw new Error(l[y]);this._dict_set=!0}}function v(d,_){var y=new p(_);if(y.push(d,!0),y.err)throw y.msg||l[y.err];return y.result}p.prototype.push=function(d,_){var y,S,F=this.strm,$=this.options.chunkSize;if(this.ended)return!1;S=_===~~_?_:_===!0?4:0,typeof d=="string"?F.input=a.string2buf(d):m.call(d)==="[object ArrayBuffer]"?F.input=new Uint8Array(d):F.input=d,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new o.Buf8($),F.next_out=0,F.avail_out=$),(y=s.deflate(F,S))!==1&&y!==g)return this.onEnd(y),!(this.ended=!0);F.avail_out!==0&&(F.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(F.output,F.next_out))):this.onData(o.shrinkBuf(F.output,F.next_out)))}while((0<F.avail_in||F.avail_out===0)&&y!==1);return S===4?(y=s.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===g):S!==2||(this.onEnd(g),!(F.avail_out=0))},p.prototype.onData=function(d){this.chunks.push(d)},p.prototype.onEnd=function(d){d===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},i.Deflate=p,i.deflate=v,i.deflateRaw=function(d,_){return(_=_||{}).raw=!0,v(d,_)},i.gzip=function(d,_){return(_=_||{}).gzip=!0,v(d,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,n,i){var s=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),m=t("./zlib/zstream"),g=t("./zlib/gzheader"),b=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||p&&p.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var d=s.inflateInit2(this.strm,v.windowBits);if(d!==l.Z_OK)throw new Error(c[d]);this.header=new g,s.inflateGetHeader(this.strm,this.header)}function w(p,v){var d=new f(v);if(d.push(p,!0),d.err)throw d.msg||c[d.err];return d.result}f.prototype.push=function(p,v){var d,_,y,S,F,$,P=this.strm,I=this.options.chunkSize,D=this.options.dictionary,V=!1;if(this.ended)return!1;_=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?P.input=a.binstring2buf(p):b.call(p)==="[object ArrayBuffer]"?P.input=new Uint8Array(p):P.input=p,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new o.Buf8(I),P.next_out=0,P.avail_out=I),(d=s.inflate(P,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&D&&($=typeof D=="string"?a.string2buf(D):b.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,d=s.inflateSetDictionary(this.strm,$)),d===l.Z_BUF_ERROR&&V===!0&&(d=l.Z_OK,V=!1),d!==l.Z_STREAM_END&&d!==l.Z_OK)return this.onEnd(d),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&d!==l.Z_STREAM_END&&(P.avail_in!==0||_!==l.Z_FINISH&&_!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=a.utf8border(P.output,P.next_out),S=P.next_out-y,F=a.buf2string(P.output,y),P.next_out=S,P.avail_out=I-S,S&&o.arraySet(P.output,P.output,y,S,0),this.onData(F)):this.onData(o.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(V=!0)}while((0<P.avail_in||P.avail_out===0)&&d!==l.Z_STREAM_END);return d===l.Z_STREAM_END&&(_=l.Z_FINISH),_===l.Z_FINISH?(d=s.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===l.Z_OK):_!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(P.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=w,i.inflateRaw=function(p,v){return(v=v||{}).raw=!0,w(p,v)},i.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var m=c.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var g in m)m.hasOwnProperty(g)&&(l[g]=m[g])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,m,g,b){if(c.subarray&&l.subarray)l.set(c.subarray(m,m+g),b);else for(var f=0;f<g;f++)l[b+f]=c[m+f]},flattenChunks:function(l){var c,m,g,b,f,w;for(c=g=0,m=l.length;c<m;c++)g+=l[c].length;for(w=new Uint8Array(g),c=b=0,m=l.length;c<m;c++)f=l[c],w.set(f,b),b+=f.length;return w}},a={arraySet:function(l,c,m,g,b){for(var f=0;f<g;f++)l[b+f]=c[m+f]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(t,n,i){var s=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new s.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function m(g,b){if(b<65537&&(g.subarray&&a||!g.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(g,b));for(var f="",w=0;w<b;w++)f+=String.fromCharCode(g[w]);return f}l[254]=l[254]=1,i.string2buf=function(g){var b,f,w,p,v,d=g.length,_=0;for(p=0;p<d;p++)(64512&(f=g.charCodeAt(p)))==55296&&p+1<d&&(64512&(w=g.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(w-56320),p++),_+=f<128?1:f<2048?2:f<65536?3:4;for(b=new s.Buf8(_),p=v=0;v<_;p++)(64512&(f=g.charCodeAt(p)))==55296&&p+1<d&&(64512&(w=g.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(w-56320),p++),f<128?b[v++]=f:(f<2048?b[v++]=192|f>>>6:(f<65536?b[v++]=224|f>>>12:(b[v++]=240|f>>>18,b[v++]=128|f>>>12&63),b[v++]=128|f>>>6&63),b[v++]=128|63&f);return b},i.buf2binstring=function(g){return m(g,g.length)},i.binstring2buf=function(g){for(var b=new s.Buf8(g.length),f=0,w=b.length;f<w;f++)b[f]=g.charCodeAt(f);return b},i.buf2string=function(g,b){var f,w,p,v,d=b||g.length,_=new Array(2*d);for(f=w=0;f<d;)if((p=g[f++])<128)_[w++]=p;else if(4<(v=l[p]))_[w++]=65533,f+=v-1;else{for(p&=v===2?31:v===3?15:7;1<v&&f<d;)p=p<<6|63&g[f++],v--;1<v?_[w++]=65533:p<65536?_[w++]=p:(p-=65536,_[w++]=55296|p>>10&1023,_[w++]=56320|1023&p)}return m(_,w)},i.utf8border=function(g,b){var f;for((b=b||g.length)>g.length&&(b=g.length),f=b-1;0<=f&&(192&g[f])==128;)f--;return f<0||f===0?b:f+l[g[f]]>b?f:b}},{"./common":41}],43:[function(t,n,i){n.exports=function(s,o,a,l){for(var c=65535&s|0,m=s>>>16&65535|0,g=0;a!==0;){for(a-=g=2e3<a?2e3:a;m=m+(c=c+o[l++]|0)|0,--g;);c%=65521,m%=65521}return c|m<<16|0}},{}],44:[function(t,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,n,i){var s=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();n.exports=function(o,a,l,c){var m=s,g=c+l;o^=-1;for(var b=c;b<g;b++)o=o>>>8^m[255&(o^a[b])];return-1^o}},{}],46:[function(t,n,i){var s,o=t("../utils/common"),a=t("./trees"),l=t("./adler32"),c=t("./crc32"),m=t("./messages"),g=0,b=4,f=0,w=-2,p=-1,v=4,d=2,_=8,y=9,S=286,F=30,$=19,P=2*S+1,I=15,D=3,V=258,J=V+D+1,C=42,B=113,h=1,L=2,tt=3,Z=4;function et(u,U){return u.msg=m[U],U}function H(u){return(u<<1)-(4<u?9:0)}function rt(u){for(var U=u.length;0<=--U;)u[U]=0}function N(u){var U=u.state,O=U.pending;O>u.avail_out&&(O=u.avail_out),O!==0&&(o.arraySet(u.output,U.pending_buf,U.pending_out,O,u.next_out),u.next_out+=O,U.pending_out+=O,u.total_out+=O,u.avail_out-=O,U.pending-=O,U.pending===0&&(U.pending_out=0))}function j(u,U){a._tr_flush_block(u,0<=u.block_start?u.block_start:-1,u.strstart-u.block_start,U),u.block_start=u.strstart,N(u.strm)}function M(u,U){u.pending_buf[u.pending++]=U}function X(u,U){u.pending_buf[u.pending++]=U>>>8&255,u.pending_buf[u.pending++]=255&U}function q(u,U){var O,x,k=u.max_chain_length,E=u.strstart,W=u.prev_length,G=u.nice_match,T=u.strstart>u.w_size-J?u.strstart-(u.w_size-J):0,K=u.window,Q=u.w_mask,Y=u.prev,nt=u.strstart+V,ct=K[E+W-1],at=K[E+W];u.prev_length>=u.good_match&&(k>>=2),G>u.lookahead&&(G=u.lookahead);do if(K[(O=U)+W]===at&&K[O+W-1]===ct&&K[O]===K[E]&&K[++O]===K[E+1]){E+=2,O++;do;while(K[++E]===K[++O]&&K[++E]===K[++O]&&K[++E]===K[++O]&&K[++E]===K[++O]&&K[++E]===K[++O]&&K[++E]===K[++O]&&K[++E]===K[++O]&&K[++E]===K[++O]&&E<nt);if(x=V-(nt-E),E=nt-V,W<x){if(u.match_start=U,G<=(W=x))break;ct=K[E+W-1],at=K[E+W]}}while((U=Y[U&Q])>T&&--k!=0);return W<=u.lookahead?W:u.lookahead}function ut(u){var U,O,x,k,E,W,G,T,K,Q,Y=u.w_size;do{if(k=u.window_size-u.lookahead-u.strstart,u.strstart>=Y+(Y-J)){for(o.arraySet(u.window,u.window,Y,Y,0),u.match_start-=Y,u.strstart-=Y,u.block_start-=Y,U=O=u.hash_size;x=u.head[--U],u.head[U]=Y<=x?x-Y:0,--O;);for(U=O=Y;x=u.prev[--U],u.prev[U]=Y<=x?x-Y:0,--O;);k+=Y}if(u.strm.avail_in===0)break;if(W=u.strm,G=u.window,T=u.strstart+u.lookahead,K=k,Q=void 0,Q=W.avail_in,K<Q&&(Q=K),O=Q===0?0:(W.avail_in-=Q,o.arraySet(G,W.input,W.next_in,Q,T),W.state.wrap===1?W.adler=l(W.adler,G,Q,T):W.state.wrap===2&&(W.adler=c(W.adler,G,Q,T)),W.next_in+=Q,W.total_in+=Q,Q),u.lookahead+=O,u.lookahead+u.insert>=D)for(E=u.strstart-u.insert,u.ins_h=u.window[E],u.ins_h=(u.ins_h<<u.hash_shift^u.window[E+1])&u.hash_mask;u.insert&&(u.ins_h=(u.ins_h<<u.hash_shift^u.window[E+D-1])&u.hash_mask,u.prev[E&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=E,E++,u.insert--,!(u.lookahead+u.insert<D)););}while(u.lookahead<J&&u.strm.avail_in!==0)}function wt(u,U){for(var O,x;;){if(u.lookahead<J){if(ut(u),u.lookahead<J&&U===g)return h;if(u.lookahead===0)break}if(O=0,u.lookahead>=D&&(u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+D-1])&u.hash_mask,O=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),O!==0&&u.strstart-O<=u.w_size-J&&(u.match_length=q(u,O)),u.match_length>=D)if(x=a._tr_tally(u,u.strstart-u.match_start,u.match_length-D),u.lookahead-=u.match_length,u.match_length<=u.max_lazy_match&&u.lookahead>=D){for(u.match_length--;u.strstart++,u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+D-1])&u.hash_mask,O=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart,--u.match_length!=0;);u.strstart++}else u.strstart+=u.match_length,u.match_length=0,u.ins_h=u.window[u.strstart],u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+1])&u.hash_mask;else x=a._tr_tally(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++;if(x&&(j(u,!1),u.strm.avail_out===0))return h}return u.insert=u.strstart<D-1?u.strstart:D-1,U===b?(j(u,!0),u.strm.avail_out===0?tt:Z):u.last_lit&&(j(u,!1),u.strm.avail_out===0)?h:L}function it(u,U){for(var O,x,k;;){if(u.lookahead<J){if(ut(u),u.lookahead<J&&U===g)return h;if(u.lookahead===0)break}if(O=0,u.lookahead>=D&&(u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+D-1])&u.hash_mask,O=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),u.prev_length=u.match_length,u.prev_match=u.match_start,u.match_length=D-1,O!==0&&u.prev_length<u.max_lazy_match&&u.strstart-O<=u.w_size-J&&(u.match_length=q(u,O),u.match_length<=5&&(u.strategy===1||u.match_length===D&&4096<u.strstart-u.match_start)&&(u.match_length=D-1)),u.prev_length>=D&&u.match_length<=u.prev_length){for(k=u.strstart+u.lookahead-D,x=a._tr_tally(u,u.strstart-1-u.prev_match,u.prev_length-D),u.lookahead-=u.prev_length-1,u.prev_length-=2;++u.strstart<=k&&(u.ins_h=(u.ins_h<<u.hash_shift^u.window[u.strstart+D-1])&u.hash_mask,O=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),--u.prev_length!=0;);if(u.match_available=0,u.match_length=D-1,u.strstart++,x&&(j(u,!1),u.strm.avail_out===0))return h}else if(u.match_available){if((x=a._tr_tally(u,0,u.window[u.strstart-1]))&&j(u,!1),u.strstart++,u.lookahead--,u.strm.avail_out===0)return h}else u.match_available=1,u.strstart++,u.lookahead--}return u.match_available&&(x=a._tr_tally(u,0,u.window[u.strstart-1]),u.match_available=0),u.insert=u.strstart<D-1?u.strstart:D-1,U===b?(j(u,!0),u.strm.avail_out===0?tt:Z):u.last_lit&&(j(u,!1),u.strm.avail_out===0)?h:L}function lt(u,U,O,x,k){this.good_length=u,this.max_lazy=U,this.nice_length=O,this.max_chain=x,this.func=k}function vt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*P),this.dyn_dtree=new o.Buf16(2*(2*F+1)),this.bl_tree=new o.Buf16(2*(2*$+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(I+1),this.heap=new o.Buf16(2*S+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*S+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function dt(u){var U;return u&&u.state?(u.total_in=u.total_out=0,u.data_type=d,(U=u.state).pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?C:B,u.adler=U.wrap===2?0:1,U.last_flush=g,a._tr_init(U),f):et(u,w)}function Bt(u){var U=dt(u);return U===f&&function(O){O.window_size=2*O.w_size,rt(O.head),O.max_lazy_match=s[O.level].max_lazy,O.good_match=s[O.level].good_length,O.nice_match=s[O.level].nice_length,O.max_chain_length=s[O.level].max_chain,O.strstart=0,O.block_start=0,O.lookahead=0,O.insert=0,O.match_length=O.prev_length=D-1,O.match_available=0,O.ins_h=0}(u.state),U}function Dt(u,U,O,x,k,E){if(!u)return w;var W=1;if(U===p&&(U=6),x<0?(W=0,x=-x):15<x&&(W=2,x-=16),k<1||y<k||O!==_||x<8||15<x||U<0||9<U||E<0||v<E)return et(u,w);x===8&&(x=9);var G=new vt;return(u.state=G).strm=u,G.wrap=W,G.gzhead=null,G.w_bits=x,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=k+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+D-1)/D),G.window=new o.Buf8(2*G.w_size),G.head=new o.Buf16(G.hash_size),G.prev=new o.Buf16(G.w_size),G.lit_bufsize=1<<k+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new o.Buf8(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=U,G.strategy=E,G.method=O,Bt(u)}s=[new lt(0,0,0,0,function(u,U){var O=65535;for(O>u.pending_buf_size-5&&(O=u.pending_buf_size-5);;){if(u.lookahead<=1){if(ut(u),u.lookahead===0&&U===g)return h;if(u.lookahead===0)break}u.strstart+=u.lookahead,u.lookahead=0;var x=u.block_start+O;if((u.strstart===0||u.strstart>=x)&&(u.lookahead=u.strstart-x,u.strstart=x,j(u,!1),u.strm.avail_out===0)||u.strstart-u.block_start>=u.w_size-J&&(j(u,!1),u.strm.avail_out===0))return h}return u.insert=0,U===b?(j(u,!0),u.strm.avail_out===0?tt:Z):(u.strstart>u.block_start&&(j(u,!1),u.strm.avail_out),h)}),new lt(4,4,8,4,wt),new lt(4,5,16,8,wt),new lt(4,6,32,32,wt),new lt(4,4,16,16,it),new lt(8,16,32,32,it),new lt(8,16,128,128,it),new lt(8,32,128,256,it),new lt(32,128,258,1024,it),new lt(32,258,258,4096,it)],i.deflateInit=function(u,U){return Dt(u,U,_,15,8,0)},i.deflateInit2=Dt,i.deflateReset=Bt,i.deflateResetKeep=dt,i.deflateSetHeader=function(u,U){return u&&u.state?u.state.wrap!==2?w:(u.state.gzhead=U,f):w},i.deflate=function(u,U){var O,x,k,E;if(!u||!u.state||5<U||U<0)return u?et(u,w):w;if(x=u.state,!u.output||!u.input&&u.avail_in!==0||x.status===666&&U!==b)return et(u,u.avail_out===0?-5:w);if(x.strm=u,O=x.last_flush,x.last_flush=U,x.status===C)if(x.wrap===2)u.adler=0,M(x,31),M(x,139),M(x,8),x.gzhead?(M(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),M(x,255&x.gzhead.time),M(x,x.gzhead.time>>8&255),M(x,x.gzhead.time>>16&255),M(x,x.gzhead.time>>24&255),M(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),M(x,255&x.gzhead.os),x.gzhead.extra&&x.gzhead.extra.length&&(M(x,255&x.gzhead.extra.length),M(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(u.adler=c(u.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=69):(M(x,0),M(x,0),M(x,0),M(x,0),M(x,0),M(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),M(x,3),x.status=B);else{var W=_+(x.w_bits-8<<4)<<8;W|=(2<=x.strategy||x.level<2?0:x.level<6?1:x.level===6?2:3)<<6,x.strstart!==0&&(W|=32),W+=31-W%31,x.status=B,X(x,W),x.strstart!==0&&(X(x,u.adler>>>16),X(x,65535&u.adler)),u.adler=1}if(x.status===69)if(x.gzhead.extra){for(k=x.pending;x.gzindex<(65535&x.gzhead.extra.length)&&(x.pending!==x.pending_buf_size||(x.gzhead.hcrc&&x.pending>k&&(u.adler=c(u.adler,x.pending_buf,x.pending-k,k)),N(u),k=x.pending,x.pending!==x.pending_buf_size));)M(x,255&x.gzhead.extra[x.gzindex]),x.gzindex++;x.gzhead.hcrc&&x.pending>k&&(u.adler=c(u.adler,x.pending_buf,x.pending-k,k)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=73)}else x.status=73;if(x.status===73)if(x.gzhead.name){k=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>k&&(u.adler=c(u.adler,x.pending_buf,x.pending-k,k)),N(u),k=x.pending,x.pending===x.pending_buf_size)){E=1;break}E=x.gzindex<x.gzhead.name.length?255&x.gzhead.name.charCodeAt(x.gzindex++):0,M(x,E)}while(E!==0);x.gzhead.hcrc&&x.pending>k&&(u.adler=c(u.adler,x.pending_buf,x.pending-k,k)),E===0&&(x.gzindex=0,x.status=91)}else x.status=91;if(x.status===91)if(x.gzhead.comment){k=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>k&&(u.adler=c(u.adler,x.pending_buf,x.pending-k,k)),N(u),k=x.pending,x.pending===x.pending_buf_size)){E=1;break}E=x.gzindex<x.gzhead.comment.length?255&x.gzhead.comment.charCodeAt(x.gzindex++):0,M(x,E)}while(E!==0);x.gzhead.hcrc&&x.pending>k&&(u.adler=c(u.adler,x.pending_buf,x.pending-k,k)),E===0&&(x.status=103)}else x.status=103;if(x.status===103&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&N(u),x.pending+2<=x.pending_buf_size&&(M(x,255&u.adler),M(x,u.adler>>8&255),u.adler=0,x.status=B)):x.status=B),x.pending!==0){if(N(u),u.avail_out===0)return x.last_flush=-1,f}else if(u.avail_in===0&&H(U)<=H(O)&&U!==b)return et(u,-5);if(x.status===666&&u.avail_in!==0)return et(u,-5);if(u.avail_in!==0||x.lookahead!==0||U!==g&&x.status!==666){var G=x.strategy===2?function(T,K){for(var Q;;){if(T.lookahead===0&&(ut(T),T.lookahead===0)){if(K===g)return h;break}if(T.match_length=0,Q=a._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++,Q&&(j(T,!1),T.strm.avail_out===0))return h}return T.insert=0,K===b?(j(T,!0),T.strm.avail_out===0?tt:Z):T.last_lit&&(j(T,!1),T.strm.avail_out===0)?h:L}(x,U):x.strategy===3?function(T,K){for(var Q,Y,nt,ct,at=T.window;;){if(T.lookahead<=V){if(ut(T),T.lookahead<=V&&K===g)return h;if(T.lookahead===0)break}if(T.match_length=0,T.lookahead>=D&&0<T.strstart&&(Y=at[nt=T.strstart-1])===at[++nt]&&Y===at[++nt]&&Y===at[++nt]){ct=T.strstart+V;do;while(Y===at[++nt]&&Y===at[++nt]&&Y===at[++nt]&&Y===at[++nt]&&Y===at[++nt]&&Y===at[++nt]&&Y===at[++nt]&&Y===at[++nt]&&nt<ct);T.match_length=V-(ct-nt),T.match_length>T.lookahead&&(T.match_length=T.lookahead)}if(T.match_length>=D?(Q=a._tr_tally(T,1,T.match_length-D),T.lookahead-=T.match_length,T.strstart+=T.match_length,T.match_length=0):(Q=a._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++),Q&&(j(T,!1),T.strm.avail_out===0))return h}return T.insert=0,K===b?(j(T,!0),T.strm.avail_out===0?tt:Z):T.last_lit&&(j(T,!1),T.strm.avail_out===0)?h:L}(x,U):s[x.level].func(x,U);if(G!==tt&&G!==Z||(x.status=666),G===h||G===tt)return u.avail_out===0&&(x.last_flush=-1),f;if(G===L&&(U===1?a._tr_align(x):U!==5&&(a._tr_stored_block(x,0,0,!1),U===3&&(rt(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),N(u),u.avail_out===0))return x.last_flush=-1,f}return U!==b?f:x.wrap<=0?1:(x.wrap===2?(M(x,255&u.adler),M(x,u.adler>>8&255),M(x,u.adler>>16&255),M(x,u.adler>>24&255),M(x,255&u.total_in),M(x,u.total_in>>8&255),M(x,u.total_in>>16&255),M(x,u.total_in>>24&255)):(X(x,u.adler>>>16),X(x,65535&u.adler)),N(u),0<x.wrap&&(x.wrap=-x.wrap),x.pending!==0?f:1)},i.deflateEnd=function(u){var U;return u&&u.state?(U=u.state.status)!==C&&U!==69&&U!==73&&U!==91&&U!==103&&U!==B&&U!==666?et(u,w):(u.state=null,U===B?et(u,-3):f):w},i.deflateSetDictionary=function(u,U){var O,x,k,E,W,G,T,K,Q=U.length;if(!u||!u.state||(E=(O=u.state).wrap)===2||E===1&&O.status!==C||O.lookahead)return w;for(E===1&&(u.adler=l(u.adler,U,Q,0)),O.wrap=0,Q>=O.w_size&&(E===0&&(rt(O.head),O.strstart=0,O.block_start=0,O.insert=0),K=new o.Buf8(O.w_size),o.arraySet(K,U,Q-O.w_size,O.w_size,0),U=K,Q=O.w_size),W=u.avail_in,G=u.next_in,T=u.input,u.avail_in=Q,u.next_in=0,u.input=U,ut(O);O.lookahead>=D;){for(x=O.strstart,k=O.lookahead-(D-1);O.ins_h=(O.ins_h<<O.hash_shift^O.window[x+D-1])&O.hash_mask,O.prev[x&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=x,x++,--k;);O.strstart=x,O.lookahead=D-1,ut(O)}return O.strstart+=O.lookahead,O.block_start=O.strstart,O.insert=O.lookahead,O.lookahead=0,O.match_length=O.prev_length=D-1,O.match_available=0,u.next_in=G,u.input=T,u.avail_in=W,O.wrap=E,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,n,i){n.exports=function(s,o){var a,l,c,m,g,b,f,w,p,v,d,_,y,S,F,$,P,I,D,V,J,C,B,h,L;a=s.state,l=s.next_in,h=s.input,c=l+(s.avail_in-5),m=s.next_out,L=s.output,g=m-(o-s.avail_out),b=m+(s.avail_out-257),f=a.dmax,w=a.wsize,p=a.whave,v=a.wnext,d=a.window,_=a.hold,y=a.bits,S=a.lencode,F=a.distcode,$=(1<<a.lenbits)-1,P=(1<<a.distbits)-1;t:do{y<15&&(_+=h[l++]<<y,y+=8,_+=h[l++]<<y,y+=8),I=S[_&$];e:for(;;){if(_>>>=D=I>>>24,y-=D,(D=I>>>16&255)===0)L[m++]=65535&I;else{if(!(16&D)){if(!(64&D)){I=S[(65535&I)+(_&(1<<D)-1)];continue e}if(32&D){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}V=65535&I,(D&=15)&&(y<D&&(_+=h[l++]<<y,y+=8),V+=_&(1<<D)-1,_>>>=D,y-=D),y<15&&(_+=h[l++]<<y,y+=8,_+=h[l++]<<y,y+=8),I=F[_&P];n:for(;;){if(_>>>=D=I>>>24,y-=D,!(16&(D=I>>>16&255))){if(!(64&D)){I=F[(65535&I)+(_&(1<<D)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(J=65535&I,y<(D&=15)&&(_+=h[l++]<<y,(y+=8)<D&&(_+=h[l++]<<y,y+=8)),f<(J+=_&(1<<D)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(_>>>=D,y-=D,(D=m-g)<J){if(p<(D=J-D)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(B=d,(C=0)===v){if(C+=w-D,D<V){for(V-=D;L[m++]=d[C++],--D;);C=m-J,B=L}}else if(v<D){if(C+=w+v-D,(D-=v)<V){for(V-=D;L[m++]=d[C++],--D;);if(C=0,v<V){for(V-=D=v;L[m++]=d[C++],--D;);C=m-J,B=L}}}else if(C+=v-D,D<V){for(V-=D;L[m++]=d[C++],--D;);C=m-J,B=L}for(;2<V;)L[m++]=B[C++],L[m++]=B[C++],L[m++]=B[C++],V-=3;V&&(L[m++]=B[C++],1<V&&(L[m++]=B[C++]))}else{for(C=m-J;L[m++]=L[C++],L[m++]=L[C++],L[m++]=L[C++],2<(V-=3););V&&(L[m++]=L[C++],1<V&&(L[m++]=L[C++]))}break}}break}}while(l<c&&m<b);l-=V=y>>3,_&=(1<<(y-=V<<3))-1,s.next_in=l,s.next_out=m,s.avail_in=l<c?c-l+5:5-(l-c),s.avail_out=m<b?b-m+257:257-(m-b),a.hold=_,a.bits=y}},{}],49:[function(t,n,i){var s=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),m=1,g=2,b=0,f=-2,w=1,p=852,v=592;function d(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(C){var B;return C&&C.state?(B=C.state,C.total_in=C.total_out=B.total=0,C.msg="",B.wrap&&(C.adler=1&B.wrap),B.mode=w,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new s.Buf32(p),B.distcode=B.distdyn=new s.Buf32(v),B.sane=1,B.back=-1,b):f}function S(C){var B;return C&&C.state?((B=C.state).wsize=0,B.whave=0,B.wnext=0,y(C)):f}function F(C,B){var h,L;return C&&C.state?(L=C.state,B<0?(h=0,B=-B):(h=1+(B>>4),B<48&&(B&=15)),B&&(B<8||15<B)?f:(L.window!==null&&L.wbits!==B&&(L.window=null),L.wrap=h,L.wbits=B,S(C))):f}function $(C,B){var h,L;return C?(L=new _,(C.state=L).window=null,(h=F(C,B))!==b&&(C.state=null),h):f}var P,I,D=!0;function V(C){if(D){var B;for(P=new s.Buf32(512),I=new s.Buf32(32),B=0;B<144;)C.lens[B++]=8;for(;B<256;)C.lens[B++]=9;for(;B<280;)C.lens[B++]=7;for(;B<288;)C.lens[B++]=8;for(c(m,C.lens,0,288,P,0,C.work,{bits:9}),B=0;B<32;)C.lens[B++]=5;c(g,C.lens,0,32,I,0,C.work,{bits:5}),D=!1}C.lencode=P,C.lenbits=9,C.distcode=I,C.distbits=5}function J(C,B,h,L){var tt,Z=C.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new s.Buf8(Z.wsize)),L>=Z.wsize?(s.arraySet(Z.window,B,h-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(L<(tt=Z.wsize-Z.wnext)&&(tt=L),s.arraySet(Z.window,B,h-L,tt,Z.wnext),(L-=tt)?(s.arraySet(Z.window,B,h-L,L,0),Z.wnext=L,Z.whave=Z.wsize):(Z.wnext+=tt,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=tt))),0}i.inflateReset=S,i.inflateReset2=F,i.inflateResetKeep=y,i.inflateInit=function(C){return $(C,15)},i.inflateInit2=$,i.inflate=function(C,B){var h,L,tt,Z,et,H,rt,N,j,M,X,q,ut,wt,it,lt,vt,dt,Bt,Dt,u,U,O,x,k=0,E=new s.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return f;(h=C.state).mode===12&&(h.mode=13),et=C.next_out,tt=C.output,rt=C.avail_out,Z=C.next_in,L=C.input,H=C.avail_in,N=h.hold,j=h.bits,M=H,X=rt,U=b;t:for(;;)switch(h.mode){case w:if(h.wrap===0){h.mode=13;break}for(;j<16;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(2&h.wrap&&N===35615){E[h.check=0]=255&N,E[1]=N>>>8&255,h.check=a(h.check,E,2,0),j=N=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&N)<<8)+(N>>8))%31){C.msg="incorrect header check",h.mode=30;break}if((15&N)!=8){C.msg="unknown compression method",h.mode=30;break}if(j-=4,u=8+(15&(N>>>=4)),h.wbits===0)h.wbits=u;else if(u>h.wbits){C.msg="invalid window size",h.mode=30;break}h.dmax=1<<u,C.adler=h.check=1,h.mode=512&N?10:12,j=N=0;break;case 2:for(;j<16;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(h.flags=N,(255&h.flags)!=8){C.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){C.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=N>>8&1),512&h.flags&&(E[0]=255&N,E[1]=N>>>8&255,h.check=a(h.check,E,2,0)),j=N=0,h.mode=3;case 3:for(;j<32;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}h.head&&(h.head.time=N),512&h.flags&&(E[0]=255&N,E[1]=N>>>8&255,E[2]=N>>>16&255,E[3]=N>>>24&255,h.check=a(h.check,E,4,0)),j=N=0,h.mode=4;case 4:for(;j<16;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}h.head&&(h.head.xflags=255&N,h.head.os=N>>8),512&h.flags&&(E[0]=255&N,E[1]=N>>>8&255,h.check=a(h.check,E,2,0)),j=N=0,h.mode=5;case 5:if(1024&h.flags){for(;j<16;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}h.length=N,h.head&&(h.head.extra_len=N),512&h.flags&&(E[0]=255&N,E[1]=N>>>8&255,h.check=a(h.check,E,2,0)),j=N=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(H<(q=h.length)&&(q=H),q&&(h.head&&(u=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),s.arraySet(h.head.extra,L,Z,q,u)),512&h.flags&&(h.check=a(h.check,L,q,Z)),H-=q,Z+=q,h.length-=q),h.length))break t;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(H===0)break t;for(q=0;u=L[Z+q++],h.head&&u&&h.length<65536&&(h.head.name+=String.fromCharCode(u)),u&&q<H;);if(512&h.flags&&(h.check=a(h.check,L,q,Z)),H-=q,Z+=q,u)break t}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(H===0)break t;for(q=0;u=L[Z+q++],h.head&&u&&h.length<65536&&(h.head.comment+=String.fromCharCode(u)),u&&q<H;);if(512&h.flags&&(h.check=a(h.check,L,q,Z)),H-=q,Z+=q,u)break t}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;j<16;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(N!==(65535&h.check)){C.msg="header crc mismatch",h.mode=30;break}j=N=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),C.adler=h.check=0,h.mode=12;break;case 10:for(;j<32;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}C.adler=h.check=d(N),j=N=0,h.mode=11;case 11:if(h.havedict===0)return C.next_out=et,C.avail_out=rt,C.next_in=Z,C.avail_in=H,h.hold=N,h.bits=j,2;C.adler=h.check=1,h.mode=12;case 12:if(B===5||B===6)break t;case 13:if(h.last){N>>>=7&j,j-=7&j,h.mode=27;break}for(;j<3;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}switch(h.last=1&N,j-=1,3&(N>>>=1)){case 0:h.mode=14;break;case 1:if(V(h),h.mode=20,B!==6)break;N>>>=2,j-=2;break t;case 2:h.mode=17;break;case 3:C.msg="invalid block type",h.mode=30}N>>>=2,j-=2;break;case 14:for(N>>>=7&j,j-=7&j;j<32;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if((65535&N)!=(N>>>16^65535)){C.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&N,j=N=0,h.mode=15,B===6)break t;case 15:h.mode=16;case 16:if(q=h.length){if(H<q&&(q=H),rt<q&&(q=rt),q===0)break t;s.arraySet(tt,L,Z,q,et),H-=q,Z+=q,rt-=q,et+=q,h.length-=q;break}h.mode=12;break;case 17:for(;j<14;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(h.nlen=257+(31&N),N>>>=5,j-=5,h.ndist=1+(31&N),N>>>=5,j-=5,h.ncode=4+(15&N),N>>>=4,j-=4,286<h.nlen||30<h.ndist){C.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;j<3;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}h.lens[W[h.have++]]=7&N,N>>>=3,j-=3}for(;h.have<19;)h.lens[W[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,O={bits:h.lenbits},U=c(0,h.lens,0,19,h.lencode,0,h.work,O),h.lenbits=O.bits,U){C.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;lt=(k=h.lencode[N&(1<<h.lenbits)-1])>>>16&255,vt=65535&k,!((it=k>>>24)<=j);){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(vt<16)N>>>=it,j-=it,h.lens[h.have++]=vt;else{if(vt===16){for(x=it+2;j<x;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(N>>>=it,j-=it,h.have===0){C.msg="invalid bit length repeat",h.mode=30;break}u=h.lens[h.have-1],q=3+(3&N),N>>>=2,j-=2}else if(vt===17){for(x=it+3;j<x;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}j-=it,u=0,q=3+(7&(N>>>=it)),N>>>=3,j-=3}else{for(x=it+7;j<x;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}j-=it,u=0,q=11+(127&(N>>>=it)),N>>>=7,j-=7}if(h.have+q>h.nlen+h.ndist){C.msg="invalid bit length repeat",h.mode=30;break}for(;q--;)h.lens[h.have++]=u}}if(h.mode===30)break;if(h.lens[256]===0){C.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,O={bits:h.lenbits},U=c(m,h.lens,0,h.nlen,h.lencode,0,h.work,O),h.lenbits=O.bits,U){C.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,O={bits:h.distbits},U=c(g,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,O),h.distbits=O.bits,U){C.msg="invalid distances set",h.mode=30;break}if(h.mode=20,B===6)break t;case 20:h.mode=21;case 21:if(6<=H&&258<=rt){C.next_out=et,C.avail_out=rt,C.next_in=Z,C.avail_in=H,h.hold=N,h.bits=j,l(C,X),et=C.next_out,tt=C.output,rt=C.avail_out,Z=C.next_in,L=C.input,H=C.avail_in,N=h.hold,j=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;lt=(k=h.lencode[N&(1<<h.lenbits)-1])>>>16&255,vt=65535&k,!((it=k>>>24)<=j);){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(lt&&!(240&lt)){for(dt=it,Bt=lt,Dt=vt;lt=(k=h.lencode[Dt+((N&(1<<dt+Bt)-1)>>dt)])>>>16&255,vt=65535&k,!(dt+(it=k>>>24)<=j);){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}N>>>=dt,j-=dt,h.back+=dt}if(N>>>=it,j-=it,h.back+=it,h.length=vt,lt===0){h.mode=26;break}if(32&lt){h.back=-1,h.mode=12;break}if(64&lt){C.msg="invalid literal/length code",h.mode=30;break}h.extra=15&lt,h.mode=22;case 22:if(h.extra){for(x=h.extra;j<x;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}h.length+=N&(1<<h.extra)-1,N>>>=h.extra,j-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;lt=(k=h.distcode[N&(1<<h.distbits)-1])>>>16&255,vt=65535&k,!((it=k>>>24)<=j);){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(!(240&lt)){for(dt=it,Bt=lt,Dt=vt;lt=(k=h.distcode[Dt+((N&(1<<dt+Bt)-1)>>dt)])>>>16&255,vt=65535&k,!(dt+(it=k>>>24)<=j);){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}N>>>=dt,j-=dt,h.back+=dt}if(N>>>=it,j-=it,h.back+=it,64&lt){C.msg="invalid distance code",h.mode=30;break}h.offset=vt,h.extra=15&lt,h.mode=24;case 24:if(h.extra){for(x=h.extra;j<x;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}h.offset+=N&(1<<h.extra)-1,N>>>=h.extra,j-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){C.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(rt===0)break t;if(q=X-rt,h.offset>q){if((q=h.offset-q)>h.whave&&h.sane){C.msg="invalid distance too far back",h.mode=30;break}ut=q>h.wnext?(q-=h.wnext,h.wsize-q):h.wnext-q,q>h.length&&(q=h.length),wt=h.window}else wt=tt,ut=et-h.offset,q=h.length;for(rt<q&&(q=rt),rt-=q,h.length-=q;tt[et++]=wt[ut++],--q;);h.length===0&&(h.mode=21);break;case 26:if(rt===0)break t;tt[et++]=h.length,rt--,h.mode=21;break;case 27:if(h.wrap){for(;j<32;){if(H===0)break t;H--,N|=L[Z++]<<j,j+=8}if(X-=rt,C.total_out+=X,h.total+=X,X&&(C.adler=h.check=h.flags?a(h.check,tt,X,et-X):o(h.check,tt,X,et-X)),X=rt,(h.flags?N:d(N))!==h.check){C.msg="incorrect data check",h.mode=30;break}j=N=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;j<32;){if(H===0)break t;H--,N+=L[Z++]<<j,j+=8}if(N!==(4294967295&h.total)){C.msg="incorrect length check",h.mode=30;break}j=N=0}h.mode=29;case 29:U=1;break t;case 30:U=-3;break t;case 31:return-4;case 32:default:return f}return C.next_out=et,C.avail_out=rt,C.next_in=Z,C.avail_in=H,h.hold=N,h.bits=j,(h.wsize||X!==C.avail_out&&h.mode<30&&(h.mode<27||B!==4))&&J(C,C.output,C.next_out,X-C.avail_out)?(h.mode=31,-4):(M-=C.avail_in,X-=C.avail_out,C.total_in+=M,C.total_out+=X,h.total+=X,h.wrap&&X&&(C.adler=h.check=h.flags?a(h.check,tt,X,C.next_out-X):o(h.check,tt,X,C.next_out-X)),C.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(M==0&&X===0||B===4)&&U===b&&(U=-5),U)},i.inflateEnd=function(C){if(!C||!C.state)return f;var B=C.state;return B.window&&(B.window=null),C.state=null,b},i.inflateGetHeader=function(C,B){var h;return C&&C.state&&2&(h=C.state).wrap?((h.head=B).done=!1,b):f},i.inflateSetDictionary=function(C,B){var h,L=B.length;return C&&C.state?(h=C.state).wrap!==0&&h.mode!==11?f:h.mode===11&&o(1,B,L,0)!==h.check?-3:J(C,B,L,L)?(h.mode=31,-4):(h.havedict=1,b):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,n,i){var s=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(m,g,b,f,w,p,v,d){var _,y,S,F,$,P,I,D,V,J=d.bits,C=0,B=0,h=0,L=0,tt=0,Z=0,et=0,H=0,rt=0,N=0,j=null,M=0,X=new s.Buf16(16),q=new s.Buf16(16),ut=null,wt=0;for(C=0;C<=15;C++)X[C]=0;for(B=0;B<f;B++)X[g[b+B]]++;for(tt=J,L=15;1<=L&&X[L]===0;L--);if(L<tt&&(tt=L),L===0)return w[p++]=20971520,w[p++]=20971520,d.bits=1,0;for(h=1;h<L&&X[h]===0;h++);for(tt<h&&(tt=h),C=H=1;C<=15;C++)if(H<<=1,(H-=X[C])<0)return-1;if(0<H&&(m===0||L!==1))return-1;for(q[1]=0,C=1;C<15;C++)q[C+1]=q[C]+X[C];for(B=0;B<f;B++)g[b+B]!==0&&(v[q[g[b+B]]++]=B);if(P=m===0?(j=ut=v,19):m===1?(j=o,M-=257,ut=a,wt-=257,256):(j=l,ut=c,-1),C=h,$=p,et=B=N=0,S=-1,F=(rt=1<<(Z=tt))-1,m===1&&852<rt||m===2&&592<rt)return 1;for(;;){for(I=C-et,V=v[B]<P?(D=0,v[B]):v[B]>P?(D=ut[wt+v[B]],j[M+v[B]]):(D=96,0),_=1<<C-et,h=y=1<<Z;w[$+(N>>et)+(y-=_)]=I<<24|D<<16|V|0,y!==0;);for(_=1<<C-1;N&_;)_>>=1;if(_!==0?(N&=_-1,N+=_):N=0,B++,--X[C]==0){if(C===L)break;C=g[b+v[B]]}if(tt<C&&(N&F)!==S){for(et===0&&(et=tt),$+=h,H=1<<(Z=C-et);Z+et<L&&!((H-=X[Z+et])<=0);)Z++,H<<=1;if(rt+=1<<Z,m===1&&852<rt||m===2&&592<rt)return 1;w[S=N&F]=tt<<24|Z<<16|$-p|0}}return N!==0&&(w[$+N]=C-et<<24|64<<16|0),d.bits=tt,0}},{"../utils/common":41}],51:[function(t,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,n,i){var s=t("../utils/common"),o=0,a=1;function l(k){for(var E=k.length;0<=--E;)k[E]=0}var c=0,m=29,g=256,b=g+1+m,f=30,w=19,p=2*b+1,v=15,d=16,_=7,y=256,S=16,F=17,$=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(b+2));l(J);var C=new Array(2*f);l(C);var B=new Array(512);l(B);var h=new Array(256);l(h);var L=new Array(m);l(L);var tt,Z,et,H=new Array(f);function rt(k,E,W,G,T){this.static_tree=k,this.extra_bits=E,this.extra_base=W,this.elems=G,this.max_length=T,this.has_stree=k&&k.length}function N(k,E){this.dyn_tree=k,this.max_code=0,this.stat_desc=E}function j(k){return k<256?B[k]:B[256+(k>>>7)]}function M(k,E){k.pending_buf[k.pending++]=255&E,k.pending_buf[k.pending++]=E>>>8&255}function X(k,E,W){k.bi_valid>d-W?(k.bi_buf|=E<<k.bi_valid&65535,M(k,k.bi_buf),k.bi_buf=E>>d-k.bi_valid,k.bi_valid+=W-d):(k.bi_buf|=E<<k.bi_valid&65535,k.bi_valid+=W)}function q(k,E,W){X(k,W[2*E],W[2*E+1])}function ut(k,E){for(var W=0;W|=1&k,k>>>=1,W<<=1,0<--E;);return W>>>1}function wt(k,E,W){var G,T,K=new Array(v+1),Q=0;for(G=1;G<=v;G++)K[G]=Q=Q+W[G-1]<<1;for(T=0;T<=E;T++){var Y=k[2*T+1];Y!==0&&(k[2*T]=ut(K[Y]++,Y))}}function it(k){var E;for(E=0;E<b;E++)k.dyn_ltree[2*E]=0;for(E=0;E<f;E++)k.dyn_dtree[2*E]=0;for(E=0;E<w;E++)k.bl_tree[2*E]=0;k.dyn_ltree[2*y]=1,k.opt_len=k.static_len=0,k.last_lit=k.matches=0}function lt(k){8<k.bi_valid?M(k,k.bi_buf):0<k.bi_valid&&(k.pending_buf[k.pending++]=k.bi_buf),k.bi_buf=0,k.bi_valid=0}function vt(k,E,W,G){var T=2*E,K=2*W;return k[T]<k[K]||k[T]===k[K]&&G[E]<=G[W]}function dt(k,E,W){for(var G=k.heap[W],T=W<<1;T<=k.heap_len&&(T<k.heap_len&&vt(E,k.heap[T+1],k.heap[T],k.depth)&&T++,!vt(E,G,k.heap[T],k.depth));)k.heap[W]=k.heap[T],W=T,T<<=1;k.heap[W]=G}function Bt(k,E,W){var G,T,K,Q,Y=0;if(k.last_lit!==0)for(;G=k.pending_buf[k.d_buf+2*Y]<<8|k.pending_buf[k.d_buf+2*Y+1],T=k.pending_buf[k.l_buf+Y],Y++,G===0?q(k,T,E):(q(k,(K=h[T])+g+1,E),(Q=P[K])!==0&&X(k,T-=L[K],Q),q(k,K=j(--G),W),(Q=I[K])!==0&&X(k,G-=H[K],Q)),Y<k.last_lit;);q(k,y,E)}function Dt(k,E){var W,G,T,K=E.dyn_tree,Q=E.stat_desc.static_tree,Y=E.stat_desc.has_stree,nt=E.stat_desc.elems,ct=-1;for(k.heap_len=0,k.heap_max=p,W=0;W<nt;W++)K[2*W]!==0?(k.heap[++k.heap_len]=ct=W,k.depth[W]=0):K[2*W+1]=0;for(;k.heap_len<2;)K[2*(T=k.heap[++k.heap_len]=ct<2?++ct:0)]=1,k.depth[T]=0,k.opt_len--,Y&&(k.static_len-=Q[2*T+1]);for(E.max_code=ct,W=k.heap_len>>1;1<=W;W--)dt(k,K,W);for(T=nt;W=k.heap[1],k.heap[1]=k.heap[k.heap_len--],dt(k,K,1),G=k.heap[1],k.heap[--k.heap_max]=W,k.heap[--k.heap_max]=G,K[2*T]=K[2*W]+K[2*G],k.depth[T]=(k.depth[W]>=k.depth[G]?k.depth[W]:k.depth[G])+1,K[2*W+1]=K[2*G+1]=T,k.heap[1]=T++,dt(k,K,1),2<=k.heap_len;);k.heap[--k.heap_max]=k.heap[1],function(at,Pt){var me,Rt,ge,pt,Ee,We,Mt=Pt.dyn_tree,mn=Pt.max_code,vr=Pt.stat_desc.static_tree,br=Pt.stat_desc.has_stree,_r=Pt.stat_desc.extra_bits,gn=Pt.stat_desc.extra_base,we=Pt.stat_desc.max_length,Ae=0;for(pt=0;pt<=v;pt++)at.bl_count[pt]=0;for(Mt[2*at.heap[at.heap_max]+1]=0,me=at.heap_max+1;me<p;me++)we<(pt=Mt[2*Mt[2*(Rt=at.heap[me])+1]+1]+1)&&(pt=we,Ae++),Mt[2*Rt+1]=pt,mn<Rt||(at.bl_count[pt]++,Ee=0,gn<=Rt&&(Ee=_r[Rt-gn]),We=Mt[2*Rt],at.opt_len+=We*(pt+Ee),br&&(at.static_len+=We*(vr[2*Rt+1]+Ee)));if(Ae!==0){do{for(pt=we-1;at.bl_count[pt]===0;)pt--;at.bl_count[pt]--,at.bl_count[pt+1]+=2,at.bl_count[we]--,Ae-=2}while(0<Ae);for(pt=we;pt!==0;pt--)for(Rt=at.bl_count[pt];Rt!==0;)mn<(ge=at.heap[--me])||(Mt[2*ge+1]!==pt&&(at.opt_len+=(pt-Mt[2*ge+1])*Mt[2*ge],Mt[2*ge+1]=pt),Rt--)}}(k,E),wt(K,ct,k.bl_count)}function u(k,E,W){var G,T,K=-1,Q=E[1],Y=0,nt=7,ct=4;for(Q===0&&(nt=138,ct=3),E[2*(W+1)+1]=65535,G=0;G<=W;G++)T=Q,Q=E[2*(G+1)+1],++Y<nt&&T===Q||(Y<ct?k.bl_tree[2*T]+=Y:T!==0?(T!==K&&k.bl_tree[2*T]++,k.bl_tree[2*S]++):Y<=10?k.bl_tree[2*F]++:k.bl_tree[2*$]++,K=T,ct=(Y=0)===Q?(nt=138,3):T===Q?(nt=6,3):(nt=7,4))}function U(k,E,W){var G,T,K=-1,Q=E[1],Y=0,nt=7,ct=4;for(Q===0&&(nt=138,ct=3),G=0;G<=W;G++)if(T=Q,Q=E[2*(G+1)+1],!(++Y<nt&&T===Q)){if(Y<ct)for(;q(k,T,k.bl_tree),--Y!=0;);else T!==0?(T!==K&&(q(k,T,k.bl_tree),Y--),q(k,S,k.bl_tree),X(k,Y-3,2)):Y<=10?(q(k,F,k.bl_tree),X(k,Y-3,3)):(q(k,$,k.bl_tree),X(k,Y-11,7));K=T,ct=(Y=0)===Q?(nt=138,3):T===Q?(nt=6,3):(nt=7,4)}}l(H);var O=!1;function x(k,E,W,G){X(k,(c<<1)+(G?1:0),3),function(T,K,Q,Y){lt(T),M(T,Q),M(T,~Q),s.arraySet(T.pending_buf,T.window,K,Q,T.pending),T.pending+=Q}(k,E,W)}i._tr_init=function(k){O||(function(){var E,W,G,T,K,Q=new Array(v+1);for(T=G=0;T<m-1;T++)for(L[T]=G,E=0;E<1<<P[T];E++)h[G++]=T;for(h[G-1]=T,T=K=0;T<16;T++)for(H[T]=K,E=0;E<1<<I[T];E++)B[K++]=T;for(K>>=7;T<f;T++)for(H[T]=K<<7,E=0;E<1<<I[T]-7;E++)B[256+K++]=T;for(W=0;W<=v;W++)Q[W]=0;for(E=0;E<=143;)J[2*E+1]=8,E++,Q[8]++;for(;E<=255;)J[2*E+1]=9,E++,Q[9]++;for(;E<=279;)J[2*E+1]=7,E++,Q[7]++;for(;E<=287;)J[2*E+1]=8,E++,Q[8]++;for(wt(J,b+1,Q),E=0;E<f;E++)C[2*E+1]=5,C[2*E]=ut(E,5);tt=new rt(J,P,g+1,b,v),Z=new rt(C,I,0,f,v),et=new rt(new Array(0),D,0,w,_)}(),O=!0),k.l_desc=new N(k.dyn_ltree,tt),k.d_desc=new N(k.dyn_dtree,Z),k.bl_desc=new N(k.bl_tree,et),k.bi_buf=0,k.bi_valid=0,it(k)},i._tr_stored_block=x,i._tr_flush_block=function(k,E,W,G){var T,K,Q=0;0<k.level?(k.strm.data_type===2&&(k.strm.data_type=function(Y){var nt,ct=4093624447;for(nt=0;nt<=31;nt++,ct>>>=1)if(1&ct&&Y.dyn_ltree[2*nt]!==0)return o;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return a;for(nt=32;nt<g;nt++)if(Y.dyn_ltree[2*nt]!==0)return a;return o}(k)),Dt(k,k.l_desc),Dt(k,k.d_desc),Q=function(Y){var nt;for(u(Y,Y.dyn_ltree,Y.l_desc.max_code),u(Y,Y.dyn_dtree,Y.d_desc.max_code),Dt(Y,Y.bl_desc),nt=w-1;3<=nt&&Y.bl_tree[2*V[nt]+1]===0;nt--);return Y.opt_len+=3*(nt+1)+5+5+4,nt}(k),T=k.opt_len+3+7>>>3,(K=k.static_len+3+7>>>3)<=T&&(T=K)):T=K=W+5,W+4<=T&&E!==-1?x(k,E,W,G):k.strategy===4||K===T?(X(k,2+(G?1:0),3),Bt(k,J,C)):(X(k,4+(G?1:0),3),function(Y,nt,ct,at){var Pt;for(X(Y,nt-257,5),X(Y,ct-1,5),X(Y,at-4,4),Pt=0;Pt<at;Pt++)X(Y,Y.bl_tree[2*V[Pt]+1],3);U(Y,Y.dyn_ltree,nt-1),U(Y,Y.dyn_dtree,ct-1)}(k,k.l_desc.max_code+1,k.d_desc.max_code+1,Q+1),Bt(k,k.dyn_ltree,k.dyn_dtree)),it(k),G&&lt(k)},i._tr_tally=function(k,E,W){return k.pending_buf[k.d_buf+2*k.last_lit]=E>>>8&255,k.pending_buf[k.d_buf+2*k.last_lit+1]=255&E,k.pending_buf[k.l_buf+k.last_lit]=255&W,k.last_lit++,E===0?k.dyn_ltree[2*W]++:(k.matches++,E--,k.dyn_ltree[2*(h[W]+g+1)]++,k.dyn_dtree[2*j(E)]++),k.last_lit===k.lit_bufsize-1},i._tr_align=function(k){X(k,2,3),q(k,y,J),function(E){E.bi_valid===16?(M(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(k)}},{"../utils/common":41}],53:[function(t,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,n,i){(function(s){(function(o,a){if(!o.setImmediate){var l,c,m,g,b=1,f={},w=!1,p=o.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(o);v=v&&v.setTimeout?v:o,l={}.toString.call(o.process)==="[object process]"?function(S){process.nextTick(function(){_(S)})}:function(){if(o.postMessage&&!o.importScripts){var S=!0,F=o.onmessage;return o.onmessage=function(){S=!1},o.postMessage("","*"),o.onmessage=F,S}}()?(g="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",y,!1):o.attachEvent("onmessage",y),function(S){o.postMessage(g+S,"*")}):o.MessageChannel?((m=new MessageChannel).port1.onmessage=function(S){_(S.data)},function(S){m.port2.postMessage(S)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function(S){var F=p.createElement("script");F.onreadystatechange=function(){_(S),F.onreadystatechange=null,c.removeChild(F),F=null},c.appendChild(F)}):function(S){setTimeout(_,0,S)},v.setImmediate=function(S){typeof S!="function"&&(S=new Function(""+S));for(var F=new Array(arguments.length-1),$=0;$<F.length;$++)F[$]=arguments[$+1];var P={callback:S,args:F};return f[b]=P,l(b),b++},v.clearImmediate=d}function d(S){delete f[S]}function _(S){if(w)setTimeout(_,0,S);else{var F=f[S];if(F){w=!0;try{(function($){var P=$.callback,I=$.args;switch(I.length){case 0:P();break;case 1:P(I[0]);break;case 2:P(I[0],I[1]);break;case 3:P(I[0],I[1],I[2]);break;default:P.apply(a,I)}})(F)}finally{d(S),w=!1}}}}function y(S){S.source===o&&typeof S.data=="string"&&S.data.indexOf(g)===0&&_(+S.data.slice(g.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Wn);var Wr=Wn.exports;const wn=Ur(Wr);class Vr{constructor(e,t){this.app=e,this.settings=t}get maxBackups(){var e;return((e=this.settings)==null?void 0:e.maxBackups)??5}get maxBackupAgeDays(){var e;return((e=this.settings)==null?void 0:e.maxBackupAgeDays)??30}async createBackup(e,t){try{const n=this.app.vault.getAbstractFileByPath(e);if(!n||!(n instanceof A.TFolder))return z(`${R} Draft folder not found: ${e}`),!1;const i=this.getAllFilesInFolder(n);if(i.length===0)return z(`${R} No files to backup in: ${e}`),!1;const s=e.split("/")[0]||"unknown",o=e.split("/")[1]||"drafts",a=e.split("/").pop()||"unknown",l=`${ne(t)}/${s}/${o}/${a}`;await this.app.vault.adapter.exists(l)||await this.app.vault.createFolder(l);const m=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),g=`${a}_${m}${_e}`,b=`${l}/${g}`,f=new wn;for(const v of i){const d=v.path.substring(e.length+1),_=await this.app.vault.read(v);f.file(d,_)}const w=await f.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}),p=new Uint8Array(w).buffer;return await this.app.vault.createBinary(b,p),z(`${R} Created backup: ${b}`),!0}catch(n){return z(`${R} Failed to create backup:`,n),!1}}async listBackups(e,t){try{const n=e.split("/")[0]||"unknown",i=e.split("/")[1]||"drafts",s=e.split("/").pop()||"unknown",o=`${ne(t)}/${n}/${i}/${s}`,a=this.app.vault.getAbstractFileByPath(o);if(!a||!(a instanceof A.TFolder))return[];const l=e.split("/").pop()||"unknown",c=[];for(const m of a.children)if(m instanceof A.TFile&&m.name.startsWith(`${l}_`)&&m.name.endsWith(_e)){const g=m.name.match(Ln);g&&c.push(g[1])}return c.sort().reverse()}catch(n){return z(`${R} Failed to list backups:`,n),[]}}async restoreBackup(e,t,n){try{const i=e.split("/")[0]||"unknown",s=e.split("/")[1]||"drafts",o=e.split("/").pop()||"unknown",a=`${ne(n)}/${i}/${s}/${o}`,l=`${o}_${t}${_e}`,c=`${a}/${l}`;if(!await this.app.vault.adapter.stat(c))return z(`${R} Backup file not found: ${c}`),!1;const g=await this.app.vault.adapter.readBinary(c),b=await wn.loadAsync(g);this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e);for(const[w,p]of Object.entries(b.files))if(p.dir){const v=`${e}/${w}`;this.app.vault.getAbstractFileByPath(v)||await this.app.vault.createFolder(v)}else{const v=await p.async("text"),d=`${e}/${w}`,_=d.substring(0,d.lastIndexOf("/"));this.app.vault.getAbstractFileByPath(_)||await this.app.vault.createFolder(_);const y=this.app.vault.getAbstractFileByPath(d);y&&y instanceof A.TFile?await this.app.vault.modify(y,v):await this.app.vault.create(d,v)}return z(`${R} Restored backup: ${c}`),!0}catch(i){return z(`${R} Failed to restore backup:`,i),!1}}async deleteBackup(e,t,n){try{const i=e.split("/")[0]||"unknown",s=e.split("/")[1]||"drafts",o=e.split("/").pop()||"unknown",a=`${ne(n)}/${i}/${s}/${o}`,l=`${o}_${t}${_e}`,c=`${a}/${l}`;return await this.app.vault.adapter.stat(c)?(await this.app.vault.adapter.remove(c),z(`${R} Deleted backup: ${c}`),!0):(z(`${R} Backup file not found for deletion: ${c}`),!1)}catch(i){return z(`${R} Failed to delete backup:`,i),!1}}async clearOldBackups(e,t){try{const n=await this.listBackups(e,t),i=new Date;i.setDate(i.getDate()-this.maxBackupAgeDays);for(const s of n)new Date(s.replace(/-/g,":"))<i&&await this.deleteBackup(e,s,t)}catch(n){z(`${R} Failed to clear old backups:`,n)}}getAllFilesInFolder(e){const t=[];function n(i){for(const s of i.children)s instanceof A.TFile?t.push(s):s instanceof A.TFolder&&n(s)}return n(e),t}}class Zr{constructor(e){var t,n,i;this.app=e,this.manager=((i=(n=(t=this.app.plugins).getPlugin)==null?void 0:n.call(t,"obsidian-writeaid-plugin"))==null?void 0:i.manager)??null}async reorderChapters(e,t,n){const i=this.resolveProjectPath(e);if(!i)return!1;const s=this.getDraftsFolderName(i);if(!s)return!1;const o=`${i}/${s}/${t}`;for(let a=0;a<n.length;a++){const{chapterName:l}=n[a],c=`${o}/${l}${st}`,m=this.app.vault.getAbstractFileByPath(c);if(m&&m instanceof A.TFile){let g=await this.app.vault.read(m);g.match(Et)&&(g=g.replace(Et,(b,f)=>{let w=f.replace(/^order:.*\n?/gm,"");return w.endsWith(`
`)||(w+=`
`),w+=`order: ${a+1}
`,`${ht}
${w}${ht}`}),await this.app.vault.modify(m,g))}}return!0}async listChapters(e,t){z(`${R} ChapterFileService.listChapters: projectPath=${e}, draftName=${t}`);const n=this.resolveProjectPath(e);if(!n)return z(`${R} ChapterFileService.listChapters: no project resolved`),[];const i=this.getDraftsFolderName(n);if(!i)return z(`${R} ChapterFileService.listChapters: no drafts folder found in project ${n}`),[];const s=`${n}/${i}/${t}`;z(`${R} ChapterFileService.listChapters: resolved project=${n}, draftsFolder=${i}, draftFolder=${s}`);const o=this.app.vault.getAbstractFileByPath(s),a=[];if(o&&o instanceof A.TFolder){z(`${R} ChapterFileService.listChapters: found folder with ${o.children.length} children`);for(const l of o.children)l instanceof A.TFile&&l.extension===st.slice(1)&&(z(`${R} ChapterFileService.listChapters: processing file ${l.path}`),await bt(async()=>{const c=await this.app.vault.read(l);z(`${R} ChapterFileService.listChapters: content length ${c.length}`);const m=c.match(Et);let g,b;if(m){z(`${R} ChapterFileService.listChapters: found frontmatter`);const p=m[1].split(/\r?\n/);for(const v of p){const d=v.match(/^order:\s*(\d+)/i);d&&(g=parseInt(d[1],10));const _=v.match(/^chapter_name:\s*(.*)$/i);if(_){let y=_[1].trim();(y.startsWith('"')&&y.endsWith('"')||y.startsWith("'")&&y.endsWith("'"))&&(y=y.slice(1,-1)),y.length>0&&(b=y)}}}else z(`${R} ChapterFileService.listChapters: no frontmatter`);z(`${R} ChapterFileService.listChapters: parsed order=${g}, chapterName=${b}`);const f=b&&b.length>0?b:l.name.replace(new RegExp(`\\${st}$`),""),w=typeof g=="number"&&!isNaN(g)?g:0;z(`${R} ChapterFileService.listChapters: adding chapter ${l.name} with name ${f}, order ${w}`),a.push({name:l.name.replace(new RegExp(`\\${st}$`),""),chapterName:f,order:w})}))}else z(`${R} ChapterFileService.listChapters: no folder found`);return a.sort((l,c)=>l.order-c.order),z(`${R} ChapterFileService.listChapters: returning ${a.length} chapters`),a.map(({name:l,chapterName:c})=>({name:l,chapterName:c}))}async createChapter(e,t,n,i){const s=this.resolveProjectPath(e);if(!s)return!1;const o=this.getDraftsFolderName(s);if(!o)return!1;const a=`${s}/${o}/${t}`,c=`${At(n,i==null?void 0:i.slugStyle)}${st}`,m=`${a}/${c}`;if(this.app.vault.getAbstractFileByPath(m))return!1;let g=0;const b=this.app.vault.getAbstractFileByPath(a);if(b&&b instanceof A.TFolder)for(const v of b.children)v instanceof A.TFile&&v.extension===st.slice(1)&&await bt(async()=>{const _=(await this.app.vault.read(v)).match(Et);if(_){const y=_[1].split(/\r?\n/);for(const S of y){const F=S.match(/^order:\s*(\d+)/i);if(F){const $=parseInt(F[1],10);!isNaN($)&&$>g&&(g=$)}}}});const f=g+1;let w=`# ${n}`;const p=`${ht}
order: ${f}
chapter_name: ${JSON.stringify(n)}
${ht}
`;return await this.app.vault.create(m,`${p}
${w}

`),!0}async deleteChapter(e,t,n){const i=this.resolveProjectPath(e);if(!i)return!1;const s=this.getDraftsFolderName(i);if(!s)return!1;const o=`${i}/${s}/${t}`,a=`${n}${st}`,l=`${o}/${a}`,c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof A.TFile){await this.app.vault.delete(c);const m=await this.listChapters(e,t);for(let g=0;g<m.length;g++){const{name:b}=m[g],f=`${o}/${b}${st}`,w=this.app.vault.getAbstractFileByPath(f);if(w&&w instanceof A.TFile){let p=await this.app.vault.read(w);p.match(Et)&&(p=p.replace(Et,(v,d)=>{let _=d.replace(/^order:.*\n?/gm,"");return _.endsWith(`
`)||(_+=`
`),_+=`order: ${g+1}
`,`${ht}
${_}${ht}`}),await this.app.vault.modify(w,p))}}return!0}return!1}async renameChapter(e,t,n,i){const s=this.resolveProjectPath(e);if(!s)return!1;const o=this.getDraftsFolderName(s);if(!o)return!1;const a=`${s}/${o}/${t}`,l=`${a}/${n}${st}`,c=`${a}/${i}${st}`,m=this.app.vault.getAbstractFileByPath(l);if(!m||!(m instanceof A.TFile))return!1;let g=await this.app.vault.read(m),b=`# ${i}`;return g.match(Et)&&(g=g.replace(Et,(f,w)=>{let p=w.replace(/^chapter_name:.*\n?/gm,"");return p.endsWith(`
`)||(p+=`
`),p+=`chapter_name: ${JSON.stringify(i)}
`,`${ht}
${p}${ht}`})),g=g.replace(/^#.*$/m,b),n!==i?(await this.app.vault.create(c,g),await this.app.vault.delete(m)):await this.app.vault.modify(m,g),!0}async openChapter(e,t,n){const i=this.resolveProjectPath(e);if(!i)return!1;const s=this.getDraftsFolderName(i);if(!s)return!1;const o=`${i}/${s}/${t}/${n}${st}`,a=this.app.vault.getAbstractFileByPath(o);return a&&a instanceof A.TFile?(await bt(async()=>{await this.app.workspace.getLeaf().openFile(a)}),!0):!1}resolveProjectPath(e){var t;return e||((t=this.manager)==null?void 0:t.activeProject)||null}getDraftsFolderName(e){var i;const t=this.app.vault.getAbstractFileByPath(e),n=mt((i=this.manager)==null?void 0:i.settings);if(t&&t instanceof A.TFolder){for(const s of t.children)if(s instanceof A.TFolder&&s.name.toLowerCase()===n.toLowerCase())return s.name}return null}}class Vn{constructor(e){this.app=e,z(`${R} TemplateService created`)}async render(e,t={}){let n=e||"";return z(`${R} TemplateService.render called with template: "${n.substring(0,100)}${n.length>100?"...":""}", vars:`,Object.keys(t)),!n.includes("{{")&&!n.includes("}}")?(z(`${R} Template doesn't contain template syntax, checking if it's a file path`),await bt(async()=>{const i=this.app.vault.getAbstractFileByPath(n);i&&i instanceof A.TFile?(z(`${R} Reading template from file: ${n}`),n=await this.app.vault.read(i),z(`${R} Template loaded from file, length: ${n.length} chars`)):z(`${R} Template path "${n}" is not a valid file, treating as inline template`)})):z(`${R} Template contains template syntax, treating as inline template`),z(`${R} Performing template variable substitution`),n=n.replace(/{{\s*(\w+(?:[-:]\w+)*)\s*}}/g,(i,s)=>{if(t[s]!==void 0)return z(`${R} Substituting variable {{${s}}} with provided value: "${t[s]}"`),t[s];try{const o=window.moment().format(s);return z(`${R} Substituting {{${s}}} with moment.js format: "${o}"`),o}catch{return z(`${R} Neither variable nor moment.js format found for {{${s}}}, returning as-is`),s}}),z(`${R} Template rendering complete, result length: ${n.length} chars`),n}}class Oe{constructor(e){var t,n,i;this.app=e,this.manager=((i=(n=(t=this.app.plugins).getPlugin)==null?void 0:n.call(t,"obsidian-writeaid-plugin"))==null?void 0:i.manager)??null,this.tpl=new Vn(e),this.projectFileService=new cn(e,this)}async createProject(e,t,n,i,s){if(!e)return new A.Notice("Project name is required."),null;const o=i&&i!==""?`${i}/${e}`:e,a=`${o}/${mt(s)}`;this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o),this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a);const l=`${o}/${jt(s)}`;if(!this.app.vault.getAbstractFileByPath(l)){const m=t?Ct.SINGLE:Ct.MULTI,g=t?(s==null?void 0:s.defaultSingleTargetWordCount)??2e4:(s==null?void 0:s.defaultMultiTargetWordCount)??5e4,b=`${ht}
project_type: ${m}
target_word_count: ${g}
${ht}
`;await this.app.vault.create(l,b)}const c=n||"Draft 1";return await this.projectFileService.drafts.createDraft(c,void 0,o,s),o}async openProject(e){var o,a;const t=`${e}/${jt((o=this.manager)==null?void 0:o.settings)}`,n=this.app.vault.getAbstractFileByPath(t);if(n&&n instanceof A.TFile)return await this.app.workspace.getLeaf().openFile(n),!0;const i=re((a=this.manager)==null?void 0:a.settings),s=[`${e}/${e}${st}`,`${e}/Chapter 1${st}`,`${e}/Chapter 01${st}`,`${e}/${i}`,`${e}/${mt()}/Draft 1/${i}`];for(const l of s){const c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof A.TFile)return await this.app.workspace.getLeaf().openFile(c),!0}return new A.Notice("Could not find a file to open in the project."),!1}listAllFolders(){const e=this.app.vault.getRoot(),t=[""];function n(i){for(const s of i.children)s instanceof A.TFolder&&(t.push(s.path),n(s))}return n(e),t}async listProjects(){const e=this.listAllFolders(),t=e.filter(i=>!!i);z(`${R} allFolders:`,e),z(`${R} filteredFolders:`,t);const n=await ae(t,i=>this.isProjectFolder(i));return z(`${R} found ${t.length} folders, ${n.length} projects:`,n),n}async getProjectType(e){const t=`${e}/${jt()}`,n=await Qt(this.app,t);if(n&&n.project_type){const i=n.project_type;if(Object.values(Ct).includes(i))return i}return null}getDraftsFolder(e){const t=`${e}/${mt()}`;let n=this.app.vault.getAbstractFileByPath(t);if(n&&n instanceof A.TFolder)return n;const i=`${e}/Drafts`;return n=this.app.vault.getAbstractFileByPath(i),n&&n instanceof A.TFolder?n:null}async getManuscriptsFolder(e){const t=`${e}/${on()}`,n=this.app.vault.getAbstractFileByPath(t);return n&&n instanceof A.TFolder?n:null}async isProjectFolder(e){if(!e||typeof e!="string")return!1;const t=e.trim().replace(/\\/g,"/").replace(/\/+$/,"");try{const n=A.normalizePath(`${t}/${jt()}`),i=await this.app.vault.adapter.exists(n),s=A.normalizePath(`${t}/${mt()}`);let o=await this.app.vault.adapter.exists(s);if(!o){const a=A.normalizePath(`${t}/Drafts`);o=await this.app.vault.adapter.exists(a)}if(!i&&!o)return!1;if(i)try{const{readMetaFile:a}=await Promise.resolve().then(()=>Xe),{VALID_PROJECT_TYPES:l}=await Promise.resolve().then(()=>Sr),c=await a(this.app,n);if(!c||!l.includes(c.project_type))return!1}catch{return!1}return!0}catch{return!1}}}class Hr{constructor(e,t,n,i){var s,o,a;this.app=e,this.tpl=new Vn(e),this.projectSvc=n,this.backupSvc=i,this.chapters=t,this.manager=((a=(o=(s=this.app.plugins).getPlugin)==null?void 0:o.call(s,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null}resolveProjectPath(e){var t;return e||((t=this.manager)==null?void 0:t.activeProject)||null}getDraftsFolderName(e){var i;const t=this.app.vault.getAbstractFileByPath(e),n=mt((i=this.manager)==null?void 0:i.settings);if(t&&t instanceof A.TFolder){for(const s of t.children)if(s instanceof A.TFolder&&s.name.toLowerCase()===n.toLowerCase())return s.name}return null}async suggestNextDraftName(e){var s;const t=this.resolveProjectPath(e);if(!t)return"Draft 1";const n=`${t}/${jt((s=this.manager)==null?void 0:s.settings)}`;let i=0;return await bt(async()=>{const o=await Qt(this.app,n);o&&typeof o.total_drafts=="number"&&(i=o.total_drafts)}),`Draft ${i+1}`}async createDraft(e,t,n,i){var g,b,f;const s=this.resolveProjectPath(n);if(!s){new A.Notice("No project folder detected. Please open a folder named after your project.");return}const a=this.getDraftsFolderName(s)||mt((g=this.manager)==null?void 0:g.settings),l=`${s}/${a}`,c=`${l}/${e}`,m=s.split("/").pop()||s;if(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),t){const w=`${l}/${t}`,p=this.app.vault.getFiles().filter(_=>_.path.startsWith(w)),d=`${At(t,i==null?void 0:i.slugStyle)}${st}`;for(const _ of p){let y=_.path.substring(w.length+1);y===d&&(y=`${At(e,i==null?void 0:i.slugStyle)}${st}`);const S=`${c}/${y}`,F=S.substring(0,S.lastIndexOf("/"));F!==c&&!this.app.vault.getAbstractFileByPath(F)&&await this.app.vault.createFolder(F);let $=await this.app.vault.read(_);$=Yr($,e,m),await this.app.vault.create(S,$)}}else{if((i==null?void 0:i.includeDraftOutline)===!0){const v=(i==null?void 0:i.outlineTemplate)??"",d=await this.tpl.render(v,{draftName:e});await this.app.vault.create(`${c}/${re((b=this.manager)==null?void 0:b.settings)}`,d)}if(await this.projectSvc.getProjectType(s)===Ct.SINGLE){const d=`${At(e,i==null?void 0:i.slugStyle)}${st}`,_=`${c}/${d}`;if(!this.app.vault.getAbstractFileByPath(_)){const y=`${ht}
draft: ${e}
project: ${m}
created: ${new Date().toISOString()}
${ht}

`,S=await this.tpl.render("# {{draftName}}",{draftName:e});await this.app.vault.create(_,y+S)}}else{const v=this.app.vault.getAbstractFileByPath(c);let d=!1;if(v&&v instanceof A.TFolder){for(const _ of v.children)if(_ instanceof A.TFile&&_.extension===st.slice(1)&&(await bt(async()=>{const S=(await this.app.vault.read(_)).match(Et);if(S){const F=S[1].split(/\r?\n/);for(const $ of F){const P=$.match(/^order:\s*(\d+)/i);if(P&&!isNaN(parseInt(P[1],10))){d=!0;break}}}}),d))break}d||await this.chapters.createChapter(s,e,"Chapter 1",i)}}await ie(this.app,s,e,void 0,(f=this.manager)==null?void 0:f.settings)}listDrafts(e){var i;const t=this.resolveProjectPath(e);if(z(`${R} listDrafts called with projectPath:`,e,"resolved to:",t),!t)return[];const n=this.projectSvc.getDraftsFolder(t);if(z(`${R} getDraftsFolder for ${t} returned:`,n==null?void 0:n.path,(i=n==null?void 0:n.children)==null?void 0:i.length),n&&n instanceof A.TFolder){const s=n.children.filter(o=>o instanceof A.TFolder).map(o=>o.name);return z(`${R} found drafts:`,s),s}return[]}async openDraft(e,t){var m;const n=this.resolveProjectPath(e);if(!n)return!1;const i=this.getDraftsFolderName(n);if(!i)return!1;const s=`${n}/${i}/${t}/${re((m=this.manager)==null?void 0:m.settings)}`,o=this.app.vault.getAbstractFileByPath(s);if(await bt(async()=>o&&o instanceof A.TFile?(await this.app.workspace.getLeaf().openFile(o),!0):!1))return!0;const l=`${n}/${i}/${t}`,c=this.app.vault.getFiles().filter(g=>g.path.startsWith(l));return c.length>0?(await this.app.workspace.getLeaf().openFile(c[0]),!0):!1}async renameDraft(e,t,n,i=!1,s){var m;const o=this.resolveProjectPath(e);if(!o)return!1;const a=this.getDraftsFolderName(o);if(!a)return!1;const l=`${o}/${a}/${t}`,c=`${o}/${a}/${n}`;try{this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c);const g=this.app.vault.getFiles().filter(d=>d.path.startsWith(l));let b="",f="";if(i){const d=s==null?void 0:s.slugStyle;b=At(t,d),f=At(n,d)}for(const d of g){let _=d.path.substring(l.length+1),y=`${c}/${_}`;i&&b&&f&&_===`${b}${st}`&&(_=`${f}${st}`,y=`${c}/${_}`);let S=await this.app.vault.read(d);d.extension===st.slice(1)&&(S=S.replace(new RegExp(`^(${ht}\\s*\\n[\\s\\S]*?\\n)(draft:.*\\n)?`,"m"),(F,$)=>$.replace(/^draft:.*\n/m,"").replace(new RegExp(`^(${ht}\\s*\\n)`),`$1draft: ${n}
`))),await this.app.vault.create(y,S),await this.app.vault.delete(d)}const w=this.app.vault.getAbstractFileByPath(l);w&&w instanceof A.TFolder&&await this.app.vault.delete(w,!0),await bt(async()=>{await Promise.resolve().then(()=>Xe).then(d=>{var _;return d.updateMetaStats(this.app,o,n,void 0,(_=this.manager)==null?void 0:_.settings)})});const p=`${c}/${jt((m=this.manager)==null?void 0:m.settings)}`;return this.app.vault.getAbstractFileByPath(p)&&await bt(async()=>{const{readMetaFile:d,writeMetaFile:_}=await Promise.resolve().then(()=>Xe),y=await d(this.app,p);y&&(y.draft=n,await _(this.app,p,y))}),!0}catch{return!1}}async deleteDraft(e,t,n=!0){var a;const i=this.resolveProjectPath(e);if(!i)return!1;const s=this.getDraftsFolderName(i);if(!s)return!1;const o=`${i}/${s}/${t}`;try{const l=this.app.vault.getFiles().filter(m=>m.path.startsWith(o));n&&await this.backupSvc.createBackup(o,(a=this.manager)==null?void 0:a.settings);for(const m of l)await bt(async()=>{await this.app.vault.delete(m)});const c=this.app.vault.getAbstractFileByPath(o);return c&&c instanceof A.TFolder&&await bt(async()=>{await this.app.vault.delete(c)}),!0}catch{return!1}}async generateManuscript(e,t,n){var p;const i=this.resolveProjectPath(e);if(!i)return!1;const s=this.getDraftsFolderName(i);if(!s)return!1;const o=await this.projectSvc.getProjectType(i),a=`${i}/${s}/${t}`;if(!this.app.vault.getAbstractFileByPath(a))return new A.Notice(`Draft folder ${a} does not exist.`),!1;const l=`${i}/${on((p=this.manager)==null?void 0:p.settings)}`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);const c=i.split("/").pop()||i,m=(n==null?void 0:n.manuscriptNameTemplate)||"{{draftName}}";z(`${R} DraftFileService.generateManuscript - manuscriptNameTemplate: "${m}"`),z(`${R} DraftFileService.generateManuscript - settings object:`,n);const g=At(t,n==null?void 0:n.slugStyle),b=await this.tpl.render(m,{draftName:t,projectName:c,draftSlug:g}),f=`${l}/${b}${st}`;let w=`# Manuscript for ${t}

`;if(o===Ct.SINGLE){const v=`${g}${st}`,d=`${a}/${v}`,_=this.app.vault.getAbstractFileByPath(d);if(_&&_ instanceof A.TFile){const y=await this.app.vault.read(_);w+=Kr(Gr(y));const S=this.app.vault.getAbstractFileByPath(f);if(S&&S instanceof A.TFile){if(!await new Un(this.app,f).open())return!1;z(`${R} Overwriting existing manuscript: ${f}`),await this.app.vault.modify(S,w)}else z(`${R} Creating new manuscript: ${f}`),await this.app.vault.create(f,w)}else return new A.Notice(`Main draft file ${d} not found.`),!1}return!0}getOutlineFile(e,t){var a;const n=this.resolveProjectPath(e);if(!n)return null;const i=this.getDraftsFolderName(n);if(!i)return null;const s=`${n}/${i}/${t}/${re((a=this.manager)==null?void 0:a.settings)}`,o=this.app.vault.getAbstractFileByPath(s);return o&&o instanceof A.TFile?o:null}async createOutline(e,t,n){var m;const i=this.resolveProjectPath(e);if(!i)throw new Error("Project not found");const s=this.getDraftsFolderName(i);if(!s)throw new Error("Drafts folder not found");const a=`${`${i}/${s}/${t}`}/${re((m=this.manager)==null?void 0:m.settings)}`;if(this.app.vault.getAbstractFileByPath(a))throw new Error("Outline file already exists");const c=await this.tpl.render(n,{draftName:t});await this.app.vault.create(a,c)}}function Gr(r){return r.replace(Et,"").trim()}function Kr(r){return r.replace(/^#{1,6} .*\n/,"").trim()}function Yr(r,e,t){const n=r.match(Et);if(!n)return r;const i=n[1],s=r.substring(n[0].length),o=i.split(`
`),a=[];for(const c of o)c.match(/^draft:/i)?a.push(`draft: ${e}`):c.match(/^project:/i)?a.push(`project: ${t}`):c.match(/^created:/i)?a.push(`created: ${new Date().toISOString()}`):a.push(c);const l=a.join(`
`);return`${ht}
${l}
${ht}${s}`}class cn{constructor(e,t,n){this.chapters=new Zr(e),this.backups=new Vr(e,n),this.drafts=new Hr(e,this.chapters,t,this.backups)}}function Vt(){}function Zn(r){return r()}function vn(){return Object.create(null)}function Gt(r){r.forEach(Zn)}function Hn(r){return typeof r=="function"}function Gn(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function qr(r){return Object.keys(r).length===0}function _t(r,e){r.appendChild(e)}function kt(r,e,t){r.insertBefore(e,t||null)}function yt(r){r.parentNode&&r.parentNode.removeChild(r)}function gt(r){return document.createElement(r)}function Se(r){return document.createTextNode(r)}function Yt(){return Se(" ")}function Xr(){return Se("")}function ue(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function ot(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function Jr(r){return Array.from(r.childNodes)}function un(r,e){e=""+e,r.data!==e&&(r.data=e)}function Te(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,"")}function $t(r,e,t){r.classList.toggle(e,!!t)}let ke;function ye(r){ke=r}function Kn(){if(!ke)throw new Error("Function called outside component initialization");return ke}function Qr(r){Kn().$$.on_mount.push(r)}function Je(r){Kn().$$.on_destroy.push(r)}const ee=[],se=[];let oe=[];const Qe=[],ti=Promise.resolve();let tn=!1;function ei(){tn||(tn=!0,ti.then(Yn))}function en(r){oe.push(r)}function ni(r){Qe.push(r)}const Ze=new Set;let te=0;function Yn(){if(te!==0)return;const r=ke;do{try{for(;te<ee.length;){const e=ee[te];te++,ye(e),ri(e.$$)}}catch(e){throw ee.length=0,te=0,e}for(ye(null),ee.length=0,te=0;se.length;)se.pop()();for(let e=0;e<oe.length;e+=1){const t=oe[e];Ze.has(t)||(Ze.add(t),t())}oe.length=0}while(ee.length);for(;Qe.length;)Qe.pop()();tn=!1,Ze.clear(),ye(r)}function ri(r){if(r.fragment!==null){r.update(),Gt(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(en)}}function ii(r){const e=[],t=[];oe.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),oe=e}const je=new Set;let qt;function ai(){qt={r:0,c:[],p:qt}}function si(){qt.r||Gt(qt.c),qt=qt.p}function le(r,e){r&&r.i&&(je.delete(r),r.i(e))}function nn(r,e,t,n){if(r&&r.o){if(je.has(r))return;je.add(r),qt.c.push(()=>{je.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function bn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function oi(r,e){r.d(1),e.delete(r.key)}function li(r,e,t,n,i,s,o,a,l,c,m,g){let b=r.length,f=s.length,w=b;const p={};for(;w--;)p[r[w].key]=w;const v=[],d=new Map,_=new Map,y=[];for(w=f;w--;){const P=g(i,s,w),I=t(P);let D=o.get(I);D?y.push(()=>D.p(P,e)):(D=c(I,P),D.c()),d.set(I,v[w]=D),I in p&&_.set(I,Math.abs(w-p[I]))}const S=new Set,F=new Set;function $(P){le(P,1),P.m(a,m),o.set(P.key,P),m=P.first,f--}for(;b&&f;){const P=v[f-1],I=r[b-1],D=P.key,V=I.key;P===I?(m=P.first,b--,f--):d.has(V)?!o.has(D)||S.has(D)?$(P):F.has(V)?b--:_.get(D)>_.get(V)?(F.add(D),$(P)):(S.add(V),b--):(l(I,o),b--)}for(;b--;){const P=r[b];d.has(P.key)||l(P,o)}for(;f;)$(v[f-1]);return Gt(y),v}function ci(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function ui(r){r&&r.c()}function qn(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),en(()=>{const s=r.$$.on_mount.map(Zn).filter(Hn);r.$$.on_destroy?r.$$.on_destroy.push(...s):Gt(s),r.$$.on_mount=[]}),i.forEach(en)}function Xn(r,e){const t=r.$$;t.fragment!==null&&(ii(t.after_update),Gt(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function fi(r,e){r.$$.dirty[0]===-1&&(ee.push(r),ei(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Jn(r,e,t,n,i,s,o=null,a=[-1]){const l=ke;ye(r);const c=r.$$={fragment:null,ctx:[],props:s,update:Vt,not_equal:i,bound:vn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:vn(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let m=!1;if(c.ctx=t?t(r,e.props||{},(g,b,...f)=>{const w=f.length?f[0]:b;return c.ctx&&i(c.ctx[g],c.ctx[g]=w)&&(!c.skip_bound&&c.bound[g]&&c.bound[g](w),m&&fi(r,g)),b}):[],c.update(),m=!0,Gt(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const g=Jr(e.target);c.fragment&&c.fragment.l(g),g.forEach(yt)}else c.fragment&&c.fragment.c();e.intro&&le(r.$$.fragment),qn(r,e.target,e.anchor),Yn()}ye(l)}class Qn{constructor(){Ve(this,"$$");Ve(this,"$$set")}$destroy(){Xn(this,1),this.$destroy=Vt}$on(e,t){if(!Hn(t))return Vt;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!qr(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const hi="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(hi);const fe=Math.min,St=Math.max,Be=Math.round,De=Math.floor,zt=r=>({x:r,y:r}),di={left:"right",right:"left",bottom:"top",top:"bottom"},pi={start:"end",end:"start"};function _n(r,e,t){return St(r,fe(e,t))}function Ce(r,e){return typeof r=="function"?r(e):r}function Zt(r){return r.split("-")[0]}function Fe(r){return r.split("-")[1]}function tr(r){return r==="x"?"y":"x"}function er(r){return r==="y"?"height":"width"}const mi=new Set(["top","bottom"]);function Ut(r){return mi.has(Zt(r))?"y":"x"}function nr(r){return tr(Ut(r))}function gi(r,e,t){t===void 0&&(t=!1);const n=Fe(r),i=nr(r),s=er(i);let o=i==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Re(o)),[o,Re(o)]}function wi(r){const e=Re(r);return[rn(r),e,rn(e)]}function rn(r){return r.replace(/start|end/g,e=>pi[e])}const yn=["left","right"],kn=["right","left"],vi=["top","bottom"],bi=["bottom","top"];function _i(r,e,t){switch(r){case"top":case"bottom":return t?e?kn:yn:e?yn:kn;case"left":case"right":return e?vi:bi;default:return[]}}function yi(r,e,t,n){const i=Fe(r);let s=_i(Zt(r),t==="start",n);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(rn)))),s}function Re(r){return r.replace(/left|right|bottom|top/g,e=>di[e])}function ki(r){return{top:0,right:0,bottom:0,left:0,...r}}function xi(r){return typeof r!="number"?ki(r):{top:r,right:r,bottom:r,left:r}}function ze(r){const{x:e,y:t,width:n,height:i}=r;return{width:n,height:i,top:t,left:e,right:e+n,bottom:t+i,x:e,y:t}}function xn(r,e,t){let{reference:n,floating:i}=r;const s=Ut(e),o=nr(e),a=er(o),l=Zt(e),c=s==="y",m=n.x+n.width/2-i.width/2,g=n.y+n.height/2-i.height/2,b=n[a]/2-i[a]/2;let f;switch(l){case"top":f={x:m,y:n.y-i.height};break;case"bottom":f={x:m,y:n.y+n.height};break;case"right":f={x:n.x+n.width,y:g};break;case"left":f={x:n.x-i.width,y:g};break;default:f={x:n.x,y:n.y}}switch(Fe(e)){case"start":f[o]-=b*(t&&c?-1:1);break;case"end":f[o]+=b*(t&&c?-1:1);break}return f}const Si=async(r,e,t)=>{const{placement:n="bottom",strategy:i="absolute",middleware:s=[],platform:o}=t,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:r,floating:e,strategy:i}),{x:m,y:g}=xn(c,n,l),b=n,f={},w=0;for(let p=0;p<a.length;p++){const{name:v,fn:d}=a[p],{x:_,y,data:S,reset:F}=await d({x:m,y:g,initialPlacement:n,placement:b,strategy:i,middlewareData:f,rects:c,platform:o,elements:{reference:r,floating:e}});m=_??m,g=y??g,f={...f,[v]:{...f[v],...S}},F&&w<=50&&(w++,typeof F=="object"&&(F.placement&&(b=F.placement),F.rects&&(c=F.rects===!0?await o.getElementRects({reference:r,floating:e,strategy:i}):F.rects),{x:m,y:g}=xn(c,b,l)),p=-1)}return{x:m,y:g,placement:b,strategy:i,middlewareData:f}};async function fn(r,e){var t;e===void 0&&(e={});const{x:n,y:i,platform:s,rects:o,elements:a,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:m="viewport",elementContext:g="floating",altBoundary:b=!1,padding:f=0}=Ce(e,r),w=xi(f),v=a[b?g==="floating"?"reference":"floating":g],d=ze(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(v)))==null||t?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:m,strategy:l})),_=g==="floating"?{x:n,y:i,width:o.floating.width,height:o.floating.height}:o.reference,y=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),S=await(s.isElement==null?void 0:s.isElement(y))?await(s.getScale==null?void 0:s.getScale(y))||{x:1,y:1}:{x:1,y:1},F=ze(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:y,strategy:l}):_);return{top:(d.top-F.top+w.top)/S.y,bottom:(F.bottom-d.bottom+w.bottom)/S.y,left:(d.left-F.left+w.left)/S.x,right:(F.right-d.right+w.right)/S.x}}const Ci=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,n;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:m=!0,crossAxis:g=!0,fallbackPlacements:b,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:w="none",flipAlignment:p=!0,...v}=Ce(r,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const d=Zt(i),_=Ut(a),y=Zt(a)===a,S=await(l.isRTL==null?void 0:l.isRTL(c.floating)),F=b||(y||!p?[Re(a)]:wi(a)),$=w!=="none";!b&&$&&F.push(...yi(a,p,w,S));const P=[a,...F],I=await fn(e,v),D=[];let V=((n=s.flip)==null?void 0:n.overflows)||[];if(m&&D.push(I[d]),g){const h=gi(i,o,S);D.push(I[h[0]],I[h[1]])}if(V=[...V,{placement:i,overflows:D}],!D.every(h=>h<=0)){var J,C;const h=(((J=s.flip)==null?void 0:J.index)||0)+1,L=P[h];if(L&&(!(g==="alignment"?_!==Ut(L):!1)||V.every(et=>Ut(et.placement)===_?et.overflows[0]>0:!0)))return{data:{index:h,overflows:V},reset:{placement:L}};let tt=(C=V.filter(Z=>Z.overflows[0]<=0).sort((Z,et)=>Z.overflows[1]-et.overflows[1])[0])==null?void 0:C.placement;if(!tt)switch(f){case"bestFit":{var B;const Z=(B=V.filter(et=>{if($){const H=Ut(et.placement);return H===_||H==="y"}return!0}).map(et=>[et.placement,et.overflows.filter(H=>H>0).reduce((H,rt)=>H+rt,0)]).sort((et,H)=>et[1]-H[1])[0])==null?void 0:B[0];Z&&(tt=Z);break}case"initialPlacement":tt=a;break}if(i!==tt)return{reset:{placement:tt}}}return{}}}},Fi=new Set(["left","top"]);async function Pi(r,e){const{placement:t,platform:n,elements:i}=r,s=await(n.isRTL==null?void 0:n.isRTL(i.floating)),o=Zt(t),a=Fe(t),l=Ut(t)==="y",c=Fi.has(o)?-1:1,m=s&&l?-1:1,g=Ce(e,r);let{mainAxis:b,crossAxis:f,alignmentAxis:w}=typeof g=="number"?{mainAxis:g,crossAxis:0,alignmentAxis:null}:{mainAxis:g.mainAxis||0,crossAxis:g.crossAxis||0,alignmentAxis:g.alignmentAxis};return a&&typeof w=="number"&&(f=a==="end"?w*-1:w),l?{x:f*m,y:b*c}:{x:b*c,y:f*m}}const Ei=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,n;const{x:i,y:s,placement:o,middlewareData:a}=e,l=await Pi(e,r);return o===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},Ai=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:n,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:v=>{let{x:d,y:_}=v;return{x:d,y:_}}},...l}=Ce(r,e),c={x:t,y:n},m=await fn(e,l),g=Ut(Zt(i)),b=tr(g);let f=c[b],w=c[g];if(s){const v=b==="y"?"top":"left",d=b==="y"?"bottom":"right",_=f+m[v],y=f-m[d];f=_n(_,f,y)}if(o){const v=g==="y"?"top":"left",d=g==="y"?"bottom":"right",_=w+m[v],y=w-m[d];w=_n(_,w,y)}const p=a.fn({...e,[b]:f,[g]:w});return{...p,data:{x:p.x-t,y:p.y-n,enabled:{[b]:s,[g]:o}}}}}},$i=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){var t,n;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Ce(r,e),m=await fn(e,c),g=Zt(i),b=Fe(i),f=Ut(i)==="y",{width:w,height:p}=s.floating;let v,d;g==="top"||g==="bottom"?(v=g,d=b===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(d=g,v=b==="end"?"top":"bottom");const _=p-m.top-m.bottom,y=w-m.left-m.right,S=fe(p-m[v],_),F=fe(w-m[d],y),$=!e.middlewareData.shift;let P=S,I=F;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(I=y),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(P=_),$&&!b){const V=St(m.left,0),J=St(m.right,0),C=St(m.top,0),B=St(m.bottom,0);f?I=w-2*(V!==0||J!==0?V+J:St(m.left,m.right)):P=p-2*(C!==0||B!==0?C+B:St(m.top,m.bottom))}await l({...e,availableWidth:I,availableHeight:P});const D=await o.getDimensions(a.floating);return w!==D.width||p!==D.height?{reset:{rects:!0}}:{}}}};function Ie(){return typeof window<"u"}function pe(r){return rr(r)?(r.nodeName||"").toLowerCase():"#document"}function Ft(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function Lt(r){var e;return(e=(rr(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function rr(r){return Ie()?r instanceof Node||r instanceof Ft(r).Node:!1}function Nt(r){return Ie()?r instanceof Element||r instanceof Ft(r).Element:!1}function It(r){return Ie()?r instanceof HTMLElement||r instanceof Ft(r).HTMLElement:!1}function Sn(r){return!Ie()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Ft(r).ShadowRoot}const Di=new Set(["inline","contents"]);function Pe(r){const{overflow:e,overflowX:t,overflowY:n,display:i}=Ot(r);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!Di.has(i)}const Ti=new Set(["table","td","th"]);function ji(r){return Ti.has(pe(r))}const Ni=[":popover-open",":modal"];function Le(r){return Ni.some(e=>{try{return r.matches(e)}catch{return!1}})}const Oi=["transform","translate","scale","rotate","perspective"],Bi=["transform","translate","scale","rotate","perspective","filter"],Ri=["paint","layout","strict","content"];function hn(r){const e=dn(),t=Nt(r)?Ot(r):r;return Oi.some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||Bi.some(n=>(t.willChange||"").includes(n))||Ri.some(n=>(t.contain||"").includes(n))}function zi(r){let e=Ht(r);for(;It(e)&&!he(e);){if(hn(e))return e;if(Le(e))return null;e=Ht(e)}return null}function dn(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Ii=new Set(["html","body","#document"]);function he(r){return Ii.has(pe(r))}function Ot(r){return Ft(r).getComputedStyle(r)}function Me(r){return Nt(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Ht(r){if(pe(r)==="html")return r;const e=r.assignedSlot||r.parentNode||Sn(r)&&r.host||Lt(r);return Sn(e)?e.host:e}function ir(r){const e=Ht(r);return he(e)?r.ownerDocument?r.ownerDocument.body:r.body:It(e)&&Pe(e)?e:ir(e)}function de(r,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=ir(r),s=i===((n=r.ownerDocument)==null?void 0:n.body),o=Ft(i);if(s){const a=an(o);return e.concat(o,o.visualViewport||[],Pe(i)?i:[],a&&t?de(a):[])}return e.concat(i,de(i,[],t))}function an(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function ar(r){const e=Ot(r);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const i=It(r),s=i?r.offsetWidth:t,o=i?r.offsetHeight:n,a=Be(t)!==s||Be(n)!==o;return a&&(t=s,n=o),{width:t,height:n,$:a}}function pn(r){return Nt(r)?r:r.contextElement}function ce(r){const e=pn(r);if(!It(e))return zt(1);const t=e.getBoundingClientRect(),{width:n,height:i,$:s}=ar(e);let o=(s?Be(t.width):t.width)/n,a=(s?Be(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const Li=zt(0);function sr(r){const e=Ft(r);return!dn()||!e.visualViewport?Li:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Mi(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==Ft(r)?!1:e}function Jt(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=r.getBoundingClientRect(),s=pn(r);let o=zt(1);e&&(n?Nt(n)&&(o=ce(n)):o=ce(r));const a=Mi(s,t,n)?sr(s):zt(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,m=i.width/o.x,g=i.height/o.y;if(s){const b=Ft(s),f=n&&Nt(n)?Ft(n):n;let w=b,p=an(w);for(;p&&n&&f!==w;){const v=ce(p),d=p.getBoundingClientRect(),_=Ot(p),y=d.left+(p.clientLeft+parseFloat(_.paddingLeft))*v.x,S=d.top+(p.clientTop+parseFloat(_.paddingTop))*v.y;l*=v.x,c*=v.y,m*=v.x,g*=v.y,l+=y,c+=S,w=Ft(p),p=an(w)}}return ze({width:m,height:g,x:l,y:c})}function Ue(r,e){const t=Me(r).scrollLeft;return e?e.left+t:Jt(Lt(r)).left+t}function or(r,e){const t=r.getBoundingClientRect(),n=t.left+e.scrollLeft-Ue(r,t),i=t.top+e.scrollTop;return{x:n,y:i}}function Ui(r){let{elements:e,rect:t,offsetParent:n,strategy:i}=r;const s=i==="fixed",o=Lt(n),a=e?Le(e.floating):!1;if(n===o||a&&s)return t;let l={scrollLeft:0,scrollTop:0},c=zt(1);const m=zt(0),g=It(n);if((g||!g&&!s)&&((pe(n)!=="body"||Pe(o))&&(l=Me(n)),It(n))){const f=Jt(n);c=ce(n),m.x=f.x+n.clientLeft,m.y=f.y+n.clientTop}const b=o&&!g&&!s?or(o,l):zt(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+m.x+b.x,y:t.y*c.y-l.scrollTop*c.y+m.y+b.y}}function Wi(r){return Array.from(r.getClientRects())}function Vi(r){const e=Lt(r),t=Me(r),n=r.ownerDocument.body,i=St(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),s=St(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-t.scrollLeft+Ue(r);const a=-t.scrollTop;return Ot(n).direction==="rtl"&&(o+=St(e.clientWidth,n.clientWidth)-i),{width:i,height:s,x:o,y:a}}const Cn=25;function Zi(r,e){const t=Ft(r),n=Lt(r),i=t.visualViewport;let s=n.clientWidth,o=n.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const m=dn();(!m||m&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}const c=Ue(n);if(c<=0){const m=n.ownerDocument,g=m.body,b=getComputedStyle(g),f=m.compatMode==="CSS1Compat"&&parseFloat(b.marginLeft)+parseFloat(b.marginRight)||0,w=Math.abs(n.clientWidth-g.clientWidth-f);w<=Cn&&(s-=w)}else c<=Cn&&(s+=c);return{width:s,height:o,x:a,y:l}}const Hi=new Set(["absolute","fixed"]);function Gi(r,e){const t=Jt(r,!0,e==="fixed"),n=t.top+r.clientTop,i=t.left+r.clientLeft,s=It(r)?ce(r):zt(1),o=r.clientWidth*s.x,a=r.clientHeight*s.y,l=i*s.x,c=n*s.y;return{width:o,height:a,x:l,y:c}}function Fn(r,e,t){let n;if(e==="viewport")n=Zi(r,t);else if(e==="document")n=Vi(Lt(r));else if(Nt(e))n=Gi(e,t);else{const i=sr(r);n={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return ze(n)}function lr(r,e){const t=Ht(r);return t===e||!Nt(t)||he(t)?!1:Ot(t).position==="fixed"||lr(t,e)}function Ki(r,e){const t=e.get(r);if(t)return t;let n=de(r,[],!1).filter(a=>Nt(a)&&pe(a)!=="body"),i=null;const s=Ot(r).position==="fixed";let o=s?Ht(r):r;for(;Nt(o)&&!he(o);){const a=Ot(o),l=hn(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&Hi.has(i.position)||Pe(o)&&!l&&lr(r,o))?n=n.filter(m=>m!==o):i=a,o=Ht(o)}return e.set(r,n),n}function Yi(r){let{element:e,boundary:t,rootBoundary:n,strategy:i}=r;const o=[...t==="clippingAncestors"?Le(e)?[]:Ki(e,this._c):[].concat(t),n],a=o[0],l=o.reduce((c,m)=>{const g=Fn(e,m,i);return c.top=St(g.top,c.top),c.right=fe(g.right,c.right),c.bottom=fe(g.bottom,c.bottom),c.left=St(g.left,c.left),c},Fn(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function qi(r){const{width:e,height:t}=ar(r);return{width:e,height:t}}function Xi(r,e,t){const n=It(e),i=Lt(e),s=t==="fixed",o=Jt(r,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=zt(0);function c(){l.x=Ue(i)}if(n||!n&&!s)if((pe(e)!=="body"||Pe(i))&&(a=Me(e)),n){const f=Jt(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else i&&c();s&&!n&&i&&c();const m=i&&!n&&!s?or(i,a):zt(0),g=o.left+a.scrollLeft-l.x-m.x,b=o.top+a.scrollTop-l.y-m.y;return{x:g,y:b,width:o.width,height:o.height}}function He(r){return Ot(r).position==="static"}function Pn(r,e){if(!It(r)||Ot(r).position==="fixed")return null;if(e)return e(r);let t=r.offsetParent;return Lt(r)===t&&(t=t.ownerDocument.body),t}function cr(r,e){const t=Ft(r);if(Le(r))return t;if(!It(r)){let i=Ht(r);for(;i&&!he(i);){if(Nt(i)&&!He(i))return i;i=Ht(i)}return t}let n=Pn(r,e);for(;n&&ji(n)&&He(n);)n=Pn(n,e);return n&&he(n)&&He(n)&&!hn(n)?t:n||zi(r)||t}const Ji=async function(r){const e=this.getOffsetParent||cr,t=this.getDimensions,n=await t(r.floating);return{reference:Xi(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function Qi(r){return Ot(r).direction==="rtl"}const ur={convertOffsetParentRelativeRectToViewportRelativeRect:Ui,getDocumentElement:Lt,getClippingRect:Yi,getOffsetParent:cr,getElementRects:Ji,getClientRects:Wi,getDimensions:qi,getScale:ce,isElement:Nt,isRTL:Qi};function fr(r,e){return r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}function ta(r,e){let t=null,n;const i=Lt(r);function s(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=r.getBoundingClientRect(),{left:m,top:g,width:b,height:f}=c;if(a||e(),!b||!f)return;const w=De(g),p=De(i.clientWidth-(m+b)),v=De(i.clientHeight-(g+f)),d=De(m),y={rootMargin:-w+"px "+-p+"px "+-v+"px "+-d+"px",threshold:St(0,fe(1,l))||1};let S=!0;function F($){const P=$[0].intersectionRatio;if(P!==l){if(!S)return o();P?o(!1,P):n=setTimeout(()=>{o(!1,1e-7)},1e3)}P===1&&!fr(c,r.getBoundingClientRect())&&o(),S=!1}try{t=new IntersectionObserver(F,{...y,root:i.ownerDocument})}catch{t=new IntersectionObserver(F,y)}t.observe(r)}return o(!0),s}function hr(r,e,t,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=pn(r),m=i||s?[...c?de(c):[],...de(e)]:[];m.forEach(d=>{i&&d.addEventListener("scroll",t,{passive:!0}),s&&d.addEventListener("resize",t)});const g=c&&a?ta(c,t):null;let b=-1,f=null;o&&(f=new ResizeObserver(d=>{let[_]=d;_&&_.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(b),b=requestAnimationFrame(()=>{var y;(y=f)==null||y.observe(e)})),t()}),c&&!l&&f.observe(c),f.observe(e));let w,p=l?Jt(r):null;l&&v();function v(){const d=Jt(r);p&&!fr(p,d)&&t(),p=d,w=requestAnimationFrame(v)}return t(),()=>{var d;m.forEach(_=>{i&&_.removeEventListener("scroll",t),s&&_.removeEventListener("resize",t)}),g==null||g(),(d=f)==null||d.disconnect(),f=null,l&&cancelAnimationFrame(w)}}const dr=Ei,pr=Ai,mr=Ci,gr=$i,ea=(r,e,t)=>{const n=new Map,i={platform:ur,...t},s={...i.platform,_c:n};return Si(r,e,{...i,platform:s})},na=Object.freeze(Object.defineProperty({__proto__:null,autoUpdate:hr,computePosition:ea,flip:mr,getOverflowAncestors:de,offset:dr,platform:ur,shift:pr,size:gr},Symbol.toStringTag,{value:"Module"}));function En(r,e,t){const n=r.slice();return n[36]=e[t],n[38]=t,n}function An(r){let e,t,n;return{c(){e=gt("label"),t=Se(r[2]),ot(e,"class","wa-select-label-text svelte-3x5kl5"),ot(e,"for",n="wa-select-"+r[7])},m(i,s){kt(i,e,s),_t(e,t)},p(i,s){s[0]&4&&un(t,i[2]),s[0]&128&&n!==(n="wa-select-"+i[7])&&ot(e,"for",n)},d(i){i&&yt(e)}}}function ra(r){let e,t;return{c(){e=gt("span"),t=Se(r[1]),ot(e,"class","wa-select-placeholder svelte-3x5kl5")},m(n,i){kt(n,e,i),_t(e,t)},p(n,i){i[0]&2&&un(t,n[1])},d(n){n&&yt(e)}}}function ia(r){let e;return{c(){e=gt("span"),e.textContent=`${r[16]()}`,ot(e,"class","wa-select-label svelte-3x5kl5")},m(t,n){kt(t,e,n)},p:Vt,d(t){t&&yt(e)}}}function $n(r){let e,t,n;return{c(){e=gt("button"),e.textContent="✕",ot(e,"type","button"),ot(e,"class","wa-select-clear svelte-3x5kl5"),ot(e,"aria-label","Clear selection")},m(i,s){kt(i,e,s),t||(n=ue(e,"click",r[21]),t=!0)},p:Vt,d(i){i&&yt(e),t=!1,n()}}}function Dn(r){let e;return{c(){e=gt("div"),e.textContent="▼",ot(e,"class","wa-select-chevron svelte-3x5kl5"),$t(e,"rotated",r[9])},m(t,n){kt(t,e,n)},p(t,n){n[0]&512&&$t(e,"rotated",t[9])},d(t){t&&yt(e)}}}function Tn(r){let e,t,n,i=r[4]&&jn(r);function s(l,c){return l[11].length===0?sa:aa}let o=s(r),a=o(r);return{c(){e=gt("div"),i&&i.c(),t=Yt(),n=gt("div"),a.c(),ot(n,"class","wa-select-list svelte-3x5kl5"),ot(e,"class","wa-select-dropdown svelte-3x5kl5")},m(l,c){kt(l,e,c),i&&i.m(e,null),_t(e,t),_t(e,n),a.m(n,null),r[30](e)},p(l,c){l[4]?i?i.p(l,c):(i=jn(l),i.c(),i.m(e,t)):i&&(i.d(1),i=null),o===(o=s(l))&&a?a.p(l,c):(a.d(1),a=o(l),a&&(a.c(),a.m(n,null)))},d(l){l&&yt(e),i&&i.d(),a.d(),r[30](null)}}}function jn(r){let e,t,n,i;return{c(){e=gt("div"),t=gt("input"),ot(t,"type","text"),ot(t,"class","wa-select-search-input svelte-3x5kl5"),ot(t,"placeholder","Search..."),t.value=r[10],ot(e,"class","wa-select-search svelte-3x5kl5")},m(s,o){kt(s,e,o),_t(e,t),r[27](t),n||(i=ue(t,"input",r[23]),n=!0)},p(s,o){o[0]&1024&&t.value!==s[10]&&(t.value=s[10])},d(s){s&&yt(e),r[27](null),n=!1,i()}}}function aa(r){let e=[],t=new Map,n,i=bn(r[11]);const s=o=>o[36].value;for(let o=0;o<i.length;o+=1){let a=En(r,i,o),l=s(a);t.set(l,e[o]=Nn(l,a))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();n=Xr()},m(o,a){for(let l=0;l<e.length;l+=1)e[l]&&e[l].m(o,a);kt(o,n,a)},p(o,a){a[0]&1185792&&(i=bn(o[11]),e=li(e,a,s,1,o,i,t,n.parentNode,oi,Nn,n,En))},d(o){o&&yt(n);for(let a=0;a<e.length;a+=1)e[a].d(o)}}}function sa(r){let e;return{c(){e=gt("div"),e.textContent="No options available",ot(e,"class","wa-select-empty svelte-3x5kl5")},m(t,n){kt(t,e,n)},p:Vt,d(t){t&&yt(e)}}}function Nn(r,e){let t,n=e[36].label+"",i,s,o,a,l;function c(){return e[28](e[36])}function m(){return e[29](e[38])}return{key:r,first:null,c(){t=gt("button"),i=Se(n),s=Yt(),ot(t,"type","button"),ot(t,"class","wa-select-option svelte-3x5kl5"),ot(t,"data-select-index",o=e[38]),$t(t,"selected",e[12]===e[38]),$t(t,"active",e[17]()===e[36].value),this.first=t},m(g,b){kt(g,t,b),_t(t,i),_t(t,s),a||(l=[ue(t,"click",c),ue(t,"mouseenter",m)],a=!0)},p(g,b){e=g,b[0]&2048&&n!==(n=e[36].label+"")&&un(i,n),b[0]&2048&&o!==(o=e[38])&&ot(t,"data-select-index",o),b[0]&6144&&$t(t,"selected",e[12]===e[38]),b[0]&133120&&$t(t,"active",e[17]()===e[36].value)},d(g){g&&yt(t),a=!1,Gt(l)}}}function oa(r){let e,t,n,i,s,o,a,l,c,m,g,b,f=r[2]&&An(r);function w(S,F){return S[0]?ia:ra}let p=w(r),v=p(r),d=r[5]&&r[0]&&$n(r),_=r[6]&&Dn(r),y=r[9]&&Tn(r);return{c(){e=gt("div"),f&&f.c(),t=Yt(),n=gt("div"),i=gt("div"),v.c(),s=Yt(),o=gt("div"),d&&d.c(),a=Yt(),_&&_.c(),m=Yt(),y&&y.c(),ot(i,"class","wa-select-value svelte-3x5kl5"),ot(o,"class","wa-select-controls svelte-3x5kl5"),ot(n,"id",l="wa-select-"+r[7]),ot(n,"class","wa-select-trigger svelte-3x5kl5"),ot(n,"role","button"),ot(n,"tabindex",c=r[3]?-1:0),ot(n,"style",r[8]),$t(n,"open",r[9]),$t(n,"disabled",r[3]),$t(n,"has-value",r[0]),ot(e,"class","wa-select-container wa-select svelte-3x5kl5")},m(S,F){kt(S,e,F),f&&f.m(e,null),_t(e,t),_t(e,n),_t(n,i),v.m(i,null),_t(n,s),_t(n,o),d&&d.m(o,null),_t(o,a),_&&_.m(o,null),r[25](n),_t(e,m),y&&y.m(e,null),g||(b=[ue(n,"click",r[26]),ue(n,"keydown",r[22])],g=!0)},p(S,F){S[2]?f?f.p(S,F):(f=An(S),f.c(),f.m(e,t)):f&&(f.d(1),f=null),p===(p=w(S))&&v?v.p(S,F):(v.d(1),v=p(S),v&&(v.c(),v.m(i,null))),S[5]&&S[0]?d?d.p(S,F):(d=$n(S),d.c(),d.m(o,a)):d&&(d.d(1),d=null),S[6]?_?_.p(S,F):(_=Dn(S),_.c(),_.m(o,null)):_&&(_.d(1),_=null),F[0]&128&&l!==(l="wa-select-"+S[7])&&ot(n,"id",l),F[0]&8&&c!==(c=S[3]?-1:0)&&ot(n,"tabindex",c),F[0]&256&&ot(n,"style",S[8]),F[0]&512&&$t(n,"open",S[9]),F[0]&8&&$t(n,"disabled",S[3]),F[0]&1&&$t(n,"has-value",S[0]),S[9]?y?y.p(S,F):(y=Tn(S),y.c(),y.m(e,null)):y&&(y.d(1),y=null)},i:Vt,o:Vt,d(S){S&&yt(e),f&&f.d(),v.d(),d&&d.d(),_&&_.d(),r[25](null),y&&y.d(),g=!1,Gt(b)}}}function la(r,e,t){let{items:n=[]}=e,{value:i=null}=e,{placeholder:s="Select..."}=e,{label:o=""}=e,{disabled:a=!1}=e,{searchable:l=!1}=e,{clearable:c=!1}=e,{showChevron:m=!0}=e,{name:g=""}=e,{containerStyles:b=""}=e,f=!1,w="",p=[],v=-1,d,_,y,S=null;function F(){if(!i)return s;if(typeof i=="string"){const M=n.find(X=>X.value===i);return M?M.label:i}return i.label||s}function $(){return i?typeof i=="string"?i:i.value||"":""}function P(){w?t(11,p=n.filter(M=>M.label.toLowerCase().includes(w.toLowerCase())||M.value.toLowerCase().includes(w.toLowerCase()))):t(11,p=n),t(12,v=-1)}function I(){a||f||(t(9,f=!0),t(10,w=""),P(),l&&setTimeout(()=>{y&&y.focus()},0),d&&_&&V())}function D(){t(9,f=!1),t(10,w=""),t(12,v=-1)}function V(){if(!d||!_)return;const M=[dr(6),mr({padding:8,fallbackAxisSideDirection:"end"}),pr({padding:8}),gr({padding:8,apply({rects:X,availableHeight:q,availableWidth:ut}){Object.assign(_.style,{maxHeight:`${Math.min(q-10,350)}px`,minWidth:`${X.reference.width}px`,maxWidth:`${Math.max(ut-16,X.reference.width)}px`})}})];S=hr(d,_,async()=>{const{computePosition:X}=await Promise.resolve().then(()=>na),{x:q,y:ut,placement:wt}=await X(d,_,{middleware:M,placement:"bottom-start"});_.setAttribute("data-placement",wt),Object.assign(_.style,{left:`${q}px`,top:`${ut}px`})})}function J(M){t(0,i=M),D();const X=new CustomEvent("select",{detail:M,bubbles:!0,cancelable:!0});d==null||d.dispatchEvent(X)}function C(M){M.stopPropagation(),t(0,i=null),D();const X=new CustomEvent("clear",{bubbles:!0,cancelable:!0});d==null||d.dispatchEvent(X)}function B(M){if(!f){(M.key==="Enter"||M.key===" ")&&(M.preventDefault(),I());return}switch(M.key){case"ArrowDown":M.preventDefault(),t(12,v=Math.min(v+1,p.length-1)),h();break;case"ArrowUp":M.preventDefault(),t(12,v=Math.max(v-1,-1)),h();break;case"Enter":M.preventDefault(),v>=0?J(p[v]):D();break;case"Escape":M.preventDefault(),D();break}}function h(){if(v<0)return;const M=document.querySelector(`[data-select-index="${v}"]`);M&&M.scrollIntoView({block:"nearest"})}function L(M){t(10,w=M.target.value),P()}function tt(M){if(f&&d&&_){const X=M.target;!d.contains(X)&&!_.contains(X)&&D()}}Qr(()=>{document.addEventListener("click",tt),P()}),Je(()=>{document.removeEventListener("click",tt),S&&S()});function Z(M){se[M?"unshift":"push"](()=>{d=M,t(13,d)})}const et=()=>f?D():I();function H(M){se[M?"unshift":"push"](()=>{y=M,t(15,y)})}const rt=M=>J(M),N=M=>t(12,v=M);function j(M){se[M?"unshift":"push"](()=>{_=M,t(14,_)})}return r.$$set=M=>{"items"in M&&t(24,n=M.items),"value"in M&&t(0,i=M.value),"placeholder"in M&&t(1,s=M.placeholder),"label"in M&&t(2,o=M.label),"disabled"in M&&t(3,a=M.disabled),"searchable"in M&&t(4,l=M.searchable),"clearable"in M&&t(5,c=M.clearable),"showChevron"in M&&t(6,m=M.showChevron),"name"in M&&t(7,g=M.name),"containerStyles"in M&&t(8,b=M.containerStyles)},P(),[i,s,o,a,l,c,m,g,b,f,w,p,v,d,_,y,F,$,I,D,J,C,B,L,n,Z,et,H,rt,N,j]}class ca extends Qn{constructor(e){super(),Jn(this,e,la,oa,Gn,{items:24,value:0,placeholder:1,label:2,disabled:3,searchable:4,clearable:5,showChevron:6,name:7,containerStyles:8},null,[-1,-1])}}function On(r){let e;return{c(){e=gt("div"),e.textContent="No projects found.",ot(e,"class","wa-muted"),Te(e,"margin","4rem auto 0"),Te(e,"font-size","18px"),Te(e,"width","fit-content")},m(t,n){kt(t,e,n)},d(t){t&&yt(e)}}}function Bn(r){let e,t,n,i,s;function o(l){r[11](l)}let a={name:"wa-project-select",items:r[4],placeholder:"Choose a project...",showChevron:!0,disabled:fa,clearable:!1,searchable:!1,containerStyles:"background: var(--select-bg); color: var(--select-text); border: 1px solid var(--select-border); border-radius: none; min-height: 38px; box-shadow: none; font-size: 1em; transition: border 0.2s;"};return r[2]!==void 0&&(a.value=r[2]),n=new ca({props:a}),se.push(()=>ci(n,"value",o)),n.$on("select",r[12]),{c(){e=gt("div"),t=gt("div"),ui(n.$$.fragment),ot(t,"class","wa-row"),Te(e,"margin","20px 0")},m(l,c){kt(l,e,c),_t(e,t),qn(n,t,null),s=!0},p(l,c){const m={};c[0]&16&&(m.items=l[4]),!i&&c[0]&4&&(i=!0,m.value=l[2],ni(()=>i=!1)),n.$set(m)},i(l){s||(le(n.$$.fragment,l),s=!0)},o(l){nn(n.$$.fragment,l),s=!1},d(l){l&&yt(e),Xn(n)}}}function ua(r){let e,t,n,i=r[1].length===0&&On(),s=r[1].length>0&&Bn(r);return{c(){e=gt("div"),i&&i.c(),t=Yt(),s&&s.c(),ot(e,"class","project-list wa-panel svelte-1mmykdq")},m(o,a){kt(o,e,a),i&&i.m(e,null),_t(e,t),s&&s.m(e,null),n=!0},p(o,a){o[1].length===0?i||(i=On(),i.c(),i.m(e,t)):i&&(i.d(1),i=null),o[1].length>0?s?(s.p(o,a),a[0]&2&&le(s,1)):(s=Bn(o),s.c(),le(s,1),s.m(e,null)):s&&(ai(),nn(s,1,1,()=>{s=null}),si())},i(o){n||(le(s),n=!0)},o(o){nn(s),n=!1},d(o){o&&yt(e),i&&i.d(),s&&s.d()}}}let fa=!1,ha=!0,da=null;function pa(r,e,t){let{manager:n}=e,{projectService:i}=e,{projectFileService:s}=e,o=null,a=[],l,c=null,m=[],g=[],b=null,f=[],w=!1,p=!1;Je(()=>{try{n&&b&&n.removeActiveProjectListener(b)}catch{}});async function v($=!1){if(!i)return[];const P=new Promise(h=>setTimeout(h,400)),I=[...a],D=o;let V=[],J=[];try{V=i.listAllFolders(),J=[];for(const h of V)await i.isProjectFolder(h)&&J.push(h)}catch{J=[]}const C=J.filter(h=>!I.includes(h)),B=I.filter(h=>!J.includes(h));if($&&C.length>0&&new A.Notice(`${C.length} new project${C.length>1?"s":""} discovered.`),$&&B.length>0&&new A.Notice(`${B.length} project${B.length>1?"s":""} removed.`),t(1,a=J),t(4,g=J.map(h=>({value:h,label:h}))),J.length===0)t(0,o=null),t(2,l=void 0),t(3,c=null);else if(J.length===1){t(0,o=J[0]),t(2,l=g[0]),t(3,c=J[0]);try{z(`${R} panel refresh selected single project '${c}'`)}catch{}}else if(D&&!J.includes(D)){t(0,o=J[0]),t(2,l=g[0]),t(3,c=J[0]);try{z(`${R} panel refresh selected fallback project '${c}'`)}catch{}}else{const h=g.find(L=>L.value===D);if(h){t(0,o=D),t(2,l=h),t(3,c=h.value);try{z(`${R} panel refresh kept project '${c}'`)}catch{}}else t(0,o=null),t(2,l=void 0),t(3,c=null)}return await P,c&&await d(),J}async function d(){if(!s||!c){m=[];return}const $=new Promise(P=>setTimeout(P,400));try{m=s.drafts.listDrafts(c)||[],m=Array.from(m),m.sort((P,I)=>P>I?1:P<I?-1:0)}catch{m=[]}finally{await $}}async function _(){if(!n||!s)return;const $=new Promise(P=>setTimeout(P,400));try{if(!c){f=[],w=!1;return}const P=`${c}/${jt(n==null?void 0:n.settings)}`,I=await Qt(n.app,P);if(w=(I==null?void 0:I.project_type)==="multi-file",!w){f=[];return}if(!(n!=null&&n.activeDraft)){f=[];return}let D=[];D=await s.chapters.listChapters(c,n.activeDraft),f=Array.isArray(D)?D:[]}catch{f=[],w=!1}finally{await $}}async function y($){$&&(n!=null&&n.setActiveProject&&await n.setActiveProject($),t(0,o=$),t(3,c=$),n==null||n.activeDraft,await d(),await _())}Je(()=>{try{n&&n.removeActiveDraftListener}catch{}try{n&&typeof n.removeActiveProjectListener=="function"&&b&&n.removeActiveProjectListener(b)}catch{}});function S($){l=$,t(2,l)}const F=$=>{const P=$.detail;t(2,l=P),t(3,c=typeof P=="string"?P:P?P.value:void 0),t(0,o=c??null),y(c??null)};return r.$$set=$=>{"manager"in $&&t(6,n=$.manager),"projectService"in $&&t(7,i=$.projectService),"projectFileService"in $&&t(8,s=$.projectFileService)},r.$$.update=()=>{if(r.$$.dirty[0]&1984&&n&&i&&s&&!p){t(10,p=!0),z(`${R} ProjectPanel initializing with manager`),n.activeDraft,t(0,o=n.activeProject??null);const $=P=>{z(`${R} active draft updated -> ${P}`)};n.addActiveDraftListener($),t(9,b=P=>{t(0,o=P),z(`${R} active project updated -> ${P}`)}),n.addActiveProjectListener(b),v()}},[o,a,l,c,g,y,n,i,s,b,p,S,F]}class ma extends Qn{constructor(e){super(),Jn(this,e,pa,ua,Gn,{manager:6,projectService:7,projectFileService:8},null,[-1,-1])}}const Wt="writeaid-project-panel";class ga extends A.ItemView{constructor(e,t,n){super(e),this.panelEl=null,this.selectedProject=null,this.app=t,this.manager=n,this.projectService=new Oe(t),this.projectFileService=new cn(t,this.projectService)}getViewType(){return Wt}getDisplayText(){return`${ft} Projects`}getIcon(){return sn}async onOpen(){this.panelEl=this.contentEl.createEl("div",{cls:"writeaid-project-panel"});try{if(!this.manager){z(`${R} Manager not available in ProjectPanelView.onOpen`),new A.Notice(`${ft}: manager not available, cannot mount project panel.`);return}z(`${R} Mounting ProjectPanel with manager:`,!!this.manager),this.projectPanel=new ma({target:this.panelEl,props:{manager:this.manager,projectService:this.projectService,projectFileService:this.projectFileService}}),z(`${R} ProjectPanel mounted successfully`)}catch(e){z(`${R} failed to mount project panel:`,e),new A.Notice(`${ft}: failed to mount project panel. Check console for details.`)}}async onClose(){if(this.projectPanel){try{this.projectPanel.$destroy()}catch(e){z(`${R} Error destroying project panel:`,e)}this.projectPanel=void 0}}}function wa(r,e){return()=>{const t={type:Wt,active:!0},n=e.workspace.getLeavesOfType(Wt);if(n.length>0){const i=n[0];e.workspace.revealLeaf(i)}else{let i=e.workspace.getRightLeaf(!1);i||(i=e.workspace.getRightLeaf(!0)),i.setViewState(t),e.workspace.revealLeaf(i)}}}function va(r){return()=>r.updateProjectMetadataPrompt()}class ba extends A.Modal{constructor(e,t,n,i){super(e),this.path=t,this.onCreateAnyway=n,this.onOpenExisting=i}onOpen(){const{contentEl:e}=this;e.createEl("h2",{text:"Project already exists"}),e.createEl("p",{text:`A folder named '${this.path}' already exists in the vault.`}),new A.Setting(e).addButton(t=>t.setButtonText("Open Existing").onClick(()=>{this.close(),this.onOpenExisting()})),new A.Setting(e).addButton(t=>t.setButtonText("Create Anyway").setCta().onClick(()=>{this.close(),this.onCreateAnyway(!0)})),new A.Setting(e).addButton(t=>t.setButtonText("Cancel").onClick(()=>{this.close()}))}onClose(){this.contentEl.empty()}}class _a extends A.Modal{constructor(e,t){super(e),this.props=t}onOpen(){const{contentEl:e}=this;e.createEl("h2",{text:"Create New Draft"});const t=this.props.suggestedName;let n="",i="";new A.Setting(e).setName("Draft name").addText(o=>o.setPlaceholder(t).onChange(a=>n=a));const s=this.props.drafts;s.length>0&&new A.Setting(e).setName("Copy from existing draft").addDropdown(o=>{o.addOption("","Start blank");for(const a of s)o.addOption(a,a);o.onChange(a=>i=a)}),new A.Setting(e).addButton(o=>o.setButtonText("Create").setCta().onClick(()=>{this.close();const a=n&&n.trim()?n.trim():t;this.props.onSubmit(a,i||void 0)}))}onClose(){this.contentEl.empty()}}class ya extends A.Modal{constructor(e,t){super(e),this.onSubmit=t}onOpen(){const{contentEl:e}=this;e.createEl("h2",{text:"Create New Project"});let t="",n=!0,i="Draft 1";new A.Setting(e).setName("Project folder name").addText(s=>s.onChange(o=>t=o)),new A.Setting(e).setName("Project type").addDropdown(s=>{s.addOption("single","Single-file project"),s.addOption("multi","Multi-file project (chapters)"),s.onChange(o=>n=o==="single")}),new A.Setting(e).setName("Initial draft name (optional)").addText(s=>s.setPlaceholder("Draft 1").onChange(o=>i=o||"Draft 1")),new A.Setting(e).addButton(s=>s.setButtonText("Create Project").setCta().onClick(()=>{this.close(),this.onSubmit(t,n,i||void 0)}))}onClose(){this.contentEl.empty()}}class Rn extends A.Modal{constructor(e,t,n){super(e),this.projectPath=t,this.onOpenProject=n}onOpen(){const{contentEl:e}=this;e.createEl("h2",{text:"Project created"}),e.createEl("p",{text:`Project '${this.projectPath}' was created.`}),new A.Setting(e).addButton(t=>t.setButtonText("Open Project").setCta().onClick(async()=>{this.close(),this.onOpenProject&&await this.onOpenProject()})),new A.Setting(e).addButton(t=>t.setButtonText("Close").onClick(()=>this.close()))}onClose(){this.contentEl.empty()}}class Ge extends A.Modal{constructor(e,t){super(e),this.props=t}onOpen(){const{contentEl:e}=this;e.createEl("h2",{text:"Select Project for Draft"});let t="";const n=this.props.folders||[];new A.Setting(e).setName("Project folder").addDropdown(i=>{i.addOption("","(Vault root)");for(const s of n)i.addOption(s,s||"(Vault root)");i.onChange(s=>t=s)}),new A.Setting(e).addButton(i=>i.setButtonText("Select").setCta().onClick(()=>{this.close(),this.props.onSubmit(t||"")}))}onClose(){this.contentEl.empty()}}class ka extends A.Modal{constructor(e,t,n){super(e),this.drafts=t,this.onSubmit=n}onOpen(){const{contentEl:e}=this;e.createEl("h2",{text:"Switch Active Draft"});for(const t of this.drafts)new A.Setting(e).setName(t).addButton(n=>n.setButtonText("Select").onClick(()=>{this.close(),this.onSubmit(t)}))}onClose(){this.contentEl.empty()}}class xa{constructor(e,t,n){var i;this.activeDraft=null,this.activeProject=null,this.activeProjectListeners=[],this.activeDraftListeners=[],this.panelRefreshListeners=[],this._panelRefreshTimer=null,this._panelRefreshDebounceMs=250,this.app=e,this.plugin=t,this.settings=t==null?void 0:t.settings,typeof n=="number"&&Number.isFinite(n)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(n))),this.activeProject=((i=this.settings)==null?void 0:i.activeProject)||null,this.projectService=new Oe(e),this.projectFileService=new cn(e,this.projectService,this.settings)}async reorderChapters(e,t,n){return await this.projectFileService.chapters.reorderChapters(e,t,n)}async listChapters(e,t){return await this.projectFileService.chapters.listChapters(e,t)}async createChapter(e,t,n){return await this.projectFileService.chapters.createChapter(e,t,n,this.settings)}async deleteChapter(e,t,n){return await this.projectFileService.chapters.deleteChapter(e,t,n)}async renameChapter(e,t,n,i){return await this.projectFileService.chapters.renameChapter(e,t,n,i)}async openChapter(e,t,n){return await this.projectFileService.chapters.openChapter(e,t,n)}get panelRefreshDebounceMs(){return this._panelRefreshDebounceMs}set panelRefreshDebounceMs(e){typeof e=="number"&&Number.isFinite(e)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(e)))}addActiveProjectListener(e){this.activeProjectListeners.push(e)}addActiveDraftListener(e){this.activeDraftListeners.push(e)}removeActiveDraftListener(e){this.activeDraftListeners=this.activeDraftListeners.filter(t=>t!==e)}notifyActiveDraftListeners(e){for(const t of this.activeDraftListeners)xt(()=>t(e))}addPanelRefreshListener(e){this.panelRefreshListeners.push(e)}removePanelRefreshListener(e){this.panelRefreshListeners=this.panelRefreshListeners.filter(t=>t!==e)}notifyPanelRefresh(){try{this._panelRefreshTimer&&clearTimeout(this._panelRefreshTimer),this._panelRefreshTimer=setTimeout(()=>{for(const e of this.panelRefreshListeners)xt(()=>e());this._panelRefreshTimer=null},this._panelRefreshDebounceMs)}catch{for(const e of this.panelRefreshListeners)xt(()=>e())}}removeActiveProjectListener(e){this.activeProjectListeners=this.activeProjectListeners.filter(t=>t!==e)}async setActiveProject(e){e&&(e=e.trim().replace(/^\/+/,"").replace(/\/+$/,"")),z(`${R} setActiveProject called with '${e}'`),this.activeProject=e,await bt(async()=>{if(this.plugin){const t=this.plugin;t.settings||(t.settings={}),t.settings.activeProject=e??void 0,typeof t.saveSettings=="function"&&await t.saveSettings()}});for(const t of this.activeProjectListeners)xt(()=>t(e));try{if(!e){this.activeDraft=null,this.notifyActiveDraftListeners(null);return}const t=this.listDrafts(e);if(!t||t.length===0){this.activeDraft=null;return}if(t.length===1){await this.setActiveDraft(t[0],e,!1),z(`${R} auto-selected single draft '${t[0]}' for project '${e}'`);return}await bt(async()=>{const a=await Qt(this.app,`${e}/${jt(this.settings)}`);if(a&&a.current_active_draft&&t.includes(a.current_active_draft)){await this.setActiveDraft(a.current_active_draft,e,!1),z(`${R} auto-selected meta draft '${a.current_active_draft}' for project '${e}'`);return}});let n=null,i=0;const s=this.app.vault.getFiles(),o=mt(this.settings);for(const a of t){const l=`${e}/${o}/${a}/`;let c=0;for(const m of s)if(m.path.startsWith(l)){const g=m.stat&&typeof m.stat.mtime=="number"?m.stat.mtime:0;g>c&&(c=g)}c>i&&(i=c,n=a)}n||(n=t[0]),z(`${R} auto-selected draft '${n}' for project '${e}'`),await this.setActiveDraft(n,e,!1)}catch{}}async createNewProjectPrompt(){new ya(this.app,async(e,t,n,i)=>{if(!e){new A.Notice("Project name is required.");return}const s=i&&i!==""?`${i}/${e}`:e;this.app.vault.getAbstractFileByPath(s)?new ba(this.app,s,async a=>{a&&(await this.createNewProject(e,t,n,i),new Rn(this.app,s,async()=>await this.openProject(s)).open())},async()=>{await this.openProject(s)}).open():(await this.createNewProject(e,t,n,i),new Rn(this.app,s,async()=>await this.openProject(s)).open())}).open()}async openProject(e){return await this.projectService.openProject(e)}async createNewProject(e,t,n,i){const s=await this.projectService.createProject(e,t,n,i,this.settings);if(s){await this.setActiveProject(s);const o=n||"Draft 1";await this.setActiveDraft(o,s),xt(()=>this.notifyPanelRefresh())}return s}listAllFolders(){return this.projectService.listAllFolders()}async createNewDraftPrompt(){const e=this.listAllFolders(),t=await ae(e,n=>this.projectService.isProjectFolder(n));new Ge(this.app,{folders:t,onSubmit:async n=>{const i=await this.suggestNextDraftName(n);new _a(this.app,{suggestedName:i,drafts:this.listDrafts(n),projectPath:n,onSubmit:async(s,o)=>{await this.projectFileService.drafts.createDraft(s,o,n,this.settings),new A.Notice(`Draft "${s}" created in ${n}.`)}}).open()}}).open()}async switchDraftPrompt(){const e=this.listDrafts();if(e.length===0){new A.Notice("No drafts found in the current project.");return}new ka(this.app,e,async t=>{this.activeDraft=t,new A.Notice(`Switched to draft: ${t}`);const n=this.getCurrentProjectPath();n&&await ie(this.app,n,t,void 0,this.settings)}).open()}async updateProjectMetadataPrompt(){if(this.activeProject){await ie(this.app,this.activeProject,void 0,void 0,this.settings),new A.Notice(`Metadata updated for ${this.activeProject}`);return}(async()=>{const e=this.listAllFolders(),t=await ae(e,n=>this.projectService.isProjectFolder(n));new Ge(this.app,{folders:t,onSubmit:async n=>{await ie(this.app,n,void 0,void 0,this.settings),new A.Notice(`Metadata updated for ${n}`)}}).open()})()}async selectActiveProjectPrompt(){const e=this.listAllFolders(),t=await ae(e,n=>this.projectService.isProjectFolder(n));if(t.length===0){new A.Notice(`No ${ft} projects found in the vault.`);return}new Ge(this.app,{folders:t,onSubmit:async n=>{await this.setActiveProject(n),new A.Notice(`Active project set to ${n}`)}}).open()}async createNewDraft(e,t,n){const i=await this.projectFileService.drafts.createDraft(e,t,n,this.settings);return xt(()=>this.notifyPanelRefresh()),i}listDrafts(e){return this.projectFileService.drafts.listDrafts(e)}async setActiveDraft(e,t,n=!0){const i=t||this.activeProject||this.getCurrentProjectPath();return i?(this.activeDraft=e,await bt(async()=>{await ie(this.app,i,e,void 0,this.settings)}),this.notifyActiveDraftListeners(this.activeDraft),n&&new A.Notice(`Active draft set to ${e}`),!0):(n&&new A.Notice("No project selected to set active draft on."),!1)}async renameDraft(e,t,n,i=!1){const s=n||this.activeProject||this.getCurrentProjectPath();if(!s)return new A.Notice("No project selected to rename draft."),!1;const o=this.activeDraft===e;return await this.projectFileService.drafts.renameDraft(s,e,t,i,this.settings)?(o&&(this.activeDraft=t),new A.Notice(`Renamed draft ${e} → ${t}`),!0):(new A.Notice("Failed to rename draft."),!1)}async deleteDraft(e,t,n=!0){const i=t||this.activeProject||this.getCurrentProjectPath();if(!i)return new A.Notice("No project selected to delete draft."),!1;if(await this.projectFileService.drafts.deleteDraft(i,e,n)){new A.Notice(`Deleted draft ${e}`);const o=this.listDrafts(i);if(o.length>0){if(this.activeDraft===e||!this.activeDraft){let a;if(o.length===1)a=o[0];else{const l=[...o].sort((c,m)=>c.localeCompare(m));if(this.activeDraft===e){const c=l.findIndex(m=>m===e);if(c!==-1){const m=c<l.length-1?c:0;a=l[m]}else a=l[0]}else a=this.activeDraft}await this.setActiveDraft(a,i,!1)}}else this.activeDraft=null,this.notifyActiveDraftListeners(null);return!0}return new A.Notice("Failed to delete draft."),!1}async suggestNextDraftName(e){return await this.projectFileService.drafts.suggestNextDraftName(e)}getCurrentProjectPath(){const e=this.app.workspace.getActiveFile();if(!e)return null;const t=e.parent;return t?t.path:null}}class Sa extends A.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,z(`${R} Settings tab created`),typeof t.registerSettingsChangedCallback=="function"&&t.registerSettingsChangedCallback(()=>{z(`${R} Settings changed externally, refreshing UI`),this.containerEl&&this.containerEl.parentElement&&this.display()})}display(){const{containerEl:e}=this;e.empty(),e.createEl("h2",{text:`${ft} Settings`}),z(`${R} Displaying settings UI`);const t=this.plugin;e.createEl("h3",{text:"Templates"}),new A.Setting(e).setName("Include outline file on draft creation").setDesc("If enabled, each new draft will include an outline file using the outline template.").addToggle(a=>a.setValue(!!t.settings.includeDraftOutline).onChange(l=>{z(`${R} Include draft outline changed: ${l}`),t.settings.includeDraftOutline=l,t.saveSettings()})),new A.Setting(e).setName("Outline template").setDesc("Template for outline files. Use {{draftName}}").addTextArea(a=>{a.setValue(t.settings.outlineTemplate||""),a.inputEl.setAttribute("data-setting","outline")}).addButton(a=>a.setButtonText("Pick file...").onClick(()=>{z(`${R} Opening file picker for outline template`),new Ke(this.app,l=>{z(`${R} Outline template selected: ${l}`),t.settings.outlineTemplate=l,this.display()}).open()})),new A.Setting(e).setName("Outline template").setDesc("Template for outline documents. Use {{draftName}}").addTextArea(a=>{a.setValue(t.settings.outlineTemplate||""),a.inputEl.setAttribute("data-setting","outline")}).addButton(a=>a.setButtonText("Pick file...").onClick(()=>{z(`${R} Opening file picker for outline template`),new Ke(this.app,l=>{z(`${R} Outline template selected: ${l}`),t.settings.outlineTemplate=l,this.display()}).open()})),new A.Setting(e).setName("Chapter template").setDesc("Template for newly created chapter files. Use {{chapterTitle}}").addTextArea(a=>{a.setValue(t.settings.chapterTemplate||""),a.inputEl.setAttribute("data-setting","chapter")}).addButton(a=>a.setButtonText("Pick file...").onClick(()=>{z(`${R} Opening file picker for chapter template`),new Ke(this.app,l=>{z(`${R} Chapter template selected: ${l}`),t.settings.chapterTemplate=l,this.display()}).open()})),new A.Setting(e).setName("Manuscript name template").setDesc("Template for manuscript filenames. Use {{draftName}}, {{projectName}}, and moment.js date qualifiers like {{YYYY-MM-DD}}").addText(a=>{a.setValue(t.settings.manuscriptNameTemplate||"{{draftName}}"),a.inputEl.setAttribute("data-setting","manuscript")}),new A.Setting(e).addButton(a=>a.setButtonText("Save Templates").setCta().onClick(async()=>{var g,b;z(`${R} Save Templates button clicked`);const l=e.querySelector('textarea[data-setting="outline"]'),c=e.querySelector('textarea[data-setting="chapter"]'),m=e.querySelector('input[data-setting="manuscript"]');z(`${R} Found inputs - outline: ${!!l}, chapter: ${!!c}, manuscript: ${!!m}`),z(`${R} Manuscript input value: "${m==null?void 0:m.value}"`),l&&(t.settings.outlineTemplate=l.value),c&&(t.settings.chapterTemplate=c.value),m&&(t.settings.manuscriptNameTemplate=m.value),z(`${R} Saving templates: outline=${(g=t.settings.outlineTemplate)==null?void 0:g.substring(0,50)}..., chapter=${(b=t.settings.chapterTemplate)==null?void 0:b.substring(0,50)}..., manuscript=${t.settings.manuscriptNameTemplate}`),await t.saveSettings(),new A.Notice("Templates saved successfully!")})),e.createEl("h3",{text:"Filenames"}),new A.Setting(e).setName("Draft filename slug style").setDesc("How per-draft main filenames are generated").addDropdown(a=>{a.addOption("compact","compact (draft1)"),a.addOption("kebab","kebab (draft-1)"),a.setValue(t.settings.slugStyle||"compact"),a.onChange(l=>{z(`${R} Slug style changed: ${l}`),t.settings.slugStyle=l,t.saveSettings();const c=e.querySelector(".wat-slug-preview");c&&(c.textContent=`Example: Draft 1 → ${At("Draft 1",l)}${st}`)})});let n="Draft 1";new A.Setting(e).setName("Sample draft name").setDesc("Type a sample draft name to preview the generated filename").addText(a=>a.setPlaceholder("Draft 1").setValue(n).onChange(l=>{n=l||"Draft 1";const c=e.querySelector(".wat-slug-preview");if(c){const m=At(n,t.settings.slugStyle);c.textContent=`Example: ${n} → ${m}${st}`}}));const i=e.createDiv({cls:"wat-slug-preview"}),s=At(n,t.settings.slugStyle);i.setText(`Example: ${n} → ${s}${st}`),e.createEl("h3",{text:"Folders & Files"}),new A.Setting(e).setName("Drafts folder name").setDesc("Name of the folder containing draft subfolders (default: drafts)").addText(a=>a.setValue(t.settings.draftsFolderName||"drafts").onChange(l=>{z(`${R} Drafts folder name changed: ${l}`),t.settings.draftsFolderName=l||"drafts",t.saveSettings()})),new A.Setting(e).setName("Manuscripts folder name").setDesc("Name of the folder containing generated manuscripts (default: manuscripts)").addText(a=>a.setValue(t.settings.manuscriptsFolderName||"manuscripts").onChange(l=>{z(`${R} Manuscripts folder name changed: ${l}`),t.settings.manuscriptsFolderName=l||"manuscripts",t.saveSettings()})),new A.Setting(e).setName("Backups folder name").setDesc("Name of the folder containing draft backups (default: .writeaid-backups)").addText(a=>a.setValue(t.settings.backupsFolderName||".writeaid-backups").onChange(l=>{z(`${R} Backups folder name changed: ${l}`),t.settings.backupsFolderName=l||".writeaid-backups",t.saveSettings()})),new A.Setting(e).setName("Meta file name").setDesc(`Name of the project metadata file (default: ${Tt.META})`).addText(a=>a.setValue(t.settings.metaFileName||Tt.META).onChange(l=>{z(`${R} Meta file name changed: ${l}`),t.settings.metaFileName=l||Tt.META,t.saveSettings()})),new A.Setting(e).setName("Outline file name").setDesc(`Name of the draft outline file (default: ${Tt.OUTLINE})`).addText(a=>a.setValue(t.settings.outlineFileName||Tt.OUTLINE).onChange(l=>{z(`${R} Outline file name changed: ${l}`),t.settings.outlineFileName=l||Tt.OUTLINE,t.saveSettings()})),e.createEl("h3",{text:"Word Count Targets"}),new A.Setting(e).setName("Default target word count for multi-file projects").setDesc("Target word count automatically set for new multi-file projects (chapters)").addText(a=>a.setValue(String(t.settings.defaultMultiTargetWordCount??5e4)).setPlaceholder("50000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(z(`${R} Default multi-file target word count changed: ${c}`),t.settings.defaultMultiTargetWordCount=c,t.saveSettings())})),new A.Setting(e).setName(`Default target word count for ${Ct.SINGLE} projects`).setDesc(`Target word count automatically set for new ${Ct.SINGLE} projects`).addText(a=>a.setValue(String(t.settings.defaultSingleTargetWordCount??2e4)).setPlaceholder("20000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(z(`${R} Default ${Ct.SINGLE} target word count changed: ${c}`),t.settings.defaultSingleTargetWordCount=c,t.saveSettings())})),e.createEl("h3",{text:"Backup Settings"}),new A.Setting(e).setName("Maximum number of backups per draft").setDesc("Maximum number of backup files to keep per draft (default: 5)").addText(a=>a.setValue(String(t.settings.maxBackups??5)).setPlaceholder("5").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(z(`${R} Max backups changed: ${c}`),t.settings.maxBackups=c,t.saveSettings())})),new A.Setting(e).setName("Maximum backup age (days)").setDesc("Automatically delete backups older than this many days (default: 30)").addText(a=>a.setValue(String(t.settings.maxBackupAgeDays??30)).setPlaceholder("30").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(z(`${R} Max backup age changed: ${c}`),t.settings.maxBackupAgeDays=c,t.saveSettings())})),e.createEl("h3",{text:"UI & Startup"}),e.createEl("p",{text:"Most settings take effect immediately. Settings marked with ⚠️ require a plugin reload to take effect.",cls:"setting-item-description"}),new A.Setting(e).setName("Ribbon placement").setDesc(`Place the ${ft} icon on the left or right ribbon`).addDropdown(a=>{a.addOption("left","Left"),a.addOption("right","Right"),a.setValue(t.settings.ribbonPlacement||"left"),a.onChange(l=>{z(`${R} Ribbon placement changed: ${l}`),t.settings.ribbonPlacement=l,t.saveSettings(),typeof this.plugin.moveRibbon=="function"&&(l==="left"||l==="right")&&this.plugin.moveRibbon(l),this.display()})}),new A.Setting(e).setName("Always show ribbon").setDesc(`If enabled, the ${ft} ribbon icon will always be visible regardless of whether projects are detected`).addToggle(a=>a.setValue(!!t.settings.ribbonAlwaysShow).onChange(l=>{z(`${R} Always show ribbon changed: ${l}`),t.settings.ribbonAlwaysShow=l,t.saveSettings(),typeof this.plugin.refreshRibbonVisibility=="function"&&this.plugin.refreshRibbonVisibility()})),new A.Setting(e).setName("Auto-open project panel on startup").setDesc(`If enabled, the ${ft} project panel will open on plugin load when an active project is saved. ⚠️ Requires plugin reload to take effect.`).addToggle(a=>a.setValue(!!t.settings.autoOpenPanelOnStartup).onChange(l=>{z(`${R} Auto-open panel on startup changed: ${l}`),t.settings.autoOpenPanelOnStartup=l,t.saveSettings()})),new A.Setting(e).setName("Auto-select persisted project on startup").setDesc("If enabled, the persisted active project will be selected as the plugin's active project on load without opening the panel. ⚠️ Requires plugin reload to take effect.").addToggle(a=>a.setValue(!!t.settings.autoSelectProjectOnStartup).onChange(l=>{z(`${R} Auto-select project on startup changed: ${l}`),t.settings.autoSelectProjectOnStartup=l,t.saveSettings()})),new A.Setting(e).setName(`Enable ${ft} debug logs`).setDesc(`When enabled, ${ft} will set window.__${ft.toUpperCase()}__ to true to show verbose runtime logs useful during development.`).addToggle(a=>a.setValue(!!t.settings.debug).onChange(l=>{z(`${R} Debug logs setting changed: ${l}`),t.settings.debug=l,window.__WRITEAID_DEBUG__=!!l,t.saveSettings(),l?new A.Notice(`${ft}: debug logs enabled — verbose logs will appear in the DevTools console.`):new A.Notice(`${ft}: debug logs disabled.`)})),e.createEl("h3",{text:"Panel performance"}),new A.Setting(e).setName("Panel refresh debounce (ms)").setDesc("Debounce timeout (milliseconds) for side-panel refresh notifications. Lower values mean more frequent refreshes; 0 disables debouncing.").addText(a=>{const l=t.settings.panelRefreshDebounceMs,c=Number(l??be);a.setPlaceholder(String(be)),a.setValue(String(c));let m=null;const g=b=>{const f=Number(b);if(!Number.isFinite(f)||f<Kt){new A.Notice(`Please enter a valid number ≥ ${Kt}.`);return}const w=Math.min(Math.floor(f),ve);z(`${R} Panel refresh debounce changed: ${w}ms`),t.settings.panelRefreshDebounceMs=w;try{const p=t.saveSettings();p&&typeof p.catch=="function"&&p.catch(()=>{})}catch{}this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=w),a.inputEl.value=String(w),m&&(m.value=String(w))};try{const b=a.inputEl;b.setAttribute("type","number"),b.setAttribute("min",String(Kt)),b.setAttribute("max",String(ve)),b.setAttribute("step","50"),b.setAttribute("aria-label","Panel refresh debounce in milliseconds"),xt(()=>{b.insertAdjacentHTML("afterend",'<span class="wa-unit">ms</span>')}),m=document.createElement("input"),m.type="range",m.min=String(Kt),m.max=String(ve),m.step="50",m.value=String(c),m.className="wa-debounce-range",xt(()=>{const f=b.nextSibling;f&&f.parentElement?f.insertAdjacentElement("afterend",m):b.insertAdjacentElement("afterend",m)}),a.onChange(f=>{const w=Number(f);g(w)}),m.addEventListener("input",f=>{const w=Number(f.target.value);a.inputEl.value=String(w),g(w)})}catch{a.onChange(b=>{const f=Number(b);if(!Number.isFinite(f)||f<Kt){new A.Notice(`Please enter a valid number ≥ ${Kt}.`);return}const w=Math.min(Math.floor(f),ve);t.settings.panelRefreshDebounceMs=w,t.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=w)})}}).addButton(a=>a.setButtonText("Reset").setTooltip(`Reset to default (${be} ms)`).onClick(()=>{const l=be;t.settings.panelRefreshDebounceMs=l,t.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=l),this.display()}))}}class Ke extends A.Modal{constructor(e,t){super(e),this.currentFolder=null,this.expanded={},this.onPick=t,z(`${R} FilePickerModal created`)}onOpen(){z(`${R} FilePickerModal opened`);const e=this.app.vault.getRoot();this.currentFolder=e,this.expanded={},this.render()}render(){const{contentEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Select template file"}),!this.currentFolder)return;const t=this.currentFolder.path?this.currentFolder.path.split("/"):[],n=e.createDiv({cls:"wat-breadcrumbs"}),i=n.createEl("a",{text:"(Vault root)",href:"#"});i.onclick=c=>{c.preventDefault(),this.currentFolder=this.app.vault.getRoot(),this.render()};let s="";for(const c of t){s=s?`${s}/${c}`:c,n.createDiv({text:" / "});const m=n.createEl("a",{text:c,href:"#"}),g=s;m.onclick=b=>{b.preventDefault();const f=this.app.vault.getAbstractFileByPath(g);f&&f instanceof A.TFolder&&(this.currentFolder=f,this.render())}}const a=e.createDiv({cls:"wat-controls"}).createEl("button",{text:"Up"});a.onclick=c=>{var b;if(c.preventDefault(),!this.currentFolder)return;const m=((b=this.currentFolder.parent)==null?void 0:b.path)||"",g=m?this.app.vault.getAbstractFileByPath(m):this.app.vault.getRoot();g&&g instanceof A.TFolder&&(this.currentFolder=g,this.render())};const l=e.createDiv({cls:"wat-list"});for(const c of this.currentFolder.children)if(c instanceof A.TFolder){const m=l.createDiv({cls:"wat-row folder-row"}),g=m.createEl("button",{text:this.expanded[c.path]?"▾":"▸"});g.onclick=f=>{f.preventDefault(),this.expanded[c.path]=!this.expanded[c.path],this.render()};const b=m.createEl("a",{text:c.name,href:"#"});if(b.onclick=f=>{f.preventDefault(),this.currentFolder=c,this.render()},this.expanded[c.path]){const f=l.createDiv({cls:"wat-sub"});for(const w of c.children)if(w instanceof A.TFolder){const v=f.createDiv({cls:"wat-row sub-folder"}).createEl("a",{text:w.name,href:"#"});v.onclick=d=>{d.preventDefault(),this.currentFolder=w,this.render()}}else if(w instanceof A.TFile&&w.path.toLowerCase().endsWith(st)){const v=f.createDiv({cls:"wat-row sub-file"}).createEl("a",{text:w.name,href:"#"});v.onclick=d=>{d.preventDefault(),z(`${R} File selected from file picker: ${w.path}`),this.close(),this.onPick(w.path)}}}}else if(c instanceof A.TFile&&c.path.toLowerCase().endsWith(st)){const g=l.createDiv({cls:"wat-row file-row"}).createEl("a",{text:c.name,href:"#"});g.onclick=b=>{b.preventDefault(),z(`${R} File selected from file picker: ${c.path}`),this.close(),this.onPick(c.path)}}}onClose(){this.contentEl.empty()}}const Ca=".writeaid-ribbon{padding-left:6px}.writeaid-ribbon .wa-icon{display:inline-block;vertical-align:middle}.writeaid-ribbon .wa-icon svg{width:16px;height:16px;fill:currentColor;display:block}.view-content:has(.writeaid-project-panel){padding:0}:root{--wa-slider-track-height: 6px;--wa-slider-thumb-size: 12px;--wa-slider-accent: var(--interactive-accent, #7c5cff);--wa-slider-background: var(--background-modifier-host, #eee);--wa-slider-gap: 12px}.wa-debounce-range{margin-left:var(--wa-slider-gap);vertical-align:middle;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:var(--wa-slider-track-height);background:linear-gradient(90deg,var(--wa-slider-accent) 0%,var(--wa-slider-accent) 50%,var(--wa-slider-background) 50%,var(--wa-slider-background) 100%);border-radius:999px;outline:none}.wa-debounce-range::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);box-shadow:0 0 0 4px #0000000d;cursor:pointer}.wa-debounce-range::-moz-range-thumb{width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);cursor:pointer}.wa-unit{color:var(--text-muted, #666);margin-left:6px}.justify-between{justify-content:space-between}.wa-rename-info{margin-bottom:8px;color:var(--text-muted, #888);font-size:.95em}.wa-rename-label{display:block;font-weight:500;margin-bottom:4px;color:var(--text-normal, #222)}.wa-rename-input{width:100%;padding:7px 10px;font-size:1em;border:1px solid var(--background-modifier-border, #ccc);border-radius:5px;margin-bottom:10px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s}.wa-rename-input:focus{border-color:var(--interactive-accent, #7c5cff);outline:none}.wa-rename-checkbox-label{display:flex;align-items:center;gap:6px;margin-bottom:10px;font-size:.97em;color:var(--text-muted, #666)}.wa-rename-btn-row{display:flex;gap:10px;margin-top:8px;justify-content:flex-end}.wa-rename-btn-row button{min-width:80px;padding:6px 14px;font-size:1em;border-radius:4px;border:none;cursor:pointer;transition:background .2s}.wa-rename-btn-row .mod-cta{background:var(--interactive-accent, #7c5cff);color:#fff;font-weight:600}.wa-rename-btn-row .mod-cta:hover{background:#5a3fd6}.wa-rename-btn-row .mod-cancel{background:var(--background-modifier-border, #eee);color:var(--text-muted, #666)}.wa-rename-btn-row .mod-cancel:hover{background:#e0e0e0}.wa-rename-error{min-height:18px;margin-bottom:4px;font-size:.97em;color:var(--color-red, #d43c3c);transition:opacity .2s}.wa-create-draft-input{width:100%;padding:8px 12px;font-size:1.05em;border:1.5px solid var(--background-modifier-border, #bbb);border-radius:6px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s,box-shadow .2s;outline:none;box-shadow:0 1px 2px #3c3c3c0a}.wa-create-draft-input:focus{border-color:var(--interactive-accent, #7c5cff);box-shadow:0 2px 8px #7c5cff14;background:var(--background-secondary, #fafaff)}.wa-panel{background:var(--background-primary, #fff);color:var(--text-normal, #222);padding:1em}.wa-title{font-size:1.2em;font-weight:600;color:var(--text-title, var(--text-normal, #222))}.wa-muted{color:var(--text-faint, var(--text-muted, #888))}.wa-row{display:flex;gap:8px;align-items:center;width:100%}.wa-button-group{display:flex;gap:8px}.wa-draft-list{background:var(--background-secondary, #f6f6f6);border-radius:6px;padding:8px 0;margin-top:8px}.wa-draft-item{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-bottom:1px solid var(--background-modifier-border, #e0e0e0);background:transparent;color:var(--text-normal, #222);transition:background .15s}.wa-draft-item:last-child{border-bottom:none}.wa-draft-item.active{background:var(--background-modifier-active, #eaeaff)}.wa-draft-name{font-size:1em;font-weight:500;color:var(--text-normal, #222)}.wa-draft-actions{display:flex;gap:6px}.wa-panel .wa-select{--select-bg: var(--background-primary, #fff);--select-border: var(--background-modifier-border, #ccc);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #222);--select-placeholder: var(--text-muted, #888);--select-dropdown-bg: var(--background-secondary, #f6f6f6);--select-dropdown-border: var(--background-modifier-border, #e0e0e0);--select-option-hover: var(--background-modifier-hover, #f0f0ff);--select-option-active: var(--background-modifier-active, #eaeaff);--select-chevron: var(--text-muted, #888)}";if(typeof globalThis<"u"){const r=globalThis;r.__BROWSER__||(r.__BROWSER__=!0)}function zn(r,e=20){return r.length<=e?r:r.substring(0,e-3)+"..."}const wr={outlineTemplate:`# {{draftName}} Outline

## Overview
Brief description of the story goes here.

## Characters
- Character 1: Description
- Character 2: Description

## Plot Points
- Opening: 
- Middle: 
- Climax: 
- Resolution: 

## Chapters
- Chapter 1: Title
- Chapter 2: Title
- Chapter 3: Title`,chapterTemplate:`# {{chapterName}}

## Summary
Chapter summary goes here.

## Scene 1
Scene content goes here.

## Scene 2
Scene content goes here.`,manuscriptNameTemplate:"{{draftName}}",slugStyle:"compact",ribbonPlacement:"left",ribbonAlwaysShow:!1,autoOpenPanelOnStartup:!0,autoSelectProjectOnStartup:!0,activeProject:void 0,panelRefreshDebounceMs:250,debug:!1,includeDraftOutline:!1,draftsFolderName:Xt.DRAFTS,manuscriptsFolderName:Xt.MANUSCRIPTS,backupsFolderName:Xt.BACKUPS,metaFileName:Tt.META,outlineFileName:Tt.OUTLINE,maxBackups:5,maxBackupAgeDays:30};function In(r){return Object.assign({},wr,r??{})}class Fa extends A.Plugin{constructor(){super(...arguments),this.settings=wr,this.settingsChangedCallbacks=[]}async loadSettings(){const e=await this.loadData();this.settings=In(e),e&&e.activeProject!==void 0&&(this.settings.activeProject=e.activeProject),this.manager&&(this.manager.settings=this.settings),this.settingsChangedCallbacks.forEach(t=>{try{t()}catch(n){z(`${R} Error in settings changed callback:`,n)}})}async saveSettings(){await bt(async()=>{const t=In(this.settings);await this.saveData(t),this.settings=t})===void 0&&await this.saveData(this.settings),this.manager&&(this.manager.settings=this.settings,z(`${R} Updated manager settings reference, manuscript template: ${this.settings.manuscriptNameTemplate}`)),this.settingsChangedCallbacks.forEach(t=>{try{t()}catch(n){z(`${R} Error in settings changed callback:`,n)}})}registerSettingsChangedCallback(e){this.settingsChangedCallbacks.push(e)}async runBackupCleanup(){if(this.manager)try{const t=await new Oe(this.app).listProjects();for(const n of t){const i=mt(this.settings),s=`${n}/${i}`,o=this.app.vault.getAbstractFileByPath(s);if(!(!o||!(o instanceof A.TFolder))){for(const a of o.children)if(a instanceof A.TFolder){const l=`${s}/${a.name}`;await this.manager.projectFileService.backups.clearOldBackups(l,this.manager.settings)}}}z(`${R} Backup cleanup completed on startup`)}catch(e){z(`${R} Error during backup cleanup:`,e)}}async onload(){await this.loadSettings(),this.manager=new xa(this.app,this,typeof this.settings.panelRefreshDebounceMs=="number"?this.settings.panelRefreshDebounceMs:void 0),z(`${R} Manager created:`,!!this.manager);const e=new Oe(this.app);this.app.workspace.onLayoutReady(async()=>{const i=await e.listProjects();let s=null;if(i.length===1)s=i[0];else if(i.length>1){const o=this.settings.activeProject,a=o==null?void 0:o.trim().replace(/^\/+/,"").replace(/\/+$/,"");z(`${R} lastActiveRaw='${o}', normalized='${a}', includes=${a&&i.includes(a)}`),a&&i.includes(a)?s=a:s=i[0]}else if(i.length===0){const o=this.settings.activeProject,a=o==null?void 0:o.trim().replace(/^\/+/,"").replace(/\/+$/,"");await e.isProjectFolder(o||"")&&(z(`${R} activating saved project '${a}' as it exists and has valid meta file`),s=a??null)}if(z(`${R} toActivate='${s}'`),s){if(await this.manager.setActiveProject(s),this.settings.activeProject=s,await this.saveSettings(),this.settings.autoOpenPanelOnStartup){const o=this.app.workspace.getLeavesOfType(Wt);if(o.length>0)this.app.workspace.revealLeaf(o[0]);else{let a=null;this.settings.ribbonPlacement==="right"?a=this.app.workspace.getRightLeaf(!0):a=this.app.workspace.getLeftLeaf(!0);const l={type:Wt,active:!0};a.setViewState(l),this.app.workspace.revealLeaf(a)}}}else await this.manager.setActiveProject(null),this.settings.activeProject=void 0,await this.saveSettings()}),this.statusBarEl=this.addStatusBarItem(),this.statusBarEl.setText(`${ft}: No active project`),this.runBackupCleanup().catch(i=>{z(`${R} Failed to run backup cleanup on startup:`,i)}),xt(()=>{this.waStyleEl||(this.waStyleEl=document.createElement("style"),this.waStyleEl.setAttribute("data-writeaid-style",""),this.waStyleEl.textContent=Ca,this.waStyleEl.classList.add("writeaid-plugin-style"),document.head.appendChild(this.waStyleEl))}),await this.loadSettings(),xt(()=>{window.__WRITEAID_DEBUG__=!!this.settings.debug}),z(`${R} Loading ${ft} Novel Multi-Draft Plugin`),this.manager.addActiveProjectListener(i=>{this.statusBarEl&&(i?(this.statusBarEl.setText(`${ft}: ${zn(i)}`),z(`${R} active project updated -> ${i}`)):this.statusBarEl.setText(`${ft}: No active project`))}),this.manager.activeProject&&this.statusBarEl.setText(`${ft}: ${zn(this.manager.activeProject)}`),z(`${R} Registering ProjectPanelView with manager:`,!!this.manager),this.registerView(Wt,i=>(z(`${R} Creating ProjectPanelView instance with manager:`,!!this.manager),new ga(i,this.app,this.manager)));const t=this.addRibbonIcon(sn,`${ft} Projects`,()=>{});t.classList.add("writeaid-ribbon"),this.ribbonEl=t,t.setAttr("aria-label",`${ft} Projects`),t.onclick=()=>{const i=this.app.workspace.getLeavesOfType(Wt);if(i.length>0){const s=i[0];this.app.workspace.revealLeaf(s)}else{let s=this.app.workspace.getLeftLeaf(!1);s||(s=this.app.workspace.getLeftLeaf(!0));const o={type:Wt,active:!0};s.setViewState(o),this.app.workspace.revealLeaf(s)}};const n=async()=>{await bt(async()=>{if(this.settings.ribbonAlwaysShow){t.style.display="";return}const s=e.listAllFolders();(await ae(s,a=>e.isProjectFolder(a))).length>0?t.style.display="":t.style.display="none"})===void 0&&(t.style.display="")};this.refreshRibbonVisibility=n,n().catch(()=>{}),this.settings.ribbonPlacement==="right"&&this.moveRibbon("right"),this.registerEvent(this.app.vault.on("create",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("delete",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("modify",()=>{n().catch(()=>{})})),this.addCommand({id:"create-new-draft",name:"Create New Draft",callback:$r(this.manager)}),this.addCommand({id:"create-outline",name:"Create Outline",callback:()=>Dr(this.manager)}),this.addCommand({id:"create-new-project",name:"Create New Project",callback:Lr(this.manager)}),this.addCommand({id:"switch-draft",name:"Switch Active Draft",callback:jr(this.manager)}),this.addCommand({id:"update-project-metadata",name:"Update Project Metadata",callback:va(this.manager)}),this.addCommand({id:"select-active-project",name:"Select Active Project",callback:Mr(this.manager)}),this.addCommand({id:"generate-manuscript",name:"Generate Manuscript",callback:Tr(this.manager)}),this.addCommand({id:"toggle-project-panel",name:`Toggle ${ft} Project Panel`,callback:wa(this.manager,this.app)}),this.addCommand({id:"convert-single-to-multi-file-project",name:"Convert Single-File Project to Multi-File",callback:()=>{var i,s;return Ir(this.app,this.manager.activeProject||((s=(i=this.manager).getCurrentProjectPath)==null?void 0:s.call(i))||void 0,this.manager.settings)}}),this.addCommand({id:"navigate-to-next-chapter",name:"Navigate to Next Chapter",callback:Nr(this.manager)}),this.addCommand({id:"navigate-to-previous-chapter",name:"Navigate to Previous Chapter",callback:Or(this.manager)}),this.addCommand({id:"create-backup",name:"Create Backup",callback:Fr(this.manager)}),this.addCommand({id:"list-and-restore-backups",name:"List and Restore Backups",callback:Ar(this.manager)}),this.addCommand({id:"delete-backup",name:"Delete Oldest Backup",callback:Pr(this.manager)}),this.addCommand({id:"clear-old-backups",name:"Clear Old Backups",callback:Cr(this.manager)}),this.addSettingTab(new Sa(this.app,this))}moveRibbon(e){xt(()=>{if(!this.ribbonEl)return;const t=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-right"),n=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-left");e==="right"&&t?t.appendChild(this.ribbonEl):e==="left"&&n&&n.appendChild(this.ribbonEl)})}onunload(){this.statusBarEl&&this.statusBarEl.parentElement&&this.statusBarEl.parentElement.removeChild(this.statusBarEl),z(`${R} Unloading ${ft} Novel Multi-Draft Plugin`),this.waStyleEl&&this.waStyleEl.parentElement&&this.waStyleEl.parentElement.removeChild(this.waStyleEl)}}module.exports=Fa;
//# sourceMappingURL=main.js.map
