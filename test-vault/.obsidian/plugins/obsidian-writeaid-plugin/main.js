"use strict";const T=require("obsidian"),En={ACTIVE_PROJECT_NOT_FOUND:"No active project found.",ACTIVE_DRAFT_NOT_FOUND:"No active draft found.",BACKUPS_NOT_FOUND_PROJECT:"No backups found for the current project.",BACKUPS_NOT_FOUND_DRAFT:"No backups found for the current draft."},Re={DRAFTS:"drafts",MANUSCRIPTS:"manuscripts",BACKUPS:".writeaid-backups"},oe={META:"meta.md",OUTLINE:"outline.md"},sr={COMPACT:"compact",KEBAB:"kebab"},re={SINGLE:"single-file",MULTI:"multi-file"},Ha=Object.values(re),jt="WriteAid",Z=`${jt} debug:`,pr="pen-tool",St=".md",$e=0,cn=5e3,fn=250,un=".zip",Ii=/_(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})\.zip$/,Lt="---",ae=new RegExp(`^${Lt}
([\\s\\S]*?)
${Lt}`),or=1024,Ri=["B","KB","MB","GB"];function Vt(n){return n?.draftsFolderName||Re.DRAFTS}function mr(n){return n?.manuscriptsFolderName||Re.MANUSCRIPTS}function qe(n){return n?.backupsFolderName||Re.BACKUPS}function le(n){return n?.metaFileName||oe.META}function Ke(n){return n?.outlineFileName||oe.OUTLINE}function se(n,t=sr.COMPACT){if(!n)return"";const e=n.trim();return t===sr.KEBAB?e.replace(/\s+/g,"-").toLowerCase():e.replace(/\s+/g,"").toLowerCase()}async function Xe(n,t){const e=await Promise.all(n.map(r=>Promise.resolve(t(r))));return n.filter((r,i)=>e[i])}function ne(n,...t){try{return n()}catch(e){if(t.length>0&&t.some(r=>e instanceof r)||t.length===0)return;throw e}}async function Kt(n,...t){try{return await n()}catch(e){if(t.length>0&&t.some(r=>e instanceof r)||t.length===0)return;throw e}}function G(...n){ne(()=>{window.__WRITEAID_DEBUG__&&(console.debug||console.log).apply(console,n)})}function mn(n,t){return n?t?!0:(new T.Notice(En.ACTIVE_DRAFT_NOT_FOUND),!1):(new T.Notice(En.ACTIVE_PROJECT_NOT_FOUND),!1)}const Va=Object.freeze(Object.defineProperty({__proto__:null,APP_NAME:jt,BACKUP_FILE_EXTENSION:un,BACKUP_TIMESTAMP_REGEX:Ii,BYTES_PER_KILOBYTE:or,DEBUG_PREFIX:Z,FILES:oe,FILE_SIZE_UNITS:Ri,FOLDERS:Re,FRONTMATTER_DELIMITER:Lt,FRONTMATTER_REGEX:ae,MARKDOWN_FILE_EXTENSION:St,PANEL_DEBOUNCE_DEFAULT:fn,PANEL_DEBOUNCE_MAX:cn,PANEL_DEBOUNCE_MIN:$e,PROJECT_TYPE:re,SLUG_STYLE:sr,VALID_PROJECT_TYPES:Ha,WRITE_AID_ICON_NAME:pr,asyncFilter:Xe,checkActive:mn,debug:G,getBackupsFolderName:qe,getDraftsFolderName:Vt,getManuscriptsFolderName:mr,getMetaFileName:le,getOutlineFileName:Ke,slugifyDraftName:se,suppress:ne,suppressAsync:Kt},Symbol.toStringTag,{value:"Module"}));function Za(n){return async()=>{const t=n.activeProject,e=n.activeDraft;if(G(`${Z} Clear old backups command called`),G(`${Z} Active project: ${t}, active draft: ${e}`),!mn(t,e))return;const r=Vt(n.settings),i=`${t}/${r}/${e}`,a=n.projectFileService.backups.maxBackupAgeDays;await n.projectFileService.backups.clearOldBackups(i,n.settings),new T.Notice(`Old backups cleared (older than ${a} days).`)}}function Ga(n){return async()=>{const t=n.activeProject,e=n.activeDraft;if(G(`${Z} Create backup command called`),G(`${Z} Active project: ${t}, active draft: ${e}`),!mn(t,e))return;const r=Vt(n.settings),i=`${t}/${r}/${e}`;await n.projectFileService.backups.createBackup(i,n.settings)?new T.Notice("Backup created successfully."):new T.Notice("Failed to create backup.")}}function qa(n){return async()=>{const t=n.activeProject,e=n.activeDraft;if(G(`${Z} Delete backup command called`),G(`${Z} Active project: ${t}, active draft: ${e}`),!mn(t,e))return;const r=Vt(n.settings),i=`${t}/${r}/${e}`,a=await n.projectFileService.backups.listBackups(i,n.settings);if(a.length===0){new T.Notice(En.BACKUPS_NOT_FOUND_DRAFT);return}const s=a[a.length-1];await n.projectFileService.backups.deleteBackup(i,s,n.settings)?new T.Notice(`Backup deleted successfully: ${s}.`):new T.Notice("Failed to delete backup.")}}class zi extends T.Modal{constructor(t,e,r=!1){super(t),this.path=e,this.isDraft=r,this.setTitle("Confirm Overwrite")}onOpen(){const{contentEl:t}=this,e=this.isDraft?"draft folder":"manuscript file";t.createEl("p",{text:`The ${e} "${this.path}" already exists. Do you want to overwrite it?`});const r=t.createDiv({cls:"modal-button-container"});new T.ButtonComponent(r).setButtonText("Cancel").onClick(()=>{this.resolve(!1),this.close()}),new T.ButtonComponent(r).setButtonText("Overwrite").setCta().onClick(()=>{this.resolve(!0),this.close()})}onClose(){const{contentEl:t}=this;t.empty()}open(){return new Promise(t=>{this.resolve=t,super.open()})}}class Ka extends T.SuggestModal{constructor(t,e){super(t),this.manager=e,this.backups=[],this.draftFolder="",this.draftName="",this.setPlaceholder("Select a backup to restore..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to restore"},{command:"esc",purpose:"to cancel"}])}async onOpen(){const t=this.manager.activeProject;if(!t){new T.Notice("No active project found."),this.close();return}const e=Vt(this.manager.settings);if(this.draftFolder=`${t}/${e}`,this.draftName=t,this.backups=await this.getBackupDetails(),this.backups.length===0){new T.Notice(En.BACKUPS_NOT_FOUND_PROJECT),this.close();return}this.setTitle(`Restore Backup for Project "${t}"`),super.onOpen()}async getBackupDetails(){const t=this.draftFolder.split("/")[0]||"unknown",e=`${qe(this.manager.settings)}/${t}`;try{const r=[],i=Vt(this.manager.settings),a=`${e}/${i}`,s=await this.app.vault.adapter.list(a);for(const o of s.folders){const l=o.split("/").pop()||o,c=`${a}/${l}`,u=await this.app.vault.adapter.list(c),d=`${t}/${i}/${l}`;for(const _ of u.files){const f=_.split("/").pop()||_,p=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),h=new RegExp(`^${p}_(\\d{4}-\\d{2}-\\d{2}T\\d{2}-\\d{2}-\\d{2})\\.zip$`),b=f.match(h);if(b){const v=(await this.app.vault.adapter.stat(_))?.size||0,y=b[1],E=y.replace(/T(\d{2})-(\d{2})-(\d{2})/,"T$1:$2:$3"),O=new Date(E).toLocaleString(),A=this.formatFileSize(v);r.push({timestamp:y,size:v,displayText:`${l}: ${O} (${A})`,draftName:l,draftFolder:d})}}}return r.sort((o,l)=>l.timestamp.localeCompare(o.timestamp))}catch{return G(`${Z} Backup directory does not exist yet for project '${e}' (this is normal for new projects)`),[]}}formatFileSize(t){if(t===0)return"0 B";const e=Math.floor(Math.log(t)/Math.log(or));return parseFloat((t/Math.pow(or,e)).toFixed(1))+" "+Ri[e]}getSuggestions(t){return this.backups.filter(e=>e.displayText.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.createEl("div",{text:t.displayText})}async onChooseSuggestion(t,e){const r=this.app.vault.getAbstractFileByPath(t.draftFolder);if(r&&r instanceof T.TFolder&&!await new zi(this.app,t.draftFolder,!0).open())return;await this.manager.projectFileService.backups.restoreBackup(t.draftFolder,t.timestamp,this.manager.settings)?new T.Notice(`Backup restored successfully for "${t.draftName}" from ${t.displayText.split(": ")[1].split(" (")[0]}.`):new T.Notice("Failed to restore backup.")}}function Ya(n){return async()=>{G(`${Z} List backups command called`),new Ka(n.app,n).open()}}function Xa(n){return()=>n.createNewDraftPrompt()}async function Ja(n){G(`${Z} createOutlineCommand called`);try{const t=n.activeProject,e=n.activeDraft;if(!t||!e){new T.Notice("No active project or draft selected. Please select a project and draft first.");return}const r=n.projectFileService.drafts.getOutlineFile(t,e);if(r){new T.Notice(`Outline file already exists: ${r.path}`);return}await n.projectFileService.drafts.createOutline(t,e,n.settings.outlineTemplate),new T.Notice(`Outline created for draft: ${e}`),G(`${Z} Outline created successfully for draft: ${e}`)}catch(t){G(`${Z} Error creating outline:`,t),new T.Notice(`Failed to create outline: ${t.message}`)}}function Qa(n){return async()=>{const t=n.projectFileService.drafts,e=n.activeProject,r=n.activeDraft;if(G(`${Z} Generate manuscript command called`),G(`${Z} Active project: ${e}, active draft: ${r}`),G(`${Z} Manager settings manuscript template: ${n.settings?.manuscriptNameTemplate}`),!mn(e,r))return;await t.generateManuscript(e,r,n.settings)?new T.Notice("Manuscript generated successfully."):new T.Notice("Failed to generate manuscript.")}}function ts(n){return()=>n.switchDraftPrompt()}function es(n){return async()=>{const t=n.app.workspace.getActiveFile();if(!t){new T.Notice("No file is currently open.");return}const e=t.path,r=Vt(n.settings),i=e.match(new RegExp(`^(.+)/${r}/(.+)/(.+)\\${St}$`));if(!i){new T.Notice("The current file is not a chapter.");return}const a=i[1],s=i[2],o=i[3];try{const l=await n.projectFileService.chapters.listChapters(a,s),c=l.findIndex(d=>d.name===o);if(c===-1){new T.Notice("Unable to find the current chapter in the draft.");return}if(c>=l.length-1)return;const u=l[c+1];await n.openChapter(a,s,u.name)}catch(l){G(`${Z} Failed to navigate to next chapter:`,l),new T.Notice("Failed to navigate to next chapter.")}}}function ns(n){return async()=>{const t=n.app.workspace.getActiveFile();if(!t){new T.Notice("No file is currently open.");return}const e=t.path,r=Vt(n.settings),i=e.match(new RegExp(`^(.+)/${r}/(.+)/(.+)\\${St}$`));if(!i){new T.Notice("The current file is not a chapter.");return}const a=i[1],s=i[2],o=i[3];try{const l=await n.projectFileService.chapters.listChapters(a,s),c=l.findIndex(d=>d.name===o);if(c===-1){new T.Notice("Unable to find the current chapter in the draft.");return}if(c<=0)return;const u=l[c-1];await n.openChapter(a,s,u.name)}catch(l){G(`${Z} Failed to navigate to previous chapter:`,l),new T.Notice("Failed to navigate to previous chapter.")}}}async function He(n,t){const e=n.vault.getAbstractFileByPath(t);if(!e||!(e instanceof T.TFile))return null;try{const r=await n.vault.read(e);return rs(r)}catch(r){return G(`${Z} Error reading meta file:`,r),null}}async function gr(n,t,e){const r=is(e),i=n.vault.getAbstractFileByPath(t);i&&i instanceof T.TFile?await n.vault.modify(i,r):await n.vault.create(t,r)}async function Ye(n,t,e,r,i){const a=`${t}/${le(i)}`;let s=await He(n,a);s||(s={total_drafts:0});const o=Vt(i),l=n.vault.getAbstractFileByPath(`${t}/${o}`);if(l&&l instanceof T.TFolder){const c=l.children.filter(u=>u instanceof T.TFolder);s.total_drafts=c.length}e!==void 0&&(s.current_active_draft=e,s.active_draft_last_modified=new Date().toISOString()),r&&Object.assign(s,r),s.total_drafts>0&&s.total_word_count&&(s.average_draft_word_count=Math.round(s.total_word_count/s.total_drafts)),await gr(n,a,s)}function rs(n){const t=n.match(new RegExp(`${Lt}\\s*\\n([\\s\\S]*?)\\n${Lt}`));if(!t)return null;const e=t[1],r={},i=e.split(`
`);for(const a of i){const s=a.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(s){const o=s[1];let l=s[2].trim();/^-?\d+(\.\d+)?$/.test(l)?l=Number(l):(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),r[o]=l}}return r}function is(n){const t=[Lt];if(n.current_active_draft!==void 0&&t.push(`current_active_draft: "${n.current_active_draft}"`),t.push(`total_drafts: ${n.total_drafts}`),n.target_word_count!==void 0&&t.push(`target_word_count: ${n.target_word_count}`),n.active_draft_last_modified!==void 0&&t.push(`active_draft_last_modified: "${n.active_draft_last_modified}"`),n.total_word_count!==void 0&&t.push(`total_word_count: ${n.total_word_count}`),n.average_draft_word_count!==void 0&&t.push(`average_draft_word_count: ${n.average_draft_word_count}`),n.project_type!==void 0&&t.push(`project_type: ${n.project_type}`),t.push(Lt),t.push(""),t.push("# Project Statistics"),t.push(""),n.current_active_draft&&t.push(`**Active Draft:** ${n.current_active_draft}`),t.push(`**Total Drafts:** ${n.total_drafts}`),n.target_word_count&&t.push(`**Target Word Count:** ${n.target_word_count.toLocaleString()}`),n.active_draft_last_modified){const e=new Date(n.active_draft_last_modified);t.push(`**Last Modified:** ${e.toLocaleString()}`)}return n.total_word_count&&t.push(`**Total Word Count:** ${n.total_word_count.toLocaleString()}`),n.average_draft_word_count&&t.push(`**Average Draft Word Count:** ${n.average_draft_word_count.toLocaleString()}`),t.push(""),t.join(`
`)}const lr=Object.freeze(Object.defineProperty({__proto__:null,readMetaFile:He,updateMetaStats:Ye,writeMetaFile:gr},Symbol.toStringTag,{value:"Module"}));async function as(n,t,e){const r=`${t}/${le(e)}`,i=await He(n,r);if(!i||i.project_type!==re.SINGLE)return new T.Notice(`Project is not a ${re.SINGLE} project.`),!1;i.project_type=re.MULTI,await gr(n,r,i);const a=Vt(e),s=n.vault.getAbstractFileByPath(`${t}/${a}`);if(!s||!(s instanceof T.TFolder))return new T.Notice("Drafts folder not found."),!1;let o=!1;for(const l of s.children)if(l instanceof T.TFolder){const c=se(l.name),u=l.children.find(d=>d instanceof T.TFile&&d.name===`${c}${St}`);if(u){const d=`${l.path}/Chapter 1${St}`;if(u.path!==d){const _=await n.vault.read(u);await n.vault.create(d,_),await n.vault.delete(u),o=!0}}}return o?new T.Notice(`Converted to multi-file project. Draft files renamed to "Chapter 1${St}".`):new T.Notice("Converted to multi-file project. No draft files needed renaming."),!0}async function ss(n,t,e){if(!t){new T.Notice("No active project selected.");return}await as(n,t,e)}function os(n){return()=>n.createNewProjectPrompt()}function ls(n){return()=>n.selectActiveProjectPrompt()}function cs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function yn(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var tr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Ar;function fs(){return Ar||(Ar=1,(function(n,t){(function(e){n.exports=e()})(function(){return(function e(r,i,a){function s(c,u){if(!i[c]){if(!r[c]){var d=typeof yn=="function"&&yn;if(!u&&d)return d(c,!0);if(o)return o(c,!0);var _=new Error("Cannot find module '"+c+"'");throw _.code="MODULE_NOT_FOUND",_}var f=i[c]={exports:{}};r[c][0].call(f.exports,function(p){var h=r[c][1][p];return s(h||p)},f,f.exports,e,r,i,a)}return i[c].exports}for(var o=typeof yn=="function"&&yn,l=0;l<a.length;l++)s(a[l]);return s})({1:[function(e,r,i){var a=e("./utils"),s=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,u,d,_,f,p,h,b=[],g=0,v=l.length,y=v,E=a.getTypeOf(l)!=="string";g<l.length;)y=v-g,d=E?(c=l[g++],u=g<v?l[g++]:0,g<v?l[g++]:0):(c=l.charCodeAt(g++),u=g<v?l.charCodeAt(g++):0,g<v?l.charCodeAt(g++):0),_=c>>2,f=(3&c)<<4|u>>4,p=1<y?(15&u)<<2|d>>6:64,h=2<y?63&d:64,b.push(o.charAt(_)+o.charAt(f)+o.charAt(p)+o.charAt(h));return b.join("")},i.decode=function(l){var c,u,d,_,f,p,h=0,b=0,g="data:";if(l.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var v,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|y):new Array(0|y);h<l.length;)c=o.indexOf(l.charAt(h++))<<2|(_=o.indexOf(l.charAt(h++)))>>4,u=(15&_)<<4|(f=o.indexOf(l.charAt(h++)))>>2,d=(3&f)<<6|(p=o.indexOf(l.charAt(h++))),v[b++]=c,f!==64&&(v[b++]=u),p!==64&&(v[b++]=d);return v}},{"./support":30,"./utils":32}],2:[function(e,r,i){var a=e("./external"),s=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(u,d,_,f,p){this.compressedSize=u,this.uncompressedSize=d,this.crc32=_,this.compression=f,this.compressedContent=p}c.prototype={getContentWorker:function(){var u=new s(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return u.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new s(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(u,d,_){return u.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(_)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},r.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,r,i){var a=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,r,i){var a=e("./utils"),s=(function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l})();r.exports=function(o,l){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?(function(c,u,d,_){var f=s,p=_+d;c^=-1;for(var h=_;h<p;h++)c=c>>>8^f[255&(c^u[h])];return-1^c})(0|l,o,o.length,0):(function(c,u,d,_){var f=s,p=_+d;c^=-1;for(var h=_;h<p;h++)c=c>>>8^f[255&(c^u.charCodeAt(h))];return-1^c})(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,r,i){var a=null;a=typeof Promise<"u"?Promise:e("lie"),r.exports={Promise:a}},{lie:37}],7:[function(e,r,i){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=a?"uint8array":"array";function u(d,_){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=_,this.meta={}}i.magic="\b\0",o.inherits(u,l),u.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,d.data),!1)},u.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(_){d.push({data:_,meta:d.meta})}},i.compressWorker=function(d){return new u("Deflate",d)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,r,i){function a(f,p){var h,b="";for(h=0;h<p;h++)b+=String.fromCharCode(255&f),f>>>=8;return b}function s(f,p,h,b,g,v){var y,E,S=f.file,O=f.compression,A=v!==c.utf8encode,U=o.transformTo("string",v(S.name)),D=o.transformTo("string",c.utf8encode(S.name)),R=S.comment,j=o.transformTo("string",v(R)),C=o.transformTo("string",c.utf8encode(R)),$=D.length!==S.name.length,w=C.length!==R.length,V="",lt="",K="",st=S.dir,x=S.date,tt={crc32:0,compressedSize:0,uncompressedSize:0};p&&!h||(tt.crc32=f.crc32,tt.compressedSize=f.compressedSize,tt.uncompressedSize=f.uncompressedSize);var B=0;p&&(B|=8),A||!$&&!w||(B|=2048);var z=0,dt=0;st&&(z|=16),g==="UNIX"?(dt=798,z|=(function(at,Nt){var Mt=at;return at||(Mt=Nt?16893:33204),(65535&Mt)<<16})(S.unixPermissions,st)):(dt=20,z|=(function(at){return 63&(at||0)})(S.dosPermissions)),y=x.getUTCHours(),y<<=6,y|=x.getUTCMinutes(),y<<=5,y|=x.getUTCSeconds()/2,E=x.getUTCFullYear()-1980,E<<=4,E|=x.getUTCMonth()+1,E<<=5,E|=x.getUTCDate(),$&&(lt=a(1,1)+a(u(U),4)+D,V+="up"+a(lt.length,2)+lt),w&&(K=a(1,1)+a(u(j),4)+C,V+="uc"+a(K.length,2)+K);var ot="";return ot+=`
\0`,ot+=a(B,2),ot+=O.magic,ot+=a(y,2),ot+=a(E,2),ot+=a(tt.crc32,4),ot+=a(tt.compressedSize,4),ot+=a(tt.uncompressedSize,4),ot+=a(U.length,2),ot+=a(V.length,2),{fileRecord:d.LOCAL_FILE_HEADER+ot+U+V,dirRecord:d.CENTRAL_FILE_HEADER+a(dt,2)+ot+a(j.length,2)+"\0\0\0\0"+a(z,4)+a(b,4)+U+V+j}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),u=e("../crc32"),d=e("../signature");function _(f,p,h,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=h,this.encodeFileName=b,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(_,l),_.prototype.push=function(f){var p=f.meta.percent||0,h=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:h?(p+100*(h-b-1))/h:100}}))},_.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var h=s(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:h.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,h=s(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),p)this.push({data:(function(b){return d.DATA_DESCRIPTOR+a(b.crc32,4)+a(b.compressedSize,4)+a(b.uncompressedSize,4)})(f),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var h=this.bytesWritten-f,b=(function(g,v,y,E,S){var O=o.transformTo("string",S(E));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(g,2)+a(g,2)+a(v,4)+a(y,4)+a(O.length,2)+O})(this.dirRecords.length,h,f,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(h){p.processChunk(h)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(h){p.error(h)}),this},_.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(f){var p=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var h=0;h<p.length;h++)try{p[h].error(f)}catch{}return!0},_.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},r.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,r,i){var a=e("../compressions"),s=e("./ZipFileWorker");i.generateWorker=function(o,l,c){var u=new s(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{o.forEach(function(_,f){d++;var p=(function(v,y){var E=v||y,S=a[E];if(!S)throw new Error(E+" is not a valid compression method !");return S})(f.options.compression,l.compression),h=f.options.compressionOptions||l.compressionOptions||{},b=f.dir,g=f.date;f._compressWorker(p,h).withStreamInfo("file",{name:_,dir:b,date:g,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=d}catch(_){u.error(_)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,r,i){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new a;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(a.prototype=e("./object")).loadAsync=e("./load"),a.support=e("./support"),a.defaults=e("./defaults"),a.version="3.10.1",a.loadAsync=function(s,o){return new a().loadAsync(s,o)},a.external=e("./external"),r.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,r,i){var a=e("./utils"),s=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),u=e("./nodejsUtils");function d(_){return new s.Promise(function(f,p){var h=_.decompressed.getContentWorker().pipe(new c);h.on("error",function(b){p(b)}).on("end",function(){h.streamInfo.crc32!==_.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(_,f){var p=this;return f=a.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(_)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",_,!0,f.optimizedBinaryString,f.base64).then(function(h){var b=new l(f);return b.load(h),b}).then(function(h){var b=[s.Promise.resolve(h)],g=h.files;if(f.checkCRC32)for(var v=0;v<g.length;v++)b.push(d(g[v]));return s.Promise.all(b)}).then(function(h){for(var b=h.shift(),g=b.files,v=0;v<g.length;v++){var y=g[v],E=y.fileNameStr,S=a.resolve(y.fileNameStr);p.file(S,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:f.createFolders}),y.dir||(p.file(S).unsafeOriginalName=E)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,r,i){var a=e("../utils"),s=e("../stream/GenericWorker");function o(l,c){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}a.inherits(o,s),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(u){c.push({data:u,meta:{percent:0}})}).on("error",function(u){c.isPaused?this.generatedError=u:c.error(u)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,r,i){var a=e("readable-stream").Readable;function s(o,l,c){a.call(this,l),this._helper=o;var u=this;o.on("data",function(d,_){u.push(d)||u._helper.pause(),c&&c(_)}).on("error",function(d){u.emit("error",d)}).on("end",function(){u.push(null)})}e("../utils").inherits(s,a),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(a,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,s);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,s)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var s=new Buffer(a);return s.fill(0),s},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(e,r,i){function a(S,O,A){var U,D=o.getTypeOf(O),R=o.extend(A||{},u);R.date=R.date||new Date,R.compression!==null&&(R.compression=R.compression.toUpperCase()),typeof R.unixPermissions=="string"&&(R.unixPermissions=parseInt(R.unixPermissions,8)),R.unixPermissions&&16384&R.unixPermissions&&(R.dir=!0),R.dosPermissions&&16&R.dosPermissions&&(R.dir=!0),R.dir&&(S=g(S)),R.createFolders&&(U=b(S))&&v.call(this,U,!0);var j=D==="string"&&R.binary===!1&&R.base64===!1;A&&A.binary!==void 0||(R.binary=!j),(O instanceof d&&O.uncompressedSize===0||R.dir||!O||O.length===0)&&(R.base64=!1,R.binary=!0,O="",R.compression="STORE",D="string");var C=null;C=O instanceof d||O instanceof l?O:p.isNode&&p.isStream(O)?new h(S,O):o.prepareContent(S,O,R.binary,R.optimizedBinaryString,R.base64);var $=new _(S,C,R);this.files[S]=$}var s=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),u=e("./defaults"),d=e("./compressedObject"),_=e("./zipObject"),f=e("./generate"),p=e("./nodejsUtils"),h=e("./nodejs/NodejsStreamInputAdapter"),b=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var O=S.lastIndexOf("/");return 0<O?S.substring(0,O):""},g=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},v=function(S,O){return O=O!==void 0?O:u.createFolders,S=g(S),this.files[S]||a.call(this,S,null,{dir:!0,createFolders:O}),this.files[S]};function y(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var O,A,U;for(O in this.files)U=this.files[O],(A=O.slice(this.root.length,O.length))&&O.slice(0,this.root.length)===this.root&&S(A,U)},filter:function(S){var O=[];return this.forEach(function(A,U){S(A,U)&&O.push(U)}),O},file:function(S,O,A){if(arguments.length!==1)return S=this.root+S,a.call(this,S,O,A),this;if(y(S)){var U=S;return this.filter(function(R,j){return!j.dir&&U.test(R)})}var D=this.files[this.root+S];return D&&!D.dir?D:null},folder:function(S){if(!S)return this;if(y(S))return this.filter(function(D,R){return R.dir&&S.test(D)});var O=this.root+S,A=v.call(this,O),U=this.clone();return U.root=A.name,U},remove:function(S){S=this.root+S;var O=this.files[S];if(O||(S.slice(-1)!=="/"&&(S+="/"),O=this.files[S]),O&&!O.dir)delete this.files[S];else for(var A=this.filter(function(D,R){return R.name.slice(0,S.length)===S}),U=0;U<A.length;U++)delete this.files[A[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var O,A={};try{if((A=o.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var U=A.comment||this.comment||"";O=f.generateWorker(this,A,U)}catch(D){(O=new l("error")).error(D)}return new c(O,A.type||"string",A.mimeType)},generateAsync:function(S,O){return this.generateInternalStream(S).accumulate(O)},generateNodeStream:function(S,O){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(O)}};r.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,r,i){r.exports=e("stream")},{stream:void 0}],17:[function(e,r,i){var a=e("./DataReader");function s(o){a.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(s,a),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),d=o.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===l&&this.data[_+1]===c&&this.data[_+2]===u&&this.data[_+3]===d)return _-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),d=o.charCodeAt(3),_=this.readData(4);return l===_[0]&&c===_[1]&&u===_[2]&&d===_[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,r,i){var a=e("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},r.exports=s},{"../utils":32}],19:[function(e,r,i){var a=e("./Uint8ArrayReader");function s(o){a.call(this,o)}e("../utils").inherits(s,a),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,r,i){var a=e("./DataReader");function s(o){a.call(this,o)}e("../utils").inherits(s,a),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,r,i){var a=e("./ArrayReader");function s(o){a.call(this,o)}e("../utils").inherits(s,a),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,r,i){var a=e("../utils"),s=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");r.exports=function(d){var _=a.getTypeOf(d);return a.checkSupport(_),_!=="string"||s.uint8array?_==="nodebuffer"?new c(d):s.uint8array?new u(a.transformTo("uint8array",d)):new o(a.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,r,i){var a=e("./GenericWorker"),s=e("../utils");function o(l){a.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,a),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},r.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,r,i){var a=e("./GenericWorker"),s=e("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,a),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},r.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,r,i){var a=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}a.inherits(o,s),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}s.prototype.processChunk.call(this,l)},r.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,r,i){var a=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(u){c.dataIsReady=!0,c.data=u,c.max=u&&u.length||0,c.type=a.getTypeOf(u),c.isPaused||c._tickAndRepeat()},function(u){c.error(u)})}a.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,r,i){function a(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=a},{}],29:[function(e,r,i){var a=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),u=e("../external"),d=null;if(c.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(p,h){return new u.Promise(function(b,g){var v=[],y=p._internalType,E=p._outputType,S=p._mimeType;p.on("data",function(O,A){v.push(O),h&&h(A)}).on("error",function(O){v=[],g(O)}).on("end",function(){try{var O=(function(A,U,D){switch(A){case"blob":return a.newBlob(a.transformTo("arraybuffer",U),D);case"base64":return l.encode(U);default:return a.transformTo(A,U)}})(E,(function(A,U){var D,R=0,j=null,C=0;for(D=0;D<U.length;D++)C+=U[D].length;switch(A){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(j=new Uint8Array(C),D=0;D<U.length;D++)j.set(U[D],R),R+=U[D].length;return j;case"nodebuffer":return Buffer.concat(U);default:throw new Error("concat : unsupported type '"+A+"'")}})(y,v),S);b(O)}catch(A){g(A)}v=[]}).resume()})}function f(p,h,b){var g=h;switch(h){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=h,this._mimeType=b,a.checkSupport(g),this._worker=p.pipe(new s(g)),p.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}f.prototype={accumulate:function(p){return _(this,p)},on:function(p,h){var b=this;return p==="data"?this._worker.on(p,function(g){h.call(b,g.data,g.meta)}):this._worker.on(p,function(){a.delay(h,arguments,b)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var a=new ArrayBuffer(0);try{i.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(a),i.blob=s.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,r,i){for(var a=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function _(){l.call(this,"utf-8 encode")}i.utf8encode=function(f){return s.nodebuffer?o.newBufferFrom(f,"utf-8"):(function(p){var h,b,g,v,y,E=p.length,S=0;for(v=0;v<E;v++)(64512&(b=p.charCodeAt(v)))==55296&&v+1<E&&(64512&(g=p.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),v++),S+=b<128?1:b<2048?2:b<65536?3:4;for(h=s.uint8array?new Uint8Array(S):new Array(S),v=y=0;y<S;v++)(64512&(b=p.charCodeAt(v)))==55296&&v+1<E&&(64512&(g=p.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),v++),b<128?h[y++]=b:(b<2048?h[y++]=192|b>>>6:(b<65536?h[y++]=224|b>>>12:(h[y++]=240|b>>>18,h[y++]=128|b>>>12&63),h[y++]=128|b>>>6&63),h[y++]=128|63&b);return h})(f)},i.utf8decode=function(f){return s.nodebuffer?a.transformTo("nodebuffer",f).toString("utf-8"):(function(p){var h,b,g,v,y=p.length,E=new Array(2*y);for(h=b=0;h<y;)if((g=p[h++])<128)E[b++]=g;else if(4<(v=c[g]))E[b++]=65533,h+=v-1;else{for(g&=v===2?31:v===3?15:7;1<v&&h<y;)g=g<<6|63&p[h++],v--;1<v?E[b++]=65533:g<65536?E[b++]=g:(g-=65536,E[b++]=55296|g>>10&1023,E[b++]=56320|1023&g)}return E.length!==b&&(E.subarray?E=E.subarray(0,b):E.length=b),a.applyFromCharCode(E)})(f=a.transformTo(s.uint8array?"uint8array":"array",f))},a.inherits(d,l),d.prototype.processChunk=function(f){var p=a.transformTo(s.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var h=p;(p=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),p.set(h,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=(function(v,y){var E;for((y=y||v.length)>v.length&&(y=v.length),E=y-1;0<=E&&(192&v[E])==128;)E--;return E<0||E===0?y:E+c[v[E]]>y?E:y})(p),g=p;b!==p.length&&(s.uint8array?(g=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(g=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(g),meta:f.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,a.inherits(_,l),_.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,r,i){var a=e("./support"),s=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(h){return h}function u(h,b){for(var g=0;g<h.length;++g)b[g]=255&h.charCodeAt(g);return b}e("setimmediate"),i.newBlob=function(h,b){i.checkSupport("blob");try{return new Blob([h],{type:b})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(h),g.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(h,b,g){var v=[],y=0,E=h.length;if(E<=g)return String.fromCharCode.apply(null,h);for(;y<E;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,h.slice(y,Math.min(y+g,E)))):v.push(String.fromCharCode.apply(null,h.subarray(y,Math.min(y+g,E)))),y+=g;return v.join("")},stringifyByChar:function(h){for(var b="",g=0;g<h.length;g++)b+=String.fromCharCode(h[g]);return b},applyCanBeUsed:{uint8array:(function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function _(h){var b=65536,g=i.getTypeOf(h),v=!0;if(g==="uint8array"?v=d.applyCanBeUsed.uint8array:g==="nodebuffer"&&(v=d.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return d.stringifyByChunk(h,g,b)}catch{b=Math.floor(b/2)}return d.stringifyByChar(h)}function f(h,b){for(var g=0;g<h.length;g++)b[g]=h[g];return b}i.applyFromCharCode=_;var p={};p.string={string:c,array:function(h){return u(h,new Array(h.length))},arraybuffer:function(h){return p.string.uint8array(h).buffer},uint8array:function(h){return u(h,new Uint8Array(h.length))},nodebuffer:function(h){return u(h,o.allocBuffer(h.length))}},p.array={string:_,array:c,arraybuffer:function(h){return new Uint8Array(h).buffer},uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return o.newBufferFrom(h)}},p.arraybuffer={string:function(h){return _(new Uint8Array(h))},array:function(h){return f(new Uint8Array(h),new Array(h.byteLength))},arraybuffer:c,uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return o.newBufferFrom(new Uint8Array(h))}},p.uint8array={string:_,array:function(h){return f(h,new Array(h.length))},arraybuffer:function(h){return h.buffer},uint8array:c,nodebuffer:function(h){return o.newBufferFrom(h)}},p.nodebuffer={string:_,array:function(h){return f(h,new Array(h.length))},arraybuffer:function(h){return p.nodebuffer.uint8array(h).buffer},uint8array:function(h){return f(h,new Uint8Array(h.length))},nodebuffer:c},i.transformTo=function(h,b){if(b=b||"",!h)return b;i.checkSupport(h);var g=i.getTypeOf(b);return p[g][h](b)},i.resolve=function(h){for(var b=h.split("/"),g=[],v=0;v<b.length;v++){var y=b[v];y==="."||y===""&&v!==0&&v!==b.length-1||(y===".."?g.pop():g.push(y))}return g.join("/")},i.getTypeOf=function(h){return typeof h=="string"?"string":Object.prototype.toString.call(h)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(h)?"nodebuffer":a.uint8array&&h instanceof Uint8Array?"uint8array":a.arraybuffer&&h instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(h){if(!a[h.toLowerCase()])throw new Error(h+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(h){var b,g,v="";for(g=0;g<(h||"").length;g++)v+="\\x"+((b=h.charCodeAt(g))<16?"0":"")+b.toString(16).toUpperCase();return v},i.delay=function(h,b,g){setImmediate(function(){h.apply(g||null,b||[])})},i.inherits=function(h,b){function g(){}g.prototype=b.prototype,h.prototype=new g},i.extend=function(){var h,b,g={};for(h=0;h<arguments.length;h++)for(b in arguments[h])Object.prototype.hasOwnProperty.call(arguments[h],b)&&g[b]===void 0&&(g[b]=arguments[h][b]);return g},i.prepareContent=function(h,b,g,v,y){return l.Promise.resolve(b).then(function(E){return a.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,O){var A=new FileReader;A.onload=function(U){S(U.target.result)},A.onerror=function(U){O(U.target.error)},A.readAsArrayBuffer(E)}):E}).then(function(E){var S=i.getTypeOf(E);return S?(S==="arraybuffer"?E=i.transformTo("uint8array",E):S==="string"&&(y?E=s.decode(E):g&&v!==!0&&(E=(function(O){return u(O,a.uint8array?new Uint8Array(O.length):new Array(O.length))})(E))),E):l.Promise.reject(new Error("Can't read the data of '"+h+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,r,i){var a=e("./reader/readerFor"),s=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function u(d){this.files=[],this.loadOptions=d}u.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(_)+", expected "+s.pretty(d)+")")}},isSignature:function(d,_){var f=this.reader.index;this.reader.setIndex(d);var p=this.reader.readString(4)===_;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),_=c.uint8array?"uint8array":"array",f=s.transformTo(_,d);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,_,f,p=this.zip64EndOfCentralSize-44;0<p;)d=this.reader.readInt(2),_=this.reader.readInt(4),f=this.reader.readData(_),this.zip64ExtensibleData[d]={id:d,length:_,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,_;for(d=0;d<this.files.length;d++)_=this.files[d],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var _=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=_-f;if(0<p)this.isSignature(_,o.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(d){this.reader=a(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,r,i){var a=e("./reader/readerFor"),s=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),u=e("./compressions"),d=e("./support");function _(f,p){this.options=f,this.loadOptions=p}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,h;if(f.skip(22),this.fileNameLength=f.readInt(2),h=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(h),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=(function(b){for(var g in u)if(Object.prototype.hasOwnProperty.call(u,g)&&u[g].magic===b)return u[g];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=a(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,h,b,g=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<g;)p=f.readInt(2),h=f.readInt(2),b=f.readData(h),this.extraFields[p]={id:p,length:h,value:b};f.setIndex(g)},handleUTF8:function(){var f=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var h=s.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(h)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var g=s.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=a(f.value);return p.readInt(1)!==1||l(this.fileName)!==p.readInt(4)?null:c.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=a(f.value);return p.readInt(1)!==1||l(this.fileComment)!==p.readInt(4)?null:c.utf8decode(p.readData(f.length-5))}return null}},r.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,r,i){function a(p,h,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=h,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var s=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),u=e("./stream/GenericWorker");a.prototype={internalStream:function(p){var h=null,b="string";try{if(!p)throw new Error("No output type specified.");var g=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),h=this._decompressWorker();var v=!this._dataBinary;v&&!g&&(h=h.pipe(new l.Utf8EncodeWorker)),!v&&g&&(h=h.pipe(new l.Utf8DecodeWorker))}catch(y){(h=new u("error")).error(y)}return new s(h,b,"")},async:function(p,h){return this.internalStream(p).accumulate(h)},nodeStream:function(p,h){return this.internalStream(p||"nodebuffer").toNodejsStream(h)},_compressWorker:function(p,h){if(this._data instanceof c&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,p,h)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<d.length;f++)a.prototype[d[f]]=_;r.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,i){(function(a){var s,o,l=a.MutationObserver||a.WebKitMutationObserver;if(l){var c=0,u=new l(p),d=a.document.createTextNode("");u.observe(d,{characterData:!0}),s=function(){d.data=c=++c%2}}else if(a.setImmediate||a.MessageChannel===void 0)s="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var h=a.document.createElement("script");h.onreadystatechange=function(){p(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},a.document.documentElement.appendChild(h)}:function(){setTimeout(p,0)};else{var _=new a.MessageChannel;_.port1.onmessage=p,s=function(){_.port2.postMessage(0)}}var f=[];function p(){var h,b;o=!0;for(var g=f.length;g;){for(b=f,f=[],h=-1;++h<g;)b[h]();g=f.length}o=!1}r.exports=function(h){f.push(h)!==1||o||s()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,r,i){var a=e("immediate");function s(){}var o={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function d(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,g!==s&&h(this,g)}function _(g,v,y){this.promise=g,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function f(g,v,y){a(function(){var E;try{E=v(y)}catch(S){return o.reject(g,S)}E===g?o.reject(g,new TypeError("Cannot resolve promise with itself")):o.resolve(g,E)})}function p(g){var v=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof v=="function")return function(){v.apply(g,arguments)}}function h(g,v){var y=!1;function E(A){y||(y=!0,o.reject(g,A))}function S(A){y||(y=!0,o.resolve(g,A))}var O=b(function(){v(S,E)});O.status==="error"&&E(O.value)}function b(g,v){var y={};try{y.value=g(v),y.status="success"}catch(E){y.status="error",y.value=E}return y}(r.exports=d).prototype.finally=function(g){if(typeof g!="function")return this;var v=this.constructor;return this.then(function(y){return v.resolve(g()).then(function(){return y})},function(y){return v.resolve(g()).then(function(){throw y})})},d.prototype.catch=function(g){return this.then(null,g)},d.prototype.then=function(g,v){if(typeof g!="function"&&this.state===c||typeof v!="function"&&this.state===l)return this;var y=new this.constructor(s);return this.state!==u?f(y,this.state===c?g:v,this.outcome):this.queue.push(new _(y,g,v)),y},_.prototype.callFulfilled=function(g){o.resolve(this.promise,g)},_.prototype.otherCallFulfilled=function(g){f(this.promise,this.onFulfilled,g)},_.prototype.callRejected=function(g){o.reject(this.promise,g)},_.prototype.otherCallRejected=function(g){f(this.promise,this.onRejected,g)},o.resolve=function(g,v){var y=b(p,v);if(y.status==="error")return o.reject(g,y.value);var E=y.value;if(E)h(g,E);else{g.state=c,g.outcome=v;for(var S=-1,O=g.queue.length;++S<O;)g.queue[S].callFulfilled(v)}return g},o.reject=function(g,v){g.state=l,g.outcome=v;for(var y=-1,E=g.queue.length;++y<E;)g.queue[y].callRejected(v);return g},d.resolve=function(g){return g instanceof this?g:o.resolve(new this(s),g)},d.reject=function(g){var v=new this(s);return o.reject(v,g)},d.all=function(g){var v=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=g.length,E=!1;if(!y)return this.resolve([]);for(var S=new Array(y),O=0,A=-1,U=new this(s);++A<y;)D(g[A],A);return U;function D(R,j){v.resolve(R).then(function(C){S[j]=C,++O!==y||E||(E=!0,o.resolve(U,S))},function(C){E||(E=!0,o.reject(U,C))})}},d.race=function(g){var v=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=g.length,E=!1;if(!y)return this.resolve([]);for(var S=-1,O=new this(s);++S<y;)A=g[S],v.resolve(A).then(function(U){E||(E=!0,o.resolve(O,U))},function(U){E||(E=!0,o.reject(O,U))});var A;return O}},{immediate:36}],38:[function(e,r,i){var a={};(0,e("./lib/utils/common").assign)(a,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),r.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,r,i){var a=e("./zlib/deflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),u=Object.prototype.toString,d=0,_=-1,f=0,p=8;function h(g){if(!(this instanceof h))return new h(g);this.options=s.assign({level:_,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},g||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=a.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(y!==d)throw new Error(l[y]);if(v.header&&a.deflateSetHeader(this.strm,v.header),v.dictionary){var E;if(E=typeof v.dictionary=="string"?o.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(y=a.deflateSetDictionary(this.strm,E))!==d)throw new Error(l[y]);this._dict_set=!0}}function b(g,v){var y=new h(v);if(y.push(g,!0),y.err)throw y.msg||l[y.err];return y.result}h.prototype.push=function(g,v){var y,E,S=this.strm,O=this.options.chunkSize;if(this.ended)return!1;E=v===~~v?v:v===!0?4:0,typeof g=="string"?S.input=o.string2buf(g):u.call(g)==="[object ArrayBuffer]"?S.input=new Uint8Array(g):S.input=g,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new s.Buf8(O),S.next_out=0,S.avail_out=O),(y=a.deflate(S,E))!==1&&y!==d)return this.onEnd(y),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(S.output,S.next_out))):this.onData(s.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&y!==1);return E===4?(y=a.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===d):E!==2||(this.onEnd(d),!(S.avail_out=0))},h.prototype.onData=function(g){this.chunks.push(g)},h.prototype.onEnd=function(g){g===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Deflate=h,i.deflate=b,i.deflateRaw=function(g,v){return(v=v||{}).raw=!0,b(g,v)},i.gzip=function(g,v){return(v=v||{}).gzip=!0,b(g,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,r,i){var a=e("./zlib/inflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),u=e("./zlib/zstream"),d=e("./zlib/gzheader"),_=Object.prototype.toString;function f(h){if(!(this instanceof f))return new f(h);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},h||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||h&&h.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&(15&b.windowBits)==0&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var g=a.inflateInit2(this.strm,b.windowBits);if(g!==l.Z_OK)throw new Error(c[g]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}function p(h,b){var g=new f(b);if(g.push(h,!0),g.err)throw g.msg||c[g.err];return g.result}f.prototype.push=function(h,b){var g,v,y,E,S,O,A=this.strm,U=this.options.chunkSize,D=this.options.dictionary,R=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof h=="string"?A.input=o.binstring2buf(h):_.call(h)==="[object ArrayBuffer]"?A.input=new Uint8Array(h):A.input=h,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new s.Buf8(U),A.next_out=0,A.avail_out=U),(g=a.inflate(A,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&D&&(O=typeof D=="string"?o.string2buf(D):_.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,g=a.inflateSetDictionary(this.strm,O)),g===l.Z_BUF_ERROR&&R===!0&&(g=l.Z_OK,R=!1),g!==l.Z_STREAM_END&&g!==l.Z_OK)return this.onEnd(g),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&g!==l.Z_STREAM_END&&(A.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(A.output,A.next_out),E=A.next_out-y,S=o.buf2string(A.output,y),A.next_out=E,A.avail_out=U-E,E&&s.arraySet(A.output,A.output,y,E,0),this.onData(S)):this.onData(s.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(R=!0)}while((0<A.avail_in||A.avail_out===0)&&g!==l.Z_STREAM_END);return g===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(g=a.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(A.avail_out=0))},f.prototype.onData=function(h){this.chunks.push(h)},f.prototype.onEnd=function(h){h===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(h,b){return(b=b||{}).raw=!0,p(h,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,r,i){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var u=c.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var d in u)u.hasOwnProperty(d)&&(l[d]=u[d])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var s={arraySet:function(l,c,u,d,_){if(c.subarray&&l.subarray)l.set(c.subarray(u,u+d),_);else for(var f=0;f<d;f++)l[_+f]=c[u+f]},flattenChunks:function(l){var c,u,d,_,f,p;for(c=d=0,u=l.length;c<u;c++)d+=l[c].length;for(p=new Uint8Array(d),c=_=0,u=l.length;c<u;c++)f=l[c],p.set(f,_),_+=f.length;return p}},o={arraySet:function(l,c,u,d,_){for(var f=0;f<d;f++)l[_+f]=c[u+f]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,s)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(a)},{}],42:[function(e,r,i){var a=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new a.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(d,_){if(_<65537&&(d.subarray&&o||!d.subarray&&s))return String.fromCharCode.apply(null,a.shrinkBuf(d,_));for(var f="",p=0;p<_;p++)f+=String.fromCharCode(d[p]);return f}l[254]=l[254]=1,i.string2buf=function(d){var _,f,p,h,b,g=d.length,v=0;for(h=0;h<g;h++)(64512&(f=d.charCodeAt(h)))==55296&&h+1<g&&(64512&(p=d.charCodeAt(h+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),h++),v+=f<128?1:f<2048?2:f<65536?3:4;for(_=new a.Buf8(v),h=b=0;b<v;h++)(64512&(f=d.charCodeAt(h)))==55296&&h+1<g&&(64512&(p=d.charCodeAt(h+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),h++),f<128?_[b++]=f:(f<2048?_[b++]=192|f>>>6:(f<65536?_[b++]=224|f>>>12:(_[b++]=240|f>>>18,_[b++]=128|f>>>12&63),_[b++]=128|f>>>6&63),_[b++]=128|63&f);return _},i.buf2binstring=function(d){return u(d,d.length)},i.binstring2buf=function(d){for(var _=new a.Buf8(d.length),f=0,p=_.length;f<p;f++)_[f]=d.charCodeAt(f);return _},i.buf2string=function(d,_){var f,p,h,b,g=_||d.length,v=new Array(2*g);for(f=p=0;f<g;)if((h=d[f++])<128)v[p++]=h;else if(4<(b=l[h]))v[p++]=65533,f+=b-1;else{for(h&=b===2?31:b===3?15:7;1<b&&f<g;)h=h<<6|63&d[f++],b--;1<b?v[p++]=65533:h<65536?v[p++]=h:(h-=65536,v[p++]=55296|h>>10&1023,v[p++]=56320|1023&h)}return u(v,p)},i.utf8border=function(d,_){var f;for((_=_||d.length)>d.length&&(_=d.length),f=_-1;0<=f&&(192&d[f])==128;)f--;return f<0||f===0?_:f+l[d[f]]>_?f:_}},{"./common":41}],43:[function(e,r,i){r.exports=function(a,s,o,l){for(var c=65535&a|0,u=a>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;u=u+(c=c+s[l++]|0)|0,--d;);c%=65521,u%=65521}return c|u<<16|0}},{}],44:[function(e,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,r,i){var a=(function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o})();r.exports=function(s,o,l,c){var u=a,d=c+l;s^=-1;for(var _=c;_<d;_++)s=s>>>8^u[255&(s^o[_])];return-1^s}},{}],46:[function(e,r,i){var a,s=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),u=e("./messages"),d=0,_=4,f=0,p=-2,h=-1,b=4,g=2,v=8,y=9,E=286,S=30,O=19,A=2*E+1,U=15,D=3,R=258,j=R+D+1,C=42,$=113,w=1,V=2,lt=3,K=4;function st(m,L){return m.msg=u[L],L}function x(m){return(m<<1)-(4<m?9:0)}function tt(m){for(var L=m.length;0<=--L;)m[L]=0}function B(m){var L=m.state,H=L.pending;H>m.avail_out&&(H=m.avail_out),H!==0&&(s.arraySet(m.output,L.pending_buf,L.pending_out,H,m.next_out),m.next_out+=H,L.pending_out+=H,m.total_out+=H,m.avail_out-=H,L.pending-=H,L.pending===0&&(L.pending_out=0))}function z(m,L){o._tr_flush_block(m,0<=m.block_start?m.block_start:-1,m.strstart-m.block_start,L),m.block_start=m.strstart,B(m.strm)}function dt(m,L){m.pending_buf[m.pending++]=L}function ot(m,L){m.pending_buf[m.pending++]=L>>>8&255,m.pending_buf[m.pending++]=255&L}function at(m,L){var H,F,k=m.max_chain_length,N=m.strstart,X=m.prev_length,J=m.nice_match,I=m.strstart>m.w_size-j?m.strstart-(m.w_size-j):0,et=m.window,Q=m.w_mask,nt=m.prev,ut=m.strstart+R,W=et[N+X-1],rt=et[N+X];m.prev_length>=m.good_match&&(k>>=2),J>m.lookahead&&(J=m.lookahead);do if(et[(H=L)+X]===rt&&et[H+X-1]===W&&et[H]===et[N]&&et[++H]===et[N+1]){N+=2,H++;do;while(et[++N]===et[++H]&&et[++N]===et[++H]&&et[++N]===et[++H]&&et[++N]===et[++H]&&et[++N]===et[++H]&&et[++N]===et[++H]&&et[++N]===et[++H]&&et[++N]===et[++H]&&N<ut);if(F=R-(ut-N),N=ut-R,X<F){if(m.match_start=L,J<=(X=F))break;W=et[N+X-1],rt=et[N+X]}}while((L=nt[L&Q])>I&&--k!=0);return X<=m.lookahead?X:m.lookahead}function Nt(m){var L,H,F,k,N,X,J,I,et,Q,nt=m.w_size;do{if(k=m.window_size-m.lookahead-m.strstart,m.strstart>=nt+(nt-j)){for(s.arraySet(m.window,m.window,nt,nt,0),m.match_start-=nt,m.strstart-=nt,m.block_start-=nt,L=H=m.hash_size;F=m.head[--L],m.head[L]=nt<=F?F-nt:0,--H;);for(L=H=nt;F=m.prev[--L],m.prev[L]=nt<=F?F-nt:0,--H;);k+=nt}if(m.strm.avail_in===0)break;if(X=m.strm,J=m.window,I=m.strstart+m.lookahead,et=k,Q=void 0,Q=X.avail_in,et<Q&&(Q=et),H=Q===0?0:(X.avail_in-=Q,s.arraySet(J,X.input,X.next_in,Q,I),X.state.wrap===1?X.adler=l(X.adler,J,Q,I):X.state.wrap===2&&(X.adler=c(X.adler,J,Q,I)),X.next_in+=Q,X.total_in+=Q,Q),m.lookahead+=H,m.lookahead+m.insert>=D)for(N=m.strstart-m.insert,m.ins_h=m.window[N],m.ins_h=(m.ins_h<<m.hash_shift^m.window[N+1])&m.hash_mask;m.insert&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[N+D-1])&m.hash_mask,m.prev[N&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=N,N++,m.insert--,!(m.lookahead+m.insert<D)););}while(m.lookahead<j&&m.strm.avail_in!==0)}function Mt(m,L){for(var H,F;;){if(m.lookahead<j){if(Nt(m),m.lookahead<j&&L===d)return w;if(m.lookahead===0)break}if(H=0,m.lookahead>=D&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+D-1])&m.hash_mask,H=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),H!==0&&m.strstart-H<=m.w_size-j&&(m.match_length=at(m,H)),m.match_length>=D)if(F=o._tr_tally(m,m.strstart-m.match_start,m.match_length-D),m.lookahead-=m.match_length,m.match_length<=m.max_lazy_match&&m.lookahead>=D){for(m.match_length--;m.strstart++,m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+D-1])&m.hash_mask,H=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart,--m.match_length!=0;);m.strstart++}else m.strstart+=m.match_length,m.match_length=0,m.ins_h=m.window[m.strstart],m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+1])&m.hash_mask;else F=o._tr_tally(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++;if(F&&(z(m,!1),m.strm.avail_out===0))return w}return m.insert=m.strstart<D-1?m.strstart:D-1,L===_?(z(m,!0),m.strm.avail_out===0?lt:K):m.last_lit&&(z(m,!1),m.strm.avail_out===0)?w:V}function wt(m,L){for(var H,F,k;;){if(m.lookahead<j){if(Nt(m),m.lookahead<j&&L===d)return w;if(m.lookahead===0)break}if(H=0,m.lookahead>=D&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+D-1])&m.hash_mask,H=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),m.prev_length=m.match_length,m.prev_match=m.match_start,m.match_length=D-1,H!==0&&m.prev_length<m.max_lazy_match&&m.strstart-H<=m.w_size-j&&(m.match_length=at(m,H),m.match_length<=5&&(m.strategy===1||m.match_length===D&&4096<m.strstart-m.match_start)&&(m.match_length=D-1)),m.prev_length>=D&&m.match_length<=m.prev_length){for(k=m.strstart+m.lookahead-D,F=o._tr_tally(m,m.strstart-1-m.prev_match,m.prev_length-D),m.lookahead-=m.prev_length-1,m.prev_length-=2;++m.strstart<=k&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+D-1])&m.hash_mask,H=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),--m.prev_length!=0;);if(m.match_available=0,m.match_length=D-1,m.strstart++,F&&(z(m,!1),m.strm.avail_out===0))return w}else if(m.match_available){if((F=o._tr_tally(m,0,m.window[m.strstart-1]))&&z(m,!1),m.strstart++,m.lookahead--,m.strm.avail_out===0)return w}else m.match_available=1,m.strstart++,m.lookahead--}return m.match_available&&(F=o._tr_tally(m,0,m.window[m.strstart-1]),m.match_available=0),m.insert=m.strstart<D-1?m.strstart:D-1,L===_?(z(m,!0),m.strm.avail_out===0?lt:K):m.last_lit&&(z(m,!1),m.strm.avail_out===0)?w:V}function yt(m,L,H,F,k){this.good_length=m,this.max_lazy=L,this.nice_length=H,this.max_chain=F,this.func=k}function Ut(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*A),this.dyn_dtree=new s.Buf16(2*(2*S+1)),this.bl_tree=new s.Buf16(2*(2*O+1)),tt(this.dyn_ltree),tt(this.dyn_dtree),tt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(U+1),this.heap=new s.Buf16(2*E+1),tt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*E+1),tt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dt(m){var L;return m&&m.state?(m.total_in=m.total_out=0,m.data_type=g,(L=m.state).pending=0,L.pending_out=0,L.wrap<0&&(L.wrap=-L.wrap),L.status=L.wrap?C:$,m.adler=L.wrap===2?0:1,L.last_flush=d,o._tr_init(L),f):st(m,p)}function te(m){var L=Dt(m);return L===f&&(function(H){H.window_size=2*H.w_size,tt(H.head),H.max_lazy_match=a[H.level].max_lazy,H.good_match=a[H.level].good_length,H.nice_match=a[H.level].nice_length,H.max_chain_length=a[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=D-1,H.match_available=0,H.ins_h=0})(m.state),L}function Gt(m,L,H,F,k,N){if(!m)return p;var X=1;if(L===h&&(L=6),F<0?(X=0,F=-F):15<F&&(X=2,F-=16),k<1||y<k||H!==v||F<8||15<F||L<0||9<L||N<0||b<N)return st(m,p);F===8&&(F=9);var J=new Ut;return(m.state=J).strm=m,J.wrap=X,J.gzhead=null,J.w_bits=F,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=k+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+D-1)/D),J.window=new s.Buf8(2*J.w_size),J.head=new s.Buf16(J.hash_size),J.prev=new s.Buf16(J.w_size),J.lit_bufsize=1<<k+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new s.Buf8(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=L,J.strategy=N,J.method=H,te(m)}a=[new yt(0,0,0,0,function(m,L){var H=65535;for(H>m.pending_buf_size-5&&(H=m.pending_buf_size-5);;){if(m.lookahead<=1){if(Nt(m),m.lookahead===0&&L===d)return w;if(m.lookahead===0)break}m.strstart+=m.lookahead,m.lookahead=0;var F=m.block_start+H;if((m.strstart===0||m.strstart>=F)&&(m.lookahead=m.strstart-F,m.strstart=F,z(m,!1),m.strm.avail_out===0)||m.strstart-m.block_start>=m.w_size-j&&(z(m,!1),m.strm.avail_out===0))return w}return m.insert=0,L===_?(z(m,!0),m.strm.avail_out===0?lt:K):(m.strstart>m.block_start&&(z(m,!1),m.strm.avail_out),w)}),new yt(4,4,8,4,Mt),new yt(4,5,16,8,Mt),new yt(4,6,32,32,Mt),new yt(4,4,16,16,wt),new yt(8,16,32,32,wt),new yt(8,16,128,128,wt),new yt(8,32,128,256,wt),new yt(32,128,258,1024,wt),new yt(32,258,258,4096,wt)],i.deflateInit=function(m,L){return Gt(m,L,v,15,8,0)},i.deflateInit2=Gt,i.deflateReset=te,i.deflateResetKeep=Dt,i.deflateSetHeader=function(m,L){return m&&m.state?m.state.wrap!==2?p:(m.state.gzhead=L,f):p},i.deflate=function(m,L){var H,F,k,N;if(!m||!m.state||5<L||L<0)return m?st(m,p):p;if(F=m.state,!m.output||!m.input&&m.avail_in!==0||F.status===666&&L!==_)return st(m,m.avail_out===0?-5:p);if(F.strm=m,H=F.last_flush,F.last_flush=L,F.status===C)if(F.wrap===2)m.adler=0,dt(F,31),dt(F,139),dt(F,8),F.gzhead?(dt(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),dt(F,255&F.gzhead.time),dt(F,F.gzhead.time>>8&255),dt(F,F.gzhead.time>>16&255),dt(F,F.gzhead.time>>24&255),dt(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),dt(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(dt(F,255&F.gzhead.extra.length),dt(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(m.adler=c(m.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(dt(F,0),dt(F,0),dt(F,0),dt(F,0),dt(F,0),dt(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),dt(F,3),F.status=$);else{var X=v+(F.w_bits-8<<4)<<8;X|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(X|=32),X+=31-X%31,F.status=$,ot(F,X),F.strstart!==0&&(ot(F,m.adler>>>16),ot(F,65535&m.adler)),m.adler=1}if(F.status===69)if(F.gzhead.extra){for(k=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>k&&(m.adler=c(m.adler,F.pending_buf,F.pending-k,k)),B(m),k=F.pending,F.pending!==F.pending_buf_size));)dt(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>k&&(m.adler=c(m.adler,F.pending_buf,F.pending-k,k)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){k=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>k&&(m.adler=c(m.adler,F.pending_buf,F.pending-k,k)),B(m),k=F.pending,F.pending===F.pending_buf_size)){N=1;break}N=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,dt(F,N)}while(N!==0);F.gzhead.hcrc&&F.pending>k&&(m.adler=c(m.adler,F.pending_buf,F.pending-k,k)),N===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){k=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>k&&(m.adler=c(m.adler,F.pending_buf,F.pending-k,k)),B(m),k=F.pending,F.pending===F.pending_buf_size)){N=1;break}N=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,dt(F,N)}while(N!==0);F.gzhead.hcrc&&F.pending>k&&(m.adler=c(m.adler,F.pending_buf,F.pending-k,k)),N===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&B(m),F.pending+2<=F.pending_buf_size&&(dt(F,255&m.adler),dt(F,m.adler>>8&255),m.adler=0,F.status=$)):F.status=$),F.pending!==0){if(B(m),m.avail_out===0)return F.last_flush=-1,f}else if(m.avail_in===0&&x(L)<=x(H)&&L!==_)return st(m,-5);if(F.status===666&&m.avail_in!==0)return st(m,-5);if(m.avail_in!==0||F.lookahead!==0||L!==d&&F.status!==666){var J=F.strategy===2?(function(I,et){for(var Q;;){if(I.lookahead===0&&(Nt(I),I.lookahead===0)){if(et===d)return w;break}if(I.match_length=0,Q=o._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++,Q&&(z(I,!1),I.strm.avail_out===0))return w}return I.insert=0,et===_?(z(I,!0),I.strm.avail_out===0?lt:K):I.last_lit&&(z(I,!1),I.strm.avail_out===0)?w:V})(F,L):F.strategy===3?(function(I,et){for(var Q,nt,ut,W,rt=I.window;;){if(I.lookahead<=R){if(Nt(I),I.lookahead<=R&&et===d)return w;if(I.lookahead===0)break}if(I.match_length=0,I.lookahead>=D&&0<I.strstart&&(nt=rt[ut=I.strstart-1])===rt[++ut]&&nt===rt[++ut]&&nt===rt[++ut]){W=I.strstart+R;do;while(nt===rt[++ut]&&nt===rt[++ut]&&nt===rt[++ut]&&nt===rt[++ut]&&nt===rt[++ut]&&nt===rt[++ut]&&nt===rt[++ut]&&nt===rt[++ut]&&ut<W);I.match_length=R-(W-ut),I.match_length>I.lookahead&&(I.match_length=I.lookahead)}if(I.match_length>=D?(Q=o._tr_tally(I,1,I.match_length-D),I.lookahead-=I.match_length,I.strstart+=I.match_length,I.match_length=0):(Q=o._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++),Q&&(z(I,!1),I.strm.avail_out===0))return w}return I.insert=0,et===_?(z(I,!0),I.strm.avail_out===0?lt:K):I.last_lit&&(z(I,!1),I.strm.avail_out===0)?w:V})(F,L):a[F.level].func(F,L);if(J!==lt&&J!==K||(F.status=666),J===w||J===lt)return m.avail_out===0&&(F.last_flush=-1),f;if(J===V&&(L===1?o._tr_align(F):L!==5&&(o._tr_stored_block(F,0,0,!1),L===3&&(tt(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),B(m),m.avail_out===0))return F.last_flush=-1,f}return L!==_?f:F.wrap<=0?1:(F.wrap===2?(dt(F,255&m.adler),dt(F,m.adler>>8&255),dt(F,m.adler>>16&255),dt(F,m.adler>>24&255),dt(F,255&m.total_in),dt(F,m.total_in>>8&255),dt(F,m.total_in>>16&255),dt(F,m.total_in>>24&255)):(ot(F,m.adler>>>16),ot(F,65535&m.adler)),B(m),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?f:1)},i.deflateEnd=function(m){var L;return m&&m.state?(L=m.state.status)!==C&&L!==69&&L!==73&&L!==91&&L!==103&&L!==$&&L!==666?st(m,p):(m.state=null,L===$?st(m,-3):f):p},i.deflateSetDictionary=function(m,L){var H,F,k,N,X,J,I,et,Q=L.length;if(!m||!m.state||(N=(H=m.state).wrap)===2||N===1&&H.status!==C||H.lookahead)return p;for(N===1&&(m.adler=l(m.adler,L,Q,0)),H.wrap=0,Q>=H.w_size&&(N===0&&(tt(H.head),H.strstart=0,H.block_start=0,H.insert=0),et=new s.Buf8(H.w_size),s.arraySet(et,L,Q-H.w_size,H.w_size,0),L=et,Q=H.w_size),X=m.avail_in,J=m.next_in,I=m.input,m.avail_in=Q,m.next_in=0,m.input=L,Nt(H);H.lookahead>=D;){for(F=H.strstart,k=H.lookahead-(D-1);H.ins_h=(H.ins_h<<H.hash_shift^H.window[F+D-1])&H.hash_mask,H.prev[F&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=F,F++,--k;);H.strstart=F,H.lookahead=D-1,Nt(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=D-1,H.match_available=0,m.next_in=J,m.input=I,m.avail_in=X,H.wrap=N,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,r,i){r.exports=function(a,s){var o,l,c,u,d,_,f,p,h,b,g,v,y,E,S,O,A,U,D,R,j,C,$,w,V;o=a.state,l=a.next_in,w=a.input,c=l+(a.avail_in-5),u=a.next_out,V=a.output,d=u-(s-a.avail_out),_=u+(a.avail_out-257),f=o.dmax,p=o.wsize,h=o.whave,b=o.wnext,g=o.window,v=o.hold,y=o.bits,E=o.lencode,S=o.distcode,O=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;t:do{y<15&&(v+=w[l++]<<y,y+=8,v+=w[l++]<<y,y+=8),U=E[v&O];e:for(;;){if(v>>>=D=U>>>24,y-=D,(D=U>>>16&255)===0)V[u++]=65535&U;else{if(!(16&D)){if((64&D)==0){U=E[(65535&U)+(v&(1<<D)-1)];continue e}if(32&D){o.mode=12;break t}a.msg="invalid literal/length code",o.mode=30;break t}R=65535&U,(D&=15)&&(y<D&&(v+=w[l++]<<y,y+=8),R+=v&(1<<D)-1,v>>>=D,y-=D),y<15&&(v+=w[l++]<<y,y+=8,v+=w[l++]<<y,y+=8),U=S[v&A];n:for(;;){if(v>>>=D=U>>>24,y-=D,!(16&(D=U>>>16&255))){if((64&D)==0){U=S[(65535&U)+(v&(1<<D)-1)];continue n}a.msg="invalid distance code",o.mode=30;break t}if(j=65535&U,y<(D&=15)&&(v+=w[l++]<<y,(y+=8)<D&&(v+=w[l++]<<y,y+=8)),f<(j+=v&(1<<D)-1)){a.msg="invalid distance too far back",o.mode=30;break t}if(v>>>=D,y-=D,(D=u-d)<j){if(h<(D=j-D)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break t}if($=g,(C=0)===b){if(C+=p-D,D<R){for(R-=D;V[u++]=g[C++],--D;);C=u-j,$=V}}else if(b<D){if(C+=p+b-D,(D-=b)<R){for(R-=D;V[u++]=g[C++],--D;);if(C=0,b<R){for(R-=D=b;V[u++]=g[C++],--D;);C=u-j,$=V}}}else if(C+=b-D,D<R){for(R-=D;V[u++]=g[C++],--D;);C=u-j,$=V}for(;2<R;)V[u++]=$[C++],V[u++]=$[C++],V[u++]=$[C++],R-=3;R&&(V[u++]=$[C++],1<R&&(V[u++]=$[C++]))}else{for(C=u-j;V[u++]=V[C++],V[u++]=V[C++],V[u++]=V[C++],2<(R-=3););R&&(V[u++]=V[C++],1<R&&(V[u++]=V[C++]))}break}}break}}while(l<c&&u<_);l-=R=y>>3,v&=(1<<(y-=R<<3))-1,a.next_in=l,a.next_out=u,a.avail_in=l<c?c-l+5:5-(l-c),a.avail_out=u<_?_-u+257:257-(u-_),o.hold=v,o.bits=y}},{}],49:[function(e,r,i){var a=e("../utils/common"),s=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),u=1,d=2,_=0,f=-2,p=1,h=852,b=592;function g(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(C){var $;return C&&C.state?($=C.state,C.total_in=C.total_out=$.total=0,C.msg="",$.wrap&&(C.adler=1&$.wrap),$.mode=p,$.last=0,$.havedict=0,$.dmax=32768,$.head=null,$.hold=0,$.bits=0,$.lencode=$.lendyn=new a.Buf32(h),$.distcode=$.distdyn=new a.Buf32(b),$.sane=1,$.back=-1,_):f}function E(C){var $;return C&&C.state?(($=C.state).wsize=0,$.whave=0,$.wnext=0,y(C)):f}function S(C,$){var w,V;return C&&C.state?(V=C.state,$<0?(w=0,$=-$):(w=1+($>>4),$<48&&($&=15)),$&&($<8||15<$)?f:(V.window!==null&&V.wbits!==$&&(V.window=null),V.wrap=w,V.wbits=$,E(C))):f}function O(C,$){var w,V;return C?(V=new v,(C.state=V).window=null,(w=S(C,$))!==_&&(C.state=null),w):f}var A,U,D=!0;function R(C){if(D){var $;for(A=new a.Buf32(512),U=new a.Buf32(32),$=0;$<144;)C.lens[$++]=8;for(;$<256;)C.lens[$++]=9;for(;$<280;)C.lens[$++]=7;for(;$<288;)C.lens[$++]=8;for(c(u,C.lens,0,288,A,0,C.work,{bits:9}),$=0;$<32;)C.lens[$++]=5;c(d,C.lens,0,32,U,0,C.work,{bits:5}),D=!1}C.lencode=A,C.lenbits=9,C.distcode=U,C.distbits=5}function j(C,$,w,V){var lt,K=C.state;return K.window===null&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new a.Buf8(K.wsize)),V>=K.wsize?(a.arraySet(K.window,$,w-K.wsize,K.wsize,0),K.wnext=0,K.whave=K.wsize):(V<(lt=K.wsize-K.wnext)&&(lt=V),a.arraySet(K.window,$,w-V,lt,K.wnext),(V-=lt)?(a.arraySet(K.window,$,w-V,V,0),K.wnext=V,K.whave=K.wsize):(K.wnext+=lt,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=lt))),0}i.inflateReset=E,i.inflateReset2=S,i.inflateResetKeep=y,i.inflateInit=function(C){return O(C,15)},i.inflateInit2=O,i.inflate=function(C,$){var w,V,lt,K,st,x,tt,B,z,dt,ot,at,Nt,Mt,wt,yt,Ut,Dt,te,Gt,m,L,H,F,k=0,N=new a.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return f;(w=C.state).mode===12&&(w.mode=13),st=C.next_out,lt=C.output,tt=C.avail_out,K=C.next_in,V=C.input,x=C.avail_in,B=w.hold,z=w.bits,dt=x,ot=tt,L=_;t:for(;;)switch(w.mode){case p:if(w.wrap===0){w.mode=13;break}for(;z<16;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if(2&w.wrap&&B===35615){N[w.check=0]=255&B,N[1]=B>>>8&255,w.check=o(w.check,N,2,0),z=B=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&B)<<8)+(B>>8))%31){C.msg="incorrect header check",w.mode=30;break}if((15&B)!=8){C.msg="unknown compression method",w.mode=30;break}if(z-=4,m=8+(15&(B>>>=4)),w.wbits===0)w.wbits=m;else if(m>w.wbits){C.msg="invalid window size",w.mode=30;break}w.dmax=1<<m,C.adler=w.check=1,w.mode=512&B?10:12,z=B=0;break;case 2:for(;z<16;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if(w.flags=B,(255&w.flags)!=8){C.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){C.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=B>>8&1),512&w.flags&&(N[0]=255&B,N[1]=B>>>8&255,w.check=o(w.check,N,2,0)),z=B=0,w.mode=3;case 3:for(;z<32;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}w.head&&(w.head.time=B),512&w.flags&&(N[0]=255&B,N[1]=B>>>8&255,N[2]=B>>>16&255,N[3]=B>>>24&255,w.check=o(w.check,N,4,0)),z=B=0,w.mode=4;case 4:for(;z<16;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}w.head&&(w.head.xflags=255&B,w.head.os=B>>8),512&w.flags&&(N[0]=255&B,N[1]=B>>>8&255,w.check=o(w.check,N,2,0)),z=B=0,w.mode=5;case 5:if(1024&w.flags){for(;z<16;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}w.length=B,w.head&&(w.head.extra_len=B),512&w.flags&&(N[0]=255&B,N[1]=B>>>8&255,w.check=o(w.check,N,2,0)),z=B=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(x<(at=w.length)&&(at=x),at&&(w.head&&(m=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),a.arraySet(w.head.extra,V,K,at,m)),512&w.flags&&(w.check=o(w.check,V,at,K)),x-=at,K+=at,w.length-=at),w.length))break t;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(x===0)break t;for(at=0;m=V[K+at++],w.head&&m&&w.length<65536&&(w.head.name+=String.fromCharCode(m)),m&&at<x;);if(512&w.flags&&(w.check=o(w.check,V,at,K)),x-=at,K+=at,m)break t}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(x===0)break t;for(at=0;m=V[K+at++],w.head&&m&&w.length<65536&&(w.head.comment+=String.fromCharCode(m)),m&&at<x;);if(512&w.flags&&(w.check=o(w.check,V,at,K)),x-=at,K+=at,m)break t}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;z<16;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if(B!==(65535&w.check)){C.msg="header crc mismatch",w.mode=30;break}z=B=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),C.adler=w.check=0,w.mode=12;break;case 10:for(;z<32;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}C.adler=w.check=g(B),z=B=0,w.mode=11;case 11:if(w.havedict===0)return C.next_out=st,C.avail_out=tt,C.next_in=K,C.avail_in=x,w.hold=B,w.bits=z,2;C.adler=w.check=1,w.mode=12;case 12:if($===5||$===6)break t;case 13:if(w.last){B>>>=7&z,z-=7&z,w.mode=27;break}for(;z<3;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}switch(w.last=1&B,z-=1,3&(B>>>=1)){case 0:w.mode=14;break;case 1:if(R(w),w.mode=20,$!==6)break;B>>>=2,z-=2;break t;case 2:w.mode=17;break;case 3:C.msg="invalid block type",w.mode=30}B>>>=2,z-=2;break;case 14:for(B>>>=7&z,z-=7&z;z<32;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if((65535&B)!=(B>>>16^65535)){C.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&B,z=B=0,w.mode=15,$===6)break t;case 15:w.mode=16;case 16:if(at=w.length){if(x<at&&(at=x),tt<at&&(at=tt),at===0)break t;a.arraySet(lt,V,K,at,st),x-=at,K+=at,tt-=at,st+=at,w.length-=at;break}w.mode=12;break;case 17:for(;z<14;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if(w.nlen=257+(31&B),B>>>=5,z-=5,w.ndist=1+(31&B),B>>>=5,z-=5,w.ncode=4+(15&B),B>>>=4,z-=4,286<w.nlen||30<w.ndist){C.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;z<3;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}w.lens[X[w.have++]]=7&B,B>>>=3,z-=3}for(;w.have<19;)w.lens[X[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,H={bits:w.lenbits},L=c(0,w.lens,0,19,w.lencode,0,w.work,H),w.lenbits=H.bits,L){C.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;yt=(k=w.lencode[B&(1<<w.lenbits)-1])>>>16&255,Ut=65535&k,!((wt=k>>>24)<=z);){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if(Ut<16)B>>>=wt,z-=wt,w.lens[w.have++]=Ut;else{if(Ut===16){for(F=wt+2;z<F;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if(B>>>=wt,z-=wt,w.have===0){C.msg="invalid bit length repeat",w.mode=30;break}m=w.lens[w.have-1],at=3+(3&B),B>>>=2,z-=2}else if(Ut===17){for(F=wt+3;z<F;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}z-=wt,m=0,at=3+(7&(B>>>=wt)),B>>>=3,z-=3}else{for(F=wt+7;z<F;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}z-=wt,m=0,at=11+(127&(B>>>=wt)),B>>>=7,z-=7}if(w.have+at>w.nlen+w.ndist){C.msg="invalid bit length repeat",w.mode=30;break}for(;at--;)w.lens[w.have++]=m}}if(w.mode===30)break;if(w.lens[256]===0){C.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,H={bits:w.lenbits},L=c(u,w.lens,0,w.nlen,w.lencode,0,w.work,H),w.lenbits=H.bits,L){C.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,H={bits:w.distbits},L=c(d,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,H),w.distbits=H.bits,L){C.msg="invalid distances set",w.mode=30;break}if(w.mode=20,$===6)break t;case 20:w.mode=21;case 21:if(6<=x&&258<=tt){C.next_out=st,C.avail_out=tt,C.next_in=K,C.avail_in=x,w.hold=B,w.bits=z,l(C,ot),st=C.next_out,lt=C.output,tt=C.avail_out,K=C.next_in,V=C.input,x=C.avail_in,B=w.hold,z=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;yt=(k=w.lencode[B&(1<<w.lenbits)-1])>>>16&255,Ut=65535&k,!((wt=k>>>24)<=z);){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if(yt&&(240&yt)==0){for(Dt=wt,te=yt,Gt=Ut;yt=(k=w.lencode[Gt+((B&(1<<Dt+te)-1)>>Dt)])>>>16&255,Ut=65535&k,!(Dt+(wt=k>>>24)<=z);){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}B>>>=Dt,z-=Dt,w.back+=Dt}if(B>>>=wt,z-=wt,w.back+=wt,w.length=Ut,yt===0){w.mode=26;break}if(32&yt){w.back=-1,w.mode=12;break}if(64&yt){C.msg="invalid literal/length code",w.mode=30;break}w.extra=15&yt,w.mode=22;case 22:if(w.extra){for(F=w.extra;z<F;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}w.length+=B&(1<<w.extra)-1,B>>>=w.extra,z-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;yt=(k=w.distcode[B&(1<<w.distbits)-1])>>>16&255,Ut=65535&k,!((wt=k>>>24)<=z);){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if((240&yt)==0){for(Dt=wt,te=yt,Gt=Ut;yt=(k=w.distcode[Gt+((B&(1<<Dt+te)-1)>>Dt)])>>>16&255,Ut=65535&k,!(Dt+(wt=k>>>24)<=z);){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}B>>>=Dt,z-=Dt,w.back+=Dt}if(B>>>=wt,z-=wt,w.back+=wt,64&yt){C.msg="invalid distance code",w.mode=30;break}w.offset=Ut,w.extra=15&yt,w.mode=24;case 24:if(w.extra){for(F=w.extra;z<F;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}w.offset+=B&(1<<w.extra)-1,B>>>=w.extra,z-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){C.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(tt===0)break t;if(at=ot-tt,w.offset>at){if((at=w.offset-at)>w.whave&&w.sane){C.msg="invalid distance too far back",w.mode=30;break}Nt=at>w.wnext?(at-=w.wnext,w.wsize-at):w.wnext-at,at>w.length&&(at=w.length),Mt=w.window}else Mt=lt,Nt=st-w.offset,at=w.length;for(tt<at&&(at=tt),tt-=at,w.length-=at;lt[st++]=Mt[Nt++],--at;);w.length===0&&(w.mode=21);break;case 26:if(tt===0)break t;lt[st++]=w.length,tt--,w.mode=21;break;case 27:if(w.wrap){for(;z<32;){if(x===0)break t;x--,B|=V[K++]<<z,z+=8}if(ot-=tt,C.total_out+=ot,w.total+=ot,ot&&(C.adler=w.check=w.flags?o(w.check,lt,ot,st-ot):s(w.check,lt,ot,st-ot)),ot=tt,(w.flags?B:g(B))!==w.check){C.msg="incorrect data check",w.mode=30;break}z=B=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;z<32;){if(x===0)break t;x--,B+=V[K++]<<z,z+=8}if(B!==(4294967295&w.total)){C.msg="incorrect length check",w.mode=30;break}z=B=0}w.mode=29;case 29:L=1;break t;case 30:L=-3;break t;case 31:return-4;case 32:default:return f}return C.next_out=st,C.avail_out=tt,C.next_in=K,C.avail_in=x,w.hold=B,w.bits=z,(w.wsize||ot!==C.avail_out&&w.mode<30&&(w.mode<27||$!==4))&&j(C,C.output,C.next_out,ot-C.avail_out)?(w.mode=31,-4):(dt-=C.avail_in,ot-=C.avail_out,C.total_in+=dt,C.total_out+=ot,w.total+=ot,w.wrap&&ot&&(C.adler=w.check=w.flags?o(w.check,lt,ot,C.next_out-ot):s(w.check,lt,ot,C.next_out-ot)),C.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(dt==0&&ot===0||$===4)&&L===_&&(L=-5),L)},i.inflateEnd=function(C){if(!C||!C.state)return f;var $=C.state;return $.window&&($.window=null),C.state=null,_},i.inflateGetHeader=function(C,$){var w;return C&&C.state?(2&(w=C.state).wrap)==0?f:((w.head=$).done=!1,_):f},i.inflateSetDictionary=function(C,$){var w,V=$.length;return C&&C.state?(w=C.state).wrap!==0&&w.mode!==11?f:w.mode===11&&s(1,$,V,0)!==w.check?-3:j(C,$,V,V)?(w.mode=31,-4):(w.havedict=1,_):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,r,i){var a=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,d,_,f,p,h,b,g){var v,y,E,S,O,A,U,D,R,j=g.bits,C=0,$=0,w=0,V=0,lt=0,K=0,st=0,x=0,tt=0,B=0,z=null,dt=0,ot=new a.Buf16(16),at=new a.Buf16(16),Nt=null,Mt=0;for(C=0;C<=15;C++)ot[C]=0;for($=0;$<f;$++)ot[d[_+$]]++;for(lt=j,V=15;1<=V&&ot[V]===0;V--);if(V<lt&&(lt=V),V===0)return p[h++]=20971520,p[h++]=20971520,g.bits=1,0;for(w=1;w<V&&ot[w]===0;w++);for(lt<w&&(lt=w),C=x=1;C<=15;C++)if(x<<=1,(x-=ot[C])<0)return-1;if(0<x&&(u===0||V!==1))return-1;for(at[1]=0,C=1;C<15;C++)at[C+1]=at[C]+ot[C];for($=0;$<f;$++)d[_+$]!==0&&(b[at[d[_+$]]++]=$);if(A=u===0?(z=Nt=b,19):u===1?(z=s,dt-=257,Nt=o,Mt-=257,256):(z=l,Nt=c,-1),C=w,O=h,st=$=B=0,E=-1,S=(tt=1<<(K=lt))-1,u===1&&852<tt||u===2&&592<tt)return 1;for(;;){for(U=C-st,R=b[$]<A?(D=0,b[$]):b[$]>A?(D=Nt[Mt+b[$]],z[dt+b[$]]):(D=96,0),v=1<<C-st,w=y=1<<K;p[O+(B>>st)+(y-=v)]=U<<24|D<<16|R|0,y!==0;);for(v=1<<C-1;B&v;)v>>=1;if(v!==0?(B&=v-1,B+=v):B=0,$++,--ot[C]==0){if(C===V)break;C=d[_+b[$]]}if(lt<C&&(B&S)!==E){for(st===0&&(st=lt),O+=w,x=1<<(K=C-st);K+st<V&&!((x-=ot[K+st])<=0);)K++,x<<=1;if(tt+=1<<K,u===1&&852<tt||u===2&&592<tt)return 1;p[E=B&S]=lt<<24|K<<16|O-h|0}}return B!==0&&(p[O+B]=C-st<<24|64<<16|0),g.bits=lt,0}},{"../utils/common":41}],51:[function(e,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,r,i){var a=e("../utils/common"),s=0,o=1;function l(k){for(var N=k.length;0<=--N;)k[N]=0}var c=0,u=29,d=256,_=d+1+u,f=30,p=19,h=2*_+1,b=15,g=16,v=7,y=256,E=16,S=17,O=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=new Array(2*(_+2));l(j);var C=new Array(2*f);l(C);var $=new Array(512);l($);var w=new Array(256);l(w);var V=new Array(u);l(V);var lt,K,st,x=new Array(f);function tt(k,N,X,J,I){this.static_tree=k,this.extra_bits=N,this.extra_base=X,this.elems=J,this.max_length=I,this.has_stree=k&&k.length}function B(k,N){this.dyn_tree=k,this.max_code=0,this.stat_desc=N}function z(k){return k<256?$[k]:$[256+(k>>>7)]}function dt(k,N){k.pending_buf[k.pending++]=255&N,k.pending_buf[k.pending++]=N>>>8&255}function ot(k,N,X){k.bi_valid>g-X?(k.bi_buf|=N<<k.bi_valid&65535,dt(k,k.bi_buf),k.bi_buf=N>>g-k.bi_valid,k.bi_valid+=X-g):(k.bi_buf|=N<<k.bi_valid&65535,k.bi_valid+=X)}function at(k,N,X){ot(k,X[2*N],X[2*N+1])}function Nt(k,N){for(var X=0;X|=1&k,k>>>=1,X<<=1,0<--N;);return X>>>1}function Mt(k,N,X){var J,I,et=new Array(b+1),Q=0;for(J=1;J<=b;J++)et[J]=Q=Q+X[J-1]<<1;for(I=0;I<=N;I++){var nt=k[2*I+1];nt!==0&&(k[2*I]=Nt(et[nt]++,nt))}}function wt(k){var N;for(N=0;N<_;N++)k.dyn_ltree[2*N]=0;for(N=0;N<f;N++)k.dyn_dtree[2*N]=0;for(N=0;N<p;N++)k.bl_tree[2*N]=0;k.dyn_ltree[2*y]=1,k.opt_len=k.static_len=0,k.last_lit=k.matches=0}function yt(k){8<k.bi_valid?dt(k,k.bi_buf):0<k.bi_valid&&(k.pending_buf[k.pending++]=k.bi_buf),k.bi_buf=0,k.bi_valid=0}function Ut(k,N,X,J){var I=2*N,et=2*X;return k[I]<k[et]||k[I]===k[et]&&J[N]<=J[X]}function Dt(k,N,X){for(var J=k.heap[X],I=X<<1;I<=k.heap_len&&(I<k.heap_len&&Ut(N,k.heap[I+1],k.heap[I],k.depth)&&I++,!Ut(N,J,k.heap[I],k.depth));)k.heap[X]=k.heap[I],X=I,I<<=1;k.heap[X]=J}function te(k,N,X){var J,I,et,Q,nt=0;if(k.last_lit!==0)for(;J=k.pending_buf[k.d_buf+2*nt]<<8|k.pending_buf[k.d_buf+2*nt+1],I=k.pending_buf[k.l_buf+nt],nt++,J===0?at(k,I,N):(at(k,(et=w[I])+d+1,N),(Q=A[et])!==0&&ot(k,I-=V[et],Q),at(k,et=z(--J),X),(Q=U[et])!==0&&ot(k,J-=x[et],Q)),nt<k.last_lit;);at(k,y,N)}function Gt(k,N){var X,J,I,et=N.dyn_tree,Q=N.stat_desc.static_tree,nt=N.stat_desc.has_stree,ut=N.stat_desc.elems,W=-1;for(k.heap_len=0,k.heap_max=h,X=0;X<ut;X++)et[2*X]!==0?(k.heap[++k.heap_len]=W=X,k.depth[X]=0):et[2*X+1]=0;for(;k.heap_len<2;)et[2*(I=k.heap[++k.heap_len]=W<2?++W:0)]=1,k.depth[I]=0,k.opt_len--,nt&&(k.static_len-=Q[2*I+1]);for(N.max_code=W,X=k.heap_len>>1;1<=X;X--)Dt(k,et,X);for(I=ut;X=k.heap[1],k.heap[1]=k.heap[k.heap_len--],Dt(k,et,1),J=k.heap[1],k.heap[--k.heap_max]=X,k.heap[--k.heap_max]=J,et[2*I]=et[2*X]+et[2*J],k.depth[I]=(k.depth[X]>=k.depth[J]?k.depth[X]:k.depth[J])+1,et[2*X+1]=et[2*J+1]=I,k.heap[1]=I++,Dt(k,et,1),2<=k.heap_len;);k.heap[--k.heap_max]=k.heap[1],(function(rt,vt){var Rt,Wt,Pt,Ft,ee,kt,qt=vt.dyn_tree,Te=vt.max_code,Oe=vt.stat_desc.static_tree,_n=vt.stat_desc.has_stree,Vn=vt.stat_desc.extra_bits,bn=vt.stat_desc.extra_base,xe=vt.stat_desc.max_length,Be=0;for(Ft=0;Ft<=b;Ft++)rt.bl_count[Ft]=0;for(qt[2*rt.heap[rt.heap_max]+1]=0,Rt=rt.heap_max+1;Rt<h;Rt++)xe<(Ft=qt[2*qt[2*(Wt=rt.heap[Rt])+1]+1]+1)&&(Ft=xe,Be++),qt[2*Wt+1]=Ft,Te<Wt||(rt.bl_count[Ft]++,ee=0,bn<=Wt&&(ee=Vn[Wt-bn]),kt=qt[2*Wt],rt.opt_len+=kt*(Ft+ee),_n&&(rt.static_len+=kt*(Oe[2*Wt+1]+ee)));if(Be!==0){do{for(Ft=xe-1;rt.bl_count[Ft]===0;)Ft--;rt.bl_count[Ft]--,rt.bl_count[Ft+1]+=2,rt.bl_count[xe]--,Be-=2}while(0<Be);for(Ft=xe;Ft!==0;Ft--)for(Wt=rt.bl_count[Ft];Wt!==0;)Te<(Pt=rt.heap[--Rt])||(qt[2*Pt+1]!==Ft&&(rt.opt_len+=(Ft-qt[2*Pt+1])*qt[2*Pt],qt[2*Pt+1]=Ft),Wt--)}})(k,N),Mt(et,W,k.bl_count)}function m(k,N,X){var J,I,et=-1,Q=N[1],nt=0,ut=7,W=4;for(Q===0&&(ut=138,W=3),N[2*(X+1)+1]=65535,J=0;J<=X;J++)I=Q,Q=N[2*(J+1)+1],++nt<ut&&I===Q||(nt<W?k.bl_tree[2*I]+=nt:I!==0?(I!==et&&k.bl_tree[2*I]++,k.bl_tree[2*E]++):nt<=10?k.bl_tree[2*S]++:k.bl_tree[2*O]++,et=I,W=(nt=0)===Q?(ut=138,3):I===Q?(ut=6,3):(ut=7,4))}function L(k,N,X){var J,I,et=-1,Q=N[1],nt=0,ut=7,W=4;for(Q===0&&(ut=138,W=3),J=0;J<=X;J++)if(I=Q,Q=N[2*(J+1)+1],!(++nt<ut&&I===Q)){if(nt<W)for(;at(k,I,k.bl_tree),--nt!=0;);else I!==0?(I!==et&&(at(k,I,k.bl_tree),nt--),at(k,E,k.bl_tree),ot(k,nt-3,2)):nt<=10?(at(k,S,k.bl_tree),ot(k,nt-3,3)):(at(k,O,k.bl_tree),ot(k,nt-11,7));et=I,W=(nt=0)===Q?(ut=138,3):I===Q?(ut=6,3):(ut=7,4)}}l(x);var H=!1;function F(k,N,X,J){ot(k,(c<<1)+(J?1:0),3),(function(I,et,Q,nt){yt(I),dt(I,Q),dt(I,~Q),a.arraySet(I.pending_buf,I.window,et,Q,I.pending),I.pending+=Q})(k,N,X)}i._tr_init=function(k){H||((function(){var N,X,J,I,et,Q=new Array(b+1);for(I=J=0;I<u-1;I++)for(V[I]=J,N=0;N<1<<A[I];N++)w[J++]=I;for(w[J-1]=I,I=et=0;I<16;I++)for(x[I]=et,N=0;N<1<<U[I];N++)$[et++]=I;for(et>>=7;I<f;I++)for(x[I]=et<<7,N=0;N<1<<U[I]-7;N++)$[256+et++]=I;for(X=0;X<=b;X++)Q[X]=0;for(N=0;N<=143;)j[2*N+1]=8,N++,Q[8]++;for(;N<=255;)j[2*N+1]=9,N++,Q[9]++;for(;N<=279;)j[2*N+1]=7,N++,Q[7]++;for(;N<=287;)j[2*N+1]=8,N++,Q[8]++;for(Mt(j,_+1,Q),N=0;N<f;N++)C[2*N+1]=5,C[2*N]=Nt(N,5);lt=new tt(j,A,d+1,_,b),K=new tt(C,U,0,f,b),st=new tt(new Array(0),D,0,p,v)})(),H=!0),k.l_desc=new B(k.dyn_ltree,lt),k.d_desc=new B(k.dyn_dtree,K),k.bl_desc=new B(k.bl_tree,st),k.bi_buf=0,k.bi_valid=0,wt(k)},i._tr_stored_block=F,i._tr_flush_block=function(k,N,X,J){var I,et,Q=0;0<k.level?(k.strm.data_type===2&&(k.strm.data_type=(function(nt){var ut,W=4093624447;for(ut=0;ut<=31;ut++,W>>>=1)if(1&W&&nt.dyn_ltree[2*ut]!==0)return s;if(nt.dyn_ltree[18]!==0||nt.dyn_ltree[20]!==0||nt.dyn_ltree[26]!==0)return o;for(ut=32;ut<d;ut++)if(nt.dyn_ltree[2*ut]!==0)return o;return s})(k)),Gt(k,k.l_desc),Gt(k,k.d_desc),Q=(function(nt){var ut;for(m(nt,nt.dyn_ltree,nt.l_desc.max_code),m(nt,nt.dyn_dtree,nt.d_desc.max_code),Gt(nt,nt.bl_desc),ut=p-1;3<=ut&&nt.bl_tree[2*R[ut]+1]===0;ut--);return nt.opt_len+=3*(ut+1)+5+5+4,ut})(k),I=k.opt_len+3+7>>>3,(et=k.static_len+3+7>>>3)<=I&&(I=et)):I=et=X+5,X+4<=I&&N!==-1?F(k,N,X,J):k.strategy===4||et===I?(ot(k,2+(J?1:0),3),te(k,j,C)):(ot(k,4+(J?1:0),3),(function(nt,ut,W,rt){var vt;for(ot(nt,ut-257,5),ot(nt,W-1,5),ot(nt,rt-4,4),vt=0;vt<rt;vt++)ot(nt,nt.bl_tree[2*R[vt]+1],3);L(nt,nt.dyn_ltree,ut-1),L(nt,nt.dyn_dtree,W-1)})(k,k.l_desc.max_code+1,k.d_desc.max_code+1,Q+1),te(k,k.dyn_ltree,k.dyn_dtree)),wt(k),J&&yt(k)},i._tr_tally=function(k,N,X){return k.pending_buf[k.d_buf+2*k.last_lit]=N>>>8&255,k.pending_buf[k.d_buf+2*k.last_lit+1]=255&N,k.pending_buf[k.l_buf+k.last_lit]=255&X,k.last_lit++,N===0?k.dyn_ltree[2*X]++:(k.matches++,N--,k.dyn_ltree[2*(w[X]+d+1)]++,k.dyn_dtree[2*z(N)]++),k.last_lit===k.lit_bufsize-1},i._tr_align=function(k){ot(k,2,3),at(k,y,j),(function(N){N.bi_valid===16?(dt(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):8<=N.bi_valid&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)})(k)}},{"../utils/common":41}],53:[function(e,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,r,i){(function(a){(function(s,o){if(!s.setImmediate){var l,c,u,d,_=1,f={},p=!1,h=s.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(s);b=b&&b.setTimeout?b:s,l={}.toString.call(s.process)==="[object process]"?function(E){process.nextTick(function(){v(E)})}:(function(){if(s.postMessage&&!s.importScripts){var E=!0,S=s.onmessage;return s.onmessage=function(){E=!1},s.postMessage("","*"),s.onmessage=S,E}})()?(d="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",y,!1):s.attachEvent("onmessage",y),function(E){s.postMessage(d+E,"*")}):s.MessageChannel?((u=new MessageChannel).port1.onmessage=function(E){v(E.data)},function(E){u.port2.postMessage(E)}):h&&"onreadystatechange"in h.createElement("script")?(c=h.documentElement,function(E){var S=h.createElement("script");S.onreadystatechange=function(){v(E),S.onreadystatechange=null,c.removeChild(S),S=null},c.appendChild(S)}):function(E){setTimeout(v,0,E)},b.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var S=new Array(arguments.length-1),O=0;O<S.length;O++)S[O]=arguments[O+1];var A={callback:E,args:S};return f[_]=A,l(_),_++},b.clearImmediate=g}function g(E){delete f[E]}function v(E){if(p)setTimeout(v,0,E);else{var S=f[E];if(S){p=!0;try{(function(O){var A=O.callback,U=O.args;switch(U.length){case 0:A();break;case 1:A(U[0]);break;case 2:A(U[0],U[1]);break;case 3:A(U[0],U[1],U[2]);break;default:A.apply(o,U)}})(S)}finally{g(E),p=!1}}}}function y(E){E.source===s&&typeof E.data=="string"&&E.data.indexOf(d)===0&&v(+E.data.slice(d.length))}})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(tr)),tr.exports}var us=fs();const Dr=cs(us);class ds{constructor(t,e){this.app=t,this.settings=e}get maxBackups(){return this.settings?.maxBackups??5}get maxBackupAgeDays(){return this.settings?.maxBackupAgeDays??30}async createBackup(t,e){try{const r=this.app.vault.getAbstractFileByPath(t);if(!r||!(r instanceof T.TFolder))return G(`${Z} Draft folder not found: ${t}`),!1;const i=this.getAllFilesInFolder(r);if(i.length===0)return G(`${Z} No files to backup in: ${t}`),!1;const a=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=t.split("/").pop()||"unknown",l=`${qe(e)}/${a}/${s}/${o}`;await this.app.vault.adapter.exists(l)||await this.app.vault.createFolder(l);const u=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),d=`${o}_${u}${un}`,_=`${l}/${d}`,f=new Dr;for(const b of i){const g=b.path.substring(t.length+1),v=await this.app.vault.read(b);f.file(g,v)}const p=await f.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}),h=new Uint8Array(p).buffer;return await this.app.vault.createBinary(_,h),G(`${Z} Created backup: ${_}`),!0}catch(r){return G(`${Z} Failed to create backup:`,r),!1}}async listBackups(t,e){try{const r=t.split("/")[0]||"unknown",i=t.split("/")[1]||"drafts",a=t.split("/").pop()||"unknown",s=`${qe(e)}/${r}/${i}/${a}`,o=this.app.vault.getAbstractFileByPath(s);if(!o||!(o instanceof T.TFolder))return[];const l=t.split("/").pop()||"unknown",c=[];for(const u of o.children)if(u instanceof T.TFile&&u.name.startsWith(`${l}_`)&&u.name.endsWith(un)){const d=u.name.match(Ii);d&&c.push(d[1])}return c.sort().reverse()}catch(r){return G(`${Z} Failed to list backups:`,r),[]}}async restoreBackup(t,e,r){try{const i=t.split("/")[0]||"unknown",a=t.split("/")[1]||"drafts",s=t.split("/").pop()||"unknown",o=`${qe(r)}/${i}/${a}/${s}`,l=`${s}_${e}${un}`,c=`${o}/${l}`;if(!await this.app.vault.adapter.stat(c))return G(`${Z} Backup file not found: ${c}`),!1;const d=await this.app.vault.adapter.readBinary(c),_=await Dr.loadAsync(d);this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);for(const[p,h]of Object.entries(_.files))if(h.dir){const b=`${t}/${p}`;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b)}else{const b=await h.async("text"),g=`${t}/${p}`,v=g.substring(0,g.lastIndexOf("/"));this.app.vault.getAbstractFileByPath(v)||await this.app.vault.createFolder(v);const y=this.app.vault.getAbstractFileByPath(g);y&&y instanceof T.TFile?await this.app.vault.modify(y,b):await this.app.vault.create(g,b)}return G(`${Z} Restored backup: ${c}`),!0}catch(i){return G(`${Z} Failed to restore backup:`,i),!1}}async deleteBackup(t,e,r){try{const i=t.split("/")[0]||"unknown",a=t.split("/")[1]||"drafts",s=t.split("/").pop()||"unknown",o=`${qe(r)}/${i}/${a}/${s}`,l=`${s}_${e}${un}`,c=`${o}/${l}`;return await this.app.vault.adapter.stat(c)?(await this.app.vault.adapter.remove(c),G(`${Z} Deleted backup: ${c}`),!0):(G(`${Z} Backup file not found for deletion: ${c}`),!1)}catch(i){return G(`${Z} Failed to delete backup:`,i),!1}}async clearOldBackups(t,e){try{const r=await this.listBackups(t,e),i=new Date;i.setDate(i.getDate()-this.maxBackupAgeDays);for(const a of r)new Date(a.replace(/-/g,":"))<i&&await this.deleteBackup(t,a,e)}catch(r){G(`${Z} Failed to clear old backups:`,r)}}getAllFilesInFolder(t){const e=[];function r(i){for(const a of i.children)a instanceof T.TFile?e.push(a):a instanceof T.TFolder&&r(a)}return r(t),e}}class hs{constructor(t){this.app=t,this.manager=this.app.plugins.getPlugin?.("obsidian-writeaid-plugin")?.manager??null}async reorderChapters(t,e,r){const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=`${i}/${a}/${e}`;for(let o=0;o<r.length;o++){const{chapterName:l}=r[o],c=`${s}/${l}${St}`,u=this.app.vault.getAbstractFileByPath(c);if(u&&u instanceof T.TFile){let d=await this.app.vault.read(u);d.match(ae)&&(d=d.replace(ae,(_,f)=>{let p=f.replace(/^order:.*\n?/gm,"");return p.endsWith(`
`)||(p+=`
`),p+=`order: ${o+1}
`,`${Lt}
${p}${Lt}`}),await this.app.vault.modify(u,d))}}return!0}async listChapters(t,e){G(`${Z} ChapterFileService.listChapters: projectPath=${t}, draftName=${e}`);const r=this.resolveProjectPath(t);if(!r)return G(`${Z} ChapterFileService.listChapters: no project resolved`),[];const i=this.getDraftsFolderName(r);if(!i)return G(`${Z} ChapterFileService.listChapters: no drafts folder found in project ${r}`),[];const a=`${r}/${i}/${e}`;G(`${Z} ChapterFileService.listChapters: resolved project=${r}, draftsFolder=${i}, draftFolder=${a}`);const s=this.app.vault.getAbstractFileByPath(a),o=[];if(s&&s instanceof T.TFolder){G(`${Z} ChapterFileService.listChapters: found folder with ${s.children.length} children`);for(const l of s.children)l instanceof T.TFile&&l.extension===St.slice(1)&&(G(`${Z} ChapterFileService.listChapters: processing file ${l.path}`),await Kt(async()=>{const c=await this.app.vault.read(l);G(`${Z} ChapterFileService.listChapters: content length ${c.length}`);const u=c.match(ae);let d,_;if(u){G(`${Z} ChapterFileService.listChapters: found frontmatter`);const h=u[1].split(/\r?\n/);for(const b of h){const g=b.match(/^order:\s*(\d+)/i);g&&(d=parseInt(g[1],10));const v=b.match(/^chapter_name:\s*(.*)$/i);if(v){let y=v[1].trim();(y.startsWith('"')&&y.endsWith('"')||y.startsWith("'")&&y.endsWith("'"))&&(y=y.slice(1,-1)),y.length>0&&(_=y)}}}else G(`${Z} ChapterFileService.listChapters: no frontmatter`);G(`${Z} ChapterFileService.listChapters: parsed order=${d}, chapterName=${_}`);const f=_&&_.length>0?_:l.name.replace(new RegExp(`\\${St}$`),""),p=typeof d=="number"&&!isNaN(d)?d:0;G(`${Z} ChapterFileService.listChapters: adding chapter ${l.name} with name ${f}, order ${p}`),o.push({name:l.name.replace(new RegExp(`\\${St}$`),""),chapterName:f,order:p})}))}else G(`${Z} ChapterFileService.listChapters: no folder found`);return o.sort((l,c)=>l.order-c.order),G(`${Z} ChapterFileService.listChapters: returning ${o.length} chapters`),o.map(({name:l,chapterName:c})=>({name:l,chapterName:c}))}async createChapter(t,e,r,i){const a=this.resolveProjectPath(t);if(!a)return!1;const s=this.getDraftsFolderName(a);if(!s)return!1;const o=`${a}/${s}/${e}`,c=`${se(r,i?.slugStyle)}${St}`,u=`${o}/${c}`;if(this.app.vault.getAbstractFileByPath(u))return!1;let d=0;const _=this.app.vault.getAbstractFileByPath(o);if(_&&_ instanceof T.TFolder)for(const b of _.children)b instanceof T.TFile&&b.extension===St.slice(1)&&await Kt(async()=>{const v=(await this.app.vault.read(b)).match(ae);if(v){const y=v[1].split(/\r?\n/);for(const E of y){const S=E.match(/^order:\s*(\d+)/i);if(S){const O=parseInt(S[1],10);!isNaN(O)&&O>d&&(d=O)}}}});const f=d+1;let p=`# ${r}`;const h=`${Lt}
order: ${f}
chapter_name: ${JSON.stringify(r)}
${Lt}
`;return await this.app.vault.create(u,`${h}
${p}

`),!0}async deleteChapter(t,e,r){const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=`${i}/${a}/${e}`,o=`${r}${St}`,l=`${s}/${o}`,c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof T.TFile){await this.app.vault.delete(c);const u=await this.listChapters(t,e);for(let d=0;d<u.length;d++){const{name:_}=u[d],f=`${s}/${_}${St}`,p=this.app.vault.getAbstractFileByPath(f);if(p&&p instanceof T.TFile){let h=await this.app.vault.read(p);h.match(ae)&&(h=h.replace(ae,(b,g)=>{let v=g.replace(/^order:.*\n?/gm,"");return v.endsWith(`
`)||(v+=`
`),v+=`order: ${d+1}
`,`${Lt}
${v}${Lt}`}),await this.app.vault.modify(p,h))}}return!0}return!1}async renameChapter(t,e,r,i){const a=this.resolveProjectPath(t);if(!a)return!1;const s=this.getDraftsFolderName(a);if(!s)return!1;const o=`${a}/${s}/${e}`,l=`${o}/${r}${St}`,c=`${o}/${i}${St}`,u=this.app.vault.getAbstractFileByPath(l);if(!u||!(u instanceof T.TFile))return!1;let d=await this.app.vault.read(u),_=`# ${i}`;return d.match(ae)&&(d=d.replace(ae,(f,p)=>{let h=p.replace(/^chapter_name:.*\n?/gm,"");return h.endsWith(`
`)||(h+=`
`),h+=`chapter_name: ${JSON.stringify(i)}
`,`${Lt}
${h}${Lt}`})),d=d.replace(/^#.*$/m,_),r!==i?(await this.app.vault.create(c,d),await this.app.vault.delete(u)):await this.app.vault.modify(u,d),!0}async openChapter(t,e,r){const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=`${i}/${a}/${e}/${r}${St}`,o=this.app.vault.getAbstractFileByPath(s);return o&&o instanceof T.TFile?(await Kt(async()=>{await this.app.workspace.getLeaf().openFile(o)}),!0):!1}resolveProjectPath(t){return t||this.manager?.activeProject||null}getDraftsFolderName(t){const e=this.app.vault.getAbstractFileByPath(t),r=Vt(this.manager?.settings);if(e&&e instanceof T.TFolder){for(const i of e.children)if(i instanceof T.TFolder&&i.name.toLowerCase()===r.toLowerCase())return i.name}return null}}class Li{constructor(t){this.app=t,G(`${Z} TemplateService created`)}async render(t,e={}){let r=t||"";return G(`${Z} TemplateService.render called with template: "${r.substring(0,100)}${r.length>100?"...":""}", vars:`,Object.keys(e)),!r.includes("{{")&&!r.includes("}}")?(G(`${Z} Template doesn't contain template syntax, checking if it's a file path`),await Kt(async()=>{const i=this.app.vault.getAbstractFileByPath(r);i&&i instanceof T.TFile?(G(`${Z} Reading template from file: ${r}`),r=await this.app.vault.read(i),G(`${Z} Template loaded from file, length: ${r.length} chars`)):G(`${Z} Template path "${r}" is not a valid file, treating as inline template`)})):G(`${Z} Template contains template syntax, treating as inline template`),G(`${Z} Performing template variable substitution`),r=r.replace(/{{\s*(\w+(?:[-:]\w+)*)\s*}}/g,(i,a)=>{if(e[a]!==void 0)return G(`${Z} Substituting variable {{${a}}} with provided value: "${e[a]}"`),e[a];try{const s=window.moment().format(a);return G(`${Z} Substituting {{${a}}} with moment.js format: "${s}"`),s}catch{return G(`${Z} Neither variable nor moment.js format found for {{${a}}}, returning as-is`),a}}),G(`${Z} Template rendering complete, result length: ${r.length} chars`),r}}class Pn{constructor(t){this.app=t,this.manager=this.app.plugins.getPlugin?.("obsidian-writeaid-plugin")?.manager??null,this.tpl=new Li(t),this.projectFileService=new _r(t,this)}async createProject(t,e,r,i,a){if(!t)return new T.Notice("Project name is required."),null;const s=i&&i!==""?`${i}/${t}`:t,o=`${s}/${Vt(a)}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);const l=`${s}/${le(a)}`;if(!this.app.vault.getAbstractFileByPath(l)){const u=e?re.SINGLE:re.MULTI,d=e?a?.defaultSingleTargetWordCount??2e4:a?.defaultMultiTargetWordCount??5e4,_=`${Lt}
project_type: ${u}
target_word_count: ${d}
${Lt}
`;await this.app.vault.create(l,_)}const c=r||"Draft 1";return await this.projectFileService.drafts.createDraft(c,void 0,s,a),s}async openProject(t){const e=`${t}/${le(this.manager?.settings)}`,r=this.app.vault.getAbstractFileByPath(e);if(r&&r instanceof T.TFile)return await this.app.workspace.getLeaf().openFile(r),!0;const i=Ke(this.manager?.settings),a=[`${t}/${t}${St}`,`${t}/Chapter 1${St}`,`${t}/Chapter 01${St}`,`${t}/${i}`,`${t}/${Vt()}/Draft 1/${i}`];for(const s of a){const o=this.app.vault.getAbstractFileByPath(s);if(o&&o instanceof T.TFile)return await this.app.workspace.getLeaf().openFile(o),!0}return new T.Notice("Could not find a file to open in the project."),!1}listAllFolders(){const t=this.app.vault.getRoot(),e=[""];function r(i){for(const a of i.children)a instanceof T.TFolder&&(e.push(a.path),r(a))}return r(t),e}async listProjects(){const t=this.listAllFolders(),e=t.filter(i=>!!i);G(`${Z} allFolders:`,t),G(`${Z} filteredFolders:`,e);const r=await Xe(e,i=>this.isProjectFolder(i));return G(`${Z} found ${e.length} folders, ${r.length} projects:`,r),r}async getProjectType(t){const e=`${t}/${le()}`,r=await He(this.app,e);if(r&&r.project_type){const i=r.project_type;if(Object.values(re).includes(i))return i}return null}getDraftsFolder(t){const e=`${t}/${Vt()}`;let r=this.app.vault.getAbstractFileByPath(e);if(r&&r instanceof T.TFolder)return r;const i=`${t}/Drafts`;return r=this.app.vault.getAbstractFileByPath(i),r&&r instanceof T.TFolder?r:null}async getManuscriptsFolder(t){const e=`${t}/${mr()}`,r=this.app.vault.getAbstractFileByPath(e);return r&&r instanceof T.TFolder?r:null}async isProjectFolder(t){if(!t||typeof t!="string")return!1;const e=t.trim().replace(/\\/g,"/").replace(/\/+$/,"");try{const r=T.normalizePath(`${e}/${le()}`),i=await this.app.vault.adapter.exists(r),a=T.normalizePath(`${e}/${Vt()}`);let s=await this.app.vault.adapter.exists(a);if(!s){const o=T.normalizePath(`${e}/Drafts`);s=await this.app.vault.adapter.exists(o)}if(!i&&!s)return!1;if(i)try{const{readMetaFile:o}=await Promise.resolve().then(()=>lr),{VALID_PROJECT_TYPES:l}=await Promise.resolve().then(()=>Va),c=await o(this.app,r);if(!c||!l.includes(c.project_type))return!1}catch{return!1}return!0}catch{return!1}}}class ps{constructor(t,e,r,i){this.app=t,this.tpl=new Li(t),this.projectSvc=r,this.backupSvc=i,this.chapters=e,this.manager=this.app.plugins.getPlugin?.("obsidian-writeaid-plugin")?.manager??null}resolveProjectPath(t){return t||this.manager?.activeProject||null}getDraftsFolderName(t){const e=this.app.vault.getAbstractFileByPath(t),r=Vt(this.manager?.settings);if(e&&e instanceof T.TFolder){for(const i of e.children)if(i instanceof T.TFolder&&i.name.toLowerCase()===r.toLowerCase())return i.name}return null}async suggestNextDraftName(t){const e=this.resolveProjectPath(t);if(!e)return"Draft 1";const r=`${e}/${le(this.manager?.settings)}`;let i=0;return await Kt(async()=>{const a=await He(this.app,r);a&&typeof a.total_drafts=="number"&&(i=a.total_drafts)}),`Draft ${i+1}`}async createDraft(t,e,r,i){const a=this.resolveProjectPath(r);if(!a){new T.Notice("No project folder detected. Please open a folder named after your project.");return}const o=this.getDraftsFolderName(a)||Vt(this.manager?.settings),l=`${a}/${o}`,c=`${l}/${t}`,u=a.split("/").pop()||a;if(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),e){const d=`${l}/${e}`,_=this.app.vault.getFiles().filter(h=>h.path.startsWith(d)),p=`${se(e,i?.slugStyle)}${St}`;for(const h of _){let b=h.path.substring(d.length+1);b===p&&(b=`${se(t,i?.slugStyle)}${St}`);const g=`${c}/${b}`,v=g.substring(0,g.lastIndexOf("/"));v!==c&&!this.app.vault.getAbstractFileByPath(v)&&await this.app.vault.createFolder(v);let y=await this.app.vault.read(h);y=_s(y,t,u),await this.app.vault.create(g,y)}}else{if(i?.includeDraftOutline===!0){const f=i?.outlineTemplate??"",p=await this.tpl.render(f,{draftName:t});await this.app.vault.create(`${c}/${Ke(this.manager?.settings)}`,p)}if(await this.projectSvc.getProjectType(a)===re.SINGLE){const p=`${se(t,i?.slugStyle)}${St}`,h=`${c}/${p}`;if(!this.app.vault.getAbstractFileByPath(h)){const b=`${Lt}
draft: ${t}
project: ${u}
created: ${new Date().toISOString()}
${Lt}

`,g=await this.tpl.render("# {{draftName}}",{draftName:t});await this.app.vault.create(h,b+g)}}else{const f=this.app.vault.getAbstractFileByPath(c);let p=!1;if(f&&f instanceof T.TFolder){for(const h of f.children)if(h instanceof T.TFile&&h.extension===St.slice(1)&&(await Kt(async()=>{const g=(await this.app.vault.read(h)).match(ae);if(g){const v=g[1].split(/\r?\n/);for(const y of v){const E=y.match(/^order:\s*(\d+)/i);if(E&&!isNaN(parseInt(E[1],10))){p=!0;break}}}}),p))break}p||await this.chapters.createChapter(a,t,"Chapter 1",i)}}await Ye(this.app,a,t,void 0,this.manager?.settings)}listDrafts(t){const e=this.resolveProjectPath(t);if(G(`${Z} listDrafts called with projectPath:`,t,"resolved to:",e),!e)return[];const r=this.projectSvc.getDraftsFolder(e);if(G(`${Z} getDraftsFolder for ${e} returned:`,r?.path,r?.children?.length),r&&r instanceof T.TFolder){const i=r.children.filter(a=>a instanceof T.TFolder).map(a=>a.name);return G(`${Z} found drafts:`,i),i}return[]}async openDraft(t,e){const r=this.resolveProjectPath(t);if(!r)return!1;const i=this.getDraftsFolderName(r);if(!i)return!1;const a=`${r}/${i}/${e}/${Ke(this.manager?.settings)}`,s=this.app.vault.getAbstractFileByPath(a);if(await Kt(async()=>s&&s instanceof T.TFile?(await this.app.workspace.getLeaf().openFile(s),!0):!1))return!0;const l=`${r}/${i}/${e}`,c=this.app.vault.getFiles().filter(u=>u.path.startsWith(l));return c.length>0?(await this.app.workspace.getLeaf().openFile(c[0]),!0):!1}async renameDraft(t,e,r,i=!1,a){const s=this.resolveProjectPath(t);if(!s)return!1;const o=this.getDraftsFolderName(s);if(!o)return!1;const l=`${s}/${o}/${e}`,c=`${s}/${o}/${r}`;try{this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c);const u=this.app.vault.getFiles().filter(b=>b.path.startsWith(l));let d="",_="";if(i){const b=a?.slugStyle;d=se(e,b),_=se(r,b)}for(const b of u){let g=b.path.substring(l.length+1),v=`${c}/${g}`;i&&d&&_&&g===`${d}${St}`&&(g=`${_}${St}`,v=`${c}/${g}`);let y=await this.app.vault.read(b);b.extension===St.slice(1)&&(y=y.replace(new RegExp(`^(${Lt}\\s*\\n[\\s\\S]*?\\n)(draft:.*\\n)?`,"m"),(E,S)=>S.replace(/^draft:.*\n/m,"").replace(new RegExp(`^(${Lt}\\s*\\n)`),`$1draft: ${r}
`))),await this.app.vault.create(v,y),await this.app.vault.delete(b)}const f=this.app.vault.getAbstractFileByPath(l);f&&f instanceof T.TFolder&&await this.app.vault.delete(f,!0),await Kt(async()=>{await Promise.resolve().then(()=>lr).then(b=>b.updateMetaStats(this.app,s,r,void 0,this.manager?.settings))});const p=`${c}/${le(this.manager?.settings)}`;return this.app.vault.getAbstractFileByPath(p)&&await Kt(async()=>{const{readMetaFile:b,writeMetaFile:g}=await Promise.resolve().then(()=>lr),v=await b(this.app,p);v&&(v.draft=r,await g(this.app,p,v))}),!0}catch{return!1}}async deleteDraft(t,e,r=!0){const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=`${i}/${a}/${e}`;try{const o=this.app.vault.getFiles().filter(c=>c.path.startsWith(s));r&&await this.backupSvc.createBackup(s,this.manager?.settings);for(const c of o)await Kt(async()=>{await this.app.vault.delete(c)});const l=this.app.vault.getAbstractFileByPath(s);return l&&l instanceof T.TFolder&&await Kt(async()=>{await this.app.vault.delete(l)}),!0}catch{return!1}}async generateManuscript(t,e,r){const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=await this.projectSvc.getProjectType(i),o=`${i}/${a}/${e}`;if(!this.app.vault.getAbstractFileByPath(o))return new T.Notice(`Draft folder ${o} does not exist.`),!1;const l=`${i}/${mr(this.manager?.settings)}`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);const c=i.split("/").pop()||i,u=r?.manuscriptNameTemplate||"{{draftName}}";G(`${Z} DraftFileService.generateManuscript - manuscriptNameTemplate: "${u}"`),G(`${Z} DraftFileService.generateManuscript - settings object:`,r);const d=se(e,r?.slugStyle),_=await this.tpl.render(u,{draftName:e,projectName:c,draftSlug:d}),f=`${l}/${_}${St}`;let p=`# Manuscript for ${e}

`;if(s===re.SINGLE){const h=`${d}${St}`,b=`${o}/${h}`,g=this.app.vault.getAbstractFileByPath(b);if(g&&g instanceof T.TFile){const v=await this.app.vault.read(g);p+=gs(ms(v));const y=this.app.vault.getAbstractFileByPath(f);if(y&&y instanceof T.TFile){if(!await new zi(this.app,f).open())return!1;G(`${Z} Overwriting existing manuscript: ${f}`),await this.app.vault.modify(y,p)}else G(`${Z} Creating new manuscript: ${f}`),await this.app.vault.create(f,p)}else return new T.Notice(`Main draft file ${b} not found.`),!1}return!0}getOutlineFile(t,e){const r=this.resolveProjectPath(t);if(!r)return null;const i=this.getDraftsFolderName(r);if(!i)return null;const a=`${r}/${i}/${e}/${Ke(this.manager?.settings)}`,s=this.app.vault.getAbstractFileByPath(a);return s&&s instanceof T.TFile?s:null}async createOutline(t,e,r){const i=this.resolveProjectPath(t);if(!i)throw new Error("Project not found");const a=this.getDraftsFolderName(i);if(!a)throw new Error("Drafts folder not found");const o=`${`${i}/${a}/${e}`}/${Ke(this.manager?.settings)}`;if(this.app.vault.getAbstractFileByPath(o))throw new Error("Outline file already exists");const c=await this.tpl.render(r,{draftName:e});await this.app.vault.create(o,c)}}function ms(n){return n.replace(ae,"").trim()}function gs(n){return n.replace(/^#{1,6} .*\n/,"").trim()}function _s(n,t,e){const r=n.match(ae);if(!r)return n;const i=r[1],a=n.substring(r[0].length),s=i.split(`
`),o=[];for(const c of s)c.match(/^draft:/i)?o.push(`draft: ${t}`):c.match(/^project:/i)?o.push(`project: ${e}`):c.match(/^created:/i)?o.push(`created: ${new Date().toISOString()}`):o.push(c);const l=o.join(`
`);return`${Lt}
${l}
${Lt}${a}`}class _r{constructor(t,e,r){this.chapters=new hs(t),this.backups=new ds(t,r),this.drafts=new ps(t,this.chapters,e,this.backups)}}function Ct(){}const bs=n=>n;function At(n,t){for(const e in t)n[e]=t[e];return n}function Mi(n){return n()}function Nr(){return Object.create(null)}function _e(n){n.forEach(Mi)}function Ee(n){return typeof n=="function"}function Yt(n,t){return n!=n?t==t:n!==t||n&&typeof n=="object"||typeof n=="function"}function ws(n){return Object.keys(n).length===0}function Tt(n,t,e,r){if(n){const i=Ui(n,t,e,r);return n[0](i)}}function Ui(n,t,e,r){return n[1]&&r?At(e.ctx.slice(),n[1](r(t))):e.ctx}function Ot(n,t,e,r){if(n[2]&&r){const i=n[2](r(e));if(t.dirty===void 0)return i;if(typeof i=="object"){const a=[],s=Math.max(t.dirty.length,i.length);for(let o=0;o<s;o+=1)a[o]=t.dirty[o]|i[o];return a}return t.dirty|i}return t.dirty}function xt(n,t,e,r,i,a){if(i){const s=Ui(t,e,r,a);n.p(s,i)}}function Bt(n){if(n.ctx.length>32){const t=[],e=n.ctx.length/32;for(let r=0;r<e;r++)t[r]=-1;return t}return-1}function Zt(n){const t={};for(const e in n)e[0]!=="$"&&(t[e]=n[e]);return t}function jr(n,t){const e={};t=new Set(t);for(const r in n)!t.has(r)&&r[0]!=="$"&&(e[r]=n[r]);return e}function vs(n){const t={};for(const e in n)t[e]=!0;return t}function kn(n){return n??""}function An(n){return n&&Ee(n.destroy)?n.destroy:Ct}const Wi=typeof window<"u";let ys=Wi?()=>window.performance.now():()=>Date.now(),br=Wi?n=>requestAnimationFrame(n):Ct;const Je=new Set;function Hi(n){Je.forEach(t=>{t.c(n)||(Je.delete(t),t.f())}),Je.size!==0&&br(Hi)}function ks(n){let t;return Je.size===0&&br(Hi),{promise:new Promise(e=>{Je.add(t={c:n,f:e})}),abort(){Je.delete(t)}}}function it(n,t){n.appendChild(t)}function Vi(n){if(!n)return document;const t=n.getRootNode?n.getRootNode():n.ownerDocument;return t&&t.host?t:n.ownerDocument}function Ss(n){const t=ft("style");return t.textContent="/* empty */",Cs(Vi(n),t),t.sheet}function Cs(n,t){return it(n.head||n,t),t.sheet}function pt(n,t,e){n.insertBefore(t,e||null)}function ht(n){n.parentNode&&n.parentNode.removeChild(n)}function Rn(n,t){for(let e=0;e<n.length;e+=1)n[e]&&n[e].d(t)}function ft(n){return document.createElement(n)}function Pe(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function Xt(n){return document.createTextNode(n)}function mt(){return Xt(" ")}function sn(){return Xt("")}function Ht(n,t,e,r){return n.addEventListener(t,e,r),()=>n.removeEventListener(t,e,r)}function Le(n){return function(t){return t.preventDefault(),n.call(this,t)}}function nn(n){return function(t){return t.stopPropagation(),n.call(this,t)}}function Y(n,t,e){e==null?n.removeAttribute(t):n.getAttribute(t)!==e&&n.setAttribute(t,e)}const Fs=["width","height"];function Tr(n,t){const e=Object.getOwnPropertyDescriptors(n.__proto__);for(const r in t)t[r]==null?n.removeAttribute(r):r==="style"?n.style.cssText=t[r]:r==="__value"?n.value=n[r]=t[r]:e[r]&&e[r].set&&Fs.indexOf(r)===-1?n[r]=t[r]:Y(n,r,t[r])}function Dn(n,t){for(const e in t)Y(n,e,t[e])}function Es(n){return Array.from(n.childNodes)}function Me(n,t){t=""+t,n.data!==t&&(n.data=t)}function rn(n,t){n.value=t??""}function Fe(n,t,e,r){e==null?n.style.removeProperty(t):n.style.setProperty(t,e,"")}function Et(n,t,e){n.classList.toggle(t,!!e)}function Ps(n,t,{bubbles:e=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:t,bubbles:e,cancelable:r})}const Nn=new Map;let jn=0;function As(n){let t=5381,e=n.length;for(;e--;)t=(t<<5)-t^n.charCodeAt(e);return t>>>0}function Ds(n,t){const e={stylesheet:Ss(t),rules:{}};return Nn.set(n,e),e}function Ns(n,t,e,r,i,a,s,o=0){const l=16.666/r;let c=`{
`;for(let b=0;b<=1;b+=l){const g=t+(e-t)*a(b);c+=b*100+`%{${s(g,1-g)}}
`}const u=c+`100% {${s(e,1-e)}}
}`,d=`__svelte_${As(u)}_${o}`,_=Vi(n),{stylesheet:f,rules:p}=Nn.get(_)||Ds(_,n);p[d]||(p[d]=!0,f.insertRule(`@keyframes ${d} ${u}`,f.cssRules.length));const h=n.style.animation||"";return n.style.animation=`${h?`${h}, `:""}${d} ${r}ms linear ${i}ms 1 both`,jn+=1,d}function js(n,t){const e=(n.style.animation||"").split(", "),r=e.filter(t?a=>a.indexOf(t)<0:a=>a.indexOf("__svelte")===-1),i=e.length-r.length;i&&(n.style.animation=r.join(", "),jn-=i,jn||Ts())}function Ts(){br(()=>{jn||(Nn.forEach(n=>{const{ownerNode:t}=n.stylesheet;t&&ht(t)}),Nn.clear())})}function Os(n,t,e,r){if(!t)return Ct;const i=n.getBoundingClientRect();if(t.left===i.left&&t.right===i.right&&t.top===i.top&&t.bottom===i.bottom)return Ct;const{delay:a=0,duration:s=300,easing:o=bs,start:l=ys()+a,end:c=l+s,tick:u=Ct,css:d}=e(n,{from:t,to:i},r);let _=!0,f=!1,p;function h(){d&&(p=Ns(n,0,1,s,a,o,d)),a||(f=!0)}function b(){d&&js(n,p),_=!1}return ks(g=>{if(!f&&g>=l&&(f=!0),f&&g>=c&&(u(1,0),b()),!_)return!1;if(f){const v=g-l,y=0+1*o(v/s);u(y,1-y)}return!0}),h(),u(0,1),b}function xs(n){const t=getComputedStyle(n);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:e,height:r}=t,i=n.getBoundingClientRect();n.style.position="absolute",n.style.width=e,n.style.height=r,Bs(n,i)}}function Bs(n,t){const e=n.getBoundingClientRect();if(t.left!==e.left||t.top!==e.top){const r=getComputedStyle(n),i=r.transform==="none"?"":r.transform;n.style.transform=`${i} translate(${t.left-e.left}px, ${t.top-e.top}px)`}}let hn;function dn(n){hn=n}function Zi(){if(!hn)throw new Error("Function called outside component initialization");return hn}function Tn(n){Zi().$$.on_destroy.push(n)}function $s(){const n=Zi();return(t,e,{cancelable:r=!1}={})=>{const i=n.$$.callbacks[t];if(i){const a=Ps(t,e,{cancelable:r});return i.slice().forEach(s=>{s.call(n,a)}),!a.defaultPrevented}return!0}}function Sn(n,t){const e=n.$$.callbacks[t.type];e&&e.slice().forEach(r=>r.call(this,t))}const Ge=[],Qe=[];let tn=[];const cr=[],Is=Promise.resolve();let fr=!1;function Rs(){fr||(fr=!0,Is.then(Gi))}function ur(n){tn.push(n)}function zs(n){cr.push(n)}const er=new Set;let Ze=0;function Gi(){if(Ze!==0)return;const n=hn;do{try{for(;Ze<Ge.length;){const t=Ge[Ze];Ze++,dn(t),Ls(t.$$)}}catch(t){throw Ge.length=0,Ze=0,t}for(dn(null),Ge.length=0,Ze=0;Qe.length;)Qe.pop()();for(let t=0;t<tn.length;t+=1){const e=tn[t];er.has(e)||(er.add(e),e())}tn.length=0}while(Ge.length);for(;cr.length;)cr.pop()();fr=!1,er.clear(),dn(n)}function Ls(n){if(n.fragment!==null){n.update(),_e(n.before_update);const t=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,t),n.after_update.forEach(ur)}}function Ms(n){const t=[],e=[];tn.forEach(r=>n.indexOf(r)===-1?t.push(r):e.push(r)),e.forEach(r=>r()),tn=t}const Fn=new Set;let Ie;function $t(){Ie={r:0,c:[],p:Ie}}function It(){Ie.r||_e(Ie.c),Ie=Ie.p}function M(n,t){n&&n.i&&(Fn.delete(n),n.i(t))}function q(n,t,e,r){if(n&&n.o){if(Fn.has(n))return;Fn.add(n),Ie.c.push(()=>{Fn.delete(n),r&&(e&&n.d(1),r())}),n.o(t)}else r&&r()}function me(n){return n?.length!==void 0?n:Array.from(n)}function Us(n,t){q(n,1,1,()=>{t.delete(n.key)})}function Ws(n,t){n.f(),Us(n,t)}function Hs(n,t,e,r,i,a,s,o,l,c,u,d){let _=n.length,f=a.length,p=_;const h={};for(;p--;)h[n[p].key]=p;const b=[],g=new Map,v=new Map,y=[];for(p=f;p--;){const A=d(i,a,p),U=e(A);let D=s.get(U);D?y.push(()=>D.p(A,t)):(D=c(U,A),D.c()),g.set(U,b[p]=D),U in h&&v.set(U,Math.abs(p-h[U]))}const E=new Set,S=new Set;function O(A){M(A,1),A.m(o,u),s.set(A.key,A),u=A.first,f--}for(;_&&f;){const A=b[f-1],U=n[_-1],D=A.key,R=U.key;A===U?(u=A.first,_--,f--):g.has(R)?!s.has(D)||E.has(D)?O(A):S.has(R)?_--:v.get(D)>v.get(R)?(S.add(D),O(A)):(E.add(R),_--):(l(U,s),_--)}for(;_--;){const A=n[_];g.has(A.key)||l(A,s)}for(;f;)O(b[f-1]);return _e(y),b}function de(n,t){const e={},r={},i={$$scope:1};let a=n.length;for(;a--;){const s=n[a],o=t[a];if(o){for(const l in s)l in o||(r[l]=1);for(const l in o)i[l]||(e[l]=o[l],i[l]=1);n[a]=o}else for(const l in s)i[l]=1}for(const s in r)s in e||(e[s]=void 0);return e}function De(n){return typeof n=="object"&&n!==null?n:{}}function Vs(n,t,e){const r=n.$$.props[t];r!==void 0&&(n.$$.bound[r]=e,e(n.$$.ctx[r]))}function bt(n){n&&n.c()}function gt(n,t,e){const{fragment:r,after_update:i}=n.$$;r&&r.m(t,e),ur(()=>{const a=n.$$.on_mount.map(Mi).filter(Ee);n.$$.on_destroy?n.$$.on_destroy.push(...a):_e(a),n.$$.on_mount=[]}),i.forEach(ur)}function _t(n,t){const e=n.$$;e.fragment!==null&&(Ms(e.after_update),_e(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function Zs(n,t){n.$$.dirty[0]===-1&&(Ge.push(n),Rs(),n.$$.dirty.fill(0)),n.$$.dirty[t/31|0]|=1<<t%31}function Jt(n,t,e,r,i,a,s=null,o=[-1]){const l=hn;dn(n);const c=n.$$={fragment:null,ctx:[],props:a,update:Ct,not_equal:i,bound:Nr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Nr(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let u=!1;if(c.ctx=e?e(n,t.props||{},(d,_,...f)=>{const p=f.length?f[0]:_;return c.ctx&&i(c.ctx[d],c.ctx[d]=p)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](p),u&&Zs(n,d)),_}):[],c.update(),u=!0,_e(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const d=Es(t.target);c.fragment&&c.fragment.l(d),d.forEach(ht)}else c.fragment&&c.fragment.c();t.intro&&M(n.$$.fragment),gt(n,t.target,t.anchor),Gi()}dn(l)}class Qt{$$=void 0;$$set=void 0;$destroy(){_t(this,1),this.$destroy=Ct}$on(t,e){if(!Ee(e))return Ct;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!ws(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Gs="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Gs);function qs(n){let t,e,r,i,a;const s=n[6].default,o=Tt(s,n,n[5],null);return{c(){t=ft("button"),o&&o.c(),Y(t,"class",e=`wa-button ${n[0]==="primary"?"primary":n[0]==="ghost"?"ghost":""}`),Y(t,"aria-label",n[3]),t.disabled=n[1],Y(t,"style",n[2])},m(l,c){pt(l,t,c),o&&o.m(t,null),r=!0,i||(a=Ht(t,"click",function(){Ee(n[4])&&n[4].apply(this,arguments)}),i=!0)},p(l,[c]){n=l,o&&o.p&&(!r||c&32)&&xt(o,s,n,n[5],r?Ot(s,n[5],c,null):Bt(n[5]),null),(!r||c&1&&e!==(e=`wa-button ${n[0]==="primary"?"primary":n[0]==="ghost"?"ghost":""}`))&&Y(t,"class",e),(!r||c&8)&&Y(t,"aria-label",n[3]),(!r||c&2)&&(t.disabled=n[1]),(!r||c&4)&&Y(t,"style",n[2])},i(l){r||(M(o,l),r=!0)},o(l){q(o,l),r=!1},d(l){l&&ht(t),o&&o.d(l),i=!1,a()}}}function Ks(n,t,e){let{$$slots:r={},$$scope:i}=t,{variant:a="default"}=t,{disabled:s=!1}=t,{style:o=""}=t,{title:l=""}=t,{clickHandler:c=void 0}=t;return n.$$set=u=>{"variant"in u&&e(0,a=u.variant),"disabled"in u&&e(1,s=u.disabled),"style"in u&&e(2,o=u.style),"title"in u&&e(3,l=u.title),"clickHandler"in u&&e(4,c=u.clickHandler),"$$scope"in u&&e(5,i=u.$$scope)},[a,s,o,l,c,i,r]}class ke extends Qt{constructor(t){super(),Jt(this,t,Ks,qs,Yt,{variant:0,disabled:1,style:2,title:3,clickHandler:4})}}function Ys(n){let t,e,r,i,a,s,o;const l=n[7].default,c=Tt(l,n,n[6],null);return{c(){t=ft("button"),e=ft("span"),c&&c.c(),Y(e,"class",r=kn(n[5]?"spinning":"")+" svelte-10fbbmm"),Y(t,"class",i=kn(`wa-icon-btn clickable-icon ${n[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"),Y(t,"aria-label",n[0]),t.disabled=n[2],Y(t,"title",n[3])},m(u,d){pt(u,t,d),it(t,e),c&&c.m(e,null),a=!0,s||(o=Ht(t,"click",function(){Ee(n[4])&&n[4].apply(this,arguments)}),s=!0)},p(u,[d]){n=u,c&&c.p&&(!a||d&64)&&xt(c,l,n,n[6],a?Ot(l,n[6],d,null):Bt(n[6]),null),(!a||d&32&&r!==(r=kn(n[5]?"spinning":"")+" svelte-10fbbmm"))&&Y(e,"class",r),(!a||d&2&&i!==(i=kn(`wa-icon-btn clickable-icon ${n[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"))&&Y(t,"class",i),(!a||d&1)&&Y(t,"aria-label",n[0]),(!a||d&4)&&(t.disabled=n[2]),(!a||d&8)&&Y(t,"title",n[3])},i(u){a||(M(c,u),a=!0)},o(u){q(c,u),a=!1},d(u){u&&ht(t),c&&c.d(u),s=!1,o()}}}function Xs(n,t,e){let{$$slots:r={},$$scope:i}=t,{ariaLabel:a=""}=t,{variant:s="default"}=t,{disabled:o=!1}=t,{title:l}=t,{clickHandler:c=void 0}=t,{spinning:u=!1}=t;return n.$$set=d=>{"ariaLabel"in d&&e(0,a=d.ariaLabel),"variant"in d&&e(1,s=d.variant),"disabled"in d&&e(2,o=d.disabled),"title"in d&&e(3,l=d.title),"clickHandler"in d&&e(4,c=d.clickHandler),"spinning"in d&&e(5,u=d.spinning),"$$scope"in d&&e(6,i=d.$$scope)},[a,s,o,l,c,u,i,r]}class ce extends Qt{constructor(t){super(),Jt(this,t,Xs,Ys,Yt,{ariaLabel:0,variant:1,disabled:2,title:3,clickHandler:4,spinning:5})}}class Or extends T.Modal{constructor(t,e,r,i="draft"){super(t),this.name=e,this.onConfirm=r,this.type=i}onOpen(){const{contentEl:t}=this;t.addClass("wa-centered-modal");const e=this.type==="chapter"?"chapter":"draft";t.createEl("h3",{text:`Delete ${e} '${this.name}'?`}),this.type==="draft"&&t.createEl("p",{text:"This will create a backup copy before deleting."});const r=t.createDiv({cls:"modal-button-row wa-button-group"}),i=r.createEl("button",{text:"Delete",cls:"mod-cta wa-button"}),a=r.createEl("button",{text:"Cancel",cls:"wa-button"});i.onclick=async()=>{this.close(),await this.onConfirm()},a.onclick=()=>{this.close()}}}class Js extends T.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:`Duplicate Draft: ${this.props.sourceDraftName}`});let e="";new T.Setting(t).setName("New draft name").addText(r=>r.setPlaceholder(this.props.suggestedName).setValue(this.props.suggestedName).onChange(i=>e=i)),new T.Setting(t).addButton(r=>r.setButtonText("Duplicate").setCta().onClick(()=>{this.close();const i=e&&e.trim()?e.trim():this.props.suggestedName;this.props.onSubmit(i)}))}onClose(){this.contentEl.empty()}}class Qs extends T.Modal{constructor(t,e,r){super(t),this.oldName=e,this.onSubmit=r}onOpen(){const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Chapter"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New chapter name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new chapter name",cls:"wa-rename-input",attr:{"aria-label":"New chapter name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const r=t.createEl("div",{cls:"wa-rename-btn-row"}),i=r.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=r.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{this.inputEl?.focus(),this.inputEl?.select()},0),this.inputEl?.addEventListener("keydown",a=>{a.key==="Enter"?this.submit():a.key==="Escape"&&this.close()}),i.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){const t=this.inputEl?.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Chapter name cannot be empty.",this.errorEl.style.display=""),this.inputEl?.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),this.inputEl?.focus();return}this.errorEl&&(this.errorEl.style.display="none"),this.onSubmit(t),this.close()}}/**
 * @license lucide-svelte v0.546.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const xr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};function Br(n,t,e){const r=n.slice();return r[11]=t[e][0],r[12]=t[e][1],r}function nr(n){let t,e=[n[12]],r={};for(let i=0;i<e.length;i+=1)r=At(r,e[i]);return{c(){t=Pe(n[11]),Dn(t,r)},m(i,a){pt(i,t,a)},p(i,a){Dn(t,r=de(e,[a&32&&i[12]]))},d(i){i&&ht(t)}}}function $r(n){let t=n[11],e,r=n[11]&&nr(n);return{c(){r&&r.c(),e=sn()},m(i,a){r&&r.m(i,a),pt(i,e,a)},p(i,a){i[11]?t?Yt(t,i[11])?(r.d(1),r=nr(i),t=i[11],r.c(),r.m(e.parentNode,e)):r.p(i,a):(r=nr(i),t=i[11],r.c(),r.m(e.parentNode,e)):t&&(r.d(1),r=null,t=i[11])},d(i){i&&ht(e),r&&r.d(i)}}}function to(n){let t,e,r,i,a,s=me(n[5]),o=[];for(let _=0;_<s.length;_+=1)o[_]=$r(Br(n,s,_));const l=n[10].default,c=Tt(l,n,n[9],null);let u=[xr,n[7],{width:n[2]},{height:n[2]},{stroke:n[1]},{"stroke-width":r=n[4]?Number(n[3])*24/Number(n[2]):n[3]},{class:i=n[6]("lucide-icon","lucide",n[0]?`lucide-${n[0]}`:"",n[8].class)}],d={};for(let _=0;_<u.length;_+=1)d=At(d,u[_]);return{c(){t=Pe("svg");for(let _=0;_<o.length;_+=1)o[_].c();e=sn(),c&&c.c(),Dn(t,d)},m(_,f){pt(_,t,f);for(let p=0;p<o.length;p+=1)o[p]&&o[p].m(t,null);it(t,e),c&&c.m(t,null),a=!0},p(_,[f]){if(f&32){s=me(_[5]);let p;for(p=0;p<s.length;p+=1){const h=Br(_,s,p);o[p]?o[p].p(h,f):(o[p]=$r(h),o[p].c(),o[p].m(t,e))}for(;p<o.length;p+=1)o[p].d(1);o.length=s.length}c&&c.p&&(!a||f&512)&&xt(c,l,_,_[9],a?Ot(l,_[9],f,null):Bt(_[9]),null),Dn(t,d=de(u,[xr,f&128&&_[7],(!a||f&4)&&{width:_[2]},(!a||f&4)&&{height:_[2]},(!a||f&2)&&{stroke:_[1]},(!a||f&28&&r!==(r=_[4]?Number(_[3])*24/Number(_[2]):_[3]))&&{"stroke-width":r},(!a||f&257&&i!==(i=_[6]("lucide-icon","lucide",_[0]?`lucide-${_[0]}`:"",_[8].class)))&&{class:i}]))},i(_){a||(M(c,_),a=!0)},o(_){q(c,_),a=!1},d(_){_&&ht(t),Rn(o,_),c&&c.d(_)}}}function eo(n,t,e){const r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=jr(t,r),{$$slots:a={},$$scope:s}=t,{name:o=void 0}=t,{color:l="currentColor"}=t,{size:c=24}=t,{strokeWidth:u=2}=t,{absoluteStrokeWidth:d=!1}=t,{iconNode:_=[]}=t;const f=(...p)=>p.filter((h,b,g)=>!!h&&g.indexOf(h)===b).join(" ");return n.$$set=p=>{e(8,t=At(At({},t),Zt(p))),e(7,i=jr(t,r)),"name"in p&&e(0,o=p.name),"color"in p&&e(1,l=p.color),"size"in p&&e(2,c=p.size),"strokeWidth"in p&&e(3,u=p.strokeWidth),"absoluteStrokeWidth"in p&&e(4,d=p.absoluteStrokeWidth),"iconNode"in p&&e(5,_=p.iconNode),"$$scope"in p&&e(9,s=p.$$scope)},t=Zt(t),[o,l,c,u,d,_,f,i,t,s,a]}class Ne extends Qt{constructor(t){super(),Jt(this,t,eo,to,Yt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}function no(n){let t;const e=n[2].default,r=Tt(e,n,n[3],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a&8)&&xt(r,e,i,i[3],t?Ot(e,i[3],a,null):Bt(i[3]),null)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function ro(n){let t,e;const r=[{name:"arrow-down"},n[1],{iconNode:n[0]}];let i={$$slots:{default:[no]},$$scope:{ctx:n}};for(let a=0;a<r.length;a+=1)i=At(i,r[a]);return t=new Ne({props:i}),{c(){bt(t.$$.fragment)},m(a,s){gt(t,a,s),e=!0},p(a,[s]){const o=s&3?de(r,[r[0],s&2&&De(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(M(t.$$.fragment,a),e=!0)},o(a){q(t.$$.fragment,a),e=!1},d(a){_t(t,a)}}}function io(n,t,e){let{$$slots:r={},$$scope:i}=t;const a=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];return n.$$set=s=>{e(1,t=At(At({},t),Zt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Zt(t),[a,t,r,i]}class qi extends Qt{constructor(t){super(),Jt(this,t,io,ro,Yt,{})}}function ao(n){let t;const e=n[2].default,r=Tt(e,n,n[3],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a&8)&&xt(r,e,i,i[3],t?Ot(e,i[3],a,null):Bt(i[3]),null)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function so(n){let t,e;const r=[{name:"arrow-up"},n[1],{iconNode:n[0]}];let i={$$slots:{default:[ao]},$$scope:{ctx:n}};for(let a=0;a<r.length;a+=1)i=At(i,r[a]);return t=new Ne({props:i}),{c(){bt(t.$$.fragment)},m(a,s){gt(t,a,s),e=!0},p(a,[s]){const o=s&3?de(r,[r[0],s&2&&De(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(M(t.$$.fragment,a),e=!0)},o(a){q(t.$$.fragment,a),e=!1},d(a){_t(t,a)}}}function oo(n,t,e){let{$$slots:r={},$$scope:i}=t;const a=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return n.$$set=s=>{e(1,t=At(At({},t),Zt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Zt(t),[a,t,r,i]}class Ki extends Qt{constructor(t){super(),Jt(this,t,oo,so,Yt,{})}}function lo(n){let t;const e=n[2].default,r=Tt(e,n,n[3],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a&8)&&xt(r,e,i,i[3],t?Ot(e,i[3],a,null):Bt(i[3]),null)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function co(n){let t,e;const r=[{name:"book-open-check"},n[1],{iconNode:n[0]}];let i={$$slots:{default:[lo]},$$scope:{ctx:n}};for(let a=0;a<r.length;a+=1)i=At(i,r[a]);return t=new Ne({props:i}),{c(){bt(t.$$.fragment)},m(a,s){gt(t,a,s),e=!0},p(a,[s]){const o=s&3?de(r,[r[0],s&2&&De(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(M(t.$$.fragment,a),e=!0)},o(a){q(t.$$.fragment,a),e=!1},d(a){_t(t,a)}}}function fo(n,t,e){let{$$slots:r={},$$scope:i}=t;const a=[["path",{d:"M12 21V7"}],["path",{d:"m16 12 2 2 4-4"}],["path",{d:"M22 6V4a1 1 0 0 0-1-1h-5a4 4 0 0 0-4 4 4 4 0 0 0-4-4H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h6a3 3 0 0 1 3 3 3 3 0 0 1 3-3h6a1 1 0 0 0 1-1v-1.3"}]];return n.$$set=s=>{e(1,t=At(At({},t),Zt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Zt(t),[a,t,r,i]}class uo extends Qt{constructor(t){super(),Jt(this,t,fo,co,Yt,{})}}function ho(n){let t;const e=n[2].default,r=Tt(e,n,n[3],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a&8)&&xt(r,e,i,i[3],t?Ot(e,i[3],a,null):Bt(i[3]),null)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function po(n){let t,e;const r=[{name:"copy"},n[1],{iconNode:n[0]}];let i={$$slots:{default:[ho]},$$scope:{ctx:n}};for(let a=0;a<r.length;a+=1)i=At(i,r[a]);return t=new Ne({props:i}),{c(){bt(t.$$.fragment)},m(a,s){gt(t,a,s),e=!0},p(a,[s]){const o=s&3?de(r,[r[0],s&2&&De(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(M(t.$$.fragment,a),e=!0)},o(a){q(t.$$.fragment,a),e=!1},d(a){_t(t,a)}}}function mo(n,t,e){let{$$slots:r={},$$scope:i}=t;const a=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return n.$$set=s=>{e(1,t=At(At({},t),Zt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Zt(t),[a,t,r,i]}class go extends Qt{constructor(t){super(),Jt(this,t,mo,po,Yt,{})}}function _o(n){let t;const e=n[2].default,r=Tt(e,n,n[3],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a&8)&&xt(r,e,i,i[3],t?Ot(e,i[3],a,null):Bt(i[3]),null)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function bo(n){let t,e;const r=[{name:"eye"},n[1],{iconNode:n[0]}];let i={$$slots:{default:[_o]},$$scope:{ctx:n}};for(let a=0;a<r.length;a+=1)i=At(i,r[a]);return t=new Ne({props:i}),{c(){bt(t.$$.fragment)},m(a,s){gt(t,a,s),e=!0},p(a,[s]){const o=s&3?de(r,[r[0],s&2&&De(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(M(t.$$.fragment,a),e=!0)},o(a){q(t.$$.fragment,a),e=!1},d(a){_t(t,a)}}}function wo(n,t,e){let{$$slots:r={},$$scope:i}=t;const a=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return n.$$set=s=>{e(1,t=At(At({},t),Zt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Zt(t),[a,t,r,i]}class Yi extends Qt{constructor(t){super(),Jt(this,t,wo,bo,Yt,{})}}function vo(n){let t;const e=n[2].default,r=Tt(e,n,n[3],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a&8)&&xt(r,e,i,i[3],t?Ot(e,i[3],a,null):Bt(i[3]),null)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function yo(n){let t,e;const r=[{name:"pencil"},n[1],{iconNode:n[0]}];let i={$$slots:{default:[vo]},$$scope:{ctx:n}};for(let a=0;a<r.length;a+=1)i=At(i,r[a]);return t=new Ne({props:i}),{c(){bt(t.$$.fragment)},m(a,s){gt(t,a,s),e=!0},p(a,[s]){const o=s&3?de(r,[r[0],s&2&&De(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(M(t.$$.fragment,a),e=!0)},o(a){q(t.$$.fragment,a),e=!1},d(a){_t(t,a)}}}function ko(n,t,e){let{$$slots:r={},$$scope:i}=t;const a=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return n.$$set=s=>{e(1,t=At(At({},t),Zt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Zt(t),[a,t,r,i]}class Xi extends Qt{constructor(t){super(),Jt(this,t,ko,yo,Yt,{})}}function So(n){let t;const e=n[2].default,r=Tt(e,n,n[3],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a&8)&&xt(r,e,i,i[3],t?Ot(e,i[3],a,null):Bt(i[3]),null)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function Co(n){let t,e;const r=[{name:"rotate-ccw"},n[1],{iconNode:n[0]}];let i={$$slots:{default:[So]},$$scope:{ctx:n}};for(let a=0;a<r.length;a+=1)i=At(i,r[a]);return t=new Ne({props:i}),{c(){bt(t.$$.fragment)},m(a,s){gt(t,a,s),e=!0},p(a,[s]){const o=s&3?de(r,[r[0],s&2&&De(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(M(t.$$.fragment,a),e=!0)},o(a){q(t.$$.fragment,a),e=!1},d(a){_t(t,a)}}}function Fo(n,t,e){let{$$slots:r={},$$scope:i}=t;const a=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];return n.$$set=s=>{e(1,t=At(At({},t),Zt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Zt(t),[a,t,r,i]}class Ji extends Qt{constructor(t){super(),Jt(this,t,Fo,Co,Yt,{})}}function Eo(n){let t;const e=n[2].default,r=Tt(e,n,n[3],null);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a&8)&&xt(r,e,i,i[3],t?Ot(e,i[3],a,null):Bt(i[3]),null)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function Po(n){let t,e;const r=[{name:"trash"},n[1],{iconNode:n[0]}];let i={$$slots:{default:[Eo]},$$scope:{ctx:n}};for(let a=0;a<r.length;a+=1)i=At(i,r[a]);return t=new Ne({props:i}),{c(){bt(t.$$.fragment)},m(a,s){gt(t,a,s),e=!0},p(a,[s]){const o=s&3?de(r,[r[0],s&2&&De(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(M(t.$$.fragment,a),e=!0)},o(a){q(t.$$.fragment,a),e=!1},d(a){_t(t,a)}}}function Ao(n,t,e){let{$$slots:r={},$$scope:i}=t;const a=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];return n.$$set=s=>{e(1,t=At(At({},t),Zt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Zt(t),[a,t,r,i]}class Qi extends Qt{constructor(t){super(),Jt(this,t,Ao,Po,Yt,{})}}const On=Math.min,ze=Math.max,xn=Math.round,Cn=Math.floor,pe=n=>({x:n,y:n}),Do={left:"right",right:"left",bottom:"top",top:"bottom"},No={start:"end",end:"start"};function Ir(n,t,e){return ze(n,On(t,e))}function zn(n,t){return typeof n=="function"?n(t):n}function Ue(n){return n.split("-")[0]}function Ln(n){return n.split("-")[1]}function ta(n){return n==="x"?"y":"x"}function ea(n){return n==="y"?"height":"width"}const jo=new Set(["top","bottom"]);function Ce(n){return jo.has(Ue(n))?"y":"x"}function na(n){return ta(Ce(n))}function To(n,t,e){e===void 0&&(e=!1);const r=Ln(n),i=na(n),a=ea(i);let s=i==="x"?r===(e?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[a]>t.floating[a]&&(s=Bn(s)),[s,Bn(s)]}function Oo(n){const t=Bn(n);return[dr(n),t,dr(t)]}function dr(n){return n.replace(/start|end/g,t=>No[t])}const Rr=["left","right"],zr=["right","left"],xo=["top","bottom"],Bo=["bottom","top"];function $o(n,t,e){switch(n){case"top":case"bottom":return e?t?zr:Rr:t?Rr:zr;case"left":case"right":return t?xo:Bo;default:return[]}}function Io(n,t,e,r){const i=Ln(n);let a=$o(Ue(n),e==="start",r);return i&&(a=a.map(s=>s+"-"+i),t&&(a=a.concat(a.map(dr)))),a}function Bn(n){return n.replace(/left|right|bottom|top/g,t=>Do[t])}function Ro(n){return{top:0,right:0,bottom:0,left:0,...n}}function zo(n){return typeof n!="number"?Ro(n):{top:n,right:n,bottom:n,left:n}}function $n(n){const{x:t,y:e,width:r,height:i}=n;return{width:r,height:i,top:e,left:t,right:t+r,bottom:e+i,x:t,y:e}}function Lr(n,t,e){let{reference:r,floating:i}=n;const a=Ce(t),s=na(t),o=ea(s),l=Ue(t),c=a==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,_=r[o]/2-i[o]/2;let f;switch(l){case"top":f={x:u,y:r.y-i.height};break;case"bottom":f={x:u,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:d};break;case"left":f={x:r.x-i.width,y:d};break;default:f={x:r.x,y:r.y}}switch(Ln(t)){case"start":f[s]-=_*(e&&c?-1:1);break;case"end":f[s]+=_*(e&&c?-1:1);break}return f}const Lo=async(n,t,e)=>{const{placement:r="bottom",strategy:i="absolute",middleware:a=[],platform:s}=e,o=a.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(t));let c=await s.getElementRects({reference:n,floating:t,strategy:i}),{x:u,y:d}=Lr(c,r,l),_=r,f={},p=0;for(let h=0;h<o.length;h++){const{name:b,fn:g}=o[h],{x:v,y,data:E,reset:S}=await g({x:u,y:d,initialPlacement:r,placement:_,strategy:i,middlewareData:f,rects:c,platform:s,elements:{reference:n,floating:t}});u=v??u,d=y??d,f={...f,[b]:{...f[b],...E}},S&&p<=50&&(p++,typeof S=="object"&&(S.placement&&(_=S.placement),S.rects&&(c=S.rects===!0?await s.getElementRects({reference:n,floating:t,strategy:i}):S.rects),{x:u,y:d}=Lr(c,_,l)),h=-1)}return{x:u,y:d,placement:_,strategy:i,middlewareData:f}};async function ra(n,t){var e;t===void 0&&(t={});const{x:r,y:i,platform:a,rects:s,elements:o,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:_=!1,padding:f=0}=zn(t,n),p=zo(f),b=o[_?d==="floating"?"reference":"floating":d],g=$n(await a.getClippingRect({element:(e=await(a.isElement==null?void 0:a.isElement(b)))==null||e?b:b.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(o.floating)),boundary:c,rootBoundary:u,strategy:l})),v=d==="floating"?{x:r,y:i,width:s.floating.width,height:s.floating.height}:s.reference,y=await(a.getOffsetParent==null?void 0:a.getOffsetParent(o.floating)),E=await(a.isElement==null?void 0:a.isElement(y))?await(a.getScale==null?void 0:a.getScale(y))||{x:1,y:1}:{x:1,y:1},S=$n(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:v,offsetParent:y,strategy:l}):v);return{top:(g.top-S.top+p.top)/E.y,bottom:(S.bottom-g.bottom+p.bottom)/E.y,left:(g.left-S.left+p.left)/E.x,right:(S.right-g.right+p.right)/E.x}}const Mo=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(t){var e,r;const{placement:i,middlewareData:a,rects:s,initialPlacement:o,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:_,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:h=!0,...b}=zn(n,t);if((e=a.arrow)!=null&&e.alignmentOffset)return{};const g=Ue(i),v=Ce(o),y=Ue(o)===o,E=await(l.isRTL==null?void 0:l.isRTL(c.floating)),S=_||(y||!h?[Bn(o)]:Oo(o)),O=p!=="none";!_&&O&&S.push(...Io(o,h,p,E));const A=[o,...S],U=await ra(t,b),D=[];let R=((r=a.flip)==null?void 0:r.overflows)||[];if(u&&D.push(U[g]),d){const w=To(i,s,E);D.push(U[w[0]],U[w[1]])}if(R=[...R,{placement:i,overflows:D}],!D.every(w=>w<=0)){var j,C;const w=(((j=a.flip)==null?void 0:j.index)||0)+1,V=A[w];if(V&&(!(d==="alignment"?v!==Ce(V):!1)||R.every(st=>Ce(st.placement)===v?st.overflows[0]>0:!0)))return{data:{index:w,overflows:R},reset:{placement:V}};let lt=(C=R.filter(K=>K.overflows[0]<=0).sort((K,st)=>K.overflows[1]-st.overflows[1])[0])==null?void 0:C.placement;if(!lt)switch(f){case"bestFit":{var $;const K=($=R.filter(st=>{if(O){const x=Ce(st.placement);return x===v||x==="y"}return!0}).map(st=>[st.placement,st.overflows.filter(x=>x>0).reduce((x,tt)=>x+tt,0)]).sort((st,x)=>st[1]-x[1])[0])==null?void 0:$[0];K&&(lt=K);break}case"initialPlacement":lt=o;break}if(i!==lt)return{reset:{placement:lt}}}return{}}}},Uo=new Set(["left","top"]);async function Wo(n,t){const{placement:e,platform:r,elements:i}=n,a=await(r.isRTL==null?void 0:r.isRTL(i.floating)),s=Ue(e),o=Ln(e),l=Ce(e)==="y",c=Uo.has(s)?-1:1,u=a&&l?-1:1,d=zn(t,n);let{mainAxis:_,crossAxis:f,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof p=="number"&&(f=o==="end"?p*-1:p),l?{x:f*u,y:_*c}:{x:_*c,y:f*u}}const Ho=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(t){var e,r;const{x:i,y:a,placement:s,middlewareData:o}=t,l=await Wo(t,n);return s===((e=o.offset)==null?void 0:e.placement)&&(r=o.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:a+l.y,data:{...l,placement:s}}}}},Vo=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(t){const{x:e,y:r,placement:i}=t,{mainAxis:a=!0,crossAxis:s=!1,limiter:o={fn:b=>{let{x:g,y:v}=b;return{x:g,y:v}}},...l}=zn(n,t),c={x:e,y:r},u=await ra(t,l),d=Ce(Ue(i)),_=ta(d);let f=c[_],p=c[d];if(a){const b=_==="y"?"top":"left",g=_==="y"?"bottom":"right",v=f+u[b],y=f-u[g];f=Ir(v,f,y)}if(s){const b=d==="y"?"top":"left",g=d==="y"?"bottom":"right",v=p+u[b],y=p-u[g];p=Ir(v,p,y)}const h=o.fn({...t,[_]:f,[d]:p});return{...h,data:{x:h.x-e,y:h.y-r,enabled:{[_]:a,[d]:s}}}}}};function Mn(){return typeof window<"u"}function on(n){return ia(n)?(n.nodeName||"").toLowerCase():"#document"}function ie(n){var t;return(n==null||(t=n.ownerDocument)==null?void 0:t.defaultView)||window}function be(n){var t;return(t=(ia(n)?n.ownerDocument:n.document)||window.document)==null?void 0:t.documentElement}function ia(n){return Mn()?n instanceof Node||n instanceof ie(n).Node:!1}function fe(n){return Mn()?n instanceof Element||n instanceof ie(n).Element:!1}function ge(n){return Mn()?n instanceof HTMLElement||n instanceof ie(n).HTMLElement:!1}function Mr(n){return!Mn()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof ie(n).ShadowRoot}const Zo=new Set(["inline","contents"]);function gn(n){const{overflow:t,overflowX:e,overflowY:r,display:i}=ue(n);return/auto|scroll|overlay|hidden|clip/.test(t+r+e)&&!Zo.has(i)}const Go=new Set(["table","td","th"]);function qo(n){return Go.has(on(n))}const Ko=[":popover-open",":modal"];function Un(n){return Ko.some(t=>{try{return n.matches(t)}catch{return!1}})}const Yo=["transform","translate","scale","rotate","perspective"],Xo=["transform","translate","scale","rotate","perspective","filter"],Jo=["paint","layout","strict","content"];function wr(n){const t=vr(),e=fe(n)?ue(n):n;return Yo.some(r=>e[r]?e[r]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||Xo.some(r=>(e.willChange||"").includes(r))||Jo.some(r=>(e.contain||"").includes(r))}function Qo(n){let t=Ae(n);for(;ge(t)&&!an(t);){if(wr(t))return t;if(Un(t))return null;t=Ae(t)}return null}function vr(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const tl=new Set(["html","body","#document"]);function an(n){return tl.has(on(n))}function ue(n){return ie(n).getComputedStyle(n)}function Wn(n){return fe(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Ae(n){if(on(n)==="html")return n;const t=n.assignedSlot||n.parentNode||Mr(n)&&n.host||be(n);return Mr(t)?t.host:t}function aa(n){const t=Ae(n);return an(t)?n.ownerDocument?n.ownerDocument.body:n.body:ge(t)&&gn(t)?t:aa(t)}function pn(n,t,e){var r;t===void 0&&(t=[]),e===void 0&&(e=!0);const i=aa(n),a=i===((r=n.ownerDocument)==null?void 0:r.body),s=ie(i);if(a){const o=hr(s);return t.concat(s,s.visualViewport||[],gn(i)?i:[],o&&e?pn(o):[])}return t.concat(i,pn(i,[],e))}function hr(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function sa(n){const t=ue(n);let e=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const i=ge(n),a=i?n.offsetWidth:e,s=i?n.offsetHeight:r,o=xn(e)!==a||xn(r)!==s;return o&&(e=a,r=s),{width:e,height:r,$:o}}function yr(n){return fe(n)?n:n.contextElement}function en(n){const t=yr(n);if(!ge(t))return pe(1);const e=t.getBoundingClientRect(),{width:r,height:i,$:a}=sa(t);let s=(a?xn(e.width):e.width)/r,o=(a?xn(e.height):e.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const el=pe(0);function oa(n){const t=ie(n);return!vr()||!t.visualViewport?el:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function nl(n,t,e){return t===void 0&&(t=!1),!e||t&&e!==ie(n)?!1:t}function We(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=!1);const i=n.getBoundingClientRect(),a=yr(n);let s=pe(1);t&&(r?fe(r)&&(s=en(r)):s=en(n));const o=nl(a,e,r)?oa(a):pe(0);let l=(i.left+o.x)/s.x,c=(i.top+o.y)/s.y,u=i.width/s.x,d=i.height/s.y;if(a){const _=ie(a),f=r&&fe(r)?ie(r):r;let p=_,h=hr(p);for(;h&&r&&f!==p;){const b=en(h),g=h.getBoundingClientRect(),v=ue(h),y=g.left+(h.clientLeft+parseFloat(v.paddingLeft))*b.x,E=g.top+(h.clientTop+parseFloat(v.paddingTop))*b.y;l*=b.x,c*=b.y,u*=b.x,d*=b.y,l+=y,c+=E,p=ie(h),h=hr(p)}}return $n({width:u,height:d,x:l,y:c})}function Hn(n,t){const e=Wn(n).scrollLeft;return t?t.left+e:We(be(n)).left+e}function la(n,t){const e=n.getBoundingClientRect(),r=e.left+t.scrollLeft-Hn(n,e),i=e.top+t.scrollTop;return{x:r,y:i}}function rl(n){let{elements:t,rect:e,offsetParent:r,strategy:i}=n;const a=i==="fixed",s=be(r),o=t?Un(t.floating):!1;if(r===s||o&&a)return e;let l={scrollLeft:0,scrollTop:0},c=pe(1);const u=pe(0),d=ge(r);if((d||!d&&!a)&&((on(r)!=="body"||gn(s))&&(l=Wn(r)),ge(r))){const f=We(r);c=en(r),u.x=f.x+r.clientLeft,u.y=f.y+r.clientTop}const _=s&&!d&&!a?la(s,l):pe(0);return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+u.x+_.x,y:e.y*c.y-l.scrollTop*c.y+u.y+_.y}}function il(n){return Array.from(n.getClientRects())}function al(n){const t=be(n),e=Wn(n),r=n.ownerDocument.body,i=ze(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),a=ze(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let s=-e.scrollLeft+Hn(n);const o=-e.scrollTop;return ue(r).direction==="rtl"&&(s+=ze(t.clientWidth,r.clientWidth)-i),{width:i,height:a,x:s,y:o}}const Ur=25;function sl(n,t){const e=ie(n),r=be(n),i=e.visualViewport;let a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(i){a=i.width,s=i.height;const u=vr();(!u||u&&t==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}const c=Hn(r);if(c<=0){const u=r.ownerDocument,d=u.body,_=getComputedStyle(d),f=u.compatMode==="CSS1Compat"&&parseFloat(_.marginLeft)+parseFloat(_.marginRight)||0,p=Math.abs(r.clientWidth-d.clientWidth-f);p<=Ur&&(a-=p)}else c<=Ur&&(a+=c);return{width:a,height:s,x:o,y:l}}const ol=new Set(["absolute","fixed"]);function ll(n,t){const e=We(n,!0,t==="fixed"),r=e.top+n.clientTop,i=e.left+n.clientLeft,a=ge(n)?en(n):pe(1),s=n.clientWidth*a.x,o=n.clientHeight*a.y,l=i*a.x,c=r*a.y;return{width:s,height:o,x:l,y:c}}function Wr(n,t,e){let r;if(t==="viewport")r=sl(n,e);else if(t==="document")r=al(be(n));else if(fe(t))r=ll(t,e);else{const i=oa(n);r={x:t.x-i.x,y:t.y-i.y,width:t.width,height:t.height}}return $n(r)}function ca(n,t){const e=Ae(n);return e===t||!fe(e)||an(e)?!1:ue(e).position==="fixed"||ca(e,t)}function cl(n,t){const e=t.get(n);if(e)return e;let r=pn(n,[],!1).filter(o=>fe(o)&&on(o)!=="body"),i=null;const a=ue(n).position==="fixed";let s=a?Ae(n):n;for(;fe(s)&&!an(s);){const o=ue(s),l=wr(s);!l&&o.position==="fixed"&&(i=null),(a?!l&&!i:!l&&o.position==="static"&&!!i&&ol.has(i.position)||gn(s)&&!l&&ca(n,s))?r=r.filter(u=>u!==s):i=o,s=Ae(s)}return t.set(n,r),r}function fl(n){let{element:t,boundary:e,rootBoundary:r,strategy:i}=n;const s=[...e==="clippingAncestors"?Un(t)?[]:cl(t,this._c):[].concat(e),r],o=s[0],l=s.reduce((c,u)=>{const d=Wr(t,u,i);return c.top=ze(d.top,c.top),c.right=On(d.right,c.right),c.bottom=On(d.bottom,c.bottom),c.left=ze(d.left,c.left),c},Wr(t,o,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function ul(n){const{width:t,height:e}=sa(n);return{width:t,height:e}}function dl(n,t,e){const r=ge(t),i=be(t),a=e==="fixed",s=We(n,!0,a,t);let o={scrollLeft:0,scrollTop:0};const l=pe(0);function c(){l.x=Hn(i)}if(r||!r&&!a)if((on(t)!=="body"||gn(i))&&(o=Wn(t)),r){const f=We(t,!0,a,t);l.x=f.x+t.clientLeft,l.y=f.y+t.clientTop}else i&&c();a&&!r&&i&&c();const u=i&&!r&&!a?la(i,o):pe(0),d=s.left+o.scrollLeft-l.x-u.x,_=s.top+o.scrollTop-l.y-u.y;return{x:d,y:_,width:s.width,height:s.height}}function rr(n){return ue(n).position==="static"}function Hr(n,t){if(!ge(n)||ue(n).position==="fixed")return null;if(t)return t(n);let e=n.offsetParent;return be(n)===e&&(e=e.ownerDocument.body),e}function fa(n,t){const e=ie(n);if(Un(n))return e;if(!ge(n)){let i=Ae(n);for(;i&&!an(i);){if(fe(i)&&!rr(i))return i;i=Ae(i)}return e}let r=Hr(n,t);for(;r&&qo(r)&&rr(r);)r=Hr(r,t);return r&&an(r)&&rr(r)&&!wr(r)?e:r||Qo(n)||e}const hl=async function(n){const t=this.getOffsetParent||fa,e=this.getDimensions,r=await e(n.floating);return{reference:dl(n.reference,await t(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function pl(n){return ue(n).direction==="rtl"}const ml={convertOffsetParentRelativeRectToViewportRelativeRect:rl,getDocumentElement:be,getClippingRect:fl,getOffsetParent:fa,getElementRects:hl,getClientRects:il,getDimensions:ul,getScale:en,isElement:fe,isRTL:pl};function ua(n,t){return n.x===t.x&&n.y===t.y&&n.width===t.width&&n.height===t.height}function gl(n,t){let e=null,r;const i=be(n);function a(){var o;clearTimeout(r),(o=e)==null||o.disconnect(),e=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),a();const c=n.getBoundingClientRect(),{left:u,top:d,width:_,height:f}=c;if(o||t(),!_||!f)return;const p=Cn(d),h=Cn(i.clientWidth-(u+_)),b=Cn(i.clientHeight-(d+f)),g=Cn(u),y={rootMargin:-p+"px "+-h+"px "+-b+"px "+-g+"px",threshold:ze(0,On(1,l))||1};let E=!0;function S(O){const A=O[0].intersectionRatio;if(A!==l){if(!E)return s();A?s(!1,A):r=setTimeout(()=>{s(!1,1e-7)},1e3)}A===1&&!ua(c,n.getBoundingClientRect())&&s(),E=!1}try{e=new IntersectionObserver(S,{...y,root:i.ownerDocument})}catch{e=new IntersectionObserver(S,y)}e.observe(n)}return s(!0),a}function _l(n,t,e,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:a=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=yr(n),u=i||a?[...c?pn(c):[],...pn(t)]:[];u.forEach(g=>{i&&g.addEventListener("scroll",e,{passive:!0}),a&&g.addEventListener("resize",e)});const d=c&&o?gl(c,e):null;let _=-1,f=null;s&&(f=new ResizeObserver(g=>{let[v]=g;v&&v.target===c&&f&&(f.unobserve(t),cancelAnimationFrame(_),_=requestAnimationFrame(()=>{var y;(y=f)==null||y.observe(t)})),e()}),c&&!l&&f.observe(c),f.observe(t));let p,h=l?We(n):null;l&&b();function b(){const g=We(n);h&&!ua(h,g)&&e(),h=g,p=requestAnimationFrame(b)}return e(),()=>{var g;u.forEach(v=>{i&&v.removeEventListener("scroll",e),a&&v.removeEventListener("resize",e)}),d?.(),(g=f)==null||g.disconnect(),f=null,l&&cancelAnimationFrame(p)}}const bl=Ho,wl=Vo,vl=Mo,yl=(n,t,e)=>{const r=new Map,i={platform:ml,...e},a={...i.platform,_c:r};return Lo(n,t,{...i,platform:a})};function kl(n){let t,e;const r={autoUpdate:!0};let i=n;const a=u=>({...r,...n||{},...u||{}}),s=u=>{t&&e&&(i=a(u),yl(t,e,i).then(d=>{Object.assign(e.style,{position:d.strategy,left:`${d.x}px`,top:`${d.y}px`}),i?.onComputed&&i.onComputed(d)}))},o=u=>{if("subscribe"in u)return c(u),{};t=u,s()},l=(u,d)=>{let _;e=u,i=a(d),setTimeout(()=>s(d),0),s(d);const f=()=>{_&&(_(),_=void 0)},p=({autoUpdate:h}=i||{})=>{if(f(),h!==!1)return _l(t,e,()=>s(i),h===!0?{}:h)};return _=p(),{update(h){s(h),_=p(h)},destroy(){f()}}},c=u=>{const d=u.subscribe(_=>{t===void 0?(t=_,s()):(Object.assign(t,_),s())});Tn(d)};return[o,l,s]}function Sl({loadOptions:n,filterText:t,items:e,multiple:r,value:i,itemId:a,groupBy:s,filterSelectedItems:o,itemFilter:l,convertStringItemsToObjects:c,filterGroupedItems:u,label:d}){if(e&&n)return e;if(!e)return[];e&&e.length>0&&typeof e[0]!="object"&&(e=c(e));let _=e.filter(f=>{let p=l(f[d],t,f);return p&&r&&i?.length&&(p=!i.some(h=>o?h[a]===f[a]:!1)),p});return s&&(_=u(_)),_}async function Cl({dispatch:n,loadOptions:t,convertStringItemsToObjects:e,filterText:r}){let i=await t(r).catch(a=>{console.warn("svelte-select loadOptions error :>> ",a),n("error",{type:"loadOptions",details:a})});if(i&&!i.cancelled)return i?(i&&i.length>0&&typeof i[0]!="object"&&(i=e(i)),n("loaded",{items:i})):i=[],{filteredItems:i,loading:!1,focused:!0,listOpen:!0}}function Fl(n){let t,e;return{c(){t=Pe("svg"),e=Pe("path"),Y(e,"fill","currentColor"),Y(e,"d",`M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747
          3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0
          1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502
          0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0
          0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z`),Y(t,"width","100%"),Y(t,"height","100%"),Y(t,"viewBox","0 0 20 20"),Y(t,"focusable","false"),Y(t,"aria-hidden","true")},m(r,i){pt(r,t,i),it(t,e)},p:Ct,i:Ct,o:Ct,d(r){r&&ht(t)}}}class El extends Qt{constructor(t){super(),Jt(this,t,null,Fl,Yt,{})}}function Pl(n){let t,e;return{c(){t=Pe("svg"),e=Pe("path"),Y(e,"fill","currentColor"),Y(e,"d",`M34.923,37.251L24,26.328L13.077,37.251L9.436,33.61l10.923-10.923L9.436,11.765l3.641-3.641L24,19.047L34.923,8.124
    l3.641,3.641L27.641,22.688L38.564,33.61L34.923,37.251z`),Y(t,"width","100%"),Y(t,"height","100%"),Y(t,"viewBox","-2 -2 50 50"),Y(t,"focusable","false"),Y(t,"aria-hidden","true"),Y(t,"role","presentation")},m(r,i){pt(r,t,i),it(t,e)},p:Ct,i:Ct,o:Ct,d(r){r&&ht(t)}}}class In extends Qt{constructor(t){super(),Jt(this,t,null,Pl,Yt,{})}}function Al(n){let t,e;return{c(){t=Pe("svg"),e=Pe("circle"),Y(e,"class","circle_path"),Y(e,"cx","50"),Y(e,"cy","50"),Y(e,"r","20"),Y(e,"fill","none"),Y(e,"stroke","currentColor"),Y(e,"stroke-width","5"),Y(e,"stroke-miterlimit","10"),Y(t,"class","loading"),Y(t,"viewBox","25 25 50 50")},m(r,i){pt(r,t,i),it(t,e)},p:Ct,i:Ct,o:Ct,d(r){r&&ht(t)}}}class Dl extends Qt{constructor(t){super(),Jt(this,t,null,Al,Yt,{})}}const Nl=n=>({value:n[0]&8}),Vr=n=>({value:n[3]}),jl=n=>({value:n[0]&8}),Zr=n=>({value:n[3]}),Tl=n=>({listOpen:n[0]&64}),Gr=n=>({listOpen:n[6]}),Ol=n=>({}),qr=n=>({}),xl=n=>({}),Kr=n=>({}),Bl=n=>({selection:n[0]&8}),Yr=n=>({selection:n[3]});function Xr(n,t,e){const r=n.slice();return r[126]=t[e],r[128]=e,r}const $l=n=>({}),Jr=n=>({}),Il=n=>({selection:n[0]&8}),Qr=n=>({selection:n[126],index:n[128]}),Rl=n=>({}),ti=n=>({}),zl=n=>({}),ei=n=>({}),Ll=n=>({}),ni=n=>({});function ri(n,t,e){const r=n.slice();return r[126]=t[e],r[128]=e,r}const Ml=n=>({item:n[0]&16777216}),ii=n=>({item:n[126],index:n[128]}),Ul=n=>({filteredItems:n[0]&16777216}),ai=n=>({filteredItems:n[24]}),Wl=n=>({}),si=n=>({});function oi(n){let t,e,r,i,a,s,o,l,c=n[50]["list-prepend"]&&li(n);const u=[Zl,Vl,Hl],d=[];function _(p,h){return p[50].list?0:p[24].length>0?1:p[19]?-1:2}~(r=_(n))&&(i=d[r]=u[r](n));let f=n[50]["list-append"]&&fi(n);return{c(){t=ft("div"),c&&c.c(),e=mt(),i&&i.c(),a=mt(),f&&f.c(),Y(t,"class","svelte-select-list"),Et(t,"prefloat",n[28])},m(p,h){pt(p,t,h),c&&c.m(t,null),it(t,e),~r&&d[r].m(t,null),it(t,a),f&&f.m(t,null),n[91](t),s=!0,o||(l=[An(n[49].call(null,t)),Ht(t,"scroll",n[41]),Ht(t,"pointerup",nn(Le(n[85]))),Ht(t,"mousedown",nn(Le(n[86])))],o=!0)},p(p,h){p[50]["list-prepend"]?c?(c.p(p,h),h[1]&524288&&M(c,1)):(c=li(p),c.c(),M(c,1),c.m(t,e)):c&&($t(),q(c,1,1,()=>{c=null}),It());let b=r;r=_(p),r===b?~r&&d[r].p(p,h):(i&&($t(),q(d[b],1,1,()=>{d[b]=null}),It()),~r?(i=d[r],i?i.p(p,h):(i=d[r]=u[r](p),i.c()),M(i,1),i.m(t,a)):i=null),p[50]["list-append"]?f?(f.p(p,h),h[1]&524288&&M(f,1)):(f=fi(p),f.c(),M(f,1),f.m(t,null)):f&&($t(),q(f,1,1,()=>{f=null}),It()),(!s||h[0]&268435456)&&Et(t,"prefloat",p[28])},i(p){s||(M(c),M(i),M(f),s=!0)},o(p){q(c),q(i),q(f),s=!1},d(p){p&&ht(t),c&&c.d(),~r&&d[r].d(),f&&f.d(),n[91](null),o=!1,_e(l)}}}function li(n){let t;const e=n[83]["list-prepend"],r=Tt(e,n,n[82],si);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a[2]&1048576)&&xt(r,e,i,i[82],t?Ot(e,i[82],a,Wl):Bt(i[82]),si)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function Hl(n){let t;const e=n[83].empty,r=Tt(e,n,n[82],ni),i=r||Gl();return{c(){i&&i.c()},m(a,s){i&&i.m(a,s),t=!0},p(a,s){r&&r.p&&(!t||s[2]&1048576)&&xt(r,e,a,a[82],t?Ot(e,a[82],s,Ll):Bt(a[82]),ni)},i(a){t||(M(i,a),t=!0)},o(a){q(i,a),t=!1},d(a){i&&i.d(a)}}}function Vl(n){let t,e,r=me(n[24]),i=[];for(let s=0;s<r.length;s+=1)i[s]=ci(ri(n,r,s));const a=s=>q(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();t=sn()},m(s,o){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(s,o);pt(s,t,o),e=!0},p(s,o){if(o[0]&1627402376|o[1]&28672|o[2]&1048576){r=me(s[24]);let l;for(l=0;l<r.length;l+=1){const c=ri(s,r,l);i[l]?(i[l].p(c,o),M(i[l],1)):(i[l]=ci(c),i[l].c(),M(i[l],1),i[l].m(t.parentNode,t))}for($t(),l=r.length;l<i.length;l+=1)a(l);It()}},i(s){if(!e){for(let o=0;o<r.length;o+=1)M(i[o]);e=!0}},o(s){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)q(i[o]);e=!1},d(s){s&&ht(t),Rn(i,s)}}}function Zl(n){let t;const e=n[83].list,r=Tt(e,n,n[82],ai);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a[0]&16777216|a[2]&1048576)&&xt(r,e,i,i[82],t?Ot(e,i[82],a,Ul):Bt(i[82]),ai)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function Gl(n){let t;return{c(){t=ft("div"),t.textContent="No options",Y(t,"class","empty")},m(e,r){pt(e,t,r)},p:Ct,d(e){e&&ht(t)}}}function ql(n){let t=n[126]?.[n[12]]+"",e;return{c(){e=Xt(t)},m(r,i){pt(r,e,i)},p(r,i){i[0]&16781312&&t!==(t=r[126]?.[r[12]]+"")&&Me(e,t)},d(r){r&&ht(e)}}}function ci(n){let t,e,r,i,a,s,o,l;const c=n[83].item,u=Tt(c,n,n[82],ii),d=u||ql(n);function _(){return n[88](n[128])}function f(){return n[89](n[128])}function p(){return n[90](n[126],n[128])}return{c(){t=ft("div"),e=ft("div"),d&&d.c(),a=mt(),Y(e,"class","item"),Et(e,"list-group-title",n[126].groupHeader),Et(e,"active",n[45](n[126],n[3],n[13])),Et(e,"first",sc(n[128])),Et(e,"hover",n[7]===n[128]),Et(e,"group-item",n[126].groupItem),Et(e,"not-selectable",n[126]?.selectable===!1),Y(t,"class","list-item"),Y(t,"tabindex","-1"),Y(t,"role","none")},m(h,b){pt(h,t,b),it(t,e),d&&d.m(e,null),it(t,a),s=!0,o||(l=[An(r=n[46].call(null,e,{scroll:n[45](n[126],n[3],n[13]),listDom:n[30]})),An(i=n[47].call(null,e,{scroll:n[29]===n[128],listDom:n[30]})),Ht(t,"mouseover",_),Ht(t,"focus",f),Ht(t,"click",nn(p)),Ht(t,"keydown",nn(Le(n[87])))],o=!0)},p(h,b){n=h,u?u.p&&(!s||b[0]&16777216|b[2]&1048576)&&xt(u,c,n,n[82],s?Ot(c,n[82],b,Ml):Bt(n[82]),ii):d&&d.p&&(!s||b[0]&16781312)&&d.p(n,s?b:[-1,-1,-1,-1,-1]),r&&Ee(r.update)&&b[0]&1090527240&&r.update.call(null,{scroll:n[45](n[126],n[3],n[13]),listDom:n[30]}),i&&Ee(i.update)&&b[0]&1610612736&&i.update.call(null,{scroll:n[29]===n[128],listDom:n[30]}),(!s||b[0]&16777216)&&Et(e,"list-group-title",n[126].groupHeader),(!s||b[0]&16785416|b[1]&16384)&&Et(e,"active",n[45](n[126],n[3],n[13])),(!s||b[0]&128)&&Et(e,"hover",n[7]===n[128]),(!s||b[0]&16777216)&&Et(e,"group-item",n[126].groupItem),(!s||b[0]&16777216)&&Et(e,"not-selectable",n[126]?.selectable===!1)},i(h){s||(M(d,h),s=!0)},o(h){q(d,h),s=!1},d(h){h&&ht(t),d&&d.d(h),o=!1,_e(l)}}}function fi(n){let t;const e=n[83]["list-append"],r=Tt(e,n,n[82],ei);return{c(){r&&r.c()},m(i,a){r&&r.m(i,a),t=!0},p(i,a){r&&r.p&&(!t||a[2]&1048576)&&xt(r,e,i,i[82],t?Ot(e,i[82],a,zl):Bt(i[82]),ei)},i(i){t||(M(r,i),t=!0)},o(i){q(r,i),t=!1},d(i){r&&r.d(i)}}}function ui(n){let t,e,r,i,a;return{c(){t=ft("span"),e=Xt(n[32]),r=mt(),i=ft("span"),a=Xt(n[31]),Y(t,"id","aria-selection"),Y(i,"id","aria-context")},m(s,o){pt(s,t,o),it(t,e),pt(s,r,o),pt(s,i,o),it(i,a)},p(s,o){o[1]&2&&Me(e,s[32]),o[1]&1&&Me(a,s[31])},d(s){s&&(ht(t),ht(r),ht(i))}}}function di(n){let t,e,r,i;const a=[Yl,Kl],s=[];function o(l,c){return l[9]?0:1}return t=o(n),e=s[t]=a[t](n),{c(){e.c(),r=sn()},m(l,c){s[t].m(l,c),pt(l,r,c),i=!0},p(l,c){let u=t;t=o(l),t===u?s[t].p(l,c):($t(),q(s[u],1,1,()=>{s[u]=null}),It(),e=s[t],e?e.p(l,c):(e=s[t]=a[t](l),e.c()),M(e,1),e.m(r.parentNode,r))},i(l){i||(M(e),i=!0)},o(l){q(e),i=!1},d(l){l&&ht(r),s[t].d(l)}}}function Kl(n){let t,e;const r=n[83].selection,i=Tt(r,n,n[82],Yr),a=i||Xl(n);return{c(){t=ft("div"),a&&a.c(),Y(t,"class","selected-item"),Et(t,"hide-selected-item",n[35])},m(s,o){pt(s,t,o),a&&a.m(t,null),e=!0},p(s,o){i?i.p&&(!e||o[0]&8|o[2]&1048576)&&xt(i,r,s,s[82],e?Ot(r,s[82],o,Bl):Bt(s[82]),Yr):a&&a.p&&(!e||o[0]&4104)&&a.p(s,e?o:[-1,-1,-1,-1,-1]),(!e||o[1]&16)&&Et(t,"hide-selected-item",s[35])},i(s){e||(M(a,s),e=!0)},o(s){q(a,s),e=!1},d(s){s&&ht(t),a&&a.d(s)}}}function Yl(n){let t,e,r=me(n[3]),i=[];for(let s=0;s<r.length;s+=1)i[s]=pi(Xr(n,r,s));const a=s=>q(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();t=sn()},m(s,o){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(s,o);pt(s,t,o),e=!0},p(s,o){if(o[0]&67116040|o[1]&32|o[2]&1048576){r=me(s[3]);let l;for(l=0;l<r.length;l+=1){const c=Xr(s,r,l);i[l]?(i[l].p(c,o),M(i[l],1)):(i[l]=pi(c),i[l].c(),M(i[l],1),i[l].m(t.parentNode,t))}for($t(),l=r.length;l<i.length;l+=1)a(l);It()}},i(s){if(!e){for(let o=0;o<r.length;o+=1)M(i[o]);e=!0}},o(s){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)q(i[o]);e=!1},d(s){s&&ht(t),Rn(i,s)}}}function Xl(n){let t=n[3][n[12]]+"",e;return{c(){e=Xt(t)},m(r,i){pt(r,e,i)},p(r,i){i[0]&4104&&t!==(t=r[3][r[12]]+"")&&Me(e,t)},d(r){r&&ht(e)}}}function Jl(n){let t=n[126][n[12]]+"",e;return{c(){e=Xt(t)},m(r,i){pt(r,e,i)},p(r,i){i[0]&4104&&t!==(t=r[126][r[12]]+"")&&Me(e,t)},d(r){r&&ht(e)}}}function hi(n){let t,e,r,i;const a=n[83]["multi-clear-icon"],s=Tt(a,n,n[82],Jr),o=s||Ql();function l(){return n[92](n[128])}return{c(){t=ft("div"),o&&o.c(),Y(t,"class","multi-item-clear")},m(c,u){pt(c,t,u),o&&o.m(t,null),e=!0,r||(i=Ht(t,"pointerup",nn(Le(l))),r=!0)},p(c,u){n=c,s&&s.p&&(!e||u[2]&1048576)&&xt(s,a,n,n[82],e?Ot(a,n[82],u,$l):Bt(n[82]),Jr)},i(c){e||(M(o,c),e=!0)},o(c){q(o,c),e=!1},d(c){c&&ht(t),o&&o.d(c),r=!1,i()}}}function Ql(n){let t,e;return t=new In({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function pi(n){let t,e,r,i,a,s,o;const l=n[83].selection,c=Tt(l,n,n[82],Qr),u=c||Jl(n);let d=!n[11]&&!n[10]&&In&&hi(n);function _(){return n[93](n[128])}return{c(){t=ft("div"),e=ft("span"),u&&u.c(),r=mt(),d&&d.c(),i=mt(),Y(e,"class","multi-item-text"),Y(t,"class","multi-item"),Y(t,"role","none"),Et(t,"active",n[26]===n[128]),Et(t,"disabled",n[11])},m(f,p){pt(f,t,p),it(t,e),u&&u.m(e,null),it(t,r),d&&d.m(t,null),it(t,i),a=!0,s||(o=[Ht(t,"click",Le(_)),Ht(t,"keydown",nn(Le(n[84])))],s=!0)},p(f,p){n=f,c?c.p&&(!a||p[0]&8|p[2]&1048576)&&xt(c,l,n,n[82],a?Ot(l,n[82],p,Il):Bt(n[82]),Qr):u&&u.p&&(!a||p[0]&4104)&&u.p(n,a?p:[-1,-1,-1,-1,-1]),!n[11]&&!n[10]&&In?d?(d.p(n,p),p[0]&3072&&M(d,1)):(d=hi(n),d.c(),M(d,1),d.m(t,i)):d&&($t(),q(d,1,1,()=>{d=null}),It()),(!a||p[0]&67108864)&&Et(t,"active",n[26]===n[128]),(!a||p[0]&2048)&&Et(t,"disabled",n[11])},i(f){a||(M(u,f),M(d),a=!0)},o(f){q(u,f),q(d),a=!1},d(f){f&&ht(t),u&&u.d(f),d&&d.d(),s=!1,_e(o)}}}function mi(n){let t,e;const r=n[83]["loading-icon"],i=Tt(r,n,n[82],Kr),a=i||tc();return{c(){t=ft("div"),a&&a.c(),Y(t,"class","icon loading"),Y(t,"aria-hidden","true")},m(s,o){pt(s,t,o),a&&a.m(t,null),e=!0},p(s,o){i&&i.p&&(!e||o[2]&1048576)&&xt(i,r,s,s[82],e?Ot(r,s[82],o,xl):Bt(s[82]),Kr)},i(s){e||(M(a,s),e=!0)},o(s){q(a,s),e=!1},d(s){s&&ht(t),a&&a.d(s)}}}function tc(n){let t,e;return t=new Dl({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function gi(n){let t,e,r,i;const a=n[83]["clear-icon"],s=Tt(a,n,n[82],qr),o=s||ec();return{c(){t=ft("button"),o&&o.c(),Y(t,"type","button"),Y(t,"class","icon clear-select")},m(l,c){pt(l,t,c),o&&o.m(t,null),e=!0,r||(i=Ht(t,"click",n[22]),r=!0)},p(l,c){s&&s.p&&(!e||c[2]&1048576)&&xt(s,a,l,l[82],e?Ot(a,l[82],c,Ol):Bt(l[82]),qr)},i(l){e||(M(o,l),e=!0)},o(l){q(o,l),e=!1},d(l){l&&ht(t),o&&o.d(l),r=!1,i()}}}function ec(n){let t,e;return t=new In({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function _i(n){let t,e;const r=n[83]["chevron-icon"],i=Tt(r,n,n[82],Gr),a=i||nc();return{c(){t=ft("div"),a&&a.c(),Y(t,"class","icon chevron"),Y(t,"aria-hidden","true")},m(s,o){pt(s,t,o),a&&a.m(t,null),e=!0},p(s,o){i&&i.p&&(!e||o[0]&64|o[2]&1048576)&&xt(i,r,s,s[82],e?Ot(r,s[82],o,Tl):Bt(s[82]),Gr)},i(s){e||(M(a,s),e=!0)},o(s){q(a,s),e=!1},d(s){s&&ht(t),a&&a.d(s)}}}function nc(n){let t,e;return t=new El({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function rc(n){let t,e;return{c(){t=ft("input"),Y(t,"name",n[8]),Y(t,"type","hidden"),t.value=e=n[3]?JSON.stringify(n[3]):null},m(r,i){pt(r,t,i)},p(r,i){i[0]&256&&Y(t,"name",r[8]),i[0]&8&&e!==(e=r[3]?JSON.stringify(r[3]):null)&&(t.value=e)},d(r){r&&ht(t)}}}function bi(n){let t;const e=n[83].required,r=Tt(e,n,n[82],Vr),i=r||ic();return{c(){i&&i.c()},m(a,s){i&&i.m(a,s),t=!0},p(a,s){r&&r.p&&(!t||s[0]&8|s[2]&1048576)&&xt(r,e,a,a[82],t?Ot(e,a[82],s,Nl):Bt(a[82]),Vr)},i(a){t||(M(i,a),t=!0)},o(a){q(i,a),t=!1},d(a){i&&i.d(a)}}}function ic(n){let t;return{c(){t=ft("select"),Y(t,"class","required"),t.required=!0,Y(t,"tabindex","-1"),Y(t,"aria-hidden","true")},m(e,r){pt(e,t,r)},p:Ct,d(e){e&&ht(t)}}}function ac(n){let t,e,r,i,a,s,o,l,c,u,d,_,f,p,h,b,g,v,y,E,S=n[6]&&oi(n),O=n[2]&&ui(n);const A=n[83].prepend,U=Tt(A,n,n[82],ti);let D=n[25]&&di(n),R=[{readOnly:u=!n[17]},n[27],{placeholder:n[33]},{style:n[18]},{disabled:n[11]}],j={};for(let x=0;x<R.length;x+=1)j=At(j,R[x]);let C=n[5]&&mi(n),$=n[34]&&gi(n),w=n[20]&&_i(n);const V=n[83]["input-hidden"],lt=Tt(V,n,n[82],Zr),K=lt||rc(n);let st=n[16]&&(!n[3]||n[3].length===0)&&bi(n);return{c(){t=ft("div"),S&&S.c(),e=mt(),r=ft("span"),O&&O.c(),i=mt(),a=ft("div"),U&&U.c(),s=mt(),o=ft("div"),D&&D.c(),l=mt(),c=ft("input"),d=mt(),_=ft("div"),C&&C.c(),f=mt(),$&&$.c(),p=mt(),w&&w.c(),h=mt(),K&&K.c(),b=mt(),st&&st.c(),Y(r,"aria-live","polite"),Y(r,"aria-atomic","false"),Y(r,"aria-relevant","additions text"),Y(r,"class","a11y-text"),Y(a,"class","prepend"),Tr(c,j),Y(o,"class","value-container"),Y(_,"class","indicators"),Y(t,"class",g="svelte-select "+n[21]),Y(t,"style",n[14]),Y(t,"role","none"),Et(t,"multi",n[9]),Et(t,"disabled",n[11]),Et(t,"focused",n[2]),Et(t,"list-open",n[6]),Et(t,"show-chevron",n[20]),Et(t,"error",n[15])},m(x,tt){pt(x,t,tt),S&&S.m(t,null),it(t,e),it(t,r),O&&O.m(r,null),it(t,i),it(t,a),U&&U.m(a,null),it(t,s),it(t,o),D&&D.m(o,null),it(o,l),it(o,c),c.autofocus&&c.focus(),n[94](c),rn(c,n[4]),it(t,d),it(t,_),C&&C.m(_,null),it(_,f),$&&$.m(_,null),it(_,p),w&&w.m(_,null),it(t,h),K&&K.m(t,null),it(t,b),st&&st.m(t,null),n[96](t),v=!0,y||(E=[Ht(window,"click",n[42]),Ht(window,"keydown",n[37]),Ht(c,"keydown",n[37]),Ht(c,"blur",n[39]),Ht(c,"focus",n[38]),Ht(c,"input",n[95]),Ht(t,"pointerup",Le(n[40])),An(n[48].call(null,t))],y=!0)},p(x,tt){x[6]?S?(S.p(x,tt),tt[0]&64&&M(S,1)):(S=oi(x),S.c(),M(S,1),S.m(t,e)):S&&($t(),q(S,1,1,()=>{S=null}),It()),x[2]?O?O.p(x,tt):(O=ui(x),O.c(),O.m(r,null)):O&&(O.d(1),O=null),U&&U.p&&(!v||tt[2]&1048576)&&xt(U,A,x,x[82],v?Ot(A,x[82],tt,Rl):Bt(x[82]),ti),x[25]?D?(D.p(x,tt),tt[0]&33554432&&M(D,1)):(D=di(x),D.c(),M(D,1),D.m(o,l)):D&&($t(),q(D,1,1,()=>{D=null}),It()),Tr(c,j=de(R,[(!v||tt[0]&131072&&u!==(u=!x[17]))&&{readOnly:u},tt[0]&134217728&&x[27],(!v||tt[1]&4)&&{placeholder:x[33]},(!v||tt[0]&262144)&&{style:x[18]},(!v||tt[0]&2048)&&{disabled:x[11]}])),tt[0]&16&&c.value!==x[4]&&rn(c,x[4]),x[5]?C?(C.p(x,tt),tt[0]&32&&M(C,1)):(C=mi(x),C.c(),M(C,1),C.m(_,f)):C&&($t(),q(C,1,1,()=>{C=null}),It()),x[34]?$?($.p(x,tt),tt[1]&8&&M($,1)):($=gi(x),$.c(),M($,1),$.m(_,p)):$&&($t(),q($,1,1,()=>{$=null}),It()),x[20]?w?(w.p(x,tt),tt[0]&1048576&&M(w,1)):(w=_i(x),w.c(),M(w,1),w.m(_,null)):w&&($t(),q(w,1,1,()=>{w=null}),It()),lt?lt.p&&(!v||tt[0]&8|tt[2]&1048576)&&xt(lt,V,x,x[82],v?Ot(V,x[82],tt,jl):Bt(x[82]),Zr):K&&K.p&&(!v||tt[0]&264)&&K.p(x,v?tt:[-1,-1,-1,-1,-1]),x[16]&&(!x[3]||x[3].length===0)?st?(st.p(x,tt),tt[0]&65544&&M(st,1)):(st=bi(x),st.c(),M(st,1),st.m(t,null)):st&&($t(),q(st,1,1,()=>{st=null}),It()),(!v||tt[0]&2097152&&g!==(g="svelte-select "+x[21]))&&Y(t,"class",g),(!v||tt[0]&16384)&&Y(t,"style",x[14]),(!v||tt[0]&2097664)&&Et(t,"multi",x[9]),(!v||tt[0]&2099200)&&Et(t,"disabled",x[11]),(!v||tt[0]&2097156)&&Et(t,"focused",x[2]),(!v||tt[0]&2097216)&&Et(t,"list-open",x[6]),(!v||tt[0]&3145728)&&Et(t,"show-chevron",x[20]),(!v||tt[0]&2129920)&&Et(t,"error",x[15])},i(x){v||(M(S),M(U,x),M(D),M(C),M($),M(w),M(K,x),M(st),v=!0)},o(x){q(S),q(U,x),q(D),q(C),q($),q(w),q(K,x),q(st),v=!1},d(x){x&&ht(t),S&&S.d(),O&&O.d(),U&&U.d(x),D&&D.d(),n[94](null),C&&C.d(),$&&$.d(),w&&w.d(),K&&K.d(x),st&&st.d(),n[96](null),y=!1,_e(E)}}}function wi(n){return n.map((t,e)=>({index:e,value:t,label:`${t}`}))}function sc(n){return n===0}function oc(n){return n.groupHeader&&n.selectable||n.selectable||!n.hasOwnProperty("selectable")}function lc(n,t,e){let r,i,a,s,o,l,c,u,d,{$$slots:_={},$$scope:f}=t;const p=vs(_),h=$s();let{justValue:b=null}=t,{filter:g=Sl}=t,{getItems:v=Cl}=t,{id:y=null}=t,{name:E=null}=t,{container:S=void 0}=t,{input:O=void 0}=t,{multiple:A=!1}=t,{multiFullItemClearable:U=!1}=t,{disabled:D=!1}=t,{focused:R=!1}=t,{value:j=null}=t,{filterText:C=""}=t,{placeholder:$="Please select"}=t,{placeholderAlwaysShow:w=!1}=t,{items:V=null}=t,{label:lt="label"}=t,{itemFilter:K=(P,ct,zt)=>`${P}`.toLowerCase().includes(ct.toLowerCase())}=t,{groupBy:st=void 0}=t,{groupFilter:x=P=>P}=t,{groupHeaderSelectable:tt=!1}=t,{itemId:B="value"}=t,{loadOptions:z=void 0}=t,{containerStyles:dt=""}=t,{hasError:ot=!1}=t,{filterSelectedItems:at=!0}=t,{required:Nt=!1}=t,{closeListOnChange:Mt=!0}=t,{clearFilterTextOnBlur:wt=!0}=t,{createGroupHeaderItem:yt=(P,ct)=>({value:P,[lt]:P})}=t;const Ut=()=>c;let{searchable:Dt=!0}=t,{inputStyles:te=""}=t,{clearable:Gt=!0}=t,{loading:m=!1}=t,{listOpen:L=!1}=t,H,{debounce:F=(P,ct=1)=>{clearTimeout(H),H=setTimeout(P,ct)}}=t,{debounceWait:k=300}=t,{hideEmptyState:N=!1}=t,{inputAttributes:X={}}=t,{listAutoWidth:J=!0}=t,{showChevron:I=!1}=t,{listOffset:et=5}=t,{hoverItemIndex:Q=0}=t,{floatingConfig:nt={}}=t,{class:ut=""}=t,W,rt,vt,Rt;function Wt(){if(typeof j=="string"){let P=(V||[]).find(ct=>ct[B]===j);e(3,j=P||{[B]:j,label:j})}else A&&Array.isArray(j)&&j.length>0&&e(3,j=j.map(P=>typeof P=="string"?{value:P,label:P}:P))}let Pt;function Ft(){e(27,Pt=Object.assign({autocapitalize:"none",autocomplete:"off",autocorrect:"off",spellcheck:!1,tabindex:0,type:"text","aria-autocomplete":"list"},X)),y&&e(27,Pt.id=y,Pt),Dt||e(27,Pt.readonly=!0,Pt)}function ee(P){const ct=[],zt={};P.forEach(Ve=>{const ye=st(Ve);ct.includes(ye)||(ct.push(ye),zt[ye]=[],ye&&zt[ye].push(Object.assign(yt(ye,Ve),{id:ye,groupHeader:!0,selectable:tt}))),zt[ye].push(Object.assign({groupItem:!!ye},Ve))});const ve=[];return x(ct).forEach(Ve=>{zt[Ve]&&ve.push(...zt[Ve])}),ve}function kt(){if(A){JSON.stringify(j)!==JSON.stringify(rt)&&Be()&&h("input",j);return}h("input",j)}function qt(){j&&(Array.isArray(j)?e(3,j=[...j]):e(3,j=[j]))}function Te(){const P=c.findIndex(ct=>ct[B]===j[B]);_n(P,!0)}function Oe(P){h("hoverItem",P)}function _n(P=0,ct){e(7,Q=P<0?0:P),!ct&&st&&c[Q]&&!c[Q].selectable&&vn(1)}function Vn(){!z&&C.length===0||(z?F(async function(){e(5,m=!0);let P=await v({dispatch:h,loadOptions:z,convertStringItemsToObjects:wi,filterText:C});P?(e(5,m=P.loading),e(6,L=L?P.listOpen:C.length>0),e(2,R=L&&P.focused),e(51,V=st?ee(P.filteredItems):P.filteredItems)):(e(5,m=!1),e(2,R=!0),e(6,L=!0))},k):(e(6,L=!0),A&&e(26,W=void 0)))}function bn(P){L&&h("filter",P)}function xe(){return A?j?j.map(P=>P[B]):null:j&&j[B]}function Be(){let P=!0;if(j){const ct=[],zt=[];j.forEach(ve=>{ct.includes(ve[B])?P=!1:(ct.push(ve[B]),zt.push(ve))}),P||e(3,j=zt)}return P}function kr(P){let ct=P?P[B]:j[B];return V.find(zt=>zt[B]===ct)}function ma(P){!P||P.length===0||P.some(ct=>typeof ct!="object")||!j||(A?j.some(ct=>!ct||!ct[B]):!j[B])||(Array.isArray(j)?e(3,j=j.map(ct=>kr(ct)||ct)):e(3,j=kr()||j))}async function wn(P){const ct=j[P];j.length===1?e(3,j=void 0):e(3,j=j.filter(zt=>zt!==ct)),h("clear",ct)}function ga(P){if(R)switch(P.stopPropagation(),P.key){case"Escape":P.preventDefault(),we();break;case"Enter":if(P.preventDefault(),L){if(c.length===0)break;const ct=c[Q];if(j&&!A&&j[B]===ct[B]){we();break}else Xn(c[Q])}break;case"ArrowDown":P.preventDefault(),L?vn(1):(e(6,L=!0),e(26,W=void 0));break;case"ArrowUp":P.preventDefault(),L?vn(-1):(e(6,L=!0),e(26,W=void 0));break;case"Tab":if(L&&R){if(c.length===0||j&&j[B]===c[Q][B])return we();P.preventDefault(),Xn(c[Q]),we()}break;case"Backspace":if(!A||C.length>0)return;if(A&&j&&j.length>0){if(wn(W!==void 0?W:j.length-1),W===0||W===void 0)break;e(26,W=j.length>W?W-1:void 0)}break;case"ArrowLeft":if(!j||!A||C.length>0)return;W===void 0?e(26,W=j.length-1):j.length>W&&W!==0&&e(26,W-=1);break;case"ArrowRight":if(!j||!A||C.length>0||W===void 0)return;W===j.length-1?e(26,W=void 0):W<j.length-1&&e(26,W+=1);break}}function Zn(P){R&&O===document?.activeElement||(P&&h("focus",P),O?.focus(),e(2,R=!0))}async function Sr(P){Yn||(L||R)&&(h("blur",P),we(),e(2,R=!1),e(26,W=void 0),O?.blur())}function _a(){if(!D){if(C.length>0)return e(6,L=!0);e(6,L=!L)}}function ba(){h("clear",j),e(3,j=void 0),we(),Zn()}function wa(P){if(P){e(4,C="");const ct=Object.assign({},P);if(ct.groupHeader&&!ct.selectable)return;e(3,j=A?j?j.concat([ct]):[ct]:e(3,j=ct)),setTimeout(()=>{Mt&&we(),e(26,W=void 0),h("change",j),h("select",P)})}}function we(){wt&&e(4,C=""),e(6,L=!1)}let{ariaValues:Gn=P=>`Option ${P}, selected.`}=t,{ariaListOpen:qn=(P,ct)=>`You are currently focused on option ${P}. There are ${ct} results available.`}=t,{ariaFocused:Kn=()=>"Select is focused, type to refine list, press down to open the menu."}=t;function va(P){let ct;return P&&j.length>0?ct=j.map(zt=>zt[lt]).join(", "):ct=j[lt],Gn(ct)}function ya(){if(!c||c.length===0)return"";let P=c[Q];if(L&&P){let ct=c?c.length:0;return qn(P[lt],ct)}else return Kn()}let he=null,Cr;function Fr(){clearTimeout(Cr),Cr=setTimeout(()=>{Yn=!1},100)}function ka(P){!L&&!R&&S&&!S.contains(P.target)&&!he?.contains(P.target)&&Sr()}Tn(()=>{he?.remove()});let Yn=!1;function Xn(P){!P||P.selectable===!1||wa(P)}function Jn(P){Yn||e(7,Q=P)}function Er(P){const{item:ct,i:zt}=P;if(ct?.selectable!==!1){if(j&&!A&&j[B]===ct[B])return we();oc(ct)&&(e(7,Q=zt),Xn(ct))}}function vn(P){if(c.filter(ve=>!Object.hasOwn(ve,"selectable")||ve.selectable===!0).length===0)return e(7,Q=0);P>0&&Q===c.length-1?e(7,Q=0):P<0&&Q===0?e(7,Q=c.length-1):e(7,Q=Q+P);const zt=c[Q];if(zt&&zt.selectable===!1){(P===1||P===-1)&&vn(P);return}}function Sa(P,ct,zt){if(!A)return ct&&ct[zt]===P[zt]}const Ca=Pr,Fa=Pr;function Pr(P){return{update(ct){ct.scroll&&(Fr(),P.scrollIntoView({behavior:"auto",block:"nearest"}))}}}function Ea(){const{width:P}=S.getBoundingClientRect();e(23,he.style.width=J?P+"px":"auto",he)}let ln={strategy:"absolute",placement:"bottom-start",middleware:[bl(et),vl(),wl()],autoUpdate:!1};const[Pa,Aa,Da]=kl(ln);let Qn=!0;function Na(P,ct){if(!P||!ct)return e(28,Qn=!0);setTimeout(()=>{e(28,Qn=!1)},0)}function ja(P){Sn.call(this,n,P)}function Ta(P){Sn.call(this,n,P)}function Oa(P){Sn.call(this,n,P)}function xa(P){Sn.call(this,n,P)}const Ba=P=>Jn(P),$a=P=>Jn(P),Ia=(P,ct)=>Er({item:P,i:ct});function Ra(P){Qe[P?"unshift":"push"](()=>{he=P,e(23,he)})}const za=P=>wn(P),La=P=>U?wn(P):{};function Ma(P){Qe[P?"unshift":"push"](()=>{O=P,e(1,O)})}function Ua(){C=this.value,e(4,C)}function Wa(P){Qe[P?"unshift":"push"](()=>{S=P,e(0,S)})}return n.$$set=P=>{"justValue"in P&&e(52,b=P.justValue),"filter"in P&&e(53,g=P.filter),"getItems"in P&&e(54,v=P.getItems),"id"in P&&e(55,y=P.id),"name"in P&&e(8,E=P.name),"container"in P&&e(0,S=P.container),"input"in P&&e(1,O=P.input),"multiple"in P&&e(9,A=P.multiple),"multiFullItemClearable"in P&&e(10,U=P.multiFullItemClearable),"disabled"in P&&e(11,D=P.disabled),"focused"in P&&e(2,R=P.focused),"value"in P&&e(3,j=P.value),"filterText"in P&&e(4,C=P.filterText),"placeholder"in P&&e(56,$=P.placeholder),"placeholderAlwaysShow"in P&&e(57,w=P.placeholderAlwaysShow),"items"in P&&e(51,V=P.items),"label"in P&&e(12,lt=P.label),"itemFilter"in P&&e(58,K=P.itemFilter),"groupBy"in P&&e(59,st=P.groupBy),"groupFilter"in P&&e(60,x=P.groupFilter),"groupHeaderSelectable"in P&&e(61,tt=P.groupHeaderSelectable),"itemId"in P&&e(13,B=P.itemId),"loadOptions"in P&&e(62,z=P.loadOptions),"containerStyles"in P&&e(14,dt=P.containerStyles),"hasError"in P&&e(15,ot=P.hasError),"filterSelectedItems"in P&&e(63,at=P.filterSelectedItems),"required"in P&&e(16,Nt=P.required),"closeListOnChange"in P&&e(64,Mt=P.closeListOnChange),"clearFilterTextOnBlur"in P&&e(65,wt=P.clearFilterTextOnBlur),"createGroupHeaderItem"in P&&e(66,yt=P.createGroupHeaderItem),"searchable"in P&&e(17,Dt=P.searchable),"inputStyles"in P&&e(18,te=P.inputStyles),"clearable"in P&&e(68,Gt=P.clearable),"loading"in P&&e(5,m=P.loading),"listOpen"in P&&e(6,L=P.listOpen),"debounce"in P&&e(69,F=P.debounce),"debounceWait"in P&&e(70,k=P.debounceWait),"hideEmptyState"in P&&e(19,N=P.hideEmptyState),"inputAttributes"in P&&e(71,X=P.inputAttributes),"listAutoWidth"in P&&e(72,J=P.listAutoWidth),"showChevron"in P&&e(20,I=P.showChevron),"listOffset"in P&&e(73,et=P.listOffset),"hoverItemIndex"in P&&e(7,Q=P.hoverItemIndex),"floatingConfig"in P&&e(74,nt=P.floatingConfig),"class"in P&&e(21,ut=P.class),"ariaValues"in P&&e(75,Gn=P.ariaValues),"ariaListOpen"in P&&e(76,qn=P.ariaListOpen),"ariaFocused"in P&&e(77,Kn=P.ariaFocused),"$$scope"in P&&e(82,f=P.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&8|n.$$.dirty[1]&1048576&&j&&Wt(),n.$$.dirty[0]&131072|n.$$.dirty[2]&512&&(X||!Dt)&&Ft(),n.$$.dirty[0]&512&&A&&qt(),n.$$.dirty[0]&512|n.$$.dirty[2]&262144,n.$$.dirty[0]&520&&A&&j&&j.length>1&&Be(),n.$$.dirty[0]&8&&j&&kt(),n.$$.dirty[0]&520|n.$$.dirty[2]&65536,n.$$.dirty[0]&6&&!R&&O&&we(),n.$$.dirty[0]&16|n.$$.dirty[2]&131072&&C!==vt&&Vn(),n.$$.dirty[0]&12824|n.$$.dirty[1]&407896064|n.$$.dirty[2]&3&&e(24,c=g({loadOptions:z,filterText:C,items:V,multiple:A,value:j,itemId:B,groupBy:st,label:lt,filterSelectedItems:at,itemFilter:K,convertStringItemsToObjects:wi,filterGroupedItems:ee})),n.$$.dirty[0]&16777800&&!A&&L&&j&&c&&Te(),n.$$.dirty[0]&576&&L&&A&&e(7,Q=0),n.$$.dirty[0]&16&&C&&e(7,Q=0),n.$$.dirty[0]&128&&Oe(Q),n.$$.dirty[0]&520&&e(25,r=A?j&&j.length>0:j),n.$$.dirty[0]&33554448&&e(35,i=r&&C.length>0),n.$$.dirty[0]&33556512|n.$$.dirty[2]&64&&e(34,a=r&&Gt&&!D&&!m),n.$$.dirty[0]&520|n.$$.dirty[1]&100663296&&e(33,s=w&&A||A&&j?.length===0?$:j?"":$),n.$$.dirty[0]&520&&e(32,o=j?va(A):""),n.$$.dirty[0]&16777412&&e(31,l=ya()),n.$$.dirty[1]&1048576&&ma(V),n.$$.dirty[0]&8712&&e(52,b=xe()),n.$$.dirty[0]&520|n.$$.dirty[2]&65536,n.$$.dirty[0]&16777800&&L&&c&&!A&&!j&&_n(),n.$$.dirty[0]&16777216&&bn(c),n.$$.dirty[0]&1|n.$$.dirty[2]&4096&&S&&nt?.autoUpdate===void 0&&e(81,ln.autoUpdate=!0,ln),n.$$.dirty[0]&1|n.$$.dirty[2]&528384&&S&&nt&&Da(Object.assign(ln,nt)),n.$$.dirty[0]&8388608&&e(30,u=!!he),n.$$.dirty[0]&8388672&&Na(he,L),n.$$.dirty[0]&8388673&&L&&S&&he&&Ea(),n.$$.dirty[0]&128&&e(29,d=Q),n.$$.dirty[0]&70&&O&&L&&!R&&Zn()},[S,O,R,j,C,m,L,Q,E,A,U,D,lt,B,dt,ot,Nt,Dt,te,N,I,ut,ba,he,c,r,W,Pt,Qn,d,u,l,o,s,a,i,wn,ga,Zn,Sr,_a,Fr,ka,Jn,Er,Sa,Ca,Fa,Pa,Aa,p,V,b,g,v,y,$,w,K,st,x,tt,z,at,Mt,wt,yt,Ut,Gt,F,k,X,J,et,nt,Gn,qn,Kn,rt,vt,Rt,ln,f,_,ja,Ta,Oa,xa,Ba,$a,Ia,Ra,za,La,Ma,Ua,Wa]}class cc extends Qt{constructor(t){super(),Jt(this,t,lc,ac,Yt,{justValue:52,filter:53,getItems:54,id:55,name:8,container:0,input:1,multiple:9,multiFullItemClearable:10,disabled:11,focused:2,value:3,filterText:4,placeholder:56,placeholderAlwaysShow:57,items:51,label:12,itemFilter:58,groupBy:59,groupFilter:60,groupHeaderSelectable:61,itemId:13,loadOptions:62,containerStyles:14,hasError:15,filterSelectedItems:63,required:16,closeListOnChange:64,clearFilterTextOnBlur:65,createGroupHeaderItem:66,getFilteredItems:67,searchable:17,inputStyles:18,clearable:68,loading:5,listOpen:6,debounce:69,debounceWait:70,hideEmptyState:19,inputAttributes:71,listAutoWidth:72,showChevron:20,listOffset:73,hoverItemIndex:7,floatingConfig:74,class:21,handleClear:22,ariaValues:75,ariaListOpen:76,ariaFocused:77},null,[-1,-1,-1,-1,-1])}get getFilteredItems(){return this.$$.ctx[67]}get handleClear(){return this.$$.ctx[22]}}function da(n){const t=n-1;return t*t*t+1}function fc(n,{from:t,to:e},r={}){const i=getComputedStyle(n),a=i.transform==="none"?"":i.transform,[s,o]=i.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*s/e.width-(e.left+s),c=t.top+t.height*o/e.height-(e.top+o),{delay:u=0,duration:d=f=>Math.sqrt(f)*120,easing:_=da}=r;return{delay:u,duration:Ee(d)?d(Math.sqrt(l*l+c*c)):d,easing:_,css:(f,p)=>{const h=p*l,b=p*c,g=f+p*t.width/e.width,v=f+p*t.height/e.height;return`transform: ${a} translate(${h}px, ${b}px) scale(${g}, ${v});`}}}function vi(n,t,e){const r=n.slice();return r[65]=t[e],r[67]=e,r}function yi(n,t,e){const r=n.slice();return r[68]=t[e],r}function uc(n){let t,e;return t=new Ji({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function dc(n){let t;return{c(){t=Xt("New Project")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function ki(n){let t;return{c(){t=ft("div"),t.textContent="No projects found.",Y(t,"class","wa-muted"),Fe(t,"margin","4rem auto 0"),Fe(t,"font-size","18px"),Fe(t,"width","fit-content")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function Si(n){let t,e,r,i,a,s,o;function l(u){n[41](u)}let c={name:"wa-project-select",class:"wa-select",items:n[7],showChevron:!0,disabled:Ic,clearable:!1,searchable:!1,placeholder:"Choose a project...",containerStyles:"background: var(--select-bg); color: var(--select-text); border: 1px solid var(--select-border); border-radius: none; min-height: 38px; box-shadow: none; font-size: 1em; transition: border 0.2s;"};return n[3]!==void 0&&(c.value=n[3]),a=new cc({props:c}),Qe.push(()=>Vs(a,"value",l)),a.$on("select",n[42]),{c(){t=ft("div"),e=ft("label"),e.textContent="Select project",r=mt(),i=ft("div"),bt(a.$$.fragment),Y(e,"for","wa-project-select"),Y(i,"class","project-select-row svelte-1jljdvn"),Fe(t,"margin","20px 0")},m(u,d){pt(u,t,d),it(t,e),it(t,r),it(t,i),gt(a,i,null),o=!0},p(u,d){const _={};d[0]&128&&(_.items=u[7]),!s&&d[0]&8&&(s=!0,_.value=u[3],zs(()=>s=!1)),a.$set(_)},i(u){o||(M(a.$$.fragment,u),o=!0)},o(u){q(a.$$.fragment,u),o=!1},d(u){u&&ht(t),_t(a)}}}function Ci(n){let t,e,r,i,a,s,o,l,c,u,d,_,f,p,h,b;o=new ce({props:{ariaLabel:"Toggle draft sort order",title:void 0,clickHandler:n[43],$$slots:{default:[mc]},$$scope:{ctx:n}}}),u=new ke({props:{clickHandler:n[23],variant:"primary",$$slots:{default:[gc]},$$scope:{ctx:n}}}),_=new ce({props:{ariaLabel:"Refresh drafts",title:void 0,clickHandler:n[20],disabled:n[8],spinning:n[8],$$slots:{default:[_c]},$$scope:{ctx:n}}});let g=n[9]&&Fi(n),v=n[5].length===0&&Ei(),y=n[5].length>0&&Pi(n);return{c(){t=ft("div"),e=ft("div"),r=ft("div"),i=ft("div"),a=ft("div"),a.textContent="Drafts",s=mt(),bt(o.$$.fragment),l=mt(),c=ft("div"),bt(u.$$.fragment),d=mt(),bt(_.$$.fragment),f=mt(),g&&g.c(),p=mt(),v&&v.c(),h=mt(),y&&y.c(),Y(a,"class","wa-title"),Y(i,"class","wa-button-group"),Y(c,"class","wa-button-group"),Y(r,"class","wa-row justify-between"),Y(e,"class","wa-panel-header svelte-1jljdvn"),Y(t,"class","draft-controls"),Fe(t,"margin-top","16px")},m(E,S){pt(E,t,S),it(t,e),it(e,r),it(r,i),it(i,a),it(i,s),gt(o,i,null),it(r,l),it(r,c),gt(u,c,null),it(c,d),gt(_,c,null),it(t,f),g&&g.m(t,null),it(t,p),v&&v.m(t,null),it(t,h),y&&y.m(t,null),b=!0},p(E,S){const O={};S[0]&2048&&(O.clickHandler=E[43]),S[0]&2048|S[2]&512&&(O.$$scope={dirty:S,ctx:E}),o.$set(O);const A={};S[2]&512&&(A.$$scope={dirty:S,ctx:E}),u.$set(A);const U={};S[0]&256&&(U.disabled=E[8]),S[0]&256&&(U.spinning=E[8]),S[2]&512&&(U.$$scope={dirty:S,ctx:E}),_.$set(U),E[9]?g?(g.p(E,S),S[0]&512&&M(g,1)):(g=Fi(E),g.c(),M(g,1),g.m(t,p)):g&&($t(),q(g,1,1,()=>{g=null}),It()),E[5].length===0?v||(v=Ei(),v.c(),v.m(t,h)):v&&(v.d(1),v=null),E[5].length>0?y?(y.p(E,S),S[0]&32&&M(y,1)):(y=Pi(E),y.c(),M(y,1),y.m(t,null)):y&&($t(),q(y,1,1,()=>{y=null}),It())},i(E){b||(M(o.$$.fragment,E),M(u.$$.fragment,E),M(_.$$.fragment,E),M(g),M(y),b=!0)},o(E){q(o.$$.fragment,E),q(u.$$.fragment,E),q(_.$$.fragment,E),q(g),q(y),b=!1},d(E){E&&ht(t),_t(o),_t(u),_t(_),g&&g.d(),v&&v.d(),y&&y.d()}}}function hc(n){let t,e;return t=new qi({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function pc(n){let t,e;return t=new Ki({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function mc(n){let t,e,r,i;const a=[pc,hc],s=[];function o(l,c){return l[11]?0:1}return t=o(n),e=s[t]=a[t](n),{c(){e.c(),r=sn()},m(l,c){s[t].m(l,c),pt(l,r,c),i=!0},p(l,c){let u=t;t=o(l),t!==u&&($t(),q(s[u],1,1,()=>{s[u]=null}),It(),e=s[t],e||(e=s[t]=a[t](l),e.c()),M(e,1),e.m(r.parentNode,r))},i(l){i||(M(e),i=!0)},o(l){q(e),i=!1},d(l){l&&ht(r),s[t].d(l)}}}function gc(n){let t;return{c(){t=Xt("New Draft")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function _c(n){let t,e;return t=new Ji({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Fi(n){let t,e,r,i,a,s,o,l,c;return i=new ke({props:{clickHandler:n[22],variant:"primary",$$slots:{default:[bc]},$$scope:{ctx:n}}}),s=new ke({props:{clickHandler:n[45],$$slots:{default:[wc]},$$scope:{ctx:n}}}),{c(){t=ft("div"),e=ft("input"),r=mt(),bt(i.$$.fragment),a=mt(),bt(s.$$.fragment),Y(e,"class","wa-create-draft-input"),Y(e,"type","text"),Y(e,"placeholder","Draft name"),Y(t,"class","create-inline wa-row svelte-1jljdvn")},m(u,d){pt(u,t,d),it(t,e),rn(e,n[10]),it(t,r),gt(i,t,null),it(t,a),gt(s,t,null),o=!0,l||(c=Ht(e,"input",n[44]),l=!0)},p(u,d){d[0]&1024&&e.value!==u[10]&&rn(e,u[10]);const _={};d[2]&512&&(_.$$scope={dirty:d,ctx:u}),i.$set(_);const f={};d[0]&1536&&(f.clickHandler=u[45]),d[2]&512&&(f.$$scope={dirty:d,ctx:u}),s.$set(f)},i(u){o||(M(i.$$.fragment,u),M(s.$$.fragment,u),o=!0)},o(u){q(i.$$.fragment,u),q(s.$$.fragment,u),o=!1},d(u){u&&ht(t),_t(i),_t(s),l=!1,c()}}}function bc(n){let t;return{c(){t=Xt("Create")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function wc(n){let t;return{c(){t=Xt("Cancel")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function Ei(n){let t;return{c(){t=ft("div"),t.textContent="No drafts found."},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function Pi(n){let t,e,r=me(n[5]),i=[];for(let s=0;s<r.length;s+=1)i[s]=Ni(yi(n,r,s));const a=s=>q(i[s],1,1,()=>{i[s]=null});return{c(){t=ft("div");for(let s=0;s<i.length;s+=1)i[s].c();Y(t,"class","wa-draft-list")},m(s,o){pt(s,t,o);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(t,null);e=!0},p(s,o){if(o[0]&251662368|o[1]&8){r=me(s[5]);let l;for(l=0;l<r.length;l+=1){const c=yi(s,r,l);i[l]?(i[l].p(c,o),M(i[l],1)):(i[l]=Ni(c),i[l].c(),M(i[l],1),i[l].m(t,null))}for($t(),l=r.length;l<i.length;l+=1)a(l);It()}},i(s){if(!e){for(let o=0;o<r.length;o+=1)M(i[o]);e=!0}},o(s){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)q(i[o]);e=!1},d(s){s&&ht(t),Rn(i,s)}}}function Ai(n){let t;return{c(){t=ft("span"),t.textContent="●",Y(t,"class","wa-draft-active-indicator svelte-1jljdvn"),Y(t,"title","Active draft")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function vc(n){let t,e;return t=new Yi({props:{size:je}}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},p:Ct,i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Di(n){let t,e;function r(){return n[47](n[68])}return t=new ce({props:{ariaLabel:"Set active draft",title:void 0,clickHandler:r,$$slots:{default:[yc]},$$scope:{ctx:n}}}),{c(){bt(t.$$.fragment)},m(i,a){gt(t,i,a),e=!0},p(i,a){n=i;const s={};a[0]&32&&(s.clickHandler=r),a[2]&512&&(s.$$scope={dirty:a,ctx:n}),t.$set(s)},i(i){e||(M(t.$$.fragment,i),e=!0)},o(i){q(t.$$.fragment,i),e=!1},d(i){_t(t,i)}}}function yc(n){let t,e;return t=new uo({props:{size:je}}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},p:Ct,i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function kc(n){let t,e;return t=new Xi({props:{size:je}}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},p:Ct,i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Sc(n){let t,e;return t=new go({props:{size:je}}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},p:Ct,i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Cc(n){let t,e;return t=new Qi({props:{size:je}}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},p:Ct,i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Ni(n){let t,e,r,i=n[68]+"",a,s,o,l,c,u,d,_,f,p,h,b,g,v,y=n[12]===n[68]&&Ai();function E(){return n[46](n[68])}l=new ce({props:{ariaLabel:"Open draft",title:void 0,clickHandler:E,$$slots:{default:[vc]},$$scope:{ctx:n}}});let S=n[12]!==n[68]&&Di(n);function O(){return n[48](n[68])}d=new ce({props:{ariaLabel:"Rename draft",title:void 0,clickHandler:O,$$slots:{default:[kc]},$$scope:{ctx:n}}});function A(){return n[49](n[68])}f=new ce({props:{ariaLabel:"Duplicate draft",title:void 0,clickHandler:A,$$slots:{default:[Sc]},$$scope:{ctx:n}}});function U(){return n[50](n[68])}return h=new ce({props:{ariaLabel:"Delete draft",title:void 0,clickHandler:U,$$slots:{default:[Cc]},$$scope:{ctx:n}}}),{c(){t=ft("div"),e=ft("div"),y&&y.c(),r=mt(),a=Xt(i),s=mt(),o=ft("div"),bt(l.$$.fragment),c=mt(),S&&S.c(),u=mt(),bt(d.$$.fragment),_=mt(),bt(f.$$.fragment),p=mt(),bt(h.$$.fragment),b=mt(),Y(e,"class","wa-draft-name wa-row svelte-1jljdvn"),Y(o,"class","wa-draft-actions"),Y(t,"class",g="wa-draft-item "+(n[12]===n[68]?"active":"")+" svelte-1jljdvn")},m(D,R){pt(D,t,R),it(t,e),y&&y.m(e,null),it(e,r),it(e,a),it(t,s),it(t,o),gt(l,o,null),it(o,c),S&&S.m(o,null),it(o,u),gt(d,o,null),it(o,_),gt(f,o,null),it(o,p),gt(h,o,null),it(t,b),v=!0},p(D,R){n=D,n[12]===n[68]?y||(y=Ai(),y.c(),y.m(e,r)):y&&(y.d(1),y=null),(!v||R[0]&32)&&i!==(i=n[68]+"")&&Me(a,i);const j={};R[0]&32&&(j.clickHandler=E),R[2]&512&&(j.$$scope={dirty:R,ctx:n}),l.$set(j),n[12]!==n[68]?S?(S.p(n,R),R[0]&4128&&M(S,1)):(S=Di(n),S.c(),M(S,1),S.m(o,u)):S&&($t(),q(S,1,1,()=>{S=null}),It());const C={};R[0]&32&&(C.clickHandler=O),R[2]&512&&(C.$$scope={dirty:R,ctx:n}),d.$set(C);const $={};R[0]&32&&($.clickHandler=A),R[2]&512&&($.$$scope={dirty:R,ctx:n}),f.$set($);const w={};R[0]&32&&(w.clickHandler=U),R[2]&512&&(w.$$scope={dirty:R,ctx:n}),h.$set(w),(!v||R[0]&4128&&g!==(g="wa-draft-item "+(n[12]===n[68]?"active":"")+" svelte-1jljdvn"))&&Y(t,"class",g)},i(D){v||(M(l.$$.fragment,D),M(S),M(d.$$.fragment,D),M(f.$$.fragment,D),M(h.$$.fragment,D),v=!0)},o(D){q(l.$$.fragment,D),q(S),q(d.$$.fragment,D),q(f.$$.fragment,D),q(h.$$.fragment,D),v=!1},d(D){D&&ht(t),y&&y.d(),_t(l),S&&S.d(),_t(d),_t(f),_t(h)}}}function ji(n){let t,e,r,i,a,s,o,l,c,u,d,_;o=new ke({props:{clickHandler:n[51],variant:"primary",$$slots:{default:[Fc]},$$scope:{ctx:n}}});let f=n[15]&&Ti(n);const p=[Nc,Dc,Ac],h=[];function b(g,v){return g[14]?0:g[13].length===0?1:2}return u=b(n),d=h[u]=p[u](n),{c(){t=ft("div"),e=ft("div"),r=ft("div"),i=ft("div"),i.textContent="Chapters",a=mt(),s=ft("div"),bt(o.$$.fragment),l=mt(),f&&f.c(),c=mt(),d.c(),Y(i,"class","wa-title"),Y(s,"class","wa-button-group"),Y(r,"class","wa-row justify-between"),Y(e,"class","wa-panel-header svelte-1jljdvn"),Y(t,"class","chapter-controls"),Fe(t,"margin-top","18px")},m(g,v){pt(g,t,v),it(t,e),it(e,r),it(r,i),it(r,a),it(r,s),gt(o,s,null),it(t,l),f&&f.m(t,null),it(t,c),h[u].m(t,null),_=!0},p(g,v){const y={};v[0]&32768&&(y.clickHandler=g[51]),v[2]&512&&(y.$$scope={dirty:v,ctx:g}),o.$set(y),g[15]?f?(f.p(g,v),v[0]&32768&&M(f,1)):(f=Ti(g),f.c(),M(f,1),f.m(t,c)):f&&($t(),q(f,1,1,()=>{f=null}),It());let E=u;u=b(g),u===E?h[u].p(g,v):($t(),q(h[E],1,1,()=>{h[E]=null}),It(),d=h[u],d?d.p(g,v):(d=h[u]=p[u](g),d.c()),M(d,1),d.m(t,null))},i(g){_||(M(o.$$.fragment,g),M(f),M(d),_=!0)},o(g){q(o.$$.fragment,g),q(f),q(d),_=!1},d(g){g&&ht(t),_t(o),f&&f.d(),h[u].d()}}}function Fc(n){let t;return{c(){t=Xt("New Chapter")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function Ti(n){let t,e,r,i,a,s,o,l,c;return i=new ke({props:{clickHandler:n[53],variant:"primary",$$slots:{default:[Ec]},$$scope:{ctx:n}}}),s=new ke({props:{clickHandler:n[54],$$slots:{default:[Pc]},$$scope:{ctx:n}}}),{c(){t=ft("div"),e=ft("input"),r=mt(),bt(i.$$.fragment),a=mt(),bt(s.$$.fragment),Y(e,"class","wa-create-draft-input"),Y(e,"type","text"),Y(e,"placeholder","Chapter name"),Y(t,"class","create-inline wa-row svelte-1jljdvn")},m(u,d){pt(u,t,d),it(t,e),rn(e,n[16]),it(t,r),gt(i,t,null),it(t,a),gt(s,t,null),o=!0,l||(c=Ht(e,"input",n[52]),l=!0)},p(u,d){d[0]&65536&&e.value!==u[16]&&rn(e,u[16]);const _={};d[0]&229393&&(_.clickHandler=u[53]),d[2]&512&&(_.$$scope={dirty:d,ctx:u}),i.$set(_);const f={};d[0]&229376&&(f.clickHandler=u[54]),d[2]&512&&(f.$$scope={dirty:d,ctx:u}),s.$set(f)},i(u){o||(M(i.$$.fragment,u),M(s.$$.fragment,u),o=!0)},o(u){q(i.$$.fragment,u),q(s.$$.fragment,u),o=!1},d(u){u&&ht(t),_t(i),_t(s),l=!1,c()}}}function Ec(n){let t;return{c(){t=Xt("Create")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function Pc(n){let t;return{c(){t=Xt("Cancel")},m(e,r){pt(e,t,r)},d(e){e&&ht(t)}}}function Ac(n){let t,e=[],r=new Map,i,a=me(n[13]);const s=o=>o[65].chapterName;for(let o=0;o<a.length;o+=1){let l=vi(n,a,o),c=s(l);r.set(c,e[o]=Oi(c,l))}return{c(){t=ft("div");for(let o=0;o<e.length;o+=1)e[o].c();Y(t,"class","wa-draft-list")},m(o,l){pt(o,t,l);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);i=!0},p(o,l){if(l[0]&1610620928|l[1]&7){a=me(o[13]),$t();for(let c=0;c<e.length;c+=1)e[c].r();e=Hs(e,l,s,1,o,a,r,t,Ws,Oi,null,vi);for(let c=0;c<e.length;c+=1)e[c].a();It()}},i(o){if(!i){for(let l=0;l<a.length;l+=1)M(e[l]);i=!0}},o(o){for(let l=0;l<e.length;l+=1)q(e[l]);i=!1},d(o){o&&ht(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function Dc(n){let t;return{c(){t=ft("div"),t.textContent="No chapters found.",Fe(t,"margin-top","1em")},m(e,r){pt(e,t,r)},p:Ct,i:Ct,o:Ct,d(e){e&&ht(t)}}}function Nc(n){let t;return{c(){t=ft("div"),t.textContent="Loading chapters..."},m(e,r){pt(e,t,r)},p:Ct,i:Ct,o:Ct,d(e){e&&ht(t)}}}function jc(n){let t,e;return t=new Ki({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Tc(n){let t,e;return t=new qi({}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Oc(n){let t,e;return t=new Yi({props:{size:je}}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},p:Ct,i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function xc(n){let t,e;return t=new Xi({props:{size:je}}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},p:Ct,i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Bc(n){let t,e;return t=new Qi({props:{size:je}}),{c(){bt(t.$$.fragment)},m(r,i){gt(t,r,i),e=!0},p:Ct,i(r){e||(M(t.$$.fragment,r),e=!0)},o(r){q(t.$$.fragment,r),e=!1},d(r){_t(t,r)}}}function Oi(n,t){let e,r,i=t[65].chapterName+"",a,s,o,l,c,u,d,_,f,p,h,b,g,v,y=Ct,E;function S(){return t[55](t[67])}l=new ke({props:{title:"Move chapter up",clickHandler:S,disabled:t[67]===0,$$slots:{default:[jc]},$$scope:{ctx:t}}});function O(){return t[56](t[67])}u=new ke({props:{title:"Move chapter down",clickHandler:O,disabled:t[67]===t[13].length-1,$$slots:{default:[Tc]},$$scope:{ctx:t}}});function A(){return t[57](t[65])}_=new ce({props:{ariaLabel:"Open chapter",title:"Open chapter",clickHandler:A,$$slots:{default:[Oc]},$$scope:{ctx:t}}});function U(){return t[58](t[65])}p=new ce({props:{ariaLabel:"Rename chapter",title:"Rename chapter",clickHandler:U,$$slots:{default:[xc]},$$scope:{ctx:t}}});function D(){return t[59](t[65])}return b=new ce({props:{ariaLabel:"Delete chapter",title:"Delete chapter",clickHandler:D,$$slots:{default:[Bc]},$$scope:{ctx:t}}}),{key:n,first:null,c(){e=ft("div"),r=ft("div"),a=Xt(i),s=mt(),o=ft("div"),bt(l.$$.fragment),c=mt(),bt(u.$$.fragment),d=mt(),bt(_.$$.fragment),f=mt(),bt(p.$$.fragment),h=mt(),bt(b.$$.fragment),g=mt(),Y(r,"class","wa-draft-name"),Y(o,"class","wa-draft-actions"),Y(e,"class","wa-draft-item"),this.first=e},m(R,j){pt(R,e,j),it(e,r),it(r,a),it(e,s),it(e,o),gt(l,o,null),it(o,c),gt(u,o,null),it(o,d),gt(_,o,null),it(o,f),gt(p,o,null),it(o,h),gt(b,o,null),it(e,g),E=!0},p(R,j){t=R,(!E||j[0]&8192)&&i!==(i=t[65].chapterName+"")&&Me(a,i);const C={};j[0]&8192&&(C.clickHandler=S),j[0]&8192&&(C.disabled=t[67]===0),j[2]&512&&(C.$$scope={dirty:j,ctx:t}),l.$set(C);const $={};j[0]&8192&&($.clickHandler=O),j[0]&8192&&($.disabled=t[67]===t[13].length-1),j[2]&512&&($.$$scope={dirty:j,ctx:t}),u.$set($);const w={};j[0]&8192&&(w.clickHandler=A),j[2]&512&&(w.$$scope={dirty:j,ctx:t}),_.$set(w);const V={};j[0]&8192&&(V.clickHandler=U),j[2]&512&&(V.$$scope={dirty:j,ctx:t}),p.$set(V);const lt={};j[0]&8192&&(lt.clickHandler=D),j[2]&512&&(lt.$$scope={dirty:j,ctx:t}),b.$set(lt)},r(){v=e.getBoundingClientRect()},f(){xs(e),y()},a(){y(),y=Os(e,v,fc,{duration:500,easing:da})},i(R){E||(M(l.$$.fragment,R),M(u.$$.fragment,R),M(_.$$.fragment,R),M(p.$$.fragment,R),M(b.$$.fragment,R),E=!0)},o(R){q(l.$$.fragment,R),q(u.$$.fragment,R),q(_.$$.fragment,R),q(p.$$.fragment,R),q(b.$$.fragment,R),E=!1},d(R){R&&ht(e),_t(l),_t(u),_t(_),_t(p),_t(b)}}}function $c(n){let t,e,r,i,a,s,o,l,c,u,d,_,f,p;s=new ce({props:{ariaLabel:"Refresh projects",clickHandler:n[40],title:void 0,spinning:n[6],$$slots:{default:[uc]},$$scope:{ctx:n}}}),c=new ke({props:{clickHandler:n[35],variant:"primary",style:"width: 40%; margin: 0 auto;",$$slots:{default:[dc]},$$scope:{ctx:n}}});let h=n[2].length===0&&ki(),b=n[2].length>0&&Si(n),g=n[4]&&Ci(n),v=n[4]&&n[0]?.activeDraft&&n[18]&&ji(n);return{c(){t=ft("div"),e=ft("div"),r=ft("div"),r.textContent=`${jt} Projects`,i=mt(),a=ft("div"),bt(s.$$.fragment),o=mt(),l=ft("div"),bt(c.$$.fragment),u=mt(),h&&h.c(),d=mt(),b&&b.c(),_=mt(),g&&g.c(),f=mt(),v&&v.c(),Y(r,"class","wa-title"),Y(e,"class","wa-row justify-between"),Y(l,"class","wa-row"),Fe(l,"margin","18px 0 10px 0"),Y(t,"class","project-list wa-panel svelte-1jljdvn")},m(y,E){pt(y,t,E),it(t,e),it(e,r),it(e,i),it(e,a),gt(s,a,null),it(t,o),it(t,l),gt(c,l,null),it(t,u),h&&h.m(t,null),it(t,d),b&&b.m(t,null),it(t,_),g&&g.m(t,null),it(t,f),v&&v.m(t,null),p=!0},p(y,E){const S={};E[0]&64&&(S.spinning=y[6]),E[2]&512&&(S.$$scope={dirty:E,ctx:y}),s.$set(S);const O={};E[2]&512&&(O.$$scope={dirty:E,ctx:y}),c.$set(O),y[2].length===0?h||(h=ki(),h.c(),h.m(t,d)):h&&(h.d(1),h=null),y[2].length>0?b?(b.p(y,E),E[0]&4&&M(b,1)):(b=Si(y),b.c(),M(b,1),b.m(t,_)):b&&($t(),q(b,1,1,()=>{b=null}),It()),y[4]?g?(g.p(y,E),E[0]&16&&M(g,1)):(g=Ci(y),g.c(),M(g,1),g.m(t,f)):g&&($t(),q(g,1,1,()=>{g=null}),It()),y[4]&&y[0]?.activeDraft&&y[18]?v?(v.p(y,E),E[0]&262161&&M(v,1)):(v=ji(y),v.c(),M(v,1),v.m(t,null)):v&&($t(),q(v,1,1,()=>{v=null}),It())},i(y){p||(M(s.$$.fragment,y),M(c.$$.fragment,y),M(b),M(g),M(v),p=!0)},o(y){q(s.$$.fragment,y),q(c.$$.fragment,y),q(b),q(g),q(v),p=!1},d(y){y&&ht(t),_t(s),_t(c),h&&h.d(),b&&b.d(),g&&g.d(),v&&v.d()}}}let Ic=!1,Rc="";const je=20;let zc=null;function Lc(n,t,e){let{manager:r}=t,{projectService:i}=t,{projectFileService:a}=t,s=null,o=[],l,c=null,u=[],d=!1,_=[],f=!1,p=!1,h="",b=!0,g=null,v=null,y=[],E=!1,S=!1,O="",A="",U=!1,D=!1;Tn(()=>{try{r&&v&&r.removeActiveProjectListener(v)}catch{}});async function R(W=!1){if(!i)return[];e(6,d=!0);const rt=new Promise(kt=>setTimeout(kt,400)),vt=[...o],Rt=s;let Wt=[],Pt=[];try{Wt=i.listAllFolders(),Pt=[];for(const kt of Wt)await i.isProjectFolder(kt)&&Pt.push(kt)}catch{Pt=[]}const Ft=Pt.filter(kt=>!vt.includes(kt)),ee=vt.filter(kt=>!Pt.includes(kt));if(W&&Ft.length>0&&new T.Notice(`${Ft.length} new project${Ft.length>1?"s":""} discovered.`),W&&ee.length>0&&new T.Notice(`${ee.length} project${ee.length>1?"s":""} removed.`),e(2,o=Pt),e(7,_=Pt.map(kt=>({value:kt,label:kt}))),Pt.length===0)e(1,s=null),e(3,l=void 0),e(4,c=null);else if(Pt.length===1){e(1,s=Pt[0]),e(3,l=_[0]),e(4,c=Pt[0]);try{G(`${Z} panel refresh selected single project '${c}'`)}catch{}}else if(Rt&&!Pt.includes(Rt)){e(1,s=Pt[0]),e(3,l=_[0]),e(4,c=Pt[0]);try{G(`${Z} panel refresh selected fallback project '${c}'`)}catch{}}else{const kt=_.find(qt=>qt.value===Rt);if(kt){e(1,s=Rt),e(3,l=kt),e(4,c=kt.value);try{G(`${Z} panel refresh kept project '${c}'`)}catch{}}else e(1,s=null),e(3,l=void 0),e(4,c=null)}return await rt,e(6,d=!1),c&&await j(),Pt}async function j(){if(!a||!c){e(5,u=[]);return}e(8,f=!0);const W=new Promise(rt=>setTimeout(rt,400));try{e(5,u=a.drafts.listDrafts(c)||[]),e(5,u=Array.from(u)),u.sort((rt,vt)=>rt>vt?1:rt<vt?-1:0),b||u.reverse()}catch{e(5,u=[])}finally{await W,e(8,f=!1)}}async function C(){if(!r||!a)return;e(14,E=!0);const W=new Promise(rt=>setTimeout(rt,400));try{if(!c){e(13,y=[]),e(18,U=!1);return}const rt=`${c}/${le(r?.settings)}`,vt=await He(r.app,rt);if(e(18,U=vt?.project_type==="multi-file"),!U){e(13,y=[]);return}if(!r?.activeDraft){e(13,y=[]);return}let Rt=[];Rt=await a.chapters.listChapters(c,r.activeDraft),e(13,y=Array.isArray(Rt)?Rt:[])}catch{e(13,y=[]),e(18,U=!1)}finally{await W,e(14,E=!1)}}async function $(){if(!(!a||!c||!h.trim())){try{await a.drafts.createDraft(h.trim(),Rc||void 0,c)}catch{}e(10,h=""),e(9,p=!1),await j()}}async function w(){e(9,p=!0)}async function V(W){if(!a||!r||!c)return;let rt=!1;rt=await a.drafts.openDraft(c,W),rt||r?.setActiveDraft&&await r.setActiveDraft(W,c),await j(),await C()}async function lt(W){if(!r||!c)return;const rt=`${W} Copy`;new Js(r.app,{sourceDraftName:W,suggestedName:rt,onSubmit:async vt=>{if(r)try{await r.createNewDraft(vt,W,c||void 0),await j(),new T.Notice(`Draft '${vt}' created as duplicate of '${W}'.`)}catch(Rt){G(`${Z} Failed to duplicate draft:`,Rt),new T.Notice("Failed to duplicate draft.")}}}).open()}async function K(W){if(!r||!c)return;const rt=window?.prompt?window.prompt(`Rename draft '${W}' to:`,W):null;if(rt)try{await r.renameDraft(W,rt,c,!1),await j()}catch{}}async function st(W){if(!r||!c)return;new Or(r.app,W,async()=>{r&&(await r.deleteDraft(W,c||void 0),await j())},"draft").open()}async function x(W){W&&(r?.setActiveProject&&await r.setActiveProject(W),e(1,s=W),e(4,c=W),e(12,g=r?.activeDraft??null),await j(),await C())}async function tt(W){if(W===0||!r||!c||!r.activeDraft)return;const rt=y.slice();[rt[W-1],rt[W]]=[rt[W],rt[W-1]];const vt=rt.map((Rt,Wt)=>({chapterName:Rt.chapterName||"",order:Wt+1}));await r.reorderChapters(c,r.activeDraft,vt),await C()}async function B(W){if(W===y.length-1||!r||!c||!r.activeDraft)return;const rt=y.slice();[rt[W],rt[W+1]]=[rt[W+1],rt[W]];const vt=rt.map((Rt,Wt)=>({chapterName:Rt.chapterName||"",order:Wt+1}));await r.reorderChapters(c,r.activeDraft,vt),await C()}async function z(W){!c||!r?.activeDraft||await r.openChapter(c,r.activeDraft,W)}function dt(W){if(!c||!r?.activeDraft)return;new Qs(r.app,W,async vt=>{!r?.activeDraft||!c||(await r.renameChapter(c,r.activeDraft,W,vt),await C())}).open()}function ot(W){new Or(r.app,W,async()=>{!r?.activeDraft||!c||(await r.deleteChapter(c,r.activeDraft,W),await C())},"chapter").open()}async function at(W){c&&(r?.setActiveDraft&&await r.setActiveDraft(W,c),e(12,g=r?.activeDraft??null),await j(),await C())}async function Nt(){if(!r||!i)return;const W=r.app,{CreateProjectModal:rt}=await Promise.resolve().then(()=>Gc);let vt=null;new rt(W,async(Wt,Pt,Ft)=>{if(!Wt||!r||!i||(vt=await i.createProject(Wt,Pt,Ft,void 0,r.settings),!vt))return;let ee=[],kt=null;for(let qt=0;qt<20;qt++){await new Promise(Oe=>setTimeout(Oe,100)),ee=await R();const Te=ee.find(Oe=>Oe===vt);if(kt=typeof Te=="string"?Te:null,kt)break}typeof kt=="string"&&kt&&(e(1,s=kt),e(3,l={value:kt,label:kt}),e(4,c=kt),r.setActiveDraft?await r.setActiveDraft(kt,Ft):e(0,r.activeDraft=Ft??null,r),await j(),await C())}).open()}Tn(()=>{try{r&&r.removeActiveDraftListener}catch{}try{r&&typeof r.removeActiveProjectListener=="function"&&v&&r.removeActiveProjectListener(v)}catch{}});const Mt=()=>R(!0);function wt(W){l=W,e(3,l)}const yt=W=>{const rt=W.detail;e(3,l=rt),e(4,c=typeof rt=="string"?rt:rt?rt.value:void 0),e(1,s=c??null),x(c??null)},Ut=()=>{e(11,b=!b),j()};function Dt(){h=this.value,e(10,h)}const te=()=>{e(9,p=!1),e(10,h="")},Gt=W=>V(W),m=W=>at(W),L=W=>K(W),H=W=>lt(W),F=W=>st(W),k=()=>e(15,S=!S);function N(){O=this.value,e(16,O)}const X=async()=>{!c||!r?.activeDraft||!O.trim()||(await r.createChapter(c,r.activeDraft,O.trim()),e(16,O=""),e(17,A=""),e(15,S=!1),await C())},J=()=>{e(15,S=!1),e(16,O=""),e(17,A="")},I=W=>tt(W),et=W=>B(W),Q=W=>z(W.chapterName||""),nt=W=>dt(W.chapterName||""),ut=W=>ot(W.chapterName||"");return n.$$set=W=>{"manager"in W&&e(0,r=W.manager),"projectService"in W&&e(36,i=W.projectService),"projectFileService"in W&&e(37,a=W.projectFileService)},n.$$.update=()=>{if(n.$$.dirty[0]&1|n.$$.dirty[1]&480&&r&&i&&a&&!D){e(39,D=!0),G(`${Z} ProjectPanel initializing with manager`),e(12,g=r.activeDraft??null),e(1,s=r.activeProject??null);const W=rt=>{e(12,g=rt),G(`${Z} active draft updated -> ${rt}`)};r.addActiveDraftListener(W),e(38,v=rt=>{e(1,s=rt),G(`${Z} active project updated -> ${rt}`)}),r.addActiveProjectListener(v),R()}},[r,s,o,l,c,u,d,_,f,p,h,b,g,y,E,S,O,A,U,R,j,C,$,w,V,lt,K,st,x,tt,B,z,dt,ot,at,Nt,i,a,v,D,Mt,wt,yt,Ut,Dt,te,Gt,m,L,H,F,k,N,X,J,I,et,Q,nt,ut]}class Mc extends Qt{constructor(t){super(),Jt(this,t,Lc,$c,Yt,{manager:0,projectService:36,projectFileService:37},null,[-1,-1,-1])}}const Se="writeaid-project-panel";class Uc extends T.ItemView{constructor(t,e,r){super(t),this.containerElInner=null,this.selectedProject=null,this.app=e,this.manager=r,this.projectService=new Pn(e),this.projectFileService=new _r(e,this.projectService)}getViewType(){return Se}getDisplayText(){return`${jt} Projects`}getIcon(){return pr}async onOpen(){this.containerElInner=this.containerEl.createDiv({cls:"writeaid-project-panel"});try{if(!this.manager){G(`${Z} Manager not available in ProjectPanelView.onOpen`),new T.Notice(`${jt}: manager not available, cannot mount project panel.`);return}G(`${Z} Mounting ProjectPanel with manager:`,!!this.manager),this.projectPanel=new Mc({target:this.containerElInner,props:{manager:this.manager,projectService:this.projectService,projectFileService:this.projectFileService}}),G(`${Z} ProjectPanel mounted successfully`)}catch(t){G(`${Z} failed to mount project panel:`,t),new T.Notice(`${jt}: failed to mount project panel. Check console for details.`)}}async onClose(){if(this.projectPanel){try{this.projectPanel.$destroy()}catch(t){G(`${Z} Error destroying project panel:`,t)}this.projectPanel=void 0}}}function Wc(n,t){return()=>{const e={type:Se,active:!0},r=t.workspace.getLeavesOfType(Se);if(r.length>0){const i=r[0];t.workspace.revealLeaf(i)}else{let i=t.workspace.getRightLeaf(!1);i||(i=t.workspace.getRightLeaf(!0)),i.setViewState(e),t.workspace.revealLeaf(i)}}}function Hc(n){return()=>n.updateProjectMetadataPrompt()}class Vc extends T.Modal{constructor(t,e,r,i){super(t),this.path=e,this.onCreateAnyway=r,this.onOpenExisting=i}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project already exists"}),t.createEl("p",{text:`A folder named '${this.path}' already exists in the vault.`}),new T.Setting(t).addButton(e=>e.setButtonText("Open Existing").onClick(()=>{this.close(),this.onOpenExisting()})),new T.Setting(t).addButton(e=>e.setButtonText("Create Anyway").setCta().onClick(()=>{this.close(),this.onCreateAnyway(!0)})),new T.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}onClose(){this.contentEl.empty()}}class Zc extends T.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Draft"});const e=this.props.suggestedName;let r="",i="";new T.Setting(t).setName("Draft name").addText(s=>s.setPlaceholder(e).onChange(o=>r=o));const a=this.props.drafts;a.length>0&&new T.Setting(t).setName("Copy from existing draft").addDropdown(s=>{s.addOption("","Start blank");for(const o of a)s.addOption(o,o);s.onChange(o=>i=o)}),new T.Setting(t).addButton(s=>s.setButtonText("Create").setCta().onClick(()=>{this.close();const o=r&&r.trim()?r.trim():e;this.props.onSubmit(o,i||void 0)}))}onClose(){this.contentEl.empty()}}class ha extends T.Modal{constructor(t,e){super(t),this.onSubmit=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Project"});let e="",r=!0,i="Draft 1";new T.Setting(t).setName("Project folder name").addText(a=>a.onChange(s=>e=s)),new T.Setting(t).setName("Project type").addDropdown(a=>{a.addOption("single","Single-file project"),a.addOption("multi","Multi-file project (chapters)"),a.onChange(s=>r=s==="single")}),new T.Setting(t).setName("Initial draft name (optional)").addText(a=>a.setPlaceholder("Draft 1").onChange(s=>i=s||"Draft 1")),new T.Setting(t).addButton(a=>a.setButtonText("Create Project").setCta().onClick(()=>{this.close(),this.onSubmit(e,r,i||void 0)}))}onClose(){this.contentEl.empty()}}const Gc=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectModal:ha},Symbol.toStringTag,{value:"Module"}));class xi extends T.Modal{constructor(t,e,r){super(t),this.projectPath=e,this.onOpenProject=r}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project created"}),t.createEl("p",{text:`Project '${this.projectPath}' was created.`}),new T.Setting(t).addButton(e=>e.setButtonText("Open Project").setCta().onClick(async()=>{this.close(),this.onOpenProject&&await this.onOpenProject()})),new T.Setting(t).addButton(e=>e.setButtonText("Close").onClick(()=>this.close()))}onClose(){this.contentEl.empty()}}class ir extends T.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Select Project for Draft"});let e="";const r=this.props.folders||[];new T.Setting(t).setName("Project folder").addDropdown(i=>{i.addOption("","(Vault root)");for(const a of r)i.addOption(a,a||"(Vault root)");i.onChange(a=>e=a)}),new T.Setting(t).addButton(i=>i.setButtonText("Select").setCta().onClick(()=>{this.close(),this.props.onSubmit(e||"")}))}onClose(){this.contentEl.empty()}}class qc extends T.Modal{constructor(t,e,r){super(t),this.drafts=e,this.onSubmit=r}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Switch Active Draft"});for(const e of this.drafts)new T.Setting(t).setName(e).addButton(r=>r.setButtonText("Select").onClick(()=>{this.close(),this.onSubmit(e)}))}onClose(){this.contentEl.empty()}}class Kc{constructor(t,e,r){this.activeDraft=null,this.activeProject=null,this.activeProjectListeners=[],this.activeDraftListeners=[],this.panelRefreshListeners=[],this._panelRefreshTimer=null,this._panelRefreshDebounceMs=250,this.app=t,this.plugin=e,this.settings=e?.settings,typeof r=="number"&&Number.isFinite(r)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(r))),this.activeProject=this.settings?.activeProject||null,this.projectService=new Pn(t),this.projectFileService=new _r(t,this.projectService,this.settings)}async reorderChapters(t,e,r){return await this.projectFileService.chapters.reorderChapters(t,e,r)}async listChapters(t,e){return await this.projectFileService.chapters.listChapters(t,e)}async createChapter(t,e,r){return await this.projectFileService.chapters.createChapter(t,e,r,this.settings)}async deleteChapter(t,e,r){return await this.projectFileService.chapters.deleteChapter(t,e,r)}async renameChapter(t,e,r,i){return await this.projectFileService.chapters.renameChapter(t,e,r,i)}async openChapter(t,e,r){return await this.projectFileService.chapters.openChapter(t,e,r)}get panelRefreshDebounceMs(){return this._panelRefreshDebounceMs}set panelRefreshDebounceMs(t){typeof t=="number"&&Number.isFinite(t)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(t)))}addActiveProjectListener(t){this.activeProjectListeners.push(t)}addActiveDraftListener(t){this.activeDraftListeners.push(t)}removeActiveDraftListener(t){this.activeDraftListeners=this.activeDraftListeners.filter(e=>e!==t)}notifyActiveDraftListeners(t){for(const e of this.activeDraftListeners)ne(()=>e(t))}addPanelRefreshListener(t){this.panelRefreshListeners.push(t)}removePanelRefreshListener(t){this.panelRefreshListeners=this.panelRefreshListeners.filter(e=>e!==t)}notifyPanelRefresh(){try{this._panelRefreshTimer&&clearTimeout(this._panelRefreshTimer),this._panelRefreshTimer=setTimeout(()=>{for(const t of this.panelRefreshListeners)ne(()=>t());this._panelRefreshTimer=null},this._panelRefreshDebounceMs)}catch{for(const t of this.panelRefreshListeners)ne(()=>t())}}removeActiveProjectListener(t){this.activeProjectListeners=this.activeProjectListeners.filter(e=>e!==t)}async setActiveProject(t){t&&(t=t.trim().replace(/^\/+/,"").replace(/\/+$/,"")),G(`${Z} setActiveProject called with '${t}'`),this.activeProject=t,await Kt(async()=>{if(this.plugin){const e=this.plugin;e.settings||(e.settings={}),e.settings.activeProject=t??void 0,typeof e.saveSettings=="function"&&await e.saveSettings()}});for(const e of this.activeProjectListeners)ne(()=>e(t));try{if(!t){this.activeDraft=null,this.notifyActiveDraftListeners(null);return}const e=this.listDrafts(t);if(!e||e.length===0){this.activeDraft=null;return}if(e.length===1){await this.setActiveDraft(e[0],t,!1),G(`${Z} auto-selected single draft '${e[0]}' for project '${t}'`);return}await Kt(async()=>{const o=await He(this.app,`${t}/${le(this.settings)}`);if(o&&o.current_active_draft&&e.includes(o.current_active_draft)){await this.setActiveDraft(o.current_active_draft,t,!1),G(`${Z} auto-selected meta draft '${o.current_active_draft}' for project '${t}'`);return}});let r=null,i=0;const a=this.app.vault.getFiles(),s=Vt(this.settings);for(const o of e){const l=`${t}/${s}/${o}/`;let c=0;for(const u of a)if(u.path.startsWith(l)){const d=u.stat&&typeof u.stat.mtime=="number"?u.stat.mtime:0;d>c&&(c=d)}c>i&&(i=c,r=o)}r||(r=e[0]),G(`${Z} auto-selected draft '${r}' for project '${t}'`),await this.setActiveDraft(r,t,!1)}catch{}}async createNewProjectPrompt(){new ha(this.app,async(t,e,r,i)=>{if(!t){new T.Notice("Project name is required.");return}const a=i&&i!==""?`${i}/${t}`:t;this.app.vault.getAbstractFileByPath(a)?new Vc(this.app,a,async o=>{o&&(await this.createNewProject(t,e,r,i),new xi(this.app,a,async()=>await this.openProject(a)).open())},async()=>{await this.openProject(a)}).open():(await this.createNewProject(t,e,r,i),new xi(this.app,a,async()=>await this.openProject(a)).open())}).open()}async openProject(t){return await this.projectService.openProject(t)}async createNewProject(t,e,r,i){const a=await this.projectService.createProject(t,e,r,i,this.settings);if(a){await this.setActiveProject(a);const s=r||"Draft 1";await this.setActiveDraft(s,a),ne(()=>this.notifyPanelRefresh())}return a}listAllFolders(){return this.projectService.listAllFolders()}async createNewDraftPrompt(){const t=this.listAllFolders(),e=await Xe(t,r=>this.projectService.isProjectFolder(r));new ir(this.app,{folders:e,onSubmit:async r=>{const i=await this.suggestNextDraftName(r);new Zc(this.app,{suggestedName:i,drafts:this.listDrafts(r),projectPath:r,onSubmit:async(a,s)=>{await this.projectFileService.drafts.createDraft(a,s,r,this.settings),new T.Notice(`Draft "${a}" created in ${r}.`)}}).open()}}).open()}async switchDraftPrompt(){const t=this.listDrafts();if(t.length===0){new T.Notice("No drafts found in the current project.");return}new qc(this.app,t,async e=>{this.activeDraft=e,new T.Notice(`Switched to draft: ${e}`);const r=this.getCurrentProjectPath();r&&await Ye(this.app,r,e,void 0,this.settings)}).open()}async updateProjectMetadataPrompt(){if(this.activeProject){await Ye(this.app,this.activeProject,void 0,void 0,this.settings),new T.Notice(`Metadata updated for ${this.activeProject}`);return}(async()=>{const t=this.listAllFolders(),e=await Xe(t,r=>this.projectService.isProjectFolder(r));new ir(this.app,{folders:e,onSubmit:async r=>{await Ye(this.app,r,void 0,void 0,this.settings),new T.Notice(`Metadata updated for ${r}`)}}).open()})()}async selectActiveProjectPrompt(){const t=this.listAllFolders(),e=await Xe(t,r=>this.projectService.isProjectFolder(r));if(e.length===0){new T.Notice(`No ${jt} projects found in the vault.`);return}new ir(this.app,{folders:e,onSubmit:async r=>{await this.setActiveProject(r),new T.Notice(`Active project set to ${r}`)}}).open()}async createNewDraft(t,e,r){const i=await this.projectFileService.drafts.createDraft(t,e,r,this.settings);return ne(()=>this.notifyPanelRefresh()),i}listDrafts(t){return this.projectFileService.drafts.listDrafts(t)}async setActiveDraft(t,e,r=!0){const i=e||this.activeProject||this.getCurrentProjectPath();return i?(this.activeDraft=t,await Kt(async()=>{await Ye(this.app,i,t,void 0,this.settings)}),this.notifyActiveDraftListeners(this.activeDraft),r&&new T.Notice(`Active draft set to ${t}`),!0):(r&&new T.Notice("No project selected to set active draft on."),!1)}async renameDraft(t,e,r,i=!1){const a=r||this.activeProject||this.getCurrentProjectPath();if(!a)return new T.Notice("No project selected to rename draft."),!1;const s=this.activeDraft===t;return await this.projectFileService.drafts.renameDraft(a,t,e,i,this.settings)?(s&&(this.activeDraft=e),new T.Notice(`Renamed draft ${t} → ${e}`),!0):(new T.Notice("Failed to rename draft."),!1)}async deleteDraft(t,e,r=!0){const i=e||this.activeProject||this.getCurrentProjectPath();if(!i)return new T.Notice("No project selected to delete draft."),!1;if(await this.projectFileService.drafts.deleteDraft(i,t,r)){new T.Notice(`Deleted draft ${t}`);const s=this.listDrafts(i);if(s.length>0){if(this.activeDraft===t||!this.activeDraft){let o;if(s.length===1)o=s[0];else{const l=[...s].sort((c,u)=>c.localeCompare(u));if(this.activeDraft===t){const c=l.findIndex(u=>u===t);if(c!==-1){const u=c<l.length-1?c:0;o=l[u]}else o=l[0]}else o=this.activeDraft}await this.setActiveDraft(o,i,!1)}}else this.activeDraft=null,this.notifyActiveDraftListeners(null);return!0}return new T.Notice("Failed to delete draft."),!1}async suggestNextDraftName(t){return await this.projectFileService.drafts.suggestNextDraftName(t)}getCurrentProjectPath(){const t=this.app.workspace.getActiveFile();if(!t)return null;const e=t.parent;return e?e.path:null}}class Yc extends T.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,G(`${Z} Settings tab created`),typeof e.registerSettingsChangedCallback=="function"&&e.registerSettingsChangedCallback(()=>{G(`${Z} Settings changed externally, refreshing UI`),this.containerEl&&this.containerEl.parentElement&&this.display()})}display(){const{containerEl:t}=this;t.empty(),t.createEl("h2",{text:`${jt} Settings`}),G(`${Z} Displaying settings UI`);const e=this.plugin;t.createEl("h3",{text:"Templates"}),new T.Setting(t).setName("Include outline file on draft creation").setDesc("If enabled, each new draft will include an outline file using the outline template.").addToggle(o=>o.setValue(!!e.settings.includeDraftOutline).onChange(l=>{G(`${Z} Include draft outline changed: ${l}`),e.settings.includeDraftOutline=l,e.saveSettings()})),new T.Setting(t).setName("Outline template").setDesc("Template for outline files. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{G(`${Z} Opening file picker for outline template`),new ar(this.app,l=>{G(`${Z} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new T.Setting(t).setName("Outline template").setDesc("Template for outline documents. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{G(`${Z} Opening file picker for outline template`),new ar(this.app,l=>{G(`${Z} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new T.Setting(t).setName("Chapter template").setDesc("Template for newly created chapter files. Use {{chapterTitle}}").addTextArea(o=>{o.setValue(e.settings.chapterTemplate||""),o.inputEl.setAttribute("data-setting","chapter")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{G(`${Z} Opening file picker for chapter template`),new ar(this.app,l=>{G(`${Z} Chapter template selected: ${l}`),e.settings.chapterTemplate=l,this.display()}).open()})),new T.Setting(t).setName("Manuscript name template").setDesc("Template for manuscript filenames. Use {{draftName}}, {{projectName}}, and moment.js date qualifiers like {{YYYY-MM-DD}}").addText(o=>{o.setValue(e.settings.manuscriptNameTemplate||"{{draftName}}"),o.inputEl.setAttribute("data-setting","manuscript")}),new T.Setting(t).addButton(o=>o.setButtonText("Save Templates").setCta().onClick(async()=>{G(`${Z} Save Templates button clicked`);const l=t.querySelector('textarea[data-setting="outline"]'),c=t.querySelector('textarea[data-setting="chapter"]'),u=t.querySelector('input[data-setting="manuscript"]');G(`${Z} Found inputs - outline: ${!!l}, chapter: ${!!c}, manuscript: ${!!u}`),G(`${Z} Manuscript input value: "${u?.value}"`),l&&(e.settings.outlineTemplate=l.value),c&&(e.settings.chapterTemplate=c.value),u&&(e.settings.manuscriptNameTemplate=u.value),G(`${Z} Saving templates: outline=${e.settings.outlineTemplate?.substring(0,50)}..., chapter=${e.settings.chapterTemplate?.substring(0,50)}..., manuscript=${e.settings.manuscriptNameTemplate}`),await e.saveSettings(),new T.Notice("Templates saved successfully!")})),t.createEl("h3",{text:"Filenames"}),new T.Setting(t).setName("Draft filename slug style").setDesc("How per-draft main filenames are generated").addDropdown(o=>{o.addOption("compact","compact (draft1)"),o.addOption("kebab","kebab (draft-1)"),o.setValue(e.settings.slugStyle||"compact"),o.onChange(l=>{G(`${Z} Slug style changed: ${l}`),e.settings.slugStyle=l,e.saveSettings();const c=t.querySelector(".wat-slug-preview");c&&(c.textContent=`Example: Draft 1 → ${se("Draft 1",l)}${St}`)})});let r="Draft 1";new T.Setting(t).setName("Sample draft name").setDesc("Type a sample draft name to preview the generated filename").addText(o=>o.setPlaceholder("Draft 1").setValue(r).onChange(l=>{r=l||"Draft 1";const c=t.querySelector(".wat-slug-preview");if(c){const u=se(r,e.settings.slugStyle);c.textContent=`Example: ${r} → ${u}${St}`}}));const i=t.createDiv({cls:"wat-slug-preview"}),a=se(r,e.settings.slugStyle);i.setText(`Example: ${r} → ${a}${St}`),t.createEl("h3",{text:"Folders & Files"}),new T.Setting(t).setName("Drafts folder name").setDesc("Name of the folder containing draft subfolders (default: drafts)").addText(o=>o.setValue(e.settings.draftsFolderName||"drafts").onChange(l=>{G(`${Z} Drafts folder name changed: ${l}`),e.settings.draftsFolderName=l||"drafts",e.saveSettings()})),new T.Setting(t).setName("Manuscripts folder name").setDesc("Name of the folder containing generated manuscripts (default: manuscripts)").addText(o=>o.setValue(e.settings.manuscriptsFolderName||"manuscripts").onChange(l=>{G(`${Z} Manuscripts folder name changed: ${l}`),e.settings.manuscriptsFolderName=l||"manuscripts",e.saveSettings()})),new T.Setting(t).setName("Backups folder name").setDesc("Name of the folder containing draft backups (default: .writeaid-backups)").addText(o=>o.setValue(e.settings.backupsFolderName||".writeaid-backups").onChange(l=>{G(`${Z} Backups folder name changed: ${l}`),e.settings.backupsFolderName=l||".writeaid-backups",e.saveSettings()})),new T.Setting(t).setName("Meta file name").setDesc(`Name of the project metadata file (default: ${oe.META})`).addText(o=>o.setValue(e.settings.metaFileName||oe.META).onChange(l=>{G(`${Z} Meta file name changed: ${l}`),e.settings.metaFileName=l||oe.META,e.saveSettings()})),new T.Setting(t).setName("Outline file name").setDesc(`Name of the draft outline file (default: ${oe.OUTLINE})`).addText(o=>o.setValue(e.settings.outlineFileName||oe.OUTLINE).onChange(l=>{G(`${Z} Outline file name changed: ${l}`),e.settings.outlineFileName=l||oe.OUTLINE,e.saveSettings()})),t.createEl("h3",{text:"Word Count Targets"}),new T.Setting(t).setName("Default target word count for multi-file projects").setDesc("Target word count automatically set for new multi-file projects (chapters)").addText(o=>o.setValue(String(e.settings.defaultMultiTargetWordCount??5e4)).setPlaceholder("50000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(G(`${Z} Default multi-file target word count changed: ${c}`),e.settings.defaultMultiTargetWordCount=c,e.saveSettings())})),new T.Setting(t).setName(`Default target word count for ${re.SINGLE} projects`).setDesc(`Target word count automatically set for new ${re.SINGLE} projects`).addText(o=>o.setValue(String(e.settings.defaultSingleTargetWordCount??2e4)).setPlaceholder("20000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(G(`${Z} Default ${re.SINGLE} target word count changed: ${c}`),e.settings.defaultSingleTargetWordCount=c,e.saveSettings())})),t.createEl("h3",{text:"Backup Settings"}),new T.Setting(t).setName("Maximum number of backups per draft").setDesc("Maximum number of backup files to keep per draft (default: 5)").addText(o=>o.setValue(String(e.settings.maxBackups??5)).setPlaceholder("5").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(G(`${Z} Max backups changed: ${c}`),e.settings.maxBackups=c,e.saveSettings())})),new T.Setting(t).setName("Maximum backup age (days)").setDesc("Automatically delete backups older than this many days (default: 30)").addText(o=>o.setValue(String(e.settings.maxBackupAgeDays??30)).setPlaceholder("30").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(G(`${Z} Max backup age changed: ${c}`),e.settings.maxBackupAgeDays=c,e.saveSettings())})),t.createEl("h3",{text:"UI & Startup"}),t.createEl("p",{text:"Most settings take effect immediately. Settings marked with ⚠️ require a plugin reload to take effect.",cls:"setting-item-description"}),new T.Setting(t).setName("Ribbon placement").setDesc(`Place the ${jt} icon on the left or right ribbon`).addDropdown(o=>{o.addOption("left","Left"),o.addOption("right","Right"),o.setValue(e.settings.ribbonPlacement||"left"),o.onChange(l=>{G(`${Z} Ribbon placement changed: ${l}`),e.settings.ribbonPlacement=l,e.saveSettings(),typeof this.plugin.moveRibbon=="function"&&(l==="left"||l==="right")&&this.plugin.moveRibbon(l),this.display()})}),new T.Setting(t).setName("Always show ribbon").setDesc(`If enabled, the ${jt} ribbon icon will always be visible regardless of whether projects are detected`).addToggle(o=>o.setValue(!!e.settings.ribbonAlwaysShow).onChange(l=>{G(`${Z} Always show ribbon changed: ${l}`),e.settings.ribbonAlwaysShow=l,e.saveSettings(),typeof this.plugin.refreshRibbonVisibility=="function"&&this.plugin.refreshRibbonVisibility()})),new T.Setting(t).setName("Auto-open project panel on startup").setDesc(`If enabled, the ${jt} project panel will open on plugin load when an active project is saved. ⚠️ Requires plugin reload to take effect.`).addToggle(o=>o.setValue(!!e.settings.autoOpenPanelOnStartup).onChange(l=>{G(`${Z} Auto-open panel on startup changed: ${l}`),e.settings.autoOpenPanelOnStartup=l,e.saveSettings()})),new T.Setting(t).setName("Auto-select persisted project on startup").setDesc("If enabled, the persisted active project will be selected as the plugin's active project on load without opening the panel. ⚠️ Requires plugin reload to take effect.").addToggle(o=>o.setValue(!!e.settings.autoSelectProjectOnStartup).onChange(l=>{G(`${Z} Auto-select project on startup changed: ${l}`),e.settings.autoSelectProjectOnStartup=l,e.saveSettings()})),new T.Setting(t).setName(`Enable ${jt} debug logs`).setDesc(`When enabled, ${jt} will set window.__${jt.toUpperCase()}__ to true to show verbose runtime logs useful during development.`).addToggle(o=>o.setValue(!!e.settings.debug).onChange(l=>{G(`${Z} Debug logs setting changed: ${l}`),e.settings.debug=l,window.__WRITEAID_DEBUG__=!!l,e.saveSettings(),l?new T.Notice(`${jt}: debug logs enabled — verbose logs will appear in the DevTools console.`):new T.Notice(`${jt}: debug logs disabled.`)})),t.createEl("h3",{text:"Panel performance"}),new T.Setting(t).setName("Panel refresh debounce (ms)").setDesc("Debounce timeout (milliseconds) for side-panel refresh notifications. Lower values mean more frequent refreshes; 0 disables debouncing.").addText(o=>{const l=e.settings.panelRefreshDebounceMs,c=Number(l??fn);o.setPlaceholder(String(fn)),o.setValue(String(c));let u=null;const d=_=>{const f=Number(_);if(!Number.isFinite(f)||f<$e){new T.Notice(`Please enter a valid number ≥ ${$e}.`);return}const p=Math.min(Math.floor(f),cn);G(`${Z} Panel refresh debounce changed: ${p}ms`),e.settings.panelRefreshDebounceMs=p;try{const h=e.saveSettings();h&&typeof h.catch=="function"&&h.catch(()=>{})}catch{}this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=p),o.inputEl.value=String(p),u&&(u.value=String(p))};try{const _=o.inputEl;_.setAttribute("type","number"),_.setAttribute("min",String($e)),_.setAttribute("max",String(cn)),_.setAttribute("step","50"),_.setAttribute("aria-label","Panel refresh debounce in milliseconds"),ne(()=>{_.insertAdjacentHTML("afterend",'<span class="wa-unit">ms</span>')}),u=document.createElement("input"),u.type="range",u.min=String($e),u.max=String(cn),u.step="50",u.value=String(c),u.className="wa-debounce-range",ne(()=>{const f=_.nextSibling;f&&f.parentElement?f.insertAdjacentElement("afterend",u):_.insertAdjacentElement("afterend",u)}),o.onChange(f=>{const p=Number(f);d(p)}),u.addEventListener("input",f=>{const p=Number(f.target.value);o.inputEl.value=String(p),d(p)})}catch{o.onChange(_=>{const f=Number(_);if(!Number.isFinite(f)||f<$e){new T.Notice(`Please enter a valid number ≥ ${$e}.`);return}const p=Math.min(Math.floor(f),cn);e.settings.panelRefreshDebounceMs=p,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=p)})}}).addButton(o=>o.setButtonText("Reset").setTooltip(`Reset to default (${fn} ms)`).onClick(()=>{const l=fn;e.settings.panelRefreshDebounceMs=l,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=l),this.display()}))}}class ar extends T.Modal{constructor(t,e){super(t),this.currentFolder=null,this.expanded={},this.onPick=e,G(`${Z} FilePickerModal created`)}onOpen(){G(`${Z} FilePickerModal opened`);const t=this.app.vault.getRoot();this.currentFolder=t,this.expanded={},this.render()}render(){const{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Select template file"}),!this.currentFolder)return;const e=this.currentFolder.path?this.currentFolder.path.split("/"):[],r=t.createDiv({cls:"wat-breadcrumbs"}),i=r.createEl("a",{text:"(Vault root)",href:"#"});i.onclick=c=>{c.preventDefault(),this.currentFolder=this.app.vault.getRoot(),this.render()};let a="";for(const c of e){a=a?`${a}/${c}`:c,r.createDiv({text:" / "});const u=r.createEl("a",{text:c,href:"#"}),d=a;u.onclick=_=>{_.preventDefault();const f=this.app.vault.getAbstractFileByPath(d);f&&f instanceof T.TFolder&&(this.currentFolder=f,this.render())}}const o=t.createDiv({cls:"wat-controls"}).createEl("button",{text:"Up"});o.onclick=c=>{if(c.preventDefault(),!this.currentFolder)return;const u=this.currentFolder.parent?.path||"",d=u?this.app.vault.getAbstractFileByPath(u):this.app.vault.getRoot();d&&d instanceof T.TFolder&&(this.currentFolder=d,this.render())};const l=t.createDiv({cls:"wat-list"});for(const c of this.currentFolder.children)if(c instanceof T.TFolder){const u=l.createDiv({cls:"wat-row folder-row"}),d=u.createEl("button",{text:this.expanded[c.path]?"▾":"▸"});d.onclick=f=>{f.preventDefault(),this.expanded[c.path]=!this.expanded[c.path],this.render()};const _=u.createEl("a",{text:c.name,href:"#"});if(_.onclick=f=>{f.preventDefault(),this.currentFolder=c,this.render()},this.expanded[c.path]){const f=l.createDiv({cls:"wat-sub"});for(const p of c.children)if(p instanceof T.TFolder){const b=f.createDiv({cls:"wat-row sub-folder"}).createEl("a",{text:p.name,href:"#"});b.onclick=g=>{g.preventDefault(),this.currentFolder=p,this.render()}}else if(p instanceof T.TFile&&p.path.toLowerCase().endsWith(St)){const b=f.createDiv({cls:"wat-row sub-file"}).createEl("a",{text:p.name,href:"#"});b.onclick=g=>{g.preventDefault(),G(`${Z} File selected from file picker: ${p.path}`),this.close(),this.onPick(p.path)}}}}else if(c instanceof T.TFile&&c.path.toLowerCase().endsWith(St)){const d=l.createDiv({cls:"wat-row file-row"}).createEl("a",{text:c.name,href:"#"});d.onclick=_=>{_.preventDefault(),G(`${Z} File selected from file picker: ${c.path}`),this.close(),this.onPick(c.path)}}}onClose(){this.contentEl.empty()}}const Xc=":root{--background: var(--background-primary, #fff);--border: var(--background-modifier-border, #ccc);--border-focused: var(--interactive-accent, #7c5cff);--border-hover: var(--interactive-accent, #7c5cff);--border-radius: 6px;--border-radius-focused: 6px;--box-sizing: border-box;--font-size: 1.5em;--height: 38px;--padding: 0 10px;--margin: 0;--width: 100%;--list-background: var(--background-secondary, #f6f6f6);--list-border: var(--background-modifier-border, #e0e0e0);--list-border-radius: 6px;--list-shadow: 0 2px 8px rgba(30, 30, 30, .06);--list-z-index: 1000;--list-max-height: 260px;--item-color: var(--text-normal, #222);--item-hover-bg: var(--background-modifier-hover, #f0f0ff);--item-hover-color: var(--text-normal, #222);--item-active-background: var(--background-modifier-active, #eaeaff);--item-is-active-bg: var(--background-modifier-active, #eaeaff);--item-is-active-color: var(--text-normal, #222);--item-padding: 8px 14px;--item-height: 36px;--item-line-height: 1.4;--item-transition: background .15s;--placeholder-color: var(--text-muted, #888);--placeholder-opacity: 1;--chevron-color: var(--text-muted, #888);--chevron-icon-colour: var(--text-muted, #888);--chevron-background: transparent;--chevron-border: none;--chevron-width: 22px;--chevron-height: 22px;--chevron-pointer-events: auto;--icons-color: var(--text-muted, #888);--disabled-background: var(--background-modifier-disabled, #f3f3f3);--disabled-border-color: var(--background-modifier-border, #eee);--disabled-color: var(--text-muted, #bbb);--disabled-placeholder-color: var(--text-muted, #bbb);--disabled-placeholder-opacity: .7;--error-background: #fff0f0;--error-border: #d43c3c}.theme-dark{--background: var(--background-primary, #23232b);--border: var(--background-modifier-border, #333);--border-focused: var(--interactive-accent, #7c5cff);--border-hover: var(--interactive-accent, #7c5cff);--font-size: 1em;--list-background: var(--background-secondary, #23233a);--list-border: var(--background-modifier-border, #333);--item-color: var(--text-normal, #e0e0e0);--item-hover-bg: var(--background-modifier-hover, #2a2a4a);--item-hover-color: var(--text-normal, #e0e0e0);--item-active-background: var(--background-modifier-active, #2a2a4a);--item-is-active-bg: var(--background-modifier-active, #2a2a4a);--item-is-active-color: var(--text-normal, #e0e0e0);--placeholder-color: var(--text-muted, #aaa);--chevron-color: var(--text-muted, #aaa);--chevron-icon-colour: var(--text-muted, #aaa);--icons-color: var(--text-muted, #aaa);--disabled-background: var(--background-modifier-disabled, #23232b);--disabled-border-color: var(--background-modifier-border, #333);--disabled-color: var(--text-muted, #444);--disabled-placeholder-color: var(--text-muted, #444);--error-background: #2a1a1a;--error-border: #d43c3c}.writeaid-ribbon{padding-left:6px}.writeaid-ribbon .wa-icon{display:inline-block;vertical-align:middle}.writeaid-ribbon .wa-icon svg{width:16px;height:16px;fill:currentColor;display:block}:root{--wa-slider-track-height: 6px;--wa-slider-thumb-size: 12px;--wa-slider-accent: var(--interactive-accent, #7c5cff);--wa-slider-background: var(--background-modifier-host, #eee);--wa-slider-gap: 12px}.wa-debounce-range{margin-left:var(--wa-slider-gap);vertical-align:middle;appearance:none;height:var(--wa-slider-track-height);background:linear-gradient(90deg,var(--wa-slider-accent) 0%,var(--wa-slider-accent) 50%,var(--wa-slider-background) 50%,var(--wa-slider-background) 100%);border-radius:999px;outline:none}.wa-debounce-range::-webkit-slider-thumb{appearance:none;width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);box-shadow:0 0 0 4px #0000000d;cursor:pointer}.wa-debounce-range::-moz-range-thumb{width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);cursor:pointer}.wa-unit{color:var(--text-muted, #666);margin-left:6px}.justify-between{justify-content:space-between}.wa-rename-info{margin-bottom:8px;color:var(--text-muted, #888);font-size:.95em}.wa-rename-label{display:block;font-weight:500;margin-bottom:4px;color:var(--text-normal, #222)}.wa-rename-input{width:100%;padding:7px 10px;font-size:1em;border:1px solid var(--background-modifier-border, #ccc);border-radius:5px;margin-bottom:10px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s}.wa-rename-input:focus{border-color:var(--interactive-accent, #7c5cff);outline:none}.wa-rename-checkbox-label{display:flex;align-items:center;gap:6px;margin-bottom:10px;font-size:.97em;color:var(--text-muted, #666)}.wa-rename-btn-row{display:flex;gap:10px;margin-top:8px;justify-content:flex-end}.wa-rename-btn-row button{min-width:80px;padding:6px 14px;font-size:1em;border-radius:4px;border:none;cursor:pointer;transition:background .2s}.wa-rename-btn-row .mod-cta{background:var(--interactive-accent, #7c5cff);color:#fff;font-weight:600}.wa-rename-btn-row .mod-cta:hover{background:#5a3fd6}.wa-rename-btn-row .mod-cancel{background:var(--background-modifier-border, #eee);color:var(--text-muted, #666)}.wa-rename-btn-row .mod-cancel:hover{background:#e0e0e0}.wa-rename-error{min-height:18px;margin-bottom:4px;font-size:.97em;color:var(--color-red, #d43c3c);transition:opacity .2s}.wa-create-draft-input{width:100%;padding:8px 12px;font-size:1.05em;border:1.5px solid var(--background-modifier-border, #bbb);border-radius:6px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s,box-shadow .2s;outline:none;box-shadow:0 1px 2px #3c3c3c0a}.wa-create-draft-input:focus{border-color:var(--interactive-accent, #7c5cff);box-shadow:0 2px 8px #7c5cff14;background:var(--background-secondary, #fafaff)}.wa-panel{background:var(--background-primary, #fff);color:var(--text-normal, #222);border-radius:8px}.wa-title{font-size:1.2em;font-weight:600;color:var(--text-title, var(--text-normal, #222))}.wa-muted{color:var(--text-faint, var(--text-muted, #888))}.wa-row{display:flex;flex-direction:row;align-items:center}.wa-button-group{display:flex;gap:8px}.wa-draft-list{background:var(--background-secondary, #f6f6f6);border-radius:6px;padding:8px 0;margin-top:8px}.wa-draft-item{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-bottom:1px solid var(--background-modifier-border, #e0e0e0);background:transparent;color:var(--text-normal, #222);transition:background .15s}.wa-draft-item:last-child{border-bottom:none}.wa-draft-item.active{background:var(--background-modifier-active, #eaeaff)}.wa-draft-name{font-size:1em;font-weight:500;color:var(--text-normal, #222)}.wa-draft-actions{display:flex;gap:6px}.wa-panel .wa-select{--select-bg: var(--background-primary, #fff);--select-border: var(--background-modifier-border, #ccc);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #222);--select-placeholder: var(--text-muted, #888);--select-dropdown-bg: var(--background-secondary, #f6f6f6);--select-dropdown-border: var(--background-modifier-border, #e0e0e0);--select-option-hover: var(--background-modifier-hover, #f0f0ff);--select-option-active: var(--background-modifier-active, #eaeaff);--select-chevron: var(--text-muted, #888)}.theme-dark .wa-panel .wa-select{--select-bg: var(--background-primary, #23232b);--select-border: var(--background-modifier-border, #333);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #e0e0e0);--select-placeholder: var(--text-muted, #aaa);--select-dropdown-bg: var(--background-secondary, #23233a);--select-dropdown-border: var(--background-modifier-border, #333);--select-option-hover: var(--background-modifier-hover, #2a2a4a);--select-option-active: var(--background-modifier-active, #2a2a4a);--select-chevron: var(--text-muted, #aaa)}.wa-select{background:var(--select-bg);color:var(--select-text)}.wa-select:focus,.wa-select:focus-within{border-color:var(--select-border-focus)}.wa-select .select-placeholder{color:var(--select-placeholder)}.wa-select .select-dropdown{background:var(--select-dropdown-bg)}.wa-select .select-option{color:var(--select-text)}.wa-select .select-option:hover{background:var(--select-option-hover)}.wa-select .select-option[aria-selected=true],.wa-select .select-option.selected{background:var(--select-option-active)}.wa-select .select-chevron{color:var(--select-chevron)}.wa-select input[type=text]:focus{border-radius:0}.theme-dark .wa-panel{background:var(--background-primary, #23232b);color:var(--text-normal, #e0e0e0);border:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-title{color:var(--text-title, var(--text-normal, #e0e0e0))}.theme-dark .wa-muted{color:var(--text-faint, var(--text-muted, #aaa))}.theme-dark .wa-draft-list{background:var(--background-secondary, #23233a)}.theme-dark .wa-draft-item{color:var(--text-normal, #e0e0e0);border-bottom:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-draft-item.active{background:var(--background-modifier-active, #2a2a4a)}.theme-dark .wa-draft-name{color:var(--text-normal, #e0e0e0)}";if(typeof globalThis<"u"){const n=globalThis;n.__BROWSER__||(n.__BROWSER__=!0)}function Bi(n,t=20){return n.length<=t?n:n.substring(0,t-3)+"..."}const pa={outlineTemplate:`# {{draftName}} Outline

## Overview
Brief description of the story goes here.

## Characters
- Character 1: Description
- Character 2: Description

## Plot Points
- Opening: 
- Middle: 
- Climax: 
- Resolution: 

## Chapters
- Chapter 1: Title
- Chapter 2: Title
- Chapter 3: Title`,chapterTemplate:`# {{chapterName}}

## Summary
Chapter summary goes here.

## Scene 1
Scene content goes here.

## Scene 2
Scene content goes here.`,manuscriptNameTemplate:"{{draftName}}",slugStyle:"compact",ribbonPlacement:"left",ribbonAlwaysShow:!1,autoOpenPanelOnStartup:!0,autoSelectProjectOnStartup:!0,activeProject:void 0,panelRefreshDebounceMs:250,debug:!1,includeDraftOutline:!1,draftsFolderName:Re.DRAFTS,manuscriptsFolderName:Re.MANUSCRIPTS,backupsFolderName:Re.BACKUPS,metaFileName:oe.META,outlineFileName:oe.OUTLINE,maxBackups:5,maxBackupAgeDays:30};function $i(n){return Object.assign({},pa,n??{})}class Jc extends T.Plugin{constructor(){super(...arguments),this.settings=pa,this.settingsChangedCallbacks=[]}async loadSettings(){const t=await this.loadData();this.settings=$i(t),t&&t.activeProject!==void 0&&(this.settings.activeProject=t.activeProject),this.manager&&(this.manager.settings=this.settings),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(r){G(`${Z} Error in settings changed callback:`,r)}})}async saveSettings(){await Kt(async()=>{const e=$i(this.settings);await this.saveData(e),this.settings=e})===void 0&&await this.saveData(this.settings),this.manager&&(this.manager.settings=this.settings,G(`${Z} Updated manager settings reference, manuscript template: ${this.settings.manuscriptNameTemplate}`)),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(r){G(`${Z} Error in settings changed callback:`,r)}})}registerSettingsChangedCallback(t){this.settingsChangedCallbacks.push(t)}async runBackupCleanup(){if(this.manager)try{const e=await new Pn(this.app).listProjects();for(const r of e){const i=Vt(this.settings),a=`${r}/${i}`,s=this.app.vault.getAbstractFileByPath(a);if(!(!s||!(s instanceof T.TFolder))){for(const o of s.children)if(o instanceof T.TFolder){const l=`${a}/${o.name}`;await this.manager.projectFileService.backups.clearOldBackups(l,this.manager.settings)}}}G(`${Z} Backup cleanup completed on startup`)}catch(t){G(`${Z} Error during backup cleanup:`,t)}}async onload(){await this.loadSettings(),this.manager=new Kc(this.app,this,typeof this.settings.panelRefreshDebounceMs=="number"?this.settings.panelRefreshDebounceMs:void 0),G(`${Z} Manager created:`,!!this.manager);const t=new Pn(this.app);this.app.workspace.onLayoutReady(async()=>{const i=await t.listProjects();let a=null;if(i.length===1)a=i[0];else if(i.length>1){const s=this.settings.activeProject,o=s?.trim().replace(/^\/+/,"").replace(/\/+$/,"");G(`${Z} lastActiveRaw='${s}', normalized='${o}', includes=${o&&i.includes(o)}`),o&&i.includes(o)?a=o:a=i[0]}else if(i.length===0){const s=this.settings.activeProject,o=s?.trim().replace(/^\/+/,"").replace(/\/+$/,"");await t.isProjectFolder(s||"")&&(G(`${Z} activating saved project '${o}' as it exists and has valid meta file`),a=o??null)}if(G(`${Z} toActivate='${a}'`),a){if(await this.manager.setActiveProject(a),this.settings.activeProject=a,await this.saveSettings(),this.settings.autoOpenPanelOnStartup){const s=this.app.workspace.getLeavesOfType(Se);if(s.length>0)this.app.workspace.revealLeaf(s[0]);else{let o=null;this.settings.ribbonPlacement==="right"?o=this.app.workspace.getRightLeaf(!0):o=this.app.workspace.getLeftLeaf(!0);const l={type:Se,active:!0};o.setViewState(l),this.app.workspace.revealLeaf(o)}}}else await this.manager.setActiveProject(null),this.settings.activeProject=void 0,await this.saveSettings()}),this.statusBarEl=this.addStatusBarItem(),this.statusBarEl.setText(`${jt}: No active project`),this.runBackupCleanup().catch(i=>{G(`${Z} Failed to run backup cleanup on startup:`,i)}),ne(()=>{this.waStyleEl||(this.waStyleEl=document.createElement("style"),this.waStyleEl.setAttribute("data-writeaid-style",""),this.waStyleEl.textContent=Xc,this.waStyleEl.classList.add("writeaid-plugin-style"),document.head.appendChild(this.waStyleEl))}),await this.loadSettings(),ne(()=>{window.__WRITEAID_DEBUG__=!!this.settings.debug}),G(`${Z} Loading ${jt} Novel Multi-Draft Plugin`),this.manager.addActiveProjectListener(i=>{this.statusBarEl&&(i?(this.statusBarEl.setText(`${jt}: ${Bi(i)}`),G(`${Z} active project updated -> ${i}`)):this.statusBarEl.setText(`${jt}: No active project`))}),this.manager.activeProject&&this.statusBarEl.setText(`${jt}: ${Bi(this.manager.activeProject)}`),G(`${Z} Registering ProjectPanelView with manager:`,!!this.manager),this.registerView(Se,i=>(G(`${Z} Creating ProjectPanelView instance with manager:`,!!this.manager),new Uc(i,this.app,this.manager)));const e=this.addRibbonIcon(pr,`${jt} Projects`,()=>{});e.classList.add("writeaid-ribbon"),this.ribbonEl=e,e.setAttr("aria-label",`${jt} Projects`),e.onclick=()=>{const i=this.app.workspace.getLeavesOfType(Se);if(i.length>0){const a=i[0];this.app.workspace.revealLeaf(a)}else{let a=this.app.workspace.getLeftLeaf(!1);a||(a=this.app.workspace.getLeftLeaf(!0));const s={type:Se,active:!0};a.setViewState(s),this.app.workspace.revealLeaf(a)}};const r=async()=>{await Kt(async()=>{if(this.settings.ribbonAlwaysShow){e.style.display="";return}const a=t.listAllFolders();(await Xe(a,o=>t.isProjectFolder(o))).length>0?e.style.display="":e.style.display="none"})===void 0&&(e.style.display="")};this.refreshRibbonVisibility=r,r().catch(()=>{}),this.settings.ribbonPlacement==="right"&&this.moveRibbon("right"),this.registerEvent(this.app.vault.on("create",()=>{r().catch(()=>{})})),this.registerEvent(this.app.vault.on("delete",()=>{r().catch(()=>{})})),this.registerEvent(this.app.vault.on("modify",()=>{r().catch(()=>{})})),this.addCommand({id:"create-new-draft",name:"Create New Draft",callback:Xa(this.manager)}),this.addCommand({id:"create-outline",name:"Create Outline",callback:()=>Ja(this.manager)}),this.addCommand({id:"create-new-project",name:"Create New Project",callback:os(this.manager)}),this.addCommand({id:"switch-draft",name:"Switch Active Draft",callback:ts(this.manager)}),this.addCommand({id:"update-project-metadata",name:"Update Project Metadata",callback:Hc(this.manager)}),this.addCommand({id:"select-active-project",name:"Select Active Project",callback:ls(this.manager)}),this.addCommand({id:"generate-manuscript",name:"Generate Manuscript",callback:Qa(this.manager)}),this.addCommand({id:"toggle-project-panel",name:`Toggle ${jt} Project Panel`,callback:Wc(this.manager,this.app)}),this.addCommand({id:"convert-single-to-multi-file-project",name:"Convert Single-File Project to Multi-File",callback:()=>ss(this.app,this.manager.activeProject||this.manager.getCurrentProjectPath?.()||void 0,this.manager.settings)}),this.addCommand({id:"navigate-to-next-chapter",name:"Navigate to Next Chapter",callback:es(this.manager)}),this.addCommand({id:"navigate-to-previous-chapter",name:"Navigate to Previous Chapter",callback:ns(this.manager)}),this.addCommand({id:"create-backup",name:"Create Backup",callback:Ga(this.manager)}),this.addCommand({id:"list-and-restore-backups",name:"List and Restore Backups",callback:Ya(this.manager)}),this.addCommand({id:"delete-backup",name:"Delete Oldest Backup",callback:qa(this.manager)}),this.addCommand({id:"clear-old-backups",name:"Clear Old Backups",callback:Za(this.manager)}),this.addSettingTab(new Yc(this.app,this))}moveRibbon(t){ne(()=>{if(!this.ribbonEl)return;const e=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-right"),r=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-left");t==="right"&&e?e.appendChild(this.ribbonEl):t==="left"&&r&&r.appendChild(this.ribbonEl)})}onunload(){this.statusBarEl&&this.statusBarEl.parentElement&&this.statusBarEl.parentElement.removeChild(this.statusBarEl),G(`${Z} Unloading ${jt} Novel Multi-Draft Plugin`),this.waStyleEl&&this.waStyleEl.parentElement&&this.waStyleEl.parentElement.removeChild(this.waStyleEl)}}module.exports=Jc;
//# sourceMappingURL=main.js.map
