"use strict";var Na=Object.defineProperty;var Aa=(r,t,e)=>t in r?Na(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Pn=(r,t,e)=>Aa(r,typeof t!="symbol"?t+"":t,e);const D=require("obsidian"),mn={ACTIVE_PROJECT_NOT_FOUND:"No active project found.",ACTIVE_DRAFT_NOT_FOUND:"No active draft found.",BACKUPS_NOT_FOUND_PROJECT:"No backups found for the current project.",BACKUPS_NOT_FOUND_DRAFT:"No backups found for the current draft."},Oe={DRAFTS:"drafts",MANUSCRIPTS:"manuscripts",BACKUPS:".writeaid-backups"},fe={META:"meta.md",OUTLINE:"outline.md"},In={COMPACT:"compact",KEBAB:"kebab"},Rt={SINGLE:"single-file",MULTI:"multi-file"},Ta=Object.values(Rt),Et="WriteAid",S=`${Et} debug:`,Yn="pen-tool",Zr="1.0.0",mt=".md",Te=0,tn=5e3,en=250,Le=".zip",Gr=/^(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})\.zip$/,Ft="---",zt=new RegExp(`^${Ft}
([\\s\\S]*?)
${Ft}`),zn=1024,Yr=["B","KB","MB","GB"];function Bt(r){return(r==null?void 0:r.draftsFolderName)||Oe.DRAFTS}function qn(r){return(r==null?void 0:r.manuscriptsFolderName)||Oe.MANUSCRIPTS}function Ue(r){return(r==null?void 0:r.backupsFolderName)||Oe.BACKUPS}function Gt(r){return(r==null?void 0:r.metaFileName)||fe.META}function We(r){return(r==null?void 0:r.outlineFileName)||fe.OUTLINE}function Xt(r,t=In.COMPACT){if(!r)return"";const e=r.trim();return t===In.KEBAB?e.replace(/\s+/g,"-").toLowerCase():e.replace(/\s+/g,"").toLowerCase()}async function Se(r,t){const e=await Promise.all(r.map(n=>Promise.resolve(t(n))));return r.filter((n,a)=>e[a])}function Mt(r,...t){try{return r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}async function Ut(r,...t){try{return await r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}function Re(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const r=Date.now().toString(36),t=Math.random().toString(36).substring(2,15);return`${r}-${t}`}function F(...r){Mt(()=>{window.__WRITEAID_DEBUG__&&(console.debug||console.log).apply(console,r)})}function Xe(r,t){return r?t?!0:(new D.Notice(mn.ACTIVE_DRAFT_NOT_FOUND),!1):(new D.Notice(mn.ACTIVE_PROJECT_NOT_FOUND),!1)}function Ln(r){return r?r.trim().split(/\s+/).filter(e=>e.length>0).length:0}const Ba=Object.freeze(Object.defineProperty({__proto__:null,APP_NAME:Et,BACKUP_FILE_EXTENSION:Le,BACKUP_TIMESTAMP_REGEX:Gr,BYTES_PER_KILOBYTE:zn,DEBUG_PREFIX:S,FILES:fe,FILE_SIZE_UNITS:Yr,FOLDERS:Oe,FRONTMATTER_DELIMITER:Ft,FRONTMATTER_REGEX:zt,MARKDOWN_FILE_EXTENSION:mt,PANEL_DEBOUNCE_DEFAULT:en,PANEL_DEBOUNCE_MAX:tn,PANEL_DEBOUNCE_MIN:Te,PROJECT_TYPE:Rt,SLUG_STYLE:In,VALID_PROJECT_TYPES:Ta,WRITEAID_VERSION:Zr,WRITE_AID_ICON_NAME:Yn,asyncFilter:Se,checkActive:Xe,countWords:Ln,debug:F,generateDraftId:Re,getBackupsFolderName:Ue,getDraftsFolderName:Bt,getManuscriptsFolderName:qn,getMetaFileName:Gt,getOutlineFileName:We,slugifyDraftName:Xt,suppress:Mt,suppressAsync:Ut},Symbol.toStringTag,{value:"Module"}));function Oa(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Clear old backups command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Xe(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=Bt(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const c of a.children)if(c instanceof D.TFolder&&c.name.toLowerCase()===n.toLowerCase()){i=c.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID.");return}const l=r.projectFileService.backups.maxBackupAgeDays;await r.projectFileService.backups.clearOldBackups(s,o,r.settings),new D.Notice(`Old backups cleared (older than ${l} days).`)}}class Ra extends D.Modal{constructor(t,e,n){super(t),this.result=!1,this.resolvePromise=null,this.draftName=e,this.backupsToDelete=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Confirm Backup Creation"}),t.createEl("p",{text:`Creating a new backup for draft "${this.draftName}" will exceed the maximum number of backups allowed. The following will happen:`}),t.createEl("ul").createEl("li",{text:`${this.backupsToDelete} oldest backup(s) will be deleted to make room for the new one.`}),t.createEl("p",{text:"Do you want to continue?"}),new D.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.result=!1,this.close()})).addButton(e=>e.setButtonText("Continue").setCta().onClick(()=>{this.result=!0,this.close()}))}onClose(){this.resolvePromise&&this.resolvePromise(this.result)}showModal(){return new Promise(t=>{this.resolvePromise=t,this.open()})}}function Ia(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Create backup command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Xe(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=Bt(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const f of a.children)if(f instanceof D.TFolder&&f.name.toLowerCase()===n.toLowerCase()){i=f.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID for backup.");return}const l=await r.projectFileService.backups.willExceedMaxBackups(s,o,r.settings);if(l>0&&!await new Ra(r.app,e,l).showModal()){F(`${S} User cancelled backup creation due to cleanup`),new D.Notice("Backup creation cancelled.");return}if(await r.projectFileService.backups.createBackup(s,o,r.settings)){if(F(`${S} Backup created successfully, backupsToDelete=${l}`),l>0){F(`${S} Starting cleanup of ${l} excess backups for ${o}`);const f=await r.projectFileService.backups.cleanupExcessBackups(s,o,r.settings);F(`${S} Cleanup complete, deleted ${f} backups`)}new D.Notice("Backup created successfully.")}else F(`${S} Backup creation failed`),new D.Notice("Failed to create backup.")}}function za(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Delete backup command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Xe(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=Bt(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const h of a.children)if(h instanceof D.TFolder&&h.name.toLowerCase()===n.toLowerCase()){i=h.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID.");return}const l=await r.projectFileService.backups.listBackups(s,o,r.settings);if(l.length===0){new D.Notice(mn.BACKUPS_NOT_FOUND_DRAFT);return}const c=l[l.length-1];await r.projectFileService.backups.deleteBackup(s,o,c,r.settings)?new D.Notice(`Backup deleted successfully: ${c}.`):new D.Notice("Failed to delete backup.")}}class Mn extends D.Modal{constructor(t,e,n=!1){super(t),this.path=e,this.isDraft=n,this.setTitle("Confirm Overwrite")}onOpen(){const{contentEl:t}=this,e=this.isDraft?"draft folder":"manuscript file";t.createEl("p",{text:`The ${e} "${this.path}" already exists. Do you want to overwrite it?`});const n=t.createDiv({cls:"modal-button-container"});new D.ButtonComponent(n).setButtonText("Cancel").onClick(()=>{F(`${S} ConfirmOverwriteModal: cancelled overwrite for ${this.isDraft?"draft":"manuscript"} "${this.path}"`),this.resolve(!1),this.close()}),new D.ButtonComponent(n).setButtonText("Overwrite").setCta().onClick(()=>{F(`${S} ConfirmOverwriteModal: confirmed overwrite for ${this.isDraft?"draft":"manuscript"} "${this.path}"`),this.resolve(!0),this.close()})}onClose(){const{contentEl:t}=this;t.empty()}open(){return new Promise(t=>{this.resolve=t,super.open()})}}class La extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Restored Draft"}),t.createEl("div",{text:`The original draft '${this.oldName}' no longer exists. Please provide a new name for the restored draft.`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Restore",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameRestoredDraftModal: restoring draft as "${t}"`),this.onSubmit(t),this.close()}onClose(){this.contentEl.empty()}}class Ma extends D.SuggestModal{constructor(t,e,n){super(t),this.manager=e,this.backups=[],this.draftFolder="",this.draftName="",this.onRestoreComplete=n,this.setPlaceholder("Select a backup to restore..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to restore"},{command:"esc",purpose:"to cancel"}])}async onOpen(){const t=this.manager.activeProject;if(F(`${S} RestoreBackupModal opened for project: ${t}`),!t){new D.Notice("No active project found."),this.close();return}const e=Bt(this.manager.settings);if(this.draftFolder=`${t}/${e}`,this.draftName=t,this.backups=await this.getBackupDetails(),F(`${S} Found ${this.backups.length} backups for project: ${t}`),this.backups.length===0){new D.Notice(mn.BACKUPS_NOT_FOUND_PROJECT),this.close();return}this.setTitle(`Restore Backup for Project "${t}"`),super.onOpen()}async getBackupDetails(){const t=this.draftFolder.split("/")[0]||"unknown",e=`${Ue(this.manager.settings)}/${t}`;try{const n=[],a=Bt(this.manager.settings);let i=a;try{const l=await this.app.vault.adapter.list(e);for(const c of l.folders){const f=c.split("/").pop()||c;if(f.toLowerCase()===a.toLowerCase()){i=f;break}}}catch{F(`${S} Could not read backup project directory: ${e}`)}const s=`${e}/${i}`;F(`${S} Looking for backups in: ${s}`);const o=await this.app.vault.adapter.list(s);for(const l of o.folders){const c=l.split("/").pop()||l;let f=c;const h=`${t}/${a}`,g=this.manager.projectFileService.drafts.listDrafts(t);for(const v of g){const y=`${h}/${v}`;if(await this.manager.projectFileService.drafts.getDraftId(y)===c){f=v;break}}const u=`${s}/${c}`,m=await this.app.vault.adapter.list(u),p=this.app.vault.getAbstractFileByPath(t);let b=a;if(p&&p instanceof D.TFolder){for(const v of p.children)if(v instanceof D.TFolder&&v.name.toLowerCase()===a.toLowerCase()){b=v.name;break}}const d=`${t}/${b}/${f}`;for(const v of m.files){const y=v.split("/").pop()||v,$=new RegExp("^(\\d{4}-\\d{2}-\\d{2}T\\d{2}-\\d{2}-\\d{2})\\.zip$"),k=y.match($);if(k){const N=await this.app.vault.adapter.stat(v),A=(N==null?void 0:N.size)||0,I=k[1],P=I.replace(/T(\d{2})-(\d{2})-(\d{2})/,"T$1:$2:$3"),J=new Date(P).toLocaleString(),E=this.formatFileSize(A);n.push({timestamp:I,size:A,displayText:`${f}: ${J} (${E})`,draftName:f,draftFolder:d,draftId:c})}}}return n.sort((l,c)=>c.timestamp.localeCompare(l.timestamp))}catch{return F(`${S} Backup directory does not exist yet for project '${e}' (this is normal for new projects)`),[]}}formatFileSize(t){if(t===0)return"0 B";const e=Math.floor(Math.log(t)/Math.log(zn));return parseFloat((t/Math.pow(zn,e)).toFixed(1))+" "+Yr[e]}getSuggestions(t){return this.backups.filter(e=>e.displayText.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.createEl("div",{text:t.displayText})}async onChooseSuggestion(t,e){const n=this.manager.activeDraft;F(`${S} Restoring backup: ${t.draftName} (${t.timestamp}), current active draft: ${n}`);const a=this.app.vault.getAbstractFileByPath(t.draftFolder);let i=t.draftFolder,s=t.draftName;if(a&&a instanceof D.TFolder){if(!await new Mn(this.app,t.draftFolder,!0).open()){F(`${S} Backup restore cancelled by user`);return}}else{const l=new La(this.app,t.draftName,f=>{s=f});if(await new Promise(f=>{const h=l.onClose;l.onClose=()=>{h&&h.call(l),f()},l.open()}),s===t.draftName&&!a){F(`${S} Backup restore cancelled by user (rename modal)`);return}i=`${t.draftFolder.split("/").slice(0,-1).join("/")}/${s}`}await this.manager.projectFileService.backups.restoreBackup(i,t.draftId,t.timestamp,this.manager.settings)?(new D.Notice(`Backup restored successfully for "${s}" from ${t.displayText.split(": ")[1].split(" (")[0]}.`),F(`${S} Backup restore successful for: ${s}, active draft preserved: ${n} -> ${this.manager.activeDraft}`),this.onRestoreComplete&&this.onRestoreComplete()):(new D.Notice("Failed to restore backup."),F(`${S} Backup restore failed for: ${s}`))}}function Ua(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function fn(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(r,t){(function(e){r.exports=e()})(function(){return function e(n,a,i){function s(c,f){if(!a[c]){if(!n[c]){var h=typeof fn=="function"&&fn;if(!f&&h)return h(c,!0);if(o)return o(c,!0);var g=new Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g}var u=a[c]={exports:{}};n[c][0].call(u.exports,function(m){var p=n[c][1][m];return s(p||m)},u,u.exports,e,n,a,i)}return a[c].exports}for(var o=typeof fn=="function"&&fn,l=0;l<i.length;l++)s(i[l]);return s}({1:[function(e,n,a){var i=e("./utils"),s=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var c,f,h,g,u,m,p,b=[],d=0,v=l.length,y=v,$=i.getTypeOf(l)!=="string";d<l.length;)y=v-d,h=$?(c=l[d++],f=d<v?l[d++]:0,d<v?l[d++]:0):(c=l.charCodeAt(d++),f=d<v?l.charCodeAt(d++):0,d<v?l.charCodeAt(d++):0),g=c>>2,u=(3&c)<<4|f>>4,m=1<y?(15&f)<<2|h>>6:64,p=2<y?63&h:64,b.push(o.charAt(g)+o.charAt(u)+o.charAt(m)+o.charAt(p));return b.join("")},a.decode=function(l){var c,f,h,g,u,m,p=0,b=0,d="data:";if(l.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var v,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|y):new Array(0|y);p<l.length;)c=o.indexOf(l.charAt(p++))<<2|(g=o.indexOf(l.charAt(p++)))>>4,f=(15&g)<<4|(u=o.indexOf(l.charAt(p++)))>>2,h=(3&u)<<6|(m=o.indexOf(l.charAt(p++))),v[b++]=c,u!==64&&(v[b++]=f),m!==64&&(v[b++]=h);return v}},{"./support":30,"./utils":32}],2:[function(e,n,a){var i=e("./external"),s=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(f,h,g,u,m){this.compressedSize=f,this.uncompressedSize=h,this.crc32=g,this.compression=u,this.compressedContent=m}c.prototype={getContentWorker:function(){var f=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),h=this;return f.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(f,h,g){return f.pipe(new o).pipe(new l("uncompressedSize")).pipe(h.compressWorker(g)).pipe(new l("compressedSize")).withStreamInfo("compression",h)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,a){var i=e("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},a.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,a){var i=e("./utils"),s=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var f=0;f<8;f++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?function(c,f,h,g){var u=s,m=g+h;c^=-1;for(var p=g;p<m;p++)c=c>>>8^u[255&(c^f[p])];return-1^c}(0|l,o,o.length,0):function(c,f,h,g){var u=s,m=g+h;c^=-1;for(var p=g;p<m;p++)c=c>>>8^u[255&(c^f.charCodeAt(p))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(e,n,a){var i=null;i=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:i}},{lie:37}],7:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=i?"uint8array":"array";function f(h,g){l.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=g,this.meta={}}a.magic="\b\0",o.inherits(f,l),f.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,h.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(g){h.push({data:g,meta:h.meta})}},a.compressWorker=function(h){return new f("Deflate",h)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,a){function i(u,m){var p,b="";for(p=0;p<m;p++)b+=String.fromCharCode(255&u),u>>>=8;return b}function s(u,m,p,b,d,v){var y,$,k=u.file,N=u.compression,A=v!==c.utf8encode,I=o.transformTo("string",v(k.name)),P=o.transformTo("string",c.utf8encode(k.name)),T=k.comment,J=o.transformTo("string",v(T)),E=o.transformTo("string",c.utf8encode(T)),R=P.length!==k.name.length,_=E.length!==T.length,U="",at="",V="",it=k.dir,Z=k.date,ct={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(ct.crc32=u.crc32,ct.compressedSize=u.compressedSize,ct.uncompressedSize=u.uncompressedSize);var z=0;m&&(z|=8),A||!R&&!_||(z|=2048);var O=0,st=0;it&&(O|=16),d==="UNIX"?(st=798,O|=function(K,Ct){var At=K;return K||(At=Ct?16893:33204),(65535&At)<<16}(k.unixPermissions,it)):(st=20,O|=function(K){return 63&(K||0)}(k.dosPermissions)),y=Z.getUTCHours(),y<<=6,y|=Z.getUTCMinutes(),y<<=5,y|=Z.getUTCSeconds()/2,$=Z.getUTCFullYear()-1980,$<<=4,$|=Z.getUTCMonth()+1,$<<=5,$|=Z.getUTCDate(),R&&(at=i(1,1)+i(f(I),4)+P,U+="up"+i(at.length,2)+at),_&&(V=i(1,1)+i(f(J),4)+E,U+="uc"+i(V.length,2)+V);var M="";return M+=`
\0`,M+=i(z,2),M+=N.magic,M+=i(y,2),M+=i($,2),M+=i(ct.crc32,4),M+=i(ct.compressedSize,4),M+=i(ct.uncompressedSize,4),M+=i(I.length,2),M+=i(U.length,2),{fileRecord:h.LOCAL_FILE_HEADER+M+I+U,dirRecord:h.CENTRAL_FILE_HEADER+i(st,2)+M+i(J.length,2)+"\0\0\0\0"+i(O,4)+i(b,4)+I+U+J}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),f=e("../crc32"),h=e("../signature");function g(u,m,p,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(g,l),g.prototype.push=function(u){var m=u.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-b-1))/p:100}}))},g.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var m=this.streamFiles&&!u.file.dir;if(m){var p=s(u,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(u){this.accumulate=!1;var m=this.streamFiles&&!u.file.dir,p=s(u,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(b){return h.DATA_DESCRIPTOR+i(b.crc32,4)+i(b.compressedSize,4)+i(b.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var u=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-u,b=function(d,v,y,$,k){var N=o.transformTo("string",k($));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(d,2)+i(d,2)+i(v,4)+i(y,4)+i(N.length,2)+N}(this.dirRecords.length,p,u,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(u){this._sources.push(u);var m=this;return u.on("data",function(p){m.processChunk(p)}),u.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),u.on("error",function(p){m.error(p)}),this},g.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(u){var m=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var p=0;p<m.length;p++)try{m[p].error(u)}catch{}return!0},g.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,m=0;m<u.length;m++)u[m].lock()},n.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,a){var i=e("../compressions"),s=e("./ZipFileWorker");a.generateWorker=function(o,l,c){var f=new s(l.streamFiles,c,l.platform,l.encodeFileName),h=0;try{o.forEach(function(g,u){h++;var m=function(v,y){var $=v||y,k=i[$];if(!k)throw new Error($+" is not a valid compression method !");return k}(u.options.compression,l.compression),p=u.options.compressionOptions||l.compressionOptions||{},b=u.dir,d=u.date;u._compressWorker(m,p).withStreamInfo("file",{name:g,dir:b,date:d,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(f)}),f.entriesCount=h}catch(g){f.error(g)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,a){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(s,o){return new i().loadAsync(s,o)},i.external=e("./external"),n.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,a){var i=e("./utils"),s=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),f=e("./nodejsUtils");function h(g){return new s.Promise(function(u,m){var p=g.decompressed.getContentWorker().pipe(new c);p.on("error",function(b){m(b)}).on("end",function(){p.streamInfo.crc32!==g.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}n.exports=function(g,u){var m=this;return u=i.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),f.isNode&&f.isStream(g)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",g,!0,u.optimizedBinaryString,u.base64).then(function(p){var b=new l(u);return b.load(p),b}).then(function(p){var b=[s.Promise.resolve(p)],d=p.files;if(u.checkCRC32)for(var v=0;v<d.length;v++)b.push(h(d[v]));return s.Promise.all(b)}).then(function(p){for(var b=p.shift(),d=b.files,v=0;v<d.length;v++){var y=d[v],$=y.fileNameStr,k=i.resolve(y.fileNameStr);m.file(k,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:u.createFolders}),y.dir||(m.file(k).unsafeOriginalName=$)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,a){var i=e("../utils"),s=e("../stream/GenericWorker");function o(l,c){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(o,s),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(f){c.push({data:f,meta:{percent:0}})}).on("error",function(f){c.isPaused?this.generatedError=f:c.error(f)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,a){var i=e("readable-stream").Readable;function s(o,l,c){i.call(this,l),this._helper=o;var f=this;o.on("data",function(h,g){f.push(h)||f._helper.pause(),c&&c(g)}).on("error",function(h){f.emit("error",h)}).on("end",function(){f.push(null)})}e("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(e,n,a){function i(k,N,A){var I,P=o.getTypeOf(N),T=o.extend(A||{},f);T.date=T.date||new Date,T.compression!==null&&(T.compression=T.compression.toUpperCase()),typeof T.unixPermissions=="string"&&(T.unixPermissions=parseInt(T.unixPermissions,8)),T.unixPermissions&&16384&T.unixPermissions&&(T.dir=!0),T.dosPermissions&&16&T.dosPermissions&&(T.dir=!0),T.dir&&(k=d(k)),T.createFolders&&(I=b(k))&&v.call(this,I,!0);var J=P==="string"&&T.binary===!1&&T.base64===!1;A&&A.binary!==void 0||(T.binary=!J),(N instanceof h&&N.uncompressedSize===0||T.dir||!N||N.length===0)&&(T.base64=!1,T.binary=!0,N="",T.compression="STORE",P="string");var E=null;E=N instanceof h||N instanceof l?N:m.isNode&&m.isStream(N)?new p(k,N):o.prepareContent(k,N,T.binary,T.optimizedBinaryString,T.base64);var R=new g(k,E,T);this.files[k]=R}var s=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),f=e("./defaults"),h=e("./compressedObject"),g=e("./zipObject"),u=e("./generate"),m=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),b=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var N=k.lastIndexOf("/");return 0<N?k.substring(0,N):""},d=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},v=function(k,N){return N=N!==void 0?N:f.createFolders,k=d(k),this.files[k]||i.call(this,k,null,{dir:!0,createFolders:N}),this.files[k]};function y(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var $={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var N,A,I;for(N in this.files)I=this.files[N],(A=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&k(A,I)},filter:function(k){var N=[];return this.forEach(function(A,I){k(A,I)&&N.push(I)}),N},file:function(k,N,A){if(arguments.length!==1)return k=this.root+k,i.call(this,k,N,A),this;if(y(k)){var I=k;return this.filter(function(T,J){return!J.dir&&I.test(T)})}var P=this.files[this.root+k];return P&&!P.dir?P:null},folder:function(k){if(!k)return this;if(y(k))return this.filter(function(P,T){return T.dir&&k.test(P)});var N=this.root+k,A=v.call(this,N),I=this.clone();return I.root=A.name,I},remove:function(k){k=this.root+k;var N=this.files[k];if(N||(k.slice(-1)!=="/"&&(k+="/"),N=this.files[k]),N&&!N.dir)delete this.files[k];else for(var A=this.filter(function(P,T){return T.name.slice(0,k.length)===k}),I=0;I<A.length;I++)delete this.files[A[I].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var N,A={};try{if((A=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var I=A.comment||this.comment||"";N=u.generateWorker(this,A,I)}catch(P){(N=new l("error")).error(P)}return new c(N,A.type||"string",A.mimeType)},generateAsync:function(k,N){return this.generateInternalStream(k).accumulate(N)},generateNodeStream:function(k,N){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(N)}};n.exports=$},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,a){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),h=o.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===l&&this.data[g+1]===c&&this.data[g+2]===f&&this.data[g+3]===h)return g-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),h=o.charCodeAt(3),g=this.readData(4);return l===g[0]&&c===g[1]&&f===g[2]&&h===g[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,n,a){var i=e("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(e,n,a){var i=e("./Uint8ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,n,a){var i=e("./ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,a){var i=e("../utils"),s=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),f=e("./Uint8ArrayReader");n.exports=function(h){var g=i.getTypeOf(h);return i.checkSupport(g),g!=="string"||s.uint8array?g==="nodebuffer"?new c(h):s.uint8array?new f(i.transformTo("uint8array",h)):new o(i.transformTo("array",h)):new l(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,a){var i=e("./GenericWorker"),s=e("../utils");function o(l){i.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,i),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,a){var i=e("./GenericWorker"),s=e("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,i),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(o,s),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){c.dataIsReady=!0,c.data=f,c.max=f&&f.length||0,c.type=i.getTypeOf(f),c.isPaused||c._tickAndRepeat()},function(f){c.error(f)})}i.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,a){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=i},{}],29:[function(e,n,a){var i=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),f=e("../external"),h=null;if(c.nodestream)try{h=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(m,p){return new f.Promise(function(b,d){var v=[],y=m._internalType,$=m._outputType,k=m._mimeType;m.on("data",function(N,A){v.push(N),p&&p(A)}).on("error",function(N){v=[],d(N)}).on("end",function(){try{var N=function(A,I,P){switch(A){case"blob":return i.newBlob(i.transformTo("arraybuffer",I),P);case"base64":return l.encode(I);default:return i.transformTo(A,I)}}($,function(A,I){var P,T=0,J=null,E=0;for(P=0;P<I.length;P++)E+=I[P].length;switch(A){case"string":return I.join("");case"array":return Array.prototype.concat.apply([],I);case"uint8array":for(J=new Uint8Array(E),P=0;P<I.length;P++)J.set(I[P],T),T+=I[P].length;return J;case"nodebuffer":return Buffer.concat(I);default:throw new Error("concat : unsupported type '"+A+"'")}}(y,v),k);b(N)}catch(A){d(A)}v=[]}).resume()})}function u(m,p,b){var d=p;switch(p){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=p,this._mimeType=b,i.checkSupport(d),this._worker=m.pipe(new s(d)),m.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}u.prototype={accumulate:function(m){return g(this,m)},on:function(m,p){var b=this;return m==="data"?this._worker.on(m,function(d){p.call(b,d.data,d.meta)}):this._worker.on(m,function(){i.delay(p,arguments,b)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var i=new ArrayBuffer(0);try{a.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!e("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,a){for(var i=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),f=0;f<256;f++)c[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;c[254]=c[254]=1;function h(){l.call(this,"utf-8 decode"),this.leftOver=null}function g(){l.call(this,"utf-8 encode")}a.utf8encode=function(u){return s.nodebuffer?o.newBufferFrom(u,"utf-8"):function(m){var p,b,d,v,y,$=m.length,k=0;for(v=0;v<$;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<$&&(64512&(d=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(d-56320),v++),k+=b<128?1:b<2048?2:b<65536?3:4;for(p=s.uint8array?new Uint8Array(k):new Array(k),v=y=0;y<k;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<$&&(64512&(d=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(d-56320),v++),b<128?p[y++]=b:(b<2048?p[y++]=192|b>>>6:(b<65536?p[y++]=224|b>>>12:(p[y++]=240|b>>>18,p[y++]=128|b>>>12&63),p[y++]=128|b>>>6&63),p[y++]=128|63&b);return p}(u)},a.utf8decode=function(u){return s.nodebuffer?i.transformTo("nodebuffer",u).toString("utf-8"):function(m){var p,b,d,v,y=m.length,$=new Array(2*y);for(p=b=0;p<y;)if((d=m[p++])<128)$[b++]=d;else if(4<(v=c[d]))$[b++]=65533,p+=v-1;else{for(d&=v===2?31:v===3?15:7;1<v&&p<y;)d=d<<6|63&m[p++],v--;1<v?$[b++]=65533:d<65536?$[b++]=d:(d-=65536,$[b++]=55296|d>>10&1023,$[b++]=56320|1023&d)}return $.length!==b&&($.subarray?$=$.subarray(0,b):$.length=b),i.applyFromCharCode($)}(u=i.transformTo(s.uint8array?"uint8array":"array",u))},i.inherits(h,l),h.prototype.processChunk=function(u){var m=i.transformTo(s.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(v,y){var $;for((y=y||v.length)>v.length&&(y=v.length),$=y-1;0<=$&&(192&v[$])==128;)$--;return $<0||$===0?y:$+c[v[$]]>y?$:y}(m),d=m;b!==m.length&&(s.uint8array?(d=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(d=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:a.utf8decode(d),meta:u.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=h,i.inherits(g,l),g.prototype.processChunk=function(u){this.push({data:a.utf8encode(u.data),meta:u.meta})},a.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,a){var i=e("./support"),s=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(p){return p}function f(p,b){for(var d=0;d<p.length;++d)b[d]=255&p.charCodeAt(d);return b}e("setimmediate"),a.newBlob=function(p,b){a.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return d.append(p),d.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(p,b,d){var v=[],y=0,$=p.length;if($<=d)return String.fromCharCode.apply(null,p);for(;y<$;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(y,Math.min(y+d,$)))):v.push(String.fromCharCode.apply(null,p.subarray(y,Math.min(y+d,$)))),y+=d;return v.join("")},stringifyByChar:function(p){for(var b="",d=0;d<p.length;d++)b+=String.fromCharCode(p[d]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function g(p){var b=65536,d=a.getTypeOf(p),v=!0;if(d==="uint8array"?v=h.applyCanBeUsed.uint8array:d==="nodebuffer"&&(v=h.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return h.stringifyByChunk(p,d,b)}catch{b=Math.floor(b/2)}return h.stringifyByChar(p)}function u(p,b){for(var d=0;d<p.length;d++)b[d]=p[d];return b}a.applyFromCharCode=g;var m={};m.string={string:c,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:function(p){return f(p,o.allocBuffer(p.length))}},m.array={string:g,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},m.arraybuffer={string:function(p){return g(new Uint8Array(p))},array:function(p){return u(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:g,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return o.newBufferFrom(p)}},m.nodebuffer={string:g,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:c},a.transformTo=function(p,b){if(b=b||"",!p)return b;a.checkSupport(p);var d=a.getTypeOf(b);return m[d][p](b)},a.resolve=function(p){for(var b=p.split("/"),d=[],v=0;v<b.length;v++){var y=b[v];y==="."||y===""&&v!==0&&v!==b.length-1||(y===".."?d.pop():d.push(y))}return d.join("/")},a.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(p)?"nodebuffer":i.uint8array&&p instanceof Uint8Array?"uint8array":i.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(p){if(!i[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(p){var b,d,v="";for(d=0;d<(p||"").length;d++)v+="\\x"+((b=p.charCodeAt(d))<16?"0":"")+b.toString(16).toUpperCase();return v},a.delay=function(p,b,d){setImmediate(function(){p.apply(d||null,b||[])})},a.inherits=function(p,b){function d(){}d.prototype=b.prototype,p.prototype=new d},a.extend=function(){var p,b,d={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&d[b]===void 0&&(d[b]=arguments[p][b]);return d},a.prepareContent=function(p,b,d,v,y){return l.Promise.resolve(b).then(function($){return i.blob&&($ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call($))!==-1)&&typeof FileReader<"u"?new l.Promise(function(k,N){var A=new FileReader;A.onload=function(I){k(I.target.result)},A.onerror=function(I){N(I.target.error)},A.readAsArrayBuffer($)}):$}).then(function($){var k=a.getTypeOf($);return k?(k==="arraybuffer"?$=a.transformTo("uint8array",$):k==="string"&&(y?$=s.decode($):d&&v!==!0&&($=function(N){return f(N,i.uint8array?new Uint8Array(N.length):new Array(N.length))}($))),$):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function f(h){this.files=[],this.loadOptions=h}f.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(g)+", expected "+s.pretty(h)+")")}},isSignature:function(h,g){var u=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===g;return this.reader.setIndex(u),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),g=c.uint8array?"uint8array":"array",u=s.transformTo(g,h);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,g,u,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),g=this.reader.readInt(4),u=this.reader.readData(g),this.zip64ExtensibleData[h]={id:h,length:g,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,g;for(h=0;h<this.files.length;h++)g=this.files[h],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(h=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var g=h;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var m=g-u;if(0<m)this.isSignature(g,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=i(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),f=e("./compressions"),h=e("./support");function g(u,m){this.options=u,this.loadOptions=m}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var m,p;if(u.skip(22),this.fileNameLength=u.readInt(2),p=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var d in f)if(Object.prototype.hasOwnProperty.call(f,d)&&f[d].magic===b)return f[d];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var m=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(m),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var m,p,b,d=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<d;)m=u.readInt(2),p=u.readInt(2),b=u.readData(p),this.extraFields[m]={id:m,length:p,value:b};u.setIndex(d)},handleUTF8:function(){var u=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=s.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var d=s.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(d)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var m=i(u.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var m=i(u.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null}},n.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,a){function i(m,p,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var s=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),f=e("./stream/GenericWorker");i.prototype={internalStream:function(m){var p=null,b="string";try{if(!m)throw new Error("No output type specified.");var d=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!d&&(p=p.pipe(new l.Utf8EncodeWorker)),!v&&d&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(y){(p=new f("error")).error(y)}return new s(p,b,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof c&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,m,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof f?this._data:new o(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<h.length;u++)i.prototype[h[u]]=g;n.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,a){(function(i){var s,o,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var c=0,f=new l(m),h=i.document.createTextNode("");f.observe(h,{characterData:!0}),s=function(){h.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var p=i.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},i.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var g=new i.MessageChannel;g.port1.onmessage=m,s=function(){g.port2.postMessage(0)}}var u=[];function m(){var p,b;o=!0;for(var d=u.length;d;){for(b=u,u=[],p=-1;++p<d;)b[p]();d=u.length}o=!1}n.exports=function(p){u.push(p)!==1||o||s()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,a){var i=e("immediate");function s(){}var o={},l=["REJECTED"],c=["FULFILLED"],f=["PENDING"];function h(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,d!==s&&p(this,d)}function g(d,v,y){this.promise=d,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function u(d,v,y){i(function(){var $;try{$=v(y)}catch(k){return o.reject(d,k)}$===d?o.reject(d,new TypeError("Cannot resolve promise with itself")):o.resolve(d,$)})}function m(d){var v=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof v=="function")return function(){v.apply(d,arguments)}}function p(d,v){var y=!1;function $(A){y||(y=!0,o.reject(d,A))}function k(A){y||(y=!0,o.resolve(d,A))}var N=b(function(){v(k,$)});N.status==="error"&&$(N.value)}function b(d,v){var y={};try{y.value=d(v),y.status="success"}catch($){y.status="error",y.value=$}return y}(n.exports=h).prototype.finally=function(d){if(typeof d!="function")return this;var v=this.constructor;return this.then(function(y){return v.resolve(d()).then(function(){return y})},function(y){return v.resolve(d()).then(function(){throw y})})},h.prototype.catch=function(d){return this.then(null,d)},h.prototype.then=function(d,v){if(typeof d!="function"&&this.state===c||typeof v!="function"&&this.state===l)return this;var y=new this.constructor(s);return this.state!==f?u(y,this.state===c?d:v,this.outcome):this.queue.push(new g(y,d,v)),y},g.prototype.callFulfilled=function(d){o.resolve(this.promise,d)},g.prototype.otherCallFulfilled=function(d){u(this.promise,this.onFulfilled,d)},g.prototype.callRejected=function(d){o.reject(this.promise,d)},g.prototype.otherCallRejected=function(d){u(this.promise,this.onRejected,d)},o.resolve=function(d,v){var y=b(m,v);if(y.status==="error")return o.reject(d,y.value);var $=y.value;if($)p(d,$);else{d.state=c,d.outcome=v;for(var k=-1,N=d.queue.length;++k<N;)d.queue[k].callFulfilled(v)}return d},o.reject=function(d,v){d.state=l,d.outcome=v;for(var y=-1,$=d.queue.length;++y<$;)d.queue[y].callRejected(v);return d},h.resolve=function(d){return d instanceof this?d:o.resolve(new this(s),d)},h.reject=function(d){var v=new this(s);return o.reject(v,d)},h.all=function(d){var v=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=d.length,$=!1;if(!y)return this.resolve([]);for(var k=new Array(y),N=0,A=-1,I=new this(s);++A<y;)P(d[A],A);return I;function P(T,J){v.resolve(T).then(function(E){k[J]=E,++N!==y||$||($=!0,o.resolve(I,k))},function(E){$||($=!0,o.reject(I,E))})}},h.race=function(d){var v=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=d.length,$=!1;if(!y)return this.resolve([]);for(var k=-1,N=new this(s);++k<y;)A=d[k],v.resolve(A).then(function(I){$||($=!0,o.resolve(N,I))},function(I){$||($=!0,o.reject(N,I))});var A;return N}},{immediate:36}],38:[function(e,n,a){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,a){var i=e("./zlib/deflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),f=Object.prototype.toString,h=0,g=-1,u=0,m=8;function p(d){if(!(this instanceof p))return new p(d);this.options=s.assign({level:g,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},d||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=i.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(y!==h)throw new Error(l[y]);if(v.header&&i.deflateSetHeader(this.strm,v.header),v.dictionary){var $;if($=typeof v.dictionary=="string"?o.string2buf(v.dictionary):f.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(y=i.deflateSetDictionary(this.strm,$))!==h)throw new Error(l[y]);this._dict_set=!0}}function b(d,v){var y=new p(v);if(y.push(d,!0),y.err)throw y.msg||l[y.err];return y.result}p.prototype.push=function(d,v){var y,$,k=this.strm,N=this.options.chunkSize;if(this.ended)return!1;$=v===~~v?v:v===!0?4:0,typeof d=="string"?k.input=o.string2buf(d):f.call(d)==="[object ArrayBuffer]"?k.input=new Uint8Array(d):k.input=d,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(N),k.next_out=0,k.avail_out=N),(y=i.deflate(k,$))!==1&&y!==h)return this.onEnd(y),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||$!==4&&$!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(k.output,k.next_out))):this.onData(s.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&y!==1);return $===4?(y=i.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===h):$!==2||(this.onEnd(h),!(k.avail_out=0))},p.prototype.onData=function(d){this.chunks.push(d)},p.prototype.onEnd=function(d){d===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},a.Deflate=p,a.deflate=b,a.deflateRaw=function(d,v){return(v=v||{}).raw=!0,b(d,v)},a.gzip=function(d,v){return(v=v||{}).gzip=!0,b(d,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,a){var i=e("./zlib/inflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),f=e("./zlib/zstream"),h=e("./zlib/gzheader"),g=Object.prototype.toString;function u(p){if(!(this instanceof u))return new u(p);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var d=i.inflateInit2(this.strm,b.windowBits);if(d!==l.Z_OK)throw new Error(c[d]);this.header=new h,i.inflateGetHeader(this.strm,this.header)}function m(p,b){var d=new u(b);if(d.push(p,!0),d.err)throw d.msg||c[d.err];return d.result}u.prototype.push=function(p,b){var d,v,y,$,k,N,A=this.strm,I=this.options.chunkSize,P=this.options.dictionary,T=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?A.input=o.binstring2buf(p):g.call(p)==="[object ArrayBuffer]"?A.input=new Uint8Array(p):A.input=p,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new s.Buf8(I),A.next_out=0,A.avail_out=I),(d=i.inflate(A,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&P&&(N=typeof P=="string"?o.string2buf(P):g.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,d=i.inflateSetDictionary(this.strm,N)),d===l.Z_BUF_ERROR&&T===!0&&(d=l.Z_OK,T=!1),d!==l.Z_STREAM_END&&d!==l.Z_OK)return this.onEnd(d),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&d!==l.Z_STREAM_END&&(A.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(A.output,A.next_out),$=A.next_out-y,k=o.buf2string(A.output,y),A.next_out=$,A.avail_out=I-$,$&&s.arraySet(A.output,A.output,y,$,0),this.onData(k)):this.onData(s.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(T=!0)}while((0<A.avail_in||A.avail_out===0)&&d!==l.Z_STREAM_END);return d===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(d=i.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(A.avail_out=0))},u.prototype.onData=function(p){this.chunks.push(p)},u.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},a.Inflate=u,a.inflate=m,a.inflateRaw=function(p,b){return(b=b||{}).raw=!0,m(p,b)},a.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var f=c.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var h in f)f.hasOwnProperty(h)&&(l[h]=f[h])}}return l},a.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var s={arraySet:function(l,c,f,h,g){if(c.subarray&&l.subarray)l.set(c.subarray(f,f+h),g);else for(var u=0;u<h;u++)l[g+u]=c[f+u]},flattenChunks:function(l){var c,f,h,g,u,m;for(c=h=0,f=l.length;c<f;c++)h+=l[c].length;for(m=new Uint8Array(h),c=g=0,f=l.length;c<f;c++)u=l[c],m.set(u,g),g+=u.length;return m}},o={arraySet:function(l,c,f,h,g){for(var u=0;u<h;u++)l[g+u]=c[f+u]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,o))},a.setTyped(i)},{}],42:[function(e,n,a){var i=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new i.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function f(h,g){if(g<65537&&(h.subarray&&o||!h.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(h,g));for(var u="",m=0;m<g;m++)u+=String.fromCharCode(h[m]);return u}l[254]=l[254]=1,a.string2buf=function(h){var g,u,m,p,b,d=h.length,v=0;for(p=0;p<d;p++)(64512&(u=h.charCodeAt(p)))==55296&&p+1<d&&(64512&(m=h.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),v+=u<128?1:u<2048?2:u<65536?3:4;for(g=new i.Buf8(v),p=b=0;b<v;p++)(64512&(u=h.charCodeAt(p)))==55296&&p+1<d&&(64512&(m=h.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),u<128?g[b++]=u:(u<2048?g[b++]=192|u>>>6:(u<65536?g[b++]=224|u>>>12:(g[b++]=240|u>>>18,g[b++]=128|u>>>12&63),g[b++]=128|u>>>6&63),g[b++]=128|63&u);return g},a.buf2binstring=function(h){return f(h,h.length)},a.binstring2buf=function(h){for(var g=new i.Buf8(h.length),u=0,m=g.length;u<m;u++)g[u]=h.charCodeAt(u);return g},a.buf2string=function(h,g){var u,m,p,b,d=g||h.length,v=new Array(2*d);for(u=m=0;u<d;)if((p=h[u++])<128)v[m++]=p;else if(4<(b=l[p]))v[m++]=65533,u+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&u<d;)p=p<<6|63&h[u++],b--;1<b?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return f(v,m)},a.utf8border=function(h,g){var u;for((g=g||h.length)>h.length&&(g=h.length),u=g-1;0<=u&&(192&h[u])==128;)u--;return u<0||u===0?g:u+l[h[u]]>g?u:g}},{"./common":41}],43:[function(e,n,a){n.exports=function(i,s,o,l){for(var c=65535&i|0,f=i>>>16&65535|0,h=0;o!==0;){for(o-=h=2e3<o?2e3:o;f=f+(c=c+s[l++]|0)|0,--h;);c%=65521,f%=65521}return c|f<<16|0}},{}],44:[function(e,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,a){var i=function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o}();n.exports=function(s,o,l,c){var f=i,h=c+l;s^=-1;for(var g=c;g<h;g++)s=s>>>8^f[255&(s^o[g])];return-1^s}},{}],46:[function(e,n,a){var i,s=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),f=e("./messages"),h=0,g=4,u=0,m=-2,p=-1,b=4,d=2,v=8,y=9,$=286,k=30,N=19,A=2*$+1,I=15,P=3,T=258,J=T+P+1,E=42,R=113,_=1,U=2,at=3,V=4;function it(w,W){return w.msg=f[W],W}function Z(w){return(w<<1)-(4<w?9:0)}function ct(w){for(var W=w.length;0<=--W;)w[W]=0}function z(w){var W=w.state,L=W.pending;L>w.avail_out&&(L=w.avail_out),L!==0&&(s.arraySet(w.output,W.pending_buf,W.pending_out,L,w.next_out),w.next_out+=L,W.pending_out+=L,w.total_out+=L,w.avail_out-=L,W.pending-=L,W.pending===0&&(W.pending_out=0))}function O(w,W){o._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,W),w.block_start=w.strstart,z(w.strm)}function st(w,W){w.pending_buf[w.pending++]=W}function M(w,W){w.pending_buf[w.pending++]=W>>>8&255,w.pending_buf[w.pending++]=255&W}function K(w,W){var L,x,C=w.max_chain_length,j=w.strstart,H=w.prev_length,G=w.nice_match,B=w.strstart>w.w_size-J?w.strstart-(w.w_size-J):0,X=w.window,rt=w.w_mask,tt=w.prev,lt=w.strstart+T,St=X[j+H-1],_t=X[j+H];w.prev_length>=w.good_match&&(C>>=2),G>w.lookahead&&(G=w.lookahead);do if(X[(L=W)+H]===_t&&X[L+H-1]===St&&X[L]===X[j]&&X[++L]===X[j+1]){j+=2,L++;do;while(X[++j]===X[++L]&&X[++j]===X[++L]&&X[++j]===X[++L]&&X[++j]===X[++L]&&X[++j]===X[++L]&&X[++j]===X[++L]&&X[++j]===X[++L]&&X[++j]===X[++L]&&j<lt);if(x=T-(lt-j),j=lt-T,H<x){if(w.match_start=W,G<=(H=x))break;St=X[j+H-1],_t=X[j+H]}}while((W=tt[W&rt])>B&&--C!=0);return H<=w.lookahead?H:w.lookahead}function Ct(w){var W,L,x,C,j,H,G,B,X,rt,tt=w.w_size;do{if(C=w.window_size-w.lookahead-w.strstart,w.strstart>=tt+(tt-J)){for(s.arraySet(w.window,w.window,tt,tt,0),w.match_start-=tt,w.strstart-=tt,w.block_start-=tt,W=L=w.hash_size;x=w.head[--W],w.head[W]=tt<=x?x-tt:0,--L;);for(W=L=tt;x=w.prev[--W],w.prev[W]=tt<=x?x-tt:0,--L;);C+=tt}if(w.strm.avail_in===0)break;if(H=w.strm,G=w.window,B=w.strstart+w.lookahead,X=C,rt=void 0,rt=H.avail_in,X<rt&&(rt=X),L=rt===0?0:(H.avail_in-=rt,s.arraySet(G,H.input,H.next_in,rt,B),H.state.wrap===1?H.adler=l(H.adler,G,rt,B):H.state.wrap===2&&(H.adler=c(H.adler,G,rt,B)),H.next_in+=rt,H.total_in+=rt,rt),w.lookahead+=L,w.lookahead+w.insert>=P)for(j=w.strstart-w.insert,w.ins_h=w.window[j],w.ins_h=(w.ins_h<<w.hash_shift^w.window[j+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[j+P-1])&w.hash_mask,w.prev[j&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=j,j++,w.insert--,!(w.lookahead+w.insert<P)););}while(w.lookahead<J&&w.strm.avail_in!==0)}function At(w,W){for(var L,x;;){if(w.lookahead<J){if(Ct(w),w.lookahead<J&&W===h)return _;if(w.lookahead===0)break}if(L=0,w.lookahead>=P&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+P-1])&w.hash_mask,L=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),L!==0&&w.strstart-L<=w.w_size-J&&(w.match_length=K(w,L)),w.match_length>=P)if(x=o._tr_tally(w,w.strstart-w.match_start,w.match_length-P),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=P){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+P-1])&w.hash_mask,L=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else x=o._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(x&&(O(w,!1),w.strm.avail_out===0))return _}return w.insert=w.strstart<P-1?w.strstart:P-1,W===g?(O(w,!0),w.strm.avail_out===0?at:V):w.last_lit&&(O(w,!1),w.strm.avail_out===0)?_:U}function wt(w,W){for(var L,x,C;;){if(w.lookahead<J){if(Ct(w),w.lookahead<J&&W===h)return _;if(w.lookahead===0)break}if(L=0,w.lookahead>=P&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+P-1])&w.hash_mask,L=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=P-1,L!==0&&w.prev_length<w.max_lazy_match&&w.strstart-L<=w.w_size-J&&(w.match_length=K(w,L),w.match_length<=5&&(w.strategy===1||w.match_length===P&&4096<w.strstart-w.match_start)&&(w.match_length=P-1)),w.prev_length>=P&&w.match_length<=w.prev_length){for(C=w.strstart+w.lookahead-P,x=o._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-P),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=C&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+P-1])&w.hash_mask,L=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=P-1,w.strstart++,x&&(O(w,!1),w.strm.avail_out===0))return _}else if(w.match_available){if((x=o._tr_tally(w,0,w.window[w.strstart-1]))&&O(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return _}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(x=o._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<P-1?w.strstart:P-1,W===g?(O(w,!0),w.strm.avail_out===0?at:V):w.last_lit&&(O(w,!1),w.strm.avail_out===0)?_:U}function $t(w,W,L,x,C){this.good_length=w,this.max_lazy=W,this.nice_length=L,this.max_chain=x,this.func=C}function xt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*A),this.dyn_dtree=new s.Buf16(2*(2*k+1)),this.bl_tree=new s.Buf16(2*(2*N+1)),ct(this.dyn_ltree),ct(this.dyn_dtree),ct(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(I+1),this.heap=new s.Buf16(2*$+1),ct(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*$+1),ct(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pt(w){var W;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=d,(W=w.state).pending=0,W.pending_out=0,W.wrap<0&&(W.wrap=-W.wrap),W.status=W.wrap?E:R,w.adler=W.wrap===2?0:1,W.last_flush=h,o._tr_init(W),u):it(w,m)}function se(w){var W=Pt(w);return W===u&&function(L){L.window_size=2*L.w_size,ct(L.head),L.max_lazy_match=i[L.level].max_lazy,L.good_match=i[L.level].good_length,L.nice_match=i[L.level].nice_length,L.max_chain_length=i[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=P-1,L.match_available=0,L.ins_h=0}(w.state),W}function Yt(w,W,L,x,C,j){if(!w)return m;var H=1;if(W===p&&(W=6),x<0?(H=0,x=-x):15<x&&(H=2,x-=16),C<1||y<C||L!==v||x<8||15<x||W<0||9<W||j<0||b<j)return it(w,m);x===8&&(x=9);var G=new xt;return(w.state=G).strm=w,G.wrap=H,G.gzhead=null,G.w_bits=x,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=C+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+P-1)/P),G.window=new s.Buf8(2*G.w_size),G.head=new s.Buf16(G.hash_size),G.prev=new s.Buf16(G.w_size),G.lit_bufsize=1<<C+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new s.Buf8(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=W,G.strategy=j,G.method=L,se(w)}i=[new $t(0,0,0,0,function(w,W){var L=65535;for(L>w.pending_buf_size-5&&(L=w.pending_buf_size-5);;){if(w.lookahead<=1){if(Ct(w),w.lookahead===0&&W===h)return _;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var x=w.block_start+L;if((w.strstart===0||w.strstart>=x)&&(w.lookahead=w.strstart-x,w.strstart=x,O(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-J&&(O(w,!1),w.strm.avail_out===0))return _}return w.insert=0,W===g?(O(w,!0),w.strm.avail_out===0?at:V):(w.strstart>w.block_start&&(O(w,!1),w.strm.avail_out),_)}),new $t(4,4,8,4,At),new $t(4,5,16,8,At),new $t(4,6,32,32,At),new $t(4,4,16,16,wt),new $t(8,16,32,32,wt),new $t(8,16,128,128,wt),new $t(8,32,128,256,wt),new $t(32,128,258,1024,wt),new $t(32,258,258,4096,wt)],a.deflateInit=function(w,W){return Yt(w,W,v,15,8,0)},a.deflateInit2=Yt,a.deflateReset=se,a.deflateResetKeep=Pt,a.deflateSetHeader=function(w,W){return w&&w.state?w.state.wrap!==2?m:(w.state.gzhead=W,u):m},a.deflate=function(w,W){var L,x,C,j;if(!w||!w.state||5<W||W<0)return w?it(w,m):m;if(x=w.state,!w.output||!w.input&&w.avail_in!==0||x.status===666&&W!==g)return it(w,w.avail_out===0?-5:m);if(x.strm=w,L=x.last_flush,x.last_flush=W,x.status===E)if(x.wrap===2)w.adler=0,st(x,31),st(x,139),st(x,8),x.gzhead?(st(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),st(x,255&x.gzhead.time),st(x,x.gzhead.time>>8&255),st(x,x.gzhead.time>>16&255),st(x,x.gzhead.time>>24&255),st(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),st(x,255&x.gzhead.os),x.gzhead.extra&&x.gzhead.extra.length&&(st(x,255&x.gzhead.extra.length),st(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(w.adler=c(w.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=69):(st(x,0),st(x,0),st(x,0),st(x,0),st(x,0),st(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),st(x,3),x.status=R);else{var H=v+(x.w_bits-8<<4)<<8;H|=(2<=x.strategy||x.level<2?0:x.level<6?1:x.level===6?2:3)<<6,x.strstart!==0&&(H|=32),H+=31-H%31,x.status=R,M(x,H),x.strstart!==0&&(M(x,w.adler>>>16),M(x,65535&w.adler)),w.adler=1}if(x.status===69)if(x.gzhead.extra){for(C=x.pending;x.gzindex<(65535&x.gzhead.extra.length)&&(x.pending!==x.pending_buf_size||(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),z(w),C=x.pending,x.pending!==x.pending_buf_size));)st(x,255&x.gzhead.extra[x.gzindex]),x.gzindex++;x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=73)}else x.status=73;if(x.status===73)if(x.gzhead.name){C=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),z(w),C=x.pending,x.pending===x.pending_buf_size)){j=1;break}j=x.gzindex<x.gzhead.name.length?255&x.gzhead.name.charCodeAt(x.gzindex++):0,st(x,j)}while(j!==0);x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),j===0&&(x.gzindex=0,x.status=91)}else x.status=91;if(x.status===91)if(x.gzhead.comment){C=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),z(w),C=x.pending,x.pending===x.pending_buf_size)){j=1;break}j=x.gzindex<x.gzhead.comment.length?255&x.gzhead.comment.charCodeAt(x.gzindex++):0,st(x,j)}while(j!==0);x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),j===0&&(x.status=103)}else x.status=103;if(x.status===103&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&z(w),x.pending+2<=x.pending_buf_size&&(st(x,255&w.adler),st(x,w.adler>>8&255),w.adler=0,x.status=R)):x.status=R),x.pending!==0){if(z(w),w.avail_out===0)return x.last_flush=-1,u}else if(w.avail_in===0&&Z(W)<=Z(L)&&W!==g)return it(w,-5);if(x.status===666&&w.avail_in!==0)return it(w,-5);if(w.avail_in!==0||x.lookahead!==0||W!==h&&x.status!==666){var G=x.strategy===2?function(B,X){for(var rt;;){if(B.lookahead===0&&(Ct(B),B.lookahead===0)){if(X===h)return _;break}if(B.match_length=0,rt=o._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,rt&&(O(B,!1),B.strm.avail_out===0))return _}return B.insert=0,X===g?(O(B,!0),B.strm.avail_out===0?at:V):B.last_lit&&(O(B,!1),B.strm.avail_out===0)?_:U}(x,W):x.strategy===3?function(B,X){for(var rt,tt,lt,St,_t=B.window;;){if(B.lookahead<=T){if(Ct(B),B.lookahead<=T&&X===h)return _;if(B.lookahead===0)break}if(B.match_length=0,B.lookahead>=P&&0<B.strstart&&(tt=_t[lt=B.strstart-1])===_t[++lt]&&tt===_t[++lt]&&tt===_t[++lt]){St=B.strstart+T;do;while(tt===_t[++lt]&&tt===_t[++lt]&&tt===_t[++lt]&&tt===_t[++lt]&&tt===_t[++lt]&&tt===_t[++lt]&&tt===_t[++lt]&&tt===_t[++lt]&&lt<St);B.match_length=T-(St-lt),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=P?(rt=o._tr_tally(B,1,B.match_length-P),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(rt=o._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),rt&&(O(B,!1),B.strm.avail_out===0))return _}return B.insert=0,X===g?(O(B,!0),B.strm.avail_out===0?at:V):B.last_lit&&(O(B,!1),B.strm.avail_out===0)?_:U}(x,W):i[x.level].func(x,W);if(G!==at&&G!==V||(x.status=666),G===_||G===at)return w.avail_out===0&&(x.last_flush=-1),u;if(G===U&&(W===1?o._tr_align(x):W!==5&&(o._tr_stored_block(x,0,0,!1),W===3&&(ct(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),z(w),w.avail_out===0))return x.last_flush=-1,u}return W!==g?u:x.wrap<=0?1:(x.wrap===2?(st(x,255&w.adler),st(x,w.adler>>8&255),st(x,w.adler>>16&255),st(x,w.adler>>24&255),st(x,255&w.total_in),st(x,w.total_in>>8&255),st(x,w.total_in>>16&255),st(x,w.total_in>>24&255)):(M(x,w.adler>>>16),M(x,65535&w.adler)),z(w),0<x.wrap&&(x.wrap=-x.wrap),x.pending!==0?u:1)},a.deflateEnd=function(w){var W;return w&&w.state?(W=w.state.status)!==E&&W!==69&&W!==73&&W!==91&&W!==103&&W!==R&&W!==666?it(w,m):(w.state=null,W===R?it(w,-3):u):m},a.deflateSetDictionary=function(w,W){var L,x,C,j,H,G,B,X,rt=W.length;if(!w||!w.state||(j=(L=w.state).wrap)===2||j===1&&L.status!==E||L.lookahead)return m;for(j===1&&(w.adler=l(w.adler,W,rt,0)),L.wrap=0,rt>=L.w_size&&(j===0&&(ct(L.head),L.strstart=0,L.block_start=0,L.insert=0),X=new s.Buf8(L.w_size),s.arraySet(X,W,rt-L.w_size,L.w_size,0),W=X,rt=L.w_size),H=w.avail_in,G=w.next_in,B=w.input,w.avail_in=rt,w.next_in=0,w.input=W,Ct(L);L.lookahead>=P;){for(x=L.strstart,C=L.lookahead-(P-1);L.ins_h=(L.ins_h<<L.hash_shift^L.window[x+P-1])&L.hash_mask,L.prev[x&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=x,x++,--C;);L.strstart=x,L.lookahead=P-1,Ct(L)}return L.strstart+=L.lookahead,L.block_start=L.strstart,L.insert=L.lookahead,L.lookahead=0,L.match_length=L.prev_length=P-1,L.match_available=0,w.next_in=G,w.input=B,w.avail_in=H,L.wrap=j,u},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,a){n.exports=function(i,s){var o,l,c,f,h,g,u,m,p,b,d,v,y,$,k,N,A,I,P,T,J,E,R,_,U;o=i.state,l=i.next_in,_=i.input,c=l+(i.avail_in-5),f=i.next_out,U=i.output,h=f-(s-i.avail_out),g=f+(i.avail_out-257),u=o.dmax,m=o.wsize,p=o.whave,b=o.wnext,d=o.window,v=o.hold,y=o.bits,$=o.lencode,k=o.distcode,N=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;t:do{y<15&&(v+=_[l++]<<y,y+=8,v+=_[l++]<<y,y+=8),I=$[v&N];e:for(;;){if(v>>>=P=I>>>24,y-=P,(P=I>>>16&255)===0)U[f++]=65535&I;else{if(!(16&P)){if(!(64&P)){I=$[(65535&I)+(v&(1<<P)-1)];continue e}if(32&P){o.mode=12;break t}i.msg="invalid literal/length code",o.mode=30;break t}T=65535&I,(P&=15)&&(y<P&&(v+=_[l++]<<y,y+=8),T+=v&(1<<P)-1,v>>>=P,y-=P),y<15&&(v+=_[l++]<<y,y+=8,v+=_[l++]<<y,y+=8),I=k[v&A];n:for(;;){if(v>>>=P=I>>>24,y-=P,!(16&(P=I>>>16&255))){if(!(64&P)){I=k[(65535&I)+(v&(1<<P)-1)];continue n}i.msg="invalid distance code",o.mode=30;break t}if(J=65535&I,y<(P&=15)&&(v+=_[l++]<<y,(y+=8)<P&&(v+=_[l++]<<y,y+=8)),u<(J+=v&(1<<P)-1)){i.msg="invalid distance too far back",o.mode=30;break t}if(v>>>=P,y-=P,(P=f-h)<J){if(p<(P=J-P)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break t}if(R=d,(E=0)===b){if(E+=m-P,P<T){for(T-=P;U[f++]=d[E++],--P;);E=f-J,R=U}}else if(b<P){if(E+=m+b-P,(P-=b)<T){for(T-=P;U[f++]=d[E++],--P;);if(E=0,b<T){for(T-=P=b;U[f++]=d[E++],--P;);E=f-J,R=U}}}else if(E+=b-P,P<T){for(T-=P;U[f++]=d[E++],--P;);E=f-J,R=U}for(;2<T;)U[f++]=R[E++],U[f++]=R[E++],U[f++]=R[E++],T-=3;T&&(U[f++]=R[E++],1<T&&(U[f++]=R[E++]))}else{for(E=f-J;U[f++]=U[E++],U[f++]=U[E++],U[f++]=U[E++],2<(T-=3););T&&(U[f++]=U[E++],1<T&&(U[f++]=U[E++]))}break}}break}}while(l<c&&f<g);l-=T=y>>3,v&=(1<<(y-=T<<3))-1,i.next_in=l,i.next_out=f,i.avail_in=l<c?c-l+5:5-(l-c),i.avail_out=f<g?g-f+257:257-(f-g),o.hold=v,o.bits=y}},{}],49:[function(e,n,a){var i=e("../utils/common"),s=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),f=1,h=2,g=0,u=-2,m=1,p=852,b=592;function d(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(E){var R;return E&&E.state?(R=E.state,E.total_in=E.total_out=R.total=0,E.msg="",R.wrap&&(E.adler=1&R.wrap),R.mode=m,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new i.Buf32(p),R.distcode=R.distdyn=new i.Buf32(b),R.sane=1,R.back=-1,g):u}function $(E){var R;return E&&E.state?((R=E.state).wsize=0,R.whave=0,R.wnext=0,y(E)):u}function k(E,R){var _,U;return E&&E.state?(U=E.state,R<0?(_=0,R=-R):(_=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?u:(U.window!==null&&U.wbits!==R&&(U.window=null),U.wrap=_,U.wbits=R,$(E))):u}function N(E,R){var _,U;return E?(U=new v,(E.state=U).window=null,(_=k(E,R))!==g&&(E.state=null),_):u}var A,I,P=!0;function T(E){if(P){var R;for(A=new i.Buf32(512),I=new i.Buf32(32),R=0;R<144;)E.lens[R++]=8;for(;R<256;)E.lens[R++]=9;for(;R<280;)E.lens[R++]=7;for(;R<288;)E.lens[R++]=8;for(c(f,E.lens,0,288,A,0,E.work,{bits:9}),R=0;R<32;)E.lens[R++]=5;c(h,E.lens,0,32,I,0,E.work,{bits:5}),P=!1}E.lencode=A,E.lenbits=9,E.distcode=I,E.distbits=5}function J(E,R,_,U){var at,V=E.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new i.Buf8(V.wsize)),U>=V.wsize?(i.arraySet(V.window,R,_-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(U<(at=V.wsize-V.wnext)&&(at=U),i.arraySet(V.window,R,_-U,at,V.wnext),(U-=at)?(i.arraySet(V.window,R,_-U,U,0),V.wnext=U,V.whave=V.wsize):(V.wnext+=at,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=at))),0}a.inflateReset=$,a.inflateReset2=k,a.inflateResetKeep=y,a.inflateInit=function(E){return N(E,15)},a.inflateInit2=N,a.inflate=function(E,R){var _,U,at,V,it,Z,ct,z,O,st,M,K,Ct,At,wt,$t,xt,Pt,se,Yt,w,W,L,x,C=0,j=new i.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return u;(_=E.state).mode===12&&(_.mode=13),it=E.next_out,at=E.output,ct=E.avail_out,V=E.next_in,U=E.input,Z=E.avail_in,z=_.hold,O=_.bits,st=Z,M=ct,W=g;t:for(;;)switch(_.mode){case m:if(_.wrap===0){_.mode=13;break}for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(2&_.wrap&&z===35615){j[_.check=0]=255&z,j[1]=z>>>8&255,_.check=o(_.check,j,2,0),O=z=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&z)<<8)+(z>>8))%31){E.msg="incorrect header check",_.mode=30;break}if((15&z)!=8){E.msg="unknown compression method",_.mode=30;break}if(O-=4,w=8+(15&(z>>>=4)),_.wbits===0)_.wbits=w;else if(w>_.wbits){E.msg="invalid window size",_.mode=30;break}_.dmax=1<<w,E.adler=_.check=1,_.mode=512&z?10:12,O=z=0;break;case 2:for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(_.flags=z,(255&_.flags)!=8){E.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){E.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=z>>8&1),512&_.flags&&(j[0]=255&z,j[1]=z>>>8&255,_.check=o(_.check,j,2,0)),O=z=0,_.mode=3;case 3:for(;O<32;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.head&&(_.head.time=z),512&_.flags&&(j[0]=255&z,j[1]=z>>>8&255,j[2]=z>>>16&255,j[3]=z>>>24&255,_.check=o(_.check,j,4,0)),O=z=0,_.mode=4;case 4:for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.head&&(_.head.xflags=255&z,_.head.os=z>>8),512&_.flags&&(j[0]=255&z,j[1]=z>>>8&255,_.check=o(_.check,j,2,0)),O=z=0,_.mode=5;case 5:if(1024&_.flags){for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.length=z,_.head&&(_.head.extra_len=z),512&_.flags&&(j[0]=255&z,j[1]=z>>>8&255,_.check=o(_.check,j,2,0)),O=z=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(Z<(K=_.length)&&(K=Z),K&&(_.head&&(w=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),i.arraySet(_.head.extra,U,V,K,w)),512&_.flags&&(_.check=o(_.check,U,K,V)),Z-=K,V+=K,_.length-=K),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(Z===0)break t;for(K=0;w=U[V+K++],_.head&&w&&_.length<65536&&(_.head.name+=String.fromCharCode(w)),w&&K<Z;);if(512&_.flags&&(_.check=o(_.check,U,K,V)),Z-=K,V+=K,w)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(Z===0)break t;for(K=0;w=U[V+K++],_.head&&w&&_.length<65536&&(_.head.comment+=String.fromCharCode(w)),w&&K<Z;);if(512&_.flags&&(_.check=o(_.check,U,K,V)),Z-=K,V+=K,w)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(z!==(65535&_.check)){E.msg="header crc mismatch",_.mode=30;break}O=z=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),E.adler=_.check=0,_.mode=12;break;case 10:for(;O<32;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}E.adler=_.check=d(z),O=z=0,_.mode=11;case 11:if(_.havedict===0)return E.next_out=it,E.avail_out=ct,E.next_in=V,E.avail_in=Z,_.hold=z,_.bits=O,2;E.adler=_.check=1,_.mode=12;case 12:if(R===5||R===6)break t;case 13:if(_.last){z>>>=7&O,O-=7&O,_.mode=27;break}for(;O<3;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}switch(_.last=1&z,O-=1,3&(z>>>=1)){case 0:_.mode=14;break;case 1:if(T(_),_.mode=20,R!==6)break;z>>>=2,O-=2;break t;case 2:_.mode=17;break;case 3:E.msg="invalid block type",_.mode=30}z>>>=2,O-=2;break;case 14:for(z>>>=7&O,O-=7&O;O<32;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if((65535&z)!=(z>>>16^65535)){E.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&z,O=z=0,_.mode=15,R===6)break t;case 15:_.mode=16;case 16:if(K=_.length){if(Z<K&&(K=Z),ct<K&&(K=ct),K===0)break t;i.arraySet(at,U,V,K,it),Z-=K,V+=K,ct-=K,it+=K,_.length-=K;break}_.mode=12;break;case 17:for(;O<14;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(_.nlen=257+(31&z),z>>>=5,O-=5,_.ndist=1+(31&z),z>>>=5,O-=5,_.ncode=4+(15&z),z>>>=4,O-=4,286<_.nlen||30<_.ndist){E.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;O<3;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.lens[H[_.have++]]=7&z,z>>>=3,O-=3}for(;_.have<19;)_.lens[H[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,L={bits:_.lenbits},W=c(0,_.lens,0,19,_.lencode,0,_.work,L),_.lenbits=L.bits,W){E.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;$t=(C=_.lencode[z&(1<<_.lenbits)-1])>>>16&255,xt=65535&C,!((wt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(xt<16)z>>>=wt,O-=wt,_.lens[_.have++]=xt;else{if(xt===16){for(x=wt+2;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(z>>>=wt,O-=wt,_.have===0){E.msg="invalid bit length repeat",_.mode=30;break}w=_.lens[_.have-1],K=3+(3&z),z>>>=2,O-=2}else if(xt===17){for(x=wt+3;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}O-=wt,w=0,K=3+(7&(z>>>=wt)),z>>>=3,O-=3}else{for(x=wt+7;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}O-=wt,w=0,K=11+(127&(z>>>=wt)),z>>>=7,O-=7}if(_.have+K>_.nlen+_.ndist){E.msg="invalid bit length repeat",_.mode=30;break}for(;K--;)_.lens[_.have++]=w}}if(_.mode===30)break;if(_.lens[256]===0){E.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,L={bits:_.lenbits},W=c(f,_.lens,0,_.nlen,_.lencode,0,_.work,L),_.lenbits=L.bits,W){E.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,L={bits:_.distbits},W=c(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,L),_.distbits=L.bits,W){E.msg="invalid distances set",_.mode=30;break}if(_.mode=20,R===6)break t;case 20:_.mode=21;case 21:if(6<=Z&&258<=ct){E.next_out=it,E.avail_out=ct,E.next_in=V,E.avail_in=Z,_.hold=z,_.bits=O,l(E,M),it=E.next_out,at=E.output,ct=E.avail_out,V=E.next_in,U=E.input,Z=E.avail_in,z=_.hold,O=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;$t=(C=_.lencode[z&(1<<_.lenbits)-1])>>>16&255,xt=65535&C,!((wt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if($t&&!(240&$t)){for(Pt=wt,se=$t,Yt=xt;$t=(C=_.lencode[Yt+((z&(1<<Pt+se)-1)>>Pt)])>>>16&255,xt=65535&C,!(Pt+(wt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}z>>>=Pt,O-=Pt,_.back+=Pt}if(z>>>=wt,O-=wt,_.back+=wt,_.length=xt,$t===0){_.mode=26;break}if(32&$t){_.back=-1,_.mode=12;break}if(64&$t){E.msg="invalid literal/length code",_.mode=30;break}_.extra=15&$t,_.mode=22;case 22:if(_.extra){for(x=_.extra;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.length+=z&(1<<_.extra)-1,z>>>=_.extra,O-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;$t=(C=_.distcode[z&(1<<_.distbits)-1])>>>16&255,xt=65535&C,!((wt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(!(240&$t)){for(Pt=wt,se=$t,Yt=xt;$t=(C=_.distcode[Yt+((z&(1<<Pt+se)-1)>>Pt)])>>>16&255,xt=65535&C,!(Pt+(wt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}z>>>=Pt,O-=Pt,_.back+=Pt}if(z>>>=wt,O-=wt,_.back+=wt,64&$t){E.msg="invalid distance code",_.mode=30;break}_.offset=xt,_.extra=15&$t,_.mode=24;case 24:if(_.extra){for(x=_.extra;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.offset+=z&(1<<_.extra)-1,z>>>=_.extra,O-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){E.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ct===0)break t;if(K=M-ct,_.offset>K){if((K=_.offset-K)>_.whave&&_.sane){E.msg="invalid distance too far back",_.mode=30;break}Ct=K>_.wnext?(K-=_.wnext,_.wsize-K):_.wnext-K,K>_.length&&(K=_.length),At=_.window}else At=at,Ct=it-_.offset,K=_.length;for(ct<K&&(K=ct),ct-=K,_.length-=K;at[it++]=At[Ct++],--K;);_.length===0&&(_.mode=21);break;case 26:if(ct===0)break t;at[it++]=_.length,ct--,_.mode=21;break;case 27:if(_.wrap){for(;O<32;){if(Z===0)break t;Z--,z|=U[V++]<<O,O+=8}if(M-=ct,E.total_out+=M,_.total+=M,M&&(E.adler=_.check=_.flags?o(_.check,at,M,it-M):s(_.check,at,M,it-M)),M=ct,(_.flags?z:d(z))!==_.check){E.msg="incorrect data check",_.mode=30;break}O=z=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;O<32;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(z!==(4294967295&_.total)){E.msg="incorrect length check",_.mode=30;break}O=z=0}_.mode=29;case 29:W=1;break t;case 30:W=-3;break t;case 31:return-4;case 32:default:return u}return E.next_out=it,E.avail_out=ct,E.next_in=V,E.avail_in=Z,_.hold=z,_.bits=O,(_.wsize||M!==E.avail_out&&_.mode<30&&(_.mode<27||R!==4))&&J(E,E.output,E.next_out,M-E.avail_out)?(_.mode=31,-4):(st-=E.avail_in,M-=E.avail_out,E.total_in+=st,E.total_out+=M,_.total+=M,_.wrap&&M&&(E.adler=_.check=_.flags?o(_.check,at,M,E.next_out-M):s(_.check,at,M,E.next_out-M)),E.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(st==0&&M===0||R===4)&&W===g&&(W=-5),W)},a.inflateEnd=function(E){if(!E||!E.state)return u;var R=E.state;return R.window&&(R.window=null),E.state=null,g},a.inflateGetHeader=function(E,R){var _;return E&&E.state&&2&(_=E.state).wrap?((_.head=R).done=!1,g):u},a.inflateSetDictionary=function(E,R){var _,U=R.length;return E&&E.state?(_=E.state).wrap!==0&&_.mode!==11?u:_.mode===11&&s(1,R,U,0)!==_.check?-3:J(E,R,U,U)?(_.mode=31,-4):(_.havedict=1,g):u},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,a){var i=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,h,g,u,m,p,b,d){var v,y,$,k,N,A,I,P,T,J=d.bits,E=0,R=0,_=0,U=0,at=0,V=0,it=0,Z=0,ct=0,z=0,O=null,st=0,M=new i.Buf16(16),K=new i.Buf16(16),Ct=null,At=0;for(E=0;E<=15;E++)M[E]=0;for(R=0;R<u;R++)M[h[g+R]]++;for(at=J,U=15;1<=U&&M[U]===0;U--);if(U<at&&(at=U),U===0)return m[p++]=20971520,m[p++]=20971520,d.bits=1,0;for(_=1;_<U&&M[_]===0;_++);for(at<_&&(at=_),E=Z=1;E<=15;E++)if(Z<<=1,(Z-=M[E])<0)return-1;if(0<Z&&(f===0||U!==1))return-1;for(K[1]=0,E=1;E<15;E++)K[E+1]=K[E]+M[E];for(R=0;R<u;R++)h[g+R]!==0&&(b[K[h[g+R]]++]=R);if(A=f===0?(O=Ct=b,19):f===1?(O=s,st-=257,Ct=o,At-=257,256):(O=l,Ct=c,-1),E=_,N=p,it=R=z=0,$=-1,k=(ct=1<<(V=at))-1,f===1&&852<ct||f===2&&592<ct)return 1;for(;;){for(I=E-it,T=b[R]<A?(P=0,b[R]):b[R]>A?(P=Ct[At+b[R]],O[st+b[R]]):(P=96,0),v=1<<E-it,_=y=1<<V;m[N+(z>>it)+(y-=v)]=I<<24|P<<16|T|0,y!==0;);for(v=1<<E-1;z&v;)v>>=1;if(v!==0?(z&=v-1,z+=v):z=0,R++,--M[E]==0){if(E===U)break;E=h[g+b[R]]}if(at<E&&(z&k)!==$){for(it===0&&(it=at),N+=_,Z=1<<(V=E-it);V+it<U&&!((Z-=M[V+it])<=0);)V++,Z<<=1;if(ct+=1<<V,f===1&&852<ct||f===2&&592<ct)return 1;m[$=z&k]=at<<24|V<<16|N-p|0}}return z!==0&&(m[N+z]=E-it<<24|64<<16|0),d.bits=at,0}},{"../utils/common":41}],51:[function(e,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,a){var i=e("../utils/common"),s=0,o=1;function l(C){for(var j=C.length;0<=--j;)C[j]=0}var c=0,f=29,h=256,g=h+1+f,u=30,m=19,p=2*g+1,b=15,d=16,v=7,y=256,$=16,k=17,N=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(g+2));l(J);var E=new Array(2*u);l(E);var R=new Array(512);l(R);var _=new Array(256);l(_);var U=new Array(f);l(U);var at,V,it,Z=new Array(u);function ct(C,j,H,G,B){this.static_tree=C,this.extra_bits=j,this.extra_base=H,this.elems=G,this.max_length=B,this.has_stree=C&&C.length}function z(C,j){this.dyn_tree=C,this.max_code=0,this.stat_desc=j}function O(C){return C<256?R[C]:R[256+(C>>>7)]}function st(C,j){C.pending_buf[C.pending++]=255&j,C.pending_buf[C.pending++]=j>>>8&255}function M(C,j,H){C.bi_valid>d-H?(C.bi_buf|=j<<C.bi_valid&65535,st(C,C.bi_buf),C.bi_buf=j>>d-C.bi_valid,C.bi_valid+=H-d):(C.bi_buf|=j<<C.bi_valid&65535,C.bi_valid+=H)}function K(C,j,H){M(C,H[2*j],H[2*j+1])}function Ct(C,j){for(var H=0;H|=1&C,C>>>=1,H<<=1,0<--j;);return H>>>1}function At(C,j,H){var G,B,X=new Array(b+1),rt=0;for(G=1;G<=b;G++)X[G]=rt=rt+H[G-1]<<1;for(B=0;B<=j;B++){var tt=C[2*B+1];tt!==0&&(C[2*B]=Ct(X[tt]++,tt))}}function wt(C){var j;for(j=0;j<g;j++)C.dyn_ltree[2*j]=0;for(j=0;j<u;j++)C.dyn_dtree[2*j]=0;for(j=0;j<m;j++)C.bl_tree[2*j]=0;C.dyn_ltree[2*y]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0}function $t(C){8<C.bi_valid?st(C,C.bi_buf):0<C.bi_valid&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0}function xt(C,j,H,G){var B=2*j,X=2*H;return C[B]<C[X]||C[B]===C[X]&&G[j]<=G[H]}function Pt(C,j,H){for(var G=C.heap[H],B=H<<1;B<=C.heap_len&&(B<C.heap_len&&xt(j,C.heap[B+1],C.heap[B],C.depth)&&B++,!xt(j,G,C.heap[B],C.depth));)C.heap[H]=C.heap[B],H=B,B<<=1;C.heap[H]=G}function se(C,j,H){var G,B,X,rt,tt=0;if(C.last_lit!==0)for(;G=C.pending_buf[C.d_buf+2*tt]<<8|C.pending_buf[C.d_buf+2*tt+1],B=C.pending_buf[C.l_buf+tt],tt++,G===0?K(C,B,j):(K(C,(X=_[B])+h+1,j),(rt=A[X])!==0&&M(C,B-=U[X],rt),K(C,X=O(--G),H),(rt=I[X])!==0&&M(C,G-=Z[X],rt)),tt<C.last_lit;);K(C,y,j)}function Yt(C,j){var H,G,B,X=j.dyn_tree,rt=j.stat_desc.static_tree,tt=j.stat_desc.has_stree,lt=j.stat_desc.elems,St=-1;for(C.heap_len=0,C.heap_max=p,H=0;H<lt;H++)X[2*H]!==0?(C.heap[++C.heap_len]=St=H,C.depth[H]=0):X[2*H+1]=0;for(;C.heap_len<2;)X[2*(B=C.heap[++C.heap_len]=St<2?++St:0)]=1,C.depth[B]=0,C.opt_len--,tt&&(C.static_len-=rt[2*B+1]);for(j.max_code=St,H=C.heap_len>>1;1<=H;H--)Pt(C,X,H);for(B=lt;H=C.heap[1],C.heap[1]=C.heap[C.heap_len--],Pt(C,X,1),G=C.heap[1],C.heap[--C.heap_max]=H,C.heap[--C.heap_max]=G,X[2*B]=X[2*H]+X[2*G],C.depth[B]=(C.depth[H]>=C.depth[G]?C.depth[H]:C.depth[G])+1,X[2*H+1]=X[2*G+1]=B,C.heap[1]=B++,Pt(C,X,1),2<=C.heap_len;);C.heap[--C.heap_max]=C.heap[1],function(_t,Zt){var Y,ft,yt,ht,Ot,jt,It=Zt.dyn_tree,Ce=Zt.max_code,oe=Zt.stat_desc.static_tree,Tt=Zt.stat_desc.has_stree,Ne=Zt.stat_desc.extra_bits,qt=Zt.stat_desc.extra_base,Kt=Zt.stat_desc.max_length,Ae=0;for(ht=0;ht<=b;ht++)_t.bl_count[ht]=0;for(It[2*_t.heap[_t.heap_max]+1]=0,Y=_t.heap_max+1;Y<p;Y++)Kt<(ht=It[2*It[2*(ft=_t.heap[Y])+1]+1]+1)&&(ht=Kt,Ae++),It[2*ft+1]=ht,Ce<ft||(_t.bl_count[ht]++,Ot=0,qt<=ft&&(Ot=Ne[ft-qt]),jt=It[2*ft],_t.opt_len+=jt*(ht+Ot),Tt&&(_t.static_len+=jt*(oe[2*ft+1]+Ot)));if(Ae!==0){do{for(ht=Kt-1;_t.bl_count[ht]===0;)ht--;_t.bl_count[ht]--,_t.bl_count[ht+1]+=2,_t.bl_count[Kt]--,Ae-=2}while(0<Ae);for(ht=Kt;ht!==0;ht--)for(ft=_t.bl_count[ht];ft!==0;)Ce<(yt=_t.heap[--Y])||(It[2*yt+1]!==ht&&(_t.opt_len+=(ht-It[2*yt+1])*It[2*yt],It[2*yt+1]=ht),ft--)}}(C,j),At(X,St,C.bl_count)}function w(C,j,H){var G,B,X=-1,rt=j[1],tt=0,lt=7,St=4;for(rt===0&&(lt=138,St=3),j[2*(H+1)+1]=65535,G=0;G<=H;G++)B=rt,rt=j[2*(G+1)+1],++tt<lt&&B===rt||(tt<St?C.bl_tree[2*B]+=tt:B!==0?(B!==X&&C.bl_tree[2*B]++,C.bl_tree[2*$]++):tt<=10?C.bl_tree[2*k]++:C.bl_tree[2*N]++,X=B,St=(tt=0)===rt?(lt=138,3):B===rt?(lt=6,3):(lt=7,4))}function W(C,j,H){var G,B,X=-1,rt=j[1],tt=0,lt=7,St=4;for(rt===0&&(lt=138,St=3),G=0;G<=H;G++)if(B=rt,rt=j[2*(G+1)+1],!(++tt<lt&&B===rt)){if(tt<St)for(;K(C,B,C.bl_tree),--tt!=0;);else B!==0?(B!==X&&(K(C,B,C.bl_tree),tt--),K(C,$,C.bl_tree),M(C,tt-3,2)):tt<=10?(K(C,k,C.bl_tree),M(C,tt-3,3)):(K(C,N,C.bl_tree),M(C,tt-11,7));X=B,St=(tt=0)===rt?(lt=138,3):B===rt?(lt=6,3):(lt=7,4)}}l(Z);var L=!1;function x(C,j,H,G){M(C,(c<<1)+(G?1:0),3),function(B,X,rt,tt){$t(B),st(B,rt),st(B,~rt),i.arraySet(B.pending_buf,B.window,X,rt,B.pending),B.pending+=rt}(C,j,H)}a._tr_init=function(C){L||(function(){var j,H,G,B,X,rt=new Array(b+1);for(B=G=0;B<f-1;B++)for(U[B]=G,j=0;j<1<<A[B];j++)_[G++]=B;for(_[G-1]=B,B=X=0;B<16;B++)for(Z[B]=X,j=0;j<1<<I[B];j++)R[X++]=B;for(X>>=7;B<u;B++)for(Z[B]=X<<7,j=0;j<1<<I[B]-7;j++)R[256+X++]=B;for(H=0;H<=b;H++)rt[H]=0;for(j=0;j<=143;)J[2*j+1]=8,j++,rt[8]++;for(;j<=255;)J[2*j+1]=9,j++,rt[9]++;for(;j<=279;)J[2*j+1]=7,j++,rt[7]++;for(;j<=287;)J[2*j+1]=8,j++,rt[8]++;for(At(J,g+1,rt),j=0;j<u;j++)E[2*j+1]=5,E[2*j]=Ct(j,5);at=new ct(J,A,h+1,g,b),V=new ct(E,I,0,u,b),it=new ct(new Array(0),P,0,m,v)}(),L=!0),C.l_desc=new z(C.dyn_ltree,at),C.d_desc=new z(C.dyn_dtree,V),C.bl_desc=new z(C.bl_tree,it),C.bi_buf=0,C.bi_valid=0,wt(C)},a._tr_stored_block=x,a._tr_flush_block=function(C,j,H,G){var B,X,rt=0;0<C.level?(C.strm.data_type===2&&(C.strm.data_type=function(tt){var lt,St=4093624447;for(lt=0;lt<=31;lt++,St>>>=1)if(1&St&&tt.dyn_ltree[2*lt]!==0)return s;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return o;for(lt=32;lt<h;lt++)if(tt.dyn_ltree[2*lt]!==0)return o;return s}(C)),Yt(C,C.l_desc),Yt(C,C.d_desc),rt=function(tt){var lt;for(w(tt,tt.dyn_ltree,tt.l_desc.max_code),w(tt,tt.dyn_dtree,tt.d_desc.max_code),Yt(tt,tt.bl_desc),lt=m-1;3<=lt&&tt.bl_tree[2*T[lt]+1]===0;lt--);return tt.opt_len+=3*(lt+1)+5+5+4,lt}(C),B=C.opt_len+3+7>>>3,(X=C.static_len+3+7>>>3)<=B&&(B=X)):B=X=H+5,H+4<=B&&j!==-1?x(C,j,H,G):C.strategy===4||X===B?(M(C,2+(G?1:0),3),se(C,J,E)):(M(C,4+(G?1:0),3),function(tt,lt,St,_t){var Zt;for(M(tt,lt-257,5),M(tt,St-1,5),M(tt,_t-4,4),Zt=0;Zt<_t;Zt++)M(tt,tt.bl_tree[2*T[Zt]+1],3);W(tt,tt.dyn_ltree,lt-1),W(tt,tt.dyn_dtree,St-1)}(C,C.l_desc.max_code+1,C.d_desc.max_code+1,rt+1),se(C,C.dyn_ltree,C.dyn_dtree)),wt(C),G&&$t(C)},a._tr_tally=function(C,j,H){return C.pending_buf[C.d_buf+2*C.last_lit]=j>>>8&255,C.pending_buf[C.d_buf+2*C.last_lit+1]=255&j,C.pending_buf[C.l_buf+C.last_lit]=255&H,C.last_lit++,j===0?C.dyn_ltree[2*H]++:(C.matches++,j--,C.dyn_ltree[2*(_[H]+h+1)]++,C.dyn_dtree[2*O(j)]++),C.last_lit===C.lit_bufsize-1},a._tr_align=function(C){M(C,2,3),K(C,y,J),function(j){j.bi_valid===16?(st(j,j.bi_buf),j.bi_buf=0,j.bi_valid=0):8<=j.bi_valid&&(j.pending_buf[j.pending++]=255&j.bi_buf,j.bi_buf>>=8,j.bi_valid-=8)}(C)}},{"../utils/common":41}],53:[function(e,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,a){(function(i){(function(s,o){if(!s.setImmediate){var l,c,f,h,g=1,u={},m=!1,p=s.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(s);b=b&&b.setTimeout?b:s,l={}.toString.call(s.process)==="[object process]"?function($){process.nextTick(function(){v($)})}:function(){if(s.postMessage&&!s.importScripts){var $=!0,k=s.onmessage;return s.onmessage=function(){$=!1},s.postMessage("","*"),s.onmessage=k,$}}()?(h="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",y,!1):s.attachEvent("onmessage",y),function($){s.postMessage(h+$,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function($){v($.data)},function($){f.port2.postMessage($)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function($){var k=p.createElement("script");k.onreadystatechange=function(){v($),k.onreadystatechange=null,c.removeChild(k),k=null},c.appendChild(k)}):function($){setTimeout(v,0,$)},b.setImmediate=function($){typeof $!="function"&&($=new Function(""+$));for(var k=new Array(arguments.length-1),N=0;N<k.length;N++)k[N]=arguments[N+1];var A={callback:$,args:k};return u[g]=A,l(g),g++},b.clearImmediate=d}function d($){delete u[$]}function v($){if(m)setTimeout(v,0,$);else{var k=u[$];if(k){m=!0;try{(function(N){var A=N.callback,I=N.args;switch(I.length){case 0:A();break;case 1:A(I[0]);break;case 2:A(I[0],I[1]);break;case 3:A(I[0],I[1],I[2]);break;default:A.apply(o,I)}})(k)}finally{d($),m=!1}}}}function y($){$.source===s&&typeof $.data=="string"&&$.data.indexOf(h)===0&&v(+$.data.slice(h.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(qr);var Wa=qr.exports;const ar=Ua(Wa);class Ha{constructor(t,e){this.app=t,this.settings=e}get maxBackups(){var t;return((t=this.settings)==null?void 0:t.maxBackups)??5}get maxBackupAgeDays(){var t;return((t=this.settings)==null?void 0:t.maxBackupAgeDays)??30}async willExceedMaxBackups(t,e,n){const i=(await this.listBackups(t,e,n)).length,s=(n==null?void 0:n.maxBackups)??5,o=i+1;return o>s?o-s:0}async cleanupExcessBackups(t,e,n){const a=await this.listBackups(t,e,n),i=(n==null?void 0:n.maxBackups)??5;F(`${S} cleanupExcessBackups: found ${a.length} backups, max allowed: ${i}`);let s=0;if(a.length>i)for(let o=i;o<a.length;o++)F(`${S} cleanupExcessBackups: deleting backup ${o+1}/${a.length}`),await this.deleteBackup(t,e,a[o],n)&&s++;return F(`${S} cleanupExcessBackups: deleted ${s} backups`),s}async createBackup(t,e,n){try{const a=this.app.vault.getAbstractFileByPath(t);if(!a||!(a instanceof D.TFolder))return F(`${S} Draft folder not found: ${t}`),!1;const i=this.getAllFilesInFolder(a);if(i.length===0)return F(`${S} No files to backup in: ${t}`),!1;const s=t.split("/")[0]||"unknown",o=t.split("/")[1]||"drafts",l=`${Ue(n)}/${s}/${o}/${e}`;await this.app.vault.adapter.exists(l)||await this.app.vault.createFolder(l);const h=`${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}${Le}`,g=`${l}/${h}`,u=new ar;for(const b of i){const d=b.path.substring(t.length+1),v=await this.app.vault.read(b);u.file(d,v)}const m=await u.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}),p=new Uint8Array(m).buffer;return await this.app.vault.createBinary(g,p),F(`${S} Created backup: ${g}`),!0}catch(a){return F(`${S} Failed to create backup:`,a),!1}}async listBackups(t,e,n){F(`${S} listBackups called for draftFolder: ${t}, draftId: ${e}`);try{const a=t.split("/")[0]||"unknown",i=t.split("/")[1]||"drafts",s=`${Ue(n)}/${a}/${i}/${e}`;if(F(`${S} listBackups checking backupDir: ${s}`),!await this.app.vault.adapter.exists(s))return F(`${S} listBackups backupDir does not exist on disk`),[];const l=[];try{const f=await this.app.vault.adapter.list(s);F(`${S} listBackups adapter found ${f.files.length} files, ${f.folders.length} folders`);for(const h of f.files){const g=h.split("/").pop()||"";if(F(`${S} listBackups examining file: ${g}, endsWith .zip: ${g.endsWith(Le)}`),g.endsWith(Le)){const u=g.match(Gr);F(`${S} listBackups match for ${g}: ${(u==null?void 0:u[1])??"no match"}`),u&&l.push(u[1])}}}catch(f){return F(`${S} listBackups error reading backup directory: ${f}`),[]}const c=l.sort().reverse();return F(`${S} listBackups found ${c.length} backups for ${e}: [${c.join(", ")}]`),c}catch(a){return F(`${S} Failed to list backups:`,a),[]}}async restoreBackup(t,e,n,a){F(`${S} restoreBackup called for draftFolder: ${t}, draftId: ${e}, timestamp: ${n}`);try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${Ue(a)}/${i}/${s}/${e}`,l=`${n}${Le}`,c=`${o}/${l}`;if(!await this.app.vault.adapter.stat(c))return F(`${S} Backup file not found: ${c}`),!1;const h=await this.app.vault.adapter.readBinary(c),g=await ar.loadAsync(h);this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);for(const[m,p]of Object.entries(g.files))if(p.dir){const b=`${t}/${m}`;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b)}else{const b=await p.async("text"),d=`${t}/${m}`,v=d.substring(0,d.lastIndexOf("/"));this.app.vault.getAbstractFileByPath(v)||await this.app.vault.createFolder(v);const y=this.app.vault.getAbstractFileByPath(d);y&&y instanceof D.TFile?await this.app.vault.modify(y,b):await this.app.vault.create(d,b)}return F(`${S} Restored backup: ${c}`),!0}catch(i){return F(`${S} Failed to restore backup:`,i),!1}}async deleteBackup(t,e,n,a){F(`${S} deleteBackup called for draftFolder: ${t}, draftId: ${e}, timestamp: ${n}`);try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${Ue(a)}/${i}/${s}/${e}`,l=`${n}${Le}`,c=`${o}/${l}`;return await this.app.vault.adapter.stat(c)?(await this.app.vault.adapter.remove(c),F(`${S} Deleted backup: ${c}`),!0):(F(`${S} Backup file not found for deletion: ${c}`),!1)}catch(i){return F(`${S} Failed to delete backup:`,i),!1}}async clearOldBackups(t,e,n){F(`${S} clearOldBackups called for draftFolder: ${t}, draftId: ${e}`);try{const a=await this.listBackups(t,e,n),i=new Date;i.setDate(i.getDate()-this.maxBackupAgeDays);let s=0;for(const o of a)new Date(o.replace(/-/g,":"))<i&&(await this.deleteBackup(t,e,o,n),s++);F(`${S} clearOldBackups removed ${s} old backups for ${e}`)}catch(a){F(`${S} Failed to clear old backups:`,a)}}getAllFilesInFolder(t){const e=[];function n(a){for(const i of a.children)i instanceof D.TFile?e.push(i):i instanceof D.TFolder&&n(i)}return n(t),e}}class Va{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null}async reorderChapters(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;for(let o=0;o<n.length;o++){const{chapterName:l}=n[o],c=`${s}/${l}${mt}`,f=this.app.vault.getAbstractFileByPath(c);if(f&&f instanceof D.TFile){let h=await this.app.vault.read(f);h.match(zt)&&(h=h.replace(zt,(g,u)=>{let m=u.replace(/^order:.*\n?/gm,"");return m.endsWith(`
`)||(m+=`
`),m+=`order: ${o+1}
`,`${Ft}
${m}${Ft}`}),await this.app.vault.modify(f,h))}}return!0}async listChapters(t,e){F(`${S} ChapterFileService.listChapters: projectPath=${t}, draftName=${e}`);const n=this.resolveProjectPath(t);if(!n)return F(`${S} ChapterFileService.listChapters: no project resolved`),[];const a=this.getDraftsFolderName(n);if(!a)return F(`${S} ChapterFileService.listChapters: no drafts folder found in project ${n}`),[];const i=`${n}/${a}/${e}`;F(`${S} ChapterFileService.listChapters: resolved project=${n}, draftsFolder=${a}, draftFolder=${i}`);const s=this.app.vault.getAbstractFileByPath(i),o=[];if(s&&s instanceof D.TFolder){F(`${S} ChapterFileService.listChapters: found folder with ${s.children.length} children`);for(const l of s.children)l instanceof D.TFile&&l.extension===mt.slice(1)&&(F(`${S} ChapterFileService.listChapters: processing file ${l.path}`),await Ut(async()=>{const c=await this.app.vault.read(l);if(F(`${S} ChapterFileService.listChapters: content length ${c.length}`),!this.isValidChapter(c)){F(`${S} ChapterFileService.listChapters: ${l.path} is not a valid chapter (missing required fields)`);return}const f=c.match(zt);let h,g;if(f){F(`${S} ChapterFileService.listChapters: found frontmatter`);const p=f[1].split(/\r?\n/);for(const b of p){const d=b.match(/^order:\s*(\d+)/i);d&&(h=parseInt(d[1],10));const v=b.match(/^chapter_name:\s*(.*)$/i);if(v){let y=v[1].trim();(y.startsWith('"')&&y.endsWith('"')||y.startsWith("'")&&y.endsWith("'"))&&(y=y.slice(1,-1)),y.length>0&&(g=y)}}}else F(`${S} ChapterFileService.listChapters: no frontmatter`);F(`${S} ChapterFileService.listChapters: parsed order=${h}, chapterName=${g}`);const u=g&&g.length>0?g:l.name.replace(new RegExp(`\\${mt}$`),""),m=typeof h=="number"&&!isNaN(h)?h:0;F(`${S} ChapterFileService.listChapters: adding chapter ${l.name} with name ${u}, order ${m}`),o.push({name:l.name.replace(new RegExp(`\\${mt}$`),""),chapterName:u,order:m})}))}else F(`${S} ChapterFileService.listChapters: no folder found`);return o.sort((l,c)=>l.order-c.order),F(`${S} ChapterFileService.listChapters: returning ${o.length} chapters`),o.map(({name:l,chapterName:c})=>({name:l,chapterName:c}))}async createChapter(t,e,n,a,i){F(`${S} createChapter called: chapterName=${n}, draft=${e}, draftId=${i}`);const s=this.resolveProjectPath(t);if(!s)return F(`${S} createChapter: no project resolved`),!1;const o=this.getDraftsFolderName(s);if(!o)return F(`${S} createChapter: no drafts folder found`),!1;const l=`${s}/${o}/${e}`,f=`${Xt(n,a==null?void 0:a.slugStyle)}${mt}`,h=`${l}/${f}`;if(this.app.vault.getAbstractFileByPath(h))return F(`${S} createChapter: file already exists at ${h}`),!1;let g=0,u=null;const m=this.app.vault.getAbstractFileByPath(l);if(m&&m instanceof D.TFolder)for(const y of m.children)y instanceof D.TFile&&y.extension===mt.slice(1)&&await Ut(async()=>{const $=await this.app.vault.read(y);if(this.isValidChapter($)){const k=$.match(zt);if(k){const N=k[1].split(/\r?\n/);for(const A of N){const I=A.match(/^order:\s*(\d+)/i);if(I){const P=parseInt(I[1],10);!isNaN(P)&&P>g&&(g=P)}if(!u){const P=A.match(/^id:\s*(.+)/i);P&&(u=P[1].trim())}}}}});const p=g+1;let b=`# ${n}`;const d=i||u||Re();let v=`${Ft}
id: ${d}
order: ${p}
chapter_name: ${JSON.stringify(n)}
${Ft}
`;return await this.app.vault.create(h,`${v}${b}

`),F(`${S} createChapter: created ${h} with order ${p}, chapter_name "${n}", and draft id ${d}`),!0}async deleteChapter(t,e,n){F(`${S} deleteChapter called: chapterName=${n}, draft=${e}`);const a=this.resolveProjectPath(t);if(!a)return F(`${S} deleteChapter: no project resolved`),!1;const i=this.getDraftsFolderName(a);if(!i)return F(`${S} deleteChapter: no drafts folder found`),!1;const s=`${a}/${i}/${e}`,o=`${n}${mt}`,l=`${s}/${o}`,c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof D.TFile){await this.app.vault.delete(c);const f=await this.listChapters(t,e);for(let h=0;h<f.length;h++){const{name:g}=f[h],u=`${s}/${g}${mt}`,m=this.app.vault.getAbstractFileByPath(u);if(m&&m instanceof D.TFile){let p=await this.app.vault.read(m);p.match(zt)&&(p=p.replace(zt,(b,d)=>{let v=d.replace(/^order:.*\n?/gm,"");return v.endsWith(`
`)||(v+=`
`),v+=`order: ${h+1}
`,`${Ft}
${v}${Ft}`}),await this.app.vault.modify(m,p))}}return!0}return!1}async renameChapter(t,e,n,a){F(`${S} renameChapter called: ${n} -> ${a}`);const i=this.resolveProjectPath(t);if(!i)return F(`${S} renameChapter: no project resolved`),!1;const s=this.getDraftsFolderName(i);if(!s)return F(`${S} renameChapter: no drafts folder found`),!1;const o=`${i}/${s}/${e}`,l=`${o}/${n}${mt}`,c=`${o}/${a}${mt}`,f=this.app.vault.getAbstractFileByPath(l);if(!f||!(f instanceof D.TFile))return F(`${S} renameChapter: file not found at ${l}`),!1;let h=await this.app.vault.read(f),g=`# ${a}`;return h.match(zt)&&(h=h.replace(zt,(u,m)=>{let p=m.replace(/^chapter_name:.*\n?/gm,"");return p.endsWith(`
`)||(p+=`
`),p+=`chapter_name: ${JSON.stringify(a)}
`,`${Ft}
${p}${Ft}`})),h=h.replace(/^#.*$/m,g),n!==a?(await this.app.vault.create(c,h),await this.app.vault.delete(f)):await this.app.vault.modify(f,h),!0}async openChapter(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}/${n}${mt}`,o=this.app.vault.getAbstractFileByPath(s);return o&&o instanceof D.TFile?(await Ut(async()=>{await this.app.workspace.getLeaf().openFile(o)}),!0):!1}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=Bt((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof D.TFolder){for(const i of e.children)if(i instanceof D.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}hasRequiredChapterFields(t){const e=/^id:\s*\S+/im.test(t),n=/^order:\s*\d+/im.test(t),a=/^chapter_name:\s*\S+/im.test(t);return e&&n&&a}extractChapterMetadata(t){if(!this.hasRequiredChapterFields(t))return null;let e,n,a;const i=t.split(/\r?\n/);for(const s of i){const o=s.match(/^id:\s*(.+?)$/i);o&&(e=o[1].trim());const l=s.match(/^order:\s*(\d+)/i);l&&(n=parseInt(l[1],10));const c=s.match(/^chapter_name:\s*(.*)$/i);if(c){let f=c[1].trim();(f.startsWith('"')&&f.endsWith('"')||f.startsWith("'")&&f.endsWith("'"))&&(f=f.slice(1,-1)),f.length>0&&(a=f)}}return{id:e,order:n,chapterName:a}}isValidChapter(t){const e=t.match(zt);return e?this.hasRequiredChapterFields(e[1]):!1}}class Kr{constructor(t){this.app=t,F(`${S} TemplateService created`)}async render(t,e={}){let n=t||"";return F(`${S} TemplateService.render called with template: "${n.substring(0,100)}${n.length>100?"...":""}", vars:`,Object.keys(e)),!n.includes("{{")&&!n.includes("}}")?(F(`${S} Template doesn't contain template syntax, checking if it's a file path`),await Ut(async()=>{const a=this.app.vault.getAbstractFileByPath(n);a&&a instanceof D.TFile?(F(`${S} Reading template from file: ${n}`),n=await this.app.vault.read(a),F(`${S} Template loaded from file, length: ${n.length} chars`)):F(`${S} Template path "${n}" is not a valid file, treating as inline template`)})):F(`${S} Template contains template syntax, treating as inline template`),F(`${S} Performing template variable substitution`),n=n.replace(/{{\s*(\w+(?:[-:]\w+)*)\s*}}/g,(a,i)=>{if(e[i]!==void 0)return F(`${S} Substituting variable {{${i}}} with provided value: "${e[i]}"`),e[i];try{const s=window.moment().format(i);return F(`${S} Substituting {{${i}}} with moment.js format: "${s}"`),s}catch{return F(`${S} Neither variable nor moment.js format found for {{${i}}}, returning as-is`),i}}),F(`${S} Template rendering complete, result length: ${n.length} chars`),n}}async function ke(r,t){const e=r.vault.getAbstractFileByPath(t);if(!e||!(e instanceof D.TFile))return null;try{const n=await r.vault.read(e);return Za(n)}catch(n){return F(`${S} Error reading meta file:`,n),null}}async function Kn(r,t,e){const n=Ga(e),a=r.vault.getAbstractFileByPath(t);a&&a instanceof D.TFile?await r.vault.modify(a,n):await r.vault.create(t,n)}async function He(r,t,e,n,a){const i=`${t}/${Gt(a)}`;let s=await ke(r,i);s||(s={version:Zr,total_drafts:0});const o=Bt(a),l=r.vault.getAbstractFileByPath(`${t}/${o}`);if(l&&l instanceof D.TFolder){const c=l.children.filter(f=>f instanceof D.TFolder);s.total_drafts=c.length}e!==void 0&&(s.current_active_draft=e,s.active_draft_last_modified=new Date().toISOString()),n&&Object.assign(s,n),s.total_drafts>0&&s.total_word_count&&(s.average_draft_word_count=Math.round(s.total_word_count/s.total_drafts)),await Kn(r,i,s)}function Za(r){const t=r.match(new RegExp(`${Ft}\\s*\\n([\\s\\S]*?)\\n${Ft}`));if(!t)return null;const e=t[1],n={},a=e.split(`
`);for(const i of a){const s=i.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(s){const o=s[1];let l=s[2].trim();/^-?\d+(\.\d+)?$/.test(l)?l=Number(l):(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),n[o]=l}}return n}function Ga(r){const t=[Ft];if(r.version!==void 0&&t.push(`version: "${r.version}"`),r.current_active_draft!==void 0&&t.push(`current_active_draft: "${r.current_active_draft}"`),r.current_draft_word_count!==void 0&&t.push(`current_draft_word_count: ${r.current_draft_word_count}`),t.push(`total_drafts: ${r.total_drafts}`),r.target_word_count!==void 0&&t.push(`target_word_count: ${r.target_word_count}`),r.active_draft_last_modified!==void 0&&t.push(`active_draft_last_modified: "${r.active_draft_last_modified}"`),r.total_word_count!==void 0&&t.push(`total_word_count: ${r.total_word_count}`),r.average_draft_word_count!==void 0&&t.push(`average_draft_word_count: ${r.average_draft_word_count}`),r.project_type!==void 0&&t.push(`project_type: ${r.project_type}`),t.push(Ft),t.push(""),t.push("# Project Statistics"),t.push(""),r.current_active_draft&&t.push(`**Active Draft:** ${r.current_active_draft}`),r.current_draft_word_count!==void 0&&t.push(`**Current Draft Word Count:** ${r.current_draft_word_count.toLocaleString()}`),t.push(`**Total Drafts:** ${r.total_drafts}`),r.target_word_count&&t.push(`**Target Word Count:** ${r.target_word_count.toLocaleString()}`),r.active_draft_last_modified){const e=new Date(r.active_draft_last_modified);t.push(`**Last Modified:** ${e.toLocaleString()}`)}return r.total_word_count&&t.push(`**Total Word Count:** ${r.total_word_count.toLocaleString()}`),r.average_draft_word_count&&t.push(`**Average Draft Word Count:** ${r.average_draft_word_count.toLocaleString()}`),t.push(""),t.join(`
`)}const Un=Object.freeze(Object.defineProperty({__proto__:null,readMetaFile:ke,updateMetaStats:He,writeMetaFile:Kn},Symbol.toStringTag,{value:"Module"}));class gn{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null,this.tpl=new Kr(t),this.projectFileService=new Xn(t,this)}async createProject(t,e,n,a,i){if(F(`${S} createProject called: projectName=${t}, singleFile=${e}`),!t)return F(`${S} createProject: project name is empty`),new D.Notice("Project name is required."),null;const s=a&&a!==""?`${a}/${t}`:t,o=`${s}/${Bt(i)}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);const l=`${s}/${Gt(i)}`;if(!this.app.vault.getAbstractFileByPath(l)){const f=e?Rt.SINGLE:Rt.MULTI,h=e?(i==null?void 0:i.defaultSingleTargetWordCount)??2e4:(i==null?void 0:i.defaultMultiTargetWordCount)??5e4;await He(this.app,s,void 0,{project_type:f,target_word_count:h},i)}const c=n||"Draft 1";return await this.projectFileService.drafts.createDraft(c,void 0,s,i),s}async openProject(t){var s,o;const e=`${t}/${Gt((s=this.manager)==null?void 0:s.settings)}`,n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(n),!0;const a=We((o=this.manager)==null?void 0:o.settings),i=[`${t}/${t}${mt}`,`${t}/Chapter 1${mt}`,`${t}/Chapter 01${mt}`,`${t}/${a}`,`${t}/${Bt()}/Draft 1/${a}`];for(const l of i){const c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(c),!0}return new D.Notice("Could not find a file to open in the project."),!1}listAllFolders(){const t=this.app.vault.getRoot(),e=[""];function n(a){for(const i of a.children)i instanceof D.TFolder&&(e.push(i.path),n(i))}return n(t),e}async listProjects(){const t=this.listAllFolders(),e=t.filter(a=>!!a);F(`${S} allFolders:`,t),F(`${S} filteredFolders:`,e);const n=await Se(e,a=>this.isProjectFolder(a));return F(`${S} found ${e.length} folders, ${n.length} projects:`,n),n}async getProjectType(t){const e=`${t}/${Gt()}`,n=await ke(this.app,e);if(n&&n.project_type){const a=n.project_type;if(Object.values(Rt).includes(a))return a}return null}getDraftsFolder(t){const e=`${t}/${Bt()}`;let n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof D.TFolder)return n;const a=`${t}/Drafts`;return n=this.app.vault.getAbstractFileByPath(a),n&&n instanceof D.TFolder?n:null}async getManuscriptsFolder(t){const e=`${t}/${qn()}`,n=this.app.vault.getAbstractFileByPath(e);return n&&n instanceof D.TFolder?n:null}async isProjectFolder(t){if(!t||typeof t!="string")return F(`${S} isProjectFolder: invalid path`),!1;const e=t.trim().replace(/\\/g,"/").replace(/\/+$/,"");try{const n=D.normalizePath(`${e}/${Gt()}`),a=await this.app.vault.adapter.exists(n),i=D.normalizePath(`${e}/${Bt()}`);let s=await this.app.vault.adapter.exists(i);if(!s){const o=D.normalizePath(`${e}/Drafts`);s=await this.app.vault.adapter.exists(o)}if(!a&&!s)return F(`${S} isProjectFolder ${t}: no meta.md or drafts folder found`),!1;if(a)try{const{readMetaFile:o}=await Promise.resolve().then(()=>Un),{VALID_PROJECT_TYPES:l}=await Promise.resolve().then(()=>Ba),c=await o(this.app,n);if(!c||!l.includes(c.project_type))return!1}catch{return!1}return!0}catch{return!1}}}class Ya{constructor(t,e,n,a){var i,s,o;this.app=t,this.tpl=new Kr(t),this.projectSvc=n,this.backupSvc=a,this.chapters=e,this.manager=((o=(s=(i=this.app.plugins).getPlugin)==null?void 0:s.call(i,"obsidian-writeaid-plugin"))==null?void 0:o.manager)??null}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=Bt((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof D.TFolder){for(const i of e.children)if(i instanceof D.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}async suggestNextDraftName(t){var i;const e=this.resolveProjectPath(t);if(!e)return"Draft 1";const n=`${e}/${Gt((i=this.manager)==null?void 0:i.settings)}`;let a=0;return await Ut(async()=>{const s=await ke(this.app,n);s&&typeof s.total_drafts=="number"&&(a=s.total_drafts)}),`Draft ${a+1}`}async createDraft(t,e,n,a){var h,g,u;F(`${S} createDraft called with draftName: ${t}, copyFromDraft: ${e}`);const i=this.resolveProjectPath(n);if(!i){F(`${S} createDraft: no project path resolved`),new D.Notice("No project folder detected. Please open a folder named after your project.");return}const o=this.getDraftsFolderName(i)||Bt((h=this.manager)==null?void 0:h.settings),l=`${i}/${o}`,c=`${l}/${t}`,f=i.split("/").pop()||i;if(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),e){F(`${S} createDraft: copying from draft ${e}`);const m=`${l}/${e}`,p=this.app.vault.getFiles().filter(v=>v.path.startsWith(m)),d=`${Xt(e,a==null?void 0:a.slugStyle)}${mt}`;for(const v of p){let y=v.path.substring(m.length+1);y===d&&(y=`${Xt(t,a==null?void 0:a.slugStyle)}${mt}`);const $=`${c}/${y}`,k=$.substring(0,$.lastIndexOf("/"));k!==c&&!this.app.vault.getAbstractFileByPath(k)&&await this.app.vault.createFolder(k);let N=await this.app.vault.read(v);N=qa(N,t,f),await this.app.vault.create($,N)}}else{if((a==null?void 0:a.includeDraftOutline)===!0){const b=(a==null?void 0:a.outlineTemplate)??"",d=await this.tpl.render(b,{draftName:t});await this.app.vault.create(`${c}/${We((g=this.manager)==null?void 0:g.settings)}`,d)}if(await this.projectSvc.getProjectType(i)===Rt.SINGLE){const d=`${Xt(t,a==null?void 0:a.slugStyle)}${mt}`,v=`${c}/${d}`;if(!this.app.vault.getAbstractFileByPath(v)){const y=Re(),$=`${Ft}
draft: ${t}
id: ${y}
project: ${f}
created: ${new Date().toISOString()}
${Ft}

`,k=await this.tpl.render("# {{draftName}}",{draftName:t});await this.app.vault.create(v,$+k)}}else{const b=this.app.vault.getAbstractFileByPath(c);let d=!1;if(b&&b instanceof D.TFolder){for(const v of b.children)if(v instanceof D.TFile&&v.extension===mt.slice(1)&&(await Ut(async()=>{const y=await this.app.vault.read(v);this.chapters.isValidChapter(y)&&(d=!0)}),d))break}if(!d){const v=Re();await this.chapters.createChapter(i,t,"Chapter 1",a,v)}}}await He(this.app,i,t,void 0,(u=this.manager)==null?void 0:u.settings)}listDrafts(t){var a;const e=this.resolveProjectPath(t);if(F(`${S} listDrafts called with projectPath:`,t,"resolved to:",e),!e)return[];const n=this.projectSvc.getDraftsFolder(e);if(F(`${S} getDraftsFolder for ${e} returned:`,n==null?void 0:n.path,(a=n==null?void 0:n.children)==null?void 0:a.length),n&&n instanceof D.TFolder){const i=n.children.filter(s=>s instanceof D.TFolder).map(s=>s.name);return F(`${S} found drafts:`,i),i}return[]}async getDraftId(t){F(`${S} getDraftId called for draftFolder: ${t}`);try{const e=this.app.vault.getFiles().filter(n=>n.path.startsWith(t));for(const n of e)if(n.extension===mt.slice(1)){const i=(await this.app.vault.read(n)).match(zt);if(i){const o=i[1].match(/^id:\s*(.+?)$/m);if(o){const l=o[1].trim();return F(`${S} getDraftId found: ${l}`),l}}}return F(`${S} getDraftId: no draft ID found in ${t}`),null}catch(e){return F(`${S} getDraftId error:`,e),null}}async ensureChaptersDraftId(t,e){const n=this.resolveProjectPath(t);if(!n)return;const a=this.getDraftsFolderName(n);if(!a)return;const i=`${n}/${a}/${e}`,s=await this.getDraftId(i);if(!s){F(`${S} ensureChaptersDraftId: no draft ID found for draft ${e}`);return}try{const o=this.app.vault.getFiles().filter(l=>l.path.startsWith(i));for(const l of o)if(l.extension===mt.slice(1)){const c=await this.app.vault.read(l),f=c.match(zt);if(f){const h=f[1];if(!h.match(/^id:\s*/m)){const g=c.substring(f[0].length),u=h.split(`
`);u.push(`id: ${s}`);const m=u.join(`
`),p=`${Ft}
${m}
${Ft}${g}`;await this.app.vault.modify(l,p),F(`${S} ensureChaptersDraftId: added draft ID to ${l.path}`)}}}}catch(o){F(`${S} ensureChaptersDraftId error:`,o)}}async openDraft(t,e){var f,h,g,u;const n=this.resolveProjectPath(t);if(!n)return!1;const a=this.getDraftsFolderName(n);if(!a)return!1;const i=`${n}/${Gt((f=this.manager)==null?void 0:f.settings)}`,s=await ke(this.app,i);if(((s==null?void 0:s.project_type)||Rt.MULTI)===Rt.SINGLE){const m=Xt(e,(g=(h=this.manager)==null?void 0:h.settings)==null?void 0:g.slugStyle),p=`${n}/${a}/${e}/${m}${mt}`,b=this.app.vault.getAbstractFileByPath(p);if(b&&b instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(b),!0}else{const m=await this.chapters.listChapters(n,e);if(m.length>0){const p=m[m.length-1],b=`${n}/${a}/${e}/${p.name}${mt}`,d=this.app.vault.getAbstractFileByPath(b);if(d&&d instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(d),!0}}const l=`${n}/${a}/${e}/${We((u=this.manager)==null?void 0:u.settings)}`,c=this.app.vault.getAbstractFileByPath(l);return c&&c instanceof D.TFile?(await this.app.workspace.getLeaf().openFile(c),!0):!1}async renameDraft(t,e,n,a=!1,i){var f;F(`${S} renameDraft called: ${e} -> ${n}, renameFile: ${a}`);const s=this.resolveProjectPath(t);if(!s)return F(`${S} renameDraft: no project resolved`),!1;const o=this.getDraftsFolderName(s);if(!o)return F(`${S} renameDraft: no drafts folder found`),!1;const l=`${s}/${o}/${e}`,c=`${s}/${o}/${n}`;try{this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c);const h=this.app.vault.getFiles().filter(d=>d.path.startsWith(l));let g="";if(a){const d=i==null?void 0:i.slugStyle;g=Xt(n,d)}let u=null;for(const d of h){const v=d.path.substring(l.length+1);if(d.extension===mt.slice(1)&&!v.includes("/")){u=d;break}}for(const d of h){let v=d.path.substring(l.length+1),y=`${c}/${v}`;a&&g&&d===u&&!v.includes("/")&&(v=`${g}${mt}`,y=`${c}/${v}`);let $=await this.app.vault.read(d);d.extension===mt.slice(1)&&($=$.replace(new RegExp(`^(${Ft}\\s*\\n[\\s\\S]*?\\n)(draft:.*\\n)?`,"m"),(k,N)=>N.replace(/^draft:.*\n/m,"").replace(new RegExp(`^(${Ft}\\s*\\n)`),`$1draft: ${n}
`))),await this.app.vault.create(y,$),await this.app.vault.delete(d)}const m=this.app.vault.getAbstractFileByPath(l);m&&m instanceof D.TFolder&&await this.app.vault.delete(m,!0),await Ut(async()=>{await Promise.resolve().then(()=>Un).then(d=>{var v;return d.updateMetaStats(this.app,s,n,void 0,(v=this.manager)==null?void 0:v.settings)})});const p=`${c}/${Gt((f=this.manager)==null?void 0:f.settings)}`;return this.app.vault.getAbstractFileByPath(p)&&await Ut(async()=>{const{readMetaFile:d,writeMetaFile:v}=await Promise.resolve().then(()=>Un),y=await d(this.app,p);y&&(y.draft=n,await v(this.app,p,y))}),!0}catch{return!1}}async deleteDraft(t,e,n=!0){var o;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;try{const l=this.app.vault.getFiles().filter(f=>f.path.startsWith(s));if(n){const f=await this.getDraftId(s);f&&await this.backupSvc.createBackup(s,f,(o=this.manager)==null?void 0:o.settings)}for(const f of l)await Ut(async()=>{await this.app.vault.delete(f)});const c=this.app.vault.getAbstractFileByPath(s);return c&&c instanceof D.TFolder&&await Ut(async()=>{await this.app.vault.delete(c)}),!0}catch{return!1}}async generateManuscript(t,e,n){var p;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=await this.projectSvc.getProjectType(a),o=`${a}/${i}/${e}`;if(!this.app.vault.getAbstractFileByPath(o))return new D.Notice(`Draft folder ${o} does not exist.`),!1;const l=`${a}/${qn((p=this.manager)==null?void 0:p.settings)}`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);const c=a.split("/").pop()||a,f=(n==null?void 0:n.manuscriptNameTemplate)||"{{draftName}}";F(`${S} DraftFileService.generateManuscript - manuscriptNameTemplate: "${f}"`),F(`${S} DraftFileService.generateManuscript - settings object:`,n);const h=Xt(e,n==null?void 0:n.slugStyle),g=await this.tpl.render(f,{draftName:e,projectName:c,draftSlug:h}),u=`${l}/${g}${mt}`;let m=`# Manuscript for ${e}

`;if(s===Rt.SINGLE){const b=`${h}${mt}`,d=`${o}/${b}`,v=this.app.vault.getAbstractFileByPath(d);if(v&&v instanceof D.TFile){const y=await this.app.vault.read(v);m+=ir(un(y));const $=this.app.vault.getAbstractFileByPath(u);if($&&$ instanceof D.TFile){if(!await new Mn(this.app,u).open())return!1;F(`${S} Overwriting existing manuscript: ${u}`),await this.app.vault.modify($,m)}else F(`${S} Creating new manuscript: ${u}`),await this.app.vault.create(u,m)}else return new D.Notice(`Main draft file ${d} not found.`),!1}else if(s===Rt.MULTI){const b=await this.chapters.listChapters(a,e);if(b.length===0)return new D.Notice("No chapters found in draft."),!1;for(const v of b){const y=`${o}/${v.name}${mt}`,$=this.app.vault.getAbstractFileByPath(y);if($&&$ instanceof D.TFile){const k=await this.app.vault.read($),N=v.chapterName||v.name;m+=`## ${N}

`,m+=ir(un(k)),m+=`

`}}const d=this.app.vault.getAbstractFileByPath(u);if(d&&d instanceof D.TFile){if(!await new Mn(this.app,u).open())return!1;F(`${S} Overwriting existing manuscript: ${u}`),await this.app.vault.modify(d,m)}else F(`${S} Creating new manuscript: ${u}`),await this.app.vault.create(u,m)}return!0}getOutlineFile(t,e){var o;const n=this.resolveProjectPath(t);if(!n)return null;const a=this.getDraftsFolderName(n);if(!a)return null;const i=`${n}/${a}/${e}/${We((o=this.manager)==null?void 0:o.settings)}`,s=this.app.vault.getAbstractFileByPath(i);return s&&s instanceof D.TFile?s:null}async createOutline(t,e,n){var f;const a=this.resolveProjectPath(t);if(!a)throw new Error("Project not found");const i=this.getDraftsFolderName(a);if(!i)throw new Error("Drafts folder not found");const o=`${`${a}/${i}/${e}`}/${We((f=this.manager)==null?void 0:f.settings)}`;if(this.app.vault.getAbstractFileByPath(o))throw new Error("Outline file already exists");const c=await this.tpl.render(n,{draftName:e});await this.app.vault.create(o,c)}async calculateDraftWordCount(t,e){var a,i,s;const n=this.resolveProjectPath(t);if(!n)return F(`${S} No project path found for word count calculation`),0;try{const o=this.getDraftsFolderName(n);if(!o)return F(`${S} No drafts folder found in project`),0;const l=`${n}/${o}/${e}`,c=this.app.vault.getAbstractFileByPath(n);if(!c||!(c instanceof D.TFolder))return F(`${S} Project folder not found at: ${n}`),0;const f=`${n}/${Gt((a=this.manager)==null?void 0:a.settings)}`,h=await ke(this.app,f),g=(h==null?void 0:h.project_type)||Rt.MULTI;if(F(`${S} Calculating word count for ${g} project, draft: ${e}`),g===Rt.SINGLE){const u=Xt(e,(s=(i=this.manager)==null?void 0:i.settings)==null?void 0:s.slugStyle),m=`${l}/${u}${mt}`,p=this.app.vault.getAbstractFileByPath(m);if(F(`${S} Looking for single-file draft at: ${m}`),p&&p instanceof D.TFile){const b=await this.app.vault.read(p),d=un(b),v=Ln(d);return F(`${S} Single-file draft word count: ${v}`),v}F(`${S} Draft file not found for single-file project`)}else{const u=this.app.vault.getAbstractFileByPath(l);if(!u||!(u instanceof D.TFolder))return F(`${S} Draft folder not found at: ${l}`),0;let m=0;for(const p of u.children)if(p instanceof D.TFile&&p.extension==="md"){const b=await this.app.vault.read(p);if(this.chapters.isValidChapter(b)){const d=un(b),v=Ln(d);F(`${S} Chapter "${p.name}" word count: ${v}`),m+=v}}return F(`${S} Multi-file draft total word count: ${m}`),m}}catch(o){F(`${S} Error calculating draft word count:`,o)}return 0}}function un(r){return r.replace(zt,"").trim()}function ir(r){return r.replace(/^#{1,6} .*\n/,"").trim()}function qa(r,t,e){const n=r.match(zt);if(!n)return r;const a=n[1],i=r.substring(n[0].length),s=a.split(`
`),o=[];let l=!1;for(const f of s)f.match(/^draft:/i)?o.push(`draft: ${t}`):f.match(/^id:/i)?(o.push(`id: ${Re()}`),l=!0):f.match(/^project:/i)?o.push(`project: ${e}`):f.match(/^created:/i)?o.push(`created: ${new Date().toISOString()}`):o.push(f);l||o.push(`id: ${Re()}`);const c=o.join(`
`);return`${Ft}
${c}
${Ft}${i}`}class Xn{constructor(t,e,n){this.chapters=new Va(t),this.backups=new Ha(t,n),this.drafts=new Ya(t,this.chapters,e,this.backups)}}function Dt(){}const Ka=r=>r;function kt(r,t){for(const e in t)r[e]=t[e];return r}function Xr(r){return r()}function sr(){return Object.create(null)}function Pe(r){r.forEach(Xr)}function sn(r){return typeof r=="function"}function Lt(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function Xa(r){return Object.keys(r).length===0}function ne(r,t,e,n){if(r){const a=Jr(r,t,e,n);return r[0](a)}}function Jr(r,t,e,n){return r[1]&&n?kt(e.ctx.slice(),r[1](n(t))):e.ctx}function re(r,t,e,n){return r[2],t.dirty}function ae(r,t,e,n,a,i){if(a){const s=Jr(t,e,n,i);r.p(s,a)}}function ie(r){if(r.ctx.length>32){const t=[],e=r.ctx.length/32;for(let n=0;n<e;n++)t[n]=-1;return t}return-1}function Nt(r){const t={};for(const e in r)e[0]!=="$"&&(t[e]=r[e]);return t}function or(r,t){const e={};t=new Set(t);for(const n in r)!t.has(n)&&n[0]!=="$"&&(e[n]=r[n]);return e}function dn(r){return r??""}const Qr=typeof window<"u";let Ja=Qr?()=>window.performance.now():()=>Date.now(),Jn=Qr?r=>requestAnimationFrame(r):Dt;const Ve=new Set;function ta(r){Ve.forEach(t=>{t.c(r)||(Ve.delete(t),t.f())}),Ve.size!==0&&Jn(ta)}function Qa(r){let t;return Ve.size===0&&Jn(ta),{promise:new Promise(e=>{Ve.add(t={c:r,f:e})}),abort(){Ve.delete(t)}}}function nt(r,t){r.appendChild(t)}function ea(r){if(!r)return document;const t=r.getRootNode?r.getRootNode():r.ownerDocument;return t&&t.host?t:r.ownerDocument}function ti(r){const t=ot("style");return t.textContent="/* empty */",ei(ea(r),t),t.sheet}function ei(r,t){return nt(r.head||r,t),t.sheet}function bt(r,t,e){r.insertBefore(t,e||null)}function gt(r){r.parentNode&&r.parentNode.removeChild(r)}function na(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function ot(r){return document.createElement(r)}function ra(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Wt(r){return document.createTextNode(r)}function vt(){return Wt(" ")}function Cn(){return Wt("")}function me(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function et(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function wn(r,t){for(const e in t)et(r,e,t[e])}function ni(r){return Array.from(r.childNodes)}function Je(r,t){t=""+t,r.data!==t&&(r.data=t)}function vn(r,t){r.value=t??""}function Fe(r,t,e,n){e==null?r.style.removeProperty(t):r.style.setProperty(t,e,"")}function le(r,t,e){r.classList.toggle(t,!!e)}function ri(r,t,{bubbles:e=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:t,bubbles:e,cancelable:n})}const bn=new Map;let _n=0;function ai(r){let t=5381,e=r.length;for(;e--;)t=(t<<5)-t^r.charCodeAt(e);return t>>>0}function ii(r,t){const e={stylesheet:ti(t),rules:{}};return bn.set(r,e),e}function si(r,t,e,n,a,i,s,o=0){const l=16.666/n;let c=`{
`;for(let b=0;b<=1;b+=l){const d=t+(e-t)*i(b);c+=b*100+`%{${s(d,1-d)}}
`}const f=c+`100% {${s(e,1-e)}}
}`,h=`__svelte_${ai(f)}_${o}`,g=ea(r),{stylesheet:u,rules:m}=bn.get(g)||ii(g,r);m[h]||(m[h]=!0,u.insertRule(`@keyframes ${h} ${f}`,u.cssRules.length));const p=r.style.animation||"";return r.style.animation=`${p?`${p}, `:""}${h} ${n}ms linear ${a}ms 1 both`,_n+=1,h}function oi(r,t){const e=(r.style.animation||"").split(", "),n=e.filter(t?i=>i.indexOf(t)<0:i=>i.indexOf("__svelte")===-1),a=e.length-n.length;a&&(r.style.animation=n.join(", "),_n-=a,_n||li())}function li(){Jn(()=>{_n||(bn.forEach(r=>{const{ownerNode:t}=r.stylesheet;t&&gt(t)}),bn.clear())})}function ci(r,t,e,n){if(!t)return Dt;const a=r.getBoundingClientRect();if(t.left===a.left&&t.right===a.right&&t.top===a.top&&t.bottom===a.bottom)return Dt;const{delay:i=0,duration:s=300,easing:o=Ka,start:l=Ja()+i,end:c=l+s,tick:f=Dt,css:h}=e(r,{from:t,to:a},n);let g=!0,u=!1,m;function p(){h&&(m=si(r,0,1,s,i,o,h)),i||(u=!0)}function b(){h&&oi(r,m),g=!1}return Qa(d=>{if(!u&&d>=l&&(u=!0),u&&d>=c&&(f(1,0),b()),!g)return!1;if(u){const v=d-l,y=0+1*o(v/s);f(y,1-y)}return!0}),p(),f(0,1),b}function fi(r){const t=getComputedStyle(r);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:e,height:n}=t,a=r.getBoundingClientRect();r.style.position="absolute",r.style.width=e,r.style.height=n,ui(r,a)}}function ui(r,t){const e=r.getBoundingClientRect();if(t.left!==e.left||t.top!==e.top){const n=getComputedStyle(r),a=n.transform==="none"?"":n.transform;r.style.transform=`${a} translate(${t.left-e.left}px, ${t.top-e.top}px)`}}let an;function nn(r){an=r}function Qn(){if(!an)throw new Error("Function called outside component initialization");return an}function di(r){Qn().$$.on_mount.push(r)}function Wn(r){Qn().$$.on_destroy.push(r)}function hi(){const r=Qn();return(t,e,{cancelable:n=!1}={})=>{const a=r.$$.callbacks[t];if(a){const i=ri(t,e,{cancelable:n});return a.slice().forEach(s=>{s.call(r,i)}),!i.defaultPrevented}return!0}}const Me=[],rn=[];let Ze=[];const lr=[],pi=Promise.resolve();let Hn=!1;function mi(){Hn||(Hn=!0,pi.then(aa))}function Vn(r){Ze.push(r)}const jn=new Set;let ze=0;function aa(){if(ze!==0)return;const r=an;do{try{for(;ze<Me.length;){const t=Me[ze];ze++,nn(t),gi(t.$$)}}catch(t){throw Me.length=0,ze=0,t}for(nn(null),Me.length=0,ze=0;rn.length;)rn.pop()();for(let t=0;t<Ze.length;t+=1){const e=Ze[t];jn.has(e)||(jn.add(e),e())}Ze.length=0}while(Me.length);for(;lr.length;)lr.pop()();Hn=!1,jn.clear(),nn(r)}function gi(r){if(r.fragment!==null){r.update(),Pe(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Vn)}}function wi(r){const t=[],e=[];Ze.forEach(n=>r.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),Ze=t}const pn=new Set;let Be;function Qt(){Be={r:0,c:[],p:Be}}function te(){Be.r||Pe(Be.c),Be=Be.p}function q(r,t){r&&r.i&&(pn.delete(r),r.i(t))}function Q(r,t,e,n){if(r&&r.o){if(pn.has(r))return;pn.add(r),Be.c.push(()=>{pn.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}function xe(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function vi(r,t){r.d(1),t.delete(r.key)}function bi(r,t){Q(r,1,1,()=>{t.delete(r.key)})}function _i(r,t){r.f(),bi(r,t)}function ia(r,t,e,n,a,i,s,o,l,c,f,h){let g=r.length,u=i.length,m=g;const p={};for(;m--;)p[r[m].key]=m;const b=[],d=new Map,v=new Map,y=[];for(m=u;m--;){const A=h(a,i,m),I=e(A);let P=s.get(I);P?y.push(()=>P.p(A,t)):(P=c(I,A),P.c()),d.set(I,b[m]=P),I in p&&v.set(I,Math.abs(m-p[I]))}const $=new Set,k=new Set;function N(A){q(A,1),A.m(o,f),s.set(A.key,A),f=A.first,u--}for(;g&&u;){const A=b[u-1],I=r[g-1],P=A.key,T=I.key;A===I?(f=A.first,g--,u--):d.has(T)?!s.has(P)||$.has(P)?N(A):k.has(T)?g--:v.get(P)>v.get(T)?(k.add(P),N(A)):($.add(T),g--):(l(I,s),g--)}for(;g--;){const A=r[g];d.has(A.key)||l(A,s)}for(;u;)N(b[u-1]);return Pe(y),b}function ce(r,t){const e={},n={},a={$$scope:1};let i=r.length;for(;i--;){const s=r[i],o=t[i];if(o){for(const l in s)l in o||(n[l]=1);for(const l in o)a[l]||(e[l]=o[l],a[l]=1);r[i]=o}else for(const l in s)a[l]=1}for(const s in n)s in e||(e[s]=void 0);return e}function we(r){return typeof r=="object"&&r!==null?r:{}}function pt(r){r&&r.c()}function ut(r,t,e){const{fragment:n,after_update:a}=r.$$;n&&n.m(t,e),Vn(()=>{const i=r.$$.on_mount.map(Xr).filter(sn);r.$$.on_destroy?r.$$.on_destroy.push(...i):Pe(i),r.$$.on_mount=[]}),a.forEach(Vn)}function dt(r,t){const e=r.$$;e.fragment!==null&&(wi(e.after_update),Pe(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function yi(r,t){r.$$.dirty[0]===-1&&(Me.push(r),mi(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function Ht(r,t,e,n,a,i,s=null,o=[-1]){const l=an;nn(r);const c=r.$$={fragment:null,ctx:[],props:i,update:Dt,not_equal:a,bound:sr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:sr(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let f=!1;if(c.ctx=e?e(r,t.props||{},(h,g,...u)=>{const m=u.length?u[0]:g;return c.ctx&&a(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),f&&yi(r,h)),g}):[],c.update(),f=!0,Pe(c.before_update),c.fragment=n?n(c.ctx):!1,t.target){if(t.hydrate){const h=ni(t.target);c.fragment&&c.fragment.l(h),h.forEach(gt)}else c.fragment&&c.fragment.c();t.intro&&q(r.$$.fragment),ut(r,t.target,t.anchor),aa()}nn(l)}class Vt{constructor(){Pn(this,"$$");Pn(this,"$$set")}$destroy(){dt(this,1),this.$destroy=Dt}$on(t,e){if(!sn(e))return Dt;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const a=n.indexOf(e);a!==-1&&n.splice(a,1)}}$set(t){this.$$set&&!Xa(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const ki="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ki);function $i(r){let t,e,n,a,i;const s=r[6].default,o=ne(s,r,r[5],null);return{c(){t=ot("button"),o&&o.c(),et(t,"class",e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`),et(t,"aria-label",r[3]),t.disabled=r[1],et(t,"style",r[2])},m(l,c){bt(l,t,c),o&&o.m(t,null),n=!0,a||(i=me(t,"click",function(){sn(r[4])&&r[4].apply(this,arguments)}),a=!0)},p(l,[c]){r=l,o&&o.p&&(!n||c&32)&&ae(o,s,r,r[5],n?re(s,r[5],c,null):ie(r[5]),null),(!n||c&1&&e!==(e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`))&&et(t,"class",e),(!n||c&8)&&et(t,"aria-label",r[3]),(!n||c&2)&&(t.disabled=r[1]),(!n||c&4)&&et(t,"style",r[2])},i(l){n||(q(o,l),n=!0)},o(l){Q(o,l),n=!1},d(l){l&&gt(t),o&&o.d(l),a=!1,i()}}}function Ci(r,t,e){let{$$slots:n={},$$scope:a}=t,{variant:i="default"}=t,{disabled:s=!1}=t,{style:o=""}=t,{title:l=""}=t,{clickHandler:c=void 0}=t;return r.$$set=f=>{"variant"in f&&e(0,i=f.variant),"disabled"in f&&e(1,s=f.disabled),"style"in f&&e(2,o=f.style),"title"in f&&e(3,l=f.title),"clickHandler"in f&&e(4,c=f.clickHandler),"$$scope"in f&&e(5,a=f.$$scope)},[i,s,o,l,c,a,n]}class $e extends Vt{constructor(t){super(),Ht(this,t,Ci,$i,Lt,{variant:0,disabled:1,style:2,title:3,clickHandler:4})}}function Si(r){let t,e,n,a,i,s,o;const l=r[7].default,c=ne(l,r,r[6],null);return{c(){t=ot("button"),e=ot("span"),c&&c.c(),et(e,"class",n=dn(r[5]?"spinning":"")+" svelte-10fbbmm"),et(t,"class",a=dn(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"),et(t,"aria-label",r[0]),t.disabled=r[2],et(t,"title",r[3])},m(f,h){bt(f,t,h),nt(t,e),c&&c.m(e,null),i=!0,s||(o=me(t,"click",function(){sn(r[4])&&r[4].apply(this,arguments)}),s=!0)},p(f,[h]){r=f,c&&c.p&&(!i||h&64)&&ae(c,l,r,r[6],i?re(l,r[6],h,null):ie(r[6]),null),(!i||h&32&&n!==(n=dn(r[5]?"spinning":"")+" svelte-10fbbmm"))&&et(e,"class",n),(!i||h&2&&a!==(a=dn(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"))&&et(t,"class",a),(!i||h&1)&&et(t,"aria-label",r[0]),(!i||h&4)&&(t.disabled=r[2]),(!i||h&8)&&et(t,"title",r[3])},i(f){i||(q(c,f),i=!0)},o(f){Q(c,f),i=!1},d(f){f&&gt(t),c&&c.d(f),s=!1,o()}}}function Fi(r,t,e){let{$$slots:n={},$$scope:a}=t,{ariaLabel:i=""}=t,{variant:s="default"}=t,{disabled:o=!1}=t,{title:l}=t,{clickHandler:c=void 0}=t,{spinning:f=!1}=t;return r.$$set=h=>{"ariaLabel"in h&&e(0,i=h.ariaLabel),"variant"in h&&e(1,s=h.variant),"disabled"in h&&e(2,o=h.disabled),"title"in h&&e(3,l=h.title),"clickHandler"in h&&e(4,c=h.clickHandler),"spinning"in h&&e(5,f=h.spinning),"$$scope"in h&&e(6,a=h.$$scope)},[i,s,o,l,c,f,a,n]}class ue extends Vt{constructor(t){super(),Ht(this,t,Fi,Si,Lt,{ariaLabel:0,variant:1,disabled:2,title:3,clickHandler:4,spinning:5})}}const Ye=Math.min,Jt=Math.max,yn=Math.round,hn=Math.floor,pe=r=>({x:r,y:r}),xi={left:"right",right:"left",bottom:"top",top:"bottom"},Ei={start:"end",end:"start"};function cr(r,t,e){return Jt(r,Ye(t,e))}function on(r,t){return typeof r=="function"?r(t):r}function Ee(r){return r.split("-")[0]}function ln(r){return r.split("-")[1]}function sa(r){return r==="x"?"y":"x"}function oa(r){return r==="y"?"height":"width"}const Di=new Set(["top","bottom"]);function ye(r){return Di.has(Ee(r))?"y":"x"}function la(r){return sa(ye(r))}function Pi(r,t,e){e===void 0&&(e=!1);const n=ln(r),a=la(r),i=oa(a);let s=a==="x"?n===(e?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=kn(s)),[s,kn(s)]}function ji(r){const t=kn(r);return[Zn(r),t,Zn(t)]}function Zn(r){return r.replace(/start|end/g,t=>Ei[t])}const fr=["left","right"],ur=["right","left"],Ni=["top","bottom"],Ai=["bottom","top"];function Ti(r,t,e){switch(r){case"top":case"bottom":return e?t?ur:fr:t?fr:ur;case"left":case"right":return t?Ni:Ai;default:return[]}}function Bi(r,t,e,n){const a=ln(r);let i=Ti(Ee(r),e==="start",n);return a&&(i=i.map(s=>s+"-"+a),t&&(i=i.concat(i.map(Zn)))),i}function kn(r){return r.replace(/left|right|bottom|top/g,t=>xi[t])}function Oi(r){return{top:0,right:0,bottom:0,left:0,...r}}function Ri(r){return typeof r!="number"?Oi(r):{top:r,right:r,bottom:r,left:r}}function $n(r){const{x:t,y:e,width:n,height:a}=r;return{width:n,height:a,top:e,left:t,right:t+n,bottom:e+a,x:t,y:e}}function dr(r,t,e){let{reference:n,floating:a}=r;const i=ye(t),s=la(t),o=oa(s),l=Ee(t),c=i==="y",f=n.x+n.width/2-a.width/2,h=n.y+n.height/2-a.height/2,g=n[o]/2-a[o]/2;let u;switch(l){case"top":u={x:f,y:n.y-a.height};break;case"bottom":u={x:f,y:n.y+n.height};break;case"right":u={x:n.x+n.width,y:h};break;case"left":u={x:n.x-a.width,y:h};break;default:u={x:n.x,y:n.y}}switch(ln(t)){case"start":u[s]-=g*(e&&c?-1:1);break;case"end":u[s]+=g*(e&&c?-1:1);break}return u}const Ii=async(r,t,e)=>{const{placement:n="bottom",strategy:a="absolute",middleware:i=[],platform:s}=e,o=i.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(t));let c=await s.getElementRects({reference:r,floating:t,strategy:a}),{x:f,y:h}=dr(c,n,l),g=n,u={},m=0;for(let p=0;p<o.length;p++){const{name:b,fn:d}=o[p],{x:v,y,data:$,reset:k}=await d({x:f,y:h,initialPlacement:n,placement:g,strategy:a,middlewareData:u,rects:c,platform:s,elements:{reference:r,floating:t}});f=v??f,h=y??h,u={...u,[b]:{...u[b],...$}},k&&m<=50&&(m++,typeof k=="object"&&(k.placement&&(g=k.placement),k.rects&&(c=k.rects===!0?await s.getElementRects({reference:r,floating:t,strategy:a}):k.rects),{x:f,y:h}=dr(c,g,l)),p=-1)}return{x:f,y:h,placement:g,strategy:a,middlewareData:u}};async function tr(r,t){var e;t===void 0&&(t={});const{x:n,y:a,platform:i,rects:s,elements:o,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:f="viewport",elementContext:h="floating",altBoundary:g=!1,padding:u=0}=on(t,r),m=Ri(u),b=o[g?h==="floating"?"reference":"floating":h],d=$n(await i.getClippingRect({element:(e=await(i.isElement==null?void 0:i.isElement(b)))==null||e?b:b.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:c,rootBoundary:f,strategy:l})),v=h==="floating"?{x:n,y:a,width:s.floating.width,height:s.floating.height}:s.reference,y=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),$=await(i.isElement==null?void 0:i.isElement(y))?await(i.getScale==null?void 0:i.getScale(y))||{x:1,y:1}:{x:1,y:1},k=$n(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:v,offsetParent:y,strategy:l}):v);return{top:(d.top-k.top+m.top)/$.y,bottom:(k.bottom-d.bottom+m.bottom)/$.y,left:(d.left-k.left+m.left)/$.x,right:(k.right-d.right+m.right)/$.x}}const zi=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var e,n;const{placement:a,middlewareData:i,rects:s,initialPlacement:o,platform:l,elements:c}=t,{mainAxis:f=!0,crossAxis:h=!0,fallbackPlacements:g,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...b}=on(r,t);if((e=i.arrow)!=null&&e.alignmentOffset)return{};const d=Ee(a),v=ye(o),y=Ee(o)===o,$=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=g||(y||!p?[kn(o)]:ji(o)),N=m!=="none";!g&&N&&k.push(...Bi(o,p,m,$));const A=[o,...k],I=await tr(t,b),P=[];let T=((n=i.flip)==null?void 0:n.overflows)||[];if(f&&P.push(I[d]),h){const _=Pi(a,s,$);P.push(I[_[0]],I[_[1]])}if(T=[...T,{placement:a,overflows:P}],!P.every(_=>_<=0)){var J,E;const _=(((J=i.flip)==null?void 0:J.index)||0)+1,U=A[_];if(U&&(!(h==="alignment"?v!==ye(U):!1)||T.every(it=>ye(it.placement)===v?it.overflows[0]>0:!0)))return{data:{index:_,overflows:T},reset:{placement:U}};let at=(E=T.filter(V=>V.overflows[0]<=0).sort((V,it)=>V.overflows[1]-it.overflows[1])[0])==null?void 0:E.placement;if(!at)switch(u){case"bestFit":{var R;const V=(R=T.filter(it=>{if(N){const Z=ye(it.placement);return Z===v||Z==="y"}return!0}).map(it=>[it.placement,it.overflows.filter(Z=>Z>0).reduce((Z,ct)=>Z+ct,0)]).sort((it,Z)=>it[1]-Z[1])[0])==null?void 0:R[0];V&&(at=V);break}case"initialPlacement":at=o;break}if(a!==at)return{reset:{placement:at}}}return{}}}},Li=new Set(["left","top"]);async function Mi(r,t){const{placement:e,platform:n,elements:a}=r,i=await(n.isRTL==null?void 0:n.isRTL(a.floating)),s=Ee(e),o=ln(e),l=ye(e)==="y",c=Li.has(s)?-1:1,f=i&&l?-1:1,h=on(t,r);let{mainAxis:g,crossAxis:u,alignmentAxis:m}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return o&&typeof m=="number"&&(u=o==="end"?m*-1:m),l?{x:u*f,y:g*c}:{x:g*c,y:u*f}}const Ui=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var e,n;const{x:a,y:i,placement:s,middlewareData:o}=t,l=await Mi(t,r);return s===((e=o.offset)==null?void 0:e.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:a+l.x,y:i+l.y,data:{...l,placement:s}}}}},Wi=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:e,y:n,placement:a}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:o={fn:b=>{let{x:d,y:v}=b;return{x:d,y:v}}},...l}=on(r,t),c={x:e,y:n},f=await tr(t,l),h=ye(Ee(a)),g=sa(h);let u=c[g],m=c[h];if(i){const b=g==="y"?"top":"left",d=g==="y"?"bottom":"right",v=u+f[b],y=u-f[d];u=cr(v,u,y)}if(s){const b=h==="y"?"top":"left",d=h==="y"?"bottom":"right",v=m+f[b],y=m-f[d];m=cr(v,m,y)}const p=o.fn({...t,[g]:u,[h]:m});return{...p,data:{x:p.x-e,y:p.y-n,enabled:{[g]:i,[h]:s}}}}}},Hi=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var e,n;const{placement:a,rects:i,platform:s,elements:o}=t,{apply:l=()=>{},...c}=on(r,t),f=await tr(t,c),h=Ee(a),g=ln(a),u=ye(a)==="y",{width:m,height:p}=i.floating;let b,d;h==="top"||h==="bottom"?(b=h,d=g===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(d=h,b=g==="end"?"top":"bottom");const v=p-f.top-f.bottom,y=m-f.left-f.right,$=Ye(p-f[b],v),k=Ye(m-f[d],y),N=!t.middlewareData.shift;let A=$,I=k;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(I=y),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(A=v),N&&!g){const T=Jt(f.left,0),J=Jt(f.right,0),E=Jt(f.top,0),R=Jt(f.bottom,0);u?I=m-2*(T!==0||J!==0?T+J:Jt(f.left,f.right)):A=p-2*(E!==0||R!==0?E+R:Jt(f.top,f.bottom))}await l({...t,availableWidth:I,availableHeight:A});const P=await s.getDimensions(o.floating);return m!==P.width||p!==P.height?{reset:{rects:!0}}:{}}}};function Sn(){return typeof window<"u"}function Qe(r){return ca(r)?(r.nodeName||"").toLowerCase():"#document"}function ee(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function ve(r){var t;return(t=(ca(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function ca(r){return Sn()?r instanceof Node||r instanceof ee(r).Node:!1}function de(r){return Sn()?r instanceof Element||r instanceof ee(r).Element:!1}function ge(r){return Sn()?r instanceof HTMLElement||r instanceof ee(r).HTMLElement:!1}function hr(r){return!Sn()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof ee(r).ShadowRoot}const Vi=new Set(["inline","contents"]);function cn(r){const{overflow:t,overflowX:e,overflowY:n,display:a}=he(r);return/auto|scroll|overlay|hidden|clip/.test(t+n+e)&&!Vi.has(a)}const Zi=new Set(["table","td","th"]);function Gi(r){return Zi.has(Qe(r))}const Yi=[":popover-open",":modal"];function Fn(r){return Yi.some(t=>{try{return r.matches(t)}catch{return!1}})}const qi=["transform","translate","scale","rotate","perspective"],Ki=["transform","translate","scale","rotate","perspective","filter"],Xi=["paint","layout","strict","content"];function er(r){const t=nr(),e=de(r)?he(r):r;return qi.some(n=>e[n]?e[n]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||Ki.some(n=>(e.willChange||"").includes(n))||Xi.some(n=>(e.contain||"").includes(n))}function Ji(r){let t=De(r);for(;ge(t)&&!qe(t);){if(er(t))return t;if(Fn(t))return null;t=De(t)}return null}function nr(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Qi=new Set(["html","body","#document"]);function qe(r){return Qi.has(Qe(r))}function he(r){return ee(r).getComputedStyle(r)}function xn(r){return de(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function De(r){if(Qe(r)==="html")return r;const t=r.assignedSlot||r.parentNode||hr(r)&&r.host||ve(r);return hr(t)?t.host:t}function fa(r){const t=De(r);return qe(t)?r.ownerDocument?r.ownerDocument.body:r.body:ge(t)&&cn(t)?t:fa(t)}function Ke(r,t,e){var n;t===void 0&&(t=[]),e===void 0&&(e=!0);const a=fa(r),i=a===((n=r.ownerDocument)==null?void 0:n.body),s=ee(a);if(i){const o=Gn(s);return t.concat(s,s.visualViewport||[],cn(a)?a:[],o&&e?Ke(o):[])}return t.concat(a,Ke(a,[],e))}function Gn(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function ua(r){const t=he(r);let e=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=ge(r),i=a?r.offsetWidth:e,s=a?r.offsetHeight:n,o=yn(e)!==i||yn(n)!==s;return o&&(e=i,n=s),{width:e,height:n,$:o}}function rr(r){return de(r)?r:r.contextElement}function Ge(r){const t=rr(r);if(!ge(t))return pe(1);const e=t.getBoundingClientRect(),{width:n,height:a,$:i}=ua(t);let s=(i?yn(e.width):e.width)/n,o=(i?yn(e.height):e.height)/a;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const ts=pe(0);function da(r){const t=ee(r);return!nr()||!t.visualViewport?ts:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function es(r,t,e){return t===void 0&&(t=!1),!e||t&&e!==ee(r)?!1:t}function Ie(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=!1);const a=r.getBoundingClientRect(),i=rr(r);let s=pe(1);t&&(n?de(n)&&(s=Ge(n)):s=Ge(r));const o=es(i,e,n)?da(i):pe(0);let l=(a.left+o.x)/s.x,c=(a.top+o.y)/s.y,f=a.width/s.x,h=a.height/s.y;if(i){const g=ee(i),u=n&&de(n)?ee(n):n;let m=g,p=Gn(m);for(;p&&n&&u!==m;){const b=Ge(p),d=p.getBoundingClientRect(),v=he(p),y=d.left+(p.clientLeft+parseFloat(v.paddingLeft))*b.x,$=d.top+(p.clientTop+parseFloat(v.paddingTop))*b.y;l*=b.x,c*=b.y,f*=b.x,h*=b.y,l+=y,c+=$,m=ee(p),p=Gn(m)}}return $n({width:f,height:h,x:l,y:c})}function En(r,t){const e=xn(r).scrollLeft;return t?t.left+e:Ie(ve(r)).left+e}function ha(r,t){const e=r.getBoundingClientRect(),n=e.left+t.scrollLeft-En(r,e),a=e.top+t.scrollTop;return{x:n,y:a}}function ns(r){let{elements:t,rect:e,offsetParent:n,strategy:a}=r;const i=a==="fixed",s=ve(n),o=t?Fn(t.floating):!1;if(n===s||o&&i)return e;let l={scrollLeft:0,scrollTop:0},c=pe(1);const f=pe(0),h=ge(n);if((h||!h&&!i)&&((Qe(n)!=="body"||cn(s))&&(l=xn(n)),ge(n))){const u=Ie(n);c=Ge(n),f.x=u.x+n.clientLeft,f.y=u.y+n.clientTop}const g=s&&!h&&!i?ha(s,l):pe(0);return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+f.x+g.x,y:e.y*c.y-l.scrollTop*c.y+f.y+g.y}}function rs(r){return Array.from(r.getClientRects())}function as(r){const t=ve(r),e=xn(r),n=r.ownerDocument.body,a=Jt(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),i=Jt(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let s=-e.scrollLeft+En(r);const o=-e.scrollTop;return he(n).direction==="rtl"&&(s+=Jt(t.clientWidth,n.clientWidth)-a),{width:a,height:i,x:s,y:o}}const pr=25;function is(r,t){const e=ee(r),n=ve(r),a=e.visualViewport;let i=n.clientWidth,s=n.clientHeight,o=0,l=0;if(a){i=a.width,s=a.height;const f=nr();(!f||f&&t==="fixed")&&(o=a.offsetLeft,l=a.offsetTop)}const c=En(n);if(c<=0){const f=n.ownerDocument,h=f.body,g=getComputedStyle(h),u=f.compatMode==="CSS1Compat"&&parseFloat(g.marginLeft)+parseFloat(g.marginRight)||0,m=Math.abs(n.clientWidth-h.clientWidth-u);m<=pr&&(i-=m)}else c<=pr&&(i+=c);return{width:i,height:s,x:o,y:l}}const ss=new Set(["absolute","fixed"]);function os(r,t){const e=Ie(r,!0,t==="fixed"),n=e.top+r.clientTop,a=e.left+r.clientLeft,i=ge(r)?Ge(r):pe(1),s=r.clientWidth*i.x,o=r.clientHeight*i.y,l=a*i.x,c=n*i.y;return{width:s,height:o,x:l,y:c}}function mr(r,t,e){let n;if(t==="viewport")n=is(r,e);else if(t==="document")n=as(ve(r));else if(de(t))n=os(t,e);else{const a=da(r);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return $n(n)}function pa(r,t){const e=De(r);return e===t||!de(e)||qe(e)?!1:he(e).position==="fixed"||pa(e,t)}function ls(r,t){const e=t.get(r);if(e)return e;let n=Ke(r,[],!1).filter(o=>de(o)&&Qe(o)!=="body"),a=null;const i=he(r).position==="fixed";let s=i?De(r):r;for(;de(s)&&!qe(s);){const o=he(s),l=er(s);!l&&o.position==="fixed"&&(a=null),(i?!l&&!a:!l&&o.position==="static"&&!!a&&ss.has(a.position)||cn(s)&&!l&&pa(r,s))?n=n.filter(f=>f!==s):a=o,s=De(s)}return t.set(r,n),n}function cs(r){let{element:t,boundary:e,rootBoundary:n,strategy:a}=r;const s=[...e==="clippingAncestors"?Fn(t)?[]:ls(t,this._c):[].concat(e),n],o=s[0],l=s.reduce((c,f)=>{const h=mr(t,f,a);return c.top=Jt(h.top,c.top),c.right=Ye(h.right,c.right),c.bottom=Ye(h.bottom,c.bottom),c.left=Jt(h.left,c.left),c},mr(t,o,a));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function fs(r){const{width:t,height:e}=ua(r);return{width:t,height:e}}function us(r,t,e){const n=ge(t),a=ve(t),i=e==="fixed",s=Ie(r,!0,i,t);let o={scrollLeft:0,scrollTop:0};const l=pe(0);function c(){l.x=En(a)}if(n||!n&&!i)if((Qe(t)!=="body"||cn(a))&&(o=xn(t)),n){const u=Ie(t,!0,i,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else a&&c();i&&!n&&a&&c();const f=a&&!n&&!i?ha(a,o):pe(0),h=s.left+o.scrollLeft-l.x-f.x,g=s.top+o.scrollTop-l.y-f.y;return{x:h,y:g,width:s.width,height:s.height}}function Nn(r){return he(r).position==="static"}function gr(r,t){if(!ge(r)||he(r).position==="fixed")return null;if(t)return t(r);let e=r.offsetParent;return ve(r)===e&&(e=e.ownerDocument.body),e}function ma(r,t){const e=ee(r);if(Fn(r))return e;if(!ge(r)){let a=De(r);for(;a&&!qe(a);){if(de(a)&&!Nn(a))return a;a=De(a)}return e}let n=gr(r,t);for(;n&&Gi(n)&&Nn(n);)n=gr(n,t);return n&&qe(n)&&Nn(n)&&!er(n)?e:n||Ji(r)||e}const ds=async function(r){const t=this.getOffsetParent||ma,e=this.getDimensions,n=await e(r.floating);return{reference:us(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function hs(r){return he(r).direction==="rtl"}const ga={convertOffsetParentRelativeRectToViewportRelativeRect:ns,getDocumentElement:ve,getClippingRect:cs,getOffsetParent:ma,getElementRects:ds,getClientRects:rs,getDimensions:fs,getScale:Ge,isElement:de,isRTL:hs};function wa(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function ps(r,t){let e=null,n;const a=ve(r);function i(){var o;clearTimeout(n),(o=e)==null||o.disconnect(),e=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),i();const c=r.getBoundingClientRect(),{left:f,top:h,width:g,height:u}=c;if(o||t(),!g||!u)return;const m=hn(h),p=hn(a.clientWidth-(f+g)),b=hn(a.clientHeight-(h+u)),d=hn(f),y={rootMargin:-m+"px "+-p+"px "+-b+"px "+-d+"px",threshold:Jt(0,Ye(1,l))||1};let $=!0;function k(N){const A=N[0].intersectionRatio;if(A!==l){if(!$)return s();A?s(!1,A):n=setTimeout(()=>{s(!1,1e-7)},1e3)}A===1&&!wa(c,r.getBoundingClientRect())&&s(),$=!1}try{e=new IntersectionObserver(k,{...y,root:a.ownerDocument})}catch{e=new IntersectionObserver(k,y)}e.observe(r)}return s(!0),i}function va(r,t,e,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=rr(r),f=a||i?[...c?Ke(c):[],...Ke(t)]:[];f.forEach(d=>{a&&d.addEventListener("scroll",e,{passive:!0}),i&&d.addEventListener("resize",e)});const h=c&&o?ps(c,e):null;let g=-1,u=null;s&&(u=new ResizeObserver(d=>{let[v]=d;v&&v.target===c&&u&&(u.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var y;(y=u)==null||y.observe(t)})),e()}),c&&!l&&u.observe(c),u.observe(t));let m,p=l?Ie(r):null;l&&b();function b(){const d=Ie(r);p&&!wa(p,d)&&e(),p=d,m=requestAnimationFrame(b)}return e(),()=>{var d;f.forEach(v=>{a&&v.removeEventListener("scroll",e),i&&v.removeEventListener("resize",e)}),h==null||h(),(d=u)==null||d.disconnect(),u=null,l&&cancelAnimationFrame(m)}}const ba=Ui,_a=Wi,ya=zi,ka=Hi,ms=(r,t,e)=>{const n=new Map,a={platform:ga,...e},i={...a.platform,_c:n};return Ii(r,t,{...a,platform:i})},gs=Object.freeze(Object.defineProperty({__proto__:null,autoUpdate:va,computePosition:ms,flip:ya,getOverflowAncestors:Ke,offset:ba,platform:ga,shift:_a,size:ka},Symbol.toStringTag,{value:"Module"}));/**
 * @license lucide-svelte v0.546.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const wr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};function vr(r,t,e){const n=r.slice();return n[11]=t[e][0],n[12]=t[e][1],n}function An(r){let t,e=[r[12]],n={};for(let a=0;a<e.length;a+=1)n=kt(n,e[a]);return{c(){t=ra(r[11]),wn(t,n)},m(a,i){bt(a,t,i)},p(a,i){wn(t,n=ce(e,[i&32&&a[12]]))},d(a){a&&gt(t)}}}function br(r){let t=r[11],e,n=r[11]&&An(r);return{c(){n&&n.c(),e=Cn()},m(a,i){n&&n.m(a,i),bt(a,e,i)},p(a,i){a[11]?t?Lt(t,a[11])?(n.d(1),n=An(a),t=a[11],n.c(),n.m(e.parentNode,e)):n.p(a,i):(n=An(a),t=a[11],n.c(),n.m(e.parentNode,e)):t&&(n.d(1),n=null,t=a[11])},d(a){a&&gt(e),n&&n.d(a)}}}function ws(r){let t,e,n,a,i,s=xe(r[5]),o=[];for(let g=0;g<s.length;g+=1)o[g]=br(vr(r,s,g));const l=r[10].default,c=ne(l,r,r[9],null);let f=[wr,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:a=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],h={};for(let g=0;g<f.length;g+=1)h=kt(h,f[g]);return{c(){t=ra("svg");for(let g=0;g<o.length;g+=1)o[g].c();e=Cn(),c&&c.c(),wn(t,h)},m(g,u){bt(g,t,u);for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(t,null);nt(t,e),c&&c.m(t,null),i=!0},p(g,[u]){if(u&32){s=xe(g[5]);let m;for(m=0;m<s.length;m+=1){const p=vr(g,s,m);o[m]?o[m].p(p,u):(o[m]=br(p),o[m].c(),o[m].m(t,e))}for(;m<o.length;m+=1)o[m].d(1);o.length=s.length}c&&c.p&&(!i||u&512)&&ae(c,l,g,g[9],i?re(l,g[9],u,null):ie(g[9]),null),wn(t,h=ce(f,[wr,u&128&&g[7],(!i||u&4)&&{width:g[2]},(!i||u&4)&&{height:g[2]},(!i||u&2)&&{stroke:g[1]},(!i||u&28&&n!==(n=g[4]?Number(g[3])*24/Number(g[2]):g[3]))&&{"stroke-width":n},(!i||u&257&&a!==(a=g[6]("lucide-icon","lucide",g[0]?`lucide-${g[0]}`:"",g[8].class)))&&{class:a}]))},i(g){i||(q(c,g),i=!0)},o(g){Q(c,g),i=!1},d(g){g&&gt(t),na(o,g),c&&c.d(g)}}}function vs(r,t,e){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let a=or(t,n),{$$slots:i={},$$scope:s}=t,{name:o=void 0}=t,{color:l="currentColor"}=t,{size:c=24}=t,{strokeWidth:f=2}=t,{absoluteStrokeWidth:h=!1}=t,{iconNode:g=[]}=t;const u=(...m)=>m.filter((p,b,d)=>!!p&&d.indexOf(p)===b).join(" ");return r.$$set=m=>{e(8,t=kt(kt({},t),Nt(m))),e(7,a=or(t,n)),"name"in m&&e(0,o=m.name),"color"in m&&e(1,l=m.color),"size"in m&&e(2,c=m.size),"strokeWidth"in m&&e(3,f=m.strokeWidth),"absoluteStrokeWidth"in m&&e(4,h=m.absoluteStrokeWidth),"iconNode"in m&&e(5,g=m.iconNode),"$$scope"in m&&e(9,s=m.$$scope)},t=Nt(t),[o,l,c,f,h,g,u,a,t,s,i]}class be extends Vt{constructor(t){super(),Ht(this,t,vs,ws,Lt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}function bs(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function _s(r){let t,e;const n=[{name:"arrow-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[bs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function ys(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class $a extends Vt{constructor(t){super(),Ht(this,t,ys,_s,Lt,{})}}function ks(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function $s(r){let t,e;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[ks]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Cs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Ca extends Vt{constructor(t){super(),Ht(this,t,Cs,$s,Lt,{})}}function Ss(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Fs(r){let t,e;const n=[{name:"book-open-check"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ss]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function xs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 21V7"}],["path",{d:"m16 12 2 2 4-4"}],["path",{d:"M22 6V4a1 1 0 0 0-1-1h-5a4 4 0 0 0-4 4 4 4 0 0 0-4-4H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h6a3 3 0 0 1 3 3 3 3 0 0 1 3-3h6a1 1 0 0 0 1-1v-1.3"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Es extends Vt{constructor(t){super(),Ht(this,t,xs,Fs,Lt,{})}}function Ds(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ps(r){let t,e;const n=[{name:"chevron-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ds]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function js(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m6 9 6 6 6-6"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Ns extends Vt{constructor(t){super(),Ht(this,t,js,Ps,Lt,{})}}function As(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ts(r){let t,e;const n=[{name:"copy"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[As]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Bs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Os extends Vt{constructor(t){super(),Ht(this,t,Bs,Ts,Lt,{})}}function Rs(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Is(r){let t,e;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Rs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function zs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Sa extends Vt{constructor(t){super(),Ht(this,t,zs,Is,Lt,{})}}function Ls(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ms(r){let t,e;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ls]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Us(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Fa extends Vt{constructor(t){super(),Ht(this,t,Us,Ms,Lt,{})}}function Ws(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Hs(r){let t,e;const n=[{name:"rotate-ccw"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ws]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Vs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class xa extends Vt{constructor(t){super(),Ht(this,t,Vs,Hs,Lt,{})}}function Zs(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Gs(r){let t,e;const n=[{name:"trash"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Zs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ys(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Ea extends Vt{constructor(t){super(),Ht(this,t,Ys,Gs,Lt,{})}}function qs(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ks(r){let t,e;const n=[{name:"x"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[qs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){pt(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ce(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Xs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Js extends Vt{constructor(t){super(),Ht(this,t,Xs,Ks,Lt,{})}}function _r(r,t,e){const n=r.slice();return n[38]=t[e],n[40]=e,n}function yr(r){let t,e,n;return{c(){t=ot("label"),e=Wt(r[2]),et(t,"class","wa-select-label-text"),et(t,"for",n="wa-select-"+r[7])},m(a,i){bt(a,t,i),nt(t,e)},p(a,i){i[0]&4&&Je(e,a[2]),i[0]&128&&n!==(n="wa-select-"+a[7])&&et(t,"for",n)},d(a){a&&gt(t)}}}function Qs(r){let t,e;return{c(){t=ot("span"),e=Wt(r[1]),et(t,"class","wa-select-placeholder")},m(n,a){bt(n,t,a),nt(t,e)},p(n,a){a[0]&2&&Je(e,n[1])},d(n){n&&gt(t)}}}function to(r){let t,e;return{c(){t=ot("span"),e=Wt(r[16]),et(t,"class","wa-select-label")},m(n,a){bt(n,t,a),nt(t,e)},p(n,a){a[0]&65536&&Je(e,n[16])},d(n){n&&gt(t)}}}function kr(r){let t,e,n,a,i;return e=new Js({}),{c(){t=ot("button"),pt(e.$$.fragment),et(t,"type","button"),et(t,"class","wa-select-clear"),et(t,"aria-label","Clear selection")},m(s,o){bt(s,t,o),ut(e,t,null),n=!0,a||(i=me(t,"click",r[21]),a=!0)},p:Dt,i(s){n||(q(e.$$.fragment,s),n=!0)},o(s){Q(e.$$.fragment,s),n=!1},d(s){s&&gt(t),dt(e),a=!1,i()}}}function $r(r){let t,e,n;return e=new Ns({}),{c(){t=ot("div"),pt(e.$$.fragment),et(t,"class","wa-select-chevron"),le(t,"rotated",r[9])},m(a,i){bt(a,t,i),ut(e,t,null),n=!0},p(a,i){(!n||i[0]&512)&&le(t,"rotated",a[9])},i(a){n||(q(e.$$.fragment,a),n=!0)},o(a){Q(e.$$.fragment,a),n=!1},d(a){a&&gt(t),dt(e)}}}function Cr(r){let t,e,n,a=r[4]&&Sr(r);function i(l,c){return l[10].length===0?no:eo}let s=i(r),o=s(r);return{c(){t=ot("div"),a&&a.c(),e=vt(),n=ot("div"),o.c(),et(n,"class","wa-select-list"),et(t,"class","wa-select-dropdown")},m(l,c){bt(l,t,c),a&&a.m(t,null),nt(t,e),nt(t,n),o.m(n,null),r[30](t)},p(l,c){l[4]?a?a.p(l,c):(a=Sr(l),a.c(),a.m(t,e)):a&&(a.d(1),a=null),s===(s=i(l))&&o?o.p(l,c):(o.d(1),o=s(l),o&&(o.c(),o.m(n,null)))},d(l){l&&gt(t),a&&a.d(),o.d(),r[30](null)}}}function Sr(r){let t,e,n,a;return{c(){t=ot("div"),e=ot("input"),et(e,"type","text"),et(e,"class","wa-select-search-input"),et(e,"placeholder","Search..."),e.value=r[13],et(t,"class","wa-select-search")},m(i,s){bt(i,t,s),nt(t,e),r[27](e),n||(a=me(e,"input",r[23]),n=!0)},p(i,s){s[0]&8192&&e.value!==i[13]&&(e.value=i[13])},d(i){i&&gt(t),r[27](null),n=!1,a()}}}function eo(r){let t=[],e=new Map,n,a=xe(r[10]);const i=s=>s[38].value;for(let s=0;s<a.length;s+=1){let o=_r(r,a,s),l=i(o);e.set(l,t[s]=Fr(l,o))}return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=Cn()},m(s,o){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(s,o);bt(s,n,o)},p(s,o){o[0]&1197056&&(a=xe(s[10]),t=ia(t,o,i,1,s,a,e,n.parentNode,vi,Fr,n,_r))},d(s){s&&gt(n);for(let o=0;o<t.length;o+=1)t[o].d(s)}}}function no(r){let t;return{c(){t=ot("div"),t.textContent="No options available",et(t,"class","wa-select-empty")},m(e,n){bt(e,t,n)},p:Dt,d(e){e&&gt(t)}}}function Fr(r,t){let e,n=t[38].label+"",a,i,s,o,l;function c(){return t[28](t[38])}function f(){return t[29](t[40])}return{key:r,first:null,c(){e=ot("button"),a=Wt(n),i=vt(),et(e,"type","button"),et(e,"class","wa-select-option"),et(e,"data-select-index",s=t[40]),le(e,"selected",t[14]===t[40]),le(e,"active",t[17]()===t[38].value),this.first=e},m(h,g){bt(h,e,g),nt(e,a),nt(e,i),o||(l=[me(e,"click",c),me(e,"mouseenter",f)],o=!0)},p(h,g){t=h,g[0]&1024&&n!==(n=t[38].label+"")&&Je(a,n),g[0]&1024&&s!==(s=t[40])&&et(e,"data-select-index",s),g[0]&17408&&le(e,"selected",t[14]===t[40]),g[0]&132096&&le(e,"active",t[17]()===t[38].value)},d(h){h&&gt(e),o=!1,Pe(l)}}}function ro(r){let t,e,n,a,i,s,o,l,c,f,h,g,u,m=r[2]&&yr(r);function p(k,N){return k[0]?to:Qs}let b=p(r),d=b(r),v=r[5]&&r[0]&&kr(r),y=r[6]&&$r(r),$=r[9]&&Cr(r);return{c(){t=ot("div"),m&&m.c(),e=vt(),n=ot("div"),a=ot("div"),d.c(),i=vt(),s=ot("div"),v&&v.c(),o=vt(),y&&y.c(),f=vt(),$&&$.c(),et(a,"class","wa-select-value"),et(s,"class","wa-select-controls"),et(n,"id",l="wa-select-"+r[7]),et(n,"class","wa-select-trigger"),et(n,"role","button"),et(n,"tabindex",c=r[3]?-1:0),et(n,"style",r[8]),le(n,"open",r[9]),le(n,"disabled",r[3]),le(n,"has-value",r[0]),et(t,"class","wa-select-container wa-select")},m(k,N){bt(k,t,N),m&&m.m(t,null),nt(t,e),nt(t,n),nt(n,a),d.m(a,null),nt(n,i),nt(n,s),v&&v.m(s,null),nt(s,o),y&&y.m(s,null),r[25](n),nt(t,f),$&&$.m(t,null),h=!0,g||(u=[me(n,"click",r[26]),me(n,"keydown",r[22])],g=!0)},p(k,N){k[2]?m?m.p(k,N):(m=yr(k),m.c(),m.m(t,e)):m&&(m.d(1),m=null),b===(b=p(k))&&d?d.p(k,N):(d.d(1),d=b(k),d&&(d.c(),d.m(a,null))),k[5]&&k[0]?v?(v.p(k,N),N[0]&33&&q(v,1)):(v=kr(k),v.c(),q(v,1),v.m(s,o)):v&&(Qt(),Q(v,1,1,()=>{v=null}),te()),k[6]?y?(y.p(k,N),N[0]&64&&q(y,1)):(y=$r(k),y.c(),q(y,1),y.m(s,null)):y&&(Qt(),Q(y,1,1,()=>{y=null}),te()),(!h||N[0]&128&&l!==(l="wa-select-"+k[7]))&&et(n,"id",l),(!h||N[0]&8&&c!==(c=k[3]?-1:0))&&et(n,"tabindex",c),(!h||N[0]&256)&&et(n,"style",k[8]),(!h||N[0]&512)&&le(n,"open",k[9]),(!h||N[0]&8)&&le(n,"disabled",k[3]),(!h||N[0]&1)&&le(n,"has-value",k[0]),k[9]?$?$.p(k,N):($=Cr(k),$.c(),$.m(t,null)):$&&($.d(1),$=null)},i(k){h||(q(v),q(y),h=!0)},o(k){Q(v),Q(y),h=!1},d(k){k&&gt(t),m&&m.d(),d.d(),v&&v.d(),y&&y.d(),r[25](null),$&&$.d(),g=!1,Pe(u)}}}function ao(r,t,e){let n,{items:a=[]}=t,{value:i=null}=t,{placeholder:s="Select..."}=t,{label:o=""}=t,{disabled:l=!1}=t,{searchable:c=!1}=t,{clearable:f=!1}=t,{showChevron:h=!0}=t,{name:g=""}=t,{containerStyles:u=""}=t,m=!1,p="",b=[],d=-1,v,y,$,k=null;const N=hi();function A(){return i?typeof i=="string"?i:i.value||"":""}function I(){p?e(10,b=a.filter(M=>M.label.toLowerCase().includes(p.toLowerCase())||M.value.toLowerCase().includes(p.toLowerCase()))):e(10,b=a),e(14,d=-1)}function P(){l||m||(e(9,m=!0),e(13,p=""),I(),c&&setTimeout(()=>{$&&$.focus()},0),v&&y&&J())}function T(){e(9,m=!1),e(13,p=""),e(14,d=-1)}function J(){if(!v||!y)return;const M=[ba(6),ya({padding:8,fallbackAxisSideDirection:"end"}),_a({padding:8}),ka({padding:8,apply({availableHeight:K}){Object.assign(y.style,{maxHeight:`${Math.min(K-10,350)}px`,width:`${v.offsetWidth}px`})}})];k=va(v,y,async()=>{const{computePosition:K}=await Promise.resolve().then(()=>gs),{x:Ct,y:At,placement:wt}=await K(v,y,{middleware:M,placement:"bottom-start"});y.setAttribute("data-placement",wt),Object.assign(y.style,{left:`${Ct}px`,top:`${At}px`})})}function E(M){e(0,i=M),T(),N("select",M)}function R(M){M.stopPropagation(),e(0,i=null),T(),N("clear")}function _(M){if(!m){(M.key==="Enter"||M.key===" ")&&(M.preventDefault(),P());return}switch(M.key){case"ArrowDown":M.preventDefault(),e(14,d=Math.min(d+1,b.length-1)),U();break;case"ArrowUp":M.preventDefault(),e(14,d=Math.max(d-1,-1)),U();break;case"Enter":M.preventDefault(),d>=0?E(b[d]):T();break;case"Escape":M.preventDefault(),T();break}}function U(){if(d<0)return;const M=document.querySelector(`[data-select-index="${d}"]`);M&&M.scrollIntoView({block:"nearest"})}function at(M){e(13,p=M.target.value),I()}function V(M){if(m&&v&&y){const K=M.target;!v.contains(K)&&!y.contains(K)&&T()}}di(()=>{document.addEventListener("click",V),I()}),Wn(()=>{document.removeEventListener("click",V),k&&k()});function it(M){rn[M?"unshift":"push"](()=>{v=M,e(11,v)})}const Z=()=>m?T():P();function ct(M){rn[M?"unshift":"push"](()=>{$=M,e(15,$)})}const z=M=>E(M),O=M=>e(14,d=M);function st(M){rn[M?"unshift":"push"](()=>{y=M,e(12,y),e(9,m),e(11,v)})}return r.$$set=M=>{"items"in M&&e(24,a=M.items),"value"in M&&e(0,i=M.value),"placeholder"in M&&e(1,s=M.placeholder),"label"in M&&e(2,o=M.label),"disabled"in M&&e(3,l=M.disabled),"searchable"in M&&e(4,c=M.searchable),"clearable"in M&&e(5,f=M.clearable),"showChevron"in M&&e(6,h=M.showChevron),"name"in M&&e(7,g=M.name),"containerStyles"in M&&e(8,u=M.containerStyles)},r.$$.update=()=>{var M;if(r.$$.dirty[0]&16777219&&e(16,n=i?typeof i=="string"?((M=a.find(K=>K.value===i))==null?void 0:M.label)||i:i.label||s:s),r.$$.dirty[0]&1025&&i!==void 0&&b.length>0){const K=A();e(14,d=b.findIndex(Ct=>Ct.value===K))}r.$$.dirty[0]&6656&&m&&y&&v&&(e(12,y.style.width=`${v.offsetWidth}px`,y),e(12,y.style.top=`${v.offsetTop+v.offsetHeight+6}px`,y))},I(),[i,s,o,l,c,f,h,g,u,m,b,v,y,p,d,$,n,A,P,T,E,R,_,at,a,it,Z,ct,z,O,st]}class io extends Vt{constructor(t){super(),Ht(this,t,ao,ro,Lt,{items:24,value:0,placeholder:1,label:2,disabled:3,searchable:4,clearable:5,showChevron:6,name:7,containerStyles:8},null,[-1,-1])}}class xr extends D.Modal{constructor(t,e,n,a="draft"){super(t),this.name=e,this.onConfirm=n,this.type=a}onOpen(){const{contentEl:t}=this;t.addClass("wa-centered-modal");const e=this.type==="chapter"?"chapter":"draft";t.createEl("h3",{text:`Delete ${e} '${this.name}'?`}),this.type==="draft"&&t.createEl("p",{text:"This will create a backup copy before deleting."});const n=t.createDiv({cls:"modal-button-row wa-button-group"}),a=n.createEl("button",{text:"Delete",cls:"mod-cta wa-button"}),i=n.createEl("button",{text:"Cancel",cls:"wa-button"});a.onclick=async()=>{F(`${S} ConfirmDeleteModal: confirmed delete for ${this.type} "${this.name}"`),this.close(),await this.onConfirm()},i.onclick=()=>{F(`${S} ConfirmDeleteModal: cancelled delete for ${this.type} "${this.name}"`),this.close()}}}class so extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:`Duplicate Draft: ${this.props.sourceDraftName}`});let e="";new D.Setting(t).setName("New draft name").addText(n=>n.setPlaceholder(this.props.suggestedName).setValue(this.props.suggestedName).onChange(a=>e=a)),new D.Setting(t).addButton(n=>n.setButtonText("Duplicate").setCta().onClick(()=>{const a=e&&e.trim()?e.trim():this.props.suggestedName;F(`${S} DuplicateDraftModal: duplicating draft from "${this.props.sourceDraftName}" to "${a}"`),this.close(),this.props.onSubmit(a)}))}onClose(){this.contentEl.empty()}}class oo extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Chapter"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New chapter name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new chapter name",cls:"wa-rename-input",attr:{"aria-label":"New chapter name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n,a;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Chapter name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameChapterModal: renaming chapter from "${this.oldName}" to "${t}"`),this.onSubmit(t),this.close()}}class lo extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var s;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Draft"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("label",{cls:"wa-rename-checkbox-label"});this.checkboxEl=n.createEl("input",{type:"checkbox",attr:{checked:"checked"}}),n.appendText(" Also rename the main draft file (filename)");const a=t.createEl("div",{cls:"wa-rename-btn-row"}),i=a.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=a.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var o,l;(o=this.inputEl)==null||o.focus(),(l=this.inputEl)==null||l.select()},0),(s=this.inputEl)==null||s.addEventListener("keydown",o=>{o.key==="Enter"?this.submit():o.key==="Escape"&&this.close()}),i.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var n,a,i;const t=(n=this.inputEl)==null?void 0:n.value.trim(),e=this.checkboxEl?this.checkboxEl.checked:!1;if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(i=this.inputEl)==null||i.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameDraftModal: renaming draft from "${this.oldName}" to "${t}", renameFile: ${e}`),this.onSubmit(t,e),this.close()}}function Da(r){const t=r-1;return t*t*t+1}function co(r,{from:t,to:e},n={}){const a=getComputedStyle(r),i=a.transform==="none"?"":a.transform,[s,o]=a.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*s/e.width-(e.left+s),c=t.top+t.height*o/e.height-(e.top+o),{delay:f=0,duration:h=u=>Math.sqrt(u)*120,easing:g=Da}=n;return{delay:f,duration:sn(h)?h(Math.sqrt(l*l+c*c)):h,easing:g,css:(u,m)=>{const p=m*l,b=m*c,d=u+m*t.width/e.width,v=u+m*t.height/e.height;return`transform: ${i} translate(${p}px, ${b}px) scale(${d}, ${v});`}}}function Er(r,t,e){const n=r.slice();return n[68]=t[e],n[70]=e,n}function Dr(r,t,e){const n=r.slice();return n[71]=t[e],n}function fo(r){let t,e;return t=new xa({}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function uo(r){let t;return{c(){t=Wt("New Project")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Pr(r){let t;return{c(){t=ot("div"),t.textContent="No projects found.",et(t,"class","wa-muted"),Fe(t,"margin","4rem auto 0"),Fe(t,"font-size","18px"),Fe(t,"width","fit-content")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function jr(r){let t,e,n,a,i,s;return i=new io({props:{name:"wa-project-select",value:r[3],items:r[7],placeholder:"Choose a project...",showChevron:!0,disabled:Ro,clearable:!1,searchable:!1}}),i.$on("select",r[42]),{c(){t=ot("div"),e=ot("label"),e.textContent="Select project",n=vt(),a=ot("div"),pt(i.$$.fragment),et(e,"for","wa-project-select"),et(a,"class","wa-row"),Fe(t,"margin","20px 0")},m(o,l){bt(o,t,l),nt(t,e),nt(t,n),nt(t,a),ut(i,a,null),s=!0},p(o,l){const c={};l[0]&8&&(c.value=o[3]),l[0]&128&&(c.items=o[7]),i.$set(c)},i(o){s||(q(i.$$.fragment,o),s=!0)},o(o){Q(i.$$.fragment,o),s=!1},d(o){o&&gt(t),dt(i)}}}function Nr(r){let t,e,n,a,i,s,o,l,c,f,h,g,u,m,p,b;o=new ue({props:{ariaLabel:"Toggle draft sort order",title:void 0,clickHandler:r[43],$$slots:{default:[mo]},$$scope:{ctx:r}}}),f=new $e({props:{title:"New draft",clickHandler:r[23],variant:"primary",$$slots:{default:[go]},$$scope:{ctx:r}}}),g=new ue({props:{ariaLabel:"Refresh drafts",title:void 0,clickHandler:r[20],disabled:r[8],spinning:r[8],$$slots:{default:[wo]},$$scope:{ctx:r}}});let d=r[9]&&Ar(r),v=r[5].length===0&&Tr(),y=r[5].length>0&&Br(r);return{c(){t=ot("div"),e=ot("div"),n=ot("div"),a=ot("div"),i=ot("div"),i.textContent="Drafts",s=vt(),pt(o.$$.fragment),l=vt(),c=ot("div"),pt(f.$$.fragment),h=vt(),pt(g.$$.fragment),u=vt(),d&&d.c(),m=vt(),v&&v.c(),p=vt(),y&&y.c(),et(i,"class","wa-title"),et(a,"class","wa-button-group"),et(c,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","draft-controls"),Fe(t,"margin-top","16px")},m($,k){bt($,t,k),nt(t,e),nt(e,n),nt(n,a),nt(a,i),nt(a,s),ut(o,a,null),nt(n,l),nt(n,c),ut(f,c,null),nt(c,h),ut(g,c,null),nt(t,u),d&&d.m(t,null),nt(t,m),v&&v.m(t,null),nt(t,p),y&&y.m(t,null),b=!0},p($,k){const N={};k[0]&2048&&(N.clickHandler=$[43]),k[0]&2048|k[2]&4096&&(N.$$scope={dirty:k,ctx:$}),o.$set(N);const A={};k[2]&4096&&(A.$$scope={dirty:k,ctx:$}),f.$set(A);const I={};k[0]&256&&(I.disabled=$[8]),k[0]&256&&(I.spinning=$[8]),k[2]&4096&&(I.$$scope={dirty:k,ctx:$}),g.$set(I),$[9]?d?(d.p($,k),k[0]&512&&q(d,1)):(d=Ar($),d.c(),q(d,1),d.m(t,m)):d&&(Qt(),Q(d,1,1,()=>{d=null}),te()),$[5].length===0?v||(v=Tr(),v.c(),v.m(t,p)):v&&(v.d(1),v=null),$[5].length>0?y?(y.p($,k),k[0]&32&&q(y,1)):(y=Br($),y.c(),q(y,1),y.m(t,null)):y&&(Qt(),Q(y,1,1,()=>{y=null}),te())},i($){b||(q(o.$$.fragment,$),q(f.$$.fragment,$),q(g.$$.fragment,$),q(d),q(y),b=!0)},o($){Q(o.$$.fragment,$),Q(f.$$.fragment,$),Q(g.$$.fragment,$),Q(d),Q(y),b=!1},d($){$&&gt(t),dt(o),dt(f),dt(g),d&&d.d(),v&&v.d(),y&&y.d()}}}function ho(r){let t,e;return t=new $a({}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function po(r){let t,e;return t=new Ca({}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function mo(r){let t,e,n,a;const i=[po,ho],s=[];function o(l,c){return l[11]?0:1}return t=o(r),e=s[t]=i[t](r),{c(){e.c(),n=Cn()},m(l,c){s[t].m(l,c),bt(l,n,c),a=!0},p(l,c){let f=t;t=o(l),t!==f&&(Qt(),Q(s[f],1,1,()=>{s[f]=null}),te(),e=s[t],e||(e=s[t]=i[t](l),e.c()),q(e,1),e.m(n.parentNode,n))},i(l){a||(q(e),a=!0)},o(l){Q(e),a=!1},d(l){l&&gt(n),s[t].d(l)}}}function go(r){let t;return{c(){t=Wt("New Draft")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function wo(r){let t,e;return t=new xa({}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ar(r){let t,e,n,a,i,s,o,l,c;return a=new $e({props:{clickHandler:r[22],variant:"primary",$$slots:{default:[vo]},$$scope:{ctx:r}}}),s=new $e({props:{clickHandler:r[45],$$slots:{default:[bo]},$$scope:{ctx:r}}}),{c(){t=ot("div"),e=ot("input"),n=vt(),pt(a.$$.fragment),i=vt(),pt(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Draft name"),et(t,"class","create-inline wa-row")},m(f,h){bt(f,t,h),nt(t,e),vn(e,r[10]),nt(t,n),ut(a,t,null),nt(t,i),ut(s,t,null),o=!0,l||(c=me(e,"input",r[44]),l=!0)},p(f,h){h[0]&1024&&e.value!==f[10]&&vn(e,f[10]);const g={};h[2]&4096&&(g.$$scope={dirty:h,ctx:f}),a.$set(g);const u={};h[0]&1536&&(u.clickHandler=f[45]),h[2]&4096&&(u.$$scope={dirty:h,ctx:f}),s.$set(u)},i(f){o||(q(a.$$.fragment,f),q(s.$$.fragment,f),o=!0)},o(f){Q(a.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&gt(t),dt(a),dt(s),l=!1,c()}}}function vo(r){let t;return{c(){t=Wt("Create")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function bo(r){let t;return{c(){t=Wt("Cancel")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Tr(r){let t;return{c(){t=ot("div"),t.textContent="No drafts found."},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Br(r){let t,e,n=xe(r[5]),a=[];for(let s=0;s<n.length;s+=1)a[s]=Ir(Dr(r,n,s));const i=s=>Q(a[s],1,1,()=>{a[s]=null});return{c(){t=ot("div");for(let s=0;s<a.length;s+=1)a[s].c();et(t,"class","wa-draft-list")},m(s,o){bt(s,t,o);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(t,null);e=!0},p(s,o){if(o[0]&251662368|o[1]&8){n=xe(s[5]);let l;for(l=0;l<n.length;l+=1){const c=Dr(s,n,l);a[l]?(a[l].p(c,o),q(a[l],1)):(a[l]=Ir(c),a[l].c(),q(a[l],1),a[l].m(t,null))}for(Qt(),l=n.length;l<a.length;l+=1)i(l);te()}},i(s){if(!e){for(let o=0;o<n.length;o+=1)q(a[o]);e=!0}},o(s){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)Q(a[o]);e=!1},d(s){s&&gt(t),na(a,s)}}}function Or(r){let t;return{c(){t=ot("span"),t.textContent="●",et(t,"class","wa-draft-active-indicator"),et(t,"title","Active draft")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function _o(r){let t,e;return t=new Sa({props:{size:je}}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Rr(r){let t,e;function n(){return r[47](r[71])}return t=new ue({props:{ariaLabel:"Set active draft",title:void 0,clickHandler:n,$$slots:{default:[yo]},$$scope:{ctx:r}}}),{c(){pt(t.$$.fragment)},m(a,i){ut(t,a,i),e=!0},p(a,i){r=a;const s={};i[0]&32&&(s.clickHandler=n),i[2]&4096&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(a){e||(q(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function yo(r){let t,e;return t=new Es({props:{size:je}}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function ko(r){let t,e;return t=new Fa({props:{size:je}}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function $o(r){let t,e;return t=new Os({props:{size:je}}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Co(r){let t,e;return t=new Ea({props:{size:je}}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ir(r){let t,e,n,a=r[71]+"",i,s,o,l,c,f,h,g,u,m,p,b,d,v,y=r[12]===r[71]&&Or();function $(){return r[46](r[71])}l=new ue({props:{ariaLabel:"Open draft",title:void 0,clickHandler:$,$$slots:{default:[_o]},$$scope:{ctx:r}}});let k=r[12]!==r[71]&&Rr(r);function N(){return r[48](r[71])}h=new ue({props:{ariaLabel:"Rename draft",title:void 0,clickHandler:N,$$slots:{default:[ko]},$$scope:{ctx:r}}});function A(){return r[49](r[71])}u=new ue({props:{ariaLabel:"Duplicate draft",title:void 0,clickHandler:A,$$slots:{default:[$o]},$$scope:{ctx:r}}});function I(){return r[50](r[71])}return p=new ue({props:{ariaLabel:"Delete draft",title:void 0,clickHandler:I,$$slots:{default:[Co]},$$scope:{ctx:r}}}),{c(){t=ot("div"),e=ot("div"),y&&y.c(),n=vt(),i=Wt(a),s=vt(),o=ot("div"),pt(l.$$.fragment),c=vt(),k&&k.c(),f=vt(),pt(h.$$.fragment),g=vt(),pt(u.$$.fragment),m=vt(),pt(p.$$.fragment),b=vt(),et(e,"class","wa-draft-name wa-row"),et(o,"class","wa-draft-actions"),et(t,"class",d="wa-draft-item "+(r[12]===r[71]?"active":""))},m(P,T){bt(P,t,T),nt(t,e),y&&y.m(e,null),nt(e,n),nt(e,i),nt(t,s),nt(t,o),ut(l,o,null),nt(o,c),k&&k.m(o,null),nt(o,f),ut(h,o,null),nt(o,g),ut(u,o,null),nt(o,m),ut(p,o,null),nt(t,b),v=!0},p(P,T){r=P,r[12]===r[71]?y||(y=Or(),y.c(),y.m(e,n)):y&&(y.d(1),y=null),(!v||T[0]&32)&&a!==(a=r[71]+"")&&Je(i,a);const J={};T[0]&32&&(J.clickHandler=$),T[2]&4096&&(J.$$scope={dirty:T,ctx:r}),l.$set(J),r[12]!==r[71]?k?(k.p(r,T),T[0]&4128&&q(k,1)):(k=Rr(r),k.c(),q(k,1),k.m(o,f)):k&&(Qt(),Q(k,1,1,()=>{k=null}),te());const E={};T[0]&32&&(E.clickHandler=N),T[2]&4096&&(E.$$scope={dirty:T,ctx:r}),h.$set(E);const R={};T[0]&32&&(R.clickHandler=A),T[2]&4096&&(R.$$scope={dirty:T,ctx:r}),u.$set(R);const _={};T[0]&32&&(_.clickHandler=I),T[2]&4096&&(_.$$scope={dirty:T,ctx:r}),p.$set(_),(!v||T[0]&4128&&d!==(d="wa-draft-item "+(r[12]===r[71]?"active":"")))&&et(t,"class",d)},i(P){v||(q(l.$$.fragment,P),q(k),q(h.$$.fragment,P),q(u.$$.fragment,P),q(p.$$.fragment,P),v=!0)},o(P){Q(l.$$.fragment,P),Q(k),Q(h.$$.fragment,P),Q(u.$$.fragment,P),Q(p.$$.fragment,P),v=!1},d(P){P&&gt(t),y&&y.d(),dt(l),k&&k.d(),dt(h),dt(u),dt(p)}}}function zr(r){let t,e,n,a,i,s,o,l,c,f,h,g;o=new $e({props:{clickHandler:r[51],variant:"primary",$$slots:{default:[So]},$$scope:{ctx:r}}});let u=r[15]&&Lr(r);const m=[Po,Do,Eo],p=[];function b(d,v){return d[14]?0:d[13].length===0?1:2}return f=b(r),h=p[f]=m[f](r),{c(){t=ot("div"),e=ot("div"),n=ot("div"),a=ot("div"),a.textContent="Chapters",i=vt(),s=ot("div"),pt(o.$$.fragment),l=vt(),u&&u.c(),c=vt(),h.c(),et(a,"class","wa-title"),et(s,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","chapter-controls"),Fe(t,"margin-top","18px")},m(d,v){bt(d,t,v),nt(t,e),nt(e,n),nt(n,a),nt(n,i),nt(n,s),ut(o,s,null),nt(t,l),u&&u.m(t,null),nt(t,c),p[f].m(t,null),g=!0},p(d,v){const y={};v[0]&32768&&(y.clickHandler=d[51]),v[2]&4096&&(y.$$scope={dirty:v,ctx:d}),o.$set(y),d[15]?u?(u.p(d,v),v[0]&32768&&q(u,1)):(u=Lr(d),u.c(),q(u,1),u.m(t,c)):u&&(Qt(),Q(u,1,1,()=>{u=null}),te());let $=f;f=b(d),f===$?p[f].p(d,v):(Qt(),Q(p[$],1,1,()=>{p[$]=null}),te(),h=p[f],h?h.p(d,v):(h=p[f]=m[f](d),h.c()),q(h,1),h.m(t,null))},i(d){g||(q(o.$$.fragment,d),q(u),q(h),g=!0)},o(d){Q(o.$$.fragment,d),Q(u),Q(h),g=!1},d(d){d&&gt(t),dt(o),u&&u.d(),p[f].d()}}}function So(r){let t;return{c(){t=Wt("New Chapter")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Lr(r){let t,e,n,a,i,s,o,l,c;return a=new $e({props:{clickHandler:r[53],variant:"primary",$$slots:{default:[Fo]},$$scope:{ctx:r}}}),s=new $e({props:{clickHandler:r[54],$$slots:{default:[xo]},$$scope:{ctx:r}}}),{c(){t=ot("div"),e=ot("input"),n=vt(),pt(a.$$.fragment),i=vt(),pt(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Chapter name"),et(t,"class","create-inline wa-row")},m(f,h){bt(f,t,h),nt(t,e),vn(e,r[16]),nt(t,n),ut(a,t,null),nt(t,i),ut(s,t,null),o=!0,l||(c=me(e,"input",r[52]),l=!0)},p(f,h){h[0]&65536&&e.value!==f[16]&&vn(e,f[16]);const g={};h[0]&229393&&(g.clickHandler=f[53]),h[2]&4096&&(g.$$scope={dirty:h,ctx:f}),a.$set(g);const u={};h[0]&229376&&(u.clickHandler=f[54]),h[2]&4096&&(u.$$scope={dirty:h,ctx:f}),s.$set(u)},i(f){o||(q(a.$$.fragment,f),q(s.$$.fragment,f),o=!0)},o(f){Q(a.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&gt(t),dt(a),dt(s),l=!1,c()}}}function Fo(r){let t;return{c(){t=Wt("Create")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function xo(r){let t;return{c(){t=Wt("Cancel")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Eo(r){let t,e=[],n=new Map,a,i=xe(r[13]);const s=o=>o[68].chapterName;for(let o=0;o<i.length;o+=1){let l=Er(r,i,o),c=s(l);n.set(c,e[o]=Mr(c,l))}return{c(){t=ot("div");for(let o=0;o<e.length;o+=1)e[o].c();et(t,"class","wa-draft-list")},m(o,l){bt(o,t,l);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);a=!0},p(o,l){if(l[0]&1610620928|l[1]&7){i=xe(o[13]),Qt();for(let c=0;c<e.length;c+=1)e[c].r();e=ia(e,l,s,1,o,i,n,t,_i,Mr,null,Er);for(let c=0;c<e.length;c+=1)e[c].a();te()}},i(o){if(!a){for(let l=0;l<i.length;l+=1)q(e[l]);a=!0}},o(o){for(let l=0;l<e.length;l+=1)Q(e[l]);a=!1},d(o){o&&gt(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function Do(r){let t;return{c(){t=ot("div"),t.textContent="No chapters found.",Fe(t,"margin-top","1em")},m(e,n){bt(e,t,n)},p:Dt,i:Dt,o:Dt,d(e){e&&gt(t)}}}function Po(r){let t;return{c(){t=ot("div"),t.textContent="Loading chapters..."},m(e,n){bt(e,t,n)},p:Dt,i:Dt,o:Dt,d(e){e&&gt(t)}}}function jo(r){let t,e;return t=new Ca({}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function No(r){let t,e;return t=new $a({}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ao(r){let t,e;return t=new Sa({props:{size:je}}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function To(r){let t,e;return t=new Fa({props:{size:je}}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Bo(r){let t,e;return t=new Ea({props:{size:je}}),{c(){pt(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Mr(r,t){let e,n,a=t[68].chapterName+"",i,s,o,l,c,f,h,g,u,m,p,b,d,v,y=Dt,$;function k(){return t[55](t[70])}l=new $e({props:{title:"Move chapter up",clickHandler:k,disabled:t[70]===0,$$slots:{default:[jo]},$$scope:{ctx:t}}});function N(){return t[56](t[70])}f=new $e({props:{title:"Move chapter down",clickHandler:N,disabled:t[70]===t[13].length-1,$$slots:{default:[No]},$$scope:{ctx:t}}});function A(){return t[57](t[68])}g=new ue({props:{ariaLabel:"Open chapter",title:void 0,clickHandler:A,$$slots:{default:[Ao]},$$scope:{ctx:t}}});function I(){return t[58](t[68])}m=new ue({props:{ariaLabel:"Rename chapter",title:void 0,clickHandler:I,$$slots:{default:[To]},$$scope:{ctx:t}}});function P(){return t[59](t[68])}return b=new ue({props:{ariaLabel:"Delete chapter",title:void 0,clickHandler:P,$$slots:{default:[Bo]},$$scope:{ctx:t}}}),{key:r,first:null,c(){e=ot("div"),n=ot("div"),i=Wt(a),s=vt(),o=ot("div"),pt(l.$$.fragment),c=vt(),pt(f.$$.fragment),h=vt(),pt(g.$$.fragment),u=vt(),pt(m.$$.fragment),p=vt(),pt(b.$$.fragment),d=vt(),et(n,"class","wa-draft-name"),et(o,"class","wa-draft-actions"),et(e,"class","wa-draft-item"),this.first=e},m(T,J){bt(T,e,J),nt(e,n),nt(n,i),nt(e,s),nt(e,o),ut(l,o,null),nt(o,c),ut(f,o,null),nt(o,h),ut(g,o,null),nt(o,u),ut(m,o,null),nt(o,p),ut(b,o,null),nt(e,d),$=!0},p(T,J){t=T,(!$||J[0]&8192)&&a!==(a=t[68].chapterName+"")&&Je(i,a);const E={};J[0]&8192&&(E.clickHandler=k),J[0]&8192&&(E.disabled=t[70]===0),J[2]&4096&&(E.$$scope={dirty:J,ctx:t}),l.$set(E);const R={};J[0]&8192&&(R.clickHandler=N),J[0]&8192&&(R.disabled=t[70]===t[13].length-1),J[2]&4096&&(R.$$scope={dirty:J,ctx:t}),f.$set(R);const _={};J[0]&8192&&(_.clickHandler=A),J[2]&4096&&(_.$$scope={dirty:J,ctx:t}),g.$set(_);const U={};J[0]&8192&&(U.clickHandler=I),J[2]&4096&&(U.$$scope={dirty:J,ctx:t}),m.$set(U);const at={};J[0]&8192&&(at.clickHandler=P),J[2]&4096&&(at.$$scope={dirty:J,ctx:t}),b.$set(at)},r(){v=e.getBoundingClientRect()},f(){fi(e),y()},a(){y(),y=ci(e,v,co,{duration:500,easing:Da})},i(T){$||(q(l.$$.fragment,T),q(f.$$.fragment,T),q(g.$$.fragment,T),q(m.$$.fragment,T),q(b.$$.fragment,T),$=!0)},o(T){Q(l.$$.fragment,T),Q(f.$$.fragment,T),Q(g.$$.fragment,T),Q(m.$$.fragment,T),Q(b.$$.fragment,T),$=!1},d(T){T&&gt(e),dt(l),dt(f),dt(g),dt(m),dt(b)}}}function Oo(r){var y;let t,e,n,a,i,s,o,l,c,f,h,g,u,m;s=new ue({props:{ariaLabel:"Refresh projects",clickHandler:r[41],title:void 0,spinning:r[6],$$slots:{default:[fo]},$$scope:{ctx:r}}}),c=new $e({props:{title:"Create New Project",clickHandler:r[35],variant:"primary",style:"width: 40%; margin: 0 auto;",$$slots:{default:[uo]},$$scope:{ctx:r}}});let p=r[2].length===0&&Pr(),b=r[2].length>0&&jr(r),d=r[4]&&Nr(r),v=r[4]&&((y=r[0])==null?void 0:y.activeDraft)&&r[18]&&zr(r);return{c(){t=ot("div"),e=ot("div"),n=ot("div"),n.textContent=`${Et} Projects`,a=vt(),i=ot("div"),pt(s.$$.fragment),o=vt(),l=ot("div"),pt(c.$$.fragment),f=vt(),p&&p.c(),h=vt(),b&&b.c(),g=vt(),d&&d.c(),u=vt(),v&&v.c(),et(n,"class","wa-title"),et(e,"class","wa-row justify-between"),et(l,"class","wa-row"),Fe(l,"margin","18px 0 10px 0"),et(t,"class","project-list wa-panel")},m($,k){bt($,t,k),nt(t,e),nt(e,n),nt(e,a),nt(e,i),ut(s,i,null),nt(t,o),nt(t,l),ut(c,l,null),nt(t,f),p&&p.m(t,null),nt(t,h),b&&b.m(t,null),nt(t,g),d&&d.m(t,null),nt(t,u),v&&v.m(t,null),m=!0},p($,k){var I;const N={};k[0]&64&&(N.spinning=$[6]),k[2]&4096&&(N.$$scope={dirty:k,ctx:$}),s.$set(N);const A={};k[2]&4096&&(A.$$scope={dirty:k,ctx:$}),c.$set(A),$[2].length===0?p||(p=Pr(),p.c(),p.m(t,h)):p&&(p.d(1),p=null),$[2].length>0?b?(b.p($,k),k[0]&4&&q(b,1)):(b=jr($),b.c(),q(b,1),b.m(t,g)):b&&(Qt(),Q(b,1,1,()=>{b=null}),te()),$[4]?d?(d.p($,k),k[0]&16&&q(d,1)):(d=Nr($),d.c(),q(d,1),d.m(t,u)):d&&(Qt(),Q(d,1,1,()=>{d=null}),te()),$[4]&&((I=$[0])!=null&&I.activeDraft)&&$[18]?v?(v.p($,k),k[0]&262161&&q(v,1)):(v=zr($),v.c(),q(v,1),v.m(t,null)):v&&(Qt(),Q(v,1,1,()=>{v=null}),te())},i($){m||(q(s.$$.fragment,$),q(c.$$.fragment,$),q(b),q(d),q(v),m=!0)},o($){Q(s.$$.fragment,$),Q(c.$$.fragment,$),Q(b),Q(d),Q(v),m=!1},d($){$&&gt(t),dt(s),dt(c),p&&p.d(),b&&b.d(),d&&d.d(),v&&v.d()}}}let Ro=!1,Io="";const je=20;let zo=null;function Lo(r,t,e){let{manager:n}=t,{projectService:a}=t,{projectFileService:i}=t,s=null,o=[],l,c=null,f=[],h=!1,g=[],u=!1,m=!1,p="",b=!0,d=null,v=null,y=[],$=!1,k=!1,N="",A="",I=!1,P=!1,T=null,J=0;Wn(()=>{try{n&&v&&n.removeActiveProjectListener(v),T&&clearTimeout(T)}catch{}});async function E(Y=!1){if(!a)return[];e(6,h=!0);const ft=new Promise(Tt=>setTimeout(Tt,400)),yt=[...o],ht=s;let Ot=[],jt=[];try{Ot=a.listAllFolders(),jt=[];for(const Tt of Ot)await a.isProjectFolder(Tt)&&jt.push(Tt)}catch{jt=[]}const It=jt.filter(Tt=>!yt.includes(Tt)),Ce=yt.filter(Tt=>!jt.includes(Tt));Y&&It.length>0&&new D.Notice(`${It.length} new project${It.length>1?"s":""} discovered.`),Y&&Ce.length>0&&new D.Notice(`${Ce.length} project${Ce.length>1?"s":""} removed.`),e(2,o=jt),e(7,g=jt.map(Tt=>({value:Tt,label:Tt})));let oe=null;if(jt.length===0)e(1,s=null),e(3,l=void 0),e(4,c=null),oe=null;else if(jt.length===1){e(1,s=jt[0]),e(3,l=g[0]),e(4,c=jt[0]),oe=jt[0];try{F(`${S} panel refresh selected single project '${c}'`)}catch{}}else if(ht&&!jt.includes(ht)){e(1,s=jt[0]),e(3,l=g[0]),e(4,c=jt[0]),oe=jt[0];try{F(`${S} panel refresh selected fallback project '${c}'`)}catch{}}else if(ht){const Tt=g.find(Ne=>Ne.value===ht);if(Tt){e(1,s=ht),e(3,l=Tt),e(4,c=Tt.value),oe=ht;try{F(`${S} panel refresh kept project '${c}'`)}catch{}}else e(1,s=null),e(3,l=void 0),e(4,c=null),oe=null}else e(1,s=null),e(3,l=void 0),e(4,c=null),oe=null;return n&&oe!==ht&&(F(`${S} panel refresh: active project changed from '${ht}' to '${oe}'`),n!=null&&n.setActiveProject&&await n.setActiveProject(oe)),await ft,e(6,h=!1),c&&await R(),c&&(n!=null&&n.activeDraft)&&await _(),jt}async function R(){if(!i||!c){e(5,f=[]);return}const Y=d;e(8,u=!0);const ft=new Promise(yt=>setTimeout(yt,400));try{e(5,f=i.drafts.listDrafts(c)||[]),e(5,f=Array.from(f)),f.sort((yt,ht)=>yt>ht?1:yt<ht?-1:0),b||f.reverse();try{F(`${S} refreshDrafts: loaded ${f.length} drafts, preserving active draft: ${Y}`)}catch{}}catch{e(5,f=[])}finally{await ft,e(8,u=!1)}}async function _(){if(!n||!i)return;const Y=Date.now();if(Y-J<500){T&&clearTimeout(T),T=setTimeout(()=>{U()},500);return}J=Y,T&&clearTimeout(T),T=null,await U()}async function U(){if(!n||!i)return;e(14,$=!0);const Y=new Promise(ft=>setTimeout(ft,400));try{if(!c){e(13,y=[]),e(18,I=!1);return}const ft=`${c}/${Gt(n==null?void 0:n.settings)}`,yt=await ke(n.app,ft);if(e(18,I=(yt==null?void 0:yt.project_type)==="multi-file"),!I){e(13,y=[]);return}if(!(n!=null&&n.activeDraft)){e(13,y=[]);return}let ht=[];ht=await i.chapters.listChapters(c,n.activeDraft),e(13,y=Array.isArray(ht)?ht:[])}catch{e(13,y=[]),e(18,I=!1)}finally{await Y,e(14,$=!1)}}async function at(){if(!n||!c||!p.trim())return;const Y=p.trim();try{await n.createNewDraft(Y,Io||void 0,c),e(12,d=n.activeDraft),new D.Notice(`Draft "${Y}" created.`)}catch(ft){F(`${S} Failed to create draft:`,ft),new D.Notice("Failed to create draft.")}e(10,p=""),e(9,m=!1),await R()}async function V(){e(9,m=!0)}async function it(Y){if(!i||!n||!c)return;let ft=!1;ft=await i.drafts.openDraft(c,Y),ft||n!=null&&n.setActiveDraft&&await n.setActiveDraft(Y,c),await R(),await _()}async function Z(Y){if(!n||!c)return;const ft=`${Y} Copy`;new so(n.app,{sourceDraftName:Y,suggestedName:ft,onSubmit:async yt=>{if(n)try{await n.createNewDraft(yt,Y,c||void 0),await R(),new D.Notice(`Draft '${yt}' created as duplicate of '${Y}'.`)}catch(ht){F(`${S} Failed to duplicate draft:`,ht),new D.Notice("Failed to duplicate draft.")}}}).open()}async function ct(Y){if(!n||!c)return;new lo(n.app,Y,async(yt,ht)=>{try{F(`${S} renameDraft: user entered: ${yt}, renameFile: ${ht}`),await n.renameDraft(Y,yt,c||void 0,ht),F(`${S} renameDraft: rename successful, refreshing drafts`),await R(),new D.Notice(`Draft '${Y}' renamed to '${yt}'.`)}catch(Ot){F(`${S} renameDraft: error:`,Ot),new D.Notice("Failed to rename draft.")}}).open()}async function z(Y){if(!n||!c)return;new xr(n.app,Y,async()=>{n&&(await n.deleteDraft(Y,c||void 0),await R())},"draft").open()}async function O(Y){Y&&(n!=null&&n.setActiveProject&&await n.setActiveProject(Y),e(1,s=Y),e(4,c=Y),e(12,d=(n==null?void 0:n.activeDraft)??null),await R(),await _())}async function st(Y){if(Y===0||!n||!c||!n.activeDraft)return;const ft=y.slice();[ft[Y-1],ft[Y]]=[ft[Y],ft[Y-1]];const yt=ft.map((ht,Ot)=>({chapterName:ht.chapterName||"",order:Ot+1}));await n.reorderChapters(c,n.activeDraft,yt),await _()}async function M(Y){if(Y===y.length-1||!n||!c||!n.activeDraft)return;const ft=y.slice();[ft[Y],ft[Y+1]]=[ft[Y+1],ft[Y]];const yt=ft.map((ht,Ot)=>({chapterName:ht.chapterName||"",order:Ot+1}));await n.reorderChapters(c,n.activeDraft,yt),await _()}async function K(Y){!c||!(n!=null&&n.activeDraft)||await n.openChapter(c,n.activeDraft,Y)}function Ct(Y){if(!c||!(n!=null&&n.activeDraft))return;new oo(n.app,Y,async yt=>{!(n!=null&&n.activeDraft)||!c||(await n.renameChapter(c,n.activeDraft,Y,yt),await _())}).open()}function At(Y){new xr(n.app,Y,async()=>{!(n!=null&&n.activeDraft)||!c||(await n.deleteChapter(c,n.activeDraft,Y),await _())},"chapter").open()}async function wt(Y){c&&(n!=null&&n.setActiveDraft&&await n.setActiveDraft(Y,c),e(12,d=(n==null?void 0:n.activeDraft)??null),await R(),await _())}async function $t(){if(!n||!a)return;const Y=n.app,{CreateProjectModal:ft}=await Promise.resolve().then(()=>ol);let yt=null;new ft(Y,async(Ot,jt,It)=>{if(!Ot||!n||!a)return;const Ce=n.listAllFolders();if((await Se(Ce,Kt=>n.projectService.isProjectFolder(Kt))).map(Kt=>Kt.split("/").pop()||Kt).includes(Ot)){new D.Notice(`A project with the name "${Ot}" already exists. Please choose a different name.`);return}if(yt=await a.createProject(Ot,jt,It,void 0,n.settings),!yt)return;let Ne=[],qt=null;for(let Kt=0;Kt<20;Kt++){await new Promise(Dn=>setTimeout(Dn,100)),Ne=await E();const Ae=Ne.find(Dn=>Dn===yt);if(qt=typeof Ae=="string"?Ae:null,qt)break}typeof qt=="string"&&qt&&(e(1,s=qt),e(3,l={value:qt,label:qt}),e(4,c=qt),n.setActiveDraft&&await n.setActiveDraft(It??"Draft 1",qt),await R(),await _(),n.openProject&&await n.openProject(qt))}).open()}let xt=null;Wn(()=>{Mt(()=>{n&&typeof n.removeActiveDraftListener=="function"&&xt&&n.removeActiveDraftListener(xt)}),Mt(()=>{n&&typeof n.removeActiveProjectListener=="function"&&v&&n.removeActiveProjectListener(v)})});const Pt=()=>E(!0),se=Y=>{const ft=Y.detail;e(3,l=ft),e(4,c=typeof ft=="string"?ft:ft?ft.value:void 0),e(1,s=c??null),O(c??null)},Yt=()=>{e(11,b=!b),R()};function w(){p=this.value,e(10,p)}const W=()=>{e(9,m=!1),e(10,p="")},L=Y=>it(Y),x=Y=>wt(Y),C=Y=>ct(Y),j=Y=>Z(Y),H=Y=>z(Y),G=()=>e(15,k=!k);function B(){N=this.value,e(16,N)}const X=async()=>{!c||!(n!=null&&n.activeDraft)||!N.trim()||(await n.createChapter(c,n.activeDraft,N.trim()),e(16,N=""),e(17,A=""),e(15,k=!1),await _())},rt=()=>{e(15,k=!1),e(16,N=""),e(17,A="")},tt=Y=>st(Y),lt=Y=>M(Y),St=Y=>K(Y.name),_t=Y=>Ct(Y.chapterName||""),Zt=Y=>At(Y.chapterName||"");return r.$$set=Y=>{"manager"in Y&&e(0,n=Y.manager),"projectService"in Y&&e(36,a=Y.projectService),"projectFileService"in Y&&e(37,i=Y.projectFileService)},r.$$.update=()=>{r.$$.dirty[0]&1|r.$$.dirty[1]&992&&n&&a&&i&&!P&&(e(39,P=!0),F(`${S} ProjectPanel initializing with manager`),e(12,d=n.activeDraft??null),e(1,s=n.activeProject??null),xt&&typeof n.removeActiveDraftListener=="function"&&n.removeActiveDraftListener(xt),e(40,xt=Y=>{e(12,d=Y),F(`${S} active draft updated -> ${Y}`),_()}),n.addActiveDraftListener(xt),v&&typeof n.removeActiveProjectListener=="function"&&n.removeActiveProjectListener(v),e(38,v=Y=>{e(1,s=Y),F(`${S} active project updated -> ${Y}`),Y?E():(e(3,l=void 0),e(4,c=null),e(5,f=[]),e(13,y=[]),e(18,I=!1))}),n.addActiveProjectListener(v),E())},[n,s,o,l,c,f,h,g,u,m,p,b,d,y,$,k,N,A,I,E,R,_,at,V,it,Z,ct,z,O,st,M,K,Ct,At,wt,$t,a,i,v,P,xt,Pt,se,Yt,w,W,L,x,C,j,H,G,B,X,rt,tt,lt,St,_t,Zt]}class Mo extends Vt{constructor(t){super(),Ht(this,t,Lo,Oo,Lt,{manager:0,projectService:36,projectFileService:37},null,[-1,-1,-1])}}const _e="writeaid-project-panel";class Uo extends D.ItemView{constructor(t,e,n){super(t),this.panelEl=null,this.selectedProject=null,this.app=e,this.manager=n,this.projectService=new gn(e),this.projectFileService=new Xn(e,this.projectService)}getViewType(){return _e}getDisplayText(){return`${Et} Projects`}getIcon(){return Yn}async onOpen(){this.panelEl=this.contentEl.createEl("div",{cls:"writeaid-project-panel"});try{if(!this.manager){F(`${S} Manager not available in ProjectPanelView.onOpen`),new D.Notice(`${Et}: manager not available, cannot mount project panel.`);return}F(`${S} Mounting ProjectPanel with manager:`,!!this.manager),this.projectPanel=new Mo({target:this.panelEl,props:{manager:this.manager,projectService:this.projectService,projectFileService:this.projectFileService}}),F(`${S} ProjectPanel mounted successfully`)}catch(t){F(`${S} failed to mount project panel:`,t),new D.Notice(`${Et}: failed to mount project panel. Check console for details.`)}}async onClose(){if(this.projectPanel){try{this.projectPanel.$destroy()}catch(t){F(`${S} Error destroying project panel:`,t)}this.projectPanel=void 0}}refreshDraftsSection(){this.projectPanel&&typeof this.projectPanel.refreshDrafts=="function"&&(F(`${S} Refreshing drafts section in project panel`),this.projectPanel.refreshDrafts())}}function Wo(r){return async()=>{F(`${S} List backups command called`);let t;const e=r.app.workspace.getLeavesOfType(_e);if(e.length>0){const a=e[0].view;t=()=>{a.refreshDraftsSection()}}new Ma(r.app,r,t).open()}}function Ho(r){return()=>(F(`${S} Create new draft command called`),r.createNewDraftPrompt())}async function Vo(r){F(`${S} createOutlineCommand called`);try{const t=r.activeProject,e=r.activeDraft;if(!t||!e){new D.Notice("No active project or draft selected. Please select a project and draft first.");return}const n=r.projectFileService.drafts.getOutlineFile(t,e);if(n){new D.Notice(`Outline file already exists: ${n.path}`);return}await r.projectFileService.drafts.createOutline(t,e,r.settings.outlineTemplate),new D.Notice(`Outline created for draft: ${e}`),F(`${S} Outline created successfully for draft: ${e}`)}catch(t){F(`${S} Error creating outline:`,t),new D.Notice(`Failed to create outline: ${t.message}`)}}function Zo(r){return async()=>{var i;const t=r.projectFileService.drafts,e=r.activeProject,n=r.activeDraft;if(F(`${S} Generate manuscript command called`),F(`${S} Active project: ${e}, active draft: ${n}`),F(`${S} Manager settings manuscript template: ${(i=r.settings)==null?void 0:i.manuscriptNameTemplate}`),!Xe(e,n))return;await t.generateManuscript(e,n,r.settings)?new D.Notice("Manuscript generated successfully."):new D.Notice("Failed to generate manuscript.")}}function Ur(r){const t={},e=r.match(zt);if(e){const n=e[1],a=n.match(/^id:\s*(.+?)$/m),i=n.match(/^draft:\s*(.+?)$/m),s=n.match(/^project:\s*(.+?)$/m),o=n.match(/^created:\s*(.+?)$/m);a&&(t.id=a[1].trim()),i&&(t.draft=i[1].trim()),s&&(t.project=s[1].trim()),o&&(t.created=o[1].trim())}return t}function Wr(r){return!!(r.id&&r.draft&&r.project&&r.created)}function Tn(r,t,e){return{id:r.id||Re(),draft:r.draft||t,project:r.project||e,created:r.created||new Date().toISOString()}}function Bn(r,t){const e=r.match(zt);if(e){const n=e[1],a=r.substring(e[0].length),i=n.split(`
`),s=[],o=new Set;for(const c of i)c.match(/^id:/i)?(s.push(`id: ${t.id}`),o.add("id")):c.match(/^draft:/i)?(s.push(`draft: ${t.draft}`),o.add("draft")):c.match(/^project:/i)?(s.push(`project: ${t.project}`),o.add("project")):c.match(/^created:/i)?(s.push(`created: ${t.created}`),o.add("created")):s.push(c);o.has("id")||s.push(`id: ${t.id}`),o.has("draft")||s.push(`draft: ${t.draft}`),o.has("project")||s.push(`project: ${t.project}`),o.has("created")||s.push(`created: ${t.created}`);const l=s.join(`
`);return`${Ft}
${l}
${Ft}${a}`}else return`${Ft}
id: ${t.id}
draft: ${t.draft}
project: ${t.project}
created: ${t.created}
${Ft}

`+r}class Go extends D.SuggestModal{constructor(t,e,n){super(t),this.onSelect=n,this.files=[],this.files=e,this.setPlaceholder("Select a file to initialize as draft file..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"esc",purpose:"to cancel"}]),this.setTitle("Select File for Draft Metadata")}getSuggestions(){return this.files}renderSuggestion(t,e){e.createEl("div",{text:t.name})}async onChooseSuggestion(t){await this.onSelect(t)}}function Yo(r){return async()=>{const t=r.activeProject,e=r.activeDraft;F(`${S} Initialize draft file command called`),F(`${S} Active project: ${t}, active draft: ${e}`);try{if(!Xe(t,e)){F(`${S} Initialize draft file: active project/draft check failed`);return}if(!t||!e){F(`${S} Initialize draft file: no active project or draft`),new D.Notice("Active project or draft not found.");return}const n=Bt(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const g of a.children)if(g instanceof D.TFolder&&g.name.toLowerCase()===n.toLowerCase()){i=g.name;break}}const s=`${t}/${i}/${e}`,o=t.split("/").pop()||t;F(`${S} Initialize draft file: using drafts folder: ${i}`);const l=r.app.vault.getAbstractFileByPath(s);if(!l||!(l instanceof D.TFolder)){F(`${S} Initialize draft file: draft folder not found at ${s}`),new D.Notice("Draft folder not found.");return}const c=l.children.filter(g=>g instanceof D.TFile&&g.extension==="md").filter(g=>!g.path.includes("/Chapters/")&&g.name!=="outline.md");if(F(`${S} Found ${c.length} markdown files in draft folder`),c.length===0){F(`${S} No files found, creating new draft file`);const g=Tn({},e,o),u=Bn("",g),m=`${e}${mt}`;await r.app.vault.create(`${s}/${m}`,u),new D.Notice(`Draft file created with metadata for "${e}".`);return}if(c.length===1){const g=c[0],u=await r.app.vault.read(g),m=Ur(u);if(Wr(m)){F(`${S} Initialize draft file: file already has complete metadata`),new D.Notice(`"${g.name}" already has complete draft metadata.`);return}F(`${S} Adding missing metadata to ${g.name}`);const p=Tn(m,e,o),b=Bn(u,p);await r.app.vault.modify(g,b),F(`${S} Initialize draft file: successfully updated ${g.name}`),new D.Notice(`Draft metadata added to "${g.name}".`);return}F(`${S} Multiple files found, showing selection modal`);const f=c.map(g=>({path:g.path,name:g.name,file:g}));new Go(r.app,f,async g=>{const u=g.file,m=await r.app.vault.read(u),p=Ur(m);if(Wr(p)){F(`${S} Initialize draft file: selected file already has complete metadata`),new D.Notice(`"${u.name}" already has complete draft metadata.`);return}F(`${S} Adding missing metadata to ${u.name}`);const b=Tn(p,e,o),d=Bn(m,b);await r.app.vault.modify(u,d),F(`${S} Initialize draft file: successfully updated ${u.name} from modal`),new D.Notice(`Draft metadata added to "${u.name}".`)}).open()}catch(n){F(`${S} Initialize draft file command error:`,n),new D.Notice("Failed to initialize draft file metadata.")}}}function qo(r){return()=>(F(`${S} Switch draft command called`),r.switchDraftPrompt())}function Ko(r){return async()=>{F(`${S} Navigate to next chapter command called`);const t=r.app.workspace.getActiveFile();if(!t){F(`${S} navigateToNextChapter: no active file`),new D.Notice("No file is currently open.");return}const e=t.path,n=Bt(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${mt}$`));if(!a){F(`${S} navigateToNextChapter: file is not a chapter`),new D.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{F(`${S} navigateToNextChapter: looking for next chapter after ${o}`);const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(h=>h.name===o);if(c===-1){new D.Notice("Unable to find the current chapter in the draft.");return}if(c>=l.length-1)return;const f=l[c+1];await r.openChapter(i,s,f.name)}catch(l){F(`${S} Failed to navigate to next chapter:`,l),new D.Notice("Failed to navigate to next chapter.")}}}function Xo(r){return async()=>{F(`${S} Navigate to previous chapter command called`);const t=r.app.workspace.getActiveFile();if(!t){F(`${S} navigateToPreviousChapter: no active file`),new D.Notice("No file is currently open.");return}const e=t.path,n=Bt(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${mt}$`));if(!a){F(`${S} navigateToPreviousChapter: file is not a chapter`),new D.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{F(`${S} navigateToPreviousChapter: looking for previous chapter before ${o}`);const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(h=>h.name===o);if(c===-1){F(`${S} navigateToPreviousChapter: current chapter not found`),new D.Notice("Unable to find the current chapter in the draft.");return}if(c<=0){F(`${S} navigateToPreviousChapter: already at first chapter`);return}const f=l[c-1];await r.openChapter(i,s,f.name)}catch(l){F(`${S} Failed to navigate to previous chapter:`,l),new D.Notice("Failed to navigate to previous chapter.")}}}async function Jo(r,t,e){const n=`${t}/${Gt(e)}`,a=await ke(r,n);if(!a||a.project_type!==Rt.SINGLE)return new D.Notice(`Project is not a ${Rt.SINGLE} project.`),!1;a.project_type=Rt.MULTI,await Kn(r,n,a);const i=Bt(e),s=r.vault.getAbstractFileByPath(`${t}/${i}`);if(!s||!(s instanceof D.TFolder))return new D.Notice("Drafts folder not found."),!1;let o=!1;for(const l of s.children)if(l instanceof D.TFolder){const c=Xt(l.name),f=l.children.find(h=>h instanceof D.TFile&&h.name===`${c}${mt}`);if(f){const h=`${l.path}/Chapter 1${mt}`;if(f.path!==h){const g=await r.vault.read(f);await r.vault.create(h,g),await r.vault.delete(f),o=!0}}}return o?new D.Notice(`Converted to multi-file project. Draft files renamed to "Chapter 1${mt}".`):new D.Notice("Converted to multi-file project. No draft files needed renaming."),!0}async function Qo(r,t,e){if(!t){new D.Notice("No active project selected.");return}await Jo(r,t,e)}function tl(r){return()=>(F(`${S} Create new project command called`),r.createNewProjectPrompt())}function el(r){return async()=>{const t=r.activeProject;if(F(`${S} Open project meta command called`),!t){new D.Notice("No active project.");return}try{const e=Gt(r.settings),n=`${t}/${e}`,a=r.app.vault.getAbstractFileByPath(n);if(!a||!(a instanceof D.TFile)){new D.Notice(`Meta file not found: ${e}`);return}const i=r.app.workspace.getLeaf();await(i==null?void 0:i.openFile(a)),F(`${S} Opened project meta file: ${n}`)}catch(e){F(`${S} Error opening project meta file:`,e),new D.Notice("Failed to open project meta file.")}}}function nl(r){return()=>(F(`${S} Select active project command called`),r.selectActiveProjectPrompt())}function rl(r,t){return()=>{F(`${S} Toggle project panel command called`);const e={type:_e,active:!0},n=t.workspace.getLeavesOfType(_e);if(n.length>0){F(`${S} Revealing existing project panel`);const a=n[0];t.workspace.revealLeaf(a)}else{F(`${S} Creating new project panel`);let a=t.workspace.getRightLeaf(!1);a||(a=t.workspace.getRightLeaf(!0)),a.setViewState(e),t.workspace.revealLeaf(a)}}}function al(r){return()=>(F(`${S} Update project metadata command called`),r.updateProjectMetadataPrompt())}class il extends D.Modal{constructor(t,e,n,a){super(t),this.path=e,this.onCreateAnyway=n,this.onOpenExisting=a}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project already exists"}),t.createEl("p",{text:`A folder named '${this.path}' already exists in the vault.`}),new D.Setting(t).addButton(e=>e.setButtonText("Open Existing").onClick(()=>{F(`${S} ConfirmExistingProjectModal: opening existing project "${this.path}"`),this.close(),this.onOpenExisting()})),new D.Setting(t).addButton(e=>e.setButtonText("Create Anyway").setCta().onClick(()=>{F(`${S} ConfirmExistingProjectModal: creating new project anyway "${this.path}"`),this.close(),this.onCreateAnyway(!0)})),new D.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{F(`${S} ConfirmExistingProjectModal: cancelled for project "${this.path}"`),this.close()}))}onClose(){this.contentEl.empty()}}class sl extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Draft"});const e=this.props.suggestedName;let n="",a="";new D.Setting(t).setName("Draft name").addText(s=>s.setPlaceholder(e).onChange(o=>n=o));const i=this.props.drafts;i.length>0&&new D.Setting(t).setName("Copy from existing draft").addDropdown(s=>{s.addOption("","Start blank");for(const o of i)s.addOption(o,o);s.onChange(o=>a=o)}),new D.Setting(t).addButton(s=>s.setButtonText("Create").setCta().onClick(()=>{const o=n&&n.trim()?n.trim():e;F(`${S} CreateDraftModal: creating draft "${o}", copyFrom: "${a||"none"}"`),this.close(),this.props.onSubmit(o,a||void 0)}))}onClose(){this.contentEl.empty()}}class Pa extends D.Modal{constructor(t,e){super(t),this.onSubmit=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Project"});let e="",n=!0,a="Draft 1";new D.Setting(t).setName("Project folder name").addText(i=>i.onChange(s=>e=s)),new D.Setting(t).setName("Project type").addDropdown(i=>{i.addOption("single","Single-file project"),i.addOption("multi","Multi-file project (chapters)"),i.onChange(s=>n=s==="single")}),new D.Setting(t).setName("Initial draft name (optional)").addText(i=>i.setPlaceholder("Draft 1").onChange(s=>a=s||"Draft 1")),new D.Setting(t).addButton(i=>i.setButtonText("Create Project").setCta().onClick(()=>{F(`${S} CreateProjectModal: creating project "${e}", singleFile: ${n}, initialDraftName: ${a}`),this.close(),this.onSubmit(e,n,a||void 0)}))}onClose(){this.contentEl.empty()}}const ol=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectModal:Pa},Symbol.toStringTag,{value:"Module"}));class On extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Select Project for Draft"});let e="";const n=this.props.folders||[];new D.Setting(t).setName("Project folder").addDropdown(a=>{a.addOption("","(Vault root)");for(const i of n)a.addOption(i,i||"(Vault root)");a.onChange(i=>e=i)}),new D.Setting(t).addButton(a=>a.setButtonText("Select").setCta().onClick(()=>{F(`${S} SelectProjectModal: selected project "${e||"(Vault root)"}"`),this.close(),this.props.onSubmit(e||"")}))}onClose(){this.contentEl.empty()}}class ll extends D.Modal{constructor(t,e,n){super(t),this.drafts=e,this.onSubmit=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Switch Active Draft"});for(const e of this.drafts)new D.Setting(t).setName(e).addButton(n=>n.setButtonText("Select").onClick(()=>{F(`${S} SwitchDraftModal: selected draft "${e}"`),this.close(),this.onSubmit(e)}))}onClose(){this.contentEl.empty()}}class cl{constructor(t,e,n){var a;this.activeDraft=null,this.activeProject=null,this.activeProjectListeners=[],this.activeDraftListeners=[],this.panelRefreshListeners=[],this._panelRefreshTimer=null,this._panelRefreshDebounceMs=250,this.app=t,this.plugin=e,this.settings=e==null?void 0:e.settings,typeof n=="number"&&Number.isFinite(n)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(n))),this.activeProject=((a=this.settings)==null?void 0:a.activeProject)||null,this.projectService=new gn(t),this.projectFileService=new Xn(t,this.projectService,this.settings)}async reorderChapters(t,e,n){return await this.projectFileService.chapters.reorderChapters(t,e,n)}async listChapters(t,e){return await this.projectFileService.chapters.listChapters(t,e)}async createChapter(t,e,n){const a=Bt(this.settings),i=`${t}/${a}/${e}`,s=await this.projectFileService.drafts.getDraftId(i);return await this.projectFileService.chapters.createChapter(t,e,n,this.settings,s||void 0)}async deleteChapter(t,e,n){return await this.projectFileService.chapters.deleteChapter(t,e,n)}async renameChapter(t,e,n,a){return await this.projectFileService.chapters.renameChapter(t,e,n,a)}async openChapter(t,e,n){return await this.projectFileService.chapters.openChapter(t,e,n)}get panelRefreshDebounceMs(){return this._panelRefreshDebounceMs}set panelRefreshDebounceMs(t){typeof t=="number"&&Number.isFinite(t)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(t)))}addActiveProjectListener(t){this.activeProjectListeners.push(t)}addActiveDraftListener(t){this.activeDraftListeners.push(t)}removeActiveDraftListener(t){this.activeDraftListeners=this.activeDraftListeners.filter(e=>e!==t)}notifyActiveDraftListeners(t){for(const e of this.activeDraftListeners)Mt(()=>e(t))}addPanelRefreshListener(t){this.panelRefreshListeners.push(t)}removePanelRefreshListener(t){this.panelRefreshListeners=this.panelRefreshListeners.filter(e=>e!==t)}notifyPanelRefresh(){try{this._panelRefreshTimer&&clearTimeout(this._panelRefreshTimer),this._panelRefreshTimer=setTimeout(()=>{for(const t of this.panelRefreshListeners)Mt(()=>t());this._panelRefreshTimer=null},this._panelRefreshDebounceMs)}catch{for(const t of this.panelRefreshListeners)Mt(()=>t())}}removeActiveProjectListener(t){this.activeProjectListeners=this.activeProjectListeners.filter(e=>e!==t)}async setActiveProject(t){t&&(t=t.trim().replace(/^\/+/,"").replace(/\/+$/,"")),F(`${S} setActiveProject called with '${t}'`),this.activeProject=t,await Ut(async()=>{if(this.plugin){const e=this.plugin;e.settings||(e.settings={}),e.settings.activeProject=t??void 0,typeof e.saveSettings=="function"&&await e.saveSettings()}});for(const e of this.activeProjectListeners)Mt(()=>e(t))}async createNewProjectPrompt(){new Pa(this.app,async(t,e,n,a)=>{if(!t){new D.Notice("Project name is required.");return}const i=this.listAllFolders();if((await Se(i,f=>this.projectService.isProjectFolder(f))).map(f=>f.split("/").pop()||f).includes(t)){new D.Notice(`A project with the name "${t}" already exists. Please choose a different name.`);return}const l=a&&a!==""?`${a}/${t}`:t;this.app.vault.getAbstractFileByPath(l)?new il(this.app,l,async f=>{f&&(await this.createNewProject(t,e,n,a),await this.openProject(l))},async()=>{await this.openProject(l)}).open():(await this.createNewProject(t,e,n,a),await this.openProject(l))}).open()}async openProject(t){return await this.projectService.openProject(t)}async createNewProject(t,e,n,a){const i=await this.projectService.createProject(t,e,n,a,this.settings);if(i){await this.setActiveProject(i);const s=n||"Draft 1";await this.setActiveDraft(s,i),Mt(()=>this.notifyPanelRefresh())}return i}listAllFolders(){return this.projectService.listAllFolders()}async createNewDraftPrompt(){const t=this.listAllFolders(),e=await Se(t,n=>this.projectService.isProjectFolder(n));new On(this.app,{folders:e,onSubmit:async n=>{const a=await this.suggestNextDraftName(n);new sl(this.app,{suggestedName:a,drafts:this.listDrafts(n),projectPath:n,onSubmit:async(i,s)=>{await this.createNewDraft(i,s,n),new D.Notice(`Draft "${i}" created in ${n}.`)}}).open()}}).open()}async switchDraftPrompt(){const t=this.listDrafts();if(t.length===0){new D.Notice("No drafts found in the current project.");return}new ll(this.app,t,async e=>{await this.setActiveDraft(e)&&new D.Notice(`Switched to draft: ${e}`)}).open()}async updateProjectMetadataPrompt(){if(this.activeProject){await He(this.app,this.activeProject,void 0,void 0,this.settings),new D.Notice(`Metadata updated for ${this.activeProject}`);return}(async()=>{const t=this.listAllFolders(),e=await Se(t,n=>this.projectService.isProjectFolder(n));new On(this.app,{folders:e,onSubmit:async n=>{await He(this.app,n,void 0,void 0,this.settings),new D.Notice(`Metadata updated for ${n}`)}}).open()})()}async selectActiveProjectPrompt(){const t=this.listAllFolders(),e=await Se(t,n=>this.projectService.isProjectFolder(n));if(e.length===0){new D.Notice(`No ${Et} projects found in the vault.`);return}new On(this.app,{folders:e,onSubmit:async n=>{await this.setActiveProject(n),new D.Notice(`Active project set to ${n}`)}}).open()}async createNewDraft(t,e,n){const a=n||this.activeProject||this.getCurrentProjectPath();if(!a){new D.Notice("No project folder detected. Please open a folder named after your project.");return}if(this.listDrafts(a).includes(t)){new D.Notice(`Draft with name "${t}" already exists. Please choose a different name.`);return}if(await this.projectFileService.drafts.createDraft(t,e,a,this.settings),Mt(()=>this.notifyPanelRefresh()),a&&t)try{await this.setActiveDraft(t,a,!1)}catch{}}listDrafts(t){return this.projectFileService.drafts.listDrafts(t)}async setActiveDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();return a?(this.activeDraft=t,await Ut(async()=>{F(`${S} Calculating word count for draft: ${t}`);const i=await this.projectFileService.drafts.calculateDraftWordCount(a,t);F(`${S} Word count calculated: ${i}`),await He(this.app,a,t,{current_draft_word_count:i},this.settings)}),this.notifyActiveDraftListeners(this.activeDraft),n&&new D.Notice(`Active draft set to ${t}`),!0):(n&&new D.Notice("No project selected to set active draft on."),!1)}async renameDraft(t,e,n,a=!1){const i=n||this.activeProject||this.getCurrentProjectPath();if(!i)return new D.Notice("No project selected to rename draft."),!1;const s=this.activeDraft===t;return await this.projectFileService.drafts.renameDraft(i,t,e,a,this.settings)?(s&&(this.activeDraft=e),new D.Notice(`Renamed draft ${t} → ${e}`),!0):(new D.Notice("Failed to rename draft."),!1)}async deleteDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();if(!a)return new D.Notice("No project selected to delete draft."),!1;if(await this.projectFileService.drafts.deleteDraft(a,t,n)){new D.Notice(`Deleted draft ${t}`);const s=this.listDrafts(a);if(s.length>0){if(this.activeDraft===t||!this.activeDraft){let o;if(s.length===1)o=s[0];else{const l=[...s].sort((c,f)=>c.localeCompare(f));if(this.activeDraft===t){const c=l.findIndex(f=>f===t);if(c!==-1){const f=c<l.length-1?c:0;o=l[f]}else o=l[0]}else o=this.activeDraft}await this.setActiveDraft(o,a,!1)}}else this.activeDraft=null,this.notifyActiveDraftListeners(null);return!0}return new D.Notice("Failed to delete draft."),!1}async suggestNextDraftName(t){return await this.projectFileService.drafts.suggestNextDraftName(t)}getCurrentProjectPath(){const t=this.app.workspace.getActiveFile();if(!t)return null;const e=t.parent;return e?e.path:null}}class fl extends D.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,F(`${S} Settings tab created`),typeof e.registerSettingsChangedCallback=="function"&&e.registerSettingsChangedCallback(()=>{F(`${S} Settings changed externally, refreshing UI`),this.containerEl&&this.containerEl.parentElement&&this.display()})}display(){const{containerEl:t}=this;t.empty(),t.createEl("h2",{text:`${Et} Settings`}),F(`${S} Displaying settings UI`);const e=this.plugin;t.createEl("h3",{text:"Templates"}),new D.Setting(t).setName("Include outline file on draft creation").setDesc("If enabled, each new draft will include an outline file using the outline template.").addToggle(o=>o.setValue(!!e.settings.includeDraftOutline).onChange(l=>{F(`${S} Include draft outline changed: ${l}`),e.settings.includeDraftOutline=l,e.saveSettings()})),new D.Setting(t).setName("Outline template").setDesc("Template for outline files. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for outline template`),new Rn(this.app,l=>{F(`${S} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Outline template").setDesc("Template for outline documents. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for outline template`),new Rn(this.app,l=>{F(`${S} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Chapter template").setDesc("Template for newly created chapter files. Use {{chapterTitle}}").addTextArea(o=>{o.setValue(e.settings.chapterTemplate||""),o.inputEl.setAttribute("data-setting","chapter")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for chapter template`),new Rn(this.app,l=>{F(`${S} Chapter template selected: ${l}`),e.settings.chapterTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Manuscript name template").setDesc("Template for manuscript filenames. Use {{draftName}}, {{projectName}}, and moment.js date qualifiers like {{YYYY-MM-DD}}").addText(o=>{o.setValue(e.settings.manuscriptNameTemplate||"{{draftName}}"),o.inputEl.setAttribute("data-setting","manuscript")}),new D.Setting(t).addButton(o=>o.setButtonText("Save Templates").setCta().onClick(async()=>{var h,g;F(`${S} Save Templates button clicked`);const l=t.querySelector('textarea[data-setting="outline"]'),c=t.querySelector('textarea[data-setting="chapter"]'),f=t.querySelector('input[data-setting="manuscript"]');F(`${S} Found inputs - outline: ${!!l}, chapter: ${!!c}, manuscript: ${!!f}`),F(`${S} Manuscript input value: "${f==null?void 0:f.value}"`),l&&(e.settings.outlineTemplate=l.value),c&&(e.settings.chapterTemplate=c.value),f&&(e.settings.manuscriptNameTemplate=f.value),F(`${S} Saving templates: outline=${(h=e.settings.outlineTemplate)==null?void 0:h.substring(0,50)}..., chapter=${(g=e.settings.chapterTemplate)==null?void 0:g.substring(0,50)}..., manuscript=${e.settings.manuscriptNameTemplate}`),await e.saveSettings(),new D.Notice("Templates saved successfully!")})),t.createEl("h3",{text:"Filenames"}),new D.Setting(t).setName("Draft filename slug style").setDesc("How per-draft main filenames are generated").addDropdown(o=>{o.addOption("compact","compact (draft1)"),o.addOption("kebab","kebab (draft-1)"),o.setValue(e.settings.slugStyle||"compact"),o.onChange(l=>{F(`${S} Slug style changed: ${l}`),e.settings.slugStyle=l,e.saveSettings();const c=t.querySelector(".wat-slug-preview");c&&(c.textContent=`Example: Draft 1 → ${Xt("Draft 1",l)}${mt}`)})});let n="Draft 1";new D.Setting(t).setName("Sample draft name").setDesc("Type a sample draft name to preview the generated filename").addText(o=>o.setPlaceholder("Draft 1").setValue(n).onChange(l=>{n=l||"Draft 1";const c=t.querySelector(".wat-slug-preview");if(c){const f=Xt(n,e.settings.slugStyle);c.textContent=`Example: ${n} → ${f}${mt}`}}));const a=t.createDiv({cls:"wat-slug-preview"}),i=Xt(n,e.settings.slugStyle);a.setText(`Example: ${n} → ${i}${mt}`),t.createEl("h3",{text:"Folders & Files"}),new D.Setting(t).setName("Drafts folder name").setDesc("Name of the folder containing draft subfolders (default: drafts)").addText(o=>o.setValue(e.settings.draftsFolderName||"drafts").onChange(l=>{F(`${S} Drafts folder name changed: ${l}`),e.settings.draftsFolderName=l||"drafts",e.saveSettings()})),new D.Setting(t).setName("Manuscripts folder name").setDesc("Name of the folder containing generated manuscripts (default: manuscripts)").addText(o=>o.setValue(e.settings.manuscriptsFolderName||"manuscripts").onChange(l=>{F(`${S} Manuscripts folder name changed: ${l}`),e.settings.manuscriptsFolderName=l||"manuscripts",e.saveSettings()})),new D.Setting(t).setName("Backups folder name").setDesc("Name of the folder containing draft backups (default: .writeaid-backups)").addText(o=>o.setValue(e.settings.backupsFolderName||".writeaid-backups").onChange(l=>{F(`${S} Backups folder name changed: ${l}`),e.settings.backupsFolderName=l||".writeaid-backups",e.saveSettings()})),new D.Setting(t).setName("Meta file name").setDesc(`Name of the project metadata file (default: ${fe.META})`).addText(o=>o.setValue(e.settings.metaFileName||fe.META).onChange(l=>{F(`${S} Meta file name changed: ${l}`),e.settings.metaFileName=l||fe.META,e.saveSettings()})),new D.Setting(t).setName("Outline file name").setDesc(`Name of the draft outline file (default: ${fe.OUTLINE})`).addText(o=>o.setValue(e.settings.outlineFileName||fe.OUTLINE).onChange(l=>{F(`${S} Outline file name changed: ${l}`),e.settings.outlineFileName=l||fe.OUTLINE,e.saveSettings()})),t.createEl("h3",{text:"Word Count Targets"}),new D.Setting(t).setName("Default target word count for multi-file projects").setDesc("Target word count automatically set for new multi-file projects (chapters)").addText(o=>o.setValue(String(e.settings.defaultMultiTargetWordCount??5e4)).setPlaceholder("50000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(F(`${S} Default multi-file target word count changed: ${c}`),e.settings.defaultMultiTargetWordCount=c,e.saveSettings())})),new D.Setting(t).setName(`Default target word count for ${Rt.SINGLE} projects`).setDesc(`Target word count automatically set for new ${Rt.SINGLE} projects`).addText(o=>o.setValue(String(e.settings.defaultSingleTargetWordCount??2e4)).setPlaceholder("20000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(F(`${S} Default ${Rt.SINGLE} target word count changed: ${c}`),e.settings.defaultSingleTargetWordCount=c,e.saveSettings())})),t.createEl("h3",{text:"Backup Settings"}),new D.Setting(t).setName("Maximum number of backups per draft").setDesc("Maximum number of backup files to keep per draft (default: 5)").addText(o=>o.setValue(String(e.settings.maxBackups??5)).setPlaceholder("5").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(F(`${S} Max backups changed: ${c}`),e.settings.maxBackups=c,e.saveSettings())})),new D.Setting(t).setName("Maximum backup age (days)").setDesc("Automatically delete backups older than this many days (default: 30)").addText(o=>o.setValue(String(e.settings.maxBackupAgeDays??30)).setPlaceholder("30").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(F(`${S} Max backup age changed: ${c}`),e.settings.maxBackupAgeDays=c,e.saveSettings())})),t.createEl("h3",{text:"UI & Startup"}),t.createEl("p",{text:"Most settings take effect immediately. Settings marked with ⚠️ require a plugin reload to take effect.",cls:"setting-item-description"}),new D.Setting(t).setName("Ribbon placement").setDesc(`Place the ${Et} icon on the left or right ribbon`).addDropdown(o=>{o.addOption("left","Left"),o.addOption("right","Right"),o.setValue(e.settings.ribbonPlacement||"left"),o.onChange(l=>{F(`${S} Ribbon placement changed: ${l}`),e.settings.ribbonPlacement=l,e.saveSettings(),typeof this.plugin.moveRibbon=="function"&&(l==="left"||l==="right")&&this.plugin.moveRibbon(l),this.display()})}),new D.Setting(t).setName("Always show ribbon").setDesc(`If enabled, the ${Et} ribbon icon will always be visible regardless of whether projects are detected`).addToggle(o=>o.setValue(!!e.settings.ribbonAlwaysShow).onChange(l=>{F(`${S} Always show ribbon changed: ${l}`),e.settings.ribbonAlwaysShow=l,e.saveSettings(),typeof this.plugin.refreshRibbonVisibility=="function"&&this.plugin.refreshRibbonVisibility()})),new D.Setting(t).setName("Auto-open project panel on startup").setDesc(`If enabled, the ${Et} project panel will open on plugin load when an active project is saved. ⚠️ Requires plugin reload to take effect.`).addToggle(o=>o.setValue(!!e.settings.autoOpenPanelOnStartup).onChange(l=>{F(`${S} Auto-open panel on startup changed: ${l}`),e.settings.autoOpenPanelOnStartup=l,e.saveSettings()})),new D.Setting(t).setName("Auto-select persisted project on startup").setDesc("If enabled, the persisted active project will be selected as the plugin's active project on load without opening the panel. ⚠️ Requires plugin reload to take effect.").addToggle(o=>o.setValue(!!e.settings.autoSelectProjectOnStartup).onChange(l=>{F(`${S} Auto-select project on startup changed: ${l}`),e.settings.autoSelectProjectOnStartup=l,e.saveSettings()})),new D.Setting(t).setName(`Enable ${Et} debug logs`).setDesc(`When enabled, ${Et} will set window.__${Et.toUpperCase()}__ to true to show verbose runtime logs useful during development.`).addToggle(o=>o.setValue(!!e.settings.debug).onChange(l=>{F(`${S} Debug logs setting changed: ${l}`),e.settings.debug=l,window.__WRITEAID_DEBUG__=!!l,e.saveSettings(),l?new D.Notice(`${Et}: debug logs enabled — verbose logs will appear in the DevTools console.`):new D.Notice(`${Et}: debug logs disabled.`)})),t.createEl("h3",{text:"Panel performance"}),new D.Setting(t).setName("Panel refresh debounce (ms)").setDesc("Debounce timeout (milliseconds) for side-panel refresh notifications. Lower values mean more frequent refreshes; 0 disables debouncing.").addText(o=>{const l=e.settings.panelRefreshDebounceMs,c=Number(l??en);o.setPlaceholder(String(en)),o.setValue(String(c));let f=null;const h=g=>{const u=Number(g);if(!Number.isFinite(u)||u<Te){new D.Notice(`Please enter a valid number ≥ ${Te}.`);return}const m=Math.min(Math.floor(u),tn);F(`${S} Panel refresh debounce changed: ${m}ms`),e.settings.panelRefreshDebounceMs=m;try{const p=e.saveSettings();p&&typeof p.catch=="function"&&p.catch(()=>{})}catch{}this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=m),o.inputEl.value=String(m),f&&(f.value=String(m))};try{const g=o.inputEl;g.setAttribute("type","number"),g.setAttribute("min",String(Te)),g.setAttribute("max",String(tn)),g.setAttribute("step","50"),g.setAttribute("aria-label","Panel refresh debounce in milliseconds"),Mt(()=>{g.insertAdjacentHTML("afterend",'<span class="wa-unit">ms</span>')}),f=document.createElement("input"),f.type="range",f.min=String(Te),f.max=String(tn),f.step="50",f.value=String(c),f.className="wa-debounce-range",Mt(()=>{const u=g.nextSibling;u&&u.parentElement?u.insertAdjacentElement("afterend",f):g.insertAdjacentElement("afterend",f)}),o.onChange(u=>{const m=Number(u);h(m)}),f.addEventListener("input",u=>{const m=Number(u.target.value);o.inputEl.value=String(m),h(m)})}catch{o.onChange(g=>{const u=Number(g);if(!Number.isFinite(u)||u<Te){new D.Notice(`Please enter a valid number ≥ ${Te}.`);return}const m=Math.min(Math.floor(u),tn);e.settings.panelRefreshDebounceMs=m,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=m)})}}).addButton(o=>o.setButtonText("Reset").setTooltip(`Reset to default (${en} ms)`).onClick(()=>{const l=en;e.settings.panelRefreshDebounceMs=l,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=l),this.display()}))}}class Rn extends D.Modal{constructor(t,e){super(t),this.currentFolder=null,this.expanded={},this.onPick=e,F(`${S} FilePickerModal created`)}onOpen(){F(`${S} FilePickerModal opened`);const t=this.app.vault.getRoot();this.currentFolder=t,this.expanded={},this.render()}render(){const{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Select template file"}),!this.currentFolder)return;const e=this.currentFolder.path?this.currentFolder.path.split("/"):[],n=t.createDiv({cls:"wat-breadcrumbs"}),a=n.createEl("a",{text:"(Vault root)",href:"#"});a.onclick=c=>{c.preventDefault(),this.currentFolder=this.app.vault.getRoot(),this.render()};let i="";for(const c of e){i=i?`${i}/${c}`:c,n.createDiv({text:" / "});const f=n.createEl("a",{text:c,href:"#"}),h=i;f.onclick=g=>{g.preventDefault();const u=this.app.vault.getAbstractFileByPath(h);u&&u instanceof D.TFolder&&(this.currentFolder=u,this.render())}}const o=t.createDiv({cls:"wat-controls"}).createEl("button",{text:"Up"});o.onclick=c=>{var g;if(c.preventDefault(),!this.currentFolder)return;const f=((g=this.currentFolder.parent)==null?void 0:g.path)||"",h=f?this.app.vault.getAbstractFileByPath(f):this.app.vault.getRoot();h&&h instanceof D.TFolder&&(this.currentFolder=h,this.render())};const l=t.createDiv({cls:"wat-list"});for(const c of this.currentFolder.children)if(c instanceof D.TFolder){const f=l.createDiv({cls:"wat-row folder-row"}),h=f.createEl("button",{text:this.expanded[c.path]?"▾":"▸"});h.onclick=u=>{u.preventDefault(),this.expanded[c.path]=!this.expanded[c.path],this.render()};const g=f.createEl("a",{text:c.name,href:"#"});if(g.onclick=u=>{u.preventDefault(),this.currentFolder=c,this.render()},this.expanded[c.path]){const u=l.createDiv({cls:"wat-sub"});for(const m of c.children)if(m instanceof D.TFolder){const b=u.createDiv({cls:"wat-row sub-folder"}).createEl("a",{text:m.name,href:"#"});b.onclick=d=>{d.preventDefault(),this.currentFolder=m,this.render()}}else if(m instanceof D.TFile&&m.path.toLowerCase().endsWith(mt)){const b=u.createDiv({cls:"wat-row sub-file"}).createEl("a",{text:m.name,href:"#"});b.onclick=d=>{d.preventDefault(),F(`${S} File selected from file picker: ${m.path}`),this.close(),this.onPick(m.path)}}}}else if(c instanceof D.TFile&&c.path.toLowerCase().endsWith(mt)){const h=l.createDiv({cls:"wat-row file-row"}).createEl("a",{text:c.name,href:"#"});h.onclick=g=>{g.preventDefault(),F(`${S} File selected from file picker: ${c.path}`),this.close(),this.onPick(c.path)}}}onClose(){this.contentEl.empty()}}const ul=":root{--wa-bg: var(--background-primary, #ffffff);--wa-surface: var(--background-modifier-hover, #f7f7fb);--wa-muted: var(--text-muted, #6b7280);--wa-text: var(--text-normal, #0f172a);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(15, 23, 42, .08);--wa-radius: 8px;--wa-gap: 8px;--select-bg: var(--background-primary, #fff);--select-border: var(--background-modifier-border, #ccc);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #222);--select-placeholder: var(--text-muted, #888);--select-dropdown-bg: var(--background-secondary, #f6f6f6);--select-dropdown-border: var(--background-modifier-border, #e0e0e0);--select-option-hover: #f0f0ff;--select-option-active: #eaeaff;--select-chevron: var(--text-muted, #888)}@media (prefers-color-scheme: dark){:root{--wa-bg: var(--background-primary, #0b0b0c);--wa-surface: var(--background-modifier-hover, #121212);--wa-muted: var(--text-muted, #9aa4b2);--wa-text: var(--text-normal, #e6eef8);--wa-accent: var(--interactive-accent, #8b5cf6);--wa-border: rgba(255, 255, 255, .06)}}.theme-dark{--wa-bg: var(--background-primary, #23232b);--wa-surface: var(--background-modifier-hover, #2a2a4a);--wa-muted: var(--text-muted, #aaa);--wa-text: var(--text-normal, #e0e0e0);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(255, 255, 255, .06);--select-bg: var(--background-primary, #23232b);--select-border: var(--background-modifier-border, #333);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #e0e0e0);--select-placeholder: var(--text-muted, #aaa);--select-dropdown-bg: var(--background-secondary, #23233a);--select-dropdown-border: var(--background-modifier-border, #333);--select-option-hover: #2a2a4a;--select-option-active: #2a2a4a;--select-chevron: var(--text-muted, #aaa)}.theme-dark .wa-panel{background:var(--background-primary, #23232b);color:var(--text-normal, #e0e0e0);border:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-title{color:var(--text-title, var(--text-normal, #e0e0e0))}.theme-dark .wa-muted{color:var(--text-faint, var(--text-muted, #aaa))}.theme-dark .wa-draft-list{background:var(--background-secondary, #23233a)}.theme-dark .wa-draft-item{color:var(--text-normal, #e0e0e0);border-bottom:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-draft-item.active{background:var(--background-modifier-active, #2a2a4a)}.theme-dark .wa-draft-name{color:var(--text-normal, #e0e0e0)}",dl="button:hover{cursor:pointer}.writeaid-ribbon{padding-left:6px}.writeaid-ribbon .wa-icon{display:inline-block;vertical-align:middle}.writeaid-ribbon .wa-icon svg{width:16px;height:16px;fill:currentColor;display:block}.view-content:has(.writeaid-project-panel){padding:0}.writeaid-project-panel{height:100%;display:flex;flex-direction:column}.create-inline{margin-top:8px;justify-content:center}.wa-panel.project-list{padding:1em;height:100%;border-radius:0}.wa-panel-header{display:flex;flex-direction:column}.wa-draft-item.active .wa-draft-name{font-weight:700;color:var(--color-accent, #3b82f6)}.wa-draft-active-indicator{color:var(--color-accent, #3b82f6);font-size:1em;vertical-align:middle}@keyframes spin{to{transform:rotate(360deg)}}:root{--wa-slider-track-height: 6px;--wa-slider-thumb-size: 12px;--wa-slider-accent: var(--interactive-accent, #7c5cff);--wa-slider-background: var(--background-modifier-host, #eee);--wa-slider-gap: 12px}.wa-debounce-range{margin-left:var(--wa-slider-gap);vertical-align:middle;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:var(--wa-slider-track-height);background:linear-gradient(90deg,var(--wa-slider-accent) 0%,var(--wa-slider-accent) 50%,var(--wa-slider-background) 50%,var(--wa-slider-background) 100%);border-radius:999px;outline:none}.wa-debounce-range::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);box-shadow:0 0 0 4px #0000000d;cursor:pointer}.wa-debounce-range::-moz-range-thumb{width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);cursor:pointer}.wa-unit{color:var(--text-muted, #666);margin-left:6px}.justify-between{justify-content:space-between}.wa-rename-info{margin-bottom:8px;color:var(--text-muted, #888);font-size:.95em}.wa-rename-label{display:block;font-weight:500;margin-bottom:4px;color:var(--text-normal, #222)}.wa-rename-input{width:100%;padding:7px 10px;font-size:1em;border:1px solid var(--background-modifier-border, #ccc);border-radius:5px;margin-bottom:10px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s}.wa-rename-input:focus{border-color:var(--interactive-accent, #7c5cff);outline:none}.wa-rename-checkbox-label{display:flex;align-items:center;gap:6px;margin-bottom:10px;font-size:.97em;color:var(--text-muted, #666)}.wa-rename-btn-row{display:flex;gap:10px;margin-top:8px;justify-content:flex-end}.wa-rename-btn-row button{min-width:80px;padding:6px 14px;font-size:1em;border-radius:4px;border:none;cursor:pointer;transition:background .2s}.wa-rename-btn-row .mod-cta{background:var(--interactive-accent, #7c5cff);color:#fff;font-weight:600}.wa-rename-btn-row .mod-cta:hover{background:#5a3fd6}.wa-rename-btn-row .mod-cancel{background:var(--background-modifier-border, #eee);color:var(--text-muted, #666)}.wa-rename-btn-row .mod-cancel:hover{background:#e0e0e0}.wa-rename-error{min-height:18px;margin-bottom:4px;font-size:.97em;color:var(--color-red, #d43c3c);transition:opacity .2s}.wa-create-draft-input{width:100%;padding:8px 12px;font-size:1.05em;border:1.5px solid var(--background-modifier-border, #bbb);border-radius:6px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s,box-shadow .2s;outline:none;box-shadow:0 1px 2px #3c3c3c0a}.wa-create-draft-input:focus{border-color:var(--interactive-accent, #7c5cff);box-shadow:0 2px 8px #7c5cff14;background:var(--background-secondary, #fafaff)}.wa-panel{background:var(--background-primary, #fff);color:var(--text-normal, #222);padding:1em}.wa-title{font-size:1.2em;font-weight:600;color:var(--text-title, var(--text-normal, #222))}.wa-muted{color:var(--text-faint, var(--text-muted, #888))}.wa-row{display:flex;gap:8px;align-items:center;width:100%}.wa-button-group{display:flex;gap:8px;align-items:center}.wa-draft-list{background:var(--background-secondary, #f6f6f6);border-radius:6px;padding:8px 0;margin-top:8px}.wa-draft-item{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-bottom:1px solid var(--background-modifier-border, #e0e0e0);background:transparent;color:var(--text-normal, #222);transition:background .15s}.wa-draft-item:last-child{border-bottom:none}.wa-draft-item.active{background:var(--background-modifier-active, #eaeaff)}.wa-draft-name{font-size:1em;font-weight:500;color:var(--text-normal, #222)}.wa-draft-actions{display:flex;gap:6px}.wa-select-container.wa-select{position:relative;width:100%;display:flex;flex-direction:column;gap:4px}.wa-select-label-text{font-size:.9em;font-weight:500;color:var(--select-text, var(--text-normal, #222))}.wa-select-trigger{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:6px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));cursor:pointer;transition:all .2s ease;min-height:38px;font-size:1em}.wa-select-trigger:hover:not(.disabled){border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.open{border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.disabled{opacity:.6;cursor:not-allowed;background:var(--disabled-background, #f3f3f3)}.wa-select-value{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.wa-select-label,.wa-select-placeholder{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wa-select-placeholder{color:var(--select-placeholder, var(--text-muted, #888))}.wa-select-controls{display:flex;align-items:center;gap:4px;flex-shrink:0;margin-left:8px}.wa-select-clear{display:flex;align-items:center;justify-content:center;width:20px;height:20px;padding:0;border:none;background:none;color:var(--select-chevron, var(--text-muted, #888));cursor:pointer;border-radius:3px;transition:background .2s;font-size:.8em}.wa-select-clear:hover{background:var(--background-modifier-hover, #f0f0f0)}.wa-select-chevron{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:var(--select-chevron, var(--text-muted, #888));font-size:.7em;transition:transform .3s cubic-bezier(.4,0,.2,1)}.wa-select-chevron.rotated{transform:rotate(180deg)}.wa-select-dropdown{position:absolute;z-index:1000;background:var(--select-dropdown-bg, var(--background-secondary, #f6f6f6));border:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0));border-radius:8px;box-shadow:0 4px 12px #00000026,0 2px 4px #0000001a;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .15s ease-out}@keyframes slideIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.wa-select-dropdown[data-placement*=top]{animation:slideInTop .15s ease-out}@keyframes slideInTop{0%{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}.wa-select-search{padding:8px;border-bottom:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0))}.wa-select-search-input{width:100%;padding:6px 8px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:4px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));font-size:.95em}.wa-select-search-input:focus{outline:none;border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-list{flex:1;overflow-y:auto;max-height:300px}.wa-select-list::-webkit-scrollbar{width:6px}.wa-select-list::-webkit-scrollbar-track{background:transparent}.wa-select-list::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb-bg, rgba(0, 0, 0, .2));border-radius:3px}.wa-select-list::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover-bg, rgba(0, 0, 0, .3))}.wa-select-empty{padding:12px 10px;text-align:center;color:var(--select-placeholder, var(--text-muted, #888));font-size:.95em}.wa-select-option{width:100%;margin-top:2px;padding:8px 10px;border-radius:0;box-shadow:none!important;border:none;background:transparent;color:var(--select-text, var(--text-normal, #222));text-align:left;cursor:pointer;transition:background .15s;font-size:.95em}.wa-select-option:hover{background:var(--select-option-hover, #f0f0ff);box-shadow:none!important}.wa-select-option.selected{background:var(--select-option-active, #eaeaff);box-shadow:none!important}.wa-select-option.active{background:var(--select-option-active, #eaeaff);font-weight:500;box-shadow:none!important}";if(typeof globalThis<"u"){const r=globalThis;r.__BROWSER__||(r.__BROWSER__=!0)}function Hr(r,t=20){return r.length<=t?r:r.substring(0,t-3)+"..."}const ja={outlineTemplate:`# {{draftName}} Outline

## Overview
Brief description of the story goes here.

## Characters
- Character 1: Description
- Character 2: Description

## Plot Points
- Opening: 
- Middle: 
- Climax: 
- Resolution: 

## Chapters
- Chapter 1: Title
- Chapter 2: Title
- Chapter 3: Title`,chapterTemplate:`# {{chapterName}}

## Summary
Chapter summary goes here.

## Scene 1
Scene content goes here.

## Scene 2
Scene content goes here.`,manuscriptNameTemplate:"{{draftName}}",slugStyle:"compact",ribbonPlacement:"left",ribbonAlwaysShow:!1,autoOpenPanelOnStartup:!1,autoSelectProjectOnStartup:!0,activeProject:void 0,panelRefreshDebounceMs:250,debug:!1,includeDraftOutline:!1,draftsFolderName:Oe.DRAFTS,manuscriptsFolderName:Oe.MANUSCRIPTS,backupsFolderName:Oe.BACKUPS,metaFileName:fe.META,outlineFileName:fe.OUTLINE,maxBackups:5,maxBackupAgeDays:30};function Vr(r){return Object.assign({},ja,r??{})}class hl extends D.Plugin{constructor(){super(...arguments),this.settings=ja,this.settingsChangedCallbacks=[]}async loadSettings(){const t=await this.loadData();this.settings=Vr(t),t&&t.activeProject!==void 0&&(this.settings.activeProject=t.activeProject),this.manager&&(this.manager.settings=this.settings),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){F(`${S} Error in settings changed callback:`,n)}})}async saveSettings(){await Ut(async()=>{const e=Vr(this.settings);await this.saveData(e),this.settings=e})===void 0&&await this.saveData(this.settings),this.manager&&(this.manager.settings=this.settings,F(`${S} Updated manager settings reference, manuscript template: ${this.settings.manuscriptNameTemplate}`)),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){F(`${S} Error in settings changed callback:`,n)}})}registerSettingsChangedCallback(t){this.settingsChangedCallbacks.push(t)}async runBackupCleanup(){if(this.manager)try{const e=await new gn(this.app).listProjects();for(const n of e){const a=Bt(this.settings),i=`${n}/${a}`,s=this.app.vault.getAbstractFileByPath(i);if(!(!s||!(s instanceof D.TFolder))){for(const o of s.children)if(o instanceof D.TFolder){const l=`${i}/${o.name}`,c=await this.manager.projectFileService.drafts.getDraftId(l);c&&await this.manager.projectFileService.backups.clearOldBackups(l,c,this.manager.settings)}}}F(`${S} Backup cleanup completed on startup`)}catch(t){F(`${S} Error during backup cleanup:`,t)}}async onload(){await this.loadSettings(),this.manager=new cl(this.app,this,typeof this.settings.panelRefreshDebounceMs=="number"?this.settings.panelRefreshDebounceMs:void 0),F(`${S} Manager created:`,!!this.manager);const t=new gn(this.app);this.app.workspace.onLayoutReady(async()=>{let a=null;if(this.settings.autoSelectProjectOnStartup!==!1){const i=await t.listProjects();if(i.length===1)a=i[0];else if(i.length>1){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");F(`${S} lastActiveRaw='${s}', normalized='${o}', includes=${o&&i.includes(o)}`),o&&i.includes(o)?a=o:a=i[0]}else if(i.length===0){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");await t.isProjectFolder(s||"")&&(F(`${S} activating saved project '${o}' as it exists and has valid meta file`),a=o??null)}}if(F(`${S} toActivate='${a}'`),a){await this.manager.setActiveProject(a),this.settings.activeProject=a;const i=await ke(this.app,`${a}/${Gt(this.settings)}`);if(i!=null&&i.current_active_draft&&this.manager.listDrafts(a).includes(i.current_active_draft)&&(F(`${S} auto-restoring draft '${i.current_active_draft}' for project '${a}'`),await this.manager.setActiveDraft(i.current_active_draft,a,!1)),await this.saveSettings(),this.settings.autoOpenPanelOnStartup){const s=this.app.workspace.getLeavesOfType(_e);if(s.length>0)this.app.workspace.revealLeaf(s[0]);else{let o=null;this.settings.ribbonPlacement==="right"?o=this.app.workspace.getRightLeaf(!0):o=this.app.workspace.getLeftLeaf(!0);const l={type:_e,active:!0};o.setViewState(l),this.app.workspace.revealLeaf(o)}}}else await this.manager.setActiveProject(null),this.settings.activeProject=void 0,await this.saveSettings()}),this.statusBarEl=this.addStatusBarItem(),this.statusBarEl.setText(`${Et}: No active project`),this.runBackupCleanup().catch(a=>{F(`${S} Failed to run backup cleanup on startup:`,a)}),Mt(()=>{this.waStyleEl||(this.waStyleEl=document.createElement("style"),this.waStyleEl.setAttribute("data-writeaid-style",""),this.waStyleEl.textContent=ul+dl,this.waStyleEl.classList.add("writeaid-plugin-style"),document.head.appendChild(this.waStyleEl))}),await this.loadSettings(),Mt(()=>{window.__WRITEAID_DEBUG__=!!this.settings.debug}),F(`${S} Loading ${Et} Novel Multi-Draft Plugin`),this.manager.addActiveProjectListener(a=>{this.statusBarEl&&(a?(this.statusBarEl.setText(`${Et}: ${Hr(a)}`),F(`${S} active project updated -> ${a}`)):this.statusBarEl.setText(`${Et}: No active project`))}),this.manager.activeProject&&this.statusBarEl.setText(`${Et}: ${Hr(this.manager.activeProject)}`),F(`${S} Registering ProjectPanelView with manager:`,!!this.manager),this.registerView(_e,a=>(F(`${S} Creating ProjectPanelView instance with manager:`,!!this.manager),new Uo(a,this.app,this.manager)));const e=this.addRibbonIcon(Yn,`${Et} Projects`,()=>{});e.classList.add("writeaid-ribbon"),this.ribbonEl=e,e.setAttr("aria-label",`${Et} Projects`),e.onclick=()=>{const a=this.app.workspace.getLeavesOfType(_e);if(a.length>0){const i=a[0];this.app.workspace.revealLeaf(i)}else{let i=this.app.workspace.getLeftLeaf(!1);i||(i=this.app.workspace.getLeftLeaf(!0));const s={type:_e,active:!0};i.setViewState(s),this.app.workspace.revealLeaf(i)}};const n=async()=>{await Ut(async()=>{if(this.settings.ribbonAlwaysShow){e.style.display="";return}const i=t.listAllFolders();(await Se(i,o=>t.isProjectFolder(o))).length>0?e.style.display="":e.style.display="none"})===void 0&&(e.style.display="")};this.refreshRibbonVisibility=n,n().catch(()=>{}),this.settings.ribbonPlacement==="right"&&this.moveRibbon("right"),this.registerEvent(this.app.vault.on("create",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("delete",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("modify",()=>{n().catch(()=>{})})),this.addCommand({id:"create-new-draft",name:"Create New Draft",callback:Ho(this.manager)}),this.addCommand({id:"create-outline",name:"Create Outline",callback:()=>Vo(this.manager)}),this.addCommand({id:"create-new-project",name:"Create New Project",callback:tl(this.manager)}),this.addCommand({id:"switch-draft",name:"Switch Active Draft",callback:qo(this.manager)}),this.addCommand({id:"update-project-metadata",name:"Update Project Metadata",callback:al(this.manager)}),this.addCommand({id:"select-active-project",name:"Select Active Project",callback:nl(this.manager)}),this.addCommand({id:"open-project-meta",name:"Open Project Meta",callback:el(this.manager)}),this.addCommand({id:"generate-manuscript",name:"Generate Manuscript",callback:Zo(this.manager)}),this.addCommand({id:"toggle-project-panel",name:`Toggle ${Et} Project Panel`,callback:rl(this.manager,this.app)}),this.addCommand({id:"convert-single-to-multi-file-project",name:"Convert Single-File Project to Multi-File",callback:()=>{var a,i;return Qo(this.app,this.manager.activeProject||((i=(a=this.manager).getCurrentProjectPath)==null?void 0:i.call(a))||void 0,this.manager.settings)}}),this.addCommand({id:"navigate-to-next-chapter",name:"Navigate to Next Chapter",callback:Ko(this.manager)}),this.addCommand({id:"navigate-to-previous-chapter",name:"Navigate to Previous Chapter",callback:Xo(this.manager)}),this.addCommand({id:"create-backup",name:"Create Backup",callback:Ia(this.manager)}),this.addCommand({id:"list-and-restore-backups",name:"List and Restore Backups",callback:Wo(this.manager)}),this.addCommand({id:"delete-backup",name:"Delete Oldest Backup",callback:za(this.manager)}),this.addCommand({id:"clear-old-backups",name:"Clear Old Backups",callback:Oa(this.manager)}),this.addCommand({id:"initialize-draft-file",name:"Initialize Draft File Metadata",callback:Yo(this.manager)}),this.addSettingTab(new fl(this.app,this))}moveRibbon(t){Mt(()=>{if(!this.ribbonEl)return;const e=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-right"),n=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-left");t==="right"&&e?e.appendChild(this.ribbonEl):t==="left"&&n&&n.appendChild(this.ribbonEl)})}onunload(){this.statusBarEl&&this.statusBarEl.parentElement&&this.statusBarEl.parentElement.removeChild(this.statusBarEl),F(`${S} Unloading ${Et} Novel Multi-Draft Plugin`),this.waStyleEl&&this.waStyleEl.parentElement&&this.waStyleEl.parentElement.removeChild(this.waStyleEl)}}module.exports=hl;
//# sourceMappingURL=main.js.map
