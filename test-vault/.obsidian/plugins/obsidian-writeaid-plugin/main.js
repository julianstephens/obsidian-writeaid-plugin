"use strict";var $i=Object.defineProperty;var Si=(r,t,e)=>t in r?$i(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var $n=(r,t,e)=>Si(r,typeof t!="symbol"?t+"":t,e);const x=require("obsidian"),cn={ACTIVE_PROJECT_NOT_FOUND:"No active project found.",ACTIVE_DRAFT_NOT_FOUND:"No active draft found.",BACKUPS_NOT_FOUND_PROJECT:"No backups found for the current project.",BACKUPS_NOT_FOUND_DRAFT:"No backups found for the current draft."},Ee={DRAFTS:"drafts",MANUSCRIPTS:"manuscripts",BACKUPS:".writeaid-backups"},ie={META:"meta.md",OUTLINE:"outline.md"},Pn={COMPACT:"compact",KEBAB:"kebab"},Ht={SINGLE:"single-file",MULTI:"multi-file"},Ci=Object.values(Ht),Ft="WriteAid",M=`${Ft} debug:`,Rn="pen-tool",bt=".md",Ce=0,Ze=5e3,Ge=250,Ye=".zip",Tr=/_(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})\.zip$/,Pt="---",te=new RegExp(`^${Pt}
([\\s\\S]*?)
${Pt}`),Dn=1024,Or=["B","KB","MB","GB"];function jt(r){return(r==null?void 0:r.draftsFolderName)||Ee.DRAFTS}function zn(r){return(r==null?void 0:r.manuscriptsFolderName)||Ee.MANUSCRIPTS}function je(r){return(r==null?void 0:r.backupsFolderName)||Ee.BACKUPS}function ae(r){return(r==null?void 0:r.metaFileName)||ie.META}function Te(r){return(r==null?void 0:r.outlineFileName)||ie.OUTLINE}function ee(r,t=Pn.COMPACT){if(!r)return"";const e=r.trim();return t===Pn.KEBAB?e.replace(/\s+/g,"-").toLowerCase():e.replace(/\s+/g,"").toLowerCase()}async function Be(r,t){const e=await Promise.all(r.map(n=>Promise.resolve(t(n))));return r.filter((n,i)=>e[i])}function Ut(r,...t){try{return r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}async function Tt(r,...t){try{return await r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}function U(...r){Ut(()=>{window.__WRITEAID_DEBUG__&&(console.debug||console.log).apply(console,r)})}function Je(r,t){return r?t?!0:(new x.Notice(cn.ACTIVE_DRAFT_NOT_FOUND),!1):(new x.Notice(cn.ACTIVE_PROJECT_NOT_FOUND),!1)}const Fi=Object.freeze(Object.defineProperty({__proto__:null,APP_NAME:Ft,BACKUP_FILE_EXTENSION:Ye,BACKUP_TIMESTAMP_REGEX:Tr,BYTES_PER_KILOBYTE:Dn,DEBUG_PREFIX:M,FILES:ie,FILE_SIZE_UNITS:Or,FOLDERS:Ee,FRONTMATTER_DELIMITER:Pt,FRONTMATTER_REGEX:te,MARKDOWN_FILE_EXTENSION:bt,PANEL_DEBOUNCE_DEFAULT:Ge,PANEL_DEBOUNCE_MAX:Ze,PANEL_DEBOUNCE_MIN:Ce,PROJECT_TYPE:Ht,SLUG_STYLE:Pn,VALID_PROJECT_TYPES:Ci,WRITE_AID_ICON_NAME:Rn,asyncFilter:Be,checkActive:Je,debug:U,getBackupsFolderName:je,getDraftsFolderName:jt,getManuscriptsFolderName:zn,getMetaFileName:ae,getOutlineFileName:Te,slugifyDraftName:ee,suppress:Ut,suppressAsync:Tt},Symbol.toStringTag,{value:"Module"}));function Ei(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(U(`${M} Clear old backups command called`),U(`${M} Active project: ${t}, active draft: ${e}`),!Je(t,e))return;const n=jt(r.settings),i=`${t}/${n}/${e}`,a=r.projectFileService.backups.maxBackupAgeDays;await r.projectFileService.backups.clearOldBackups(i,r.settings),new x.Notice(`Old backups cleared (older than ${a} days).`)}}function xi(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(U(`${M} Create backup command called`),U(`${M} Active project: ${t}, active draft: ${e}`),!Je(t,e))return;const n=jt(r.settings),i=`${t}/${n}/${e}`;await r.projectFileService.backups.createBackup(i,r.settings)?new x.Notice("Backup created successfully."):new x.Notice("Failed to create backup.")}}function Pi(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(U(`${M} Delete backup command called`),U(`${M} Active project: ${t}, active draft: ${e}`),!Je(t,e))return;const n=jt(r.settings),i=`${t}/${n}/${e}`,a=await r.projectFileService.backups.listBackups(i,r.settings);if(a.length===0){new x.Notice(cn.BACKUPS_NOT_FOUND_DRAFT);return}const s=a[a.length-1];await r.projectFileService.backups.deleteBackup(i,s,r.settings)?new x.Notice(`Backup deleted successfully: ${s}.`):new x.Notice("Failed to delete backup.")}}class Br extends x.Modal{constructor(t,e,n=!1){super(t),this.path=e,this.isDraft=n,this.setTitle("Confirm Overwrite")}onOpen(){const{contentEl:t}=this,e=this.isDraft?"draft folder":"manuscript file";t.createEl("p",{text:`The ${e} "${this.path}" already exists. Do you want to overwrite it?`});const n=t.createDiv({cls:"modal-button-container"});new x.ButtonComponent(n).setButtonText("Cancel").onClick(()=>{this.resolve(!1),this.close()}),new x.ButtonComponent(n).setButtonText("Overwrite").setCta().onClick(()=>{this.resolve(!0),this.close()})}onClose(){const{contentEl:t}=this;t.empty()}open(){return new Promise(t=>{this.resolve=t,super.open()})}}class Di extends x.SuggestModal{constructor(t,e){super(t),this.manager=e,this.backups=[],this.draftFolder="",this.draftName="",this.setPlaceholder("Select a backup to restore..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to restore"},{command:"esc",purpose:"to cancel"}])}async onOpen(){const t=this.manager.activeProject;if(!t){new x.Notice("No active project found."),this.close();return}const e=jt(this.manager.settings);if(this.draftFolder=`${t}/${e}`,this.draftName=t,this.backups=await this.getBackupDetails(),this.backups.length===0){new x.Notice(cn.BACKUPS_NOT_FOUND_PROJECT),this.close();return}this.setTitle(`Restore Backup for Project "${t}"`),super.onOpen()}async getBackupDetails(){const t=this.draftFolder.split("/")[0]||"unknown",e=`${je(this.manager.settings)}/${t}`;try{const n=[],i=jt(this.manager.settings),a=`${e}/${i}`,s=await this.app.vault.adapter.list(a);for(const o of s.folders){const l=o.split("/").pop()||o,c=`${a}/${l}`,f=await this.app.vault.adapter.list(c),d=`${t}/${i}/${l}`;for(const w of f.files){const u=w.split("/").pop()||w,g=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),p=new RegExp(`^${g}_(\\d{4}-\\d{2}-\\d{2}T\\d{2}-\\d{2}-\\d{2})\\.zip$`),b=u.match(p);if(b){const h=await this.app.vault.adapter.stat(w),_=(h==null?void 0:h.size)||0,y=b[1],$=y.replace(/T(\d{2})-(\d{2})-(\d{2})/,"T$1:$2:$3"),P=new Date($).toLocaleString(),D=this.formatFileSize(_);n.push({timestamp:y,size:_,displayText:`${l}: ${P} (${D})`,draftName:l,draftFolder:d})}}}return n.sort((o,l)=>l.timestamp.localeCompare(o.timestamp))}catch{return U(`${M} Backup directory does not exist yet for project '${e}' (this is normal for new projects)`),[]}}formatFileSize(t){if(t===0)return"0 B";const e=Math.floor(Math.log(t)/Math.log(Dn));return parseFloat((t/Math.pow(Dn,e)).toFixed(1))+" "+Or[e]}getSuggestions(t){return this.backups.filter(e=>e.displayText.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.createEl("div",{text:t.displayText})}async onChooseSuggestion(t,e){const n=this.app.vault.getAbstractFileByPath(t.draftFolder);if(n&&n instanceof x.TFolder&&!await new Br(this.app,t.draftFolder,!0).open())return;await this.manager.projectFileService.backups.restoreBackup(t.draftFolder,t.timestamp,this.manager.settings)?new x.Notice(`Backup restored successfully for "${t.draftName}" from ${t.displayText.split(": ")[1].split(" (")[0]}.`):new x.Notice("Failed to restore backup.")}}function Ai(r){return async()=>{U(`${M} List backups command called`),new Di(r.app,r).open()}}function Ni(r){return()=>r.createNewDraftPrompt()}async function ji(r){U(`${M} createOutlineCommand called`);try{const t=r.activeProject,e=r.activeDraft;if(!t||!e){new x.Notice("No active project or draft selected. Please select a project and draft first.");return}const n=r.projectFileService.drafts.getOutlineFile(t,e);if(n){new x.Notice(`Outline file already exists: ${n.path}`);return}await r.projectFileService.drafts.createOutline(t,e,r.settings.outlineTemplate),new x.Notice(`Outline created for draft: ${e}`),U(`${M} Outline created successfully for draft: ${e}`)}catch(t){U(`${M} Error creating outline:`,t),new x.Notice(`Failed to create outline: ${t.message}`)}}function Ti(r){return async()=>{var a;const t=r.projectFileService.drafts,e=r.activeProject,n=r.activeDraft;if(U(`${M} Generate manuscript command called`),U(`${M} Active project: ${e}, active draft: ${n}`),U(`${M} Manager settings manuscript template: ${(a=r.settings)==null?void 0:a.manuscriptNameTemplate}`),!Je(e,n))return;await t.generateManuscript(e,n,r.settings)?new x.Notice("Manuscript generated successfully."):new x.Notice("Failed to generate manuscript.")}}function Oi(r){return()=>r.switchDraftPrompt()}function Bi(r){return async()=>{const t=r.app.workspace.getActiveFile();if(!t){new x.Notice("No file is currently open.");return}const e=t.path,n=jt(r.settings),i=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${bt}$`));if(!i){new x.Notice("The current file is not a chapter.");return}const a=i[1],s=i[2],o=i[3];try{const l=await r.projectFileService.chapters.listChapters(a,s),c=l.findIndex(d=>d.name===o);if(c===-1){new x.Notice("Unable to find the current chapter in the draft.");return}if(c>=l.length-1)return;const f=l[c+1];await r.openChapter(a,s,f.name)}catch(l){U(`${M} Failed to navigate to next chapter:`,l),new x.Notice("Failed to navigate to next chapter.")}}}function Ri(r){return async()=>{const t=r.app.workspace.getActiveFile();if(!t){new x.Notice("No file is currently open.");return}const e=t.path,n=jt(r.settings),i=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${bt}$`));if(!i){new x.Notice("The current file is not a chapter.");return}const a=i[1],s=i[2],o=i[3];try{const l=await r.projectFileService.chapters.listChapters(a,s),c=l.findIndex(d=>d.name===o);if(c===-1){new x.Notice("Unable to find the current chapter in the draft.");return}if(c<=0)return;const f=l[c-1];await r.openChapter(a,s,f.name)}catch(l){U(`${M} Failed to navigate to previous chapter:`,l),new x.Notice("Failed to navigate to previous chapter.")}}}async function Pe(r,t){const e=r.vault.getAbstractFileByPath(t);if(!e||!(e instanceof x.TFile))return null;try{const n=await r.vault.read(e);return zi(n)}catch(n){return U(`${M} Error reading meta file:`,n),null}}async function In(r,t,e){const n=Ii(e),i=r.vault.getAbstractFileByPath(t);i&&i instanceof x.TFile?await r.vault.modify(i,n):await r.vault.create(t,n)}async function Oe(r,t,e,n,i){const a=`${t}/${ae(i)}`;let s=await Pe(r,a);s||(s={total_drafts:0});const o=jt(i),l=r.vault.getAbstractFileByPath(`${t}/${o}`);if(l&&l instanceof x.TFolder){const c=l.children.filter(f=>f instanceof x.TFolder);s.total_drafts=c.length}e!==void 0&&(s.current_active_draft=e,s.active_draft_last_modified=new Date().toISOString()),n&&Object.assign(s,n),s.total_drafts>0&&s.total_word_count&&(s.average_draft_word_count=Math.round(s.total_word_count/s.total_drafts)),await In(r,a,s)}function zi(r){const t=r.match(new RegExp(`${Pt}\\s*\\n([\\s\\S]*?)\\n${Pt}`));if(!t)return null;const e=t[1],n={},i=e.split(`
`);for(const a of i){const s=a.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(s){const o=s[1];let l=s[2].trim();/^-?\d+(\.\d+)?$/.test(l)?l=Number(l):(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),n[o]=l}}return n}function Ii(r){const t=[Pt];if(r.current_active_draft!==void 0&&t.push(`current_active_draft: "${r.current_active_draft}"`),t.push(`total_drafts: ${r.total_drafts}`),r.target_word_count!==void 0&&t.push(`target_word_count: ${r.target_word_count}`),r.active_draft_last_modified!==void 0&&t.push(`active_draft_last_modified: "${r.active_draft_last_modified}"`),r.total_word_count!==void 0&&t.push(`total_word_count: ${r.total_word_count}`),r.average_draft_word_count!==void 0&&t.push(`average_draft_word_count: ${r.average_draft_word_count}`),r.project_type!==void 0&&t.push(`project_type: ${r.project_type}`),t.push(Pt),t.push(""),t.push("# Project Statistics"),t.push(""),r.current_active_draft&&t.push(`**Active Draft:** ${r.current_active_draft}`),t.push(`**Total Drafts:** ${r.total_drafts}`),r.target_word_count&&t.push(`**Target Word Count:** ${r.target_word_count.toLocaleString()}`),r.active_draft_last_modified){const e=new Date(r.active_draft_last_modified);t.push(`**Last Modified:** ${e.toLocaleString()}`)}return r.total_word_count&&t.push(`**Total Word Count:** ${r.total_word_count.toLocaleString()}`),r.average_draft_word_count&&t.push(`**Average Draft Word Count:** ${r.average_draft_word_count.toLocaleString()}`),t.push(""),t.join(`
`)}const An=Object.freeze(Object.defineProperty({__proto__:null,readMetaFile:Pe,updateMetaStats:Oe,writeMetaFile:In},Symbol.toStringTag,{value:"Module"}));async function Li(r,t,e){const n=`${t}/${ae(e)}`,i=await Pe(r,n);if(!i||i.project_type!==Ht.SINGLE)return new x.Notice(`Project is not a ${Ht.SINGLE} project.`),!1;i.project_type=Ht.MULTI,await In(r,n,i);const a=jt(e),s=r.vault.getAbstractFileByPath(`${t}/${a}`);if(!s||!(s instanceof x.TFolder))return new x.Notice("Drafts folder not found."),!1;let o=!1;for(const l of s.children)if(l instanceof x.TFolder){const c=ee(l.name),f=l.children.find(d=>d instanceof x.TFile&&d.name===`${c}${bt}`);if(f){const d=`${l.path}/Chapter 1${bt}`;if(f.path!==d){const w=await r.vault.read(f);await r.vault.create(d,w),await r.vault.delete(f),o=!0}}}return o?new x.Notice(`Converted to multi-file project. Draft files renamed to "Chapter 1${bt}".`):new x.Notice("Converted to multi-file project. No draft files needed renaming."),!0}async function Mi(r,t,e){if(!t){new x.Notice("No active project selected.");return}await Li(r,t,e)}function Ui(r){return()=>r.createNewProjectPrompt()}function Wi(r){return()=>r.selectActiveProjectPrompt()}function Hi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function an(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Rr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(r,t){(function(e){r.exports=e()})(function(){return function e(n,i,a){function s(c,f){if(!i[c]){if(!n[c]){var d=typeof an=="function"&&an;if(!f&&d)return d(c,!0);if(o)return o(c,!0);var w=new Error("Cannot find module '"+c+"'");throw w.code="MODULE_NOT_FOUND",w}var u=i[c]={exports:{}};n[c][0].call(u.exports,function(g){var p=n[c][1][g];return s(p||g)},u,u.exports,e,n,i,a)}return i[c].exports}for(var o=typeof an=="function"&&an,l=0;l<a.length;l++)s(a[l]);return s}({1:[function(e,n,i){var a=e("./utils"),s=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,f,d,w,u,g,p,b=[],h=0,_=l.length,y=_,$=a.getTypeOf(l)!=="string";h<l.length;)y=_-h,d=$?(c=l[h++],f=h<_?l[h++]:0,h<_?l[h++]:0):(c=l.charCodeAt(h++),f=h<_?l.charCodeAt(h++):0,h<_?l.charCodeAt(h++):0),w=c>>2,u=(3&c)<<4|f>>4,g=1<y?(15&f)<<2|d>>6:64,p=2<y?63&d:64,b.push(o.charAt(w)+o.charAt(u)+o.charAt(g)+o.charAt(p));return b.join("")},i.decode=function(l){var c,f,d,w,u,g,p=0,b=0,h="data:";if(l.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var _,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=s.uint8array?new Uint8Array(0|y):new Array(0|y);p<l.length;)c=o.indexOf(l.charAt(p++))<<2|(w=o.indexOf(l.charAt(p++)))>>4,f=(15&w)<<4|(u=o.indexOf(l.charAt(p++)))>>2,d=(3&u)<<6|(g=o.indexOf(l.charAt(p++))),_[b++]=c,u!==64&&(_[b++]=f),g!==64&&(_[b++]=d);return _}},{"./support":30,"./utils":32}],2:[function(e,n,i){var a=e("./external"),s=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(f,d,w,u,g){this.compressedSize=f,this.uncompressedSize=d,this.crc32=w,this.compression=u,this.compressedContent=g}c.prototype={getContentWorker:function(){var f=new s(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return f.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(f,d,w){return f.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(w)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,i){var a=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,i){var a=e("./utils"),s=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var f=0;f<8;f++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?function(c,f,d,w){var u=s,g=w+d;c^=-1;for(var p=w;p<g;p++)c=c>>>8^u[255&(c^f[p])];return-1^c}(0|l,o,o.length,0):function(c,f,d,w){var u=s,g=w+d;c^=-1;for(var p=w;p<g;p++)c=c>>>8^u[255&(c^f.charCodeAt(p))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,n,i){var a=null;a=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:a}},{lie:37}],7:[function(e,n,i){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=a?"uint8array":"array";function f(d,w){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=w,this.meta={}}i.magic="\b\0",o.inherits(f,l),f.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,d.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(w){d.push({data:w,meta:d.meta})}},i.compressWorker=function(d){return new f("Deflate",d)},i.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,i){function a(u,g){var p,b="";for(p=0;p<g;p++)b+=String.fromCharCode(255&u),u>>>=8;return b}function s(u,g,p,b,h,_){var y,$,k=u.file,P=u.compression,D=_!==c.utf8encode,z=o.transformTo("string",_(k.name)),A=o.transformTo("string",c.utf8encode(k.name)),j=k.comment,q=o.transformTo("string",_(j)),F=o.transformTo("string",c.utf8encode(j)),R=A.length!==k.name.length,v=F.length!==j.length,W="",at="",V="",ot=k.dir,G=k.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};g&&!p||(ft.crc32=u.crc32,ft.compressedSize=u.compressedSize,ft.uncompressedSize=u.uncompressedSize);var O=0;g&&(O|=8),D||!R&&!v||(O|=2048);var T=0,lt=0;ot&&(T|=16),h==="UNIX"?(lt=798,T|=function(X,Ct){var At=X;return X||(At=Ct?16893:33204),(65535&At)<<16}(k.unixPermissions,ot)):(lt=20,T|=function(X){return 63&(X||0)}(k.dosPermissions)),y=G.getUTCHours(),y<<=6,y|=G.getUTCMinutes(),y<<=5,y|=G.getUTCSeconds()/2,$=G.getUTCFullYear()-1980,$<<=4,$|=G.getUTCMonth()+1,$<<=5,$|=G.getUTCDate(),R&&(at=a(1,1)+a(f(z),4)+A,W+="up"+a(at.length,2)+at),v&&(V=a(1,1)+a(f(q),4)+F,W+="uc"+a(V.length,2)+V);var L="";return L+=`
\0`,L+=a(O,2),L+=P.magic,L+=a(y,2),L+=a($,2),L+=a(ft.crc32,4),L+=a(ft.compressedSize,4),L+=a(ft.uncompressedSize,4),L+=a(z.length,2),L+=a(W.length,2),{fileRecord:d.LOCAL_FILE_HEADER+L+z+W,dirRecord:d.CENTRAL_FILE_HEADER+a(lt,2)+L+a(q.length,2)+"\0\0\0\0"+a(T,4)+a(b,4)+z+W+q}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),f=e("../crc32"),d=e("../signature");function w(u,g,p,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(w,l),w.prototype.push=function(u){var g=u.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:p?(g+100*(p-b-1))/p:100}}))},w.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var g=this.streamFiles&&!u.file.dir;if(g){var p=s(u,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},w.prototype.closedSource=function(u){this.accumulate=!1;var g=this.streamFiles&&!u.file.dir,p=s(u,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),g)this.push({data:function(b){return d.DATA_DESCRIPTOR+a(b.crc32,4)+a(b.compressedSize,4)+a(b.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},w.prototype.flush=function(){for(var u=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var p=this.bytesWritten-u,b=function(h,_,y,$,k){var P=o.transformTo("string",k($));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(h,2)+a(h,2)+a(_,4)+a(y,4)+a(P.length,2)+P}(this.dirRecords.length,p,u,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},w.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},w.prototype.registerPrevious=function(u){this._sources.push(u);var g=this;return u.on("data",function(p){g.processChunk(p)}),u.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),u.on("error",function(p){g.error(p)}),this},w.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},w.prototype.error=function(u){var g=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var p=0;p<g.length;p++)try{g[p].error(u)}catch{}return!0},w.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,g=0;g<u.length;g++)u[g].lock()},n.exports=w},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,i){var a=e("../compressions"),s=e("./ZipFileWorker");i.generateWorker=function(o,l,c){var f=new s(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{o.forEach(function(w,u){d++;var g=function(_,y){var $=_||y,k=a[$];if(!k)throw new Error($+" is not a valid compression method !");return k}(u.options.compression,l.compression),p=u.options.compressionOptions||l.compressionOptions||{},b=u.dir,h=u.date;u._compressWorker(g,p).withStreamInfo("file",{name:w,dir:b,date:h,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(f)}),f.entriesCount=d}catch(w){f.error(w)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,i){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new a;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(a.prototype=e("./object")).loadAsync=e("./load"),a.support=e("./support"),a.defaults=e("./defaults"),a.version="3.10.1",a.loadAsync=function(s,o){return new a().loadAsync(s,o)},a.external=e("./external"),n.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,i){var a=e("./utils"),s=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),f=e("./nodejsUtils");function d(w){return new s.Promise(function(u,g){var p=w.decompressed.getContentWorker().pipe(new c);p.on("error",function(b){g(b)}).on("end",function(){p.streamInfo.crc32!==w.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}n.exports=function(w,u){var g=this;return u=a.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),f.isNode&&f.isStream(w)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",w,!0,u.optimizedBinaryString,u.base64).then(function(p){var b=new l(u);return b.load(p),b}).then(function(p){var b=[s.Promise.resolve(p)],h=p.files;if(u.checkCRC32)for(var _=0;_<h.length;_++)b.push(d(h[_]));return s.Promise.all(b)}).then(function(p){for(var b=p.shift(),h=b.files,_=0;_<h.length;_++){var y=h[_],$=y.fileNameStr,k=a.resolve(y.fileNameStr);g.file(k,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:u.createFolders}),y.dir||(g.file(k).unsafeOriginalName=$)}return b.zipComment.length&&(g.comment=b.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,i){var a=e("../utils"),s=e("../stream/GenericWorker");function o(l,c){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}a.inherits(o,s),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(f){c.push({data:f,meta:{percent:0}})}).on("error",function(f){c.isPaused?this.generatedError=f:c.error(f)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,i){var a=e("readable-stream").Readable;function s(o,l,c){a.call(this,l),this._helper=o;var f=this;o.on("data",function(d,w){f.push(d)||f._helper.pause(),c&&c(w)}).on("error",function(d){f.emit("error",d)}).on("end",function(){f.push(null)})}e("../utils").inherits(s,a),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,n,i){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(a,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,s);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,s)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var s=new Buffer(a);return s.fill(0),s},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(e,n,i){function a(k,P,D){var z,A=o.getTypeOf(P),j=o.extend(D||{},f);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(k=h(k)),j.createFolders&&(z=b(k))&&_.call(this,z,!0);var q=A==="string"&&j.binary===!1&&j.base64===!1;D&&D.binary!==void 0||(j.binary=!q),(P instanceof d&&P.uncompressedSize===0||j.dir||!P||P.length===0)&&(j.base64=!1,j.binary=!0,P="",j.compression="STORE",A="string");var F=null;F=P instanceof d||P instanceof l?P:g.isNode&&g.isStream(P)?new p(k,P):o.prepareContent(k,P,j.binary,j.optimizedBinaryString,j.base64);var R=new w(k,F,j);this.files[k]=R}var s=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),f=e("./defaults"),d=e("./compressedObject"),w=e("./zipObject"),u=e("./generate"),g=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),b=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var P=k.lastIndexOf("/");return 0<P?k.substring(0,P):""},h=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},_=function(k,P){return P=P!==void 0?P:f.createFolders,k=h(k),this.files[k]||a.call(this,k,null,{dir:!0,createFolders:P}),this.files[k]};function y(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var $={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var P,D,z;for(P in this.files)z=this.files[P],(D=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&k(D,z)},filter:function(k){var P=[];return this.forEach(function(D,z){k(D,z)&&P.push(z)}),P},file:function(k,P,D){if(arguments.length!==1)return k=this.root+k,a.call(this,k,P,D),this;if(y(k)){var z=k;return this.filter(function(j,q){return!q.dir&&z.test(j)})}var A=this.files[this.root+k];return A&&!A.dir?A:null},folder:function(k){if(!k)return this;if(y(k))return this.filter(function(A,j){return j.dir&&k.test(A)});var P=this.root+k,D=_.call(this,P),z=this.clone();return z.root=D.name,z},remove:function(k){k=this.root+k;var P=this.files[k];if(P||(k.slice(-1)!=="/"&&(k+="/"),P=this.files[k]),P&&!P.dir)delete this.files[k];else for(var D=this.filter(function(A,j){return j.name.slice(0,k.length)===k}),z=0;z<D.length;z++)delete this.files[D[z].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var P,D={};try{if((D=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=D.type.toLowerCase(),D.compression=D.compression.toUpperCase(),D.type==="binarystring"&&(D.type="string"),!D.type)throw new Error("No output type specified.");o.checkSupport(D.type),D.platform!=="darwin"&&D.platform!=="freebsd"&&D.platform!=="linux"&&D.platform!=="sunos"||(D.platform="UNIX"),D.platform==="win32"&&(D.platform="DOS");var z=D.comment||this.comment||"";P=u.generateWorker(this,D,z)}catch(A){(P=new l("error")).error(A)}return new c(P,D.type||"string",D.mimeType)},generateAsync:function(k,P){return this.generateInternalStream(k).accumulate(P)},generateNodeStream:function(k,P){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(P)}};n.exports=$},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,i){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,i){var a=e("./DataReader");function s(o){a.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(s,a),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),d=o.charCodeAt(3),w=this.length-4;0<=w;--w)if(this.data[w]===l&&this.data[w+1]===c&&this.data[w+2]===f&&this.data[w+3]===d)return w-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),d=o.charCodeAt(3),w=this.readData(4);return l===w[0]&&c===w[1]&&f===w[2]&&d===w[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,n,i){var a=e("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(e,n,i){var a=e("./Uint8ArrayReader");function s(o){a.call(this,o)}e("../utils").inherits(s,a),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,i){var a=e("./DataReader");function s(o){a.call(this,o)}e("../utils").inherits(s,a),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,n,i){var a=e("./ArrayReader");function s(o){a.call(this,o)}e("../utils").inherits(s,a),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,i){var a=e("../utils"),s=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),f=e("./Uint8ArrayReader");n.exports=function(d){var w=a.getTypeOf(d);return a.checkSupport(w),w!=="string"||s.uint8array?w==="nodebuffer"?new c(d):s.uint8array?new f(a.transformTo("uint8array",d)):new o(a.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,i){var a=e("./GenericWorker"),s=e("../utils");function o(l){a.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,a),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,i){var a=e("./GenericWorker"),s=e("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,a),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,i){var a=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}a.inherits(o,s),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,i){var a=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){c.dataIsReady=!0,c.data=f,c.max=f&&f.length||0,c.type=a.getTypeOf(f),c.isPaused||c._tickAndRepeat()},function(f){c.error(f)})}a.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,i){function a(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=a},{}],29:[function(e,n,i){var a=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),f=e("../external"),d=null;if(c.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function w(g,p){return new f.Promise(function(b,h){var _=[],y=g._internalType,$=g._outputType,k=g._mimeType;g.on("data",function(P,D){_.push(P),p&&p(D)}).on("error",function(P){_=[],h(P)}).on("end",function(){try{var P=function(D,z,A){switch(D){case"blob":return a.newBlob(a.transformTo("arraybuffer",z),A);case"base64":return l.encode(z);default:return a.transformTo(D,z)}}($,function(D,z){var A,j=0,q=null,F=0;for(A=0;A<z.length;A++)F+=z[A].length;switch(D){case"string":return z.join("");case"array":return Array.prototype.concat.apply([],z);case"uint8array":for(q=new Uint8Array(F),A=0;A<z.length;A++)q.set(z[A],j),j+=z[A].length;return q;case"nodebuffer":return Buffer.concat(z);default:throw new Error("concat : unsupported type '"+D+"'")}}(y,_),k);b(P)}catch(D){h(D)}_=[]}).resume()})}function u(g,p,b){var h=p;switch(p){case"blob":case"arraybuffer":h="uint8array";break;case"base64":h="string"}try{this._internalType=h,this._outputType=p,this._mimeType=b,a.checkSupport(h),this._worker=g.pipe(new s(h)),g.lock()}catch(_){this._worker=new o("error"),this._worker.error(_)}}u.prototype={accumulate:function(g){return w(this,g)},on:function(g,p){var b=this;return g==="data"?this._worker.on(g,function(h){p.call(b,h.data,h.meta)}):this._worker.on(g,function(){a.delay(p,arguments,b)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},g)}},n.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var a=new ArrayBuffer(0);try{i.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(a),i.blob=s.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,i){for(var a=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),f=0;f<256;f++)c[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function w(){l.call(this,"utf-8 encode")}i.utf8encode=function(u){return s.nodebuffer?o.newBufferFrom(u,"utf-8"):function(g){var p,b,h,_,y,$=g.length,k=0;for(_=0;_<$;_++)(64512&(b=g.charCodeAt(_)))==55296&&_+1<$&&(64512&(h=g.charCodeAt(_+1)))==56320&&(b=65536+(b-55296<<10)+(h-56320),_++),k+=b<128?1:b<2048?2:b<65536?3:4;for(p=s.uint8array?new Uint8Array(k):new Array(k),_=y=0;y<k;_++)(64512&(b=g.charCodeAt(_)))==55296&&_+1<$&&(64512&(h=g.charCodeAt(_+1)))==56320&&(b=65536+(b-55296<<10)+(h-56320),_++),b<128?p[y++]=b:(b<2048?p[y++]=192|b>>>6:(b<65536?p[y++]=224|b>>>12:(p[y++]=240|b>>>18,p[y++]=128|b>>>12&63),p[y++]=128|b>>>6&63),p[y++]=128|63&b);return p}(u)},i.utf8decode=function(u){return s.nodebuffer?a.transformTo("nodebuffer",u).toString("utf-8"):function(g){var p,b,h,_,y=g.length,$=new Array(2*y);for(p=b=0;p<y;)if((h=g[p++])<128)$[b++]=h;else if(4<(_=c[h]))$[b++]=65533,p+=_-1;else{for(h&=_===2?31:_===3?15:7;1<_&&p<y;)h=h<<6|63&g[p++],_--;1<_?$[b++]=65533:h<65536?$[b++]=h:(h-=65536,$[b++]=55296|h>>10&1023,$[b++]=56320|1023&h)}return $.length!==b&&($.subarray?$=$.subarray(0,b):$.length=b),a.applyFromCharCode($)}(u=a.transformTo(s.uint8array?"uint8array":"array",u))},a.inherits(d,l),d.prototype.processChunk=function(u){var g=a.transformTo(s.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var p=g;(g=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),g.set(p,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var b=function(_,y){var $;for((y=y||_.length)>_.length&&(y=_.length),$=y-1;0<=$&&(192&_[$])==128;)$--;return $<0||$===0?y:$+c[_[$]]>y?$:y}(g),h=g;b!==g.length&&(s.uint8array?(h=g.subarray(0,b),this.leftOver=g.subarray(b,g.length)):(h=g.slice(0,b),this.leftOver=g.slice(b,g.length))),this.push({data:i.utf8decode(h),meta:u.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,a.inherits(w,l),w.prototype.processChunk=function(u){this.push({data:i.utf8encode(u.data),meta:u.meta})},i.Utf8EncodeWorker=w},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,i){var a=e("./support"),s=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(p){return p}function f(p,b){for(var h=0;h<p.length;++h)b[h]=255&p.charCodeAt(h);return b}e("setimmediate"),i.newBlob=function(p,b){i.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var h=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return h.append(p),h.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,b,h){var _=[],y=0,$=p.length;if($<=h)return String.fromCharCode.apply(null,p);for(;y<$;)b==="array"||b==="nodebuffer"?_.push(String.fromCharCode.apply(null,p.slice(y,Math.min(y+h,$)))):_.push(String.fromCharCode.apply(null,p.subarray(y,Math.min(y+h,$)))),y+=h;return _.join("")},stringifyByChar:function(p){for(var b="",h=0;h<p.length;h++)b+=String.fromCharCode(p[h]);return b},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function w(p){var b=65536,h=i.getTypeOf(p),_=!0;if(h==="uint8array"?_=d.applyCanBeUsed.uint8array:h==="nodebuffer"&&(_=d.applyCanBeUsed.nodebuffer),_)for(;1<b;)try{return d.stringifyByChunk(p,h,b)}catch{b=Math.floor(b/2)}return d.stringifyByChar(p)}function u(p,b){for(var h=0;h<p.length;h++)b[h]=p[h];return b}i.applyFromCharCode=w;var g={};g.string={string:c,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return g.string.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:function(p){return f(p,o.allocBuffer(p.length))}},g.array={string:w,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},g.arraybuffer={string:function(p){return w(new Uint8Array(p))},array:function(p){return u(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},g.uint8array={string:w,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return o.newBufferFrom(p)}},g.nodebuffer={string:w,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return g.nodebuffer.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:c},i.transformTo=function(p,b){if(b=b||"",!p)return b;i.checkSupport(p);var h=i.getTypeOf(b);return g[h][p](b)},i.resolve=function(p){for(var b=p.split("/"),h=[],_=0;_<b.length;_++){var y=b[_];y==="."||y===""&&_!==0&&_!==b.length-1||(y===".."?h.pop():h.push(y))}return h.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(p)?"nodebuffer":a.uint8array&&p instanceof Uint8Array?"uint8array":a.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!a[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var b,h,_="";for(h=0;h<(p||"").length;h++)_+="\\x"+((b=p.charCodeAt(h))<16?"0":"")+b.toString(16).toUpperCase();return _},i.delay=function(p,b,h){setImmediate(function(){p.apply(h||null,b||[])})},i.inherits=function(p,b){function h(){}h.prototype=b.prototype,p.prototype=new h},i.extend=function(){var p,b,h={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&h[b]===void 0&&(h[b]=arguments[p][b]);return h},i.prepareContent=function(p,b,h,_,y){return l.Promise.resolve(b).then(function($){return a.blob&&($ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call($))!==-1)&&typeof FileReader<"u"?new l.Promise(function(k,P){var D=new FileReader;D.onload=function(z){k(z.target.result)},D.onerror=function(z){P(z.target.error)},D.readAsArrayBuffer($)}):$}).then(function($){var k=i.getTypeOf($);return k?(k==="arraybuffer"?$=i.transformTo("uint8array",$):k==="string"&&(y?$=s.decode($):h&&_!==!0&&($=function(P){return f(P,a.uint8array?new Uint8Array(P.length):new Array(P.length))}($))),$):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,i){var a=e("./reader/readerFor"),s=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function f(d){this.files=[],this.loadOptions=d}f.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var w=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(w)+", expected "+s.pretty(d)+")")}},isSignature:function(d,w){var u=this.reader.index;this.reader.setIndex(d);var g=this.reader.readString(4)===w;return this.reader.setIndex(u),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),w=c.uint8array?"uint8array":"array",u=s.transformTo(w,d);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,w,u,g=this.zip64EndOfCentralSize-44;0<g;)d=this.reader.readInt(2),w=this.reader.readInt(4),u=this.reader.readData(w),this.zip64ExtensibleData[d]={id:d,length:w,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,w;for(d=0;d<this.files.length;d++)w=this.files[d],this.reader.setIndex(w.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),w.readLocalPart(this.reader),w.handleUTF8(),w.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var w=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var g=w-u;if(0<g)this.isSignature(w,o.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(d){this.reader=a(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,i){var a=e("./reader/readerFor"),s=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),f=e("./compressions"),d=e("./support");function w(u,g){this.options=u,this.loadOptions=g}w.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var g,p;if(u.skip(22),this.fileNameLength=u.readInt(2),p=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(b){for(var h in f)if(Object.prototype.hasOwnProperty.call(f,h)&&f[h].magic===b)return f[h];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,g,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var g=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(g),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=a(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var g,p,b,h=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<h;)g=u.readInt(2),p=u.readInt(2),b=u.readData(p),this.extraFields[g]={id:g,length:p,value:b};u.setIndex(h)},handleUTF8:function(){var u=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var p=s.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var h=s.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(h)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var g=a(u.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var g=a(u.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(u.length-5))}return null}},n.exports=w},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,i){function a(g,p,b){this.name=g,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var s=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),f=e("./stream/GenericWorker");a.prototype={internalStream:function(g){var p=null,b="string";try{if(!g)throw new Error("No output type specified.");var h=(b=g.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var _=!this._dataBinary;_&&!h&&(p=p.pipe(new l.Utf8EncodeWorker)),!_&&h&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(y){(p=new f("error")).error(y)}return new s(p,b,"")},async:function(g,p){return this.internalStream(g).accumulate(p)},nodeStream:function(g,p){return this.internalStream(g||"nodebuffer").toNodejsStream(p)},_compressWorker:function(g,p){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,g,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof f?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],w=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)a.prototype[d[u]]=w;n.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,i){(function(a){var s,o,l=a.MutationObserver||a.WebKitMutationObserver;if(l){var c=0,f=new l(g),d=a.document.createTextNode("");f.observe(d,{characterData:!0}),s=function(){d.data=c=++c%2}}else if(a.setImmediate||a.MessageChannel===void 0)s="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var p=a.document.createElement("script");p.onreadystatechange=function(){g(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},a.document.documentElement.appendChild(p)}:function(){setTimeout(g,0)};else{var w=new a.MessageChannel;w.port1.onmessage=g,s=function(){w.port2.postMessage(0)}}var u=[];function g(){var p,b;o=!0;for(var h=u.length;h;){for(b=u,u=[],p=-1;++p<h;)b[p]();h=u.length}o=!1}n.exports=function(p){u.push(p)!==1||o||s()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,i){var a=e("immediate");function s(){}var o={},l=["REJECTED"],c=["FULFILLED"],f=["PENDING"];function d(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,h!==s&&p(this,h)}function w(h,_,y){this.promise=h,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function u(h,_,y){a(function(){var $;try{$=_(y)}catch(k){return o.reject(h,k)}$===h?o.reject(h,new TypeError("Cannot resolve promise with itself")):o.resolve(h,$)})}function g(h){var _=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof _=="function")return function(){_.apply(h,arguments)}}function p(h,_){var y=!1;function $(D){y||(y=!0,o.reject(h,D))}function k(D){y||(y=!0,o.resolve(h,D))}var P=b(function(){_(k,$)});P.status==="error"&&$(P.value)}function b(h,_){var y={};try{y.value=h(_),y.status="success"}catch($){y.status="error",y.value=$}return y}(n.exports=d).prototype.finally=function(h){if(typeof h!="function")return this;var _=this.constructor;return this.then(function(y){return _.resolve(h()).then(function(){return y})},function(y){return _.resolve(h()).then(function(){throw y})})},d.prototype.catch=function(h){return this.then(null,h)},d.prototype.then=function(h,_){if(typeof h!="function"&&this.state===c||typeof _!="function"&&this.state===l)return this;var y=new this.constructor(s);return this.state!==f?u(y,this.state===c?h:_,this.outcome):this.queue.push(new w(y,h,_)),y},w.prototype.callFulfilled=function(h){o.resolve(this.promise,h)},w.prototype.otherCallFulfilled=function(h){u(this.promise,this.onFulfilled,h)},w.prototype.callRejected=function(h){o.reject(this.promise,h)},w.prototype.otherCallRejected=function(h){u(this.promise,this.onRejected,h)},o.resolve=function(h,_){var y=b(g,_);if(y.status==="error")return o.reject(h,y.value);var $=y.value;if($)p(h,$);else{h.state=c,h.outcome=_;for(var k=-1,P=h.queue.length;++k<P;)h.queue[k].callFulfilled(_)}return h},o.reject=function(h,_){h.state=l,h.outcome=_;for(var y=-1,$=h.queue.length;++y<$;)h.queue[y].callRejected(_);return h},d.resolve=function(h){return h instanceof this?h:o.resolve(new this(s),h)},d.reject=function(h){var _=new this(s);return o.reject(_,h)},d.all=function(h){var _=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=h.length,$=!1;if(!y)return this.resolve([]);for(var k=new Array(y),P=0,D=-1,z=new this(s);++D<y;)A(h[D],D);return z;function A(j,q){_.resolve(j).then(function(F){k[q]=F,++P!==y||$||($=!0,o.resolve(z,k))},function(F){$||($=!0,o.reject(z,F))})}},d.race=function(h){var _=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=h.length,$=!1;if(!y)return this.resolve([]);for(var k=-1,P=new this(s);++k<y;)D=h[k],_.resolve(D).then(function(z){$||($=!0,o.resolve(P,z))},function(z){$||($=!0,o.reject(P,z))});var D;return P}},{immediate:36}],38:[function(e,n,i){var a={};(0,e("./lib/utils/common").assign)(a,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,i){var a=e("./zlib/deflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),f=Object.prototype.toString,d=0,w=-1,u=0,g=8;function p(h){if(!(this instanceof p))return new p(h);this.options=s.assign({level:w,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},h||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=a.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(y!==d)throw new Error(l[y]);if(_.header&&a.deflateSetHeader(this.strm,_.header),_.dictionary){var $;if($=typeof _.dictionary=="string"?o.string2buf(_.dictionary):f.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(y=a.deflateSetDictionary(this.strm,$))!==d)throw new Error(l[y]);this._dict_set=!0}}function b(h,_){var y=new p(_);if(y.push(h,!0),y.err)throw y.msg||l[y.err];return y.result}p.prototype.push=function(h,_){var y,$,k=this.strm,P=this.options.chunkSize;if(this.ended)return!1;$=_===~~_?_:_===!0?4:0,typeof h=="string"?k.input=o.string2buf(h):f.call(h)==="[object ArrayBuffer]"?k.input=new Uint8Array(h):k.input=h,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(P),k.next_out=0,k.avail_out=P),(y=a.deflate(k,$))!==1&&y!==d)return this.onEnd(y),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||$!==4&&$!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(k.output,k.next_out))):this.onData(s.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&y!==1);return $===4?(y=a.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===d):$!==2||(this.onEnd(d),!(k.avail_out=0))},p.prototype.onData=function(h){this.chunks.push(h)},p.prototype.onEnd=function(h){h===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},i.Deflate=p,i.deflate=b,i.deflateRaw=function(h,_){return(_=_||{}).raw=!0,b(h,_)},i.gzip=function(h,_){return(_=_||{}).gzip=!0,b(h,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,i){var a=e("./zlib/inflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),f=e("./zlib/zstream"),d=e("./zlib/gzheader"),w=Object.prototype.toString;function u(p){if(!(this instanceof u))return new u(p);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var h=a.inflateInit2(this.strm,b.windowBits);if(h!==l.Z_OK)throw new Error(c[h]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}function g(p,b){var h=new u(b);if(h.push(p,!0),h.err)throw h.msg||c[h.err];return h.result}u.prototype.push=function(p,b){var h,_,y,$,k,P,D=this.strm,z=this.options.chunkSize,A=this.options.dictionary,j=!1;if(this.ended)return!1;_=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?D.input=o.binstring2buf(p):w.call(p)==="[object ArrayBuffer]"?D.input=new Uint8Array(p):D.input=p,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new s.Buf8(z),D.next_out=0,D.avail_out=z),(h=a.inflate(D,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&A&&(P=typeof A=="string"?o.string2buf(A):w.call(A)==="[object ArrayBuffer]"?new Uint8Array(A):A,h=a.inflateSetDictionary(this.strm,P)),h===l.Z_BUF_ERROR&&j===!0&&(h=l.Z_OK,j=!1),h!==l.Z_STREAM_END&&h!==l.Z_OK)return this.onEnd(h),!(this.ended=!0);D.next_out&&(D.avail_out!==0&&h!==l.Z_STREAM_END&&(D.avail_in!==0||_!==l.Z_FINISH&&_!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(D.output,D.next_out),$=D.next_out-y,k=o.buf2string(D.output,y),D.next_out=$,D.avail_out=z-$,$&&s.arraySet(D.output,D.output,y,$,0),this.onData(k)):this.onData(s.shrinkBuf(D.output,D.next_out)))),D.avail_in===0&&D.avail_out===0&&(j=!0)}while((0<D.avail_in||D.avail_out===0)&&h!==l.Z_STREAM_END);return h===l.Z_STREAM_END&&(_=l.Z_FINISH),_===l.Z_FINISH?(h=a.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===l.Z_OK):_!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(D.avail_out=0))},u.prototype.onData=function(p){this.chunks.push(p)},u.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=u,i.inflate=g,i.inflateRaw=function(p,b){return(b=b||{}).raw=!0,g(p,b)},i.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,i){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var f=c.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var d in f)f.hasOwnProperty(d)&&(l[d]=f[d])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var s={arraySet:function(l,c,f,d,w){if(c.subarray&&l.subarray)l.set(c.subarray(f,f+d),w);else for(var u=0;u<d;u++)l[w+u]=c[f+u]},flattenChunks:function(l){var c,f,d,w,u,g;for(c=d=0,f=l.length;c<f;c++)d+=l[c].length;for(g=new Uint8Array(d),c=w=0,f=l.length;c<f;c++)u=l[c],g.set(u,w),w+=u.length;return g}},o={arraySet:function(l,c,f,d,w){for(var u=0;u<d;u++)l[w+u]=c[f+u]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,s)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(a)},{}],42:[function(e,n,i){var a=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new a.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function f(d,w){if(w<65537&&(d.subarray&&o||!d.subarray&&s))return String.fromCharCode.apply(null,a.shrinkBuf(d,w));for(var u="",g=0;g<w;g++)u+=String.fromCharCode(d[g]);return u}l[254]=l[254]=1,i.string2buf=function(d){var w,u,g,p,b,h=d.length,_=0;for(p=0;p<h;p++)(64512&(u=d.charCodeAt(p)))==55296&&p+1<h&&(64512&(g=d.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(g-56320),p++),_+=u<128?1:u<2048?2:u<65536?3:4;for(w=new a.Buf8(_),p=b=0;b<_;p++)(64512&(u=d.charCodeAt(p)))==55296&&p+1<h&&(64512&(g=d.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(g-56320),p++),u<128?w[b++]=u:(u<2048?w[b++]=192|u>>>6:(u<65536?w[b++]=224|u>>>12:(w[b++]=240|u>>>18,w[b++]=128|u>>>12&63),w[b++]=128|u>>>6&63),w[b++]=128|63&u);return w},i.buf2binstring=function(d){return f(d,d.length)},i.binstring2buf=function(d){for(var w=new a.Buf8(d.length),u=0,g=w.length;u<g;u++)w[u]=d.charCodeAt(u);return w},i.buf2string=function(d,w){var u,g,p,b,h=w||d.length,_=new Array(2*h);for(u=g=0;u<h;)if((p=d[u++])<128)_[g++]=p;else if(4<(b=l[p]))_[g++]=65533,u+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&u<h;)p=p<<6|63&d[u++],b--;1<b?_[g++]=65533:p<65536?_[g++]=p:(p-=65536,_[g++]=55296|p>>10&1023,_[g++]=56320|1023&p)}return f(_,g)},i.utf8border=function(d,w){var u;for((w=w||d.length)>d.length&&(w=d.length),u=w-1;0<=u&&(192&d[u])==128;)u--;return u<0||u===0?w:u+l[d[u]]>w?u:w}},{"./common":41}],43:[function(e,n,i){n.exports=function(a,s,o,l){for(var c=65535&a|0,f=a>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;f=f+(c=c+s[l++]|0)|0,--d;);c%=65521,f%=65521}return c|f<<16|0}},{}],44:[function(e,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,i){var a=function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o}();n.exports=function(s,o,l,c){var f=a,d=c+l;s^=-1;for(var w=c;w<d;w++)s=s>>>8^f[255&(s^o[w])];return-1^s}},{}],46:[function(e,n,i){var a,s=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),f=e("./messages"),d=0,w=4,u=0,g=-2,p=-1,b=4,h=2,_=8,y=9,$=286,k=30,P=19,D=2*$+1,z=15,A=3,j=258,q=j+A+1,F=42,R=113,v=1,W=2,at=3,V=4;function ot(m,H){return m.msg=f[H],H}function G(m){return(m<<1)-(4<m?9:0)}function ft(m){for(var H=m.length;0<=--H;)m[H]=0}function O(m){var H=m.state,I=H.pending;I>m.avail_out&&(I=m.avail_out),I!==0&&(s.arraySet(m.output,H.pending_buf,H.pending_out,I,m.next_out),m.next_out+=I,H.pending_out+=I,m.total_out+=I,m.avail_out-=I,H.pending-=I,H.pending===0&&(H.pending_out=0))}function T(m,H){o._tr_flush_block(m,0<=m.block_start?m.block_start:-1,m.strstart-m.block_start,H),m.block_start=m.strstart,O(m.strm)}function lt(m,H){m.pending_buf[m.pending++]=H}function L(m,H){m.pending_buf[m.pending++]=H>>>8&255,m.pending_buf[m.pending++]=255&H}function X(m,H){var I,C,S=m.max_chain_length,E=m.strstart,Z=m.prev_length,Y=m.nice_match,N=m.strstart>m.w_size-q?m.strstart-(m.w_size-q):0,J=m.window,it=m.w_mask,tt=m.prev,B=m.strstart+j,nt=J[E+Z-1],st=J[E+Z];m.prev_length>=m.good_match&&(S>>=2),Y>m.lookahead&&(Y=m.lookahead);do if(J[(I=H)+Z]===st&&J[I+Z-1]===nt&&J[I]===J[E]&&J[++I]===J[E+1]){E+=2,I++;do;while(J[++E]===J[++I]&&J[++E]===J[++I]&&J[++E]===J[++I]&&J[++E]===J[++I]&&J[++E]===J[++I]&&J[++E]===J[++I]&&J[++E]===J[++I]&&J[++E]===J[++I]&&E<B);if(C=j-(B-E),E=B-j,Z<C){if(m.match_start=H,Y<=(Z=C))break;nt=J[E+Z-1],st=J[E+Z]}}while((H=tt[H&it])>N&&--S!=0);return Z<=m.lookahead?Z:m.lookahead}function Ct(m){var H,I,C,S,E,Z,Y,N,J,it,tt=m.w_size;do{if(S=m.window_size-m.lookahead-m.strstart,m.strstart>=tt+(tt-q)){for(s.arraySet(m.window,m.window,tt,tt,0),m.match_start-=tt,m.strstart-=tt,m.block_start-=tt,H=I=m.hash_size;C=m.head[--H],m.head[H]=tt<=C?C-tt:0,--I;);for(H=I=tt;C=m.prev[--H],m.prev[H]=tt<=C?C-tt:0,--I;);S+=tt}if(m.strm.avail_in===0)break;if(Z=m.strm,Y=m.window,N=m.strstart+m.lookahead,J=S,it=void 0,it=Z.avail_in,J<it&&(it=J),I=it===0?0:(Z.avail_in-=it,s.arraySet(Y,Z.input,Z.next_in,it,N),Z.state.wrap===1?Z.adler=l(Z.adler,Y,it,N):Z.state.wrap===2&&(Z.adler=c(Z.adler,Y,it,N)),Z.next_in+=it,Z.total_in+=it,it),m.lookahead+=I,m.lookahead+m.insert>=A)for(E=m.strstart-m.insert,m.ins_h=m.window[E],m.ins_h=(m.ins_h<<m.hash_shift^m.window[E+1])&m.hash_mask;m.insert&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[E+A-1])&m.hash_mask,m.prev[E&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=E,E++,m.insert--,!(m.lookahead+m.insert<A)););}while(m.lookahead<q&&m.strm.avail_in!==0)}function At(m,H){for(var I,C;;){if(m.lookahead<q){if(Ct(m),m.lookahead<q&&H===d)return v;if(m.lookahead===0)break}if(I=0,m.lookahead>=A&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+A-1])&m.hash_mask,I=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),I!==0&&m.strstart-I<=m.w_size-q&&(m.match_length=X(m,I)),m.match_length>=A)if(C=o._tr_tally(m,m.strstart-m.match_start,m.match_length-A),m.lookahead-=m.match_length,m.match_length<=m.max_lazy_match&&m.lookahead>=A){for(m.match_length--;m.strstart++,m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+A-1])&m.hash_mask,I=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart,--m.match_length!=0;);m.strstart++}else m.strstart+=m.match_length,m.match_length=0,m.ins_h=m.window[m.strstart],m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+1])&m.hash_mask;else C=o._tr_tally(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++;if(C&&(T(m,!1),m.strm.avail_out===0))return v}return m.insert=m.strstart<A-1?m.strstart:A-1,H===w?(T(m,!0),m.strm.avail_out===0?at:V):m.last_lit&&(T(m,!1),m.strm.avail_out===0)?v:W}function wt(m,H){for(var I,C,S;;){if(m.lookahead<q){if(Ct(m),m.lookahead<q&&H===d)return v;if(m.lookahead===0)break}if(I=0,m.lookahead>=A&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+A-1])&m.hash_mask,I=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),m.prev_length=m.match_length,m.prev_match=m.match_start,m.match_length=A-1,I!==0&&m.prev_length<m.max_lazy_match&&m.strstart-I<=m.w_size-q&&(m.match_length=X(m,I),m.match_length<=5&&(m.strategy===1||m.match_length===A&&4096<m.strstart-m.match_start)&&(m.match_length=A-1)),m.prev_length>=A&&m.match_length<=m.prev_length){for(S=m.strstart+m.lookahead-A,C=o._tr_tally(m,m.strstart-1-m.prev_match,m.prev_length-A),m.lookahead-=m.prev_length-1,m.prev_length-=2;++m.strstart<=S&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+A-1])&m.hash_mask,I=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),--m.prev_length!=0;);if(m.match_available=0,m.match_length=A-1,m.strstart++,C&&(T(m,!1),m.strm.avail_out===0))return v}else if(m.match_available){if((C=o._tr_tally(m,0,m.window[m.strstart-1]))&&T(m,!1),m.strstart++,m.lookahead--,m.strm.avail_out===0)return v}else m.match_available=1,m.strstart++,m.lookahead--}return m.match_available&&(C=o._tr_tally(m,0,m.window[m.strstart-1]),m.match_available=0),m.insert=m.strstart<A-1?m.strstart:A-1,H===w?(T(m,!0),m.strm.avail_out===0?at:V):m.last_lit&&(T(m,!1),m.strm.avail_out===0)?v:W}function yt(m,H,I,C,S){this.good_length=m,this.max_lazy=H,this.nice_length=I,this.max_chain=C,this.func=S}function Nt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*D),this.dyn_dtree=new s.Buf16(2*(2*k+1)),this.bl_tree=new s.Buf16(2*(2*P+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(z+1),this.heap=new s.Buf16(2*$+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*$+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function xt(m){var H;return m&&m.state?(m.total_in=m.total_out=0,m.data_type=h,(H=m.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?F:R,m.adler=H.wrap===2?0:1,H.last_flush=d,o._tr_init(H),u):ot(m,g)}function Jt(m){var H=xt(m);return H===u&&function(I){I.window_size=2*I.w_size,ft(I.head),I.max_lazy_match=a[I.level].max_lazy,I.good_match=a[I.level].good_length,I.nice_match=a[I.level].nice_length,I.max_chain_length=a[I.level].max_chain,I.strstart=0,I.block_start=0,I.lookahead=0,I.insert=0,I.match_length=I.prev_length=A-1,I.match_available=0,I.ins_h=0}(m.state),H}function Lt(m,H,I,C,S,E){if(!m)return g;var Z=1;if(H===p&&(H=6),C<0?(Z=0,C=-C):15<C&&(Z=2,C-=16),S<1||y<S||I!==_||C<8||15<C||H<0||9<H||E<0||b<E)return ot(m,g);C===8&&(C=9);var Y=new Nt;return(m.state=Y).strm=m,Y.wrap=Z,Y.gzhead=null,Y.w_bits=C,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=S+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+A-1)/A),Y.window=new s.Buf8(2*Y.w_size),Y.head=new s.Buf16(Y.hash_size),Y.prev=new s.Buf16(Y.w_size),Y.lit_bufsize=1<<S+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new s.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=H,Y.strategy=E,Y.method=I,Jt(m)}a=[new yt(0,0,0,0,function(m,H){var I=65535;for(I>m.pending_buf_size-5&&(I=m.pending_buf_size-5);;){if(m.lookahead<=1){if(Ct(m),m.lookahead===0&&H===d)return v;if(m.lookahead===0)break}m.strstart+=m.lookahead,m.lookahead=0;var C=m.block_start+I;if((m.strstart===0||m.strstart>=C)&&(m.lookahead=m.strstart-C,m.strstart=C,T(m,!1),m.strm.avail_out===0)||m.strstart-m.block_start>=m.w_size-q&&(T(m,!1),m.strm.avail_out===0))return v}return m.insert=0,H===w?(T(m,!0),m.strm.avail_out===0?at:V):(m.strstart>m.block_start&&(T(m,!1),m.strm.avail_out),v)}),new yt(4,4,8,4,At),new yt(4,5,16,8,At),new yt(4,6,32,32,At),new yt(4,4,16,16,wt),new yt(8,16,32,32,wt),new yt(8,16,128,128,wt),new yt(8,32,128,256,wt),new yt(32,128,258,1024,wt),new yt(32,258,258,4096,wt)],i.deflateInit=function(m,H){return Lt(m,H,_,15,8,0)},i.deflateInit2=Lt,i.deflateReset=Jt,i.deflateResetKeep=xt,i.deflateSetHeader=function(m,H){return m&&m.state?m.state.wrap!==2?g:(m.state.gzhead=H,u):g},i.deflate=function(m,H){var I,C,S,E;if(!m||!m.state||5<H||H<0)return m?ot(m,g):g;if(C=m.state,!m.output||!m.input&&m.avail_in!==0||C.status===666&&H!==w)return ot(m,m.avail_out===0?-5:g);if(C.strm=m,I=C.last_flush,C.last_flush=H,C.status===F)if(C.wrap===2)m.adler=0,lt(C,31),lt(C,139),lt(C,8),C.gzhead?(lt(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),lt(C,255&C.gzhead.time),lt(C,C.gzhead.time>>8&255),lt(C,C.gzhead.time>>16&255),lt(C,C.gzhead.time>>24&255),lt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),lt(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(lt(C,255&C.gzhead.extra.length),lt(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(m.adler=c(m.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(lt(C,0),lt(C,0),lt(C,0),lt(C,0),lt(C,0),lt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),lt(C,3),C.status=R);else{var Z=_+(C.w_bits-8<<4)<<8;Z|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(Z|=32),Z+=31-Z%31,C.status=R,L(C,Z),C.strstart!==0&&(L(C,m.adler>>>16),L(C,65535&m.adler)),m.adler=1}if(C.status===69)if(C.gzhead.extra){for(S=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>S&&(m.adler=c(m.adler,C.pending_buf,C.pending-S,S)),O(m),S=C.pending,C.pending!==C.pending_buf_size));)lt(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>S&&(m.adler=c(m.adler,C.pending_buf,C.pending-S,S)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){S=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>S&&(m.adler=c(m.adler,C.pending_buf,C.pending-S,S)),O(m),S=C.pending,C.pending===C.pending_buf_size)){E=1;break}E=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,lt(C,E)}while(E!==0);C.gzhead.hcrc&&C.pending>S&&(m.adler=c(m.adler,C.pending_buf,C.pending-S,S)),E===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){S=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>S&&(m.adler=c(m.adler,C.pending_buf,C.pending-S,S)),O(m),S=C.pending,C.pending===C.pending_buf_size)){E=1;break}E=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,lt(C,E)}while(E!==0);C.gzhead.hcrc&&C.pending>S&&(m.adler=c(m.adler,C.pending_buf,C.pending-S,S)),E===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&O(m),C.pending+2<=C.pending_buf_size&&(lt(C,255&m.adler),lt(C,m.adler>>8&255),m.adler=0,C.status=R)):C.status=R),C.pending!==0){if(O(m),m.avail_out===0)return C.last_flush=-1,u}else if(m.avail_in===0&&G(H)<=G(I)&&H!==w)return ot(m,-5);if(C.status===666&&m.avail_in!==0)return ot(m,-5);if(m.avail_in!==0||C.lookahead!==0||H!==d&&C.status!==666){var Y=C.strategy===2?function(N,J){for(var it;;){if(N.lookahead===0&&(Ct(N),N.lookahead===0)){if(J===d)return v;break}if(N.match_length=0,it=o._tr_tally(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++,it&&(T(N,!1),N.strm.avail_out===0))return v}return N.insert=0,J===w?(T(N,!0),N.strm.avail_out===0?at:V):N.last_lit&&(T(N,!1),N.strm.avail_out===0)?v:W}(C,H):C.strategy===3?function(N,J){for(var it,tt,B,nt,st=N.window;;){if(N.lookahead<=j){if(Ct(N),N.lookahead<=j&&J===d)return v;if(N.lookahead===0)break}if(N.match_length=0,N.lookahead>=A&&0<N.strstart&&(tt=st[B=N.strstart-1])===st[++B]&&tt===st[++B]&&tt===st[++B]){nt=N.strstart+j;do;while(tt===st[++B]&&tt===st[++B]&&tt===st[++B]&&tt===st[++B]&&tt===st[++B]&&tt===st[++B]&&tt===st[++B]&&tt===st[++B]&&B<nt);N.match_length=j-(nt-B),N.match_length>N.lookahead&&(N.match_length=N.lookahead)}if(N.match_length>=A?(it=o._tr_tally(N,1,N.match_length-A),N.lookahead-=N.match_length,N.strstart+=N.match_length,N.match_length=0):(it=o._tr_tally(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++),it&&(T(N,!1),N.strm.avail_out===0))return v}return N.insert=0,J===w?(T(N,!0),N.strm.avail_out===0?at:V):N.last_lit&&(T(N,!1),N.strm.avail_out===0)?v:W}(C,H):a[C.level].func(C,H);if(Y!==at&&Y!==V||(C.status=666),Y===v||Y===at)return m.avail_out===0&&(C.last_flush=-1),u;if(Y===W&&(H===1?o._tr_align(C):H!==5&&(o._tr_stored_block(C,0,0,!1),H===3&&(ft(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),O(m),m.avail_out===0))return C.last_flush=-1,u}return H!==w?u:C.wrap<=0?1:(C.wrap===2?(lt(C,255&m.adler),lt(C,m.adler>>8&255),lt(C,m.adler>>16&255),lt(C,m.adler>>24&255),lt(C,255&m.total_in),lt(C,m.total_in>>8&255),lt(C,m.total_in>>16&255),lt(C,m.total_in>>24&255)):(L(C,m.adler>>>16),L(C,65535&m.adler)),O(m),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?u:1)},i.deflateEnd=function(m){var H;return m&&m.state?(H=m.state.status)!==F&&H!==69&&H!==73&&H!==91&&H!==103&&H!==R&&H!==666?ot(m,g):(m.state=null,H===R?ot(m,-3):u):g},i.deflateSetDictionary=function(m,H){var I,C,S,E,Z,Y,N,J,it=H.length;if(!m||!m.state||(E=(I=m.state).wrap)===2||E===1&&I.status!==F||I.lookahead)return g;for(E===1&&(m.adler=l(m.adler,H,it,0)),I.wrap=0,it>=I.w_size&&(E===0&&(ft(I.head),I.strstart=0,I.block_start=0,I.insert=0),J=new s.Buf8(I.w_size),s.arraySet(J,H,it-I.w_size,I.w_size,0),H=J,it=I.w_size),Z=m.avail_in,Y=m.next_in,N=m.input,m.avail_in=it,m.next_in=0,m.input=H,Ct(I);I.lookahead>=A;){for(C=I.strstart,S=I.lookahead-(A-1);I.ins_h=(I.ins_h<<I.hash_shift^I.window[C+A-1])&I.hash_mask,I.prev[C&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=C,C++,--S;);I.strstart=C,I.lookahead=A-1,Ct(I)}return I.strstart+=I.lookahead,I.block_start=I.strstart,I.insert=I.lookahead,I.lookahead=0,I.match_length=I.prev_length=A-1,I.match_available=0,m.next_in=Y,m.input=N,m.avail_in=Z,I.wrap=E,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,i){n.exports=function(a,s){var o,l,c,f,d,w,u,g,p,b,h,_,y,$,k,P,D,z,A,j,q,F,R,v,W;o=a.state,l=a.next_in,v=a.input,c=l+(a.avail_in-5),f=a.next_out,W=a.output,d=f-(s-a.avail_out),w=f+(a.avail_out-257),u=o.dmax,g=o.wsize,p=o.whave,b=o.wnext,h=o.window,_=o.hold,y=o.bits,$=o.lencode,k=o.distcode,P=(1<<o.lenbits)-1,D=(1<<o.distbits)-1;t:do{y<15&&(_+=v[l++]<<y,y+=8,_+=v[l++]<<y,y+=8),z=$[_&P];e:for(;;){if(_>>>=A=z>>>24,y-=A,(A=z>>>16&255)===0)W[f++]=65535&z;else{if(!(16&A)){if(!(64&A)){z=$[(65535&z)+(_&(1<<A)-1)];continue e}if(32&A){o.mode=12;break t}a.msg="invalid literal/length code",o.mode=30;break t}j=65535&z,(A&=15)&&(y<A&&(_+=v[l++]<<y,y+=8),j+=_&(1<<A)-1,_>>>=A,y-=A),y<15&&(_+=v[l++]<<y,y+=8,_+=v[l++]<<y,y+=8),z=k[_&D];n:for(;;){if(_>>>=A=z>>>24,y-=A,!(16&(A=z>>>16&255))){if(!(64&A)){z=k[(65535&z)+(_&(1<<A)-1)];continue n}a.msg="invalid distance code",o.mode=30;break t}if(q=65535&z,y<(A&=15)&&(_+=v[l++]<<y,(y+=8)<A&&(_+=v[l++]<<y,y+=8)),u<(q+=_&(1<<A)-1)){a.msg="invalid distance too far back",o.mode=30;break t}if(_>>>=A,y-=A,(A=f-d)<q){if(p<(A=q-A)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break t}if(R=h,(F=0)===b){if(F+=g-A,A<j){for(j-=A;W[f++]=h[F++],--A;);F=f-q,R=W}}else if(b<A){if(F+=g+b-A,(A-=b)<j){for(j-=A;W[f++]=h[F++],--A;);if(F=0,b<j){for(j-=A=b;W[f++]=h[F++],--A;);F=f-q,R=W}}}else if(F+=b-A,A<j){for(j-=A;W[f++]=h[F++],--A;);F=f-q,R=W}for(;2<j;)W[f++]=R[F++],W[f++]=R[F++],W[f++]=R[F++],j-=3;j&&(W[f++]=R[F++],1<j&&(W[f++]=R[F++]))}else{for(F=f-q;W[f++]=W[F++],W[f++]=W[F++],W[f++]=W[F++],2<(j-=3););j&&(W[f++]=W[F++],1<j&&(W[f++]=W[F++]))}break}}break}}while(l<c&&f<w);l-=j=y>>3,_&=(1<<(y-=j<<3))-1,a.next_in=l,a.next_out=f,a.avail_in=l<c?c-l+5:5-(l-c),a.avail_out=f<w?w-f+257:257-(f-w),o.hold=_,o.bits=y}},{}],49:[function(e,n,i){var a=e("../utils/common"),s=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),f=1,d=2,w=0,u=-2,g=1,p=852,b=592;function h(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(F){var R;return F&&F.state?(R=F.state,F.total_in=F.total_out=R.total=0,F.msg="",R.wrap&&(F.adler=1&R.wrap),R.mode=g,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new a.Buf32(p),R.distcode=R.distdyn=new a.Buf32(b),R.sane=1,R.back=-1,w):u}function $(F){var R;return F&&F.state?((R=F.state).wsize=0,R.whave=0,R.wnext=0,y(F)):u}function k(F,R){var v,W;return F&&F.state?(W=F.state,R<0?(v=0,R=-R):(v=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?u:(W.window!==null&&W.wbits!==R&&(W.window=null),W.wrap=v,W.wbits=R,$(F))):u}function P(F,R){var v,W;return F?(W=new _,(F.state=W).window=null,(v=k(F,R))!==w&&(F.state=null),v):u}var D,z,A=!0;function j(F){if(A){var R;for(D=new a.Buf32(512),z=new a.Buf32(32),R=0;R<144;)F.lens[R++]=8;for(;R<256;)F.lens[R++]=9;for(;R<280;)F.lens[R++]=7;for(;R<288;)F.lens[R++]=8;for(c(f,F.lens,0,288,D,0,F.work,{bits:9}),R=0;R<32;)F.lens[R++]=5;c(d,F.lens,0,32,z,0,F.work,{bits:5}),A=!1}F.lencode=D,F.lenbits=9,F.distcode=z,F.distbits=5}function q(F,R,v,W){var at,V=F.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new a.Buf8(V.wsize)),W>=V.wsize?(a.arraySet(V.window,R,v-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(W<(at=V.wsize-V.wnext)&&(at=W),a.arraySet(V.window,R,v-W,at,V.wnext),(W-=at)?(a.arraySet(V.window,R,v-W,W,0),V.wnext=W,V.whave=V.wsize):(V.wnext+=at,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=at))),0}i.inflateReset=$,i.inflateReset2=k,i.inflateResetKeep=y,i.inflateInit=function(F){return P(F,15)},i.inflateInit2=P,i.inflate=function(F,R){var v,W,at,V,ot,G,ft,O,T,lt,L,X,Ct,At,wt,yt,Nt,xt,Jt,Lt,m,H,I,C,S=0,E=new a.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&F.avail_in!==0)return u;(v=F.state).mode===12&&(v.mode=13),ot=F.next_out,at=F.output,ft=F.avail_out,V=F.next_in,W=F.input,G=F.avail_in,O=v.hold,T=v.bits,lt=G,L=ft,H=w;t:for(;;)switch(v.mode){case g:if(v.wrap===0){v.mode=13;break}for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(2&v.wrap&&O===35615){E[v.check=0]=255&O,E[1]=O>>>8&255,v.check=o(v.check,E,2,0),T=O=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&O)<<8)+(O>>8))%31){F.msg="incorrect header check",v.mode=30;break}if((15&O)!=8){F.msg="unknown compression method",v.mode=30;break}if(T-=4,m=8+(15&(O>>>=4)),v.wbits===0)v.wbits=m;else if(m>v.wbits){F.msg="invalid window size",v.mode=30;break}v.dmax=1<<m,F.adler=v.check=1,v.mode=512&O?10:12,T=O=0;break;case 2:for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(v.flags=O,(255&v.flags)!=8){F.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){F.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=O>>8&1),512&v.flags&&(E[0]=255&O,E[1]=O>>>8&255,v.check=o(v.check,E,2,0)),T=O=0,v.mode=3;case 3:for(;T<32;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}v.head&&(v.head.time=O),512&v.flags&&(E[0]=255&O,E[1]=O>>>8&255,E[2]=O>>>16&255,E[3]=O>>>24&255,v.check=o(v.check,E,4,0)),T=O=0,v.mode=4;case 4:for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}v.head&&(v.head.xflags=255&O,v.head.os=O>>8),512&v.flags&&(E[0]=255&O,E[1]=O>>>8&255,v.check=o(v.check,E,2,0)),T=O=0,v.mode=5;case 5:if(1024&v.flags){for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}v.length=O,v.head&&(v.head.extra_len=O),512&v.flags&&(E[0]=255&O,E[1]=O>>>8&255,v.check=o(v.check,E,2,0)),T=O=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(G<(X=v.length)&&(X=G),X&&(v.head&&(m=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),a.arraySet(v.head.extra,W,V,X,m)),512&v.flags&&(v.check=o(v.check,W,X,V)),G-=X,V+=X,v.length-=X),v.length))break t;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(G===0)break t;for(X=0;m=W[V+X++],v.head&&m&&v.length<65536&&(v.head.name+=String.fromCharCode(m)),m&&X<G;);if(512&v.flags&&(v.check=o(v.check,W,X,V)),G-=X,V+=X,m)break t}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(G===0)break t;for(X=0;m=W[V+X++],v.head&&m&&v.length<65536&&(v.head.comment+=String.fromCharCode(m)),m&&X<G;);if(512&v.flags&&(v.check=o(v.check,W,X,V)),G-=X,V+=X,m)break t}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(O!==(65535&v.check)){F.msg="header crc mismatch",v.mode=30;break}T=O=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),F.adler=v.check=0,v.mode=12;break;case 10:for(;T<32;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}F.adler=v.check=h(O),T=O=0,v.mode=11;case 11:if(v.havedict===0)return F.next_out=ot,F.avail_out=ft,F.next_in=V,F.avail_in=G,v.hold=O,v.bits=T,2;F.adler=v.check=1,v.mode=12;case 12:if(R===5||R===6)break t;case 13:if(v.last){O>>>=7&T,T-=7&T,v.mode=27;break}for(;T<3;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}switch(v.last=1&O,T-=1,3&(O>>>=1)){case 0:v.mode=14;break;case 1:if(j(v),v.mode=20,R!==6)break;O>>>=2,T-=2;break t;case 2:v.mode=17;break;case 3:F.msg="invalid block type",v.mode=30}O>>>=2,T-=2;break;case 14:for(O>>>=7&T,T-=7&T;T<32;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if((65535&O)!=(O>>>16^65535)){F.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&O,T=O=0,v.mode=15,R===6)break t;case 15:v.mode=16;case 16:if(X=v.length){if(G<X&&(X=G),ft<X&&(X=ft),X===0)break t;a.arraySet(at,W,V,X,ot),G-=X,V+=X,ft-=X,ot+=X,v.length-=X;break}v.mode=12;break;case 17:for(;T<14;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(v.nlen=257+(31&O),O>>>=5,T-=5,v.ndist=1+(31&O),O>>>=5,T-=5,v.ncode=4+(15&O),O>>>=4,T-=4,286<v.nlen||30<v.ndist){F.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;T<3;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}v.lens[Z[v.have++]]=7&O,O>>>=3,T-=3}for(;v.have<19;)v.lens[Z[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,I={bits:v.lenbits},H=c(0,v.lens,0,19,v.lencode,0,v.work,I),v.lenbits=I.bits,H){F.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;yt=(S=v.lencode[O&(1<<v.lenbits)-1])>>>16&255,Nt=65535&S,!((wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(Nt<16)O>>>=wt,T-=wt,v.lens[v.have++]=Nt;else{if(Nt===16){for(C=wt+2;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(O>>>=wt,T-=wt,v.have===0){F.msg="invalid bit length repeat",v.mode=30;break}m=v.lens[v.have-1],X=3+(3&O),O>>>=2,T-=2}else if(Nt===17){for(C=wt+3;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}T-=wt,m=0,X=3+(7&(O>>>=wt)),O>>>=3,T-=3}else{for(C=wt+7;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}T-=wt,m=0,X=11+(127&(O>>>=wt)),O>>>=7,T-=7}if(v.have+X>v.nlen+v.ndist){F.msg="invalid bit length repeat",v.mode=30;break}for(;X--;)v.lens[v.have++]=m}}if(v.mode===30)break;if(v.lens[256]===0){F.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,I={bits:v.lenbits},H=c(f,v.lens,0,v.nlen,v.lencode,0,v.work,I),v.lenbits=I.bits,H){F.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,I={bits:v.distbits},H=c(d,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,I),v.distbits=I.bits,H){F.msg="invalid distances set",v.mode=30;break}if(v.mode=20,R===6)break t;case 20:v.mode=21;case 21:if(6<=G&&258<=ft){F.next_out=ot,F.avail_out=ft,F.next_in=V,F.avail_in=G,v.hold=O,v.bits=T,l(F,L),ot=F.next_out,at=F.output,ft=F.avail_out,V=F.next_in,W=F.input,G=F.avail_in,O=v.hold,T=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;yt=(S=v.lencode[O&(1<<v.lenbits)-1])>>>16&255,Nt=65535&S,!((wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(yt&&!(240&yt)){for(xt=wt,Jt=yt,Lt=Nt;yt=(S=v.lencode[Lt+((O&(1<<xt+Jt)-1)>>xt)])>>>16&255,Nt=65535&S,!(xt+(wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}O>>>=xt,T-=xt,v.back+=xt}if(O>>>=wt,T-=wt,v.back+=wt,v.length=Nt,yt===0){v.mode=26;break}if(32&yt){v.back=-1,v.mode=12;break}if(64&yt){F.msg="invalid literal/length code",v.mode=30;break}v.extra=15&yt,v.mode=22;case 22:if(v.extra){for(C=v.extra;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}v.length+=O&(1<<v.extra)-1,O>>>=v.extra,T-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;yt=(S=v.distcode[O&(1<<v.distbits)-1])>>>16&255,Nt=65535&S,!((wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(!(240&yt)){for(xt=wt,Jt=yt,Lt=Nt;yt=(S=v.distcode[Lt+((O&(1<<xt+Jt)-1)>>xt)])>>>16&255,Nt=65535&S,!(xt+(wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}O>>>=xt,T-=xt,v.back+=xt}if(O>>>=wt,T-=wt,v.back+=wt,64&yt){F.msg="invalid distance code",v.mode=30;break}v.offset=Nt,v.extra=15&yt,v.mode=24;case 24:if(v.extra){for(C=v.extra;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}v.offset+=O&(1<<v.extra)-1,O>>>=v.extra,T-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){F.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(ft===0)break t;if(X=L-ft,v.offset>X){if((X=v.offset-X)>v.whave&&v.sane){F.msg="invalid distance too far back",v.mode=30;break}Ct=X>v.wnext?(X-=v.wnext,v.wsize-X):v.wnext-X,X>v.length&&(X=v.length),At=v.window}else At=at,Ct=ot-v.offset,X=v.length;for(ft<X&&(X=ft),ft-=X,v.length-=X;at[ot++]=At[Ct++],--X;);v.length===0&&(v.mode=21);break;case 26:if(ft===0)break t;at[ot++]=v.length,ft--,v.mode=21;break;case 27:if(v.wrap){for(;T<32;){if(G===0)break t;G--,O|=W[V++]<<T,T+=8}if(L-=ft,F.total_out+=L,v.total+=L,L&&(F.adler=v.check=v.flags?o(v.check,at,L,ot-L):s(v.check,at,L,ot-L)),L=ft,(v.flags?O:h(O))!==v.check){F.msg="incorrect data check",v.mode=30;break}T=O=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;T<32;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(O!==(4294967295&v.total)){F.msg="incorrect length check",v.mode=30;break}T=O=0}v.mode=29;case 29:H=1;break t;case 30:H=-3;break t;case 31:return-4;case 32:default:return u}return F.next_out=ot,F.avail_out=ft,F.next_in=V,F.avail_in=G,v.hold=O,v.bits=T,(v.wsize||L!==F.avail_out&&v.mode<30&&(v.mode<27||R!==4))&&q(F,F.output,F.next_out,L-F.avail_out)?(v.mode=31,-4):(lt-=F.avail_in,L-=F.avail_out,F.total_in+=lt,F.total_out+=L,v.total+=L,v.wrap&&L&&(F.adler=v.check=v.flags?o(v.check,at,L,F.next_out-L):s(v.check,at,L,F.next_out-L)),F.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(lt==0&&L===0||R===4)&&H===w&&(H=-5),H)},i.inflateEnd=function(F){if(!F||!F.state)return u;var R=F.state;return R.window&&(R.window=null),F.state=null,w},i.inflateGetHeader=function(F,R){var v;return F&&F.state&&2&(v=F.state).wrap?((v.head=R).done=!1,w):u},i.inflateSetDictionary=function(F,R){var v,W=R.length;return F&&F.state?(v=F.state).wrap!==0&&v.mode!==11?u:v.mode===11&&s(1,R,W,0)!==v.check?-3:q(F,R,W,W)?(v.mode=31,-4):(v.havedict=1,w):u},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,i){var a=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,d,w,u,g,p,b,h){var _,y,$,k,P,D,z,A,j,q=h.bits,F=0,R=0,v=0,W=0,at=0,V=0,ot=0,G=0,ft=0,O=0,T=null,lt=0,L=new a.Buf16(16),X=new a.Buf16(16),Ct=null,At=0;for(F=0;F<=15;F++)L[F]=0;for(R=0;R<u;R++)L[d[w+R]]++;for(at=q,W=15;1<=W&&L[W]===0;W--);if(W<at&&(at=W),W===0)return g[p++]=20971520,g[p++]=20971520,h.bits=1,0;for(v=1;v<W&&L[v]===0;v++);for(at<v&&(at=v),F=G=1;F<=15;F++)if(G<<=1,(G-=L[F])<0)return-1;if(0<G&&(f===0||W!==1))return-1;for(X[1]=0,F=1;F<15;F++)X[F+1]=X[F]+L[F];for(R=0;R<u;R++)d[w+R]!==0&&(b[X[d[w+R]]++]=R);if(D=f===0?(T=Ct=b,19):f===1?(T=s,lt-=257,Ct=o,At-=257,256):(T=l,Ct=c,-1),F=v,P=p,ot=R=O=0,$=-1,k=(ft=1<<(V=at))-1,f===1&&852<ft||f===2&&592<ft)return 1;for(;;){for(z=F-ot,j=b[R]<D?(A=0,b[R]):b[R]>D?(A=Ct[At+b[R]],T[lt+b[R]]):(A=96,0),_=1<<F-ot,v=y=1<<V;g[P+(O>>ot)+(y-=_)]=z<<24|A<<16|j|0,y!==0;);for(_=1<<F-1;O&_;)_>>=1;if(_!==0?(O&=_-1,O+=_):O=0,R++,--L[F]==0){if(F===W)break;F=d[w+b[R]]}if(at<F&&(O&k)!==$){for(ot===0&&(ot=at),P+=v,G=1<<(V=F-ot);V+ot<W&&!((G-=L[V+ot])<=0);)V++,G<<=1;if(ft+=1<<V,f===1&&852<ft||f===2&&592<ft)return 1;g[$=O&k]=at<<24|V<<16|P-p|0}}return O!==0&&(g[P+O]=F-ot<<24|64<<16|0),h.bits=at,0}},{"../utils/common":41}],51:[function(e,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,i){var a=e("../utils/common"),s=0,o=1;function l(S){for(var E=S.length;0<=--E;)S[E]=0}var c=0,f=29,d=256,w=d+1+f,u=30,g=19,p=2*w+1,b=15,h=16,_=7,y=256,$=16,k=17,P=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(w+2));l(q);var F=new Array(2*u);l(F);var R=new Array(512);l(R);var v=new Array(256);l(v);var W=new Array(f);l(W);var at,V,ot,G=new Array(u);function ft(S,E,Z,Y,N){this.static_tree=S,this.extra_bits=E,this.extra_base=Z,this.elems=Y,this.max_length=N,this.has_stree=S&&S.length}function O(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function T(S){return S<256?R[S]:R[256+(S>>>7)]}function lt(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function L(S,E,Z){S.bi_valid>h-Z?(S.bi_buf|=E<<S.bi_valid&65535,lt(S,S.bi_buf),S.bi_buf=E>>h-S.bi_valid,S.bi_valid+=Z-h):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=Z)}function X(S,E,Z){L(S,Z[2*E],Z[2*E+1])}function Ct(S,E){for(var Z=0;Z|=1&S,S>>>=1,Z<<=1,0<--E;);return Z>>>1}function At(S,E,Z){var Y,N,J=new Array(b+1),it=0;for(Y=1;Y<=b;Y++)J[Y]=it=it+Z[Y-1]<<1;for(N=0;N<=E;N++){var tt=S[2*N+1];tt!==0&&(S[2*N]=Ct(J[tt]++,tt))}}function wt(S){var E;for(E=0;E<w;E++)S.dyn_ltree[2*E]=0;for(E=0;E<u;E++)S.dyn_dtree[2*E]=0;for(E=0;E<g;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*y]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function yt(S){8<S.bi_valid?lt(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function Nt(S,E,Z,Y){var N=2*E,J=2*Z;return S[N]<S[J]||S[N]===S[J]&&Y[E]<=Y[Z]}function xt(S,E,Z){for(var Y=S.heap[Z],N=Z<<1;N<=S.heap_len&&(N<S.heap_len&&Nt(E,S.heap[N+1],S.heap[N],S.depth)&&N++,!Nt(E,Y,S.heap[N],S.depth));)S.heap[Z]=S.heap[N],Z=N,N<<=1;S.heap[Z]=Y}function Jt(S,E,Z){var Y,N,J,it,tt=0;if(S.last_lit!==0)for(;Y=S.pending_buf[S.d_buf+2*tt]<<8|S.pending_buf[S.d_buf+2*tt+1],N=S.pending_buf[S.l_buf+tt],tt++,Y===0?X(S,N,E):(X(S,(J=v[N])+d+1,E),(it=D[J])!==0&&L(S,N-=W[J],it),X(S,J=T(--Y),Z),(it=z[J])!==0&&L(S,Y-=G[J],it)),tt<S.last_lit;);X(S,y,E)}function Lt(S,E){var Z,Y,N,J=E.dyn_tree,it=E.stat_desc.static_tree,tt=E.stat_desc.has_stree,B=E.stat_desc.elems,nt=-1;for(S.heap_len=0,S.heap_max=p,Z=0;Z<B;Z++)J[2*Z]!==0?(S.heap[++S.heap_len]=nt=Z,S.depth[Z]=0):J[2*Z+1]=0;for(;S.heap_len<2;)J[2*(N=S.heap[++S.heap_len]=nt<2?++nt:0)]=1,S.depth[N]=0,S.opt_len--,tt&&(S.static_len-=it[2*N+1]);for(E.max_code=nt,Z=S.heap_len>>1;1<=Z;Z--)xt(S,J,Z);for(N=B;Z=S.heap[1],S.heap[1]=S.heap[S.heap_len--],xt(S,J,1),Y=S.heap[1],S.heap[--S.heap_max]=Z,S.heap[--S.heap_max]=Y,J[2*N]=J[2*Z]+J[2*Y],S.depth[N]=(S.depth[Z]>=S.depth[Y]?S.depth[Z]:S.depth[Y])+1,J[2*Z+1]=J[2*Y+1]=N,S.heap[1]=N++,xt(S,J,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(st,kt){var Bt,$t,Mt,St,vt,me,Qt=kt.dyn_tree,De=kt.max_code,vi=kt.stat_desc.static_tree,yi=kt.stat_desc.has_stree,ki=kt.stat_desc.extra_bits,Gn=kt.stat_desc.extra_base,Ve=kt.stat_desc.max_length,rn=0;for(St=0;St<=b;St++)st.bl_count[St]=0;for(Qt[2*st.heap[st.heap_max]+1]=0,Bt=st.heap_max+1;Bt<p;Bt++)Ve<(St=Qt[2*Qt[2*($t=st.heap[Bt])+1]+1]+1)&&(St=Ve,rn++),Qt[2*$t+1]=St,De<$t||(st.bl_count[St]++,vt=0,Gn<=$t&&(vt=ki[$t-Gn]),me=Qt[2*$t],st.opt_len+=me*(St+vt),yi&&(st.static_len+=me*(vi[2*$t+1]+vt)));if(rn!==0){do{for(St=Ve-1;st.bl_count[St]===0;)St--;st.bl_count[St]--,st.bl_count[St+1]+=2,st.bl_count[Ve]--,rn-=2}while(0<rn);for(St=Ve;St!==0;St--)for($t=st.bl_count[St];$t!==0;)De<(Mt=st.heap[--Bt])||(Qt[2*Mt+1]!==St&&(st.opt_len+=(St-Qt[2*Mt+1])*Qt[2*Mt],Qt[2*Mt+1]=St),$t--)}}(S,E),At(J,nt,S.bl_count)}function m(S,E,Z){var Y,N,J=-1,it=E[1],tt=0,B=7,nt=4;for(it===0&&(B=138,nt=3),E[2*(Z+1)+1]=65535,Y=0;Y<=Z;Y++)N=it,it=E[2*(Y+1)+1],++tt<B&&N===it||(tt<nt?S.bl_tree[2*N]+=tt:N!==0?(N!==J&&S.bl_tree[2*N]++,S.bl_tree[2*$]++):tt<=10?S.bl_tree[2*k]++:S.bl_tree[2*P]++,J=N,nt=(tt=0)===it?(B=138,3):N===it?(B=6,3):(B=7,4))}function H(S,E,Z){var Y,N,J=-1,it=E[1],tt=0,B=7,nt=4;for(it===0&&(B=138,nt=3),Y=0;Y<=Z;Y++)if(N=it,it=E[2*(Y+1)+1],!(++tt<B&&N===it)){if(tt<nt)for(;X(S,N,S.bl_tree),--tt!=0;);else N!==0?(N!==J&&(X(S,N,S.bl_tree),tt--),X(S,$,S.bl_tree),L(S,tt-3,2)):tt<=10?(X(S,k,S.bl_tree),L(S,tt-3,3)):(X(S,P,S.bl_tree),L(S,tt-11,7));J=N,nt=(tt=0)===it?(B=138,3):N===it?(B=6,3):(B=7,4)}}l(G);var I=!1;function C(S,E,Z,Y){L(S,(c<<1)+(Y?1:0),3),function(N,J,it,tt){yt(N),lt(N,it),lt(N,~it),a.arraySet(N.pending_buf,N.window,J,it,N.pending),N.pending+=it}(S,E,Z)}i._tr_init=function(S){I||(function(){var E,Z,Y,N,J,it=new Array(b+1);for(N=Y=0;N<f-1;N++)for(W[N]=Y,E=0;E<1<<D[N];E++)v[Y++]=N;for(v[Y-1]=N,N=J=0;N<16;N++)for(G[N]=J,E=0;E<1<<z[N];E++)R[J++]=N;for(J>>=7;N<u;N++)for(G[N]=J<<7,E=0;E<1<<z[N]-7;E++)R[256+J++]=N;for(Z=0;Z<=b;Z++)it[Z]=0;for(E=0;E<=143;)q[2*E+1]=8,E++,it[8]++;for(;E<=255;)q[2*E+1]=9,E++,it[9]++;for(;E<=279;)q[2*E+1]=7,E++,it[7]++;for(;E<=287;)q[2*E+1]=8,E++,it[8]++;for(At(q,w+1,it),E=0;E<u;E++)F[2*E+1]=5,F[2*E]=Ct(E,5);at=new ft(q,D,d+1,w,b),V=new ft(F,z,0,u,b),ot=new ft(new Array(0),A,0,g,_)}(),I=!0),S.l_desc=new O(S.dyn_ltree,at),S.d_desc=new O(S.dyn_dtree,V),S.bl_desc=new O(S.bl_tree,ot),S.bi_buf=0,S.bi_valid=0,wt(S)},i._tr_stored_block=C,i._tr_flush_block=function(S,E,Z,Y){var N,J,it=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(tt){var B,nt=4093624447;for(B=0;B<=31;B++,nt>>>=1)if(1&nt&&tt.dyn_ltree[2*B]!==0)return s;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return o;for(B=32;B<d;B++)if(tt.dyn_ltree[2*B]!==0)return o;return s}(S)),Lt(S,S.l_desc),Lt(S,S.d_desc),it=function(tt){var B;for(m(tt,tt.dyn_ltree,tt.l_desc.max_code),m(tt,tt.dyn_dtree,tt.d_desc.max_code),Lt(tt,tt.bl_desc),B=g-1;3<=B&&tt.bl_tree[2*j[B]+1]===0;B--);return tt.opt_len+=3*(B+1)+5+5+4,B}(S),N=S.opt_len+3+7>>>3,(J=S.static_len+3+7>>>3)<=N&&(N=J)):N=J=Z+5,Z+4<=N&&E!==-1?C(S,E,Z,Y):S.strategy===4||J===N?(L(S,2+(Y?1:0),3),Jt(S,q,F)):(L(S,4+(Y?1:0),3),function(tt,B,nt,st){var kt;for(L(tt,B-257,5),L(tt,nt-1,5),L(tt,st-4,4),kt=0;kt<st;kt++)L(tt,tt.bl_tree[2*j[kt]+1],3);H(tt,tt.dyn_ltree,B-1),H(tt,tt.dyn_dtree,nt-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,it+1),Jt(S,S.dyn_ltree,S.dyn_dtree)),wt(S),Y&&yt(S)},i._tr_tally=function(S,E,Z){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&Z,S.last_lit++,E===0?S.dyn_ltree[2*Z]++:(S.matches++,E--,S.dyn_ltree[2*(v[Z]+d+1)]++,S.dyn_dtree[2*T(E)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){L(S,2,3),X(S,y,q),function(E){E.bi_valid===16?(lt(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(e,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,i){(function(a){(function(s,o){if(!s.setImmediate){var l,c,f,d,w=1,u={},g=!1,p=s.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(s);b=b&&b.setTimeout?b:s,l={}.toString.call(s.process)==="[object process]"?function($){process.nextTick(function(){_($)})}:function(){if(s.postMessage&&!s.importScripts){var $=!0,k=s.onmessage;return s.onmessage=function(){$=!1},s.postMessage("","*"),s.onmessage=k,$}}()?(d="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",y,!1):s.attachEvent("onmessage",y),function($){s.postMessage(d+$,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function($){_($.data)},function($){f.port2.postMessage($)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function($){var k=p.createElement("script");k.onreadystatechange=function(){_($),k.onreadystatechange=null,c.removeChild(k),k=null},c.appendChild(k)}):function($){setTimeout(_,0,$)},b.setImmediate=function($){typeof $!="function"&&($=new Function(""+$));for(var k=new Array(arguments.length-1),P=0;P<k.length;P++)k[P]=arguments[P+1];var D={callback:$,args:k};return u[w]=D,l(w),w++},b.clearImmediate=h}function h($){delete u[$]}function _($){if(g)setTimeout(_,0,$);else{var k=u[$];if(k){g=!0;try{(function(P){var D=P.callback,z=P.args;switch(z.length){case 0:D();break;case 1:D(z[0]);break;case 2:D(z[0],z[1]);break;case 3:D(z[0],z[1],z[2]);break;default:D.apply(o,z)}})(k)}finally{h($),g=!1}}}}function y($){$.source===s&&typeof $.data=="string"&&$.data.indexOf(d)===0&&_(+$.data.slice(d.length))}})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Rr);var Vi=Rr.exports;const Yn=Hi(Vi);class Zi{constructor(t,e){this.app=t,this.settings=e}get maxBackups(){var t;return((t=this.settings)==null?void 0:t.maxBackups)??5}get maxBackupAgeDays(){var t;return((t=this.settings)==null?void 0:t.maxBackupAgeDays)??30}async createBackup(t,e){try{const n=this.app.vault.getAbstractFileByPath(t);if(!n||!(n instanceof x.TFolder))return U(`${M} Draft folder not found: ${t}`),!1;const i=this.getAllFilesInFolder(n);if(i.length===0)return U(`${M} No files to backup in: ${t}`),!1;const a=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=t.split("/").pop()||"unknown",l=`${je(e)}/${a}/${s}/${o}`;await this.app.vault.adapter.exists(l)||await this.app.vault.createFolder(l);const f=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),d=`${o}_${f}${Ye}`,w=`${l}/${d}`,u=new Yn;for(const b of i){const h=b.path.substring(t.length+1),_=await this.app.vault.read(b);u.file(h,_)}const g=await u.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}),p=new Uint8Array(g).buffer;return await this.app.vault.createBinary(w,p),U(`${M} Created backup: ${w}`),!0}catch(n){return U(`${M} Failed to create backup:`,n),!1}}async listBackups(t,e){try{const n=t.split("/")[0]||"unknown",i=t.split("/")[1]||"drafts",a=t.split("/").pop()||"unknown",s=`${je(e)}/${n}/${i}/${a}`,o=this.app.vault.getAbstractFileByPath(s);if(!o||!(o instanceof x.TFolder))return[];const l=t.split("/").pop()||"unknown",c=[];for(const f of o.children)if(f instanceof x.TFile&&f.name.startsWith(`${l}_`)&&f.name.endsWith(Ye)){const d=f.name.match(Tr);d&&c.push(d[1])}return c.sort().reverse()}catch(n){return U(`${M} Failed to list backups:`,n),[]}}async restoreBackup(t,e,n){try{const i=t.split("/")[0]||"unknown",a=t.split("/")[1]||"drafts",s=t.split("/").pop()||"unknown",o=`${je(n)}/${i}/${a}/${s}`,l=`${s}_${e}${Ye}`,c=`${o}/${l}`;if(!await this.app.vault.adapter.stat(c))return U(`${M} Backup file not found: ${c}`),!1;const d=await this.app.vault.adapter.readBinary(c),w=await Yn.loadAsync(d);this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);for(const[g,p]of Object.entries(w.files))if(p.dir){const b=`${t}/${g}`;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b)}else{const b=await p.async("text"),h=`${t}/${g}`,_=h.substring(0,h.lastIndexOf("/"));this.app.vault.getAbstractFileByPath(_)||await this.app.vault.createFolder(_);const y=this.app.vault.getAbstractFileByPath(h);y&&y instanceof x.TFile?await this.app.vault.modify(y,b):await this.app.vault.create(h,b)}return U(`${M} Restored backup: ${c}`),!0}catch(i){return U(`${M} Failed to restore backup:`,i),!1}}async deleteBackup(t,e,n){try{const i=t.split("/")[0]||"unknown",a=t.split("/")[1]||"drafts",s=t.split("/").pop()||"unknown",o=`${je(n)}/${i}/${a}/${s}`,l=`${s}_${e}${Ye}`,c=`${o}/${l}`;return await this.app.vault.adapter.stat(c)?(await this.app.vault.adapter.remove(c),U(`${M} Deleted backup: ${c}`),!0):(U(`${M} Backup file not found for deletion: ${c}`),!1)}catch(i){return U(`${M} Failed to delete backup:`,i),!1}}async clearOldBackups(t,e){try{const n=await this.listBackups(t,e),i=new Date;i.setDate(i.getDate()-this.maxBackupAgeDays);for(const a of n)new Date(a.replace(/-/g,":"))<i&&await this.deleteBackup(t,a,e)}catch(n){U(`${M} Failed to clear old backups:`,n)}}getAllFilesInFolder(t){const e=[];function n(i){for(const a of i.children)a instanceof x.TFile?e.push(a):a instanceof x.TFolder&&n(a)}return n(t),e}}class Gi{constructor(t){var e,n,i;this.app=t,this.manager=((i=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:i.manager)??null}async reorderChapters(t,e,n){const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=`${i}/${a}/${e}`;for(let o=0;o<n.length;o++){const{chapterName:l}=n[o],c=`${s}/${l}${bt}`,f=this.app.vault.getAbstractFileByPath(c);if(f&&f instanceof x.TFile){let d=await this.app.vault.read(f);d.match(te)&&(d=d.replace(te,(w,u)=>{let g=u.replace(/^order:.*\n?/gm,"");return g.endsWith(`
`)||(g+=`
`),g+=`order: ${o+1}
`,`${Pt}
${g}${Pt}`}),await this.app.vault.modify(f,d))}}return!0}async listChapters(t,e){U(`${M} ChapterFileService.listChapters: projectPath=${t}, draftName=${e}`);const n=this.resolveProjectPath(t);if(!n)return U(`${M} ChapterFileService.listChapters: no project resolved`),[];const i=this.getDraftsFolderName(n);if(!i)return U(`${M} ChapterFileService.listChapters: no drafts folder found in project ${n}`),[];const a=`${n}/${i}/${e}`;U(`${M} ChapterFileService.listChapters: resolved project=${n}, draftsFolder=${i}, draftFolder=${a}`);const s=this.app.vault.getAbstractFileByPath(a),o=[];if(s&&s instanceof x.TFolder){U(`${M} ChapterFileService.listChapters: found folder with ${s.children.length} children`);for(const l of s.children)l instanceof x.TFile&&l.extension===bt.slice(1)&&(U(`${M} ChapterFileService.listChapters: processing file ${l.path}`),await Tt(async()=>{const c=await this.app.vault.read(l);U(`${M} ChapterFileService.listChapters: content length ${c.length}`);const f=c.match(te);let d,w;if(f){U(`${M} ChapterFileService.listChapters: found frontmatter`);const p=f[1].split(/\r?\n/);for(const b of p){const h=b.match(/^order:\s*(\d+)/i);h&&(d=parseInt(h[1],10));const _=b.match(/^chapter_name:\s*(.*)$/i);if(_){let y=_[1].trim();(y.startsWith('"')&&y.endsWith('"')||y.startsWith("'")&&y.endsWith("'"))&&(y=y.slice(1,-1)),y.length>0&&(w=y)}}}else U(`${M} ChapterFileService.listChapters: no frontmatter`);U(`${M} ChapterFileService.listChapters: parsed order=${d}, chapterName=${w}`);const u=w&&w.length>0?w:l.name.replace(new RegExp(`\\${bt}$`),""),g=typeof d=="number"&&!isNaN(d)?d:0;U(`${M} ChapterFileService.listChapters: adding chapter ${l.name} with name ${u}, order ${g}`),o.push({name:l.name.replace(new RegExp(`\\${bt}$`),""),chapterName:u,order:g})}))}else U(`${M} ChapterFileService.listChapters: no folder found`);return o.sort((l,c)=>l.order-c.order),U(`${M} ChapterFileService.listChapters: returning ${o.length} chapters`),o.map(({name:l,chapterName:c})=>({name:l,chapterName:c}))}async createChapter(t,e,n,i){const a=this.resolveProjectPath(t);if(!a)return!1;const s=this.getDraftsFolderName(a);if(!s)return!1;const o=`${a}/${s}/${e}`,c=`${ee(n,i==null?void 0:i.slugStyle)}${bt}`,f=`${o}/${c}`;if(this.app.vault.getAbstractFileByPath(f))return!1;let d=0;const w=this.app.vault.getAbstractFileByPath(o);if(w&&w instanceof x.TFolder)for(const b of w.children)b instanceof x.TFile&&b.extension===bt.slice(1)&&await Tt(async()=>{const _=(await this.app.vault.read(b)).match(te);if(_){const y=_[1].split(/\r?\n/);for(const $ of y){const k=$.match(/^order:\s*(\d+)/i);if(k){const P=parseInt(k[1],10);!isNaN(P)&&P>d&&(d=P)}}}});const u=d+1;let g=`# ${n}`;const p=`${Pt}
order: ${u}
chapter_name: ${JSON.stringify(n)}
${Pt}
`;return await this.app.vault.create(f,`${p}
${g}

`),!0}async deleteChapter(t,e,n){const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=`${i}/${a}/${e}`,o=`${n}${bt}`,l=`${s}/${o}`,c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof x.TFile){await this.app.vault.delete(c);const f=await this.listChapters(t,e);for(let d=0;d<f.length;d++){const{name:w}=f[d],u=`${s}/${w}${bt}`,g=this.app.vault.getAbstractFileByPath(u);if(g&&g instanceof x.TFile){let p=await this.app.vault.read(g);p.match(te)&&(p=p.replace(te,(b,h)=>{let _=h.replace(/^order:.*\n?/gm,"");return _.endsWith(`
`)||(_+=`
`),_+=`order: ${d+1}
`,`${Pt}
${_}${Pt}`}),await this.app.vault.modify(g,p))}}return!0}return!1}async renameChapter(t,e,n,i){const a=this.resolveProjectPath(t);if(!a)return!1;const s=this.getDraftsFolderName(a);if(!s)return!1;const o=`${a}/${s}/${e}`,l=`${o}/${n}${bt}`,c=`${o}/${i}${bt}`,f=this.app.vault.getAbstractFileByPath(l);if(!f||!(f instanceof x.TFile))return!1;let d=await this.app.vault.read(f),w=`# ${i}`;return d.match(te)&&(d=d.replace(te,(u,g)=>{let p=g.replace(/^chapter_name:.*\n?/gm,"");return p.endsWith(`
`)||(p+=`
`),p+=`chapter_name: ${JSON.stringify(i)}
`,`${Pt}
${p}${Pt}`})),d=d.replace(/^#.*$/m,w),n!==i?(await this.app.vault.create(c,d),await this.app.vault.delete(f)):await this.app.vault.modify(f,d),!0}async openChapter(t,e,n){const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=`${i}/${a}/${e}/${n}${bt}`,o=this.app.vault.getAbstractFileByPath(s);return o&&o instanceof x.TFile?(await Tt(async()=>{await this.app.workspace.getLeaf().openFile(o)}),!0):!1}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var i;const e=this.app.vault.getAbstractFileByPath(t),n=jt((i=this.manager)==null?void 0:i.settings);if(e&&e instanceof x.TFolder){for(const a of e.children)if(a instanceof x.TFolder&&a.name.toLowerCase()===n.toLowerCase())return a.name}return null}}class zr{constructor(t){this.app=t,U(`${M} TemplateService created`)}async render(t,e={}){let n=t||"";return U(`${M} TemplateService.render called with template: "${n.substring(0,100)}${n.length>100?"...":""}", vars:`,Object.keys(e)),!n.includes("{{")&&!n.includes("}}")?(U(`${M} Template doesn't contain template syntax, checking if it's a file path`),await Tt(async()=>{const i=this.app.vault.getAbstractFileByPath(n);i&&i instanceof x.TFile?(U(`${M} Reading template from file: ${n}`),n=await this.app.vault.read(i),U(`${M} Template loaded from file, length: ${n.length} chars`)):U(`${M} Template path "${n}" is not a valid file, treating as inline template`)})):U(`${M} Template contains template syntax, treating as inline template`),U(`${M} Performing template variable substitution`),n=n.replace(/{{\s*(\w+(?:[-:]\w+)*)\s*}}/g,(i,a)=>{if(e[a]!==void 0)return U(`${M} Substituting variable {{${a}}} with provided value: "${e[a]}"`),e[a];try{const s=window.moment().format(a);return U(`${M} Substituting {{${a}}} with moment.js format: "${s}"`),s}catch{return U(`${M} Neither variable nor moment.js format found for {{${a}}}, returning as-is`),a}}),U(`${M} Template rendering complete, result length: ${n.length} chars`),n}}class fn{constructor(t){var e,n,i;this.app=t,this.manager=((i=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:i.manager)??null,this.tpl=new zr(t),this.projectFileService=new Ln(t,this)}async createProject(t,e,n,i,a){if(!t)return new x.Notice("Project name is required."),null;const s=i&&i!==""?`${i}/${t}`:t,o=`${s}/${jt(a)}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);const l=`${s}/${ae(a)}`;if(!this.app.vault.getAbstractFileByPath(l)){const f=e?Ht.SINGLE:Ht.MULTI,d=e?(a==null?void 0:a.defaultSingleTargetWordCount)??2e4:(a==null?void 0:a.defaultMultiTargetWordCount)??5e4,w=`${Pt}
project_type: ${f}
target_word_count: ${d}
${Pt}
`;await this.app.vault.create(l,w)}const c=n||"Draft 1";return await this.projectFileService.drafts.createDraft(c,void 0,s,a),s}async openProject(t){var s,o;const e=`${t}/${ae((s=this.manager)==null?void 0:s.settings)}`,n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof x.TFile)return await this.app.workspace.getLeaf().openFile(n),!0;const i=Te((o=this.manager)==null?void 0:o.settings),a=[`${t}/${t}${bt}`,`${t}/Chapter 1${bt}`,`${t}/Chapter 01${bt}`,`${t}/${i}`,`${t}/${jt()}/Draft 1/${i}`];for(const l of a){const c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof x.TFile)return await this.app.workspace.getLeaf().openFile(c),!0}return new x.Notice("Could not find a file to open in the project."),!1}listAllFolders(){const t=this.app.vault.getRoot(),e=[""];function n(i){for(const a of i.children)a instanceof x.TFolder&&(e.push(a.path),n(a))}return n(t),e}async listProjects(){const t=this.listAllFolders(),e=t.filter(i=>!!i);U(`${M} allFolders:`,t),U(`${M} filteredFolders:`,e);const n=await Be(e,i=>this.isProjectFolder(i));return U(`${M} found ${e.length} folders, ${n.length} projects:`,n),n}async getProjectType(t){const e=`${t}/${ae()}`,n=await Pe(this.app,e);if(n&&n.project_type){const i=n.project_type;if(Object.values(Ht).includes(i))return i}return null}getDraftsFolder(t){const e=`${t}/${jt()}`;let n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof x.TFolder)return n;const i=`${t}/Drafts`;return n=this.app.vault.getAbstractFileByPath(i),n&&n instanceof x.TFolder?n:null}async getManuscriptsFolder(t){const e=`${t}/${zn()}`,n=this.app.vault.getAbstractFileByPath(e);return n&&n instanceof x.TFolder?n:null}async isProjectFolder(t){if(!t||typeof t!="string")return!1;const e=t.trim().replace(/\\/g,"/").replace(/\/+$/,"");try{const n=x.normalizePath(`${e}/${ae()}`),i=await this.app.vault.adapter.exists(n),a=x.normalizePath(`${e}/${jt()}`);let s=await this.app.vault.adapter.exists(a);if(!s){const o=x.normalizePath(`${e}/Drafts`);s=await this.app.vault.adapter.exists(o)}if(!i&&!s)return!1;if(i)try{const{readMetaFile:o}=await Promise.resolve().then(()=>An),{VALID_PROJECT_TYPES:l}=await Promise.resolve().then(()=>Fi),c=await o(this.app,n);if(!c||!l.includes(c.project_type))return!1}catch{return!1}return!0}catch{return!1}}}class Yi{constructor(t,e,n,i){var a,s,o;this.app=t,this.tpl=new zr(t),this.projectSvc=n,this.backupSvc=i,this.chapters=e,this.manager=((o=(s=(a=this.app.plugins).getPlugin)==null?void 0:s.call(a,"obsidian-writeaid-plugin"))==null?void 0:o.manager)??null}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var i;const e=this.app.vault.getAbstractFileByPath(t),n=jt((i=this.manager)==null?void 0:i.settings);if(e&&e instanceof x.TFolder){for(const a of e.children)if(a instanceof x.TFolder&&a.name.toLowerCase()===n.toLowerCase())return a.name}return null}async suggestNextDraftName(t){var a;const e=this.resolveProjectPath(t);if(!e)return"Draft 1";const n=`${e}/${ae((a=this.manager)==null?void 0:a.settings)}`;let i=0;return await Tt(async()=>{const s=await Pe(this.app,n);s&&typeof s.total_drafts=="number"&&(i=s.total_drafts)}),`Draft ${i+1}`}async createDraft(t,e,n,i){var d,w,u;const a=this.resolveProjectPath(n);if(!a){new x.Notice("No project folder detected. Please open a folder named after your project.");return}const o=this.getDraftsFolderName(a)||jt((d=this.manager)==null?void 0:d.settings),l=`${a}/${o}`,c=`${l}/${t}`,f=a.split("/").pop()||a;if(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),e){const g=`${l}/${e}`,p=this.app.vault.getFiles().filter(_=>_.path.startsWith(g)),h=`${ee(e,i==null?void 0:i.slugStyle)}${bt}`;for(const _ of p){let y=_.path.substring(g.length+1);y===h&&(y=`${ee(t,i==null?void 0:i.slugStyle)}${bt}`);const $=`${c}/${y}`,k=$.substring(0,$.lastIndexOf("/"));k!==c&&!this.app.vault.getAbstractFileByPath(k)&&await this.app.vault.createFolder(k);let P=await this.app.vault.read(_);P=Xi(P,t,f),await this.app.vault.create($,P)}}else{if((i==null?void 0:i.includeDraftOutline)===!0){const b=(i==null?void 0:i.outlineTemplate)??"",h=await this.tpl.render(b,{draftName:t});await this.app.vault.create(`${c}/${Te((w=this.manager)==null?void 0:w.settings)}`,h)}if(await this.projectSvc.getProjectType(a)===Ht.SINGLE){const h=`${ee(t,i==null?void 0:i.slugStyle)}${bt}`,_=`${c}/${h}`;if(!this.app.vault.getAbstractFileByPath(_)){const y=`${Pt}
draft: ${t}
project: ${f}
created: ${new Date().toISOString()}
${Pt}

`,$=await this.tpl.render("# {{draftName}}",{draftName:t});await this.app.vault.create(_,y+$)}}else{const b=this.app.vault.getAbstractFileByPath(c);let h=!1;if(b&&b instanceof x.TFolder){for(const _ of b.children)if(_ instanceof x.TFile&&_.extension===bt.slice(1)&&(await Tt(async()=>{const $=(await this.app.vault.read(_)).match(te);if($){const k=$[1].split(/\r?\n/);for(const P of k){const D=P.match(/^order:\s*(\d+)/i);if(D&&!isNaN(parseInt(D[1],10))){h=!0;break}}}}),h))break}h||await this.chapters.createChapter(a,t,"Chapter 1",i)}}await Oe(this.app,a,t,void 0,(u=this.manager)==null?void 0:u.settings)}listDrafts(t){var i;const e=this.resolveProjectPath(t);if(U(`${M} listDrafts called with projectPath:`,t,"resolved to:",e),!e)return[];const n=this.projectSvc.getDraftsFolder(e);if(U(`${M} getDraftsFolder for ${e} returned:`,n==null?void 0:n.path,(i=n==null?void 0:n.children)==null?void 0:i.length),n&&n instanceof x.TFolder){const a=n.children.filter(s=>s instanceof x.TFolder).map(s=>s.name);return U(`${M} found drafts:`,a),a}return[]}async openDraft(t,e){var f;const n=this.resolveProjectPath(t);if(!n)return!1;const i=this.getDraftsFolderName(n);if(!i)return!1;const a=`${n}/${i}/${e}/${Te((f=this.manager)==null?void 0:f.settings)}`,s=this.app.vault.getAbstractFileByPath(a);if(await Tt(async()=>s&&s instanceof x.TFile?(await this.app.workspace.getLeaf().openFile(s),!0):!1))return!0;const l=`${n}/${i}/${e}`,c=this.app.vault.getFiles().filter(d=>d.path.startsWith(l));return c.length>0?(await this.app.workspace.getLeaf().openFile(c[0]),!0):!1}async renameDraft(t,e,n,i=!1,a){var f;const s=this.resolveProjectPath(t);if(!s)return!1;const o=this.getDraftsFolderName(s);if(!o)return!1;const l=`${s}/${o}/${e}`,c=`${s}/${o}/${n}`;try{this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c);const d=this.app.vault.getFiles().filter(h=>h.path.startsWith(l));let w="",u="";if(i){const h=a==null?void 0:a.slugStyle;w=ee(e,h),u=ee(n,h)}for(const h of d){let _=h.path.substring(l.length+1),y=`${c}/${_}`;i&&w&&u&&_===`${w}${bt}`&&(_=`${u}${bt}`,y=`${c}/${_}`);let $=await this.app.vault.read(h);h.extension===bt.slice(1)&&($=$.replace(new RegExp(`^(${Pt}\\s*\\n[\\s\\S]*?\\n)(draft:.*\\n)?`,"m"),(k,P)=>P.replace(/^draft:.*\n/m,"").replace(new RegExp(`^(${Pt}\\s*\\n)`),`$1draft: ${n}
`))),await this.app.vault.create(y,$),await this.app.vault.delete(h)}const g=this.app.vault.getAbstractFileByPath(l);g&&g instanceof x.TFolder&&await this.app.vault.delete(g,!0),await Tt(async()=>{await Promise.resolve().then(()=>An).then(h=>{var _;return h.updateMetaStats(this.app,s,n,void 0,(_=this.manager)==null?void 0:_.settings)})});const p=`${c}/${ae((f=this.manager)==null?void 0:f.settings)}`;return this.app.vault.getAbstractFileByPath(p)&&await Tt(async()=>{const{readMetaFile:h,writeMetaFile:_}=await Promise.resolve().then(()=>An),y=await h(this.app,p);y&&(y.draft=n,await _(this.app,p,y))}),!0}catch{return!1}}async deleteDraft(t,e,n=!0){var o;const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=`${i}/${a}/${e}`;try{const l=this.app.vault.getFiles().filter(f=>f.path.startsWith(s));n&&await this.backupSvc.createBackup(s,(o=this.manager)==null?void 0:o.settings);for(const f of l)await Tt(async()=>{await this.app.vault.delete(f)});const c=this.app.vault.getAbstractFileByPath(s);return c&&c instanceof x.TFolder&&await Tt(async()=>{await this.app.vault.delete(c)}),!0}catch{return!1}}async generateManuscript(t,e,n){var p;const i=this.resolveProjectPath(t);if(!i)return!1;const a=this.getDraftsFolderName(i);if(!a)return!1;const s=await this.projectSvc.getProjectType(i),o=`${i}/${a}/${e}`;if(!this.app.vault.getAbstractFileByPath(o))return new x.Notice(`Draft folder ${o} does not exist.`),!1;const l=`${i}/${zn((p=this.manager)==null?void 0:p.settings)}`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);const c=i.split("/").pop()||i,f=(n==null?void 0:n.manuscriptNameTemplate)||"{{draftName}}";U(`${M} DraftFileService.generateManuscript - manuscriptNameTemplate: "${f}"`),U(`${M} DraftFileService.generateManuscript - settings object:`,n);const d=ee(e,n==null?void 0:n.slugStyle),w=await this.tpl.render(f,{draftName:e,projectName:c,draftSlug:d}),u=`${l}/${w}${bt}`;let g=`# Manuscript for ${e}

`;if(s===Ht.SINGLE){const b=`${d}${bt}`,h=`${o}/${b}`,_=this.app.vault.getAbstractFileByPath(h);if(_&&_ instanceof x.TFile){const y=await this.app.vault.read(_);g+=qi(Ki(y));const $=this.app.vault.getAbstractFileByPath(u);if($&&$ instanceof x.TFile){if(!await new Br(this.app,u).open())return!1;U(`${M} Overwriting existing manuscript: ${u}`),await this.app.vault.modify($,g)}else U(`${M} Creating new manuscript: ${u}`),await this.app.vault.create(u,g)}else return new x.Notice(`Main draft file ${h} not found.`),!1}return!0}getOutlineFile(t,e){var o;const n=this.resolveProjectPath(t);if(!n)return null;const i=this.getDraftsFolderName(n);if(!i)return null;const a=`${n}/${i}/${e}/${Te((o=this.manager)==null?void 0:o.settings)}`,s=this.app.vault.getAbstractFileByPath(a);return s&&s instanceof x.TFile?s:null}async createOutline(t,e,n){var f;const i=this.resolveProjectPath(t);if(!i)throw new Error("Project not found");const a=this.getDraftsFolderName(i);if(!a)throw new Error("Drafts folder not found");const o=`${`${i}/${a}/${e}`}/${Te((f=this.manager)==null?void 0:f.settings)}`;if(this.app.vault.getAbstractFileByPath(o))throw new Error("Outline file already exists");const c=await this.tpl.render(n,{draftName:e});await this.app.vault.create(o,c)}}function Ki(r){return r.replace(te,"").trim()}function qi(r){return r.replace(/^#{1,6} .*\n/,"").trim()}function Xi(r,t,e){const n=r.match(te);if(!n)return r;const i=n[1],a=r.substring(n[0].length),s=i.split(`
`),o=[];for(const c of s)c.match(/^draft:/i)?o.push(`draft: ${t}`):c.match(/^project:/i)?o.push(`project: ${e}`):c.match(/^created:/i)?o.push(`created: ${new Date().toISOString()}`):o.push(c);const l=o.join(`
`);return`${Pt}
${l}
${Pt}${a}`}class Ln{constructor(t,e,n){this.chapters=new Gi(t),this.backups=new Zi(t,n),this.drafts=new Yi(t,this.chapters,e,this.backups)}}function Et(){}const Ji=r=>r;function _t(r,t){for(const e in t)r[e]=t[e];return r}function Ir(r){return r()}function Kn(){return Object.create(null)}function $e(r){r.forEach(Ir)}function Qe(r){return typeof r=="function"}function Ot(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function Qi(r){return Object.keys(r).length===0}function Yt(r,t,e,n){if(r){const i=Lr(r,t,e,n);return r[0](i)}}function Lr(r,t,e,n){return r[1]&&n?_t(e.ctx.slice(),r[1](n(t))):e.ctx}function Kt(r,t,e,n){return r[2],t.dirty}function qt(r,t,e,n,i,a){if(i){const s=Lr(t,e,n,a);r.p(s,i)}}function Xt(r){if(r.ctx.length>32){const t=[],e=r.ctx.length/32;for(let n=0;n<e;n++)t[n]=-1;return t}return-1}function Dt(r){const t={};for(const e in r)e[0]!=="$"&&(t[e]=r[e]);return t}function qn(r,t){const e={};t=new Set(t);for(const n in r)!t.has(n)&&n[0]!=="$"&&(e[n]=r[n]);return e}function sn(r){return r??""}const Mr=typeof window<"u";let ta=Mr?()=>window.performance.now():()=>Date.now(),Mn=Mr?r=>requestAnimationFrame(r):Et;const Re=new Set;function Ur(r){Re.forEach(t=>{t.c(r)||(Re.delete(t),t.f())}),Re.size!==0&&Mn(Ur)}function ea(r){let t;return Re.size===0&&Mn(Ur),{promise:new Promise(e=>{Re.add(t={c:r,f:e})}),abort(){Re.delete(t)}}}function rt(r,t){r.appendChild(t)}function Wr(r){if(!r)return document;const t=r.getRootNode?r.getRootNode():r.ownerDocument;return t&&t.host?t:r.ownerDocument}function na(r){const t=ct("style");return t.textContent="/* empty */",ra(Wr(r),t),t.sheet}function ra(r,t){return rt(r.head||r,t),t.sheet}function gt(r,t,e){r.insertBefore(t,e||null)}function pt(r){r.parentNode&&r.parentNode.removeChild(r)}function Hr(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function ct(r){return document.createElement(r)}function Vr(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Rt(r){return document.createTextNode(r)}function mt(){return Rt(" ")}function _n(){return Rt("")}function fe(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function et(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function un(r,t){for(const e in t)et(r,e,t[e])}function ia(r){return Array.from(r.childNodes)}function We(r,t){t=""+t,r.data!==t&&(r.data=t)}function dn(r,t){r.value=t??""}function be(r,t,e,n){e==null?r.style.removeProperty(t):r.style.setProperty(t,e,"")}function ne(r,t,e){r.classList.toggle(t,!!e)}function aa(r,t,{bubbles:e=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:t,bubbles:e,cancelable:n})}const hn=new Map;let pn=0;function sa(r){let t=5381,e=r.length;for(;e--;)t=(t<<5)-t^r.charCodeAt(e);return t>>>0}function oa(r,t){const e={stylesheet:na(t),rules:{}};return hn.set(r,e),e}function la(r,t,e,n,i,a,s,o=0){const l=16.666/n;let c=`{
`;for(let b=0;b<=1;b+=l){const h=t+(e-t)*a(b);c+=b*100+`%{${s(h,1-h)}}
`}const f=c+`100% {${s(e,1-e)}}
}`,d=`__svelte_${sa(f)}_${o}`,w=Wr(r),{stylesheet:u,rules:g}=hn.get(w)||oa(w,r);g[d]||(g[d]=!0,u.insertRule(`@keyframes ${d} ${f}`,u.cssRules.length));const p=r.style.animation||"";return r.style.animation=`${p?`${p}, `:""}${d} ${n}ms linear ${i}ms 1 both`,pn+=1,d}function ca(r,t){const e=(r.style.animation||"").split(", "),n=e.filter(t?a=>a.indexOf(t)<0:a=>a.indexOf("__svelte")===-1),i=e.length-n.length;i&&(r.style.animation=n.join(", "),pn-=i,pn||fa())}function fa(){Mn(()=>{pn||(hn.forEach(r=>{const{ownerNode:t}=r.stylesheet;t&&pt(t)}),hn.clear())})}function ua(r,t,e,n){if(!t)return Et;const i=r.getBoundingClientRect();if(t.left===i.left&&t.right===i.right&&t.top===i.top&&t.bottom===i.bottom)return Et;const{delay:a=0,duration:s=300,easing:o=Ji,start:l=ta()+a,end:c=l+s,tick:f=Et,css:d}=e(r,{from:t,to:i},n);let w=!0,u=!1,g;function p(){d&&(g=la(r,0,1,s,a,o,d)),a||(u=!0)}function b(){d&&ca(r,g),w=!1}return ea(h=>{if(!u&&h>=l&&(u=!0),u&&h>=c&&(f(1,0),b()),!w)return!1;if(u){const _=h-l,y=0+1*o(_/s);f(y,1-y)}return!0}),p(),f(0,1),b}function da(r){const t=getComputedStyle(r);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:e,height:n}=t,i=r.getBoundingClientRect();r.style.position="absolute",r.style.width=e,r.style.height=n,ha(r,i)}}function ha(r,t){const e=r.getBoundingClientRect();if(t.left!==e.left||t.top!==e.top){const n=getComputedStyle(r),i=n.transform==="none"?"":n.transform;r.style.transform=`${i} translate(${t.left-e.left}px, ${t.top-e.top}px)`}}let Xe;function Ke(r){Xe=r}function Un(){if(!Xe)throw new Error("Function called outside component initialization");return Xe}function pa(r){Un().$$.on_mount.push(r)}function Nn(r){Un().$$.on_destroy.push(r)}function ma(){const r=Un();return(t,e,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[t];if(i){const a=aa(t,e,{cancelable:n});return i.slice().forEach(s=>{s.call(r,a)}),!a.defaultPrevented}return!0}}const Ne=[],qe=[];let ze=[];const Xn=[],ga=Promise.resolve();let jn=!1;function wa(){jn||(jn=!0,ga.then(Zr))}function Tn(r){ze.push(r)}const Sn=new Set;let Ae=0;function Zr(){if(Ae!==0)return;const r=Xe;do{try{for(;Ae<Ne.length;){const t=Ne[Ae];Ae++,Ke(t),_a(t.$$)}}catch(t){throw Ne.length=0,Ae=0,t}for(Ke(null),Ne.length=0,Ae=0;qe.length;)qe.pop()();for(let t=0;t<ze.length;t+=1){const e=ze[t];Sn.has(e)||(Sn.add(e),e())}ze.length=0}while(Ne.length);for(;Xn.length;)Xn.pop()();jn=!1,Sn.clear(),Ke(r)}function _a(r){if(r.fragment!==null){r.update(),$e(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Tn)}}function ba(r){const t=[],e=[];ze.forEach(n=>r.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),ze=t}const ln=new Set;let Fe;function Vt(){Fe={r:0,c:[],p:Fe}}function Zt(){Fe.r||$e(Fe.c),Fe=Fe.p}function K(r,t){r&&r.i&&(ln.delete(r),r.i(t))}function Q(r,t,e,n){if(r&&r.o){if(ln.has(r))return;ln.add(r),Fe.c.push(()=>{ln.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}function ve(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function va(r,t){r.d(1),t.delete(r.key)}function ya(r,t){Q(r,1,1,()=>{t.delete(r.key)})}function ka(r,t){r.f(),ya(r,t)}function Gr(r,t,e,n,i,a,s,o,l,c,f,d){let w=r.length,u=a.length,g=w;const p={};for(;g--;)p[r[g].key]=g;const b=[],h=new Map,_=new Map,y=[];for(g=u;g--;){const D=d(i,a,g),z=e(D);let A=s.get(z);A?y.push(()=>A.p(D,t)):(A=c(z,D),A.c()),h.set(z,b[g]=A),z in p&&_.set(z,Math.abs(g-p[z]))}const $=new Set,k=new Set;function P(D){K(D,1),D.m(o,f),s.set(D.key,D),f=D.first,u--}for(;w&&u;){const D=b[u-1],z=r[w-1],A=D.key,j=z.key;D===z?(f=D.first,w--,u--):h.has(j)?!s.has(A)||$.has(A)?P(D):k.has(j)?w--:_.get(A)>_.get(j)?(k.add(A),P(D)):($.add(j),w--):(l(z,s),w--)}for(;w--;){const D=r[w];h.has(D.key)||l(D,s)}for(;u;)P(b[u-1]);return $e(y),b}function re(r,t){const e={},n={},i={$$scope:1};let a=r.length;for(;a--;){const s=r[a],o=t[a];if(o){for(const l in s)l in o||(n[l]=1);for(const l in o)i[l]||(e[l]=o[l],i[l]=1);r[a]=o}else for(const l in s)i[l]=1}for(const s in n)s in e||(e[s]=void 0);return e}function de(r){return typeof r=="object"&&r!==null?r:{}}function ht(r){r&&r.c()}function ut(r,t,e){const{fragment:n,after_update:i}=r.$$;n&&n.m(t,e),Tn(()=>{const a=r.$$.on_mount.map(Ir).filter(Qe);r.$$.on_destroy?r.$$.on_destroy.push(...a):$e(a),r.$$.on_mount=[]}),i.forEach(Tn)}function dt(r,t){const e=r.$$;e.fragment!==null&&(ba(e.after_update),$e(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function $a(r,t){r.$$.dirty[0]===-1&&(Ne.push(r),wa(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function zt(r,t,e,n,i,a,s=null,o=[-1]){const l=Xe;Ke(r);const c=r.$$={fragment:null,ctx:[],props:a,update:Et,not_equal:i,bound:Kn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Kn(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let f=!1;if(c.ctx=e?e(r,t.props||{},(d,w,...u)=>{const g=u.length?u[0]:w;return c.ctx&&i(c.ctx[d],c.ctx[d]=g)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](g),f&&$a(r,d)),w}):[],c.update(),f=!0,$e(c.before_update),c.fragment=n?n(c.ctx):!1,t.target){if(t.hydrate){const d=ia(t.target);c.fragment&&c.fragment.l(d),d.forEach(pt)}else c.fragment&&c.fragment.c();t.intro&&K(r.$$.fragment),ut(r,t.target,t.anchor),Zr()}Ke(l)}class It{constructor(){$n(this,"$$");$n(this,"$$set")}$destroy(){dt(this,1),this.$destroy=Et}$on(t,e){if(!Qe(e))return Et;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const i=n.indexOf(e);i!==-1&&n.splice(i,1)}}$set(t){this.$$set&&!Qi(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Sa="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Sa);const Le=Math.min,Wt=Math.max,mn=Math.round,on=Math.floor,ce=r=>({x:r,y:r}),Ca={left:"right",right:"left",bottom:"top",top:"bottom"},Fa={start:"end",end:"start"};function Jn(r,t,e){return Wt(r,Le(t,e))}function tn(r,t){return typeof r=="function"?r(t):r}function ye(r){return r.split("-")[0]}function en(r){return r.split("-")[1]}function Yr(r){return r==="x"?"y":"x"}function Kr(r){return r==="y"?"height":"width"}const Ea=new Set(["top","bottom"]);function ge(r){return Ea.has(ye(r))?"y":"x"}function qr(r){return Yr(ge(r))}function xa(r,t,e){e===void 0&&(e=!1);const n=en(r),i=qr(r),a=Kr(i);let s=i==="x"?n===(e?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[a]>t.floating[a]&&(s=gn(s)),[s,gn(s)]}function Pa(r){const t=gn(r);return[On(r),t,On(t)]}function On(r){return r.replace(/start|end/g,t=>Fa[t])}const Qn=["left","right"],tr=["right","left"],Da=["top","bottom"],Aa=["bottom","top"];function Na(r,t,e){switch(r){case"top":case"bottom":return e?t?tr:Qn:t?Qn:tr;case"left":case"right":return t?Da:Aa;default:return[]}}function ja(r,t,e,n){const i=en(r);let a=Na(ye(r),e==="start",n);return i&&(a=a.map(s=>s+"-"+i),t&&(a=a.concat(a.map(On)))),a}function gn(r){return r.replace(/left|right|bottom|top/g,t=>Ca[t])}function Ta(r){return{top:0,right:0,bottom:0,left:0,...r}}function Oa(r){return typeof r!="number"?Ta(r):{top:r,right:r,bottom:r,left:r}}function wn(r){const{x:t,y:e,width:n,height:i}=r;return{width:n,height:i,top:e,left:t,right:t+n,bottom:e+i,x:t,y:e}}function er(r,t,e){let{reference:n,floating:i}=r;const a=ge(t),s=qr(t),o=Kr(s),l=ye(t),c=a==="y",f=n.x+n.width/2-i.width/2,d=n.y+n.height/2-i.height/2,w=n[o]/2-i[o]/2;let u;switch(l){case"top":u={x:f,y:n.y-i.height};break;case"bottom":u={x:f,y:n.y+n.height};break;case"right":u={x:n.x+n.width,y:d};break;case"left":u={x:n.x-i.width,y:d};break;default:u={x:n.x,y:n.y}}switch(en(t)){case"start":u[s]-=w*(e&&c?-1:1);break;case"end":u[s]+=w*(e&&c?-1:1);break}return u}const Ba=async(r,t,e)=>{const{placement:n="bottom",strategy:i="absolute",middleware:a=[],platform:s}=e,o=a.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(t));let c=await s.getElementRects({reference:r,floating:t,strategy:i}),{x:f,y:d}=er(c,n,l),w=n,u={},g=0;for(let p=0;p<o.length;p++){const{name:b,fn:h}=o[p],{x:_,y,data:$,reset:k}=await h({x:f,y:d,initialPlacement:n,placement:w,strategy:i,middlewareData:u,rects:c,platform:s,elements:{reference:r,floating:t}});f=_??f,d=y??d,u={...u,[b]:{...u[b],...$}},k&&g<=50&&(g++,typeof k=="object"&&(k.placement&&(w=k.placement),k.rects&&(c=k.rects===!0?await s.getElementRects({reference:r,floating:t,strategy:i}):k.rects),{x:f,y:d}=er(c,w,l)),p=-1)}return{x:f,y:d,placement:w,strategy:i,middlewareData:u}};async function Wn(r,t){var e;t===void 0&&(t={});const{x:n,y:i,platform:a,rects:s,elements:o,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:f="viewport",elementContext:d="floating",altBoundary:w=!1,padding:u=0}=tn(t,r),g=Oa(u),b=o[w?d==="floating"?"reference":"floating":d],h=wn(await a.getClippingRect({element:(e=await(a.isElement==null?void 0:a.isElement(b)))==null||e?b:b.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(o.floating)),boundary:c,rootBoundary:f,strategy:l})),_=d==="floating"?{x:n,y:i,width:s.floating.width,height:s.floating.height}:s.reference,y=await(a.getOffsetParent==null?void 0:a.getOffsetParent(o.floating)),$=await(a.isElement==null?void 0:a.isElement(y))?await(a.getScale==null?void 0:a.getScale(y))||{x:1,y:1}:{x:1,y:1},k=wn(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:_,offsetParent:y,strategy:l}):_);return{top:(h.top-k.top+g.top)/$.y,bottom:(k.bottom-h.bottom+g.bottom)/$.y,left:(h.left-k.left+g.left)/$.x,right:(k.right-h.right+g.right)/$.x}}const Ra=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var e,n;const{placement:i,middlewareData:a,rects:s,initialPlacement:o,platform:l,elements:c}=t,{mainAxis:f=!0,crossAxis:d=!0,fallbackPlacements:w,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:p=!0,...b}=tn(r,t);if((e=a.arrow)!=null&&e.alignmentOffset)return{};const h=ye(i),_=ge(o),y=ye(o)===o,$=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=w||(y||!p?[gn(o)]:Pa(o)),P=g!=="none";!w&&P&&k.push(...ja(o,p,g,$));const D=[o,...k],z=await Wn(t,b),A=[];let j=((n=a.flip)==null?void 0:n.overflows)||[];if(f&&A.push(z[h]),d){const v=xa(i,s,$);A.push(z[v[0]],z[v[1]])}if(j=[...j,{placement:i,overflows:A}],!A.every(v=>v<=0)){var q,F;const v=(((q=a.flip)==null?void 0:q.index)||0)+1,W=D[v];if(W&&(!(d==="alignment"?_!==ge(W):!1)||j.every(ot=>ge(ot.placement)===_?ot.overflows[0]>0:!0)))return{data:{index:v,overflows:j},reset:{placement:W}};let at=(F=j.filter(V=>V.overflows[0]<=0).sort((V,ot)=>V.overflows[1]-ot.overflows[1])[0])==null?void 0:F.placement;if(!at)switch(u){case"bestFit":{var R;const V=(R=j.filter(ot=>{if(P){const G=ge(ot.placement);return G===_||G==="y"}return!0}).map(ot=>[ot.placement,ot.overflows.filter(G=>G>0).reduce((G,ft)=>G+ft,0)]).sort((ot,G)=>ot[1]-G[1])[0])==null?void 0:R[0];V&&(at=V);break}case"initialPlacement":at=o;break}if(i!==at)return{reset:{placement:at}}}return{}}}},za=new Set(["left","top"]);async function Ia(r,t){const{placement:e,platform:n,elements:i}=r,a=await(n.isRTL==null?void 0:n.isRTL(i.floating)),s=ye(e),o=en(e),l=ge(e)==="y",c=za.has(s)?-1:1,f=a&&l?-1:1,d=tn(t,r);let{mainAxis:w,crossAxis:u,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof g=="number"&&(u=o==="end"?g*-1:g),l?{x:u*f,y:w*c}:{x:w*c,y:u*f}}const La=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var e,n;const{x:i,y:a,placement:s,middlewareData:o}=t,l=await Ia(t,r);return s===((e=o.offset)==null?void 0:e.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:i+l.x,y:a+l.y,data:{...l,placement:s}}}}},Ma=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:e,y:n,placement:i}=t,{mainAxis:a=!0,crossAxis:s=!1,limiter:o={fn:b=>{let{x:h,y:_}=b;return{x:h,y:_}}},...l}=tn(r,t),c={x:e,y:n},f=await Wn(t,l),d=ge(ye(i)),w=Yr(d);let u=c[w],g=c[d];if(a){const b=w==="y"?"top":"left",h=w==="y"?"bottom":"right",_=u+f[b],y=u-f[h];u=Jn(_,u,y)}if(s){const b=d==="y"?"top":"left",h=d==="y"?"bottom":"right",_=g+f[b],y=g-f[h];g=Jn(_,g,y)}const p=o.fn({...t,[w]:u,[d]:g});return{...p,data:{x:p.x-e,y:p.y-n,enabled:{[w]:a,[d]:s}}}}}},Ua=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var e,n;const{placement:i,rects:a,platform:s,elements:o}=t,{apply:l=()=>{},...c}=tn(r,t),f=await Wn(t,c),d=ye(i),w=en(i),u=ge(i)==="y",{width:g,height:p}=a.floating;let b,h;d==="top"||d==="bottom"?(b=d,h=w===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(h=d,b=w==="end"?"top":"bottom");const _=p-f.top-f.bottom,y=g-f.left-f.right,$=Le(p-f[b],_),k=Le(g-f[h],y),P=!t.middlewareData.shift;let D=$,z=k;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(z=y),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(D=_),P&&!w){const j=Wt(f.left,0),q=Wt(f.right,0),F=Wt(f.top,0),R=Wt(f.bottom,0);u?z=g-2*(j!==0||q!==0?j+q:Wt(f.left,f.right)):D=p-2*(F!==0||R!==0?F+R:Wt(f.top,f.bottom))}await l({...t,availableWidth:z,availableHeight:D});const A=await s.getDimensions(o.floating);return g!==A.width||p!==A.height?{reset:{rects:!0}}:{}}}};function bn(){return typeof window<"u"}function He(r){return Xr(r)?(r.nodeName||"").toLowerCase():"#document"}function Gt(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function he(r){var t;return(t=(Xr(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function Xr(r){return bn()?r instanceof Node||r instanceof Gt(r).Node:!1}function oe(r){return bn()?r instanceof Element||r instanceof Gt(r).Element:!1}function ue(r){return bn()?r instanceof HTMLElement||r instanceof Gt(r).HTMLElement:!1}function nr(r){return!bn()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Gt(r).ShadowRoot}const Wa=new Set(["inline","contents"]);function nn(r){const{overflow:t,overflowX:e,overflowY:n,display:i}=le(r);return/auto|scroll|overlay|hidden|clip/.test(t+n+e)&&!Wa.has(i)}const Ha=new Set(["table","td","th"]);function Va(r){return Ha.has(He(r))}const Za=[":popover-open",":modal"];function vn(r){return Za.some(t=>{try{return r.matches(t)}catch{return!1}})}const Ga=["transform","translate","scale","rotate","perspective"],Ya=["transform","translate","scale","rotate","perspective","filter"],Ka=["paint","layout","strict","content"];function Hn(r){const t=Vn(),e=oe(r)?le(r):r;return Ga.some(n=>e[n]?e[n]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||Ya.some(n=>(e.willChange||"").includes(n))||Ka.some(n=>(e.contain||"").includes(n))}function qa(r){let t=ke(r);for(;ue(t)&&!Me(t);){if(Hn(t))return t;if(vn(t))return null;t=ke(t)}return null}function Vn(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Xa=new Set(["html","body","#document"]);function Me(r){return Xa.has(He(r))}function le(r){return Gt(r).getComputedStyle(r)}function yn(r){return oe(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function ke(r){if(He(r)==="html")return r;const t=r.assignedSlot||r.parentNode||nr(r)&&r.host||he(r);return nr(t)?t.host:t}function Jr(r){const t=ke(r);return Me(t)?r.ownerDocument?r.ownerDocument.body:r.body:ue(t)&&nn(t)?t:Jr(t)}function Ue(r,t,e){var n;t===void 0&&(t=[]),e===void 0&&(e=!0);const i=Jr(r),a=i===((n=r.ownerDocument)==null?void 0:n.body),s=Gt(i);if(a){const o=Bn(s);return t.concat(s,s.visualViewport||[],nn(i)?i:[],o&&e?Ue(o):[])}return t.concat(i,Ue(i,[],e))}function Bn(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function Qr(r){const t=le(r);let e=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const i=ue(r),a=i?r.offsetWidth:e,s=i?r.offsetHeight:n,o=mn(e)!==a||mn(n)!==s;return o&&(e=a,n=s),{width:e,height:n,$:o}}function Zn(r){return oe(r)?r:r.contextElement}function Ie(r){const t=Zn(r);if(!ue(t))return ce(1);const e=t.getBoundingClientRect(),{width:n,height:i,$:a}=Qr(t);let s=(a?mn(e.width):e.width)/n,o=(a?mn(e.height):e.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const Ja=ce(0);function ti(r){const t=Gt(r);return!Vn()||!t.visualViewport?Ja:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Qa(r,t,e){return t===void 0&&(t=!1),!e||t&&e!==Gt(r)?!1:t}function xe(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=!1);const i=r.getBoundingClientRect(),a=Zn(r);let s=ce(1);t&&(n?oe(n)&&(s=Ie(n)):s=Ie(r));const o=Qa(a,e,n)?ti(a):ce(0);let l=(i.left+o.x)/s.x,c=(i.top+o.y)/s.y,f=i.width/s.x,d=i.height/s.y;if(a){const w=Gt(a),u=n&&oe(n)?Gt(n):n;let g=w,p=Bn(g);for(;p&&n&&u!==g;){const b=Ie(p),h=p.getBoundingClientRect(),_=le(p),y=h.left+(p.clientLeft+parseFloat(_.paddingLeft))*b.x,$=h.top+(p.clientTop+parseFloat(_.paddingTop))*b.y;l*=b.x,c*=b.y,f*=b.x,d*=b.y,l+=y,c+=$,g=Gt(p),p=Bn(g)}}return wn({width:f,height:d,x:l,y:c})}function kn(r,t){const e=yn(r).scrollLeft;return t?t.left+e:xe(he(r)).left+e}function ei(r,t){const e=r.getBoundingClientRect(),n=e.left+t.scrollLeft-kn(r,e),i=e.top+t.scrollTop;return{x:n,y:i}}function ts(r){let{elements:t,rect:e,offsetParent:n,strategy:i}=r;const a=i==="fixed",s=he(n),o=t?vn(t.floating):!1;if(n===s||o&&a)return e;let l={scrollLeft:0,scrollTop:0},c=ce(1);const f=ce(0),d=ue(n);if((d||!d&&!a)&&((He(n)!=="body"||nn(s))&&(l=yn(n)),ue(n))){const u=xe(n);c=Ie(n),f.x=u.x+n.clientLeft,f.y=u.y+n.clientTop}const w=s&&!d&&!a?ei(s,l):ce(0);return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+f.x+w.x,y:e.y*c.y-l.scrollTop*c.y+f.y+w.y}}function es(r){return Array.from(r.getClientRects())}function ns(r){const t=he(r),e=yn(r),n=r.ownerDocument.body,i=Wt(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),a=Wt(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let s=-e.scrollLeft+kn(r);const o=-e.scrollTop;return le(n).direction==="rtl"&&(s+=Wt(t.clientWidth,n.clientWidth)-i),{width:i,height:a,x:s,y:o}}const rr=25;function rs(r,t){const e=Gt(r),n=he(r),i=e.visualViewport;let a=n.clientWidth,s=n.clientHeight,o=0,l=0;if(i){a=i.width,s=i.height;const f=Vn();(!f||f&&t==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}const c=kn(n);if(c<=0){const f=n.ownerDocument,d=f.body,w=getComputedStyle(d),u=f.compatMode==="CSS1Compat"&&parseFloat(w.marginLeft)+parseFloat(w.marginRight)||0,g=Math.abs(n.clientWidth-d.clientWidth-u);g<=rr&&(a-=g)}else c<=rr&&(a+=c);return{width:a,height:s,x:o,y:l}}const is=new Set(["absolute","fixed"]);function as(r,t){const e=xe(r,!0,t==="fixed"),n=e.top+r.clientTop,i=e.left+r.clientLeft,a=ue(r)?Ie(r):ce(1),s=r.clientWidth*a.x,o=r.clientHeight*a.y,l=i*a.x,c=n*a.y;return{width:s,height:o,x:l,y:c}}function ir(r,t,e){let n;if(t==="viewport")n=rs(r,e);else if(t==="document")n=ns(he(r));else if(oe(t))n=as(t,e);else{const i=ti(r);n={x:t.x-i.x,y:t.y-i.y,width:t.width,height:t.height}}return wn(n)}function ni(r,t){const e=ke(r);return e===t||!oe(e)||Me(e)?!1:le(e).position==="fixed"||ni(e,t)}function ss(r,t){const e=t.get(r);if(e)return e;let n=Ue(r,[],!1).filter(o=>oe(o)&&He(o)!=="body"),i=null;const a=le(r).position==="fixed";let s=a?ke(r):r;for(;oe(s)&&!Me(s);){const o=le(s),l=Hn(s);!l&&o.position==="fixed"&&(i=null),(a?!l&&!i:!l&&o.position==="static"&&!!i&&is.has(i.position)||nn(s)&&!l&&ni(r,s))?n=n.filter(f=>f!==s):i=o,s=ke(s)}return t.set(r,n),n}function os(r){let{element:t,boundary:e,rootBoundary:n,strategy:i}=r;const s=[...e==="clippingAncestors"?vn(t)?[]:ss(t,this._c):[].concat(e),n],o=s[0],l=s.reduce((c,f)=>{const d=ir(t,f,i);return c.top=Wt(d.top,c.top),c.right=Le(d.right,c.right),c.bottom=Le(d.bottom,c.bottom),c.left=Wt(d.left,c.left),c},ir(t,o,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function ls(r){const{width:t,height:e}=Qr(r);return{width:t,height:e}}function cs(r,t,e){const n=ue(t),i=he(t),a=e==="fixed",s=xe(r,!0,a,t);let o={scrollLeft:0,scrollTop:0};const l=ce(0);function c(){l.x=kn(i)}if(n||!n&&!a)if((He(t)!=="body"||nn(i))&&(o=yn(t)),n){const u=xe(t,!0,a,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else i&&c();a&&!n&&i&&c();const f=i&&!n&&!a?ei(i,o):ce(0),d=s.left+o.scrollLeft-l.x-f.x,w=s.top+o.scrollTop-l.y-f.y;return{x:d,y:w,width:s.width,height:s.height}}function Cn(r){return le(r).position==="static"}function ar(r,t){if(!ue(r)||le(r).position==="fixed")return null;if(t)return t(r);let e=r.offsetParent;return he(r)===e&&(e=e.ownerDocument.body),e}function ri(r,t){const e=Gt(r);if(vn(r))return e;if(!ue(r)){let i=ke(r);for(;i&&!Me(i);){if(oe(i)&&!Cn(i))return i;i=ke(i)}return e}let n=ar(r,t);for(;n&&Va(n)&&Cn(n);)n=ar(n,t);return n&&Me(n)&&Cn(n)&&!Hn(n)?e:n||qa(r)||e}const fs=async function(r){const t=this.getOffsetParent||ri,e=this.getDimensions,n=await e(r.floating);return{reference:cs(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function us(r){return le(r).direction==="rtl"}const ii={convertOffsetParentRelativeRectToViewportRelativeRect:ts,getDocumentElement:he,getClippingRect:os,getOffsetParent:ri,getElementRects:fs,getClientRects:es,getDimensions:ls,getScale:Ie,isElement:oe,isRTL:us};function ai(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function ds(r,t){let e=null,n;const i=he(r);function a(){var o;clearTimeout(n),(o=e)==null||o.disconnect(),e=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),a();const c=r.getBoundingClientRect(),{left:f,top:d,width:w,height:u}=c;if(o||t(),!w||!u)return;const g=on(d),p=on(i.clientWidth-(f+w)),b=on(i.clientHeight-(d+u)),h=on(f),y={rootMargin:-g+"px "+-p+"px "+-b+"px "+-h+"px",threshold:Wt(0,Le(1,l))||1};let $=!0;function k(P){const D=P[0].intersectionRatio;if(D!==l){if(!$)return s();D?s(!1,D):n=setTimeout(()=>{s(!1,1e-7)},1e3)}D===1&&!ai(c,r.getBoundingClientRect())&&s(),$=!1}try{e=new IntersectionObserver(k,{...y,root:i.ownerDocument})}catch{e=new IntersectionObserver(k,y)}e.observe(r)}return s(!0),a}function si(r,t,e,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:a=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Zn(r),f=i||a?[...c?Ue(c):[],...Ue(t)]:[];f.forEach(h=>{i&&h.addEventListener("scroll",e,{passive:!0}),a&&h.addEventListener("resize",e)});const d=c&&o?ds(c,e):null;let w=-1,u=null;s&&(u=new ResizeObserver(h=>{let[_]=h;_&&_.target===c&&u&&(u.unobserve(t),cancelAnimationFrame(w),w=requestAnimationFrame(()=>{var y;(y=u)==null||y.observe(t)})),e()}),c&&!l&&u.observe(c),u.observe(t));let g,p=l?xe(r):null;l&&b();function b(){const h=xe(r);p&&!ai(p,h)&&e(),p=h,g=requestAnimationFrame(b)}return e(),()=>{var h;f.forEach(_=>{i&&_.removeEventListener("scroll",e),a&&_.removeEventListener("resize",e)}),d==null||d(),(h=u)==null||h.disconnect(),u=null,l&&cancelAnimationFrame(g)}}const oi=La,li=Ma,ci=Ra,fi=Ua,hs=(r,t,e)=>{const n=new Map,i={platform:ii,...e},a={...i.platform,_c:n};return Ba(r,t,{...i,platform:a})},ps=Object.freeze(Object.defineProperty({__proto__:null,autoUpdate:si,computePosition:hs,flip:ci,getOverflowAncestors:Ue,offset:oi,platform:ii,shift:li,size:fi},Symbol.toStringTag,{value:"Module"}));/**
 * @license lucide-svelte v0.546.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const sr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};function or(r,t,e){const n=r.slice();return n[11]=t[e][0],n[12]=t[e][1],n}function Fn(r){let t,e=[r[12]],n={};for(let i=0;i<e.length;i+=1)n=_t(n,e[i]);return{c(){t=Vr(r[11]),un(t,n)},m(i,a){gt(i,t,a)},p(i,a){un(t,n=re(e,[a&32&&i[12]]))},d(i){i&&pt(t)}}}function lr(r){let t=r[11],e,n=r[11]&&Fn(r);return{c(){n&&n.c(),e=_n()},m(i,a){n&&n.m(i,a),gt(i,e,a)},p(i,a){i[11]?t?Ot(t,i[11])?(n.d(1),n=Fn(i),t=i[11],n.c(),n.m(e.parentNode,e)):n.p(i,a):(n=Fn(i),t=i[11],n.c(),n.m(e.parentNode,e)):t&&(n.d(1),n=null,t=i[11])},d(i){i&&pt(e),n&&n.d(i)}}}function ms(r){let t,e,n,i,a,s=ve(r[5]),o=[];for(let w=0;w<s.length;w+=1)o[w]=lr(or(r,s,w));const l=r[10].default,c=Yt(l,r,r[9],null);let f=[sr,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],d={};for(let w=0;w<f.length;w+=1)d=_t(d,f[w]);return{c(){t=Vr("svg");for(let w=0;w<o.length;w+=1)o[w].c();e=_n(),c&&c.c(),un(t,d)},m(w,u){gt(w,t,u);for(let g=0;g<o.length;g+=1)o[g]&&o[g].m(t,null);rt(t,e),c&&c.m(t,null),a=!0},p(w,[u]){if(u&32){s=ve(w[5]);let g;for(g=0;g<s.length;g+=1){const p=or(w,s,g);o[g]?o[g].p(p,u):(o[g]=lr(p),o[g].c(),o[g].m(t,e))}for(;g<o.length;g+=1)o[g].d(1);o.length=s.length}c&&c.p&&(!a||u&512)&&qt(c,l,w,w[9],a?Kt(l,w[9],u,null):Xt(w[9]),null),un(t,d=re(f,[sr,u&128&&w[7],(!a||u&4)&&{width:w[2]},(!a||u&4)&&{height:w[2]},(!a||u&2)&&{stroke:w[1]},(!a||u&28&&n!==(n=w[4]?Number(w[3])*24/Number(w[2]):w[3]))&&{"stroke-width":n},(!a||u&257&&i!==(i=w[6]("lucide-icon","lucide",w[0]?`lucide-${w[0]}`:"",w[8].class)))&&{class:i}]))},i(w){a||(K(c,w),a=!0)},o(w){Q(c,w),a=!1},d(w){w&&pt(t),Hr(o,w),c&&c.d(w)}}}function gs(r,t,e){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=qn(t,n),{$$slots:a={},$$scope:s}=t,{name:o=void 0}=t,{color:l="currentColor"}=t,{size:c=24}=t,{strokeWidth:f=2}=t,{absoluteStrokeWidth:d=!1}=t,{iconNode:w=[]}=t;const u=(...g)=>g.filter((p,b,h)=>!!p&&h.indexOf(p)===b).join(" ");return r.$$set=g=>{e(8,t=_t(_t({},t),Dt(g))),e(7,i=qn(t,n)),"name"in g&&e(0,o=g.name),"color"in g&&e(1,l=g.color),"size"in g&&e(2,c=g.size),"strokeWidth"in g&&e(3,f=g.strokeWidth),"absoluteStrokeWidth"in g&&e(4,d=g.absoluteStrokeWidth),"iconNode"in g&&e(5,w=g.iconNode),"$$scope"in g&&e(9,s=g.$$scope)},t=Dt(t),[o,l,c,f,d,w,u,i,t,s,a]}class pe extends It{constructor(t){super(),zt(this,t,gs,ms,Ot,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}function ws(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function _s(r){let t,e;const n=[{name:"arrow-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[ws]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function bs(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class ui extends It{constructor(t){super(),zt(this,t,bs,_s,Ot,{})}}function vs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function ys(r){let t,e;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[vs]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function ks(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class di extends It{constructor(t){super(),zt(this,t,ks,ys,Ot,{})}}function $s(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function Ss(r){let t,e;const n=[{name:"book-open-check"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[$s]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function Cs(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"M12 21V7"}],["path",{d:"m16 12 2 2 4-4"}],["path",{d:"M22 6V4a1 1 0 0 0-1-1h-5a4 4 0 0 0-4 4 4 4 0 0 0-4-4H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h6a3 3 0 0 1 3 3 3 3 0 0 1 3-3h6a1 1 0 0 0 1-1v-1.3"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class Fs extends It{constructor(t){super(),zt(this,t,Cs,Ss,Ot,{})}}function Es(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function xs(r){let t,e;const n=[{name:"chevron-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Es]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function Ps(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"m6 9 6 6 6-6"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class Ds extends It{constructor(t){super(),zt(this,t,Ps,xs,Ot,{})}}function As(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function Ns(r){let t,e;const n=[{name:"copy"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[As]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function js(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class Ts extends It{constructor(t){super(),zt(this,t,js,Ns,Ot,{})}}function Os(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function Bs(r){let t,e;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Os]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function Rs(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class hi extends It{constructor(t){super(),zt(this,t,Rs,Bs,Ot,{})}}function zs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function Is(r){let t,e;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[zs]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function Ls(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class pi extends It{constructor(t){super(),zt(this,t,Ls,Is,Ot,{})}}function Ms(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function Us(r){let t,e;const n=[{name:"rotate-ccw"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Ms]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function Ws(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class mi extends It{constructor(t){super(),zt(this,t,Ws,Us,Ot,{})}}function Hs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function Vs(r){let t,e;const n=[{name:"trash"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Hs]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function Zs(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class gi extends It{constructor(t){super(),zt(this,t,Zs,Vs,Ot,{})}}function Gs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(i,a){n&&n.m(i,a),t=!0},p(i,a){n&&n.p&&(!t||a&8)&&qt(n,e,i,i[3],t?Kt(e,i[3],a,null):Xt(i[3]),null)},i(i){t||(K(n,i),t=!0)},o(i){Q(n,i),t=!1},d(i){n&&n.d(i)}}}function Ys(r){let t,e;const n=[{name:"x"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Gs]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)i=_t(i,n[a]);return t=new pe({props:i}),{c(){ht(t.$$.fragment)},m(a,s){ut(t,a,s),e=!0},p(a,[s]){const o=s&3?re(n,[n[0],s&2&&de(a[1]),s&1&&{iconNode:a[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:a}),t.$set(o)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function Ks(r,t,e){let{$$slots:n={},$$scope:i}=t;const a=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Dt(s))),"$$scope"in s&&e(3,i=s.$$scope)},t=Dt(t),[a,t,n,i]}class qs extends It{constructor(t){super(),zt(this,t,Ks,Ys,Ot,{})}}function cr(r,t,e){const n=r.slice();return n[38]=t[e],n[40]=e,n}function fr(r){let t,e,n;return{c(){t=ct("label"),e=Rt(r[2]),et(t,"class","wa-select-label-text"),et(t,"for",n="wa-select-"+r[7])},m(i,a){gt(i,t,a),rt(t,e)},p(i,a){a[0]&4&&We(e,i[2]),a[0]&128&&n!==(n="wa-select-"+i[7])&&et(t,"for",n)},d(i){i&&pt(t)}}}function Xs(r){let t,e;return{c(){t=ct("span"),e=Rt(r[1]),et(t,"class","wa-select-placeholder")},m(n,i){gt(n,t,i),rt(t,e)},p(n,i){i[0]&2&&We(e,n[1])},d(n){n&&pt(t)}}}function Js(r){let t,e;return{c(){t=ct("span"),e=Rt(r[16]),et(t,"class","wa-select-label")},m(n,i){gt(n,t,i),rt(t,e)},p(n,i){i[0]&65536&&We(e,n[16])},d(n){n&&pt(t)}}}function ur(r){let t,e,n,i,a;return e=new qs({}),{c(){t=ct("button"),ht(e.$$.fragment),et(t,"type","button"),et(t,"class","wa-select-clear"),et(t,"aria-label","Clear selection")},m(s,o){gt(s,t,o),ut(e,t,null),n=!0,i||(a=fe(t,"click",r[21]),i=!0)},p:Et,i(s){n||(K(e.$$.fragment,s),n=!0)},o(s){Q(e.$$.fragment,s),n=!1},d(s){s&&pt(t),dt(e),i=!1,a()}}}function dr(r){let t,e,n;return e=new Ds({}),{c(){t=ct("div"),ht(e.$$.fragment),et(t,"class","wa-select-chevron"),ne(t,"rotated",r[9])},m(i,a){gt(i,t,a),ut(e,t,null),n=!0},p(i,a){(!n||a[0]&512)&&ne(t,"rotated",i[9])},i(i){n||(K(e.$$.fragment,i),n=!0)},o(i){Q(e.$$.fragment,i),n=!1},d(i){i&&pt(t),dt(e)}}}function hr(r){let t,e,n,i=r[4]&&pr(r);function a(l,c){return l[10].length===0?to:Qs}let s=a(r),o=s(r);return{c(){t=ct("div"),i&&i.c(),e=mt(),n=ct("div"),o.c(),et(n,"class","wa-select-list"),et(t,"class","wa-select-dropdown")},m(l,c){gt(l,t,c),i&&i.m(t,null),rt(t,e),rt(t,n),o.m(n,null),r[30](t)},p(l,c){l[4]?i?i.p(l,c):(i=pr(l),i.c(),i.m(t,e)):i&&(i.d(1),i=null),s===(s=a(l))&&o?o.p(l,c):(o.d(1),o=s(l),o&&(o.c(),o.m(n,null)))},d(l){l&&pt(t),i&&i.d(),o.d(),r[30](null)}}}function pr(r){let t,e,n,i;return{c(){t=ct("div"),e=ct("input"),et(e,"type","text"),et(e,"class","wa-select-search-input"),et(e,"placeholder","Search..."),e.value=r[13],et(t,"class","wa-select-search")},m(a,s){gt(a,t,s),rt(t,e),r[27](e),n||(i=fe(e,"input",r[23]),n=!0)},p(a,s){s[0]&8192&&e.value!==a[13]&&(e.value=a[13])},d(a){a&&pt(t),r[27](null),n=!1,i()}}}function Qs(r){let t=[],e=new Map,n,i=ve(r[10]);const a=s=>s[38].value;for(let s=0;s<i.length;s+=1){let o=cr(r,i,s),l=a(o);e.set(l,t[s]=mr(l,o))}return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=_n()},m(s,o){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(s,o);gt(s,n,o)},p(s,o){o[0]&1197056&&(i=ve(s[10]),t=Gr(t,o,a,1,s,i,e,n.parentNode,va,mr,n,cr))},d(s){s&&pt(n);for(let o=0;o<t.length;o+=1)t[o].d(s)}}}function to(r){let t;return{c(){t=ct("div"),t.textContent="No options available",et(t,"class","wa-select-empty")},m(e,n){gt(e,t,n)},p:Et,d(e){e&&pt(t)}}}function mr(r,t){let e,n=t[38].label+"",i,a,s,o,l;function c(){return t[28](t[38])}function f(){return t[29](t[40])}return{key:r,first:null,c(){e=ct("button"),i=Rt(n),a=mt(),et(e,"type","button"),et(e,"class","wa-select-option"),et(e,"data-select-index",s=t[40]),ne(e,"selected",t[14]===t[40]),ne(e,"active",t[17]()===t[38].value),this.first=e},m(d,w){gt(d,e,w),rt(e,i),rt(e,a),o||(l=[fe(e,"click",c),fe(e,"mouseenter",f)],o=!0)},p(d,w){t=d,w[0]&1024&&n!==(n=t[38].label+"")&&We(i,n),w[0]&1024&&s!==(s=t[40])&&et(e,"data-select-index",s),w[0]&17408&&ne(e,"selected",t[14]===t[40]),w[0]&132096&&ne(e,"active",t[17]()===t[38].value)},d(d){d&&pt(e),o=!1,$e(l)}}}function eo(r){let t,e,n,i,a,s,o,l,c,f,d,w,u,g=r[2]&&fr(r);function p(k,P){return k[0]?Js:Xs}let b=p(r),h=b(r),_=r[5]&&r[0]&&ur(r),y=r[6]&&dr(r),$=r[9]&&hr(r);return{c(){t=ct("div"),g&&g.c(),e=mt(),n=ct("div"),i=ct("div"),h.c(),a=mt(),s=ct("div"),_&&_.c(),o=mt(),y&&y.c(),f=mt(),$&&$.c(),et(i,"class","wa-select-value"),et(s,"class","wa-select-controls"),et(n,"id",l="wa-select-"+r[7]),et(n,"class","wa-select-trigger"),et(n,"role","button"),et(n,"tabindex",c=r[3]?-1:0),et(n,"style",r[8]),ne(n,"open",r[9]),ne(n,"disabled",r[3]),ne(n,"has-value",r[0]),et(t,"class","wa-select-container wa-select")},m(k,P){gt(k,t,P),g&&g.m(t,null),rt(t,e),rt(t,n),rt(n,i),h.m(i,null),rt(n,a),rt(n,s),_&&_.m(s,null),rt(s,o),y&&y.m(s,null),r[25](n),rt(t,f),$&&$.m(t,null),d=!0,w||(u=[fe(n,"click",r[26]),fe(n,"keydown",r[22])],w=!0)},p(k,P){k[2]?g?g.p(k,P):(g=fr(k),g.c(),g.m(t,e)):g&&(g.d(1),g=null),b===(b=p(k))&&h?h.p(k,P):(h.d(1),h=b(k),h&&(h.c(),h.m(i,null))),k[5]&&k[0]?_?(_.p(k,P),P[0]&33&&K(_,1)):(_=ur(k),_.c(),K(_,1),_.m(s,o)):_&&(Vt(),Q(_,1,1,()=>{_=null}),Zt()),k[6]?y?(y.p(k,P),P[0]&64&&K(y,1)):(y=dr(k),y.c(),K(y,1),y.m(s,null)):y&&(Vt(),Q(y,1,1,()=>{y=null}),Zt()),(!d||P[0]&128&&l!==(l="wa-select-"+k[7]))&&et(n,"id",l),(!d||P[0]&8&&c!==(c=k[3]?-1:0))&&et(n,"tabindex",c),(!d||P[0]&256)&&et(n,"style",k[8]),(!d||P[0]&512)&&ne(n,"open",k[9]),(!d||P[0]&8)&&ne(n,"disabled",k[3]),(!d||P[0]&1)&&ne(n,"has-value",k[0]),k[9]?$?$.p(k,P):($=hr(k),$.c(),$.m(t,null)):$&&($.d(1),$=null)},i(k){d||(K(_),K(y),d=!0)},o(k){Q(_),Q(y),d=!1},d(k){k&&pt(t),g&&g.d(),h.d(),_&&_.d(),y&&y.d(),r[25](null),$&&$.d(),w=!1,$e(u)}}}function no(r,t,e){let n,{items:i=[]}=t,{value:a=null}=t,{placeholder:s="Select..."}=t,{label:o=""}=t,{disabled:l=!1}=t,{searchable:c=!1}=t,{clearable:f=!1}=t,{showChevron:d=!0}=t,{name:w=""}=t,{containerStyles:u=""}=t,g=!1,p="",b=[],h=-1,_,y,$,k=null;const P=ma();function D(){return a?typeof a=="string"?a:a.value||"":""}function z(){p?e(10,b=i.filter(L=>L.label.toLowerCase().includes(p.toLowerCase())||L.value.toLowerCase().includes(p.toLowerCase()))):e(10,b=i),e(14,h=-1)}function A(){l||g||(e(9,g=!0),e(13,p=""),z(),c&&setTimeout(()=>{$&&$.focus()},0),_&&y&&q())}function j(){e(9,g=!1),e(13,p=""),e(14,h=-1)}function q(){if(!_||!y)return;const L=[oi(6),ci({padding:8,fallbackAxisSideDirection:"end"}),li({padding:8}),fi({padding:8,apply({availableHeight:X}){Object.assign(y.style,{maxHeight:`${Math.min(X-10,350)}px`,width:`${_.offsetWidth}px`})}})];k=si(_,y,async()=>{const{computePosition:X}=await Promise.resolve().then(()=>ps),{x:Ct,y:At,placement:wt}=await X(_,y,{middleware:L,placement:"bottom-start"});y.setAttribute("data-placement",wt),Object.assign(y.style,{left:`${Ct}px`,top:`${At}px`})})}function F(L){e(0,a=L),j(),P("select",L)}function R(L){L.stopPropagation(),e(0,a=null),j(),P("clear")}function v(L){if(!g){(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),A());return}switch(L.key){case"ArrowDown":L.preventDefault(),e(14,h=Math.min(h+1,b.length-1)),W();break;case"ArrowUp":L.preventDefault(),e(14,h=Math.max(h-1,-1)),W();break;case"Enter":L.preventDefault(),h>=0?F(b[h]):j();break;case"Escape":L.preventDefault(),j();break}}function W(){if(h<0)return;const L=document.querySelector(`[data-select-index="${h}"]`);L&&L.scrollIntoView({block:"nearest"})}function at(L){e(13,p=L.target.value),z()}function V(L){if(g&&_&&y){const X=L.target;!_.contains(X)&&!y.contains(X)&&j()}}pa(()=>{document.addEventListener("click",V),z()}),Nn(()=>{document.removeEventListener("click",V),k&&k()});function ot(L){qe[L?"unshift":"push"](()=>{_=L,e(11,_)})}const G=()=>g?j():A();function ft(L){qe[L?"unshift":"push"](()=>{$=L,e(15,$)})}const O=L=>F(L),T=L=>e(14,h=L);function lt(L){qe[L?"unshift":"push"](()=>{y=L,e(12,y),e(9,g),e(11,_)})}return r.$$set=L=>{"items"in L&&e(24,i=L.items),"value"in L&&e(0,a=L.value),"placeholder"in L&&e(1,s=L.placeholder),"label"in L&&e(2,o=L.label),"disabled"in L&&e(3,l=L.disabled),"searchable"in L&&e(4,c=L.searchable),"clearable"in L&&e(5,f=L.clearable),"showChevron"in L&&e(6,d=L.showChevron),"name"in L&&e(7,w=L.name),"containerStyles"in L&&e(8,u=L.containerStyles)},r.$$.update=()=>{var L;if(r.$$.dirty[0]&16777219&&e(16,n=a?typeof a=="string"?((L=i.find(X=>X.value===a))==null?void 0:L.label)||a:a.label||s:s),r.$$.dirty[0]&1025&&a!==void 0&&b.length>0){const X=D();e(14,h=b.findIndex(Ct=>Ct.value===X))}r.$$.dirty[0]&6656&&g&&y&&_&&(e(12,y.style.width=`${_.offsetWidth}px`,y),e(12,y.style.top=`${_.offsetTop+_.offsetHeight+6}px`,y))},z(),[a,s,o,l,c,f,d,w,u,g,b,_,y,p,h,$,n,D,A,j,F,R,v,at,i,ot,G,ft,O,T,lt]}class ro extends It{constructor(t){super(),zt(this,t,no,eo,Ot,{items:24,value:0,placeholder:1,label:2,disabled:3,searchable:4,clearable:5,showChevron:6,name:7,containerStyles:8},null,[-1,-1])}}class gr extends x.Modal{constructor(t,e,n,i="draft"){super(t),this.name=e,this.onConfirm=n,this.type=i}onOpen(){const{contentEl:t}=this;t.addClass("wa-centered-modal");const e=this.type==="chapter"?"chapter":"draft";t.createEl("h3",{text:`Delete ${e} '${this.name}'?`}),this.type==="draft"&&t.createEl("p",{text:"This will create a backup copy before deleting."});const n=t.createDiv({cls:"modal-button-row wa-button-group"}),i=n.createEl("button",{text:"Delete",cls:"mod-cta wa-button"}),a=n.createEl("button",{text:"Cancel",cls:"wa-button"});i.onclick=async()=>{this.close(),await this.onConfirm()},a.onclick=()=>{this.close()}}}class io extends x.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:`Duplicate Draft: ${this.props.sourceDraftName}`});let e="";new x.Setting(t).setName("New draft name").addText(n=>n.setPlaceholder(this.props.suggestedName).setValue(this.props.suggestedName).onChange(i=>e=i)),new x.Setting(t).addButton(n=>n.setButtonText("Duplicate").setCta().onClick(()=>{this.close();const i=e&&e.trim()?e.trim():this.props.suggestedName;this.props.onSubmit(i)}))}onClose(){this.contentEl.empty()}}class ao extends x.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var a;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Chapter"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New chapter name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new chapter name",cls:"wa-rename-input",attr:{"aria-label":"New chapter name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),i=n.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(a=this.inputEl)==null||a.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),i.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n,i;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Chapter name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(i=this.inputEl)==null||i.focus();return}this.errorEl&&(this.errorEl.style.display="none"),this.onSubmit(t),this.close()}}function wi(r){const t=r-1;return t*t*t+1}function so(r,{from:t,to:e},n={}){const i=getComputedStyle(r),a=i.transform==="none"?"":i.transform,[s,o]=i.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*s/e.width-(e.left+s),c=t.top+t.height*o/e.height-(e.top+o),{delay:f=0,duration:d=u=>Math.sqrt(u)*120,easing:w=wi}=n;return{delay:f,duration:Qe(d)?d(Math.sqrt(l*l+c*c)):d,easing:w,css:(u,g)=>{const p=g*l,b=g*c,h=u+g*t.width/e.width,_=u+g*t.height/e.height;return`transform: ${a} translate(${p}px, ${b}px) scale(${h}, ${_});`}}}function oo(r){let t,e,n,i,a;const s=r[6].default,o=Yt(s,r,r[5],null);return{c(){t=ct("button"),o&&o.c(),et(t,"class",e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`),et(t,"aria-label",r[3]),t.disabled=r[1],et(t,"style",r[2])},m(l,c){gt(l,t,c),o&&o.m(t,null),n=!0,i||(a=fe(t,"click",function(){Qe(r[4])&&r[4].apply(this,arguments)}),i=!0)},p(l,[c]){r=l,o&&o.p&&(!n||c&32)&&qt(o,s,r,r[5],n?Kt(s,r[5],c,null):Xt(r[5]),null),(!n||c&1&&e!==(e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`))&&et(t,"class",e),(!n||c&8)&&et(t,"aria-label",r[3]),(!n||c&2)&&(t.disabled=r[1]),(!n||c&4)&&et(t,"style",r[2])},i(l){n||(K(o,l),n=!0)},o(l){Q(o,l),n=!1},d(l){l&&pt(t),o&&o.d(l),i=!1,a()}}}function lo(r,t,e){let{$$slots:n={},$$scope:i}=t,{variant:a="default"}=t,{disabled:s=!1}=t,{style:o=""}=t,{title:l=""}=t,{clickHandler:c=void 0}=t;return r.$$set=f=>{"variant"in f&&e(0,a=f.variant),"disabled"in f&&e(1,s=f.disabled),"style"in f&&e(2,o=f.style),"title"in f&&e(3,l=f.title),"clickHandler"in f&&e(4,c=f.clickHandler),"$$scope"in f&&e(5,i=f.$$scope)},[a,s,o,l,c,i,n]}class we extends It{constructor(t){super(),zt(this,t,lo,oo,Ot,{variant:0,disabled:1,style:2,title:3,clickHandler:4})}}function co(r){let t,e,n,i,a,s,o;const l=r[7].default,c=Yt(l,r,r[6],null);return{c(){t=ct("button"),e=ct("span"),c&&c.c(),et(e,"class",n=sn(r[5]?"spinning":"")+" svelte-10fbbmm"),et(t,"class",i=sn(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"),et(t,"aria-label",r[0]),t.disabled=r[2],et(t,"title",r[3])},m(f,d){gt(f,t,d),rt(t,e),c&&c.m(e,null),a=!0,s||(o=fe(t,"click",function(){Qe(r[4])&&r[4].apply(this,arguments)}),s=!0)},p(f,[d]){r=f,c&&c.p&&(!a||d&64)&&qt(c,l,r,r[6],a?Kt(l,r[6],d,null):Xt(r[6]),null),(!a||d&32&&n!==(n=sn(r[5]?"spinning":"")+" svelte-10fbbmm"))&&et(e,"class",n),(!a||d&2&&i!==(i=sn(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"))&&et(t,"class",i),(!a||d&1)&&et(t,"aria-label",r[0]),(!a||d&4)&&(t.disabled=r[2]),(!a||d&8)&&et(t,"title",r[3])},i(f){a||(K(c,f),a=!0)},o(f){Q(c,f),a=!1},d(f){f&&pt(t),c&&c.d(f),s=!1,o()}}}function fo(r,t,e){let{$$slots:n={},$$scope:i}=t,{ariaLabel:a=""}=t,{variant:s="default"}=t,{disabled:o=!1}=t,{title:l}=t,{clickHandler:c=void 0}=t,{spinning:f=!1}=t;return r.$$set=d=>{"ariaLabel"in d&&e(0,a=d.ariaLabel),"variant"in d&&e(1,s=d.variant),"disabled"in d&&e(2,o=d.disabled),"title"in d&&e(3,l=d.title),"clickHandler"in d&&e(4,c=d.clickHandler),"spinning"in d&&e(5,f=d.spinning),"$$scope"in d&&e(6,i=d.$$scope)},[a,s,o,l,c,f,i,n]}class se extends It{constructor(t){super(),zt(this,t,fo,co,Ot,{ariaLabel:0,variant:1,disabled:2,title:3,clickHandler:4,spinning:5})}}function wr(r,t,e){const n=r.slice();return n[64]=t[e],n[66]=e,n}function _r(r,t,e){const n=r.slice();return n[67]=t[e],n}function uo(r){let t,e;return t=new mi({}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function ho(r){let t;return{c(){t=Rt("New Project")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function br(r){let t;return{c(){t=ct("div"),t.textContent="No projects found.",et(t,"class","wa-muted"),be(t,"margin","4rem auto 0"),be(t,"font-size","18px"),be(t,"width","fit-content")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function vr(r){let t,e,n,i,a,s;return a=new ro({props:{name:"wa-project-select",value:r[3],items:r[7],placeholder:"Choose a project...",showChevron:!0,disabled:zo,clearable:!1,searchable:!1}}),a.$on("select",r[41]),{c(){t=ct("div"),e=ct("label"),e.textContent="Select project",n=mt(),i=ct("div"),ht(a.$$.fragment),et(e,"for","wa-project-select"),et(i,"class","wa-row"),be(t,"margin","20px 0")},m(o,l){gt(o,t,l),rt(t,e),rt(t,n),rt(t,i),ut(a,i,null),s=!0},p(o,l){const c={};l[0]&8&&(c.value=o[3]),l[0]&128&&(c.items=o[7]),a.$set(c)},i(o){s||(K(a.$$.fragment,o),s=!0)},o(o){Q(a.$$.fragment,o),s=!1},d(o){o&&pt(t),dt(a)}}}function yr(r){let t,e,n,i,a,s,o,l,c,f,d,w,u,g,p,b;o=new se({props:{ariaLabel:"Toggle draft sort order",title:void 0,clickHandler:r[42],$$slots:{default:[go]},$$scope:{ctx:r}}}),f=new we({props:{clickHandler:r[23],variant:"primary",$$slots:{default:[wo]},$$scope:{ctx:r}}}),w=new se({props:{ariaLabel:"Refresh drafts",title:void 0,clickHandler:r[20],disabled:r[8],spinning:r[8],$$slots:{default:[_o]},$$scope:{ctx:r}}});let h=r[9]&&kr(r),_=r[5].length===0&&$r(),y=r[5].length>0&&Sr(r);return{c(){t=ct("div"),e=ct("div"),n=ct("div"),i=ct("div"),a=ct("div"),a.textContent="Drafts",s=mt(),ht(o.$$.fragment),l=mt(),c=ct("div"),ht(f.$$.fragment),d=mt(),ht(w.$$.fragment),u=mt(),h&&h.c(),g=mt(),_&&_.c(),p=mt(),y&&y.c(),et(a,"class","wa-title"),et(i,"class","wa-button-group"),et(c,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","draft-controls"),be(t,"margin-top","16px")},m($,k){gt($,t,k),rt(t,e),rt(e,n),rt(n,i),rt(i,a),rt(i,s),ut(o,i,null),rt(n,l),rt(n,c),ut(f,c,null),rt(c,d),ut(w,c,null),rt(t,u),h&&h.m(t,null),rt(t,g),_&&_.m(t,null),rt(t,p),y&&y.m(t,null),b=!0},p($,k){const P={};k[0]&2048&&(P.clickHandler=$[42]),k[0]&2048|k[2]&256&&(P.$$scope={dirty:k,ctx:$}),o.$set(P);const D={};k[2]&256&&(D.$$scope={dirty:k,ctx:$}),f.$set(D);const z={};k[0]&256&&(z.disabled=$[8]),k[0]&256&&(z.spinning=$[8]),k[2]&256&&(z.$$scope={dirty:k,ctx:$}),w.$set(z),$[9]?h?(h.p($,k),k[0]&512&&K(h,1)):(h=kr($),h.c(),K(h,1),h.m(t,g)):h&&(Vt(),Q(h,1,1,()=>{h=null}),Zt()),$[5].length===0?_||(_=$r(),_.c(),_.m(t,p)):_&&(_.d(1),_=null),$[5].length>0?y?(y.p($,k),k[0]&32&&K(y,1)):(y=Sr($),y.c(),K(y,1),y.m(t,null)):y&&(Vt(),Q(y,1,1,()=>{y=null}),Zt())},i($){b||(K(o.$$.fragment,$),K(f.$$.fragment,$),K(w.$$.fragment,$),K(h),K(y),b=!0)},o($){Q(o.$$.fragment,$),Q(f.$$.fragment,$),Q(w.$$.fragment,$),Q(h),Q(y),b=!1},d($){$&&pt(t),dt(o),dt(f),dt(w),h&&h.d(),_&&_.d(),y&&y.d()}}}function po(r){let t,e;return t=new ui({}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function mo(r){let t,e;return t=new di({}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function go(r){let t,e,n,i;const a=[mo,po],s=[];function o(l,c){return l[11]?0:1}return t=o(r),e=s[t]=a[t](r),{c(){e.c(),n=_n()},m(l,c){s[t].m(l,c),gt(l,n,c),i=!0},p(l,c){let f=t;t=o(l),t!==f&&(Vt(),Q(s[f],1,1,()=>{s[f]=null}),Zt(),e=s[t],e||(e=s[t]=a[t](l),e.c()),K(e,1),e.m(n.parentNode,n))},i(l){i||(K(e),i=!0)},o(l){Q(e),i=!1},d(l){l&&pt(n),s[t].d(l)}}}function wo(r){let t;return{c(){t=Rt("New Draft")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function _o(r){let t,e;return t=new mi({}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function kr(r){let t,e,n,i,a,s,o,l,c;return i=new we({props:{clickHandler:r[22],variant:"primary",$$slots:{default:[bo]},$$scope:{ctx:r}}}),s=new we({props:{clickHandler:r[44],$$slots:{default:[vo]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("input"),n=mt(),ht(i.$$.fragment),a=mt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Draft name"),et(t,"class","create-inline wa-row")},m(f,d){gt(f,t,d),rt(t,e),dn(e,r[10]),rt(t,n),ut(i,t,null),rt(t,a),ut(s,t,null),o=!0,l||(c=fe(e,"input",r[43]),l=!0)},p(f,d){d[0]&1024&&e.value!==f[10]&&dn(e,f[10]);const w={};d[2]&256&&(w.$$scope={dirty:d,ctx:f}),i.$set(w);const u={};d[0]&1536&&(u.clickHandler=f[44]),d[2]&256&&(u.$$scope={dirty:d,ctx:f}),s.$set(u)},i(f){o||(K(i.$$.fragment,f),K(s.$$.fragment,f),o=!0)},o(f){Q(i.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&pt(t),dt(i),dt(s),l=!1,c()}}}function bo(r){let t;return{c(){t=Rt("Create")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function vo(r){let t;return{c(){t=Rt("Cancel")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function $r(r){let t;return{c(){t=ct("div"),t.textContent="No drafts found."},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Sr(r){let t,e,n=ve(r[5]),i=[];for(let s=0;s<n.length;s+=1)i[s]=Er(_r(r,n,s));const a=s=>Q(i[s],1,1,()=>{i[s]=null});return{c(){t=ct("div");for(let s=0;s<i.length;s+=1)i[s].c();et(t,"class","wa-draft-list")},m(s,o){gt(s,t,o);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(t,null);e=!0},p(s,o){if(o[0]&251662368|o[1]&8){n=ve(s[5]);let l;for(l=0;l<n.length;l+=1){const c=_r(s,n,l);i[l]?(i[l].p(c,o),K(i[l],1)):(i[l]=Er(c),i[l].c(),K(i[l],1),i[l].m(t,null))}for(Vt(),l=n.length;l<i.length;l+=1)a(l);Zt()}},i(s){if(!e){for(let o=0;o<n.length;o+=1)K(i[o]);e=!0}},o(s){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)Q(i[o]);e=!1},d(s){s&&pt(t),Hr(i,s)}}}function Cr(r){let t;return{c(){t=ct("span"),t.textContent="●",et(t,"class","wa-draft-active-indicator"),et(t,"title","Active draft")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function yo(r){let t,e;return t=new hi({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Fr(r){let t,e;function n(){return r[46](r[67])}return t=new se({props:{ariaLabel:"Set active draft",title:void 0,clickHandler:n,$$slots:{default:[ko]},$$scope:{ctx:r}}}),{c(){ht(t.$$.fragment)},m(i,a){ut(t,i,a),e=!0},p(i,a){r=i;const s={};a[0]&32&&(s.clickHandler=n),a[2]&256&&(s.$$scope={dirty:a,ctx:r}),t.$set(s)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function ko(r){let t,e;return t=new Fs({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function $o(r){let t,e;return t=new pi({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function So(r){let t,e;return t=new Ts({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Co(r){let t,e;return t=new gi({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Er(r){let t,e,n,i=r[67]+"",a,s,o,l,c,f,d,w,u,g,p,b,h,_,y=r[12]===r[67]&&Cr();function $(){return r[45](r[67])}l=new se({props:{ariaLabel:"Open draft",title:void 0,clickHandler:$,$$slots:{default:[yo]},$$scope:{ctx:r}}});let k=r[12]!==r[67]&&Fr(r);function P(){return r[47](r[67])}d=new se({props:{ariaLabel:"Rename draft",title:void 0,clickHandler:P,$$slots:{default:[$o]},$$scope:{ctx:r}}});function D(){return r[48](r[67])}u=new se({props:{ariaLabel:"Duplicate draft",title:void 0,clickHandler:D,$$slots:{default:[So]},$$scope:{ctx:r}}});function z(){return r[49](r[67])}return p=new se({props:{ariaLabel:"Delete draft",title:void 0,clickHandler:z,$$slots:{default:[Co]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("div"),y&&y.c(),n=mt(),a=Rt(i),s=mt(),o=ct("div"),ht(l.$$.fragment),c=mt(),k&&k.c(),f=mt(),ht(d.$$.fragment),w=mt(),ht(u.$$.fragment),g=mt(),ht(p.$$.fragment),b=mt(),et(e,"class","wa-draft-name wa-row"),et(o,"class","wa-draft-actions"),et(t,"class",h="wa-draft-item "+(r[12]===r[67]?"active":""))},m(A,j){gt(A,t,j),rt(t,e),y&&y.m(e,null),rt(e,n),rt(e,a),rt(t,s),rt(t,o),ut(l,o,null),rt(o,c),k&&k.m(o,null),rt(o,f),ut(d,o,null),rt(o,w),ut(u,o,null),rt(o,g),ut(p,o,null),rt(t,b),_=!0},p(A,j){r=A,r[12]===r[67]?y||(y=Cr(),y.c(),y.m(e,n)):y&&(y.d(1),y=null),(!_||j[0]&32)&&i!==(i=r[67]+"")&&We(a,i);const q={};j[0]&32&&(q.clickHandler=$),j[2]&256&&(q.$$scope={dirty:j,ctx:r}),l.$set(q),r[12]!==r[67]?k?(k.p(r,j),j[0]&4128&&K(k,1)):(k=Fr(r),k.c(),K(k,1),k.m(o,f)):k&&(Vt(),Q(k,1,1,()=>{k=null}),Zt());const F={};j[0]&32&&(F.clickHandler=P),j[2]&256&&(F.$$scope={dirty:j,ctx:r}),d.$set(F);const R={};j[0]&32&&(R.clickHandler=D),j[2]&256&&(R.$$scope={dirty:j,ctx:r}),u.$set(R);const v={};j[0]&32&&(v.clickHandler=z),j[2]&256&&(v.$$scope={dirty:j,ctx:r}),p.$set(v),(!_||j[0]&4128&&h!==(h="wa-draft-item "+(r[12]===r[67]?"active":"")))&&et(t,"class",h)},i(A){_||(K(l.$$.fragment,A),K(k),K(d.$$.fragment,A),K(u.$$.fragment,A),K(p.$$.fragment,A),_=!0)},o(A){Q(l.$$.fragment,A),Q(k),Q(d.$$.fragment,A),Q(u.$$.fragment,A),Q(p.$$.fragment,A),_=!1},d(A){A&&pt(t),y&&y.d(),dt(l),k&&k.d(),dt(d),dt(u),dt(p)}}}function xr(r){let t,e,n,i,a,s,o,l,c,f,d,w;o=new we({props:{clickHandler:r[50],variant:"primary",$$slots:{default:[Fo]},$$scope:{ctx:r}}});let u=r[15]&&Pr(r);const g=[Ao,Do,Po],p=[];function b(h,_){return h[14]?0:h[13].length===0?1:2}return f=b(r),d=p[f]=g[f](r),{c(){t=ct("div"),e=ct("div"),n=ct("div"),i=ct("div"),i.textContent="Chapters",a=mt(),s=ct("div"),ht(o.$$.fragment),l=mt(),u&&u.c(),c=mt(),d.c(),et(i,"class","wa-title"),et(s,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","chapter-controls"),be(t,"margin-top","18px")},m(h,_){gt(h,t,_),rt(t,e),rt(e,n),rt(n,i),rt(n,a),rt(n,s),ut(o,s,null),rt(t,l),u&&u.m(t,null),rt(t,c),p[f].m(t,null),w=!0},p(h,_){const y={};_[0]&32768&&(y.clickHandler=h[50]),_[2]&256&&(y.$$scope={dirty:_,ctx:h}),o.$set(y),h[15]?u?(u.p(h,_),_[0]&32768&&K(u,1)):(u=Pr(h),u.c(),K(u,1),u.m(t,c)):u&&(Vt(),Q(u,1,1,()=>{u=null}),Zt());let $=f;f=b(h),f===$?p[f].p(h,_):(Vt(),Q(p[$],1,1,()=>{p[$]=null}),Zt(),d=p[f],d?d.p(h,_):(d=p[f]=g[f](h),d.c()),K(d,1),d.m(t,null))},i(h){w||(K(o.$$.fragment,h),K(u),K(d),w=!0)},o(h){Q(o.$$.fragment,h),Q(u),Q(d),w=!1},d(h){h&&pt(t),dt(o),u&&u.d(),p[f].d()}}}function Fo(r){let t;return{c(){t=Rt("New Chapter")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Pr(r){let t,e,n,i,a,s,o,l,c;return i=new we({props:{clickHandler:r[52],variant:"primary",$$slots:{default:[Eo]},$$scope:{ctx:r}}}),s=new we({props:{clickHandler:r[53],$$slots:{default:[xo]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("input"),n=mt(),ht(i.$$.fragment),a=mt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Chapter name"),et(t,"class","create-inline wa-row")},m(f,d){gt(f,t,d),rt(t,e),dn(e,r[16]),rt(t,n),ut(i,t,null),rt(t,a),ut(s,t,null),o=!0,l||(c=fe(e,"input",r[51]),l=!0)},p(f,d){d[0]&65536&&e.value!==f[16]&&dn(e,f[16]);const w={};d[0]&229393&&(w.clickHandler=f[52]),d[2]&256&&(w.$$scope={dirty:d,ctx:f}),i.$set(w);const u={};d[0]&229376&&(u.clickHandler=f[53]),d[2]&256&&(u.$$scope={dirty:d,ctx:f}),s.$set(u)},i(f){o||(K(i.$$.fragment,f),K(s.$$.fragment,f),o=!0)},o(f){Q(i.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&pt(t),dt(i),dt(s),l=!1,c()}}}function Eo(r){let t;return{c(){t=Rt("Create")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function xo(r){let t;return{c(){t=Rt("Cancel")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Po(r){let t,e=[],n=new Map,i,a=ve(r[13]);const s=o=>o[64].chapterName;for(let o=0;o<a.length;o+=1){let l=wr(r,a,o),c=s(l);n.set(c,e[o]=Dr(c,l))}return{c(){t=ct("div");for(let o=0;o<e.length;o+=1)e[o].c();et(t,"class","wa-draft-list")},m(o,l){gt(o,t,l);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);i=!0},p(o,l){if(l[0]&1610620928|l[1]&7){a=ve(o[13]),Vt();for(let c=0;c<e.length;c+=1)e[c].r();e=Gr(e,l,s,1,o,a,n,t,ka,Dr,null,wr);for(let c=0;c<e.length;c+=1)e[c].a();Zt()}},i(o){if(!i){for(let l=0;l<a.length;l+=1)K(e[l]);i=!0}},o(o){for(let l=0;l<e.length;l+=1)Q(e[l]);i=!1},d(o){o&&pt(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function Do(r){let t;return{c(){t=ct("div"),t.textContent="No chapters found.",be(t,"margin-top","1em")},m(e,n){gt(e,t,n)},p:Et,i:Et,o:Et,d(e){e&&pt(t)}}}function Ao(r){let t;return{c(){t=ct("div"),t.textContent="Loading chapters..."},m(e,n){gt(e,t,n)},p:Et,i:Et,o:Et,d(e){e&&pt(t)}}}function No(r){let t,e;return t=new di({}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function jo(r){let t,e;return t=new ui({}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function To(r){let t,e;return t=new hi({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Oo(r){let t,e;return t=new pi({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Bo(r){let t,e;return t=new gi({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,i){ut(t,n,i),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Dr(r,t){let e,n,i=t[64].chapterName+"",a,s,o,l,c,f,d,w,u,g,p,b,h,_,y=Et,$;function k(){return t[54](t[66])}l=new we({props:{title:"Move chapter up",clickHandler:k,disabled:t[66]===0,$$slots:{default:[No]},$$scope:{ctx:t}}});function P(){return t[55](t[66])}f=new we({props:{title:"Move chapter down",clickHandler:P,disabled:t[66]===t[13].length-1,$$slots:{default:[jo]},$$scope:{ctx:t}}});function D(){return t[56](t[64])}w=new se({props:{ariaLabel:"Open chapter",title:"Open chapter",clickHandler:D,$$slots:{default:[To]},$$scope:{ctx:t}}});function z(){return t[57](t[64])}g=new se({props:{ariaLabel:"Rename chapter",title:"Rename chapter",clickHandler:z,$$slots:{default:[Oo]},$$scope:{ctx:t}}});function A(){return t[58](t[64])}return b=new se({props:{ariaLabel:"Delete chapter",title:"Delete chapter",clickHandler:A,$$slots:{default:[Bo]},$$scope:{ctx:t}}}),{key:r,first:null,c(){e=ct("div"),n=ct("div"),a=Rt(i),s=mt(),o=ct("div"),ht(l.$$.fragment),c=mt(),ht(f.$$.fragment),d=mt(),ht(w.$$.fragment),u=mt(),ht(g.$$.fragment),p=mt(),ht(b.$$.fragment),h=mt(),et(n,"class","wa-draft-name"),et(o,"class","wa-draft-actions"),et(e,"class","wa-draft-item"),this.first=e},m(j,q){gt(j,e,q),rt(e,n),rt(n,a),rt(e,s),rt(e,o),ut(l,o,null),rt(o,c),ut(f,o,null),rt(o,d),ut(w,o,null),rt(o,u),ut(g,o,null),rt(o,p),ut(b,o,null),rt(e,h),$=!0},p(j,q){t=j,(!$||q[0]&8192)&&i!==(i=t[64].chapterName+"")&&We(a,i);const F={};q[0]&8192&&(F.clickHandler=k),q[0]&8192&&(F.disabled=t[66]===0),q[2]&256&&(F.$$scope={dirty:q,ctx:t}),l.$set(F);const R={};q[0]&8192&&(R.clickHandler=P),q[0]&8192&&(R.disabled=t[66]===t[13].length-1),q[2]&256&&(R.$$scope={dirty:q,ctx:t}),f.$set(R);const v={};q[0]&8192&&(v.clickHandler=D),q[2]&256&&(v.$$scope={dirty:q,ctx:t}),w.$set(v);const W={};q[0]&8192&&(W.clickHandler=z),q[2]&256&&(W.$$scope={dirty:q,ctx:t}),g.$set(W);const at={};q[0]&8192&&(at.clickHandler=A),q[2]&256&&(at.$$scope={dirty:q,ctx:t}),b.$set(at)},r(){_=e.getBoundingClientRect()},f(){da(e),y()},a(){y(),y=ua(e,_,so,{duration:500,easing:wi})},i(j){$||(K(l.$$.fragment,j),K(f.$$.fragment,j),K(w.$$.fragment,j),K(g.$$.fragment,j),K(b.$$.fragment,j),$=!0)},o(j){Q(l.$$.fragment,j),Q(f.$$.fragment,j),Q(w.$$.fragment,j),Q(g.$$.fragment,j),Q(b.$$.fragment,j),$=!1},d(j){j&&pt(e),dt(l),dt(f),dt(w),dt(g),dt(b)}}}function Ro(r){var y;let t,e,n,i,a,s,o,l,c,f,d,w,u,g;s=new se({props:{ariaLabel:"Refresh projects",clickHandler:r[40],title:void 0,spinning:r[6],$$slots:{default:[uo]},$$scope:{ctx:r}}}),c=new we({props:{clickHandler:r[35],variant:"primary",style:"width: 40%; margin: 0 auto;",$$slots:{default:[ho]},$$scope:{ctx:r}}});let p=r[2].length===0&&br(),b=r[2].length>0&&vr(r),h=r[4]&&yr(r),_=r[4]&&((y=r[0])==null?void 0:y.activeDraft)&&r[18]&&xr(r);return{c(){t=ct("div"),e=ct("div"),n=ct("div"),n.textContent=`${Ft} Projects`,i=mt(),a=ct("div"),ht(s.$$.fragment),o=mt(),l=ct("div"),ht(c.$$.fragment),f=mt(),p&&p.c(),d=mt(),b&&b.c(),w=mt(),h&&h.c(),u=mt(),_&&_.c(),et(n,"class","wa-title"),et(e,"class","wa-row justify-between"),et(l,"class","wa-row"),be(l,"margin","18px 0 10px 0"),et(t,"class","project-list wa-panel")},m($,k){gt($,t,k),rt(t,e),rt(e,n),rt(e,i),rt(e,a),ut(s,a,null),rt(t,o),rt(t,l),ut(c,l,null),rt(t,f),p&&p.m(t,null),rt(t,d),b&&b.m(t,null),rt(t,w),h&&h.m(t,null),rt(t,u),_&&_.m(t,null),g=!0},p($,k){var z;const P={};k[0]&64&&(P.spinning=$[6]),k[2]&256&&(P.$$scope={dirty:k,ctx:$}),s.$set(P);const D={};k[2]&256&&(D.$$scope={dirty:k,ctx:$}),c.$set(D),$[2].length===0?p||(p=br(),p.c(),p.m(t,d)):p&&(p.d(1),p=null),$[2].length>0?b?(b.p($,k),k[0]&4&&K(b,1)):(b=vr($),b.c(),K(b,1),b.m(t,w)):b&&(Vt(),Q(b,1,1,()=>{b=null}),Zt()),$[4]?h?(h.p($,k),k[0]&16&&K(h,1)):(h=yr($),h.c(),K(h,1),h.m(t,u)):h&&(Vt(),Q(h,1,1,()=>{h=null}),Zt()),$[4]&&((z=$[0])!=null&&z.activeDraft)&&$[18]?_?(_.p($,k),k[0]&262161&&K(_,1)):(_=xr($),_.c(),K(_,1),_.m(t,null)):_&&(Vt(),Q(_,1,1,()=>{_=null}),Zt())},i($){g||(K(s.$$.fragment,$),K(c.$$.fragment,$),K(b),K(h),K(_),g=!0)},o($){Q(s.$$.fragment,$),Q(c.$$.fragment,$),Q(b),Q(h),Q(_),g=!1},d($){$&&pt(t),dt(s),dt(c),p&&p.d(),b&&b.d(),h&&h.d(),_&&_.d()}}}let zo=!1,Io="";const Se=20;let Lo=null;function Mo(r,t,e){let{manager:n}=t,{projectService:i}=t,{projectFileService:a}=t,s=null,o=[],l,c=null,f=[],d=!1,w=[],u=!1,g=!1,p="",b=!0,h=null,_=null,y=[],$=!1,k=!1,P="",D="",z=!1,A=!1;Nn(()=>{try{n&&_&&n.removeActiveProjectListener(_)}catch{}});async function j(B=!1){if(!i)return[];e(6,d=!0);const nt=new Promise(vt=>setTimeout(vt,400)),st=[...o],kt=s;let Bt=[],$t=[];try{Bt=i.listAllFolders(),$t=[];for(const vt of Bt)await i.isProjectFolder(vt)&&$t.push(vt)}catch{$t=[]}const Mt=$t.filter(vt=>!st.includes(vt)),St=st.filter(vt=>!$t.includes(vt));if(B&&Mt.length>0&&new x.Notice(`${Mt.length} new project${Mt.length>1?"s":""} discovered.`),B&&St.length>0&&new x.Notice(`${St.length} project${St.length>1?"s":""} removed.`),e(2,o=$t),e(7,w=$t.map(vt=>({value:vt,label:vt}))),$t.length===0)e(1,s=null),e(3,l=void 0),e(4,c=null);else if($t.length===1){e(1,s=$t[0]),e(3,l=w[0]),e(4,c=$t[0]);try{U(`${M} panel refresh selected single project '${c}'`)}catch{}}else if(kt&&!$t.includes(kt)){e(1,s=$t[0]),e(3,l=w[0]),e(4,c=$t[0]);try{U(`${M} panel refresh selected fallback project '${c}'`)}catch{}}else{const vt=w.find(me=>me.value===kt);if(vt){e(1,s=kt),e(3,l=vt),e(4,c=vt.value);try{U(`${M} panel refresh kept project '${c}'`)}catch{}}else e(1,s=null),e(3,l=void 0),e(4,c=null)}return await nt,e(6,d=!1),c&&await q(),$t}async function q(){if(!a||!c){e(5,f=[]);return}e(8,u=!0);const B=new Promise(nt=>setTimeout(nt,400));try{e(5,f=a.drafts.listDrafts(c)||[]),e(5,f=Array.from(f)),f.sort((nt,st)=>nt>st?1:nt<st?-1:0),b||f.reverse()}catch{e(5,f=[])}finally{await B,e(8,u=!1)}}async function F(){if(!n||!a)return;e(14,$=!0);const B=new Promise(nt=>setTimeout(nt,400));try{if(!c){e(13,y=[]),e(18,z=!1);return}const nt=`${c}/${ae(n==null?void 0:n.settings)}`,st=await Pe(n.app,nt);if(e(18,z=(st==null?void 0:st.project_type)==="multi-file"),!z){e(13,y=[]);return}if(!(n!=null&&n.activeDraft)){e(13,y=[]);return}let kt=[];kt=await a.chapters.listChapters(c,n.activeDraft),e(13,y=Array.isArray(kt)?kt:[])}catch{e(13,y=[]),e(18,z=!1)}finally{await B,e(14,$=!1)}}async function R(){if(!(!a||!c||!p.trim())){try{await a.drafts.createDraft(p.trim(),Io||void 0,c)}catch{}e(10,p=""),e(9,g=!1),await q()}}async function v(){e(9,g=!0)}async function W(B){if(!a||!n||!c)return;let nt=!1;nt=await a.drafts.openDraft(c,B),nt||n!=null&&n.setActiveDraft&&await n.setActiveDraft(B,c),await q(),await F()}async function at(B){if(!n||!c)return;const nt=`${B} Copy`;new io(n.app,{sourceDraftName:B,suggestedName:nt,onSubmit:async st=>{if(n)try{await n.createNewDraft(st,B,c||void 0),await q(),new x.Notice(`Draft '${st}' created as duplicate of '${B}'.`)}catch(kt){U(`${M} Failed to duplicate draft:`,kt),new x.Notice("Failed to duplicate draft.")}}}).open()}async function V(B){if(!n||!c)return;const nt=window!=null&&window.prompt?window.prompt(`Rename draft '${B}' to:`,B):null;if(nt)try{await n.renameDraft(B,nt,c,!1),await q()}catch{}}async function ot(B){if(!n||!c)return;new gr(n.app,B,async()=>{n&&(await n.deleteDraft(B,c||void 0),await q())},"draft").open()}async function G(B){B&&(n!=null&&n.setActiveProject&&await n.setActiveProject(B),e(1,s=B),e(4,c=B),e(12,h=(n==null?void 0:n.activeDraft)??null),await q(),await F())}async function ft(B){if(B===0||!n||!c||!n.activeDraft)return;const nt=y.slice();[nt[B-1],nt[B]]=[nt[B],nt[B-1]];const st=nt.map((kt,Bt)=>({chapterName:kt.chapterName||"",order:Bt+1}));await n.reorderChapters(c,n.activeDraft,st),await F()}async function O(B){if(B===y.length-1||!n||!c||!n.activeDraft)return;const nt=y.slice();[nt[B],nt[B+1]]=[nt[B+1],nt[B]];const st=nt.map((kt,Bt)=>({chapterName:kt.chapterName||"",order:Bt+1}));await n.reorderChapters(c,n.activeDraft,st),await F()}async function T(B){!c||!(n!=null&&n.activeDraft)||await n.openChapter(c,n.activeDraft,B)}function lt(B){if(!c||!(n!=null&&n.activeDraft))return;new ao(n.app,B,async st=>{!(n!=null&&n.activeDraft)||!c||(await n.renameChapter(c,n.activeDraft,B,st),await F())}).open()}function L(B){new gr(n.app,B,async()=>{!(n!=null&&n.activeDraft)||!c||(await n.deleteChapter(c,n.activeDraft,B),await F())},"chapter").open()}async function X(B){c&&(n!=null&&n.setActiveDraft&&await n.setActiveDraft(B,c),e(12,h=(n==null?void 0:n.activeDraft)??null),await q(),await F())}async function Ct(){if(!n||!i)return;const B=n.app,{CreateProjectModal:nt}=await Promise.resolve().then(()=>Yo);let st=null;new nt(B,async(Bt,$t,Mt)=>{if(!Bt||!n||!i||(st=await i.createProject(Bt,$t,Mt,void 0,n.settings),!st))return;let St=[],vt=null;for(let me=0;me<20;me++){await new Promise(De=>setTimeout(De,100)),St=await j();const Qt=St.find(De=>De===st);if(vt=typeof Qt=="string"?Qt:null,vt)break}typeof vt=="string"&&vt&&(e(1,s=vt),e(3,l={value:vt,label:vt}),e(4,c=vt),n.setActiveDraft?await n.setActiveDraft(vt,Mt):e(0,n.activeDraft=Mt??null,n),await q(),await F())}).open()}Nn(()=>{try{n&&n.removeActiveDraftListener}catch{}try{n&&typeof n.removeActiveProjectListener=="function"&&_&&n.removeActiveProjectListener(_)}catch{}});const At=()=>j(!0),wt=B=>{const nt=B.detail;e(3,l=nt),e(4,c=typeof nt=="string"?nt:nt?nt.value:void 0),e(1,s=c??null),G(c??null)},yt=()=>{e(11,b=!b),q()};function Nt(){p=this.value,e(10,p)}const xt=()=>{e(9,g=!1),e(10,p="")},Jt=B=>W(B),Lt=B=>X(B),m=B=>V(B),H=B=>at(B),I=B=>ot(B),C=()=>e(15,k=!k);function S(){P=this.value,e(16,P)}const E=async()=>{!c||!(n!=null&&n.activeDraft)||!P.trim()||(await n.createChapter(c,n.activeDraft,P.trim()),e(16,P=""),e(17,D=""),e(15,k=!1),await F())},Z=()=>{e(15,k=!1),e(16,P=""),e(17,D="")},Y=B=>ft(B),N=B=>O(B),J=B=>T(B.chapterName||""),it=B=>lt(B.chapterName||""),tt=B=>L(B.chapterName||"");return r.$$set=B=>{"manager"in B&&e(0,n=B.manager),"projectService"in B&&e(36,i=B.projectService),"projectFileService"in B&&e(37,a=B.projectFileService)},r.$$.update=()=>{if(r.$$.dirty[0]&1|r.$$.dirty[1]&480&&n&&i&&a&&!A){e(39,A=!0),U(`${M} ProjectPanel initializing with manager`),e(12,h=n.activeDraft??null),e(1,s=n.activeProject??null);const B=nt=>{e(12,h=nt),U(`${M} active draft updated -> ${nt}`)};n.addActiveDraftListener(B),e(38,_=nt=>{e(1,s=nt),U(`${M} active project updated -> ${nt}`)}),n.addActiveProjectListener(_),j()}},[n,s,o,l,c,f,d,w,u,g,p,b,h,y,$,k,P,D,z,j,q,F,R,v,W,at,V,ot,G,ft,O,T,lt,L,X,Ct,i,a,_,A,At,wt,yt,Nt,xt,Jt,Lt,m,H,I,C,S,E,Z,Y,N,J,it,tt]}class Uo extends It{constructor(t){super(),zt(this,t,Mo,Ro,Ot,{manager:0,projectService:36,projectFileService:37},null,[-1,-1,-1])}}const _e="writeaid-project-panel";class Wo extends x.ItemView{constructor(t,e,n){super(t),this.panelEl=null,this.selectedProject=null,this.app=e,this.manager=n,this.projectService=new fn(e),this.projectFileService=new Ln(e,this.projectService)}getViewType(){return _e}getDisplayText(){return`${Ft} Projects`}getIcon(){return Rn}async onOpen(){this.panelEl=this.contentEl.createEl("div",{cls:"writeaid-project-panel"});try{if(!this.manager){U(`${M} Manager not available in ProjectPanelView.onOpen`),new x.Notice(`${Ft}: manager not available, cannot mount project panel.`);return}U(`${M} Mounting ProjectPanel with manager:`,!!this.manager),this.projectPanel=new Uo({target:this.panelEl,props:{manager:this.manager,projectService:this.projectService,projectFileService:this.projectFileService}}),U(`${M} ProjectPanel mounted successfully`)}catch(t){U(`${M} failed to mount project panel:`,t),new x.Notice(`${Ft}: failed to mount project panel. Check console for details.`)}}async onClose(){if(this.projectPanel){try{this.projectPanel.$destroy()}catch(t){U(`${M} Error destroying project panel:`,t)}this.projectPanel=void 0}}}function Ho(r,t){return()=>{const e={type:_e,active:!0},n=t.workspace.getLeavesOfType(_e);if(n.length>0){const i=n[0];t.workspace.revealLeaf(i)}else{let i=t.workspace.getRightLeaf(!1);i||(i=t.workspace.getRightLeaf(!0)),i.setViewState(e),t.workspace.revealLeaf(i)}}}function Vo(r){return()=>r.updateProjectMetadataPrompt()}class Zo extends x.Modal{constructor(t,e,n,i){super(t),this.path=e,this.onCreateAnyway=n,this.onOpenExisting=i}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project already exists"}),t.createEl("p",{text:`A folder named '${this.path}' already exists in the vault.`}),new x.Setting(t).addButton(e=>e.setButtonText("Open Existing").onClick(()=>{this.close(),this.onOpenExisting()})),new x.Setting(t).addButton(e=>e.setButtonText("Create Anyway").setCta().onClick(()=>{this.close(),this.onCreateAnyway(!0)})),new x.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}onClose(){this.contentEl.empty()}}class Go extends x.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Draft"});const e=this.props.suggestedName;let n="",i="";new x.Setting(t).setName("Draft name").addText(s=>s.setPlaceholder(e).onChange(o=>n=o));const a=this.props.drafts;a.length>0&&new x.Setting(t).setName("Copy from existing draft").addDropdown(s=>{s.addOption("","Start blank");for(const o of a)s.addOption(o,o);s.onChange(o=>i=o)}),new x.Setting(t).addButton(s=>s.setButtonText("Create").setCta().onClick(()=>{this.close();const o=n&&n.trim()?n.trim():e;this.props.onSubmit(o,i||void 0)}))}onClose(){this.contentEl.empty()}}class _i extends x.Modal{constructor(t,e){super(t),this.onSubmit=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Project"});let e="",n=!0,i="Draft 1";new x.Setting(t).setName("Project folder name").addText(a=>a.onChange(s=>e=s)),new x.Setting(t).setName("Project type").addDropdown(a=>{a.addOption("single","Single-file project"),a.addOption("multi","Multi-file project (chapters)"),a.onChange(s=>n=s==="single")}),new x.Setting(t).setName("Initial draft name (optional)").addText(a=>a.setPlaceholder("Draft 1").onChange(s=>i=s||"Draft 1")),new x.Setting(t).addButton(a=>a.setButtonText("Create Project").setCta().onClick(()=>{this.close(),this.onSubmit(e,n,i||void 0)}))}onClose(){this.contentEl.empty()}}const Yo=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectModal:_i},Symbol.toStringTag,{value:"Module"}));class Ar extends x.Modal{constructor(t,e,n){super(t),this.projectPath=e,this.onOpenProject=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project created"}),t.createEl("p",{text:`Project '${this.projectPath}' was created.`}),new x.Setting(t).addButton(e=>e.setButtonText("Open Project").setCta().onClick(async()=>{this.close(),this.onOpenProject&&await this.onOpenProject()})),new x.Setting(t).addButton(e=>e.setButtonText("Close").onClick(()=>this.close()))}onClose(){this.contentEl.empty()}}class En extends x.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Select Project for Draft"});let e="";const n=this.props.folders||[];new x.Setting(t).setName("Project folder").addDropdown(i=>{i.addOption("","(Vault root)");for(const a of n)i.addOption(a,a||"(Vault root)");i.onChange(a=>e=a)}),new x.Setting(t).addButton(i=>i.setButtonText("Select").setCta().onClick(()=>{this.close(),this.props.onSubmit(e||"")}))}onClose(){this.contentEl.empty()}}class Ko extends x.Modal{constructor(t,e,n){super(t),this.drafts=e,this.onSubmit=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Switch Active Draft"});for(const e of this.drafts)new x.Setting(t).setName(e).addButton(n=>n.setButtonText("Select").onClick(()=>{this.close(),this.onSubmit(e)}))}onClose(){this.contentEl.empty()}}class qo{constructor(t,e,n){var i;this.activeDraft=null,this.activeProject=null,this.activeProjectListeners=[],this.activeDraftListeners=[],this.panelRefreshListeners=[],this._panelRefreshTimer=null,this._panelRefreshDebounceMs=250,this.app=t,this.plugin=e,this.settings=e==null?void 0:e.settings,typeof n=="number"&&Number.isFinite(n)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(n))),this.activeProject=((i=this.settings)==null?void 0:i.activeProject)||null,this.projectService=new fn(t),this.projectFileService=new Ln(t,this.projectService,this.settings)}async reorderChapters(t,e,n){return await this.projectFileService.chapters.reorderChapters(t,e,n)}async listChapters(t,e){return await this.projectFileService.chapters.listChapters(t,e)}async createChapter(t,e,n){return await this.projectFileService.chapters.createChapter(t,e,n,this.settings)}async deleteChapter(t,e,n){return await this.projectFileService.chapters.deleteChapter(t,e,n)}async renameChapter(t,e,n,i){return await this.projectFileService.chapters.renameChapter(t,e,n,i)}async openChapter(t,e,n){return await this.projectFileService.chapters.openChapter(t,e,n)}get panelRefreshDebounceMs(){return this._panelRefreshDebounceMs}set panelRefreshDebounceMs(t){typeof t=="number"&&Number.isFinite(t)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(t)))}addActiveProjectListener(t){this.activeProjectListeners.push(t)}addActiveDraftListener(t){this.activeDraftListeners.push(t)}removeActiveDraftListener(t){this.activeDraftListeners=this.activeDraftListeners.filter(e=>e!==t)}notifyActiveDraftListeners(t){for(const e of this.activeDraftListeners)Ut(()=>e(t))}addPanelRefreshListener(t){this.panelRefreshListeners.push(t)}removePanelRefreshListener(t){this.panelRefreshListeners=this.panelRefreshListeners.filter(e=>e!==t)}notifyPanelRefresh(){try{this._panelRefreshTimer&&clearTimeout(this._panelRefreshTimer),this._panelRefreshTimer=setTimeout(()=>{for(const t of this.panelRefreshListeners)Ut(()=>t());this._panelRefreshTimer=null},this._panelRefreshDebounceMs)}catch{for(const t of this.panelRefreshListeners)Ut(()=>t())}}removeActiveProjectListener(t){this.activeProjectListeners=this.activeProjectListeners.filter(e=>e!==t)}async setActiveProject(t){t&&(t=t.trim().replace(/^\/+/,"").replace(/\/+$/,"")),U(`${M} setActiveProject called with '${t}'`),this.activeProject=t,await Tt(async()=>{if(this.plugin){const e=this.plugin;e.settings||(e.settings={}),e.settings.activeProject=t??void 0,typeof e.saveSettings=="function"&&await e.saveSettings()}});for(const e of this.activeProjectListeners)Ut(()=>e(t));try{if(!t){this.activeDraft=null,this.notifyActiveDraftListeners(null);return}const e=this.listDrafts(t);if(!e||e.length===0){this.activeDraft=null;return}if(e.length===1){await this.setActiveDraft(e[0],t,!1),U(`${M} auto-selected single draft '${e[0]}' for project '${t}'`);return}await Tt(async()=>{const o=await Pe(this.app,`${t}/${ae(this.settings)}`);if(o&&o.current_active_draft&&e.includes(o.current_active_draft)){await this.setActiveDraft(o.current_active_draft,t,!1),U(`${M} auto-selected meta draft '${o.current_active_draft}' for project '${t}'`);return}});let n=null,i=0;const a=this.app.vault.getFiles(),s=jt(this.settings);for(const o of e){const l=`${t}/${s}/${o}/`;let c=0;for(const f of a)if(f.path.startsWith(l)){const d=f.stat&&typeof f.stat.mtime=="number"?f.stat.mtime:0;d>c&&(c=d)}c>i&&(i=c,n=o)}n||(n=e[0]),U(`${M} auto-selected draft '${n}' for project '${t}'`),await this.setActiveDraft(n,t,!1)}catch{}}async createNewProjectPrompt(){new _i(this.app,async(t,e,n,i)=>{if(!t){new x.Notice("Project name is required.");return}const a=i&&i!==""?`${i}/${t}`:t;this.app.vault.getAbstractFileByPath(a)?new Zo(this.app,a,async o=>{o&&(await this.createNewProject(t,e,n,i),new Ar(this.app,a,async()=>await this.openProject(a)).open())},async()=>{await this.openProject(a)}).open():(await this.createNewProject(t,e,n,i),new Ar(this.app,a,async()=>await this.openProject(a)).open())}).open()}async openProject(t){return await this.projectService.openProject(t)}async createNewProject(t,e,n,i){const a=await this.projectService.createProject(t,e,n,i,this.settings);if(a){await this.setActiveProject(a);const s=n||"Draft 1";await this.setActiveDraft(s,a),Ut(()=>this.notifyPanelRefresh())}return a}listAllFolders(){return this.projectService.listAllFolders()}async createNewDraftPrompt(){const t=this.listAllFolders(),e=await Be(t,n=>this.projectService.isProjectFolder(n));new En(this.app,{folders:e,onSubmit:async n=>{const i=await this.suggestNextDraftName(n);new Go(this.app,{suggestedName:i,drafts:this.listDrafts(n),projectPath:n,onSubmit:async(a,s)=>{await this.projectFileService.drafts.createDraft(a,s,n,this.settings),new x.Notice(`Draft "${a}" created in ${n}.`)}}).open()}}).open()}async switchDraftPrompt(){const t=this.listDrafts();if(t.length===0){new x.Notice("No drafts found in the current project.");return}new Ko(this.app,t,async e=>{this.activeDraft=e,new x.Notice(`Switched to draft: ${e}`);const n=this.getCurrentProjectPath();n&&await Oe(this.app,n,e,void 0,this.settings)}).open()}async updateProjectMetadataPrompt(){if(this.activeProject){await Oe(this.app,this.activeProject,void 0,void 0,this.settings),new x.Notice(`Metadata updated for ${this.activeProject}`);return}(async()=>{const t=this.listAllFolders(),e=await Be(t,n=>this.projectService.isProjectFolder(n));new En(this.app,{folders:e,onSubmit:async n=>{await Oe(this.app,n,void 0,void 0,this.settings),new x.Notice(`Metadata updated for ${n}`)}}).open()})()}async selectActiveProjectPrompt(){const t=this.listAllFolders(),e=await Be(t,n=>this.projectService.isProjectFolder(n));if(e.length===0){new x.Notice(`No ${Ft} projects found in the vault.`);return}new En(this.app,{folders:e,onSubmit:async n=>{await this.setActiveProject(n),new x.Notice(`Active project set to ${n}`)}}).open()}async createNewDraft(t,e,n){const i=await this.projectFileService.drafts.createDraft(t,e,n,this.settings);return Ut(()=>this.notifyPanelRefresh()),i}listDrafts(t){return this.projectFileService.drafts.listDrafts(t)}async setActiveDraft(t,e,n=!0){const i=e||this.activeProject||this.getCurrentProjectPath();return i?(this.activeDraft=t,await Tt(async()=>{await Oe(this.app,i,t,void 0,this.settings)}),this.notifyActiveDraftListeners(this.activeDraft),n&&new x.Notice(`Active draft set to ${t}`),!0):(n&&new x.Notice("No project selected to set active draft on."),!1)}async renameDraft(t,e,n,i=!1){const a=n||this.activeProject||this.getCurrentProjectPath();if(!a)return new x.Notice("No project selected to rename draft."),!1;const s=this.activeDraft===t;return await this.projectFileService.drafts.renameDraft(a,t,e,i,this.settings)?(s&&(this.activeDraft=e),new x.Notice(`Renamed draft ${t} → ${e}`),!0):(new x.Notice("Failed to rename draft."),!1)}async deleteDraft(t,e,n=!0){const i=e||this.activeProject||this.getCurrentProjectPath();if(!i)return new x.Notice("No project selected to delete draft."),!1;if(await this.projectFileService.drafts.deleteDraft(i,t,n)){new x.Notice(`Deleted draft ${t}`);const s=this.listDrafts(i);if(s.length>0){if(this.activeDraft===t||!this.activeDraft){let o;if(s.length===1)o=s[0];else{const l=[...s].sort((c,f)=>c.localeCompare(f));if(this.activeDraft===t){const c=l.findIndex(f=>f===t);if(c!==-1){const f=c<l.length-1?c:0;o=l[f]}else o=l[0]}else o=this.activeDraft}await this.setActiveDraft(o,i,!1)}}else this.activeDraft=null,this.notifyActiveDraftListeners(null);return!0}return new x.Notice("Failed to delete draft."),!1}async suggestNextDraftName(t){return await this.projectFileService.drafts.suggestNextDraftName(t)}getCurrentProjectPath(){const t=this.app.workspace.getActiveFile();if(!t)return null;const e=t.parent;return e?e.path:null}}class Xo extends x.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,U(`${M} Settings tab created`),typeof e.registerSettingsChangedCallback=="function"&&e.registerSettingsChangedCallback(()=>{U(`${M} Settings changed externally, refreshing UI`),this.containerEl&&this.containerEl.parentElement&&this.display()})}display(){const{containerEl:t}=this;t.empty(),t.createEl("h2",{text:`${Ft} Settings`}),U(`${M} Displaying settings UI`);const e=this.plugin;t.createEl("h3",{text:"Templates"}),new x.Setting(t).setName("Include outline file on draft creation").setDesc("If enabled, each new draft will include an outline file using the outline template.").addToggle(o=>o.setValue(!!e.settings.includeDraftOutline).onChange(l=>{U(`${M} Include draft outline changed: ${l}`),e.settings.includeDraftOutline=l,e.saveSettings()})),new x.Setting(t).setName("Outline template").setDesc("Template for outline files. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{U(`${M} Opening file picker for outline template`),new xn(this.app,l=>{U(`${M} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new x.Setting(t).setName("Outline template").setDesc("Template for outline documents. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{U(`${M} Opening file picker for outline template`),new xn(this.app,l=>{U(`${M} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new x.Setting(t).setName("Chapter template").setDesc("Template for newly created chapter files. Use {{chapterTitle}}").addTextArea(o=>{o.setValue(e.settings.chapterTemplate||""),o.inputEl.setAttribute("data-setting","chapter")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{U(`${M} Opening file picker for chapter template`),new xn(this.app,l=>{U(`${M} Chapter template selected: ${l}`),e.settings.chapterTemplate=l,this.display()}).open()})),new x.Setting(t).setName("Manuscript name template").setDesc("Template for manuscript filenames. Use {{draftName}}, {{projectName}}, and moment.js date qualifiers like {{YYYY-MM-DD}}").addText(o=>{o.setValue(e.settings.manuscriptNameTemplate||"{{draftName}}"),o.inputEl.setAttribute("data-setting","manuscript")}),new x.Setting(t).addButton(o=>o.setButtonText("Save Templates").setCta().onClick(async()=>{var d,w;U(`${M} Save Templates button clicked`);const l=t.querySelector('textarea[data-setting="outline"]'),c=t.querySelector('textarea[data-setting="chapter"]'),f=t.querySelector('input[data-setting="manuscript"]');U(`${M} Found inputs - outline: ${!!l}, chapter: ${!!c}, manuscript: ${!!f}`),U(`${M} Manuscript input value: "${f==null?void 0:f.value}"`),l&&(e.settings.outlineTemplate=l.value),c&&(e.settings.chapterTemplate=c.value),f&&(e.settings.manuscriptNameTemplate=f.value),U(`${M} Saving templates: outline=${(d=e.settings.outlineTemplate)==null?void 0:d.substring(0,50)}..., chapter=${(w=e.settings.chapterTemplate)==null?void 0:w.substring(0,50)}..., manuscript=${e.settings.manuscriptNameTemplate}`),await e.saveSettings(),new x.Notice("Templates saved successfully!")})),t.createEl("h3",{text:"Filenames"}),new x.Setting(t).setName("Draft filename slug style").setDesc("How per-draft main filenames are generated").addDropdown(o=>{o.addOption("compact","compact (draft1)"),o.addOption("kebab","kebab (draft-1)"),o.setValue(e.settings.slugStyle||"compact"),o.onChange(l=>{U(`${M} Slug style changed: ${l}`),e.settings.slugStyle=l,e.saveSettings();const c=t.querySelector(".wat-slug-preview");c&&(c.textContent=`Example: Draft 1 → ${ee("Draft 1",l)}${bt}`)})});let n="Draft 1";new x.Setting(t).setName("Sample draft name").setDesc("Type a sample draft name to preview the generated filename").addText(o=>o.setPlaceholder("Draft 1").setValue(n).onChange(l=>{n=l||"Draft 1";const c=t.querySelector(".wat-slug-preview");if(c){const f=ee(n,e.settings.slugStyle);c.textContent=`Example: ${n} → ${f}${bt}`}}));const i=t.createDiv({cls:"wat-slug-preview"}),a=ee(n,e.settings.slugStyle);i.setText(`Example: ${n} → ${a}${bt}`),t.createEl("h3",{text:"Folders & Files"}),new x.Setting(t).setName("Drafts folder name").setDesc("Name of the folder containing draft subfolders (default: drafts)").addText(o=>o.setValue(e.settings.draftsFolderName||"drafts").onChange(l=>{U(`${M} Drafts folder name changed: ${l}`),e.settings.draftsFolderName=l||"drafts",e.saveSettings()})),new x.Setting(t).setName("Manuscripts folder name").setDesc("Name of the folder containing generated manuscripts (default: manuscripts)").addText(o=>o.setValue(e.settings.manuscriptsFolderName||"manuscripts").onChange(l=>{U(`${M} Manuscripts folder name changed: ${l}`),e.settings.manuscriptsFolderName=l||"manuscripts",e.saveSettings()})),new x.Setting(t).setName("Backups folder name").setDesc("Name of the folder containing draft backups (default: .writeaid-backups)").addText(o=>o.setValue(e.settings.backupsFolderName||".writeaid-backups").onChange(l=>{U(`${M} Backups folder name changed: ${l}`),e.settings.backupsFolderName=l||".writeaid-backups",e.saveSettings()})),new x.Setting(t).setName("Meta file name").setDesc(`Name of the project metadata file (default: ${ie.META})`).addText(o=>o.setValue(e.settings.metaFileName||ie.META).onChange(l=>{U(`${M} Meta file name changed: ${l}`),e.settings.metaFileName=l||ie.META,e.saveSettings()})),new x.Setting(t).setName("Outline file name").setDesc(`Name of the draft outline file (default: ${ie.OUTLINE})`).addText(o=>o.setValue(e.settings.outlineFileName||ie.OUTLINE).onChange(l=>{U(`${M} Outline file name changed: ${l}`),e.settings.outlineFileName=l||ie.OUTLINE,e.saveSettings()})),t.createEl("h3",{text:"Word Count Targets"}),new x.Setting(t).setName("Default target word count for multi-file projects").setDesc("Target word count automatically set for new multi-file projects (chapters)").addText(o=>o.setValue(String(e.settings.defaultMultiTargetWordCount??5e4)).setPlaceholder("50000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(U(`${M} Default multi-file target word count changed: ${c}`),e.settings.defaultMultiTargetWordCount=c,e.saveSettings())})),new x.Setting(t).setName(`Default target word count for ${Ht.SINGLE} projects`).setDesc(`Target word count automatically set for new ${Ht.SINGLE} projects`).addText(o=>o.setValue(String(e.settings.defaultSingleTargetWordCount??2e4)).setPlaceholder("20000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(U(`${M} Default ${Ht.SINGLE} target word count changed: ${c}`),e.settings.defaultSingleTargetWordCount=c,e.saveSettings())})),t.createEl("h3",{text:"Backup Settings"}),new x.Setting(t).setName("Maximum number of backups per draft").setDesc("Maximum number of backup files to keep per draft (default: 5)").addText(o=>o.setValue(String(e.settings.maxBackups??5)).setPlaceholder("5").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(U(`${M} Max backups changed: ${c}`),e.settings.maxBackups=c,e.saveSettings())})),new x.Setting(t).setName("Maximum backup age (days)").setDesc("Automatically delete backups older than this many days (default: 30)").addText(o=>o.setValue(String(e.settings.maxBackupAgeDays??30)).setPlaceholder("30").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(U(`${M} Max backup age changed: ${c}`),e.settings.maxBackupAgeDays=c,e.saveSettings())})),t.createEl("h3",{text:"UI & Startup"}),t.createEl("p",{text:"Most settings take effect immediately. Settings marked with ⚠️ require a plugin reload to take effect.",cls:"setting-item-description"}),new x.Setting(t).setName("Ribbon placement").setDesc(`Place the ${Ft} icon on the left or right ribbon`).addDropdown(o=>{o.addOption("left","Left"),o.addOption("right","Right"),o.setValue(e.settings.ribbonPlacement||"left"),o.onChange(l=>{U(`${M} Ribbon placement changed: ${l}`),e.settings.ribbonPlacement=l,e.saveSettings(),typeof this.plugin.moveRibbon=="function"&&(l==="left"||l==="right")&&this.plugin.moveRibbon(l),this.display()})}),new x.Setting(t).setName("Always show ribbon").setDesc(`If enabled, the ${Ft} ribbon icon will always be visible regardless of whether projects are detected`).addToggle(o=>o.setValue(!!e.settings.ribbonAlwaysShow).onChange(l=>{U(`${M} Always show ribbon changed: ${l}`),e.settings.ribbonAlwaysShow=l,e.saveSettings(),typeof this.plugin.refreshRibbonVisibility=="function"&&this.plugin.refreshRibbonVisibility()})),new x.Setting(t).setName("Auto-open project panel on startup").setDesc(`If enabled, the ${Ft} project panel will open on plugin load when an active project is saved. ⚠️ Requires plugin reload to take effect.`).addToggle(o=>o.setValue(!!e.settings.autoOpenPanelOnStartup).onChange(l=>{U(`${M} Auto-open panel on startup changed: ${l}`),e.settings.autoOpenPanelOnStartup=l,e.saveSettings()})),new x.Setting(t).setName("Auto-select persisted project on startup").setDesc("If enabled, the persisted active project will be selected as the plugin's active project on load without opening the panel. ⚠️ Requires plugin reload to take effect.").addToggle(o=>o.setValue(!!e.settings.autoSelectProjectOnStartup).onChange(l=>{U(`${M} Auto-select project on startup changed: ${l}`),e.settings.autoSelectProjectOnStartup=l,e.saveSettings()})),new x.Setting(t).setName(`Enable ${Ft} debug logs`).setDesc(`When enabled, ${Ft} will set window.__${Ft.toUpperCase()}__ to true to show verbose runtime logs useful during development.`).addToggle(o=>o.setValue(!!e.settings.debug).onChange(l=>{U(`${M} Debug logs setting changed: ${l}`),e.settings.debug=l,window.__WRITEAID_DEBUG__=!!l,e.saveSettings(),l?new x.Notice(`${Ft}: debug logs enabled — verbose logs will appear in the DevTools console.`):new x.Notice(`${Ft}: debug logs disabled.`)})),t.createEl("h3",{text:"Panel performance"}),new x.Setting(t).setName("Panel refresh debounce (ms)").setDesc("Debounce timeout (milliseconds) for side-panel refresh notifications. Lower values mean more frequent refreshes; 0 disables debouncing.").addText(o=>{const l=e.settings.panelRefreshDebounceMs,c=Number(l??Ge);o.setPlaceholder(String(Ge)),o.setValue(String(c));let f=null;const d=w=>{const u=Number(w);if(!Number.isFinite(u)||u<Ce){new x.Notice(`Please enter a valid number ≥ ${Ce}.`);return}const g=Math.min(Math.floor(u),Ze);U(`${M} Panel refresh debounce changed: ${g}ms`),e.settings.panelRefreshDebounceMs=g;try{const p=e.saveSettings();p&&typeof p.catch=="function"&&p.catch(()=>{})}catch{}this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=g),o.inputEl.value=String(g),f&&(f.value=String(g))};try{const w=o.inputEl;w.setAttribute("type","number"),w.setAttribute("min",String(Ce)),w.setAttribute("max",String(Ze)),w.setAttribute("step","50"),w.setAttribute("aria-label","Panel refresh debounce in milliseconds"),Ut(()=>{w.insertAdjacentHTML("afterend",'<span class="wa-unit">ms</span>')}),f=document.createElement("input"),f.type="range",f.min=String(Ce),f.max=String(Ze),f.step="50",f.value=String(c),f.className="wa-debounce-range",Ut(()=>{const u=w.nextSibling;u&&u.parentElement?u.insertAdjacentElement("afterend",f):w.insertAdjacentElement("afterend",f)}),o.onChange(u=>{const g=Number(u);d(g)}),f.addEventListener("input",u=>{const g=Number(u.target.value);o.inputEl.value=String(g),d(g)})}catch{o.onChange(w=>{const u=Number(w);if(!Number.isFinite(u)||u<Ce){new x.Notice(`Please enter a valid number ≥ ${Ce}.`);return}const g=Math.min(Math.floor(u),Ze);e.settings.panelRefreshDebounceMs=g,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=g)})}}).addButton(o=>o.setButtonText("Reset").setTooltip(`Reset to default (${Ge} ms)`).onClick(()=>{const l=Ge;e.settings.panelRefreshDebounceMs=l,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=l),this.display()}))}}class xn extends x.Modal{constructor(t,e){super(t),this.currentFolder=null,this.expanded={},this.onPick=e,U(`${M} FilePickerModal created`)}onOpen(){U(`${M} FilePickerModal opened`);const t=this.app.vault.getRoot();this.currentFolder=t,this.expanded={},this.render()}render(){const{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Select template file"}),!this.currentFolder)return;const e=this.currentFolder.path?this.currentFolder.path.split("/"):[],n=t.createDiv({cls:"wat-breadcrumbs"}),i=n.createEl("a",{text:"(Vault root)",href:"#"});i.onclick=c=>{c.preventDefault(),this.currentFolder=this.app.vault.getRoot(),this.render()};let a="";for(const c of e){a=a?`${a}/${c}`:c,n.createDiv({text:" / "});const f=n.createEl("a",{text:c,href:"#"}),d=a;f.onclick=w=>{w.preventDefault();const u=this.app.vault.getAbstractFileByPath(d);u&&u instanceof x.TFolder&&(this.currentFolder=u,this.render())}}const o=t.createDiv({cls:"wat-controls"}).createEl("button",{text:"Up"});o.onclick=c=>{var w;if(c.preventDefault(),!this.currentFolder)return;const f=((w=this.currentFolder.parent)==null?void 0:w.path)||"",d=f?this.app.vault.getAbstractFileByPath(f):this.app.vault.getRoot();d&&d instanceof x.TFolder&&(this.currentFolder=d,this.render())};const l=t.createDiv({cls:"wat-list"});for(const c of this.currentFolder.children)if(c instanceof x.TFolder){const f=l.createDiv({cls:"wat-row folder-row"}),d=f.createEl("button",{text:this.expanded[c.path]?"▾":"▸"});d.onclick=u=>{u.preventDefault(),this.expanded[c.path]=!this.expanded[c.path],this.render()};const w=f.createEl("a",{text:c.name,href:"#"});if(w.onclick=u=>{u.preventDefault(),this.currentFolder=c,this.render()},this.expanded[c.path]){const u=l.createDiv({cls:"wat-sub"});for(const g of c.children)if(g instanceof x.TFolder){const b=u.createDiv({cls:"wat-row sub-folder"}).createEl("a",{text:g.name,href:"#"});b.onclick=h=>{h.preventDefault(),this.currentFolder=g,this.render()}}else if(g instanceof x.TFile&&g.path.toLowerCase().endsWith(bt)){const b=u.createDiv({cls:"wat-row sub-file"}).createEl("a",{text:g.name,href:"#"});b.onclick=h=>{h.preventDefault(),U(`${M} File selected from file picker: ${g.path}`),this.close(),this.onPick(g.path)}}}}else if(c instanceof x.TFile&&c.path.toLowerCase().endsWith(bt)){const d=l.createDiv({cls:"wat-row file-row"}).createEl("a",{text:c.name,href:"#"});d.onclick=w=>{w.preventDefault(),U(`${M} File selected from file picker: ${c.path}`),this.close(),this.onPick(c.path)}}}onClose(){this.contentEl.empty()}}const Jo=".writeaid-ribbon{padding-left:6px}.writeaid-ribbon .wa-icon{display:inline-block;vertical-align:middle}.writeaid-ribbon .wa-icon svg{width:16px;height:16px;fill:currentColor;display:block}.view-content:has(.writeaid-project-panel){padding:0}.writeaid-project-panel{height:100%;display:flex;flex-direction:column}.create-inline{margin-top:8px;justify-content:center}.wa-panel.project-list{padding:1em;height:100%;border-radius:0}.wa-panel-header{display:flex;flex-direction:column}.wa-draft-item.active .wa-draft-name{font-weight:700;color:var(--color-accent, #3b82f6)}.wa-draft-active-indicator{color:var(--color-accent, #3b82f6);font-size:1em;vertical-align:middle}@keyframes spin{to{transform:rotate(360deg)}}:root{--wa-slider-track-height: 6px;--wa-slider-thumb-size: 12px;--wa-slider-accent: var(--interactive-accent, #7c5cff);--wa-slider-background: var(--background-modifier-host, #eee);--wa-slider-gap: 12px}.wa-debounce-range{margin-left:var(--wa-slider-gap);vertical-align:middle;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:var(--wa-slider-track-height);background:linear-gradient(90deg,var(--wa-slider-accent) 0%,var(--wa-slider-accent) 50%,var(--wa-slider-background) 50%,var(--wa-slider-background) 100%);border-radius:999px;outline:none}.wa-debounce-range::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);box-shadow:0 0 0 4px #0000000d;cursor:pointer}.wa-debounce-range::-moz-range-thumb{width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);cursor:pointer}.wa-unit{color:var(--text-muted, #666);margin-left:6px}.justify-between{justify-content:space-between}.wa-rename-info{margin-bottom:8px;color:var(--text-muted, #888);font-size:.95em}.wa-rename-label{display:block;font-weight:500;margin-bottom:4px;color:var(--text-normal, #222)}.wa-rename-input{width:100%;padding:7px 10px;font-size:1em;border:1px solid var(--background-modifier-border, #ccc);border-radius:5px;margin-bottom:10px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s}.wa-rename-input:focus{border-color:var(--interactive-accent, #7c5cff);outline:none}.wa-rename-checkbox-label{display:flex;align-items:center;gap:6px;margin-bottom:10px;font-size:.97em;color:var(--text-muted, #666)}.wa-rename-btn-row{display:flex;gap:10px;margin-top:8px;justify-content:flex-end}.wa-rename-btn-row button{min-width:80px;padding:6px 14px;font-size:1em;border-radius:4px;border:none;cursor:pointer;transition:background .2s}.wa-rename-btn-row .mod-cta{background:var(--interactive-accent, #7c5cff);color:#fff;font-weight:600}.wa-rename-btn-row .mod-cta:hover{background:#5a3fd6}.wa-rename-btn-row .mod-cancel{background:var(--background-modifier-border, #eee);color:var(--text-muted, #666)}.wa-rename-btn-row .mod-cancel:hover{background:#e0e0e0}.wa-rename-error{min-height:18px;margin-bottom:4px;font-size:.97em;color:var(--color-red, #d43c3c);transition:opacity .2s}.wa-create-draft-input{width:100%;padding:8px 12px;font-size:1.05em;border:1.5px solid var(--background-modifier-border, #bbb);border-radius:6px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s,box-shadow .2s;outline:none;box-shadow:0 1px 2px #3c3c3c0a}.wa-create-draft-input:focus{border-color:var(--interactive-accent, #7c5cff);box-shadow:0 2px 8px #7c5cff14;background:var(--background-secondary, #fafaff)}.wa-panel{background:var(--background-primary, #fff);color:var(--text-normal, #222);padding:1em}.wa-title{font-size:1.2em;font-weight:600;color:var(--text-title, var(--text-normal, #222))}.wa-muted{color:var(--text-faint, var(--text-muted, #888))}.wa-row{display:flex;gap:8px;align-items:center;width:100%}.wa-button-group{display:flex;gap:8px}.wa-draft-list{background:var(--background-secondary, #f6f6f6);border-radius:6px;padding:8px 0;margin-top:8px}.wa-draft-item{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-bottom:1px solid var(--background-modifier-border, #e0e0e0);background:transparent;color:var(--text-normal, #222);transition:background .15s}.wa-draft-item:last-child{border-bottom:none}.wa-draft-item.active{background:var(--background-modifier-active, #eaeaff)}.wa-draft-name{font-size:1em;font-weight:500;color:var(--text-normal, #222)}.wa-draft-actions{display:flex;gap:6px}.wa-select-container.wa-select{position:relative;width:100%;display:flex;flex-direction:column;gap:4px}.wa-select-label-text{font-size:.9em;font-weight:500;color:var(--select-text, var(--text-normal, #222))}.wa-select-trigger{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:6px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));cursor:pointer;transition:all .2s ease;min-height:38px;font-size:1em}.wa-select-trigger:hover:not(.disabled){border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.open{border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.disabled{opacity:.6;cursor:not-allowed;background:var(--disabled-background, #f3f3f3)}.wa-select-value{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.wa-select-label,.wa-select-placeholder{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wa-select-placeholder{color:var(--select-placeholder, var(--text-muted, #888))}.wa-select-controls{display:flex;align-items:center;gap:4px;flex-shrink:0;margin-left:8px}.wa-select-clear{display:flex;align-items:center;justify-content:center;width:20px;height:20px;padding:0;border:none;background:none;color:var(--select-chevron, var(--text-muted, #888));cursor:pointer;border-radius:3px;transition:background .2s;font-size:.8em}.wa-select-clear:hover{background:var(--background-modifier-hover, #f0f0f0)}.wa-select-chevron{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:var(--select-chevron, var(--text-muted, #888));font-size:.7em;transition:transform .3s cubic-bezier(.4,0,.2,1)}.wa-select-chevron.rotated{transform:rotate(180deg)}.wa-select-dropdown{position:absolute;z-index:1000;background:var(--select-dropdown-bg, var(--background-secondary, #f6f6f6));border:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0));border-radius:8px;box-shadow:0 4px 12px #00000026,0 2px 4px #0000001a;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .15s ease-out}@keyframes slideIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.wa-select-dropdown[data-placement*=top]{animation:slideInTop .15s ease-out}@keyframes slideInTop{0%{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}.wa-select-search{padding:8px;border-bottom:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0))}.wa-select-search-input{width:100%;padding:6px 8px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:4px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));font-size:.95em}.wa-select-search-input:focus{outline:none;border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-list{flex:1;overflow-y:auto;max-height:300px}.wa-select-list::-webkit-scrollbar{width:6px}.wa-select-list::-webkit-scrollbar-track{background:transparent}.wa-select-list::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb-bg, rgba(0, 0, 0, .2));border-radius:3px}.wa-select-list::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover-bg, rgba(0, 0, 0, .3))}.wa-select-empty{padding:12px 10px;text-align:center;color:var(--select-placeholder, var(--text-muted, #888));font-size:.95em}.wa-select-option{width:100%;padding:8px 10px;border-radius:0;box-shadow:none!important;border:none;background:transparent;color:var(--select-text, var(--text-normal, #222));text-align:left;cursor:pointer;transition:background .15s;font-size:.95em}.wa-select-option:hover{background:var(--select-option-hover, var(--background-modifier-hover, #f0f0ff));box-shadow:none!important}.wa-select-option.selected{background:var(--select-option-active, var(--background-modifier-active, #eaeaff));box-shadow:none!important}.wa-select-option.active{background:var(--select-option-active, var(--background-modifier-active, #eaeaff));font-weight:500;box-shadow:none!important}";if(typeof globalThis<"u"){const r=globalThis;r.__BROWSER__||(r.__BROWSER__=!0)}function Nr(r,t=20){return r.length<=t?r:r.substring(0,t-3)+"..."}const bi={outlineTemplate:`# {{draftName}} Outline

## Overview
Brief description of the story goes here.

## Characters
- Character 1: Description
- Character 2: Description

## Plot Points
- Opening: 
- Middle: 
- Climax: 
- Resolution: 

## Chapters
- Chapter 1: Title
- Chapter 2: Title
- Chapter 3: Title`,chapterTemplate:`# {{chapterName}}

## Summary
Chapter summary goes here.

## Scene 1
Scene content goes here.

## Scene 2
Scene content goes here.`,manuscriptNameTemplate:"{{draftName}}",slugStyle:"compact",ribbonPlacement:"left",ribbonAlwaysShow:!1,autoOpenPanelOnStartup:!0,autoSelectProjectOnStartup:!0,activeProject:void 0,panelRefreshDebounceMs:250,debug:!1,includeDraftOutline:!1,draftsFolderName:Ee.DRAFTS,manuscriptsFolderName:Ee.MANUSCRIPTS,backupsFolderName:Ee.BACKUPS,metaFileName:ie.META,outlineFileName:ie.OUTLINE,maxBackups:5,maxBackupAgeDays:30};function jr(r){return Object.assign({},bi,r??{})}class Qo extends x.Plugin{constructor(){super(...arguments),this.settings=bi,this.settingsChangedCallbacks=[]}async loadSettings(){const t=await this.loadData();this.settings=jr(t),t&&t.activeProject!==void 0&&(this.settings.activeProject=t.activeProject),this.manager&&(this.manager.settings=this.settings),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){U(`${M} Error in settings changed callback:`,n)}})}async saveSettings(){await Tt(async()=>{const e=jr(this.settings);await this.saveData(e),this.settings=e})===void 0&&await this.saveData(this.settings),this.manager&&(this.manager.settings=this.settings,U(`${M} Updated manager settings reference, manuscript template: ${this.settings.manuscriptNameTemplate}`)),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){U(`${M} Error in settings changed callback:`,n)}})}registerSettingsChangedCallback(t){this.settingsChangedCallbacks.push(t)}async runBackupCleanup(){if(this.manager)try{const e=await new fn(this.app).listProjects();for(const n of e){const i=jt(this.settings),a=`${n}/${i}`,s=this.app.vault.getAbstractFileByPath(a);if(!(!s||!(s instanceof x.TFolder))){for(const o of s.children)if(o instanceof x.TFolder){const l=`${a}/${o.name}`;await this.manager.projectFileService.backups.clearOldBackups(l,this.manager.settings)}}}U(`${M} Backup cleanup completed on startup`)}catch(t){U(`${M} Error during backup cleanup:`,t)}}async onload(){await this.loadSettings(),this.manager=new qo(this.app,this,typeof this.settings.panelRefreshDebounceMs=="number"?this.settings.panelRefreshDebounceMs:void 0),U(`${M} Manager created:`,!!this.manager);const t=new fn(this.app);this.app.workspace.onLayoutReady(async()=>{const i=await t.listProjects();let a=null;if(i.length===1)a=i[0];else if(i.length>1){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");U(`${M} lastActiveRaw='${s}', normalized='${o}', includes=${o&&i.includes(o)}`),o&&i.includes(o)?a=o:a=i[0]}else if(i.length===0){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");await t.isProjectFolder(s||"")&&(U(`${M} activating saved project '${o}' as it exists and has valid meta file`),a=o??null)}if(U(`${M} toActivate='${a}'`),a){if(await this.manager.setActiveProject(a),this.settings.activeProject=a,await this.saveSettings(),this.settings.autoOpenPanelOnStartup){const s=this.app.workspace.getLeavesOfType(_e);if(s.length>0)this.app.workspace.revealLeaf(s[0]);else{let o=null;this.settings.ribbonPlacement==="right"?o=this.app.workspace.getRightLeaf(!0):o=this.app.workspace.getLeftLeaf(!0);const l={type:_e,active:!0};o.setViewState(l),this.app.workspace.revealLeaf(o)}}}else await this.manager.setActiveProject(null),this.settings.activeProject=void 0,await this.saveSettings()}),this.statusBarEl=this.addStatusBarItem(),this.statusBarEl.setText(`${Ft}: No active project`),this.runBackupCleanup().catch(i=>{U(`${M} Failed to run backup cleanup on startup:`,i)}),Ut(()=>{this.waStyleEl||(this.waStyleEl=document.createElement("style"),this.waStyleEl.setAttribute("data-writeaid-style",""),this.waStyleEl.textContent=Jo,this.waStyleEl.classList.add("writeaid-plugin-style"),document.head.appendChild(this.waStyleEl))}),await this.loadSettings(),Ut(()=>{window.__WRITEAID_DEBUG__=!!this.settings.debug}),U(`${M} Loading ${Ft} Novel Multi-Draft Plugin`),this.manager.addActiveProjectListener(i=>{this.statusBarEl&&(i?(this.statusBarEl.setText(`${Ft}: ${Nr(i)}`),U(`${M} active project updated -> ${i}`)):this.statusBarEl.setText(`${Ft}: No active project`))}),this.manager.activeProject&&this.statusBarEl.setText(`${Ft}: ${Nr(this.manager.activeProject)}`),U(`${M} Registering ProjectPanelView with manager:`,!!this.manager),this.registerView(_e,i=>(U(`${M} Creating ProjectPanelView instance with manager:`,!!this.manager),new Wo(i,this.app,this.manager)));const e=this.addRibbonIcon(Rn,`${Ft} Projects`,()=>{});e.classList.add("writeaid-ribbon"),this.ribbonEl=e,e.setAttr("aria-label",`${Ft} Projects`),e.onclick=()=>{const i=this.app.workspace.getLeavesOfType(_e);if(i.length>0){const a=i[0];this.app.workspace.revealLeaf(a)}else{let a=this.app.workspace.getLeftLeaf(!1);a||(a=this.app.workspace.getLeftLeaf(!0));const s={type:_e,active:!0};a.setViewState(s),this.app.workspace.revealLeaf(a)}};const n=async()=>{await Tt(async()=>{if(this.settings.ribbonAlwaysShow){e.style.display="";return}const a=t.listAllFolders();(await Be(a,o=>t.isProjectFolder(o))).length>0?e.style.display="":e.style.display="none"})===void 0&&(e.style.display="")};this.refreshRibbonVisibility=n,n().catch(()=>{}),this.settings.ribbonPlacement==="right"&&this.moveRibbon("right"),this.registerEvent(this.app.vault.on("create",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("delete",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("modify",()=>{n().catch(()=>{})})),this.addCommand({id:"create-new-draft",name:"Create New Draft",callback:Ni(this.manager)}),this.addCommand({id:"create-outline",name:"Create Outline",callback:()=>ji(this.manager)}),this.addCommand({id:"create-new-project",name:"Create New Project",callback:Ui(this.manager)}),this.addCommand({id:"switch-draft",name:"Switch Active Draft",callback:Oi(this.manager)}),this.addCommand({id:"update-project-metadata",name:"Update Project Metadata",callback:Vo(this.manager)}),this.addCommand({id:"select-active-project",name:"Select Active Project",callback:Wi(this.manager)}),this.addCommand({id:"generate-manuscript",name:"Generate Manuscript",callback:Ti(this.manager)}),this.addCommand({id:"toggle-project-panel",name:`Toggle ${Ft} Project Panel`,callback:Ho(this.manager,this.app)}),this.addCommand({id:"convert-single-to-multi-file-project",name:"Convert Single-File Project to Multi-File",callback:()=>{var i,a;return Mi(this.app,this.manager.activeProject||((a=(i=this.manager).getCurrentProjectPath)==null?void 0:a.call(i))||void 0,this.manager.settings)}}),this.addCommand({id:"navigate-to-next-chapter",name:"Navigate to Next Chapter",callback:Bi(this.manager)}),this.addCommand({id:"navigate-to-previous-chapter",name:"Navigate to Previous Chapter",callback:Ri(this.manager)}),this.addCommand({id:"create-backup",name:"Create Backup",callback:xi(this.manager)}),this.addCommand({id:"list-and-restore-backups",name:"List and Restore Backups",callback:Ai(this.manager)}),this.addCommand({id:"delete-backup",name:"Delete Oldest Backup",callback:Pi(this.manager)}),this.addCommand({id:"clear-old-backups",name:"Clear Old Backups",callback:Ei(this.manager)}),this.addSettingTab(new Xo(this.app,this))}moveRibbon(t){Ut(()=>{if(!this.ribbonEl)return;const e=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-right"),n=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-left");t==="right"&&e?e.appendChild(this.ribbonEl):t==="left"&&n&&n.appendChild(this.ribbonEl)})}onunload(){this.statusBarEl&&this.statusBarEl.parentElement&&this.statusBarEl.parentElement.removeChild(this.statusBarEl),U(`${M} Unloading ${Ft} Novel Multi-Draft Plugin`),this.waStyleEl&&this.waStyleEl.parentElement&&this.waStyleEl.parentElement.removeChild(this.waStyleEl)}}module.exports=Qo;
//# sourceMappingURL=main.js.map
