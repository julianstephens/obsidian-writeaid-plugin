"use strict";var xa=Object.defineProperty;var Da=(r,t,e)=>t in r?xa(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Cn=(r,t,e)=>Da(r,typeof t!="symbol"?t+"":t,e);const D=require("obsidian"),fn={ACTIVE_PROJECT_NOT_FOUND:"No active project found.",ACTIVE_DRAFT_NOT_FOUND:"No active draft found.",BACKUPS_NOT_FOUND_PROJECT:"No backups found for the current project.",BACKUPS_NOT_FOUND_DRAFT:"No backups found for the current draft."},Ee={DRAFTS:"drafts",MANUSCRIPTS:"manuscripts",BACKUPS:".writeaid-backups"},re={META:"meta.md",OUTLINE:"outline.md"},jn={COMPACT:"compact",KEBAB:"kebab"},Ht={SINGLE:"single-file",MULTI:"multi-file"},Pa=Object.values(Ht),Et="WriteAid",E=`${Et} debug:`,Ln="pen-tool",bt=".md",Se=0,Ze=5e3,Ge=250,Ye=".zip",Ir=/_(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})\.zip$/,Ft="---",Rt=new RegExp(`^${Ft}
([\\s\\S]*?)
${Ft}`),An=1024,Lr=["B","KB","MB","GB"];function At(r){return(r==null?void 0:r.draftsFolderName)||Ee.DRAFTS}function Mn(r){return(r==null?void 0:r.manuscriptsFolderName)||Ee.MANUSCRIPTS}function Ae(r){return(r==null?void 0:r.backupsFolderName)||Ee.BACKUPS}function ie(r){return(r==null?void 0:r.metaFileName)||re.META}function Te(r){return(r==null?void 0:r.outlineFileName)||re.OUTLINE}function ae(r,t=jn.COMPACT){if(!r)return"";const e=r.trim();return t===jn.KEBAB?e.replace(/\s+/g,"-").toLowerCase():e.replace(/\s+/g,"").toLowerCase()}async function Oe(r,t){const e=await Promise.all(r.map(n=>Promise.resolve(t(n))));return r.filter((n,a)=>e[a])}function zt(r,...t){try{return r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}async function Ot(r,...t){try{return await r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}function Je(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const r=Date.now().toString(36),t=Math.random().toString(36).substring(2,15);return`${r}-${t}`}function x(...r){zt(()=>{window.__WRITEAID_DEBUG__&&(console.debug||console.log).apply(console,r)})}function Ue(r,t){return r?t?!0:(new D.Notice(fn.ACTIVE_DRAFT_NOT_FOUND),!1):(new D.Notice(fn.ACTIVE_PROJECT_NOT_FOUND),!1)}const Na=Object.freeze(Object.defineProperty({__proto__:null,APP_NAME:Et,BACKUP_FILE_EXTENSION:Ye,BACKUP_TIMESTAMP_REGEX:Ir,BYTES_PER_KILOBYTE:An,DEBUG_PREFIX:E,FILES:re,FILE_SIZE_UNITS:Lr,FOLDERS:Ee,FRONTMATTER_DELIMITER:Ft,FRONTMATTER_REGEX:Rt,MARKDOWN_FILE_EXTENSION:bt,PANEL_DEBOUNCE_DEFAULT:Ge,PANEL_DEBOUNCE_MAX:Ze,PANEL_DEBOUNCE_MIN:Se,PROJECT_TYPE:Ht,SLUG_STYLE:jn,VALID_PROJECT_TYPES:Pa,WRITE_AID_ICON_NAME:Ln,asyncFilter:Oe,checkActive:Ue,debug:x,generateDraftId:Je,getBackupsFolderName:Ae,getDraftsFolderName:At,getManuscriptsFolderName:Mn,getMetaFileName:ie,getOutlineFileName:Te,slugifyDraftName:ae,suppress:zt,suppressAsync:Ot},Symbol.toStringTag,{value:"Module"}));function ja(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(x(`${E} Clear old backups command called`),x(`${E} Active project: ${t}, active draft: ${e}`),!Ue(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=At(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const c of a.children)if(c instanceof D.TFolder&&c.name.toLowerCase()===n.toLowerCase()){i=c.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID.");return}const l=r.projectFileService.backups.maxBackupAgeDays;await r.projectFileService.backups.clearOldBackups(s,o,r.settings),new D.Notice(`Old backups cleared (older than ${l} days).`)}}function Aa(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(x(`${E} Create backup command called`),x(`${E} Active project: ${t}, active draft: ${e}`),!Ue(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=At(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const c of a.children)if(c instanceof D.TFolder&&c.name.toLowerCase()===n.toLowerCase()){i=c.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID for backup.");return}await r.projectFileService.backups.createBackup(s,o,r.settings)?new D.Notice("Backup created successfully."):new D.Notice("Failed to create backup.")}}function Ta(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(x(`${E} Delete backup command called`),x(`${E} Active project: ${t}, active draft: ${e}`),!Ue(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=At(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const d of a.children)if(d instanceof D.TFolder&&d.name.toLowerCase()===n.toLowerCase()){i=d.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID.");return}const l=await r.projectFileService.backups.listBackups(s,o,r.settings);if(l.length===0){new D.Notice(fn.BACKUPS_NOT_FOUND_DRAFT);return}const c=l[l.length-1];await r.projectFileService.backups.deleteBackup(s,o,c,r.settings)?new D.Notice(`Backup deleted successfully: ${c}.`):new D.Notice("Failed to delete backup.")}}class Mr extends D.Modal{constructor(t,e,n=!1){super(t),this.path=e,this.isDraft=n,this.setTitle("Confirm Overwrite")}onOpen(){const{contentEl:t}=this,e=this.isDraft?"draft folder":"manuscript file";t.createEl("p",{text:`The ${e} "${this.path}" already exists. Do you want to overwrite it?`});const n=t.createDiv({cls:"modal-button-container"});new D.ButtonComponent(n).setButtonText("Cancel").onClick(()=>{x(`${E} ConfirmOverwriteModal: cancelled overwrite for ${this.isDraft?"draft":"manuscript"} "${this.path}"`),this.resolve(!1),this.close()}),new D.ButtonComponent(n).setButtonText("Overwrite").setCta().onClick(()=>{x(`${E} ConfirmOverwriteModal: confirmed overwrite for ${this.isDraft?"draft":"manuscript"} "${this.path}"`),this.resolve(!0),this.close()})}onClose(){const{contentEl:t}=this;t.empty()}open(){return new Promise(t=>{this.resolve=t,super.open()})}}class Oa extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Restored Draft"}),t.createEl("div",{text:`The original draft '${this.oldName}' no longer exists. Please provide a new name for the restored draft.`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Restore",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}this.errorEl&&(this.errorEl.style.display="none"),x(`${E} RenameRestoredDraftModal: restoring draft as "${t}"`),this.onSubmit(t),this.close()}onClose(){this.contentEl.empty()}}class Ba extends D.SuggestModal{constructor(t,e,n){super(t),this.manager=e,this.backups=[],this.draftFolder="",this.draftName="",this.onRestoreComplete=n,this.setPlaceholder("Select a backup to restore..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to restore"},{command:"esc",purpose:"to cancel"}])}async onOpen(){const t=this.manager.activeProject;if(x(`${E} RestoreBackupModal opened for project: ${t}`),!t){new D.Notice("No active project found."),this.close();return}const e=At(this.manager.settings);if(this.draftFolder=`${t}/${e}`,this.draftName=t,this.backups=await this.getBackupDetails(),x(`${E} Found ${this.backups.length} backups for project: ${t}`),this.backups.length===0){new D.Notice(fn.BACKUPS_NOT_FOUND_PROJECT),this.close();return}this.setTitle(`Restore Backup for Project "${t}"`),super.onOpen()}async getBackupDetails(){const t=this.draftFolder.split("/")[0]||"unknown",e=`${Ae(this.manager.settings)}/${t}`;try{const n=[],a=At(this.manager.settings);let i=a;try{const l=await this.app.vault.adapter.list(e);for(const c of l.folders){const f=c.split("/").pop()||c;if(f.toLowerCase()===a.toLowerCase()){i=f;break}}}catch{x(`${E} Could not read backup project directory: ${e}`)}const s=`${e}/${i}`;x(`${E} Looking for backups in: ${s}`);const o=await this.app.vault.adapter.list(s);for(const l of o.folders){const c=l.split("/").pop()||l;let f=c;const d=`${t}/${a}`,g=this.manager.projectFileService.drafts.listDrafts(t);for(const b of g){const y=`${d}/${b}`;if(await this.manager.projectFileService.drafts.getDraftId(y)===c){f=b;break}}const u=`${s}/${c}`,m=await this.app.vault.adapter.list(u),p=this.app.vault.getAbstractFileByPath(t);let v=a;if(p&&p instanceof D.TFolder){for(const b of p.children)if(b instanceof D.TFolder&&b.name.toLowerCase()===a.toLowerCase()){v=b.name;break}}const h=`${t}/${v}/${f}`;for(const b of m.files){const y=b.split("/").pop()||b,$=new RegExp("^(\\d{4}-\\d{2}-\\d{2}T\\d{2}-\\d{2}-\\d{2})\\.zip$"),k=y.match($);if(k){const N=await this.app.vault.adapter.stat(b),j=(N==null?void 0:N.size)||0,z=k[1],A=z.replace(/T(\d{2})-(\d{2})-(\d{2})/,"T$1:$2:$3"),q=new Date(A).toLocaleString(),F=this.formatFileSize(j);n.push({timestamp:z,size:j,displayText:`${f}: ${q} (${F})`,draftName:f,draftFolder:h,draftId:c})}}}return n.sort((l,c)=>c.timestamp.localeCompare(l.timestamp))}catch{return x(`${E} Backup directory does not exist yet for project '${e}' (this is normal for new projects)`),[]}}formatFileSize(t){if(t===0)return"0 B";const e=Math.floor(Math.log(t)/Math.log(An));return parseFloat((t/Math.pow(An,e)).toFixed(1))+" "+Lr[e]}getSuggestions(t){return this.backups.filter(e=>e.displayText.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.createEl("div",{text:t.displayText})}async onChooseSuggestion(t,e){const n=this.manager.activeDraft;x(`${E} Restoring backup: ${t.draftName} (${t.timestamp}), current active draft: ${n}`);const a=this.app.vault.getAbstractFileByPath(t.draftFolder);let i=t.draftFolder,s=t.draftName;if(a&&a instanceof D.TFolder){if(!await new Mr(this.app,t.draftFolder,!0).open()){x(`${E} Backup restore cancelled by user`);return}}else{const l=new Oa(this.app,t.draftName,f=>{s=f});if(await new Promise(f=>{const d=l.onClose;l.onClose=()=>{d&&d.call(l),f()},l.open()}),s===t.draftName&&!a){x(`${E} Backup restore cancelled by user (rename modal)`);return}i=`${t.draftFolder.split("/").slice(0,-1).join("/")}/${s}`}await this.manager.projectFileService.backups.restoreBackup(i,t.draftId,t.timestamp,this.manager.settings)?(new D.Notice(`Backup restored successfully for "${s}" from ${t.displayText.split(": ")[1].split(" (")[0]}.`),x(`${E} Backup restore successful for: ${s}, active draft preserved: ${n} -> ${this.manager.activeDraft}`),this.onRestoreComplete&&this.onRestoreComplete()):(new D.Notice("Failed to restore backup."),x(`${E} Backup restore failed for: ${s}`))}}function Ra(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function sn(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ur={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(r,t){(function(e){r.exports=e()})(function(){return function e(n,a,i){function s(c,f){if(!a[c]){if(!n[c]){var d=typeof sn=="function"&&sn;if(!f&&d)return d(c,!0);if(o)return o(c,!0);var g=new Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g}var u=a[c]={exports:{}};n[c][0].call(u.exports,function(m){var p=n[c][1][m];return s(p||m)},u,u.exports,e,n,a,i)}return a[c].exports}for(var o=typeof sn=="function"&&sn,l=0;l<i.length;l++)s(i[l]);return s}({1:[function(e,n,a){var i=e("./utils"),s=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var c,f,d,g,u,m,p,v=[],h=0,b=l.length,y=b,$=i.getTypeOf(l)!=="string";h<l.length;)y=b-h,d=$?(c=l[h++],f=h<b?l[h++]:0,h<b?l[h++]:0):(c=l.charCodeAt(h++),f=h<b?l.charCodeAt(h++):0,h<b?l.charCodeAt(h++):0),g=c>>2,u=(3&c)<<4|f>>4,m=1<y?(15&f)<<2|d>>6:64,p=2<y?63&d:64,v.push(o.charAt(g)+o.charAt(u)+o.charAt(m)+o.charAt(p));return v.join("")},a.decode=function(l){var c,f,d,g,u,m,p=0,v=0,h="data:";if(l.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var b,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=s.uint8array?new Uint8Array(0|y):new Array(0|y);p<l.length;)c=o.indexOf(l.charAt(p++))<<2|(g=o.indexOf(l.charAt(p++)))>>4,f=(15&g)<<4|(u=o.indexOf(l.charAt(p++)))>>2,d=(3&u)<<6|(m=o.indexOf(l.charAt(p++))),b[v++]=c,u!==64&&(b[v++]=f),m!==64&&(b[v++]=d);return b}},{"./support":30,"./utils":32}],2:[function(e,n,a){var i=e("./external"),s=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(f,d,g,u,m){this.compressedSize=f,this.uncompressedSize=d,this.crc32=g,this.compression=u,this.compressedContent=m}c.prototype={getContentWorker:function(){var f=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return f.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(f,d,g){return f.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(g)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,a){var i=e("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},a.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,a){var i=e("./utils"),s=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var f=0;f<8;f++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?function(c,f,d,g){var u=s,m=g+d;c^=-1;for(var p=g;p<m;p++)c=c>>>8^u[255&(c^f[p])];return-1^c}(0|l,o,o.length,0):function(c,f,d,g){var u=s,m=g+d;c^=-1;for(var p=g;p<m;p++)c=c>>>8^u[255&(c^f.charCodeAt(p))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(e,n,a){var i=null;i=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:i}},{lie:37}],7:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=i?"uint8array":"array";function f(d,g){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=g,this.meta={}}a.magic="\b\0",o.inherits(f,l),f.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,d.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(g){d.push({data:g,meta:d.meta})}},a.compressWorker=function(d){return new f("Deflate",d)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,a){function i(u,m){var p,v="";for(p=0;p<m;p++)v+=String.fromCharCode(255&u),u>>>=8;return v}function s(u,m,p,v,h,b){var y,$,k=u.file,N=u.compression,j=b!==c.utf8encode,z=o.transformTo("string",b(k.name)),A=o.transformTo("string",c.utf8encode(k.name)),O=k.comment,q=o.transformTo("string",b(O)),F=o.transformTo("string",c.utf8encode(O)),L=A.length!==k.name.length,_=F.length!==O.length,W="",st="",V="",ot=k.dir,G=k.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(ft.crc32=u.crc32,ft.compressedSize=u.compressedSize,ft.uncompressedSize=u.uncompressedSize);var R=0;m&&(R|=8),j||!L&&!_||(R|=2048);var B=0,lt=0;ot&&(B|=16),h==="UNIX"?(lt=798,B|=function(X,St){var Nt=X;return X||(Nt=St?16893:33204),(65535&Nt)<<16}(k.unixPermissions,ot)):(lt=20,B|=function(X){return 63&(X||0)}(k.dosPermissions)),y=G.getUTCHours(),y<<=6,y|=G.getUTCMinutes(),y<<=5,y|=G.getUTCSeconds()/2,$=G.getUTCFullYear()-1980,$<<=4,$|=G.getUTCMonth()+1,$<<=5,$|=G.getUTCDate(),L&&(st=i(1,1)+i(f(z),4)+A,W+="up"+i(st.length,2)+st),_&&(V=i(1,1)+i(f(q),4)+F,W+="uc"+i(V.length,2)+V);var U="";return U+=`
\0`,U+=i(R,2),U+=N.magic,U+=i(y,2),U+=i($,2),U+=i(ft.crc32,4),U+=i(ft.compressedSize,4),U+=i(ft.uncompressedSize,4),U+=i(z.length,2),U+=i(W.length,2),{fileRecord:d.LOCAL_FILE_HEADER+U+z+W,dirRecord:d.CENTRAL_FILE_HEADER+i(lt,2)+U+i(q.length,2)+"\0\0\0\0"+i(B,4)+i(v,4)+z+W+q}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),f=e("../crc32"),d=e("../signature");function g(u,m,p,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=v,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(g,l),g.prototype.push=function(u){var m=u.meta.percent||0,p=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-v-1))/p:100}}))},g.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var m=this.streamFiles&&!u.file.dir;if(m){var p=s(u,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(u){this.accumulate=!1;var m=this.streamFiles&&!u.file.dir,p=s(u,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(v){return d.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var u=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-u,v=function(h,b,y,$,k){var N=o.transformTo("string",k($));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(h,2)+i(h,2)+i(b,4)+i(y,4)+i(N.length,2)+N}(this.dirRecords.length,p,u,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(u){this._sources.push(u);var m=this;return u.on("data",function(p){m.processChunk(p)}),u.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),u.on("error",function(p){m.error(p)}),this},g.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(u){var m=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var p=0;p<m.length;p++)try{m[p].error(u)}catch{}return!0},g.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,m=0;m<u.length;m++)u[m].lock()},n.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,a){var i=e("../compressions"),s=e("./ZipFileWorker");a.generateWorker=function(o,l,c){var f=new s(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{o.forEach(function(g,u){d++;var m=function(b,y){var $=b||y,k=i[$];if(!k)throw new Error($+" is not a valid compression method !");return k}(u.options.compression,l.compression),p=u.options.compressionOptions||l.compressionOptions||{},v=u.dir,h=u.date;u._compressWorker(m,p).withStreamInfo("file",{name:g,dir:v,date:h,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(f)}),f.entriesCount=d}catch(g){f.error(g)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,a){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(s,o){return new i().loadAsync(s,o)},i.external=e("./external"),n.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,a){var i=e("./utils"),s=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),f=e("./nodejsUtils");function d(g){return new s.Promise(function(u,m){var p=g.decompressed.getContentWorker().pipe(new c);p.on("error",function(v){m(v)}).on("end",function(){p.streamInfo.crc32!==g.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}n.exports=function(g,u){var m=this;return u=i.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),f.isNode&&f.isStream(g)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",g,!0,u.optimizedBinaryString,u.base64).then(function(p){var v=new l(u);return v.load(p),v}).then(function(p){var v=[s.Promise.resolve(p)],h=p.files;if(u.checkCRC32)for(var b=0;b<h.length;b++)v.push(d(h[b]));return s.Promise.all(v)}).then(function(p){for(var v=p.shift(),h=v.files,b=0;b<h.length;b++){var y=h[b],$=y.fileNameStr,k=i.resolve(y.fileNameStr);m.file(k,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:u.createFolders}),y.dir||(m.file(k).unsafeOriginalName=$)}return v.zipComment.length&&(m.comment=v.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,a){var i=e("../utils"),s=e("../stream/GenericWorker");function o(l,c){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(o,s),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(f){c.push({data:f,meta:{percent:0}})}).on("error",function(f){c.isPaused?this.generatedError=f:c.error(f)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,a){var i=e("readable-stream").Readable;function s(o,l,c){i.call(this,l),this._helper=o;var f=this;o.on("data",function(d,g){f.push(d)||f._helper.pause(),c&&c(g)}).on("error",function(d){f.emit("error",d)}).on("end",function(){f.push(null)})}e("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(e,n,a){function i(k,N,j){var z,A=o.getTypeOf(N),O=o.extend(j||{},f);O.date=O.date||new Date,O.compression!==null&&(O.compression=O.compression.toUpperCase()),typeof O.unixPermissions=="string"&&(O.unixPermissions=parseInt(O.unixPermissions,8)),O.unixPermissions&&16384&O.unixPermissions&&(O.dir=!0),O.dosPermissions&&16&O.dosPermissions&&(O.dir=!0),O.dir&&(k=h(k)),O.createFolders&&(z=v(k))&&b.call(this,z,!0);var q=A==="string"&&O.binary===!1&&O.base64===!1;j&&j.binary!==void 0||(O.binary=!q),(N instanceof d&&N.uncompressedSize===0||O.dir||!N||N.length===0)&&(O.base64=!1,O.binary=!0,N="",O.compression="STORE",A="string");var F=null;F=N instanceof d||N instanceof l?N:m.isNode&&m.isStream(N)?new p(k,N):o.prepareContent(k,N,O.binary,O.optimizedBinaryString,O.base64);var L=new g(k,F,O);this.files[k]=L}var s=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),f=e("./defaults"),d=e("./compressedObject"),g=e("./zipObject"),u=e("./generate"),m=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),v=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var N=k.lastIndexOf("/");return 0<N?k.substring(0,N):""},h=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},b=function(k,N){return N=N!==void 0?N:f.createFolders,k=h(k),this.files[k]||i.call(this,k,null,{dir:!0,createFolders:N}),this.files[k]};function y(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var $={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var N,j,z;for(N in this.files)z=this.files[N],(j=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&k(j,z)},filter:function(k){var N=[];return this.forEach(function(j,z){k(j,z)&&N.push(z)}),N},file:function(k,N,j){if(arguments.length!==1)return k=this.root+k,i.call(this,k,N,j),this;if(y(k)){var z=k;return this.filter(function(O,q){return!q.dir&&z.test(O)})}var A=this.files[this.root+k];return A&&!A.dir?A:null},folder:function(k){if(!k)return this;if(y(k))return this.filter(function(A,O){return O.dir&&k.test(A)});var N=this.root+k,j=b.call(this,N),z=this.clone();return z.root=j.name,z},remove:function(k){k=this.root+k;var N=this.files[k];if(N||(k.slice(-1)!=="/"&&(k+="/"),N=this.files[k]),N&&!N.dir)delete this.files[k];else for(var j=this.filter(function(A,O){return O.name.slice(0,k.length)===k}),z=0;z<j.length;z++)delete this.files[j[z].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var N,j={};try{if((j=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=j.type.toLowerCase(),j.compression=j.compression.toUpperCase(),j.type==="binarystring"&&(j.type="string"),!j.type)throw new Error("No output type specified.");o.checkSupport(j.type),j.platform!=="darwin"&&j.platform!=="freebsd"&&j.platform!=="linux"&&j.platform!=="sunos"||(j.platform="UNIX"),j.platform==="win32"&&(j.platform="DOS");var z=j.comment||this.comment||"";N=u.generateWorker(this,j,z)}catch(A){(N=new l("error")).error(A)}return new c(N,j.type||"string",j.mimeType)},generateAsync:function(k,N){return this.generateInternalStream(k).accumulate(N)},generateNodeStream:function(k,N){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(N)}};n.exports=$},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,a){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),d=o.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===l&&this.data[g+1]===c&&this.data[g+2]===f&&this.data[g+3]===d)return g-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),d=o.charCodeAt(3),g=this.readData(4);return l===g[0]&&c===g[1]&&f===g[2]&&d===g[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,n,a){var i=e("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(e,n,a){var i=e("./Uint8ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,n,a){var i=e("./ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,a){var i=e("../utils"),s=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),f=e("./Uint8ArrayReader");n.exports=function(d){var g=i.getTypeOf(d);return i.checkSupport(g),g!=="string"||s.uint8array?g==="nodebuffer"?new c(d):s.uint8array?new f(i.transformTo("uint8array",d)):new o(i.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,a){var i=e("./GenericWorker"),s=e("../utils");function o(l){i.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,i),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,a){var i=e("./GenericWorker"),s=e("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,i),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(o,s),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){c.dataIsReady=!0,c.data=f,c.max=f&&f.length||0,c.type=i.getTypeOf(f),c.isPaused||c._tickAndRepeat()},function(f){c.error(f)})}i.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,a){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=i},{}],29:[function(e,n,a){var i=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),f=e("../external"),d=null;if(c.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(m,p){return new f.Promise(function(v,h){var b=[],y=m._internalType,$=m._outputType,k=m._mimeType;m.on("data",function(N,j){b.push(N),p&&p(j)}).on("error",function(N){b=[],h(N)}).on("end",function(){try{var N=function(j,z,A){switch(j){case"blob":return i.newBlob(i.transformTo("arraybuffer",z),A);case"base64":return l.encode(z);default:return i.transformTo(j,z)}}($,function(j,z){var A,O=0,q=null,F=0;for(A=0;A<z.length;A++)F+=z[A].length;switch(j){case"string":return z.join("");case"array":return Array.prototype.concat.apply([],z);case"uint8array":for(q=new Uint8Array(F),A=0;A<z.length;A++)q.set(z[A],O),O+=z[A].length;return q;case"nodebuffer":return Buffer.concat(z);default:throw new Error("concat : unsupported type '"+j+"'")}}(y,b),k);v(N)}catch(j){h(j)}b=[]}).resume()})}function u(m,p,v){var h=p;switch(p){case"blob":case"arraybuffer":h="uint8array";break;case"base64":h="string"}try{this._internalType=h,this._outputType=p,this._mimeType=v,i.checkSupport(h),this._worker=m.pipe(new s(h)),m.lock()}catch(b){this._worker=new o("error"),this._worker.error(b)}}u.prototype={accumulate:function(m){return g(this,m)},on:function(m,p){var v=this;return m==="data"?this._worker.on(m,function(h){p.call(v,h.data,h.meta)}):this._worker.on(m,function(){i.delay(p,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var i=new ArrayBuffer(0);try{a.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!e("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,a){for(var i=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),f=0;f<256;f++)c[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function g(){l.call(this,"utf-8 encode")}a.utf8encode=function(u){return s.nodebuffer?o.newBufferFrom(u,"utf-8"):function(m){var p,v,h,b,y,$=m.length,k=0;for(b=0;b<$;b++)(64512&(v=m.charCodeAt(b)))==55296&&b+1<$&&(64512&(h=m.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(h-56320),b++),k+=v<128?1:v<2048?2:v<65536?3:4;for(p=s.uint8array?new Uint8Array(k):new Array(k),b=y=0;y<k;b++)(64512&(v=m.charCodeAt(b)))==55296&&b+1<$&&(64512&(h=m.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(h-56320),b++),v<128?p[y++]=v:(v<2048?p[y++]=192|v>>>6:(v<65536?p[y++]=224|v>>>12:(p[y++]=240|v>>>18,p[y++]=128|v>>>12&63),p[y++]=128|v>>>6&63),p[y++]=128|63&v);return p}(u)},a.utf8decode=function(u){return s.nodebuffer?i.transformTo("nodebuffer",u).toString("utf-8"):function(m){var p,v,h,b,y=m.length,$=new Array(2*y);for(p=v=0;p<y;)if((h=m[p++])<128)$[v++]=h;else if(4<(b=c[h]))$[v++]=65533,p+=b-1;else{for(h&=b===2?31:b===3?15:7;1<b&&p<y;)h=h<<6|63&m[p++],b--;1<b?$[v++]=65533:h<65536?$[v++]=h:(h-=65536,$[v++]=55296|h>>10&1023,$[v++]=56320|1023&h)}return $.length!==v&&($.subarray?$=$.subarray(0,v):$.length=v),i.applyFromCharCode($)}(u=i.transformTo(s.uint8array?"uint8array":"array",u))},i.inherits(d,l),d.prototype.processChunk=function(u){var m=i.transformTo(s.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var v=function(b,y){var $;for((y=y||b.length)>b.length&&(y=b.length),$=y-1;0<=$&&(192&b[$])==128;)$--;return $<0||$===0?y:$+c[b[$]]>y?$:y}(m),h=m;v!==m.length&&(s.uint8array?(h=m.subarray(0,v),this.leftOver=m.subarray(v,m.length)):(h=m.slice(0,v),this.leftOver=m.slice(v,m.length))),this.push({data:a.utf8decode(h),meta:u.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=d,i.inherits(g,l),g.prototype.processChunk=function(u){this.push({data:a.utf8encode(u.data),meta:u.meta})},a.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,a){var i=e("./support"),s=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(p){return p}function f(p,v){for(var h=0;h<p.length;++h)v[h]=255&p.charCodeAt(h);return v}e("setimmediate"),a.newBlob=function(p,v){a.checkSupport("blob");try{return new Blob([p],{type:v})}catch{try{var h=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return h.append(p),h.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,v,h){var b=[],y=0,$=p.length;if($<=h)return String.fromCharCode.apply(null,p);for(;y<$;)v==="array"||v==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(y,Math.min(y+h,$)))):b.push(String.fromCharCode.apply(null,p.subarray(y,Math.min(y+h,$)))),y+=h;return b.join("")},stringifyByChar:function(p){for(var v="",h=0;h<p.length;h++)v+=String.fromCharCode(p[h]);return v},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function g(p){var v=65536,h=a.getTypeOf(p),b=!0;if(h==="uint8array"?b=d.applyCanBeUsed.uint8array:h==="nodebuffer"&&(b=d.applyCanBeUsed.nodebuffer),b)for(;1<v;)try{return d.stringifyByChunk(p,h,v)}catch{v=Math.floor(v/2)}return d.stringifyByChar(p)}function u(p,v){for(var h=0;h<p.length;h++)v[h]=p[h];return v}a.applyFromCharCode=g;var m={};m.string={string:c,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:function(p){return f(p,o.allocBuffer(p.length))}},m.array={string:g,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},m.arraybuffer={string:function(p){return g(new Uint8Array(p))},array:function(p){return u(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:g,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return o.newBufferFrom(p)}},m.nodebuffer={string:g,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:c},a.transformTo=function(p,v){if(v=v||"",!p)return v;a.checkSupport(p);var h=a.getTypeOf(v);return m[h][p](v)},a.resolve=function(p){for(var v=p.split("/"),h=[],b=0;b<v.length;b++){var y=v[b];y==="."||y===""&&b!==0&&b!==v.length-1||(y===".."?h.pop():h.push(y))}return h.join("/")},a.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(p)?"nodebuffer":i.uint8array&&p instanceof Uint8Array?"uint8array":i.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(p){if(!i[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(p){var v,h,b="";for(h=0;h<(p||"").length;h++)b+="\\x"+((v=p.charCodeAt(h))<16?"0":"")+v.toString(16).toUpperCase();return b},a.delay=function(p,v,h){setImmediate(function(){p.apply(h||null,v||[])})},a.inherits=function(p,v){function h(){}h.prototype=v.prototype,p.prototype=new h},a.extend=function(){var p,v,h={};for(p=0;p<arguments.length;p++)for(v in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],v)&&h[v]===void 0&&(h[v]=arguments[p][v]);return h},a.prepareContent=function(p,v,h,b,y){return l.Promise.resolve(v).then(function($){return i.blob&&($ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call($))!==-1)&&typeof FileReader<"u"?new l.Promise(function(k,N){var j=new FileReader;j.onload=function(z){k(z.target.result)},j.onerror=function(z){N(z.target.error)},j.readAsArrayBuffer($)}):$}).then(function($){var k=a.getTypeOf($);return k?(k==="arraybuffer"?$=a.transformTo("uint8array",$):k==="string"&&(y?$=s.decode($):h&&b!==!0&&($=function(N){return f(N,i.uint8array?new Uint8Array(N.length):new Array(N.length))}($))),$):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function f(d){this.files=[],this.loadOptions=d}f.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(g)+", expected "+s.pretty(d)+")")}},isSignature:function(d,g){var u=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===g;return this.reader.setIndex(u),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),g=c.uint8array?"uint8array":"array",u=s.transformTo(g,d);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,g,u,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),g=this.reader.readInt(4),u=this.reader.readData(g),this.zip64ExtensibleData[d]={id:d,length:g,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,g;for(d=0;d<this.files.length;d++)g=this.files[d],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var g=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var m=g-u;if(0<m)this.isSignature(g,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=i(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),f=e("./compressions"),d=e("./support");function g(u,m){this.options=u,this.loadOptions=m}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var m,p;if(u.skip(22),this.fileNameLength=u.readInt(2),p=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(v){for(var h in f)if(Object.prototype.hasOwnProperty.call(f,h)&&f[h].magic===v)return f[h];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var m=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(m),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var m,p,v,h=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<h;)m=u.readInt(2),p=u.readInt(2),v=u.readData(p),this.extraFields[m]={id:m,length:p,value:v};u.setIndex(h)},handleUTF8:function(){var u=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=s.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var h=s.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(h)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var m=i(u.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var m=i(u.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null}},n.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,a){function i(m,p,v){this.name=m,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=p,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var s=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),f=e("./stream/GenericWorker");i.prototype={internalStream:function(m){var p=null,v="string";try{if(!m)throw new Error("No output type specified.");var h=(v=m.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!h&&(p=p.pipe(new l.Utf8EncodeWorker)),!b&&h&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(y){(p=new f("error")).error(y)}return new s(p,v,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof c&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(v,m,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof f?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)i.prototype[d[u]]=g;n.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,a){(function(i){var s,o,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var c=0,f=new l(m),d=i.document.createTextNode("");f.observe(d,{characterData:!0}),s=function(){d.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var p=i.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},i.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var g=new i.MessageChannel;g.port1.onmessage=m,s=function(){g.port2.postMessage(0)}}var u=[];function m(){var p,v;o=!0;for(var h=u.length;h;){for(v=u,u=[],p=-1;++p<h;)v[p]();h=u.length}o=!1}n.exports=function(p){u.push(p)!==1||o||s()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,a){var i=e("immediate");function s(){}var o={},l=["REJECTED"],c=["FULFILLED"],f=["PENDING"];function d(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,h!==s&&p(this,h)}function g(h,b,y){this.promise=h,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function u(h,b,y){i(function(){var $;try{$=b(y)}catch(k){return o.reject(h,k)}$===h?o.reject(h,new TypeError("Cannot resolve promise with itself")):o.resolve(h,$)})}function m(h){var b=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof b=="function")return function(){b.apply(h,arguments)}}function p(h,b){var y=!1;function $(j){y||(y=!0,o.reject(h,j))}function k(j){y||(y=!0,o.resolve(h,j))}var N=v(function(){b(k,$)});N.status==="error"&&$(N.value)}function v(h,b){var y={};try{y.value=h(b),y.status="success"}catch($){y.status="error",y.value=$}return y}(n.exports=d).prototype.finally=function(h){if(typeof h!="function")return this;var b=this.constructor;return this.then(function(y){return b.resolve(h()).then(function(){return y})},function(y){return b.resolve(h()).then(function(){throw y})})},d.prototype.catch=function(h){return this.then(null,h)},d.prototype.then=function(h,b){if(typeof h!="function"&&this.state===c||typeof b!="function"&&this.state===l)return this;var y=new this.constructor(s);return this.state!==f?u(y,this.state===c?h:b,this.outcome):this.queue.push(new g(y,h,b)),y},g.prototype.callFulfilled=function(h){o.resolve(this.promise,h)},g.prototype.otherCallFulfilled=function(h){u(this.promise,this.onFulfilled,h)},g.prototype.callRejected=function(h){o.reject(this.promise,h)},g.prototype.otherCallRejected=function(h){u(this.promise,this.onRejected,h)},o.resolve=function(h,b){var y=v(m,b);if(y.status==="error")return o.reject(h,y.value);var $=y.value;if($)p(h,$);else{h.state=c,h.outcome=b;for(var k=-1,N=h.queue.length;++k<N;)h.queue[k].callFulfilled(b)}return h},o.reject=function(h,b){h.state=l,h.outcome=b;for(var y=-1,$=h.queue.length;++y<$;)h.queue[y].callRejected(b);return h},d.resolve=function(h){return h instanceof this?h:o.resolve(new this(s),h)},d.reject=function(h){var b=new this(s);return o.reject(b,h)},d.all=function(h){var b=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=h.length,$=!1;if(!y)return this.resolve([]);for(var k=new Array(y),N=0,j=-1,z=new this(s);++j<y;)A(h[j],j);return z;function A(O,q){b.resolve(O).then(function(F){k[q]=F,++N!==y||$||($=!0,o.resolve(z,k))},function(F){$||($=!0,o.reject(z,F))})}},d.race=function(h){var b=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=h.length,$=!1;if(!y)return this.resolve([]);for(var k=-1,N=new this(s);++k<y;)j=h[k],b.resolve(j).then(function(z){$||($=!0,o.resolve(N,z))},function(z){$||($=!0,o.reject(N,z))});var j;return N}},{immediate:36}],38:[function(e,n,a){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,a){var i=e("./zlib/deflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),f=Object.prototype.toString,d=0,g=-1,u=0,m=8;function p(h){if(!(this instanceof p))return new p(h);this.options=s.assign({level:g,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},h||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=i.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(y!==d)throw new Error(l[y]);if(b.header&&i.deflateSetHeader(this.strm,b.header),b.dictionary){var $;if($=typeof b.dictionary=="string"?o.string2buf(b.dictionary):f.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(y=i.deflateSetDictionary(this.strm,$))!==d)throw new Error(l[y]);this._dict_set=!0}}function v(h,b){var y=new p(b);if(y.push(h,!0),y.err)throw y.msg||l[y.err];return y.result}p.prototype.push=function(h,b){var y,$,k=this.strm,N=this.options.chunkSize;if(this.ended)return!1;$=b===~~b?b:b===!0?4:0,typeof h=="string"?k.input=o.string2buf(h):f.call(h)==="[object ArrayBuffer]"?k.input=new Uint8Array(h):k.input=h,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(N),k.next_out=0,k.avail_out=N),(y=i.deflate(k,$))!==1&&y!==d)return this.onEnd(y),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||$!==4&&$!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(k.output,k.next_out))):this.onData(s.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&y!==1);return $===4?(y=i.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===d):$!==2||(this.onEnd(d),!(k.avail_out=0))},p.prototype.onData=function(h){this.chunks.push(h)},p.prototype.onEnd=function(h){h===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},a.Deflate=p,a.deflate=v,a.deflateRaw=function(h,b){return(b=b||{}).raw=!0,v(h,b)},a.gzip=function(h,b){return(b=b||{}).gzip=!0,v(h,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,a){var i=e("./zlib/inflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),f=e("./zlib/zstream"),d=e("./zlib/gzheader"),g=Object.prototype.toString;function u(p){if(!(this instanceof u))return new u(p);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},p||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||p&&p.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var h=i.inflateInit2(this.strm,v.windowBits);if(h!==l.Z_OK)throw new Error(c[h]);this.header=new d,i.inflateGetHeader(this.strm,this.header)}function m(p,v){var h=new u(v);if(h.push(p,!0),h.err)throw h.msg||c[h.err];return h.result}u.prototype.push=function(p,v){var h,b,y,$,k,N,j=this.strm,z=this.options.chunkSize,A=this.options.dictionary,O=!1;if(this.ended)return!1;b=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?j.input=o.binstring2buf(p):g.call(p)==="[object ArrayBuffer]"?j.input=new Uint8Array(p):j.input=p,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new s.Buf8(z),j.next_out=0,j.avail_out=z),(h=i.inflate(j,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&A&&(N=typeof A=="string"?o.string2buf(A):g.call(A)==="[object ArrayBuffer]"?new Uint8Array(A):A,h=i.inflateSetDictionary(this.strm,N)),h===l.Z_BUF_ERROR&&O===!0&&(h=l.Z_OK,O=!1),h!==l.Z_STREAM_END&&h!==l.Z_OK)return this.onEnd(h),!(this.ended=!0);j.next_out&&(j.avail_out!==0&&h!==l.Z_STREAM_END&&(j.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(j.output,j.next_out),$=j.next_out-y,k=o.buf2string(j.output,y),j.next_out=$,j.avail_out=z-$,$&&s.arraySet(j.output,j.output,y,$,0),this.onData(k)):this.onData(s.shrinkBuf(j.output,j.next_out)))),j.avail_in===0&&j.avail_out===0&&(O=!0)}while((0<j.avail_in||j.avail_out===0)&&h!==l.Z_STREAM_END);return h===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(h=i.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(j.avail_out=0))},u.prototype.onData=function(p){this.chunks.push(p)},u.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},a.Inflate=u,a.inflate=m,a.inflateRaw=function(p,v){return(v=v||{}).raw=!0,m(p,v)},a.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var f=c.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var d in f)f.hasOwnProperty(d)&&(l[d]=f[d])}}return l},a.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var s={arraySet:function(l,c,f,d,g){if(c.subarray&&l.subarray)l.set(c.subarray(f,f+d),g);else for(var u=0;u<d;u++)l[g+u]=c[f+u]},flattenChunks:function(l){var c,f,d,g,u,m;for(c=d=0,f=l.length;c<f;c++)d+=l[c].length;for(m=new Uint8Array(d),c=g=0,f=l.length;c<f;c++)u=l[c],m.set(u,g),g+=u.length;return m}},o={arraySet:function(l,c,f,d,g){for(var u=0;u<d;u++)l[g+u]=c[f+u]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,o))},a.setTyped(i)},{}],42:[function(e,n,a){var i=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new i.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function f(d,g){if(g<65537&&(d.subarray&&o||!d.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(d,g));for(var u="",m=0;m<g;m++)u+=String.fromCharCode(d[m]);return u}l[254]=l[254]=1,a.string2buf=function(d){var g,u,m,p,v,h=d.length,b=0;for(p=0;p<h;p++)(64512&(u=d.charCodeAt(p)))==55296&&p+1<h&&(64512&(m=d.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),b+=u<128?1:u<2048?2:u<65536?3:4;for(g=new i.Buf8(b),p=v=0;v<b;p++)(64512&(u=d.charCodeAt(p)))==55296&&p+1<h&&(64512&(m=d.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),u<128?g[v++]=u:(u<2048?g[v++]=192|u>>>6:(u<65536?g[v++]=224|u>>>12:(g[v++]=240|u>>>18,g[v++]=128|u>>>12&63),g[v++]=128|u>>>6&63),g[v++]=128|63&u);return g},a.buf2binstring=function(d){return f(d,d.length)},a.binstring2buf=function(d){for(var g=new i.Buf8(d.length),u=0,m=g.length;u<m;u++)g[u]=d.charCodeAt(u);return g},a.buf2string=function(d,g){var u,m,p,v,h=g||d.length,b=new Array(2*h);for(u=m=0;u<h;)if((p=d[u++])<128)b[m++]=p;else if(4<(v=l[p]))b[m++]=65533,u+=v-1;else{for(p&=v===2?31:v===3?15:7;1<v&&u<h;)p=p<<6|63&d[u++],v--;1<v?b[m++]=65533:p<65536?b[m++]=p:(p-=65536,b[m++]=55296|p>>10&1023,b[m++]=56320|1023&p)}return f(b,m)},a.utf8border=function(d,g){var u;for((g=g||d.length)>d.length&&(g=d.length),u=g-1;0<=u&&(192&d[u])==128;)u--;return u<0||u===0?g:u+l[d[u]]>g?u:g}},{"./common":41}],43:[function(e,n,a){n.exports=function(i,s,o,l){for(var c=65535&i|0,f=i>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;f=f+(c=c+s[l++]|0)|0,--d;);c%=65521,f%=65521}return c|f<<16|0}},{}],44:[function(e,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,a){var i=function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o}();n.exports=function(s,o,l,c){var f=i,d=c+l;s^=-1;for(var g=c;g<d;g++)s=s>>>8^f[255&(s^o[g])];return-1^s}},{}],46:[function(e,n,a){var i,s=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),f=e("./messages"),d=0,g=4,u=0,m=-2,p=-1,v=4,h=2,b=8,y=9,$=286,k=30,N=19,j=2*$+1,z=15,A=3,O=258,q=O+A+1,F=42,L=113,_=1,W=2,st=3,V=4;function ot(w,H){return w.msg=f[H],H}function G(w){return(w<<1)-(4<w?9:0)}function ft(w){for(var H=w.length;0<=--H;)w[H]=0}function R(w){var H=w.state,M=H.pending;M>w.avail_out&&(M=w.avail_out),M!==0&&(s.arraySet(w.output,H.pending_buf,H.pending_out,M,w.next_out),w.next_out+=M,H.pending_out+=M,w.total_out+=M,w.avail_out-=M,H.pending-=M,H.pending===0&&(H.pending_out=0))}function B(w,H){o._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,H),w.block_start=w.strstart,R(w.strm)}function lt(w,H){w.pending_buf[w.pending++]=H}function U(w,H){w.pending_buf[w.pending++]=H>>>8&255,w.pending_buf[w.pending++]=255&H}function X(w,H){var M,S,C=w.max_chain_length,P=w.strstart,Z=w.prev_length,Y=w.nice_match,T=w.strstart>w.w_size-q?w.strstart-(w.w_size-q):0,J=w.window,at=w.w_mask,tt=w.prev,I=w.strstart+O,rt=J[P+Z-1],it=J[P+Z];w.prev_length>=w.good_match&&(C>>=2),Y>w.lookahead&&(Y=w.lookahead);do if(J[(M=H)+Z]===it&&J[M+Z-1]===rt&&J[M]===J[P]&&J[++M]===J[P+1]){P+=2,M++;do;while(J[++P]===J[++M]&&J[++P]===J[++M]&&J[++P]===J[++M]&&J[++P]===J[++M]&&J[++P]===J[++M]&&J[++P]===J[++M]&&J[++P]===J[++M]&&J[++P]===J[++M]&&P<I);if(S=O-(I-P),P=I-O,Z<S){if(w.match_start=H,Y<=(Z=S))break;rt=J[P+Z-1],it=J[P+Z]}}while((H=tt[H&at])>T&&--C!=0);return Z<=w.lookahead?Z:w.lookahead}function St(w){var H,M,S,C,P,Z,Y,T,J,at,tt=w.w_size;do{if(C=w.window_size-w.lookahead-w.strstart,w.strstart>=tt+(tt-q)){for(s.arraySet(w.window,w.window,tt,tt,0),w.match_start-=tt,w.strstart-=tt,w.block_start-=tt,H=M=w.hash_size;S=w.head[--H],w.head[H]=tt<=S?S-tt:0,--M;);for(H=M=tt;S=w.prev[--H],w.prev[H]=tt<=S?S-tt:0,--M;);C+=tt}if(w.strm.avail_in===0)break;if(Z=w.strm,Y=w.window,T=w.strstart+w.lookahead,J=C,at=void 0,at=Z.avail_in,J<at&&(at=J),M=at===0?0:(Z.avail_in-=at,s.arraySet(Y,Z.input,Z.next_in,at,T),Z.state.wrap===1?Z.adler=l(Z.adler,Y,at,T):Z.state.wrap===2&&(Z.adler=c(Z.adler,Y,at,T)),Z.next_in+=at,Z.total_in+=at,at),w.lookahead+=M,w.lookahead+w.insert>=A)for(P=w.strstart-w.insert,w.ins_h=w.window[P],w.ins_h=(w.ins_h<<w.hash_shift^w.window[P+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[P+A-1])&w.hash_mask,w.prev[P&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=P,P++,w.insert--,!(w.lookahead+w.insert<A)););}while(w.lookahead<q&&w.strm.avail_in!==0)}function Nt(w,H){for(var M,S;;){if(w.lookahead<q){if(St(w),w.lookahead<q&&H===d)return _;if(w.lookahead===0)break}if(M=0,w.lookahead>=A&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+A-1])&w.hash_mask,M=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),M!==0&&w.strstart-M<=w.w_size-q&&(w.match_length=X(w,M)),w.match_length>=A)if(S=o._tr_tally(w,w.strstart-w.match_start,w.match_length-A),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=A){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+A-1])&w.hash_mask,M=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else S=o._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(S&&(B(w,!1),w.strm.avail_out===0))return _}return w.insert=w.strstart<A-1?w.strstart:A-1,H===g?(B(w,!0),w.strm.avail_out===0?st:V):w.last_lit&&(B(w,!1),w.strm.avail_out===0)?_:W}function wt(w,H){for(var M,S,C;;){if(w.lookahead<q){if(St(w),w.lookahead<q&&H===d)return _;if(w.lookahead===0)break}if(M=0,w.lookahead>=A&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+A-1])&w.hash_mask,M=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=A-1,M!==0&&w.prev_length<w.max_lazy_match&&w.strstart-M<=w.w_size-q&&(w.match_length=X(w,M),w.match_length<=5&&(w.strategy===1||w.match_length===A&&4096<w.strstart-w.match_start)&&(w.match_length=A-1)),w.prev_length>=A&&w.match_length<=w.prev_length){for(C=w.strstart+w.lookahead-A,S=o._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-A),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=C&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+A-1])&w.hash_mask,M=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=A-1,w.strstart++,S&&(B(w,!1),w.strm.avail_out===0))return _}else if(w.match_available){if((S=o._tr_tally(w,0,w.window[w.strstart-1]))&&B(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return _}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(S=o._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<A-1?w.strstart:A-1,H===g?(B(w,!0),w.strm.avail_out===0?st:V):w.last_lit&&(B(w,!1),w.strm.avail_out===0)?_:W}function kt(w,H,M,S,C){this.good_length=w,this.max_lazy=H,this.nice_length=M,this.max_chain=S,this.func=C}function jt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*j),this.dyn_dtree=new s.Buf16(2*(2*k+1)),this.bl_tree=new s.Buf16(2*(2*N+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(z+1),this.heap=new s.Buf16(2*$+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*$+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dt(w){var H;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=h,(H=w.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?F:L,w.adler=H.wrap===2?0:1,H.last_flush=d,o._tr_init(H),u):ot(w,m)}function Jt(w){var H=Dt(w);return H===u&&function(M){M.window_size=2*M.w_size,ft(M.head),M.max_lazy_match=i[M.level].max_lazy,M.good_match=i[M.level].good_length,M.nice_match=i[M.level].nice_length,M.max_chain_length=i[M.level].max_chain,M.strstart=0,M.block_start=0,M.lookahead=0,M.insert=0,M.match_length=M.prev_length=A-1,M.match_available=0,M.ins_h=0}(w.state),H}function Ut(w,H,M,S,C,P){if(!w)return m;var Z=1;if(H===p&&(H=6),S<0?(Z=0,S=-S):15<S&&(Z=2,S-=16),C<1||y<C||M!==b||S<8||15<S||H<0||9<H||P<0||v<P)return ot(w,m);S===8&&(S=9);var Y=new jt;return(w.state=Y).strm=w,Y.wrap=Z,Y.gzhead=null,Y.w_bits=S,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=C+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+A-1)/A),Y.window=new s.Buf8(2*Y.w_size),Y.head=new s.Buf16(Y.hash_size),Y.prev=new s.Buf16(Y.w_size),Y.lit_bufsize=1<<C+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new s.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=H,Y.strategy=P,Y.method=M,Jt(w)}i=[new kt(0,0,0,0,function(w,H){var M=65535;for(M>w.pending_buf_size-5&&(M=w.pending_buf_size-5);;){if(w.lookahead<=1){if(St(w),w.lookahead===0&&H===d)return _;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var S=w.block_start+M;if((w.strstart===0||w.strstart>=S)&&(w.lookahead=w.strstart-S,w.strstart=S,B(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-q&&(B(w,!1),w.strm.avail_out===0))return _}return w.insert=0,H===g?(B(w,!0),w.strm.avail_out===0?st:V):(w.strstart>w.block_start&&(B(w,!1),w.strm.avail_out),_)}),new kt(4,4,8,4,Nt),new kt(4,5,16,8,Nt),new kt(4,6,32,32,Nt),new kt(4,4,16,16,wt),new kt(8,16,32,32,wt),new kt(8,16,128,128,wt),new kt(8,32,128,256,wt),new kt(32,128,258,1024,wt),new kt(32,258,258,4096,wt)],a.deflateInit=function(w,H){return Ut(w,H,b,15,8,0)},a.deflateInit2=Ut,a.deflateReset=Jt,a.deflateResetKeep=Dt,a.deflateSetHeader=function(w,H){return w&&w.state?w.state.wrap!==2?m:(w.state.gzhead=H,u):m},a.deflate=function(w,H){var M,S,C,P;if(!w||!w.state||5<H||H<0)return w?ot(w,m):m;if(S=w.state,!w.output||!w.input&&w.avail_in!==0||S.status===666&&H!==g)return ot(w,w.avail_out===0?-5:m);if(S.strm=w,M=S.last_flush,S.last_flush=H,S.status===F)if(S.wrap===2)w.adler=0,lt(S,31),lt(S,139),lt(S,8),S.gzhead?(lt(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),lt(S,255&S.gzhead.time),lt(S,S.gzhead.time>>8&255),lt(S,S.gzhead.time>>16&255),lt(S,S.gzhead.time>>24&255),lt(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),lt(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(lt(S,255&S.gzhead.extra.length),lt(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(w.adler=c(w.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(lt(S,0),lt(S,0),lt(S,0),lt(S,0),lt(S,0),lt(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),lt(S,3),S.status=L);else{var Z=b+(S.w_bits-8<<4)<<8;Z|=(2<=S.strategy||S.level<2?0:S.level<6?1:S.level===6?2:3)<<6,S.strstart!==0&&(Z|=32),Z+=31-Z%31,S.status=L,U(S,Z),S.strstart!==0&&(U(S,w.adler>>>16),U(S,65535&w.adler)),w.adler=1}if(S.status===69)if(S.gzhead.extra){for(C=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>C&&(w.adler=c(w.adler,S.pending_buf,S.pending-C,C)),R(w),C=S.pending,S.pending!==S.pending_buf_size));)lt(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>C&&(w.adler=c(w.adler,S.pending_buf,S.pending-C,C)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(S.status===73)if(S.gzhead.name){C=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>C&&(w.adler=c(w.adler,S.pending_buf,S.pending-C,C)),R(w),C=S.pending,S.pending===S.pending_buf_size)){P=1;break}P=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,lt(S,P)}while(P!==0);S.gzhead.hcrc&&S.pending>C&&(w.adler=c(w.adler,S.pending_buf,S.pending-C,C)),P===0&&(S.gzindex=0,S.status=91)}else S.status=91;if(S.status===91)if(S.gzhead.comment){C=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>C&&(w.adler=c(w.adler,S.pending_buf,S.pending-C,C)),R(w),C=S.pending,S.pending===S.pending_buf_size)){P=1;break}P=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,lt(S,P)}while(P!==0);S.gzhead.hcrc&&S.pending>C&&(w.adler=c(w.adler,S.pending_buf,S.pending-C,C)),P===0&&(S.status=103)}else S.status=103;if(S.status===103&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&R(w),S.pending+2<=S.pending_buf_size&&(lt(S,255&w.adler),lt(S,w.adler>>8&255),w.adler=0,S.status=L)):S.status=L),S.pending!==0){if(R(w),w.avail_out===0)return S.last_flush=-1,u}else if(w.avail_in===0&&G(H)<=G(M)&&H!==g)return ot(w,-5);if(S.status===666&&w.avail_in!==0)return ot(w,-5);if(w.avail_in!==0||S.lookahead!==0||H!==d&&S.status!==666){var Y=S.strategy===2?function(T,J){for(var at;;){if(T.lookahead===0&&(St(T),T.lookahead===0)){if(J===d)return _;break}if(T.match_length=0,at=o._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++,at&&(B(T,!1),T.strm.avail_out===0))return _}return T.insert=0,J===g?(B(T,!0),T.strm.avail_out===0?st:V):T.last_lit&&(B(T,!1),T.strm.avail_out===0)?_:W}(S,H):S.strategy===3?function(T,J){for(var at,tt,I,rt,it=T.window;;){if(T.lookahead<=O){if(St(T),T.lookahead<=O&&J===d)return _;if(T.lookahead===0)break}if(T.match_length=0,T.lookahead>=A&&0<T.strstart&&(tt=it[I=T.strstart-1])===it[++I]&&tt===it[++I]&&tt===it[++I]){rt=T.strstart+O;do;while(tt===it[++I]&&tt===it[++I]&&tt===it[++I]&&tt===it[++I]&&tt===it[++I]&&tt===it[++I]&&tt===it[++I]&&tt===it[++I]&&I<rt);T.match_length=O-(rt-I),T.match_length>T.lookahead&&(T.match_length=T.lookahead)}if(T.match_length>=A?(at=o._tr_tally(T,1,T.match_length-A),T.lookahead-=T.match_length,T.strstart+=T.match_length,T.match_length=0):(at=o._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++),at&&(B(T,!1),T.strm.avail_out===0))return _}return T.insert=0,J===g?(B(T,!0),T.strm.avail_out===0?st:V):T.last_lit&&(B(T,!1),T.strm.avail_out===0)?_:W}(S,H):i[S.level].func(S,H);if(Y!==st&&Y!==V||(S.status=666),Y===_||Y===st)return w.avail_out===0&&(S.last_flush=-1),u;if(Y===W&&(H===1?o._tr_align(S):H!==5&&(o._tr_stored_block(S,0,0,!1),H===3&&(ft(S.head),S.lookahead===0&&(S.strstart=0,S.block_start=0,S.insert=0))),R(w),w.avail_out===0))return S.last_flush=-1,u}return H!==g?u:S.wrap<=0?1:(S.wrap===2?(lt(S,255&w.adler),lt(S,w.adler>>8&255),lt(S,w.adler>>16&255),lt(S,w.adler>>24&255),lt(S,255&w.total_in),lt(S,w.total_in>>8&255),lt(S,w.total_in>>16&255),lt(S,w.total_in>>24&255)):(U(S,w.adler>>>16),U(S,65535&w.adler)),R(w),0<S.wrap&&(S.wrap=-S.wrap),S.pending!==0?u:1)},a.deflateEnd=function(w){var H;return w&&w.state?(H=w.state.status)!==F&&H!==69&&H!==73&&H!==91&&H!==103&&H!==L&&H!==666?ot(w,m):(w.state=null,H===L?ot(w,-3):u):m},a.deflateSetDictionary=function(w,H){var M,S,C,P,Z,Y,T,J,at=H.length;if(!w||!w.state||(P=(M=w.state).wrap)===2||P===1&&M.status!==F||M.lookahead)return m;for(P===1&&(w.adler=l(w.adler,H,at,0)),M.wrap=0,at>=M.w_size&&(P===0&&(ft(M.head),M.strstart=0,M.block_start=0,M.insert=0),J=new s.Buf8(M.w_size),s.arraySet(J,H,at-M.w_size,M.w_size,0),H=J,at=M.w_size),Z=w.avail_in,Y=w.next_in,T=w.input,w.avail_in=at,w.next_in=0,w.input=H,St(M);M.lookahead>=A;){for(S=M.strstart,C=M.lookahead-(A-1);M.ins_h=(M.ins_h<<M.hash_shift^M.window[S+A-1])&M.hash_mask,M.prev[S&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=S,S++,--C;);M.strstart=S,M.lookahead=A-1,St(M)}return M.strstart+=M.lookahead,M.block_start=M.strstart,M.insert=M.lookahead,M.lookahead=0,M.match_length=M.prev_length=A-1,M.match_available=0,w.next_in=Y,w.input=T,w.avail_in=Z,M.wrap=P,u},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,a){n.exports=function(i,s){var o,l,c,f,d,g,u,m,p,v,h,b,y,$,k,N,j,z,A,O,q,F,L,_,W;o=i.state,l=i.next_in,_=i.input,c=l+(i.avail_in-5),f=i.next_out,W=i.output,d=f-(s-i.avail_out),g=f+(i.avail_out-257),u=o.dmax,m=o.wsize,p=o.whave,v=o.wnext,h=o.window,b=o.hold,y=o.bits,$=o.lencode,k=o.distcode,N=(1<<o.lenbits)-1,j=(1<<o.distbits)-1;t:do{y<15&&(b+=_[l++]<<y,y+=8,b+=_[l++]<<y,y+=8),z=$[b&N];e:for(;;){if(b>>>=A=z>>>24,y-=A,(A=z>>>16&255)===0)W[f++]=65535&z;else{if(!(16&A)){if(!(64&A)){z=$[(65535&z)+(b&(1<<A)-1)];continue e}if(32&A){o.mode=12;break t}i.msg="invalid literal/length code",o.mode=30;break t}O=65535&z,(A&=15)&&(y<A&&(b+=_[l++]<<y,y+=8),O+=b&(1<<A)-1,b>>>=A,y-=A),y<15&&(b+=_[l++]<<y,y+=8,b+=_[l++]<<y,y+=8),z=k[b&j];n:for(;;){if(b>>>=A=z>>>24,y-=A,!(16&(A=z>>>16&255))){if(!(64&A)){z=k[(65535&z)+(b&(1<<A)-1)];continue n}i.msg="invalid distance code",o.mode=30;break t}if(q=65535&z,y<(A&=15)&&(b+=_[l++]<<y,(y+=8)<A&&(b+=_[l++]<<y,y+=8)),u<(q+=b&(1<<A)-1)){i.msg="invalid distance too far back",o.mode=30;break t}if(b>>>=A,y-=A,(A=f-d)<q){if(p<(A=q-A)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break t}if(L=h,(F=0)===v){if(F+=m-A,A<O){for(O-=A;W[f++]=h[F++],--A;);F=f-q,L=W}}else if(v<A){if(F+=m+v-A,(A-=v)<O){for(O-=A;W[f++]=h[F++],--A;);if(F=0,v<O){for(O-=A=v;W[f++]=h[F++],--A;);F=f-q,L=W}}}else if(F+=v-A,A<O){for(O-=A;W[f++]=h[F++],--A;);F=f-q,L=W}for(;2<O;)W[f++]=L[F++],W[f++]=L[F++],W[f++]=L[F++],O-=3;O&&(W[f++]=L[F++],1<O&&(W[f++]=L[F++]))}else{for(F=f-q;W[f++]=W[F++],W[f++]=W[F++],W[f++]=W[F++],2<(O-=3););O&&(W[f++]=W[F++],1<O&&(W[f++]=W[F++]))}break}}break}}while(l<c&&f<g);l-=O=y>>3,b&=(1<<(y-=O<<3))-1,i.next_in=l,i.next_out=f,i.avail_in=l<c?c-l+5:5-(l-c),i.avail_out=f<g?g-f+257:257-(f-g),o.hold=b,o.bits=y}},{}],49:[function(e,n,a){var i=e("../utils/common"),s=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),f=1,d=2,g=0,u=-2,m=1,p=852,v=592;function h(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(F){var L;return F&&F.state?(L=F.state,F.total_in=F.total_out=L.total=0,F.msg="",L.wrap&&(F.adler=1&L.wrap),L.mode=m,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new i.Buf32(p),L.distcode=L.distdyn=new i.Buf32(v),L.sane=1,L.back=-1,g):u}function $(F){var L;return F&&F.state?((L=F.state).wsize=0,L.whave=0,L.wnext=0,y(F)):u}function k(F,L){var _,W;return F&&F.state?(W=F.state,L<0?(_=0,L=-L):(_=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?u:(W.window!==null&&W.wbits!==L&&(W.window=null),W.wrap=_,W.wbits=L,$(F))):u}function N(F,L){var _,W;return F?(W=new b,(F.state=W).window=null,(_=k(F,L))!==g&&(F.state=null),_):u}var j,z,A=!0;function O(F){if(A){var L;for(j=new i.Buf32(512),z=new i.Buf32(32),L=0;L<144;)F.lens[L++]=8;for(;L<256;)F.lens[L++]=9;for(;L<280;)F.lens[L++]=7;for(;L<288;)F.lens[L++]=8;for(c(f,F.lens,0,288,j,0,F.work,{bits:9}),L=0;L<32;)F.lens[L++]=5;c(d,F.lens,0,32,z,0,F.work,{bits:5}),A=!1}F.lencode=j,F.lenbits=9,F.distcode=z,F.distbits=5}function q(F,L,_,W){var st,V=F.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new i.Buf8(V.wsize)),W>=V.wsize?(i.arraySet(V.window,L,_-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(W<(st=V.wsize-V.wnext)&&(st=W),i.arraySet(V.window,L,_-W,st,V.wnext),(W-=st)?(i.arraySet(V.window,L,_-W,W,0),V.wnext=W,V.whave=V.wsize):(V.wnext+=st,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=st))),0}a.inflateReset=$,a.inflateReset2=k,a.inflateResetKeep=y,a.inflateInit=function(F){return N(F,15)},a.inflateInit2=N,a.inflate=function(F,L){var _,W,st,V,ot,G,ft,R,B,lt,U,X,St,Nt,wt,kt,jt,Dt,Jt,Ut,w,H,M,S,C=0,P=new i.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&F.avail_in!==0)return u;(_=F.state).mode===12&&(_.mode=13),ot=F.next_out,st=F.output,ft=F.avail_out,V=F.next_in,W=F.input,G=F.avail_in,R=_.hold,B=_.bits,lt=G,U=ft,H=g;t:for(;;)switch(_.mode){case m:if(_.wrap===0){_.mode=13;break}for(;B<16;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(2&_.wrap&&R===35615){P[_.check=0]=255&R,P[1]=R>>>8&255,_.check=o(_.check,P,2,0),B=R=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&R)<<8)+(R>>8))%31){F.msg="incorrect header check",_.mode=30;break}if((15&R)!=8){F.msg="unknown compression method",_.mode=30;break}if(B-=4,w=8+(15&(R>>>=4)),_.wbits===0)_.wbits=w;else if(w>_.wbits){F.msg="invalid window size",_.mode=30;break}_.dmax=1<<w,F.adler=_.check=1,_.mode=512&R?10:12,B=R=0;break;case 2:for(;B<16;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(_.flags=R,(255&_.flags)!=8){F.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){F.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=R>>8&1),512&_.flags&&(P[0]=255&R,P[1]=R>>>8&255,_.check=o(_.check,P,2,0)),B=R=0,_.mode=3;case 3:for(;B<32;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}_.head&&(_.head.time=R),512&_.flags&&(P[0]=255&R,P[1]=R>>>8&255,P[2]=R>>>16&255,P[3]=R>>>24&255,_.check=o(_.check,P,4,0)),B=R=0,_.mode=4;case 4:for(;B<16;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}_.head&&(_.head.xflags=255&R,_.head.os=R>>8),512&_.flags&&(P[0]=255&R,P[1]=R>>>8&255,_.check=o(_.check,P,2,0)),B=R=0,_.mode=5;case 5:if(1024&_.flags){for(;B<16;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}_.length=R,_.head&&(_.head.extra_len=R),512&_.flags&&(P[0]=255&R,P[1]=R>>>8&255,_.check=o(_.check,P,2,0)),B=R=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(G<(X=_.length)&&(X=G),X&&(_.head&&(w=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),i.arraySet(_.head.extra,W,V,X,w)),512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,_.length-=X),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(G===0)break t;for(X=0;w=W[V+X++],_.head&&w&&_.length<65536&&(_.head.name+=String.fromCharCode(w)),w&&X<G;);if(512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,w)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(G===0)break t;for(X=0;w=W[V+X++],_.head&&w&&_.length<65536&&(_.head.comment+=String.fromCharCode(w)),w&&X<G;);if(512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,w)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;B<16;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(R!==(65535&_.check)){F.msg="header crc mismatch",_.mode=30;break}B=R=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),F.adler=_.check=0,_.mode=12;break;case 10:for(;B<32;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}F.adler=_.check=h(R),B=R=0,_.mode=11;case 11:if(_.havedict===0)return F.next_out=ot,F.avail_out=ft,F.next_in=V,F.avail_in=G,_.hold=R,_.bits=B,2;F.adler=_.check=1,_.mode=12;case 12:if(L===5||L===6)break t;case 13:if(_.last){R>>>=7&B,B-=7&B,_.mode=27;break}for(;B<3;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}switch(_.last=1&R,B-=1,3&(R>>>=1)){case 0:_.mode=14;break;case 1:if(O(_),_.mode=20,L!==6)break;R>>>=2,B-=2;break t;case 2:_.mode=17;break;case 3:F.msg="invalid block type",_.mode=30}R>>>=2,B-=2;break;case 14:for(R>>>=7&B,B-=7&B;B<32;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if((65535&R)!=(R>>>16^65535)){F.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&R,B=R=0,_.mode=15,L===6)break t;case 15:_.mode=16;case 16:if(X=_.length){if(G<X&&(X=G),ft<X&&(X=ft),X===0)break t;i.arraySet(st,W,V,X,ot),G-=X,V+=X,ft-=X,ot+=X,_.length-=X;break}_.mode=12;break;case 17:for(;B<14;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(_.nlen=257+(31&R),R>>>=5,B-=5,_.ndist=1+(31&R),R>>>=5,B-=5,_.ncode=4+(15&R),R>>>=4,B-=4,286<_.nlen||30<_.ndist){F.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;B<3;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}_.lens[Z[_.have++]]=7&R,R>>>=3,B-=3}for(;_.have<19;)_.lens[Z[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,M={bits:_.lenbits},H=c(0,_.lens,0,19,_.lencode,0,_.work,M),_.lenbits=M.bits,H){F.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;kt=(C=_.lencode[R&(1<<_.lenbits)-1])>>>16&255,jt=65535&C,!((wt=C>>>24)<=B);){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(jt<16)R>>>=wt,B-=wt,_.lens[_.have++]=jt;else{if(jt===16){for(S=wt+2;B<S;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(R>>>=wt,B-=wt,_.have===0){F.msg="invalid bit length repeat",_.mode=30;break}w=_.lens[_.have-1],X=3+(3&R),R>>>=2,B-=2}else if(jt===17){for(S=wt+3;B<S;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}B-=wt,w=0,X=3+(7&(R>>>=wt)),R>>>=3,B-=3}else{for(S=wt+7;B<S;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}B-=wt,w=0,X=11+(127&(R>>>=wt)),R>>>=7,B-=7}if(_.have+X>_.nlen+_.ndist){F.msg="invalid bit length repeat",_.mode=30;break}for(;X--;)_.lens[_.have++]=w}}if(_.mode===30)break;if(_.lens[256]===0){F.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,M={bits:_.lenbits},H=c(f,_.lens,0,_.nlen,_.lencode,0,_.work,M),_.lenbits=M.bits,H){F.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,M={bits:_.distbits},H=c(d,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,M),_.distbits=M.bits,H){F.msg="invalid distances set",_.mode=30;break}if(_.mode=20,L===6)break t;case 20:_.mode=21;case 21:if(6<=G&&258<=ft){F.next_out=ot,F.avail_out=ft,F.next_in=V,F.avail_in=G,_.hold=R,_.bits=B,l(F,U),ot=F.next_out,st=F.output,ft=F.avail_out,V=F.next_in,W=F.input,G=F.avail_in,R=_.hold,B=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;kt=(C=_.lencode[R&(1<<_.lenbits)-1])>>>16&255,jt=65535&C,!((wt=C>>>24)<=B);){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(kt&&!(240&kt)){for(Dt=wt,Jt=kt,Ut=jt;kt=(C=_.lencode[Ut+((R&(1<<Dt+Jt)-1)>>Dt)])>>>16&255,jt=65535&C,!(Dt+(wt=C>>>24)<=B);){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}R>>>=Dt,B-=Dt,_.back+=Dt}if(R>>>=wt,B-=wt,_.back+=wt,_.length=jt,kt===0){_.mode=26;break}if(32&kt){_.back=-1,_.mode=12;break}if(64&kt){F.msg="invalid literal/length code",_.mode=30;break}_.extra=15&kt,_.mode=22;case 22:if(_.extra){for(S=_.extra;B<S;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}_.length+=R&(1<<_.extra)-1,R>>>=_.extra,B-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;kt=(C=_.distcode[R&(1<<_.distbits)-1])>>>16&255,jt=65535&C,!((wt=C>>>24)<=B);){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(!(240&kt)){for(Dt=wt,Jt=kt,Ut=jt;kt=(C=_.distcode[Ut+((R&(1<<Dt+Jt)-1)>>Dt)])>>>16&255,jt=65535&C,!(Dt+(wt=C>>>24)<=B);){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}R>>>=Dt,B-=Dt,_.back+=Dt}if(R>>>=wt,B-=wt,_.back+=wt,64&kt){F.msg="invalid distance code",_.mode=30;break}_.offset=jt,_.extra=15&kt,_.mode=24;case 24:if(_.extra){for(S=_.extra;B<S;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}_.offset+=R&(1<<_.extra)-1,R>>>=_.extra,B-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){F.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ft===0)break t;if(X=U-ft,_.offset>X){if((X=_.offset-X)>_.whave&&_.sane){F.msg="invalid distance too far back",_.mode=30;break}St=X>_.wnext?(X-=_.wnext,_.wsize-X):_.wnext-X,X>_.length&&(X=_.length),Nt=_.window}else Nt=st,St=ot-_.offset,X=_.length;for(ft<X&&(X=ft),ft-=X,_.length-=X;st[ot++]=Nt[St++],--X;);_.length===0&&(_.mode=21);break;case 26:if(ft===0)break t;st[ot++]=_.length,ft--,_.mode=21;break;case 27:if(_.wrap){for(;B<32;){if(G===0)break t;G--,R|=W[V++]<<B,B+=8}if(U-=ft,F.total_out+=U,_.total+=U,U&&(F.adler=_.check=_.flags?o(_.check,st,U,ot-U):s(_.check,st,U,ot-U)),U=ft,(_.flags?R:h(R))!==_.check){F.msg="incorrect data check",_.mode=30;break}B=R=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;B<32;){if(G===0)break t;G--,R+=W[V++]<<B,B+=8}if(R!==(4294967295&_.total)){F.msg="incorrect length check",_.mode=30;break}B=R=0}_.mode=29;case 29:H=1;break t;case 30:H=-3;break t;case 31:return-4;case 32:default:return u}return F.next_out=ot,F.avail_out=ft,F.next_in=V,F.avail_in=G,_.hold=R,_.bits=B,(_.wsize||U!==F.avail_out&&_.mode<30&&(_.mode<27||L!==4))&&q(F,F.output,F.next_out,U-F.avail_out)?(_.mode=31,-4):(lt-=F.avail_in,U-=F.avail_out,F.total_in+=lt,F.total_out+=U,_.total+=U,_.wrap&&U&&(F.adler=_.check=_.flags?o(_.check,st,U,F.next_out-U):s(_.check,st,U,F.next_out-U)),F.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(lt==0&&U===0||L===4)&&H===g&&(H=-5),H)},a.inflateEnd=function(F){if(!F||!F.state)return u;var L=F.state;return L.window&&(L.window=null),F.state=null,g},a.inflateGetHeader=function(F,L){var _;return F&&F.state&&2&(_=F.state).wrap?((_.head=L).done=!1,g):u},a.inflateSetDictionary=function(F,L){var _,W=L.length;return F&&F.state?(_=F.state).wrap!==0&&_.mode!==11?u:_.mode===11&&s(1,L,W,0)!==_.check?-3:q(F,L,W,W)?(_.mode=31,-4):(_.havedict=1,g):u},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,a){var i=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,d,g,u,m,p,v,h){var b,y,$,k,N,j,z,A,O,q=h.bits,F=0,L=0,_=0,W=0,st=0,V=0,ot=0,G=0,ft=0,R=0,B=null,lt=0,U=new i.Buf16(16),X=new i.Buf16(16),St=null,Nt=0;for(F=0;F<=15;F++)U[F]=0;for(L=0;L<u;L++)U[d[g+L]]++;for(st=q,W=15;1<=W&&U[W]===0;W--);if(W<st&&(st=W),W===0)return m[p++]=20971520,m[p++]=20971520,h.bits=1,0;for(_=1;_<W&&U[_]===0;_++);for(st<_&&(st=_),F=G=1;F<=15;F++)if(G<<=1,(G-=U[F])<0)return-1;if(0<G&&(f===0||W!==1))return-1;for(X[1]=0,F=1;F<15;F++)X[F+1]=X[F]+U[F];for(L=0;L<u;L++)d[g+L]!==0&&(v[X[d[g+L]]++]=L);if(j=f===0?(B=St=v,19):f===1?(B=s,lt-=257,St=o,Nt-=257,256):(B=l,St=c,-1),F=_,N=p,ot=L=R=0,$=-1,k=(ft=1<<(V=st))-1,f===1&&852<ft||f===2&&592<ft)return 1;for(;;){for(z=F-ot,O=v[L]<j?(A=0,v[L]):v[L]>j?(A=St[Nt+v[L]],B[lt+v[L]]):(A=96,0),b=1<<F-ot,_=y=1<<V;m[N+(R>>ot)+(y-=b)]=z<<24|A<<16|O|0,y!==0;);for(b=1<<F-1;R&b;)b>>=1;if(b!==0?(R&=b-1,R+=b):R=0,L++,--U[F]==0){if(F===W)break;F=d[g+v[L]]}if(st<F&&(R&k)!==$){for(ot===0&&(ot=st),N+=_,G=1<<(V=F-ot);V+ot<W&&!((G-=U[V+ot])<=0);)V++,G<<=1;if(ft+=1<<V,f===1&&852<ft||f===2&&592<ft)return 1;m[$=R&k]=st<<24|V<<16|N-p|0}}return R!==0&&(m[N+R]=F-ot<<24|64<<16|0),h.bits=st,0}},{"../utils/common":41}],51:[function(e,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,a){var i=e("../utils/common"),s=0,o=1;function l(C){for(var P=C.length;0<=--P;)C[P]=0}var c=0,f=29,d=256,g=d+1+f,u=30,m=19,p=2*g+1,v=15,h=16,b=7,y=256,$=16,k=17,N=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(g+2));l(q);var F=new Array(2*u);l(F);var L=new Array(512);l(L);var _=new Array(256);l(_);var W=new Array(f);l(W);var st,V,ot,G=new Array(u);function ft(C,P,Z,Y,T){this.static_tree=C,this.extra_bits=P,this.extra_base=Z,this.elems=Y,this.max_length=T,this.has_stree=C&&C.length}function R(C,P){this.dyn_tree=C,this.max_code=0,this.stat_desc=P}function B(C){return C<256?L[C]:L[256+(C>>>7)]}function lt(C,P){C.pending_buf[C.pending++]=255&P,C.pending_buf[C.pending++]=P>>>8&255}function U(C,P,Z){C.bi_valid>h-Z?(C.bi_buf|=P<<C.bi_valid&65535,lt(C,C.bi_buf),C.bi_buf=P>>h-C.bi_valid,C.bi_valid+=Z-h):(C.bi_buf|=P<<C.bi_valid&65535,C.bi_valid+=Z)}function X(C,P,Z){U(C,Z[2*P],Z[2*P+1])}function St(C,P){for(var Z=0;Z|=1&C,C>>>=1,Z<<=1,0<--P;);return Z>>>1}function Nt(C,P,Z){var Y,T,J=new Array(v+1),at=0;for(Y=1;Y<=v;Y++)J[Y]=at=at+Z[Y-1]<<1;for(T=0;T<=P;T++){var tt=C[2*T+1];tt!==0&&(C[2*T]=St(J[tt]++,tt))}}function wt(C){var P;for(P=0;P<g;P++)C.dyn_ltree[2*P]=0;for(P=0;P<u;P++)C.dyn_dtree[2*P]=0;for(P=0;P<m;P++)C.bl_tree[2*P]=0;C.dyn_ltree[2*y]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0}function kt(C){8<C.bi_valid?lt(C,C.bi_buf):0<C.bi_valid&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0}function jt(C,P,Z,Y){var T=2*P,J=2*Z;return C[T]<C[J]||C[T]===C[J]&&Y[P]<=Y[Z]}function Dt(C,P,Z){for(var Y=C.heap[Z],T=Z<<1;T<=C.heap_len&&(T<C.heap_len&&jt(P,C.heap[T+1],C.heap[T],C.depth)&&T++,!jt(P,Y,C.heap[T],C.depth));)C.heap[Z]=C.heap[T],Z=T,T<<=1;C.heap[Z]=Y}function Jt(C,P,Z){var Y,T,J,at,tt=0;if(C.last_lit!==0)for(;Y=C.pending_buf[C.d_buf+2*tt]<<8|C.pending_buf[C.d_buf+2*tt+1],T=C.pending_buf[C.l_buf+tt],tt++,Y===0?X(C,T,P):(X(C,(J=_[T])+d+1,P),(at=j[J])!==0&&U(C,T-=W[J],at),X(C,J=B(--Y),Z),(at=z[J])!==0&&U(C,Y-=G[J],at)),tt<C.last_lit;);X(C,y,P)}function Ut(C,P){var Z,Y,T,J=P.dyn_tree,at=P.stat_desc.static_tree,tt=P.stat_desc.has_stree,I=P.stat_desc.elems,rt=-1;for(C.heap_len=0,C.heap_max=p,Z=0;Z<I;Z++)J[2*Z]!==0?(C.heap[++C.heap_len]=rt=Z,C.depth[Z]=0):J[2*Z+1]=0;for(;C.heap_len<2;)J[2*(T=C.heap[++C.heap_len]=rt<2?++rt:0)]=1,C.depth[T]=0,C.opt_len--,tt&&(C.static_len-=at[2*T+1]);for(P.max_code=rt,Z=C.heap_len>>1;1<=Z;Z--)Dt(C,J,Z);for(T=I;Z=C.heap[1],C.heap[1]=C.heap[C.heap_len--],Dt(C,J,1),Y=C.heap[1],C.heap[--C.heap_max]=Z,C.heap[--C.heap_max]=Y,J[2*T]=J[2*Z]+J[2*Y],C.depth[T]=(C.depth[Z]>=C.depth[Y]?C.depth[Z]:C.depth[Y])+1,J[2*Z+1]=J[2*Y+1]=T,C.heap[1]=T++,Dt(C,J,1),2<=C.heap_len;);C.heap[--C.heap_max]=C.heap[1],function(it,_t){var Tt,$t,Qt,Ct,yt,me,te=_t.dyn_tree,Pe=_t.max_code,Sa=_t.stat_desc.static_tree,Fa=_t.stat_desc.has_stree,Ea=_t.stat_desc.extra_bits,qn=_t.stat_desc.extra_base,Ve=_t.stat_desc.max_length,an=0;for(Ct=0;Ct<=v;Ct++)it.bl_count[Ct]=0;for(te[2*it.heap[it.heap_max]+1]=0,Tt=it.heap_max+1;Tt<p;Tt++)Ve<(Ct=te[2*te[2*($t=it.heap[Tt])+1]+1]+1)&&(Ct=Ve,an++),te[2*$t+1]=Ct,Pe<$t||(it.bl_count[Ct]++,yt=0,qn<=$t&&(yt=Ea[$t-qn]),me=te[2*$t],it.opt_len+=me*(Ct+yt),Fa&&(it.static_len+=me*(Sa[2*$t+1]+yt)));if(an!==0){do{for(Ct=Ve-1;it.bl_count[Ct]===0;)Ct--;it.bl_count[Ct]--,it.bl_count[Ct+1]+=2,it.bl_count[Ve]--,an-=2}while(0<an);for(Ct=Ve;Ct!==0;Ct--)for($t=it.bl_count[Ct];$t!==0;)Pe<(Qt=it.heap[--Tt])||(te[2*Qt+1]!==Ct&&(it.opt_len+=(Ct-te[2*Qt+1])*te[2*Qt],te[2*Qt+1]=Ct),$t--)}}(C,P),Nt(J,rt,C.bl_count)}function w(C,P,Z){var Y,T,J=-1,at=P[1],tt=0,I=7,rt=4;for(at===0&&(I=138,rt=3),P[2*(Z+1)+1]=65535,Y=0;Y<=Z;Y++)T=at,at=P[2*(Y+1)+1],++tt<I&&T===at||(tt<rt?C.bl_tree[2*T]+=tt:T!==0?(T!==J&&C.bl_tree[2*T]++,C.bl_tree[2*$]++):tt<=10?C.bl_tree[2*k]++:C.bl_tree[2*N]++,J=T,rt=(tt=0)===at?(I=138,3):T===at?(I=6,3):(I=7,4))}function H(C,P,Z){var Y,T,J=-1,at=P[1],tt=0,I=7,rt=4;for(at===0&&(I=138,rt=3),Y=0;Y<=Z;Y++)if(T=at,at=P[2*(Y+1)+1],!(++tt<I&&T===at)){if(tt<rt)for(;X(C,T,C.bl_tree),--tt!=0;);else T!==0?(T!==J&&(X(C,T,C.bl_tree),tt--),X(C,$,C.bl_tree),U(C,tt-3,2)):tt<=10?(X(C,k,C.bl_tree),U(C,tt-3,3)):(X(C,N,C.bl_tree),U(C,tt-11,7));J=T,rt=(tt=0)===at?(I=138,3):T===at?(I=6,3):(I=7,4)}}l(G);var M=!1;function S(C,P,Z,Y){U(C,(c<<1)+(Y?1:0),3),function(T,J,at,tt){kt(T),lt(T,at),lt(T,~at),i.arraySet(T.pending_buf,T.window,J,at,T.pending),T.pending+=at}(C,P,Z)}a._tr_init=function(C){M||(function(){var P,Z,Y,T,J,at=new Array(v+1);for(T=Y=0;T<f-1;T++)for(W[T]=Y,P=0;P<1<<j[T];P++)_[Y++]=T;for(_[Y-1]=T,T=J=0;T<16;T++)for(G[T]=J,P=0;P<1<<z[T];P++)L[J++]=T;for(J>>=7;T<u;T++)for(G[T]=J<<7,P=0;P<1<<z[T]-7;P++)L[256+J++]=T;for(Z=0;Z<=v;Z++)at[Z]=0;for(P=0;P<=143;)q[2*P+1]=8,P++,at[8]++;for(;P<=255;)q[2*P+1]=9,P++,at[9]++;for(;P<=279;)q[2*P+1]=7,P++,at[7]++;for(;P<=287;)q[2*P+1]=8,P++,at[8]++;for(Nt(q,g+1,at),P=0;P<u;P++)F[2*P+1]=5,F[2*P]=St(P,5);st=new ft(q,j,d+1,g,v),V=new ft(F,z,0,u,v),ot=new ft(new Array(0),A,0,m,b)}(),M=!0),C.l_desc=new R(C.dyn_ltree,st),C.d_desc=new R(C.dyn_dtree,V),C.bl_desc=new R(C.bl_tree,ot),C.bi_buf=0,C.bi_valid=0,wt(C)},a._tr_stored_block=S,a._tr_flush_block=function(C,P,Z,Y){var T,J,at=0;0<C.level?(C.strm.data_type===2&&(C.strm.data_type=function(tt){var I,rt=4093624447;for(I=0;I<=31;I++,rt>>>=1)if(1&rt&&tt.dyn_ltree[2*I]!==0)return s;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return o;for(I=32;I<d;I++)if(tt.dyn_ltree[2*I]!==0)return o;return s}(C)),Ut(C,C.l_desc),Ut(C,C.d_desc),at=function(tt){var I;for(w(tt,tt.dyn_ltree,tt.l_desc.max_code),w(tt,tt.dyn_dtree,tt.d_desc.max_code),Ut(tt,tt.bl_desc),I=m-1;3<=I&&tt.bl_tree[2*O[I]+1]===0;I--);return tt.opt_len+=3*(I+1)+5+5+4,I}(C),T=C.opt_len+3+7>>>3,(J=C.static_len+3+7>>>3)<=T&&(T=J)):T=J=Z+5,Z+4<=T&&P!==-1?S(C,P,Z,Y):C.strategy===4||J===T?(U(C,2+(Y?1:0),3),Jt(C,q,F)):(U(C,4+(Y?1:0),3),function(tt,I,rt,it){var _t;for(U(tt,I-257,5),U(tt,rt-1,5),U(tt,it-4,4),_t=0;_t<it;_t++)U(tt,tt.bl_tree[2*O[_t]+1],3);H(tt,tt.dyn_ltree,I-1),H(tt,tt.dyn_dtree,rt-1)}(C,C.l_desc.max_code+1,C.d_desc.max_code+1,at+1),Jt(C,C.dyn_ltree,C.dyn_dtree)),wt(C),Y&&kt(C)},a._tr_tally=function(C,P,Z){return C.pending_buf[C.d_buf+2*C.last_lit]=P>>>8&255,C.pending_buf[C.d_buf+2*C.last_lit+1]=255&P,C.pending_buf[C.l_buf+C.last_lit]=255&Z,C.last_lit++,P===0?C.dyn_ltree[2*Z]++:(C.matches++,P--,C.dyn_ltree[2*(_[Z]+d+1)]++,C.dyn_dtree[2*B(P)]++),C.last_lit===C.lit_bufsize-1},a._tr_align=function(C){U(C,2,3),X(C,y,q),function(P){P.bi_valid===16?(lt(P,P.bi_buf),P.bi_buf=0,P.bi_valid=0):8<=P.bi_valid&&(P.pending_buf[P.pending++]=255&P.bi_buf,P.bi_buf>>=8,P.bi_valid-=8)}(C)}},{"../utils/common":41}],53:[function(e,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,a){(function(i){(function(s,o){if(!s.setImmediate){var l,c,f,d,g=1,u={},m=!1,p=s.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(s);v=v&&v.setTimeout?v:s,l={}.toString.call(s.process)==="[object process]"?function($){process.nextTick(function(){b($)})}:function(){if(s.postMessage&&!s.importScripts){var $=!0,k=s.onmessage;return s.onmessage=function(){$=!1},s.postMessage("","*"),s.onmessage=k,$}}()?(d="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",y,!1):s.attachEvent("onmessage",y),function($){s.postMessage(d+$,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function($){b($.data)},function($){f.port2.postMessage($)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function($){var k=p.createElement("script");k.onreadystatechange=function(){b($),k.onreadystatechange=null,c.removeChild(k),k=null},c.appendChild(k)}):function($){setTimeout(b,0,$)},v.setImmediate=function($){typeof $!="function"&&($=new Function(""+$));for(var k=new Array(arguments.length-1),N=0;N<k.length;N++)k[N]=arguments[N+1];var j={callback:$,args:k};return u[g]=j,l(g),g++},v.clearImmediate=h}function h($){delete u[$]}function b($){if(m)setTimeout(b,0,$);else{var k=u[$];if(k){m=!0;try{(function(N){var j=N.callback,z=N.args;switch(z.length){case 0:j();break;case 1:j(z[0]);break;case 2:j(z[0],z[1]);break;case 3:j(z[0],z[1],z[2]);break;default:j.apply(o,z)}})(k)}finally{h($),m=!1}}}}function y($){$.source===s&&typeof $.data=="string"&&$.data.indexOf(d)===0&&b(+$.data.slice(d.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ur);var za=Ur.exports;const Xn=Ra(za);class Ia{constructor(t,e){this.app=t,this.settings=e}get maxBackups(){var t;return((t=this.settings)==null?void 0:t.maxBackups)??5}get maxBackupAgeDays(){var t;return((t=this.settings)==null?void 0:t.maxBackupAgeDays)??30}async createBackup(t,e,n){try{const a=this.app.vault.getAbstractFileByPath(t);if(!a||!(a instanceof D.TFolder))return x(`${E} Draft folder not found: ${t}`),!1;const i=this.getAllFilesInFolder(a);if(i.length===0)return x(`${E} No files to backup in: ${t}`),!1;const s=t.split("/")[0]||"unknown",o=t.split("/")[1]||"drafts",l=`${Ae(n)}/${s}/${o}/${e}`;await this.app.vault.adapter.exists(l)||await this.app.vault.createFolder(l);const d=`${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}${Ye}`,g=`${l}/${d}`,u=new Xn;for(const v of i){const h=v.path.substring(t.length+1),b=await this.app.vault.read(v);u.file(h,b)}const m=await u.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}),p=new Uint8Array(m).buffer;return await this.app.vault.createBinary(g,p),x(`${E} Created backup: ${g}`),!0}catch(a){return x(`${E} Failed to create backup:`,a),!1}}async listBackups(t,e,n){x(`${E} listBackups called for draftFolder: ${t}, draftId: ${e}`);try{const a=t.split("/")[0]||"unknown",i=t.split("/")[1]||"drafts",s=`${Ae(n)}/${a}/${i}/${e}`,o=this.app.vault.getAbstractFileByPath(s);if(!o||!(o instanceof D.TFolder))return[];const l=[];for(const f of o.children)if(f instanceof D.TFile&&f.name.endsWith(Ye)){const d=f.name.match(Ir);d&&l.push(d[1])}const c=l.sort().reverse();return x(`${E} listBackups found ${c.length} backups for ${e}`),c}catch(a){return x(`${E} Failed to list backups:`,a),[]}}async restoreBackup(t,e,n,a){x(`${E} restoreBackup called for draftFolder: ${t}, draftId: ${e}, timestamp: ${n}`);try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${Ae(a)}/${i}/${s}/${e}`,l=`${n}${Ye}`,c=`${o}/${l}`;if(!await this.app.vault.adapter.stat(c))return x(`${E} Backup file not found: ${c}`),!1;const d=await this.app.vault.adapter.readBinary(c),g=await Xn.loadAsync(d);this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);for(const[m,p]of Object.entries(g.files))if(p.dir){const v=`${t}/${m}`;this.app.vault.getAbstractFileByPath(v)||await this.app.vault.createFolder(v)}else{const v=await p.async("text"),h=`${t}/${m}`,b=h.substring(0,h.lastIndexOf("/"));this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b);const y=this.app.vault.getAbstractFileByPath(h);y&&y instanceof D.TFile?await this.app.vault.modify(y,v):await this.app.vault.create(h,v)}return x(`${E} Restored backup: ${c}`),!0}catch(i){return x(`${E} Failed to restore backup:`,i),!1}}async deleteBackup(t,e,n,a){x(`${E} deleteBackup called for draftFolder: ${t}, draftId: ${e}, timestamp: ${n}`);try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${Ae(a)}/${i}/${s}/${e}`,l=`${n}${Ye}`,c=`${o}/${l}`;return await this.app.vault.adapter.stat(c)?(await this.app.vault.adapter.remove(c),x(`${E} Deleted backup: ${c}`),!0):(x(`${E} Backup file not found for deletion: ${c}`),!1)}catch(i){return x(`${E} Failed to delete backup:`,i),!1}}async clearOldBackups(t,e,n){x(`${E} clearOldBackups called for draftFolder: ${t}, draftId: ${e}`);try{const a=await this.listBackups(t,e,n),i=new Date;i.setDate(i.getDate()-this.maxBackupAgeDays);let s=0;for(const o of a)new Date(o.replace(/-/g,":"))<i&&(await this.deleteBackup(t,e,o,n),s++);x(`${E} clearOldBackups removed ${s} old backups for ${e}`)}catch(a){x(`${E} Failed to clear old backups:`,a)}}getAllFilesInFolder(t){const e=[];function n(a){for(const i of a.children)i instanceof D.TFile?e.push(i):i instanceof D.TFolder&&n(i)}return n(t),e}}class La{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null}async reorderChapters(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;for(let o=0;o<n.length;o++){const{chapterName:l}=n[o],c=`${s}/${l}${bt}`,f=this.app.vault.getAbstractFileByPath(c);if(f&&f instanceof D.TFile){let d=await this.app.vault.read(f);d.match(Rt)&&(d=d.replace(Rt,(g,u)=>{let m=u.replace(/^order:.*\n?/gm,"");return m.endsWith(`
`)||(m+=`
`),m+=`order: ${o+1}
`,`${Ft}
${m}${Ft}`}),await this.app.vault.modify(f,d))}}return!0}async listChapters(t,e){x(`${E} ChapterFileService.listChapters: projectPath=${t}, draftName=${e}`);const n=this.resolveProjectPath(t);if(!n)return x(`${E} ChapterFileService.listChapters: no project resolved`),[];const a=this.getDraftsFolderName(n);if(!a)return x(`${E} ChapterFileService.listChapters: no drafts folder found in project ${n}`),[];const i=`${n}/${a}/${e}`;x(`${E} ChapterFileService.listChapters: resolved project=${n}, draftsFolder=${a}, draftFolder=${i}`);const s=this.app.vault.getAbstractFileByPath(i),o=[];if(s&&s instanceof D.TFolder){x(`${E} ChapterFileService.listChapters: found folder with ${s.children.length} children`);for(const l of s.children)l instanceof D.TFile&&l.extension===bt.slice(1)&&(x(`${E} ChapterFileService.listChapters: processing file ${l.path}`),await Ot(async()=>{const c=await this.app.vault.read(l);x(`${E} ChapterFileService.listChapters: content length ${c.length}`);const f=c.match(Rt);let d,g;if(f){x(`${E} ChapterFileService.listChapters: found frontmatter`);const p=f[1].split(/\r?\n/);for(const v of p){const h=v.match(/^order:\s*(\d+)/i);h&&(d=parseInt(h[1],10));const b=v.match(/^chapter_name:\s*(.*)$/i);if(b){let y=b[1].trim();(y.startsWith('"')&&y.endsWith('"')||y.startsWith("'")&&y.endsWith("'"))&&(y=y.slice(1,-1)),y.length>0&&(g=y)}}}else x(`${E} ChapterFileService.listChapters: no frontmatter`);x(`${E} ChapterFileService.listChapters: parsed order=${d}, chapterName=${g}`);const u=g&&g.length>0?g:l.name.replace(new RegExp(`\\${bt}$`),""),m=typeof d=="number"&&!isNaN(d)?d:0;x(`${E} ChapterFileService.listChapters: adding chapter ${l.name} with name ${u}, order ${m}`),o.push({name:l.name.replace(new RegExp(`\\${bt}$`),""),chapterName:u,order:m})}))}else x(`${E} ChapterFileService.listChapters: no folder found`);return o.sort((l,c)=>l.order-c.order),x(`${E} ChapterFileService.listChapters: returning ${o.length} chapters`),o.map(({name:l,chapterName:c})=>({name:l,chapterName:c}))}async createChapter(t,e,n,a){x(`${E} createChapter called: chapterName=${n}, draft=${e}`);const i=this.resolveProjectPath(t);if(!i)return x(`${E} createChapter: no project resolved`),!1;const s=this.getDraftsFolderName(i);if(!s)return x(`${E} createChapter: no drafts folder found`),!1;const o=`${i}/${s}/${e}`,c=`${ae(n,a==null?void 0:a.slugStyle)}${bt}`,f=`${o}/${c}`;if(this.app.vault.getAbstractFileByPath(f))return x(`${E} createChapter: file already exists at ${f}`),!1;let d=0;const g=this.app.vault.getAbstractFileByPath(o);if(g&&g instanceof D.TFolder)for(const v of g.children)v instanceof D.TFile&&v.extension===bt.slice(1)&&await Ot(async()=>{const b=(await this.app.vault.read(v)).match(Rt);if(b){const y=b[1].split(/\r?\n/);for(const $ of y){const k=$.match(/^order:\s*(\d+)/i);if(k){const N=parseInt(k[1],10);!isNaN(N)&&N>d&&(d=N)}}}});const u=d+1;let m=`# ${n}`;const p=`${Ft}
order: ${u}
chapter_name: ${JSON.stringify(n)}
${Ft}
`;return await this.app.vault.create(f,`${p}
${m}

`),x(`${E} createChapter: created ${f} with order ${u}`),!0}async deleteChapter(t,e,n){x(`${E} deleteChapter called: chapterName=${n}, draft=${e}`);const a=this.resolveProjectPath(t);if(!a)return x(`${E} deleteChapter: no project resolved`),!1;const i=this.getDraftsFolderName(a);if(!i)return x(`${E} deleteChapter: no drafts folder found`),!1;const s=`${a}/${i}/${e}`,o=`${n}${bt}`,l=`${s}/${o}`,c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof D.TFile){await this.app.vault.delete(c);const f=await this.listChapters(t,e);for(let d=0;d<f.length;d++){const{name:g}=f[d],u=`${s}/${g}${bt}`,m=this.app.vault.getAbstractFileByPath(u);if(m&&m instanceof D.TFile){let p=await this.app.vault.read(m);p.match(Rt)&&(p=p.replace(Rt,(v,h)=>{let b=h.replace(/^order:.*\n?/gm,"");return b.endsWith(`
`)||(b+=`
`),b+=`order: ${d+1}
`,`${Ft}
${b}${Ft}`}),await this.app.vault.modify(m,p))}}return!0}return!1}async renameChapter(t,e,n,a){x(`${E} renameChapter called: ${n} -> ${a}`);const i=this.resolveProjectPath(t);if(!i)return x(`${E} renameChapter: no project resolved`),!1;const s=this.getDraftsFolderName(i);if(!s)return x(`${E} renameChapter: no drafts folder found`),!1;const o=`${i}/${s}/${e}`,l=`${o}/${n}${bt}`,c=`${o}/${a}${bt}`,f=this.app.vault.getAbstractFileByPath(l);if(!f||!(f instanceof D.TFile))return x(`${E} renameChapter: file not found at ${l}`),!1;let d=await this.app.vault.read(f),g=`# ${a}`;return d.match(Rt)&&(d=d.replace(Rt,(u,m)=>{let p=m.replace(/^chapter_name:.*\n?/gm,"");return p.endsWith(`
`)||(p+=`
`),p+=`chapter_name: ${JSON.stringify(a)}
`,`${Ft}
${p}${Ft}`})),d=d.replace(/^#.*$/m,g),n!==a?(await this.app.vault.create(c,d),await this.app.vault.delete(f)):await this.app.vault.modify(f,d),!0}async openChapter(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}/${n}${bt}`,o=this.app.vault.getAbstractFileByPath(s);return o&&o instanceof D.TFile?(await Ot(async()=>{await this.app.workspace.getLeaf().openFile(o)}),!0):!1}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=At((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof D.TFolder){for(const i of e.children)if(i instanceof D.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}}class Wr{constructor(t){this.app=t,x(`${E} TemplateService created`)}async render(t,e={}){let n=t||"";return x(`${E} TemplateService.render called with template: "${n.substring(0,100)}${n.length>100?"...":""}", vars:`,Object.keys(e)),!n.includes("{{")&&!n.includes("}}")?(x(`${E} Template doesn't contain template syntax, checking if it's a file path`),await Ot(async()=>{const a=this.app.vault.getAbstractFileByPath(n);a&&a instanceof D.TFile?(x(`${E} Reading template from file: ${n}`),n=await this.app.vault.read(a),x(`${E} Template loaded from file, length: ${n.length} chars`)):x(`${E} Template path "${n}" is not a valid file, treating as inline template`)})):x(`${E} Template contains template syntax, treating as inline template`),x(`${E} Performing template variable substitution`),n=n.replace(/{{\s*(\w+(?:[-:]\w+)*)\s*}}/g,(a,i)=>{if(e[i]!==void 0)return x(`${E} Substituting variable {{${i}}} with provided value: "${e[i]}"`),e[i];try{const s=window.moment().format(i);return x(`${E} Substituting {{${i}}} with moment.js format: "${s}"`),s}catch{return x(`${E} Neither variable nor moment.js format found for {{${i}}}, returning as-is`),i}}),x(`${E} Template rendering complete, result length: ${n.length} chars`),n}}async function De(r,t){const e=r.vault.getAbstractFileByPath(t);if(!e||!(e instanceof D.TFile))return null;try{const n=await r.vault.read(e);return Ma(n)}catch(n){return x(`${E} Error reading meta file:`,n),null}}async function Un(r,t,e){const n=Ua(e),a=r.vault.getAbstractFileByPath(t);a&&a instanceof D.TFile?await r.vault.modify(a,n):await r.vault.create(t,n)}async function Ke(r,t,e,n,a){const i=`${t}/${ie(a)}`;let s=await De(r,i);s||(s={total_drafts:0});const o=At(a),l=r.vault.getAbstractFileByPath(`${t}/${o}`);if(l&&l instanceof D.TFolder){const c=l.children.filter(f=>f instanceof D.TFolder);s.total_drafts=c.length}e!==void 0&&(s.current_active_draft=e,s.active_draft_last_modified=new Date().toISOString()),n&&Object.assign(s,n),s.total_drafts>0&&s.total_word_count&&(s.average_draft_word_count=Math.round(s.total_word_count/s.total_drafts)),await Un(r,i,s)}function Ma(r){const t=r.match(new RegExp(`${Ft}\\s*\\n([\\s\\S]*?)\\n${Ft}`));if(!t)return null;const e=t[1],n={},a=e.split(`
`);for(const i of a){const s=i.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(s){const o=s[1];let l=s[2].trim();/^-?\d+(\.\d+)?$/.test(l)?l=Number(l):(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),n[o]=l}}return n}function Ua(r){const t=[Ft];if(r.current_active_draft!==void 0&&t.push(`current_active_draft: "${r.current_active_draft}"`),t.push(`total_drafts: ${r.total_drafts}`),r.target_word_count!==void 0&&t.push(`target_word_count: ${r.target_word_count}`),r.active_draft_last_modified!==void 0&&t.push(`active_draft_last_modified: "${r.active_draft_last_modified}"`),r.total_word_count!==void 0&&t.push(`total_word_count: ${r.total_word_count}`),r.average_draft_word_count!==void 0&&t.push(`average_draft_word_count: ${r.average_draft_word_count}`),r.project_type!==void 0&&t.push(`project_type: ${r.project_type}`),t.push(Ft),t.push(""),t.push("# Project Statistics"),t.push(""),r.current_active_draft&&t.push(`**Active Draft:** ${r.current_active_draft}`),t.push(`**Total Drafts:** ${r.total_drafts}`),r.target_word_count&&t.push(`**Target Word Count:** ${r.target_word_count.toLocaleString()}`),r.active_draft_last_modified){const e=new Date(r.active_draft_last_modified);t.push(`**Last Modified:** ${e.toLocaleString()}`)}return r.total_word_count&&t.push(`**Total Word Count:** ${r.total_word_count.toLocaleString()}`),r.average_draft_word_count&&t.push(`**Average Draft Word Count:** ${r.average_draft_word_count.toLocaleString()}`),t.push(""),t.join(`
`)}const Tn=Object.freeze(Object.defineProperty({__proto__:null,readMetaFile:De,updateMetaStats:Ke,writeMetaFile:Un},Symbol.toStringTag,{value:"Module"}));class un{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null,this.tpl=new Wr(t),this.projectFileService=new Wn(t,this)}async createProject(t,e,n,a,i){if(x(`${E} createProject called: projectName=${t}, singleFile=${e}`),!t)return x(`${E} createProject: project name is empty`),new D.Notice("Project name is required."),null;const s=a&&a!==""?`${a}/${t}`:t,o=`${s}/${At(i)}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);const l=`${s}/${ie(i)}`;if(!this.app.vault.getAbstractFileByPath(l)){const f=e?Ht.SINGLE:Ht.MULTI,d=e?(i==null?void 0:i.defaultSingleTargetWordCount)??2e4:(i==null?void 0:i.defaultMultiTargetWordCount)??5e4,g=`${Ft}
project_type: ${f}
target_word_count: ${d}
${Ft}
`;await this.app.vault.create(l,g)}const c=n||"Draft 1";return await this.projectFileService.drafts.createDraft(c,void 0,s,i),s}async openProject(t){var s,o;const e=`${t}/${ie((s=this.manager)==null?void 0:s.settings)}`,n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(n),!0;const a=Te((o=this.manager)==null?void 0:o.settings),i=[`${t}/${t}${bt}`,`${t}/Chapter 1${bt}`,`${t}/Chapter 01${bt}`,`${t}/${a}`,`${t}/${At()}/Draft 1/${a}`];for(const l of i){const c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(c),!0}return new D.Notice("Could not find a file to open in the project."),!1}listAllFolders(){const t=this.app.vault.getRoot(),e=[""];function n(a){for(const i of a.children)i instanceof D.TFolder&&(e.push(i.path),n(i))}return n(t),e}async listProjects(){const t=this.listAllFolders(),e=t.filter(a=>!!a);x(`${E} allFolders:`,t),x(`${E} filteredFolders:`,e);const n=await Oe(e,a=>this.isProjectFolder(a));return x(`${E} found ${e.length} folders, ${n.length} projects:`,n),n}async getProjectType(t){const e=`${t}/${ie()}`,n=await De(this.app,e);if(n&&n.project_type){const a=n.project_type;if(Object.values(Ht).includes(a))return a}return null}getDraftsFolder(t){const e=`${t}/${At()}`;let n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof D.TFolder)return n;const a=`${t}/Drafts`;return n=this.app.vault.getAbstractFileByPath(a),n&&n instanceof D.TFolder?n:null}async getManuscriptsFolder(t){const e=`${t}/${Mn()}`,n=this.app.vault.getAbstractFileByPath(e);return n&&n instanceof D.TFolder?n:null}async isProjectFolder(t){if(!t||typeof t!="string")return x(`${E} isProjectFolder: invalid path`),!1;const e=t.trim().replace(/\\/g,"/").replace(/\/+$/,"");try{const n=D.normalizePath(`${e}/${ie()}`),a=await this.app.vault.adapter.exists(n),i=D.normalizePath(`${e}/${At()}`);let s=await this.app.vault.adapter.exists(i);if(!s){const o=D.normalizePath(`${e}/Drafts`);s=await this.app.vault.adapter.exists(o)}if(!a&&!s)return x(`${E} isProjectFolder ${t}: no meta.md or drafts folder found`),!1;if(a)try{const{readMetaFile:o}=await Promise.resolve().then(()=>Tn),{VALID_PROJECT_TYPES:l}=await Promise.resolve().then(()=>Na),c=await o(this.app,n);if(!c||!l.includes(c.project_type))return!1}catch{return!1}return!0}catch{return!1}}}class Wa{constructor(t,e,n,a){var i,s,o;this.app=t,this.tpl=new Wr(t),this.projectSvc=n,this.backupSvc=a,this.chapters=e,this.manager=((o=(s=(i=this.app.plugins).getPlugin)==null?void 0:s.call(i,"obsidian-writeaid-plugin"))==null?void 0:o.manager)??null}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=At((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof D.TFolder){for(const i of e.children)if(i instanceof D.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}async suggestNextDraftName(t){var i;const e=this.resolveProjectPath(t);if(!e)return"Draft 1";const n=`${e}/${ie((i=this.manager)==null?void 0:i.settings)}`;let a=0;return await Ot(async()=>{const s=await De(this.app,n);s&&typeof s.total_drafts=="number"&&(a=s.total_drafts)}),`Draft ${a+1}`}async createDraft(t,e,n,a){var d,g,u;x(`${E} createDraft called with draftName: ${t}, copyFromDraft: ${e}`);const i=this.resolveProjectPath(n);if(!i){x(`${E} createDraft: no project path resolved`),new D.Notice("No project folder detected. Please open a folder named after your project.");return}const o=this.getDraftsFolderName(i)||At((d=this.manager)==null?void 0:d.settings),l=`${i}/${o}`,c=`${l}/${t}`,f=i.split("/").pop()||i;if(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),e){x(`${E} createDraft: copying from draft ${e}`);const m=`${l}/${e}`,p=this.app.vault.getFiles().filter(b=>b.path.startsWith(m)),h=`${ae(e,a==null?void 0:a.slugStyle)}${bt}`;for(const b of p){let y=b.path.substring(m.length+1);y===h&&(y=`${ae(t,a==null?void 0:a.slugStyle)}${bt}`);const $=`${c}/${y}`,k=$.substring(0,$.lastIndexOf("/"));k!==c&&!this.app.vault.getAbstractFileByPath(k)&&await this.app.vault.createFolder(k);let N=await this.app.vault.read(b);N=Za(N,t,f),await this.app.vault.create($,N)}}else{if((a==null?void 0:a.includeDraftOutline)===!0){const v=(a==null?void 0:a.outlineTemplate)??"",h=await this.tpl.render(v,{draftName:t});await this.app.vault.create(`${c}/${Te((g=this.manager)==null?void 0:g.settings)}`,h)}if(await this.projectSvc.getProjectType(i)===Ht.SINGLE){const h=`${ae(t,a==null?void 0:a.slugStyle)}${bt}`,b=`${c}/${h}`;if(!this.app.vault.getAbstractFileByPath(b)){const y=Je(),$=`${Ft}
draft: ${t}
id: ${y}
project: ${f}
created: ${new Date().toISOString()}
${Ft}

`,k=await this.tpl.render("# {{draftName}}",{draftName:t});await this.app.vault.create(b,$+k)}}else{const v=this.app.vault.getAbstractFileByPath(c);let h=!1;if(v&&v instanceof D.TFolder){for(const b of v.children)if(b instanceof D.TFile&&b.extension===bt.slice(1)&&(await Ot(async()=>{const $=(await this.app.vault.read(b)).match(Rt);if($){const k=$[1].split(/\r?\n/);for(const N of k){const j=N.match(/^order:\s*(\d+)/i);if(j&&!isNaN(parseInt(j[1],10))){h=!0;break}}}}),h))break}h||await this.chapters.createChapter(i,t,"Chapter 1",a)}}await Ke(this.app,i,t,void 0,(u=this.manager)==null?void 0:u.settings)}listDrafts(t){var a;const e=this.resolveProjectPath(t);if(x(`${E} listDrafts called with projectPath:`,t,"resolved to:",e),!e)return[];const n=this.projectSvc.getDraftsFolder(e);if(x(`${E} getDraftsFolder for ${e} returned:`,n==null?void 0:n.path,(a=n==null?void 0:n.children)==null?void 0:a.length),n&&n instanceof D.TFolder){const i=n.children.filter(s=>s instanceof D.TFolder).map(s=>s.name);return x(`${E} found drafts:`,i),i}return[]}async getDraftId(t){x(`${E} getDraftId called for draftFolder: ${t}`);try{const e=this.app.vault.getFiles().filter(n=>n.path.startsWith(t));for(const n of e)if(n.extension===bt.slice(1)){const i=(await this.app.vault.read(n)).match(Rt);if(i){const o=i[1].match(/^id:\s*(.+?)$/m);if(o){const l=o[1].trim();return x(`${E} getDraftId found: ${l}`),l}}}return x(`${E} getDraftId: no draft ID found in ${t}`),null}catch(e){return x(`${E} getDraftId error:`,e),null}}async openDraft(t,e){var f;const n=this.resolveProjectPath(t);if(!n)return!1;const a=this.getDraftsFolderName(n);if(!a)return!1;const i=`${n}/${a}/${e}/${Te((f=this.manager)==null?void 0:f.settings)}`,s=this.app.vault.getAbstractFileByPath(i);if(await Ot(async()=>s&&s instanceof D.TFile?(await this.app.workspace.getLeaf().openFile(s),!0):!1))return!0;const l=`${n}/${a}/${e}`,c=this.app.vault.getFiles().filter(d=>d.path.startsWith(l));return c.length>0?(await this.app.workspace.getLeaf().openFile(c[0]),!0):!1}async renameDraft(t,e,n,a=!1,i){var f;x(`${E} renameDraft called: ${e} -> ${n}, renameFile: ${a}`);const s=this.resolveProjectPath(t);if(!s)return x(`${E} renameDraft: no project resolved`),!1;const o=this.getDraftsFolderName(s);if(!o)return x(`${E} renameDraft: no drafts folder found`),!1;const l=`${s}/${o}/${e}`,c=`${s}/${o}/${n}`;try{this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c);const d=this.app.vault.getFiles().filter(h=>h.path.startsWith(l));let g="";if(a){const h=i==null?void 0:i.slugStyle;g=ae(n,h)}let u=null;for(const h of d){const b=h.path.substring(l.length+1);if(h.extension===bt.slice(1)&&!b.includes("/")){u=h;break}}for(const h of d){let b=h.path.substring(l.length+1),y=`${c}/${b}`;a&&g&&h===u&&!b.includes("/")&&(b=`${g}${bt}`,y=`${c}/${b}`);let $=await this.app.vault.read(h);h.extension===bt.slice(1)&&($=$.replace(new RegExp(`^(${Ft}\\s*\\n[\\s\\S]*?\\n)(draft:.*\\n)?`,"m"),(k,N)=>N.replace(/^draft:.*\n/m,"").replace(new RegExp(`^(${Ft}\\s*\\n)`),`$1draft: ${n}
`))),await this.app.vault.create(y,$),await this.app.vault.delete(h)}const m=this.app.vault.getAbstractFileByPath(l);m&&m instanceof D.TFolder&&await this.app.vault.delete(m,!0),await Ot(async()=>{await Promise.resolve().then(()=>Tn).then(h=>{var b;return h.updateMetaStats(this.app,s,n,void 0,(b=this.manager)==null?void 0:b.settings)})});const p=`${c}/${ie((f=this.manager)==null?void 0:f.settings)}`;return this.app.vault.getAbstractFileByPath(p)&&await Ot(async()=>{const{readMetaFile:h,writeMetaFile:b}=await Promise.resolve().then(()=>Tn),y=await h(this.app,p);y&&(y.draft=n,await b(this.app,p,y))}),!0}catch{return!1}}async deleteDraft(t,e,n=!0){var o;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;try{const l=this.app.vault.getFiles().filter(f=>f.path.startsWith(s));if(n){const f=await this.getDraftId(s);f&&await this.backupSvc.createBackup(s,f,(o=this.manager)==null?void 0:o.settings)}for(const f of l)await Ot(async()=>{await this.app.vault.delete(f)});const c=this.app.vault.getAbstractFileByPath(s);return c&&c instanceof D.TFolder&&await Ot(async()=>{await this.app.vault.delete(c)}),!0}catch{return!1}}async generateManuscript(t,e,n){var p;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=await this.projectSvc.getProjectType(a),o=`${a}/${i}/${e}`;if(!this.app.vault.getAbstractFileByPath(o))return new D.Notice(`Draft folder ${o} does not exist.`),!1;const l=`${a}/${Mn((p=this.manager)==null?void 0:p.settings)}`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);const c=a.split("/").pop()||a,f=(n==null?void 0:n.manuscriptNameTemplate)||"{{draftName}}";x(`${E} DraftFileService.generateManuscript - manuscriptNameTemplate: "${f}"`),x(`${E} DraftFileService.generateManuscript - settings object:`,n);const d=ae(e,n==null?void 0:n.slugStyle),g=await this.tpl.render(f,{draftName:e,projectName:c,draftSlug:d}),u=`${l}/${g}${bt}`;let m=`# Manuscript for ${e}

`;if(s===Ht.SINGLE){const v=`${d}${bt}`,h=`${o}/${v}`,b=this.app.vault.getAbstractFileByPath(h);if(b&&b instanceof D.TFile){const y=await this.app.vault.read(b);m+=Va(Ha(y));const $=this.app.vault.getAbstractFileByPath(u);if($&&$ instanceof D.TFile){if(!await new Mr(this.app,u).open())return!1;x(`${E} Overwriting existing manuscript: ${u}`),await this.app.vault.modify($,m)}else x(`${E} Creating new manuscript: ${u}`),await this.app.vault.create(u,m)}else return new D.Notice(`Main draft file ${h} not found.`),!1}return!0}getOutlineFile(t,e){var o;const n=this.resolveProjectPath(t);if(!n)return null;const a=this.getDraftsFolderName(n);if(!a)return null;const i=`${n}/${a}/${e}/${Te((o=this.manager)==null?void 0:o.settings)}`,s=this.app.vault.getAbstractFileByPath(i);return s&&s instanceof D.TFile?s:null}async createOutline(t,e,n){var f;const a=this.resolveProjectPath(t);if(!a)throw new Error("Project not found");const i=this.getDraftsFolderName(a);if(!i)throw new Error("Drafts folder not found");const o=`${`${a}/${i}/${e}`}/${Te((f=this.manager)==null?void 0:f.settings)}`;if(this.app.vault.getAbstractFileByPath(o))throw new Error("Outline file already exists");const c=await this.tpl.render(n,{draftName:e});await this.app.vault.create(o,c)}}function Ha(r){return r.replace(Rt,"").trim()}function Va(r){return r.replace(/^#{1,6} .*\n/,"").trim()}function Za(r,t,e){const n=r.match(Rt);if(!n)return r;const a=n[1],i=r.substring(n[0].length),s=a.split(`
`),o=[];let l=!1;for(const f of s)f.match(/^draft:/i)?o.push(`draft: ${t}`):f.match(/^id:/i)?(o.push(`id: ${Je()}`),l=!0):f.match(/^project:/i)?o.push(`project: ${e}`):f.match(/^created:/i)?o.push(`created: ${new Date().toISOString()}`):o.push(f);l||o.push(`id: ${Je()}`);const c=o.join(`
`);return`${Ft}
${c}
${Ft}${i}`}class Wn{constructor(t,e,n){this.chapters=new La(t),this.backups=new Ia(t,n),this.drafts=new Wa(t,this.chapters,e,this.backups)}}function xt(){}const Ga=r=>r;function vt(r,t){for(const e in t)r[e]=t[e];return r}function Hr(r){return r()}function Jn(){return Object.create(null)}function $e(r){r.forEach(Hr)}function tn(r){return typeof r=="function"}function Bt(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function Ya(r){return Object.keys(r).length===0}function Yt(r,t,e,n){if(r){const a=Vr(r,t,e,n);return r[0](a)}}function Vr(r,t,e,n){return r[1]&&n?vt(e.ctx.slice(),r[1](n(t))):e.ctx}function Kt(r,t,e,n){return r[2],t.dirty}function qt(r,t,e,n,a,i){if(a){const s=Vr(t,e,n,i);r.p(s,a)}}function Xt(r){if(r.ctx.length>32){const t=[],e=r.ctx.length/32;for(let n=0;n<e;n++)t[n]=-1;return t}return-1}function Pt(r){const t={};for(const e in r)e[0]!=="$"&&(t[e]=r[e]);return t}function Qn(r,t){const e={};t=new Set(t);for(const n in r)!t.has(n)&&n[0]!=="$"&&(e[n]=r[n]);return e}function on(r){return r??""}const Zr=typeof window<"u";let Ka=Zr?()=>window.performance.now():()=>Date.now(),Hn=Zr?r=>requestAnimationFrame(r):xt;const Be=new Set;function Gr(r){Be.forEach(t=>{t.c(r)||(Be.delete(t),t.f())}),Be.size!==0&&Hn(Gr)}function qa(r){let t;return Be.size===0&&Hn(Gr),{promise:new Promise(e=>{Be.add(t={c:r,f:e})}),abort(){Be.delete(t)}}}function nt(r,t){r.appendChild(t)}function Yr(r){if(!r)return document;const t=r.getRootNode?r.getRootNode():r.ownerDocument;return t&&t.host?t:r.ownerDocument}function Xa(r){const t=ct("style");return t.textContent="/* empty */",Ja(Yr(r),t),t.sheet}function Ja(r,t){return nt(r.head||r,t),t.sheet}function gt(r,t,e){r.insertBefore(t,e||null)}function pt(r){r.parentNode&&r.parentNode.removeChild(r)}function Kr(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function ct(r){return document.createElement(r)}function qr(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function It(r){return document.createTextNode(r)}function mt(){return It(" ")}function vn(){return It("")}function fe(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function et(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function dn(r,t){for(const e in t)et(r,e,t[e])}function Qa(r){return Array.from(r.childNodes)}function We(r,t){t=""+t,r.data!==t&&(r.data=t)}function hn(r,t){r.value=t??""}function ve(r,t,e,n){e==null?r.style.removeProperty(t):r.style.setProperty(t,e,"")}function ee(r,t,e){r.classList.toggle(t,!!e)}function ti(r,t,{bubbles:e=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:t,bubbles:e,cancelable:n})}const pn=new Map;let mn=0;function ei(r){let t=5381,e=r.length;for(;e--;)t=(t<<5)-t^r.charCodeAt(e);return t>>>0}function ni(r,t){const e={stylesheet:Xa(t),rules:{}};return pn.set(r,e),e}function ri(r,t,e,n,a,i,s,o=0){const l=16.666/n;let c=`{
`;for(let v=0;v<=1;v+=l){const h=t+(e-t)*i(v);c+=v*100+`%{${s(h,1-h)}}
`}const f=c+`100% {${s(e,1-e)}}
}`,d=`__svelte_${ei(f)}_${o}`,g=Yr(r),{stylesheet:u,rules:m}=pn.get(g)||ni(g,r);m[d]||(m[d]=!0,u.insertRule(`@keyframes ${d} ${f}`,u.cssRules.length));const p=r.style.animation||"";return r.style.animation=`${p?`${p}, `:""}${d} ${n}ms linear ${a}ms 1 both`,mn+=1,d}function ai(r,t){const e=(r.style.animation||"").split(", "),n=e.filter(t?i=>i.indexOf(t)<0:i=>i.indexOf("__svelte")===-1),a=e.length-n.length;a&&(r.style.animation=n.join(", "),mn-=a,mn||ii())}function ii(){Hn(()=>{mn||(pn.forEach(r=>{const{ownerNode:t}=r.stylesheet;t&&pt(t)}),pn.clear())})}function si(r,t,e,n){if(!t)return xt;const a=r.getBoundingClientRect();if(t.left===a.left&&t.right===a.right&&t.top===a.top&&t.bottom===a.bottom)return xt;const{delay:i=0,duration:s=300,easing:o=Ga,start:l=Ka()+i,end:c=l+s,tick:f=xt,css:d}=e(r,{from:t,to:a},n);let g=!0,u=!1,m;function p(){d&&(m=ri(r,0,1,s,i,o,d)),i||(u=!0)}function v(){d&&ai(r,m),g=!1}return qa(h=>{if(!u&&h>=l&&(u=!0),u&&h>=c&&(f(1,0),v()),!g)return!1;if(u){const b=h-l,y=0+1*o(b/s);f(y,1-y)}return!0}),p(),f(0,1),v}function oi(r){const t=getComputedStyle(r);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:e,height:n}=t,a=r.getBoundingClientRect();r.style.position="absolute",r.style.width=e,r.style.height=n,li(r,a)}}function li(r,t){const e=r.getBoundingClientRect();if(t.left!==e.left||t.top!==e.top){const n=getComputedStyle(r),a=n.transform==="none"?"":n.transform;r.style.transform=`${a} translate(${t.left-e.left}px, ${t.top-e.top}px)`}}let Qe;function qe(r){Qe=r}function Vn(){if(!Qe)throw new Error("Function called outside component initialization");return Qe}function ci(r){Vn().$$.on_mount.push(r)}function On(r){Vn().$$.on_destroy.push(r)}function fi(){const r=Vn();return(t,e,{cancelable:n=!1}={})=>{const a=r.$$.callbacks[t];if(a){const i=ti(t,e,{cancelable:n});return a.slice().forEach(s=>{s.call(r,i)}),!i.defaultPrevented}return!0}}const je=[],Xe=[];let Re=[];const tr=[],ui=Promise.resolve();let Bn=!1;function di(){Bn||(Bn=!0,ui.then(Xr))}function Rn(r){Re.push(r)}const Sn=new Set;let Ne=0;function Xr(){if(Ne!==0)return;const r=Qe;do{try{for(;Ne<je.length;){const t=je[Ne];Ne++,qe(t),hi(t.$$)}}catch(t){throw je.length=0,Ne=0,t}for(qe(null),je.length=0,Ne=0;Xe.length;)Xe.pop()();for(let t=0;t<Re.length;t+=1){const e=Re[t];Sn.has(e)||(Sn.add(e),e())}Re.length=0}while(je.length);for(;tr.length;)tr.pop()();Bn=!1,Sn.clear(),qe(r)}function hi(r){if(r.fragment!==null){r.update(),$e(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Rn)}}function pi(r){const t=[],e=[];Re.forEach(n=>r.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),Re=t}const cn=new Set;let Fe;function Vt(){Fe={r:0,c:[],p:Fe}}function Zt(){Fe.r||$e(Fe.c),Fe=Fe.p}function K(r,t){r&&r.i&&(cn.delete(r),r.i(t))}function Q(r,t,e,n){if(r&&r.o){if(cn.has(r))return;cn.add(r),Fe.c.push(()=>{cn.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}function _e(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function mi(r,t){r.d(1),t.delete(r.key)}function gi(r,t){Q(r,1,1,()=>{t.delete(r.key)})}function wi(r,t){r.f(),gi(r,t)}function Jr(r,t,e,n,a,i,s,o,l,c,f,d){let g=r.length,u=i.length,m=g;const p={};for(;m--;)p[r[m].key]=m;const v=[],h=new Map,b=new Map,y=[];for(m=u;m--;){const j=d(a,i,m),z=e(j);let A=s.get(z);A?y.push(()=>A.p(j,t)):(A=c(z,j),A.c()),h.set(z,v[m]=A),z in p&&b.set(z,Math.abs(m-p[z]))}const $=new Set,k=new Set;function N(j){K(j,1),j.m(o,f),s.set(j.key,j),f=j.first,u--}for(;g&&u;){const j=v[u-1],z=r[g-1],A=j.key,O=z.key;j===z?(f=j.first,g--,u--):h.has(O)?!s.has(A)||$.has(A)?N(j):k.has(O)?g--:b.get(A)>b.get(O)?(k.add(A),N(j)):($.add(O),g--):(l(z,s),g--)}for(;g--;){const j=r[g];h.has(j.key)||l(j,s)}for(;u;)N(v[u-1]);return $e(y),v}function ne(r,t){const e={},n={},a={$$scope:1};let i=r.length;for(;i--;){const s=r[i],o=t[i];if(o){for(const l in s)l in o||(n[l]=1);for(const l in o)a[l]||(e[l]=o[l],a[l]=1);r[i]=o}else for(const l in s)a[l]=1}for(const s in n)s in e||(e[s]=void 0);return e}function de(r){return typeof r=="object"&&r!==null?r:{}}function ht(r){r&&r.c()}function ut(r,t,e){const{fragment:n,after_update:a}=r.$$;n&&n.m(t,e),Rn(()=>{const i=r.$$.on_mount.map(Hr).filter(tn);r.$$.on_destroy?r.$$.on_destroy.push(...i):$e(i),r.$$.on_mount=[]}),a.forEach(Rn)}function dt(r,t){const e=r.$$;e.fragment!==null&&(pi(e.after_update),$e(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function bi(r,t){r.$$.dirty[0]===-1&&(je.push(r),di(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function Lt(r,t,e,n,a,i,s=null,o=[-1]){const l=Qe;qe(r);const c=r.$$={fragment:null,ctx:[],props:i,update:xt,not_equal:a,bound:Jn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Jn(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let f=!1;if(c.ctx=e?e(r,t.props||{},(d,g,...u)=>{const m=u.length?u[0]:g;return c.ctx&&a(c.ctx[d],c.ctx[d]=m)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](m),f&&bi(r,d)),g}):[],c.update(),f=!0,$e(c.before_update),c.fragment=n?n(c.ctx):!1,t.target){if(t.hydrate){const d=Qa(t.target);c.fragment&&c.fragment.l(d),d.forEach(pt)}else c.fragment&&c.fragment.c();t.intro&&K(r.$$.fragment),ut(r,t.target,t.anchor),Xr()}qe(l)}class Mt{constructor(){Cn(this,"$$");Cn(this,"$$set")}$destroy(){dt(this,1),this.$destroy=xt}$on(t,e){if(!tn(e))return xt;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const a=n.indexOf(e);a!==-1&&n.splice(a,1)}}$set(t){this.$$set&&!Ya(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const vi="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(vi);function _i(r){let t,e,n,a,i;const s=r[6].default,o=Yt(s,r,r[5],null);return{c(){t=ct("button"),o&&o.c(),et(t,"class",e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`),et(t,"aria-label",r[3]),t.disabled=r[1],et(t,"style",r[2])},m(l,c){gt(l,t,c),o&&o.m(t,null),n=!0,a||(i=fe(t,"click",function(){tn(r[4])&&r[4].apply(this,arguments)}),a=!0)},p(l,[c]){r=l,o&&o.p&&(!n||c&32)&&qt(o,s,r,r[5],n?Kt(s,r[5],c,null):Xt(r[5]),null),(!n||c&1&&e!==(e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`))&&et(t,"class",e),(!n||c&8)&&et(t,"aria-label",r[3]),(!n||c&2)&&(t.disabled=r[1]),(!n||c&4)&&et(t,"style",r[2])},i(l){n||(K(o,l),n=!0)},o(l){Q(o,l),n=!1},d(l){l&&pt(t),o&&o.d(l),a=!1,i()}}}function yi(r,t,e){let{$$slots:n={},$$scope:a}=t,{variant:i="default"}=t,{disabled:s=!1}=t,{style:o=""}=t,{title:l=""}=t,{clickHandler:c=void 0}=t;return r.$$set=f=>{"variant"in f&&e(0,i=f.variant),"disabled"in f&&e(1,s=f.disabled),"style"in f&&e(2,o=f.style),"title"in f&&e(3,l=f.title),"clickHandler"in f&&e(4,c=f.clickHandler),"$$scope"in f&&e(5,a=f.$$scope)},[i,s,o,l,c,a,n]}class be extends Mt{constructor(t){super(),Lt(this,t,yi,_i,Bt,{variant:0,disabled:1,style:2,title:3,clickHandler:4})}}function ki(r){let t,e,n,a,i,s,o;const l=r[7].default,c=Yt(l,r,r[6],null);return{c(){t=ct("button"),e=ct("span"),c&&c.c(),et(e,"class",n=on(r[5]?"spinning":"")+" svelte-10fbbmm"),et(t,"class",a=on(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"),et(t,"aria-label",r[0]),t.disabled=r[2],et(t,"title",r[3])},m(f,d){gt(f,t,d),nt(t,e),c&&c.m(e,null),i=!0,s||(o=fe(t,"click",function(){tn(r[4])&&r[4].apply(this,arguments)}),s=!0)},p(f,[d]){r=f,c&&c.p&&(!i||d&64)&&qt(c,l,r,r[6],i?Kt(l,r[6],d,null):Xt(r[6]),null),(!i||d&32&&n!==(n=on(r[5]?"spinning":"")+" svelte-10fbbmm"))&&et(e,"class",n),(!i||d&2&&a!==(a=on(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"))&&et(t,"class",a),(!i||d&1)&&et(t,"aria-label",r[0]),(!i||d&4)&&(t.disabled=r[2]),(!i||d&8)&&et(t,"title",r[3])},i(f){i||(K(c,f),i=!0)},o(f){Q(c,f),i=!1},d(f){f&&pt(t),c&&c.d(f),s=!1,o()}}}function $i(r,t,e){let{$$slots:n={},$$scope:a}=t,{ariaLabel:i=""}=t,{variant:s="default"}=t,{disabled:o=!1}=t,{title:l}=t,{clickHandler:c=void 0}=t,{spinning:f=!1}=t;return r.$$set=d=>{"ariaLabel"in d&&e(0,i=d.ariaLabel),"variant"in d&&e(1,s=d.variant),"disabled"in d&&e(2,o=d.disabled),"title"in d&&e(3,l=d.title),"clickHandler"in d&&e(4,c=d.clickHandler),"spinning"in d&&e(5,f=d.spinning),"$$scope"in d&&e(6,a=d.$$scope)},[i,s,o,l,c,f,a,n]}class se extends Mt{constructor(t){super(),Lt(this,t,$i,ki,Bt,{ariaLabel:0,variant:1,disabled:2,title:3,clickHandler:4,spinning:5})}}const Ie=Math.min,Wt=Math.max,gn=Math.round,ln=Math.floor,ce=r=>({x:r,y:r}),Ci={left:"right",right:"left",bottom:"top",top:"bottom"},Si={start:"end",end:"start"};function er(r,t,e){return Wt(r,Ie(t,e))}function en(r,t){return typeof r=="function"?r(t):r}function ye(r){return r.split("-")[0]}function nn(r){return r.split("-")[1]}function Qr(r){return r==="x"?"y":"x"}function ta(r){return r==="y"?"height":"width"}const Fi=new Set(["top","bottom"]);function we(r){return Fi.has(ye(r))?"y":"x"}function ea(r){return Qr(we(r))}function Ei(r,t,e){e===void 0&&(e=!1);const n=nn(r),a=ea(r),i=ta(a);let s=a==="x"?n===(e?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=wn(s)),[s,wn(s)]}function xi(r){const t=wn(r);return[zn(r),t,zn(t)]}function zn(r){return r.replace(/start|end/g,t=>Si[t])}const nr=["left","right"],rr=["right","left"],Di=["top","bottom"],Pi=["bottom","top"];function Ni(r,t,e){switch(r){case"top":case"bottom":return e?t?rr:nr:t?nr:rr;case"left":case"right":return t?Di:Pi;default:return[]}}function ji(r,t,e,n){const a=nn(r);let i=Ni(ye(r),e==="start",n);return a&&(i=i.map(s=>s+"-"+a),t&&(i=i.concat(i.map(zn)))),i}function wn(r){return r.replace(/left|right|bottom|top/g,t=>Ci[t])}function Ai(r){return{top:0,right:0,bottom:0,left:0,...r}}function Ti(r){return typeof r!="number"?Ai(r):{top:r,right:r,bottom:r,left:r}}function bn(r){const{x:t,y:e,width:n,height:a}=r;return{width:n,height:a,top:e,left:t,right:t+n,bottom:e+a,x:t,y:e}}function ar(r,t,e){let{reference:n,floating:a}=r;const i=we(t),s=ea(t),o=ta(s),l=ye(t),c=i==="y",f=n.x+n.width/2-a.width/2,d=n.y+n.height/2-a.height/2,g=n[o]/2-a[o]/2;let u;switch(l){case"top":u={x:f,y:n.y-a.height};break;case"bottom":u={x:f,y:n.y+n.height};break;case"right":u={x:n.x+n.width,y:d};break;case"left":u={x:n.x-a.width,y:d};break;default:u={x:n.x,y:n.y}}switch(nn(t)){case"start":u[s]-=g*(e&&c?-1:1);break;case"end":u[s]+=g*(e&&c?-1:1);break}return u}const Oi=async(r,t,e)=>{const{placement:n="bottom",strategy:a="absolute",middleware:i=[],platform:s}=e,o=i.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(t));let c=await s.getElementRects({reference:r,floating:t,strategy:a}),{x:f,y:d}=ar(c,n,l),g=n,u={},m=0;for(let p=0;p<o.length;p++){const{name:v,fn:h}=o[p],{x:b,y,data:$,reset:k}=await h({x:f,y:d,initialPlacement:n,placement:g,strategy:a,middlewareData:u,rects:c,platform:s,elements:{reference:r,floating:t}});f=b??f,d=y??d,u={...u,[v]:{...u[v],...$}},k&&m<=50&&(m++,typeof k=="object"&&(k.placement&&(g=k.placement),k.rects&&(c=k.rects===!0?await s.getElementRects({reference:r,floating:t,strategy:a}):k.rects),{x:f,y:d}=ar(c,g,l)),p=-1)}return{x:f,y:d,placement:g,strategy:a,middlewareData:u}};async function Zn(r,t){var e;t===void 0&&(t={});const{x:n,y:a,platform:i,rects:s,elements:o,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:f="viewport",elementContext:d="floating",altBoundary:g=!1,padding:u=0}=en(t,r),m=Ti(u),v=o[g?d==="floating"?"reference":"floating":d],h=bn(await i.getClippingRect({element:(e=await(i.isElement==null?void 0:i.isElement(v)))==null||e?v:v.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:c,rootBoundary:f,strategy:l})),b=d==="floating"?{x:n,y:a,width:s.floating.width,height:s.floating.height}:s.reference,y=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),$=await(i.isElement==null?void 0:i.isElement(y))?await(i.getScale==null?void 0:i.getScale(y))||{x:1,y:1}:{x:1,y:1},k=bn(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:b,offsetParent:y,strategy:l}):b);return{top:(h.top-k.top+m.top)/$.y,bottom:(k.bottom-h.bottom+m.bottom)/$.y,left:(h.left-k.left+m.left)/$.x,right:(k.right-h.right+m.right)/$.x}}const Bi=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var e,n;const{placement:a,middlewareData:i,rects:s,initialPlacement:o,platform:l,elements:c}=t,{mainAxis:f=!0,crossAxis:d=!0,fallbackPlacements:g,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...v}=en(r,t);if((e=i.arrow)!=null&&e.alignmentOffset)return{};const h=ye(a),b=we(o),y=ye(o)===o,$=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=g||(y||!p?[wn(o)]:xi(o)),N=m!=="none";!g&&N&&k.push(...ji(o,p,m,$));const j=[o,...k],z=await Zn(t,v),A=[];let O=((n=i.flip)==null?void 0:n.overflows)||[];if(f&&A.push(z[h]),d){const _=Ei(a,s,$);A.push(z[_[0]],z[_[1]])}if(O=[...O,{placement:a,overflows:A}],!A.every(_=>_<=0)){var q,F;const _=(((q=i.flip)==null?void 0:q.index)||0)+1,W=j[_];if(W&&(!(d==="alignment"?b!==we(W):!1)||O.every(ot=>we(ot.placement)===b?ot.overflows[0]>0:!0)))return{data:{index:_,overflows:O},reset:{placement:W}};let st=(F=O.filter(V=>V.overflows[0]<=0).sort((V,ot)=>V.overflows[1]-ot.overflows[1])[0])==null?void 0:F.placement;if(!st)switch(u){case"bestFit":{var L;const V=(L=O.filter(ot=>{if(N){const G=we(ot.placement);return G===b||G==="y"}return!0}).map(ot=>[ot.placement,ot.overflows.filter(G=>G>0).reduce((G,ft)=>G+ft,0)]).sort((ot,G)=>ot[1]-G[1])[0])==null?void 0:L[0];V&&(st=V);break}case"initialPlacement":st=o;break}if(a!==st)return{reset:{placement:st}}}return{}}}},Ri=new Set(["left","top"]);async function zi(r,t){const{placement:e,platform:n,elements:a}=r,i=await(n.isRTL==null?void 0:n.isRTL(a.floating)),s=ye(e),o=nn(e),l=we(e)==="y",c=Ri.has(s)?-1:1,f=i&&l?-1:1,d=en(t,r);let{mainAxis:g,crossAxis:u,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof m=="number"&&(u=o==="end"?m*-1:m),l?{x:u*f,y:g*c}:{x:g*c,y:u*f}}const Ii=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var e,n;const{x:a,y:i,placement:s,middlewareData:o}=t,l=await zi(t,r);return s===((e=o.offset)==null?void 0:e.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:a+l.x,y:i+l.y,data:{...l,placement:s}}}}},Li=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:e,y:n,placement:a}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:o={fn:v=>{let{x:h,y:b}=v;return{x:h,y:b}}},...l}=en(r,t),c={x:e,y:n},f=await Zn(t,l),d=we(ye(a)),g=Qr(d);let u=c[g],m=c[d];if(i){const v=g==="y"?"top":"left",h=g==="y"?"bottom":"right",b=u+f[v],y=u-f[h];u=er(b,u,y)}if(s){const v=d==="y"?"top":"left",h=d==="y"?"bottom":"right",b=m+f[v],y=m-f[h];m=er(b,m,y)}const p=o.fn({...t,[g]:u,[d]:m});return{...p,data:{x:p.x-e,y:p.y-n,enabled:{[g]:i,[d]:s}}}}}},Mi=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var e,n;const{placement:a,rects:i,platform:s,elements:o}=t,{apply:l=()=>{},...c}=en(r,t),f=await Zn(t,c),d=ye(a),g=nn(a),u=we(a)==="y",{width:m,height:p}=i.floating;let v,h;d==="top"||d==="bottom"?(v=d,h=g===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(h=d,v=g==="end"?"top":"bottom");const b=p-f.top-f.bottom,y=m-f.left-f.right,$=Ie(p-f[v],b),k=Ie(m-f[h],y),N=!t.middlewareData.shift;let j=$,z=k;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(z=y),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(j=b),N&&!g){const O=Wt(f.left,0),q=Wt(f.right,0),F=Wt(f.top,0),L=Wt(f.bottom,0);u?z=m-2*(O!==0||q!==0?O+q:Wt(f.left,f.right)):j=p-2*(F!==0||L!==0?F+L:Wt(f.top,f.bottom))}await l({...t,availableWidth:z,availableHeight:j});const A=await s.getDimensions(o.floating);return m!==A.width||p!==A.height?{reset:{rects:!0}}:{}}}};function _n(){return typeof window<"u"}function He(r){return na(r)?(r.nodeName||"").toLowerCase():"#document"}function Gt(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function he(r){var t;return(t=(na(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function na(r){return _n()?r instanceof Node||r instanceof Gt(r).Node:!1}function oe(r){return _n()?r instanceof Element||r instanceof Gt(r).Element:!1}function ue(r){return _n()?r instanceof HTMLElement||r instanceof Gt(r).HTMLElement:!1}function ir(r){return!_n()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Gt(r).ShadowRoot}const Ui=new Set(["inline","contents"]);function rn(r){const{overflow:t,overflowX:e,overflowY:n,display:a}=le(r);return/auto|scroll|overlay|hidden|clip/.test(t+n+e)&&!Ui.has(a)}const Wi=new Set(["table","td","th"]);function Hi(r){return Wi.has(He(r))}const Vi=[":popover-open",":modal"];function yn(r){return Vi.some(t=>{try{return r.matches(t)}catch{return!1}})}const Zi=["transform","translate","scale","rotate","perspective"],Gi=["transform","translate","scale","rotate","perspective","filter"],Yi=["paint","layout","strict","content"];function Gn(r){const t=Yn(),e=oe(r)?le(r):r;return Zi.some(n=>e[n]?e[n]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||Gi.some(n=>(e.willChange||"").includes(n))||Yi.some(n=>(e.contain||"").includes(n))}function Ki(r){let t=ke(r);for(;ue(t)&&!Le(t);){if(Gn(t))return t;if(yn(t))return null;t=ke(t)}return null}function Yn(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const qi=new Set(["html","body","#document"]);function Le(r){return qi.has(He(r))}function le(r){return Gt(r).getComputedStyle(r)}function kn(r){return oe(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function ke(r){if(He(r)==="html")return r;const t=r.assignedSlot||r.parentNode||ir(r)&&r.host||he(r);return ir(t)?t.host:t}function ra(r){const t=ke(r);return Le(t)?r.ownerDocument?r.ownerDocument.body:r.body:ue(t)&&rn(t)?t:ra(t)}function Me(r,t,e){var n;t===void 0&&(t=[]),e===void 0&&(e=!0);const a=ra(r),i=a===((n=r.ownerDocument)==null?void 0:n.body),s=Gt(a);if(i){const o=In(s);return t.concat(s,s.visualViewport||[],rn(a)?a:[],o&&e?Me(o):[])}return t.concat(a,Me(a,[],e))}function In(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function aa(r){const t=le(r);let e=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=ue(r),i=a?r.offsetWidth:e,s=a?r.offsetHeight:n,o=gn(e)!==i||gn(n)!==s;return o&&(e=i,n=s),{width:e,height:n,$:o}}function Kn(r){return oe(r)?r:r.contextElement}function ze(r){const t=Kn(r);if(!ue(t))return ce(1);const e=t.getBoundingClientRect(),{width:n,height:a,$:i}=aa(t);let s=(i?gn(e.width):e.width)/n,o=(i?gn(e.height):e.height)/a;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const Xi=ce(0);function ia(r){const t=Gt(r);return!Yn()||!t.visualViewport?Xi:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Ji(r,t,e){return t===void 0&&(t=!1),!e||t&&e!==Gt(r)?!1:t}function xe(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=!1);const a=r.getBoundingClientRect(),i=Kn(r);let s=ce(1);t&&(n?oe(n)&&(s=ze(n)):s=ze(r));const o=Ji(i,e,n)?ia(i):ce(0);let l=(a.left+o.x)/s.x,c=(a.top+o.y)/s.y,f=a.width/s.x,d=a.height/s.y;if(i){const g=Gt(i),u=n&&oe(n)?Gt(n):n;let m=g,p=In(m);for(;p&&n&&u!==m;){const v=ze(p),h=p.getBoundingClientRect(),b=le(p),y=h.left+(p.clientLeft+parseFloat(b.paddingLeft))*v.x,$=h.top+(p.clientTop+parseFloat(b.paddingTop))*v.y;l*=v.x,c*=v.y,f*=v.x,d*=v.y,l+=y,c+=$,m=Gt(p),p=In(m)}}return bn({width:f,height:d,x:l,y:c})}function $n(r,t){const e=kn(r).scrollLeft;return t?t.left+e:xe(he(r)).left+e}function sa(r,t){const e=r.getBoundingClientRect(),n=e.left+t.scrollLeft-$n(r,e),a=e.top+t.scrollTop;return{x:n,y:a}}function Qi(r){let{elements:t,rect:e,offsetParent:n,strategy:a}=r;const i=a==="fixed",s=he(n),o=t?yn(t.floating):!1;if(n===s||o&&i)return e;let l={scrollLeft:0,scrollTop:0},c=ce(1);const f=ce(0),d=ue(n);if((d||!d&&!i)&&((He(n)!=="body"||rn(s))&&(l=kn(n)),ue(n))){const u=xe(n);c=ze(n),f.x=u.x+n.clientLeft,f.y=u.y+n.clientTop}const g=s&&!d&&!i?sa(s,l):ce(0);return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+f.x+g.x,y:e.y*c.y-l.scrollTop*c.y+f.y+g.y}}function ts(r){return Array.from(r.getClientRects())}function es(r){const t=he(r),e=kn(r),n=r.ownerDocument.body,a=Wt(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),i=Wt(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let s=-e.scrollLeft+$n(r);const o=-e.scrollTop;return le(n).direction==="rtl"&&(s+=Wt(t.clientWidth,n.clientWidth)-a),{width:a,height:i,x:s,y:o}}const sr=25;function ns(r,t){const e=Gt(r),n=he(r),a=e.visualViewport;let i=n.clientWidth,s=n.clientHeight,o=0,l=0;if(a){i=a.width,s=a.height;const f=Yn();(!f||f&&t==="fixed")&&(o=a.offsetLeft,l=a.offsetTop)}const c=$n(n);if(c<=0){const f=n.ownerDocument,d=f.body,g=getComputedStyle(d),u=f.compatMode==="CSS1Compat"&&parseFloat(g.marginLeft)+parseFloat(g.marginRight)||0,m=Math.abs(n.clientWidth-d.clientWidth-u);m<=sr&&(i-=m)}else c<=sr&&(i+=c);return{width:i,height:s,x:o,y:l}}const rs=new Set(["absolute","fixed"]);function as(r,t){const e=xe(r,!0,t==="fixed"),n=e.top+r.clientTop,a=e.left+r.clientLeft,i=ue(r)?ze(r):ce(1),s=r.clientWidth*i.x,o=r.clientHeight*i.y,l=a*i.x,c=n*i.y;return{width:s,height:o,x:l,y:c}}function or(r,t,e){let n;if(t==="viewport")n=ns(r,e);else if(t==="document")n=es(he(r));else if(oe(t))n=as(t,e);else{const a=ia(r);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return bn(n)}function oa(r,t){const e=ke(r);return e===t||!oe(e)||Le(e)?!1:le(e).position==="fixed"||oa(e,t)}function is(r,t){const e=t.get(r);if(e)return e;let n=Me(r,[],!1).filter(o=>oe(o)&&He(o)!=="body"),a=null;const i=le(r).position==="fixed";let s=i?ke(r):r;for(;oe(s)&&!Le(s);){const o=le(s),l=Gn(s);!l&&o.position==="fixed"&&(a=null),(i?!l&&!a:!l&&o.position==="static"&&!!a&&rs.has(a.position)||rn(s)&&!l&&oa(r,s))?n=n.filter(f=>f!==s):a=o,s=ke(s)}return t.set(r,n),n}function ss(r){let{element:t,boundary:e,rootBoundary:n,strategy:a}=r;const s=[...e==="clippingAncestors"?yn(t)?[]:is(t,this._c):[].concat(e),n],o=s[0],l=s.reduce((c,f)=>{const d=or(t,f,a);return c.top=Wt(d.top,c.top),c.right=Ie(d.right,c.right),c.bottom=Ie(d.bottom,c.bottom),c.left=Wt(d.left,c.left),c},or(t,o,a));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function os(r){const{width:t,height:e}=aa(r);return{width:t,height:e}}function ls(r,t,e){const n=ue(t),a=he(t),i=e==="fixed",s=xe(r,!0,i,t);let o={scrollLeft:0,scrollTop:0};const l=ce(0);function c(){l.x=$n(a)}if(n||!n&&!i)if((He(t)!=="body"||rn(a))&&(o=kn(t)),n){const u=xe(t,!0,i,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else a&&c();i&&!n&&a&&c();const f=a&&!n&&!i?sa(a,o):ce(0),d=s.left+o.scrollLeft-l.x-f.x,g=s.top+o.scrollTop-l.y-f.y;return{x:d,y:g,width:s.width,height:s.height}}function Fn(r){return le(r).position==="static"}function lr(r,t){if(!ue(r)||le(r).position==="fixed")return null;if(t)return t(r);let e=r.offsetParent;return he(r)===e&&(e=e.ownerDocument.body),e}function la(r,t){const e=Gt(r);if(yn(r))return e;if(!ue(r)){let a=ke(r);for(;a&&!Le(a);){if(oe(a)&&!Fn(a))return a;a=ke(a)}return e}let n=lr(r,t);for(;n&&Hi(n)&&Fn(n);)n=lr(n,t);return n&&Le(n)&&Fn(n)&&!Gn(n)?e:n||Ki(r)||e}const cs=async function(r){const t=this.getOffsetParent||la,e=this.getDimensions,n=await e(r.floating);return{reference:ls(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function fs(r){return le(r).direction==="rtl"}const ca={convertOffsetParentRelativeRectToViewportRelativeRect:Qi,getDocumentElement:he,getClippingRect:ss,getOffsetParent:la,getElementRects:cs,getClientRects:ts,getDimensions:os,getScale:ze,isElement:oe,isRTL:fs};function fa(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function us(r,t){let e=null,n;const a=he(r);function i(){var o;clearTimeout(n),(o=e)==null||o.disconnect(),e=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),i();const c=r.getBoundingClientRect(),{left:f,top:d,width:g,height:u}=c;if(o||t(),!g||!u)return;const m=ln(d),p=ln(a.clientWidth-(f+g)),v=ln(a.clientHeight-(d+u)),h=ln(f),y={rootMargin:-m+"px "+-p+"px "+-v+"px "+-h+"px",threshold:Wt(0,Ie(1,l))||1};let $=!0;function k(N){const j=N[0].intersectionRatio;if(j!==l){if(!$)return s();j?s(!1,j):n=setTimeout(()=>{s(!1,1e-7)},1e3)}j===1&&!fa(c,r.getBoundingClientRect())&&s(),$=!1}try{e=new IntersectionObserver(k,{...y,root:a.ownerDocument})}catch{e=new IntersectionObserver(k,y)}e.observe(r)}return s(!0),i}function ua(r,t,e,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Kn(r),f=a||i?[...c?Me(c):[],...Me(t)]:[];f.forEach(h=>{a&&h.addEventListener("scroll",e,{passive:!0}),i&&h.addEventListener("resize",e)});const d=c&&o?us(c,e):null;let g=-1,u=null;s&&(u=new ResizeObserver(h=>{let[b]=h;b&&b.target===c&&u&&(u.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var y;(y=u)==null||y.observe(t)})),e()}),c&&!l&&u.observe(c),u.observe(t));let m,p=l?xe(r):null;l&&v();function v(){const h=xe(r);p&&!fa(p,h)&&e(),p=h,m=requestAnimationFrame(v)}return e(),()=>{var h;f.forEach(b=>{a&&b.removeEventListener("scroll",e),i&&b.removeEventListener("resize",e)}),d==null||d(),(h=u)==null||h.disconnect(),u=null,l&&cancelAnimationFrame(m)}}const da=Ii,ha=Li,pa=Bi,ma=Mi,ds=(r,t,e)=>{const n=new Map,a={platform:ca,...e},i={...a.platform,_c:n};return Oi(r,t,{...a,platform:i})},hs=Object.freeze(Object.defineProperty({__proto__:null,autoUpdate:ua,computePosition:ds,flip:pa,getOverflowAncestors:Me,offset:da,platform:ca,shift:ha,size:ma},Symbol.toStringTag,{value:"Module"}));/**
 * @license lucide-svelte v0.546.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const cr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};function fr(r,t,e){const n=r.slice();return n[11]=t[e][0],n[12]=t[e][1],n}function En(r){let t,e=[r[12]],n={};for(let a=0;a<e.length;a+=1)n=vt(n,e[a]);return{c(){t=qr(r[11]),dn(t,n)},m(a,i){gt(a,t,i)},p(a,i){dn(t,n=ne(e,[i&32&&a[12]]))},d(a){a&&pt(t)}}}function ur(r){let t=r[11],e,n=r[11]&&En(r);return{c(){n&&n.c(),e=vn()},m(a,i){n&&n.m(a,i),gt(a,e,i)},p(a,i){a[11]?t?Bt(t,a[11])?(n.d(1),n=En(a),t=a[11],n.c(),n.m(e.parentNode,e)):n.p(a,i):(n=En(a),t=a[11],n.c(),n.m(e.parentNode,e)):t&&(n.d(1),n=null,t=a[11])},d(a){a&&pt(e),n&&n.d(a)}}}function ps(r){let t,e,n,a,i,s=_e(r[5]),o=[];for(let g=0;g<s.length;g+=1)o[g]=ur(fr(r,s,g));const l=r[10].default,c=Yt(l,r,r[9],null);let f=[cr,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:a=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],d={};for(let g=0;g<f.length;g+=1)d=vt(d,f[g]);return{c(){t=qr("svg");for(let g=0;g<o.length;g+=1)o[g].c();e=vn(),c&&c.c(),dn(t,d)},m(g,u){gt(g,t,u);for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(t,null);nt(t,e),c&&c.m(t,null),i=!0},p(g,[u]){if(u&32){s=_e(g[5]);let m;for(m=0;m<s.length;m+=1){const p=fr(g,s,m);o[m]?o[m].p(p,u):(o[m]=ur(p),o[m].c(),o[m].m(t,e))}for(;m<o.length;m+=1)o[m].d(1);o.length=s.length}c&&c.p&&(!i||u&512)&&qt(c,l,g,g[9],i?Kt(l,g[9],u,null):Xt(g[9]),null),dn(t,d=ne(f,[cr,u&128&&g[7],(!i||u&4)&&{width:g[2]},(!i||u&4)&&{height:g[2]},(!i||u&2)&&{stroke:g[1]},(!i||u&28&&n!==(n=g[4]?Number(g[3])*24/Number(g[2]):g[3]))&&{"stroke-width":n},(!i||u&257&&a!==(a=g[6]("lucide-icon","lucide",g[0]?`lucide-${g[0]}`:"",g[8].class)))&&{class:a}]))},i(g){i||(K(c,g),i=!0)},o(g){Q(c,g),i=!1},d(g){g&&pt(t),Kr(o,g),c&&c.d(g)}}}function ms(r,t,e){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let a=Qn(t,n),{$$slots:i={},$$scope:s}=t,{name:o=void 0}=t,{color:l="currentColor"}=t,{size:c=24}=t,{strokeWidth:f=2}=t,{absoluteStrokeWidth:d=!1}=t,{iconNode:g=[]}=t;const u=(...m)=>m.filter((p,v,h)=>!!p&&h.indexOf(p)===v).join(" ");return r.$$set=m=>{e(8,t=vt(vt({},t),Pt(m))),e(7,a=Qn(t,n)),"name"in m&&e(0,o=m.name),"color"in m&&e(1,l=m.color),"size"in m&&e(2,c=m.size),"strokeWidth"in m&&e(3,f=m.strokeWidth),"absoluteStrokeWidth"in m&&e(4,d=m.absoluteStrokeWidth),"iconNode"in m&&e(5,g=m.iconNode),"$$scope"in m&&e(9,s=m.$$scope)},t=Pt(t),[o,l,c,f,d,g,u,a,t,s,i]}class pe extends Mt{constructor(t){super(),Lt(this,t,ms,ps,Bt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}function gs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function ws(r){let t,e;const n=[{name:"arrow-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[gs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function bs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class ga extends Mt{constructor(t){super(),Lt(this,t,bs,ws,Bt,{})}}function vs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function _s(r){let t,e;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[vs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function ys(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class wa extends Mt{constructor(t){super(),Lt(this,t,ys,_s,Bt,{})}}function ks(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function $s(r){let t,e;const n=[{name:"book-open-check"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[ks]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Cs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 21V7"}],["path",{d:"m16 12 2 2 4-4"}],["path",{d:"M22 6V4a1 1 0 0 0-1-1h-5a4 4 0 0 0-4 4 4 4 0 0 0-4-4H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h6a3 3 0 0 1 3 3 3 3 0 0 1 3-3h6a1 1 0 0 0 1-1v-1.3"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Ss extends Mt{constructor(t){super(),Lt(this,t,Cs,$s,Bt,{})}}function Fs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Es(r){let t,e;const n=[{name:"chevron-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Fs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function xs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m6 9 6 6 6-6"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Ds extends Mt{constructor(t){super(),Lt(this,t,xs,Es,Bt,{})}}function Ps(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ns(r){let t,e;const n=[{name:"copy"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ps]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function js(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class As extends Mt{constructor(t){super(),Lt(this,t,js,Ns,Bt,{})}}function Ts(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Os(r){let t,e;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ts]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Bs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class ba extends Mt{constructor(t){super(),Lt(this,t,Bs,Os,Bt,{})}}function Rs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function zs(r){let t,e;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Rs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Is(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class va extends Mt{constructor(t){super(),Lt(this,t,Is,zs,Bt,{})}}function Ls(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ms(r){let t,e;const n=[{name:"rotate-ccw"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ls]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Us(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class _a extends Mt{constructor(t){super(),Lt(this,t,Us,Ms,Bt,{})}}function Ws(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Hs(r){let t,e;const n=[{name:"trash"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ws]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Vs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class ya extends Mt{constructor(t){super(),Lt(this,t,Vs,Hs,Bt,{})}}function Zs(r){let t;const e=r[2].default,n=Yt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&qt(n,e,a,a[3],t?Kt(e,a[3],i,null):Xt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Gs(r){let t,e;const n=[{name:"x"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Zs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ys(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Ks extends Mt{constructor(t){super(),Lt(this,t,Ys,Gs,Bt,{})}}function dr(r,t,e){const n=r.slice();return n[38]=t[e],n[40]=e,n}function hr(r){let t,e,n;return{c(){t=ct("label"),e=It(r[2]),et(t,"class","wa-select-label-text"),et(t,"for",n="wa-select-"+r[7])},m(a,i){gt(a,t,i),nt(t,e)},p(a,i){i[0]&4&&We(e,a[2]),i[0]&128&&n!==(n="wa-select-"+a[7])&&et(t,"for",n)},d(a){a&&pt(t)}}}function qs(r){let t,e;return{c(){t=ct("span"),e=It(r[1]),et(t,"class","wa-select-placeholder")},m(n,a){gt(n,t,a),nt(t,e)},p(n,a){a[0]&2&&We(e,n[1])},d(n){n&&pt(t)}}}function Xs(r){let t,e;return{c(){t=ct("span"),e=It(r[16]),et(t,"class","wa-select-label")},m(n,a){gt(n,t,a),nt(t,e)},p(n,a){a[0]&65536&&We(e,n[16])},d(n){n&&pt(t)}}}function pr(r){let t,e,n,a,i;return e=new Ks({}),{c(){t=ct("button"),ht(e.$$.fragment),et(t,"type","button"),et(t,"class","wa-select-clear"),et(t,"aria-label","Clear selection")},m(s,o){gt(s,t,o),ut(e,t,null),n=!0,a||(i=fe(t,"click",r[21]),a=!0)},p:xt,i(s){n||(K(e.$$.fragment,s),n=!0)},o(s){Q(e.$$.fragment,s),n=!1},d(s){s&&pt(t),dt(e),a=!1,i()}}}function mr(r){let t,e,n;return e=new Ds({}),{c(){t=ct("div"),ht(e.$$.fragment),et(t,"class","wa-select-chevron"),ee(t,"rotated",r[9])},m(a,i){gt(a,t,i),ut(e,t,null),n=!0},p(a,i){(!n||i[0]&512)&&ee(t,"rotated",a[9])},i(a){n||(K(e.$$.fragment,a),n=!0)},o(a){Q(e.$$.fragment,a),n=!1},d(a){a&&pt(t),dt(e)}}}function gr(r){let t,e,n,a=r[4]&&wr(r);function i(l,c){return l[10].length===0?Qs:Js}let s=i(r),o=s(r);return{c(){t=ct("div"),a&&a.c(),e=mt(),n=ct("div"),o.c(),et(n,"class","wa-select-list"),et(t,"class","wa-select-dropdown")},m(l,c){gt(l,t,c),a&&a.m(t,null),nt(t,e),nt(t,n),o.m(n,null),r[30](t)},p(l,c){l[4]?a?a.p(l,c):(a=wr(l),a.c(),a.m(t,e)):a&&(a.d(1),a=null),s===(s=i(l))&&o?o.p(l,c):(o.d(1),o=s(l),o&&(o.c(),o.m(n,null)))},d(l){l&&pt(t),a&&a.d(),o.d(),r[30](null)}}}function wr(r){let t,e,n,a;return{c(){t=ct("div"),e=ct("input"),et(e,"type","text"),et(e,"class","wa-select-search-input"),et(e,"placeholder","Search..."),e.value=r[13],et(t,"class","wa-select-search")},m(i,s){gt(i,t,s),nt(t,e),r[27](e),n||(a=fe(e,"input",r[23]),n=!0)},p(i,s){s[0]&8192&&e.value!==i[13]&&(e.value=i[13])},d(i){i&&pt(t),r[27](null),n=!1,a()}}}function Js(r){let t=[],e=new Map,n,a=_e(r[10]);const i=s=>s[38].value;for(let s=0;s<a.length;s+=1){let o=dr(r,a,s),l=i(o);e.set(l,t[s]=br(l,o))}return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=vn()},m(s,o){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(s,o);gt(s,n,o)},p(s,o){o[0]&1197056&&(a=_e(s[10]),t=Jr(t,o,i,1,s,a,e,n.parentNode,mi,br,n,dr))},d(s){s&&pt(n);for(let o=0;o<t.length;o+=1)t[o].d(s)}}}function Qs(r){let t;return{c(){t=ct("div"),t.textContent="No options available",et(t,"class","wa-select-empty")},m(e,n){gt(e,t,n)},p:xt,d(e){e&&pt(t)}}}function br(r,t){let e,n=t[38].label+"",a,i,s,o,l;function c(){return t[28](t[38])}function f(){return t[29](t[40])}return{key:r,first:null,c(){e=ct("button"),a=It(n),i=mt(),et(e,"type","button"),et(e,"class","wa-select-option"),et(e,"data-select-index",s=t[40]),ee(e,"selected",t[14]===t[40]),ee(e,"active",t[17]()===t[38].value),this.first=e},m(d,g){gt(d,e,g),nt(e,a),nt(e,i),o||(l=[fe(e,"click",c),fe(e,"mouseenter",f)],o=!0)},p(d,g){t=d,g[0]&1024&&n!==(n=t[38].label+"")&&We(a,n),g[0]&1024&&s!==(s=t[40])&&et(e,"data-select-index",s),g[0]&17408&&ee(e,"selected",t[14]===t[40]),g[0]&132096&&ee(e,"active",t[17]()===t[38].value)},d(d){d&&pt(e),o=!1,$e(l)}}}function to(r){let t,e,n,a,i,s,o,l,c,f,d,g,u,m=r[2]&&hr(r);function p(k,N){return k[0]?Xs:qs}let v=p(r),h=v(r),b=r[5]&&r[0]&&pr(r),y=r[6]&&mr(r),$=r[9]&&gr(r);return{c(){t=ct("div"),m&&m.c(),e=mt(),n=ct("div"),a=ct("div"),h.c(),i=mt(),s=ct("div"),b&&b.c(),o=mt(),y&&y.c(),f=mt(),$&&$.c(),et(a,"class","wa-select-value"),et(s,"class","wa-select-controls"),et(n,"id",l="wa-select-"+r[7]),et(n,"class","wa-select-trigger"),et(n,"role","button"),et(n,"tabindex",c=r[3]?-1:0),et(n,"style",r[8]),ee(n,"open",r[9]),ee(n,"disabled",r[3]),ee(n,"has-value",r[0]),et(t,"class","wa-select-container wa-select")},m(k,N){gt(k,t,N),m&&m.m(t,null),nt(t,e),nt(t,n),nt(n,a),h.m(a,null),nt(n,i),nt(n,s),b&&b.m(s,null),nt(s,o),y&&y.m(s,null),r[25](n),nt(t,f),$&&$.m(t,null),d=!0,g||(u=[fe(n,"click",r[26]),fe(n,"keydown",r[22])],g=!0)},p(k,N){k[2]?m?m.p(k,N):(m=hr(k),m.c(),m.m(t,e)):m&&(m.d(1),m=null),v===(v=p(k))&&h?h.p(k,N):(h.d(1),h=v(k),h&&(h.c(),h.m(a,null))),k[5]&&k[0]?b?(b.p(k,N),N[0]&33&&K(b,1)):(b=pr(k),b.c(),K(b,1),b.m(s,o)):b&&(Vt(),Q(b,1,1,()=>{b=null}),Zt()),k[6]?y?(y.p(k,N),N[0]&64&&K(y,1)):(y=mr(k),y.c(),K(y,1),y.m(s,null)):y&&(Vt(),Q(y,1,1,()=>{y=null}),Zt()),(!d||N[0]&128&&l!==(l="wa-select-"+k[7]))&&et(n,"id",l),(!d||N[0]&8&&c!==(c=k[3]?-1:0))&&et(n,"tabindex",c),(!d||N[0]&256)&&et(n,"style",k[8]),(!d||N[0]&512)&&ee(n,"open",k[9]),(!d||N[0]&8)&&ee(n,"disabled",k[3]),(!d||N[0]&1)&&ee(n,"has-value",k[0]),k[9]?$?$.p(k,N):($=gr(k),$.c(),$.m(t,null)):$&&($.d(1),$=null)},i(k){d||(K(b),K(y),d=!0)},o(k){Q(b),Q(y),d=!1},d(k){k&&pt(t),m&&m.d(),h.d(),b&&b.d(),y&&y.d(),r[25](null),$&&$.d(),g=!1,$e(u)}}}function eo(r,t,e){let n,{items:a=[]}=t,{value:i=null}=t,{placeholder:s="Select..."}=t,{label:o=""}=t,{disabled:l=!1}=t,{searchable:c=!1}=t,{clearable:f=!1}=t,{showChevron:d=!0}=t,{name:g=""}=t,{containerStyles:u=""}=t,m=!1,p="",v=[],h=-1,b,y,$,k=null;const N=fi();function j(){return i?typeof i=="string"?i:i.value||"":""}function z(){p?e(10,v=a.filter(U=>U.label.toLowerCase().includes(p.toLowerCase())||U.value.toLowerCase().includes(p.toLowerCase()))):e(10,v=a),e(14,h=-1)}function A(){l||m||(e(9,m=!0),e(13,p=""),z(),c&&setTimeout(()=>{$&&$.focus()},0),b&&y&&q())}function O(){e(9,m=!1),e(13,p=""),e(14,h=-1)}function q(){if(!b||!y)return;const U=[da(6),pa({padding:8,fallbackAxisSideDirection:"end"}),ha({padding:8}),ma({padding:8,apply({availableHeight:X}){Object.assign(y.style,{maxHeight:`${Math.min(X-10,350)}px`,width:`${b.offsetWidth}px`})}})];k=ua(b,y,async()=>{const{computePosition:X}=await Promise.resolve().then(()=>hs),{x:St,y:Nt,placement:wt}=await X(b,y,{middleware:U,placement:"bottom-start"});y.setAttribute("data-placement",wt),Object.assign(y.style,{left:`${St}px`,top:`${Nt}px`})})}function F(U){e(0,i=U),O(),N("select",U)}function L(U){U.stopPropagation(),e(0,i=null),O(),N("clear")}function _(U){if(!m){(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),A());return}switch(U.key){case"ArrowDown":U.preventDefault(),e(14,h=Math.min(h+1,v.length-1)),W();break;case"ArrowUp":U.preventDefault(),e(14,h=Math.max(h-1,-1)),W();break;case"Enter":U.preventDefault(),h>=0?F(v[h]):O();break;case"Escape":U.preventDefault(),O();break}}function W(){if(h<0)return;const U=document.querySelector(`[data-select-index="${h}"]`);U&&U.scrollIntoView({block:"nearest"})}function st(U){e(13,p=U.target.value),z()}function V(U){if(m&&b&&y){const X=U.target;!b.contains(X)&&!y.contains(X)&&O()}}ci(()=>{document.addEventListener("click",V),z()}),On(()=>{document.removeEventListener("click",V),k&&k()});function ot(U){Xe[U?"unshift":"push"](()=>{b=U,e(11,b)})}const G=()=>m?O():A();function ft(U){Xe[U?"unshift":"push"](()=>{$=U,e(15,$)})}const R=U=>F(U),B=U=>e(14,h=U);function lt(U){Xe[U?"unshift":"push"](()=>{y=U,e(12,y),e(9,m),e(11,b)})}return r.$$set=U=>{"items"in U&&e(24,a=U.items),"value"in U&&e(0,i=U.value),"placeholder"in U&&e(1,s=U.placeholder),"label"in U&&e(2,o=U.label),"disabled"in U&&e(3,l=U.disabled),"searchable"in U&&e(4,c=U.searchable),"clearable"in U&&e(5,f=U.clearable),"showChevron"in U&&e(6,d=U.showChevron),"name"in U&&e(7,g=U.name),"containerStyles"in U&&e(8,u=U.containerStyles)},r.$$.update=()=>{var U;if(r.$$.dirty[0]&16777219&&e(16,n=i?typeof i=="string"?((U=a.find(X=>X.value===i))==null?void 0:U.label)||i:i.label||s:s),r.$$.dirty[0]&1025&&i!==void 0&&v.length>0){const X=j();e(14,h=v.findIndex(St=>St.value===X))}r.$$.dirty[0]&6656&&m&&y&&b&&(e(12,y.style.width=`${b.offsetWidth}px`,y),e(12,y.style.top=`${b.offsetTop+b.offsetHeight+6}px`,y))},z(),[i,s,o,l,c,f,d,g,u,m,v,b,y,p,h,$,n,j,A,O,F,L,_,st,a,ot,G,ft,R,B,lt]}class no extends Mt{constructor(t){super(),Lt(this,t,eo,to,Bt,{items:24,value:0,placeholder:1,label:2,disabled:3,searchable:4,clearable:5,showChevron:6,name:7,containerStyles:8},null,[-1,-1])}}class vr extends D.Modal{constructor(t,e,n,a="draft"){super(t),this.name=e,this.onConfirm=n,this.type=a}onOpen(){const{contentEl:t}=this;t.addClass("wa-centered-modal");const e=this.type==="chapter"?"chapter":"draft";t.createEl("h3",{text:`Delete ${e} '${this.name}'?`}),this.type==="draft"&&t.createEl("p",{text:"This will create a backup copy before deleting."});const n=t.createDiv({cls:"modal-button-row wa-button-group"}),a=n.createEl("button",{text:"Delete",cls:"mod-cta wa-button"}),i=n.createEl("button",{text:"Cancel",cls:"wa-button"});a.onclick=async()=>{x(`${E} ConfirmDeleteModal: confirmed delete for ${this.type} "${this.name}"`),this.close(),await this.onConfirm()},i.onclick=()=>{x(`${E} ConfirmDeleteModal: cancelled delete for ${this.type} "${this.name}"`),this.close()}}}class ro extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:`Duplicate Draft: ${this.props.sourceDraftName}`});let e="";new D.Setting(t).setName("New draft name").addText(n=>n.setPlaceholder(this.props.suggestedName).setValue(this.props.suggestedName).onChange(a=>e=a)),new D.Setting(t).addButton(n=>n.setButtonText("Duplicate").setCta().onClick(()=>{const a=e&&e.trim()?e.trim():this.props.suggestedName;x(`${E} DuplicateDraftModal: duplicating draft from "${this.props.sourceDraftName}" to "${a}"`),this.close(),this.props.onSubmit(a)}))}onClose(){this.contentEl.empty()}}class ao extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Chapter"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New chapter name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new chapter name",cls:"wa-rename-input",attr:{"aria-label":"New chapter name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n,a;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Chapter name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}this.errorEl&&(this.errorEl.style.display="none"),x(`${E} RenameChapterModal: renaming chapter from "${this.oldName}" to "${t}"`),this.onSubmit(t),this.close()}}class io extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var s;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Draft"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("label",{cls:"wa-rename-checkbox-label"});this.checkboxEl=n.createEl("input",{type:"checkbox",attr:{checked:"checked"}}),n.appendText(" Also rename the main draft file (filename)");const a=t.createEl("div",{cls:"wa-rename-btn-row"}),i=a.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=a.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var o,l;(o=this.inputEl)==null||o.focus(),(l=this.inputEl)==null||l.select()},0),(s=this.inputEl)==null||s.addEventListener("keydown",o=>{o.key==="Enter"?this.submit():o.key==="Escape"&&this.close()}),i.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var n,a,i;const t=(n=this.inputEl)==null?void 0:n.value.trim(),e=this.checkboxEl?this.checkboxEl.checked:!1;if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(i=this.inputEl)==null||i.focus();return}this.errorEl&&(this.errorEl.style.display="none"),x(`${E} RenameDraftModal: renaming draft from "${this.oldName}" to "${t}", renameFile: ${e}`),this.onSubmit(t,e),this.close()}}function ka(r){const t=r-1;return t*t*t+1}function so(r,{from:t,to:e},n={}){const a=getComputedStyle(r),i=a.transform==="none"?"":a.transform,[s,o]=a.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*s/e.width-(e.left+s),c=t.top+t.height*o/e.height-(e.top+o),{delay:f=0,duration:d=u=>Math.sqrt(u)*120,easing:g=ka}=n;return{delay:f,duration:tn(d)?d(Math.sqrt(l*l+c*c)):d,easing:g,css:(u,m)=>{const p=m*l,v=m*c,h=u+m*t.width/e.width,b=u+m*t.height/e.height;return`transform: ${i} translate(${p}px, ${v}px) scale(${h}, ${b});`}}}function _r(r,t,e){const n=r.slice();return n[64]=t[e],n[66]=e,n}function yr(r,t,e){const n=r.slice();return n[67]=t[e],n}function oo(r){let t,e;return t=new _a({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function lo(r){let t;return{c(){t=It("New Project")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function kr(r){let t;return{c(){t=ct("div"),t.textContent="No projects found.",et(t,"class","wa-muted"),ve(t,"margin","4rem auto 0"),ve(t,"font-size","18px"),ve(t,"width","fit-content")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function $r(r){let t,e,n,a,i,s;return i=new no({props:{name:"wa-project-select",value:r[3],items:r[7],placeholder:"Choose a project...",showChevron:!0,disabled:To,clearable:!1,searchable:!1}}),i.$on("select",r[41]),{c(){t=ct("div"),e=ct("label"),e.textContent="Select project",n=mt(),a=ct("div"),ht(i.$$.fragment),et(e,"for","wa-project-select"),et(a,"class","wa-row"),ve(t,"margin","20px 0")},m(o,l){gt(o,t,l),nt(t,e),nt(t,n),nt(t,a),ut(i,a,null),s=!0},p(o,l){const c={};l[0]&8&&(c.value=o[3]),l[0]&128&&(c.items=o[7]),i.$set(c)},i(o){s||(K(i.$$.fragment,o),s=!0)},o(o){Q(i.$$.fragment,o),s=!1},d(o){o&&pt(t),dt(i)}}}function Cr(r){let t,e,n,a,i,s,o,l,c,f,d,g,u,m,p,v;o=new se({props:{ariaLabel:"Toggle draft sort order",title:void 0,clickHandler:r[42],$$slots:{default:[uo]},$$scope:{ctx:r}}}),f=new be({props:{title:"New draft",clickHandler:r[23],variant:"primary",$$slots:{default:[ho]},$$scope:{ctx:r}}}),g=new se({props:{ariaLabel:"Refresh drafts",title:void 0,clickHandler:r[20],disabled:r[8],spinning:r[8],$$slots:{default:[po]},$$scope:{ctx:r}}});let h=r[9]&&Sr(r),b=r[5].length===0&&Fr(),y=r[5].length>0&&Er(r);return{c(){t=ct("div"),e=ct("div"),n=ct("div"),a=ct("div"),i=ct("div"),i.textContent="Drafts",s=mt(),ht(o.$$.fragment),l=mt(),c=ct("div"),ht(f.$$.fragment),d=mt(),ht(g.$$.fragment),u=mt(),h&&h.c(),m=mt(),b&&b.c(),p=mt(),y&&y.c(),et(i,"class","wa-title"),et(a,"class","wa-button-group"),et(c,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","draft-controls"),ve(t,"margin-top","16px")},m($,k){gt($,t,k),nt(t,e),nt(e,n),nt(n,a),nt(a,i),nt(a,s),ut(o,a,null),nt(n,l),nt(n,c),ut(f,c,null),nt(c,d),ut(g,c,null),nt(t,u),h&&h.m(t,null),nt(t,m),b&&b.m(t,null),nt(t,p),y&&y.m(t,null),v=!0},p($,k){const N={};k[0]&2048&&(N.clickHandler=$[42]),k[0]&2048|k[2]&256&&(N.$$scope={dirty:k,ctx:$}),o.$set(N);const j={};k[2]&256&&(j.$$scope={dirty:k,ctx:$}),f.$set(j);const z={};k[0]&256&&(z.disabled=$[8]),k[0]&256&&(z.spinning=$[8]),k[2]&256&&(z.$$scope={dirty:k,ctx:$}),g.$set(z),$[9]?h?(h.p($,k),k[0]&512&&K(h,1)):(h=Sr($),h.c(),K(h,1),h.m(t,m)):h&&(Vt(),Q(h,1,1,()=>{h=null}),Zt()),$[5].length===0?b||(b=Fr(),b.c(),b.m(t,p)):b&&(b.d(1),b=null),$[5].length>0?y?(y.p($,k),k[0]&32&&K(y,1)):(y=Er($),y.c(),K(y,1),y.m(t,null)):y&&(Vt(),Q(y,1,1,()=>{y=null}),Zt())},i($){v||(K(o.$$.fragment,$),K(f.$$.fragment,$),K(g.$$.fragment,$),K(h),K(y),v=!0)},o($){Q(o.$$.fragment,$),Q(f.$$.fragment,$),Q(g.$$.fragment,$),Q(h),Q(y),v=!1},d($){$&&pt(t),dt(o),dt(f),dt(g),h&&h.d(),b&&b.d(),y&&y.d()}}}function co(r){let t,e;return t=new ga({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function fo(r){let t,e;return t=new wa({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function uo(r){let t,e,n,a;const i=[fo,co],s=[];function o(l,c){return l[11]?0:1}return t=o(r),e=s[t]=i[t](r),{c(){e.c(),n=vn()},m(l,c){s[t].m(l,c),gt(l,n,c),a=!0},p(l,c){let f=t;t=o(l),t!==f&&(Vt(),Q(s[f],1,1,()=>{s[f]=null}),Zt(),e=s[t],e||(e=s[t]=i[t](l),e.c()),K(e,1),e.m(n.parentNode,n))},i(l){a||(K(e),a=!0)},o(l){Q(e),a=!1},d(l){l&&pt(n),s[t].d(l)}}}function ho(r){let t;return{c(){t=It("New Draft")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function po(r){let t,e;return t=new _a({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Sr(r){let t,e,n,a,i,s,o,l,c;return a=new be({props:{clickHandler:r[22],variant:"primary",$$slots:{default:[mo]},$$scope:{ctx:r}}}),s=new be({props:{clickHandler:r[44],$$slots:{default:[go]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("input"),n=mt(),ht(a.$$.fragment),i=mt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Draft name"),et(t,"class","create-inline wa-row")},m(f,d){gt(f,t,d),nt(t,e),hn(e,r[10]),nt(t,n),ut(a,t,null),nt(t,i),ut(s,t,null),o=!0,l||(c=fe(e,"input",r[43]),l=!0)},p(f,d){d[0]&1024&&e.value!==f[10]&&hn(e,f[10]);const g={};d[2]&256&&(g.$$scope={dirty:d,ctx:f}),a.$set(g);const u={};d[0]&1536&&(u.clickHandler=f[44]),d[2]&256&&(u.$$scope={dirty:d,ctx:f}),s.$set(u)},i(f){o||(K(a.$$.fragment,f),K(s.$$.fragment,f),o=!0)},o(f){Q(a.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&pt(t),dt(a),dt(s),l=!1,c()}}}function mo(r){let t;return{c(){t=It("Create")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function go(r){let t;return{c(){t=It("Cancel")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Fr(r){let t;return{c(){t=ct("div"),t.textContent="No drafts found."},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Er(r){let t,e,n=_e(r[5]),a=[];for(let s=0;s<n.length;s+=1)a[s]=Pr(yr(r,n,s));const i=s=>Q(a[s],1,1,()=>{a[s]=null});return{c(){t=ct("div");for(let s=0;s<a.length;s+=1)a[s].c();et(t,"class","wa-draft-list")},m(s,o){gt(s,t,o);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(t,null);e=!0},p(s,o){if(o[0]&251662368|o[1]&8){n=_e(s[5]);let l;for(l=0;l<n.length;l+=1){const c=yr(s,n,l);a[l]?(a[l].p(c,o),K(a[l],1)):(a[l]=Pr(c),a[l].c(),K(a[l],1),a[l].m(t,null))}for(Vt(),l=n.length;l<a.length;l+=1)i(l);Zt()}},i(s){if(!e){for(let o=0;o<n.length;o+=1)K(a[o]);e=!0}},o(s){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)Q(a[o]);e=!1},d(s){s&&pt(t),Kr(a,s)}}}function xr(r){let t;return{c(){t=ct("span"),t.textContent="●",et(t,"class","wa-draft-active-indicator"),et(t,"title","Active draft")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function wo(r){let t,e;return t=new ba({props:{size:Ce}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:xt,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Dr(r){let t,e;function n(){return r[46](r[67])}return t=new se({props:{ariaLabel:"Set active draft",title:void 0,clickHandler:n,$$slots:{default:[bo]},$$scope:{ctx:r}}}),{c(){ht(t.$$.fragment)},m(a,i){ut(t,a,i),e=!0},p(a,i){r=a;const s={};i[0]&32&&(s.clickHandler=n),i[2]&256&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function bo(r){let t,e;return t=new Ss({props:{size:Ce}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:xt,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function vo(r){let t,e;return t=new va({props:{size:Ce}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:xt,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function _o(r){let t,e;return t=new As({props:{size:Ce}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:xt,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function yo(r){let t,e;return t=new ya({props:{size:Ce}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:xt,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Pr(r){let t,e,n,a=r[67]+"",i,s,o,l,c,f,d,g,u,m,p,v,h,b,y=r[12]===r[67]&&xr();function $(){return r[45](r[67])}l=new se({props:{ariaLabel:"Open draft",title:void 0,clickHandler:$,$$slots:{default:[wo]},$$scope:{ctx:r}}});let k=r[12]!==r[67]&&Dr(r);function N(){return r[47](r[67])}d=new se({props:{ariaLabel:"Rename draft",title:void 0,clickHandler:N,$$slots:{default:[vo]},$$scope:{ctx:r}}});function j(){return r[48](r[67])}u=new se({props:{ariaLabel:"Duplicate draft",title:void 0,clickHandler:j,$$slots:{default:[_o]},$$scope:{ctx:r}}});function z(){return r[49](r[67])}return p=new se({props:{ariaLabel:"Delete draft",title:void 0,clickHandler:z,$$slots:{default:[yo]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("div"),y&&y.c(),n=mt(),i=It(a),s=mt(),o=ct("div"),ht(l.$$.fragment),c=mt(),k&&k.c(),f=mt(),ht(d.$$.fragment),g=mt(),ht(u.$$.fragment),m=mt(),ht(p.$$.fragment),v=mt(),et(e,"class","wa-draft-name wa-row"),et(o,"class","wa-draft-actions"),et(t,"class",h="wa-draft-item "+(r[12]===r[67]?"active":""))},m(A,O){gt(A,t,O),nt(t,e),y&&y.m(e,null),nt(e,n),nt(e,i),nt(t,s),nt(t,o),ut(l,o,null),nt(o,c),k&&k.m(o,null),nt(o,f),ut(d,o,null),nt(o,g),ut(u,o,null),nt(o,m),ut(p,o,null),nt(t,v),b=!0},p(A,O){r=A,r[12]===r[67]?y||(y=xr(),y.c(),y.m(e,n)):y&&(y.d(1),y=null),(!b||O[0]&32)&&a!==(a=r[67]+"")&&We(i,a);const q={};O[0]&32&&(q.clickHandler=$),O[2]&256&&(q.$$scope={dirty:O,ctx:r}),l.$set(q),r[12]!==r[67]?k?(k.p(r,O),O[0]&4128&&K(k,1)):(k=Dr(r),k.c(),K(k,1),k.m(o,f)):k&&(Vt(),Q(k,1,1,()=>{k=null}),Zt());const F={};O[0]&32&&(F.clickHandler=N),O[2]&256&&(F.$$scope={dirty:O,ctx:r}),d.$set(F);const L={};O[0]&32&&(L.clickHandler=j),O[2]&256&&(L.$$scope={dirty:O,ctx:r}),u.$set(L);const _={};O[0]&32&&(_.clickHandler=z),O[2]&256&&(_.$$scope={dirty:O,ctx:r}),p.$set(_),(!b||O[0]&4128&&h!==(h="wa-draft-item "+(r[12]===r[67]?"active":"")))&&et(t,"class",h)},i(A){b||(K(l.$$.fragment,A),K(k),K(d.$$.fragment,A),K(u.$$.fragment,A),K(p.$$.fragment,A),b=!0)},o(A){Q(l.$$.fragment,A),Q(k),Q(d.$$.fragment,A),Q(u.$$.fragment,A),Q(p.$$.fragment,A),b=!1},d(A){A&&pt(t),y&&y.d(),dt(l),k&&k.d(),dt(d),dt(u),dt(p)}}}function Nr(r){let t,e,n,a,i,s,o,l,c,f,d,g;o=new be({props:{clickHandler:r[50],variant:"primary",$$slots:{default:[ko]},$$scope:{ctx:r}}});let u=r[15]&&jr(r);const m=[Eo,Fo,So],p=[];function v(h,b){return h[14]?0:h[13].length===0?1:2}return f=v(r),d=p[f]=m[f](r),{c(){t=ct("div"),e=ct("div"),n=ct("div"),a=ct("div"),a.textContent="Chapters",i=mt(),s=ct("div"),ht(o.$$.fragment),l=mt(),u&&u.c(),c=mt(),d.c(),et(a,"class","wa-title"),et(s,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","chapter-controls"),ve(t,"margin-top","18px")},m(h,b){gt(h,t,b),nt(t,e),nt(e,n),nt(n,a),nt(n,i),nt(n,s),ut(o,s,null),nt(t,l),u&&u.m(t,null),nt(t,c),p[f].m(t,null),g=!0},p(h,b){const y={};b[0]&32768&&(y.clickHandler=h[50]),b[2]&256&&(y.$$scope={dirty:b,ctx:h}),o.$set(y),h[15]?u?(u.p(h,b),b[0]&32768&&K(u,1)):(u=jr(h),u.c(),K(u,1),u.m(t,c)):u&&(Vt(),Q(u,1,1,()=>{u=null}),Zt());let $=f;f=v(h),f===$?p[f].p(h,b):(Vt(),Q(p[$],1,1,()=>{p[$]=null}),Zt(),d=p[f],d?d.p(h,b):(d=p[f]=m[f](h),d.c()),K(d,1),d.m(t,null))},i(h){g||(K(o.$$.fragment,h),K(u),K(d),g=!0)},o(h){Q(o.$$.fragment,h),Q(u),Q(d),g=!1},d(h){h&&pt(t),dt(o),u&&u.d(),p[f].d()}}}function ko(r){let t;return{c(){t=It("New Chapter")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function jr(r){let t,e,n,a,i,s,o,l,c;return a=new be({props:{clickHandler:r[52],variant:"primary",$$slots:{default:[$o]},$$scope:{ctx:r}}}),s=new be({props:{clickHandler:r[53],$$slots:{default:[Co]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("input"),n=mt(),ht(a.$$.fragment),i=mt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Chapter name"),et(t,"class","create-inline wa-row")},m(f,d){gt(f,t,d),nt(t,e),hn(e,r[16]),nt(t,n),ut(a,t,null),nt(t,i),ut(s,t,null),o=!0,l||(c=fe(e,"input",r[51]),l=!0)},p(f,d){d[0]&65536&&e.value!==f[16]&&hn(e,f[16]);const g={};d[0]&229393&&(g.clickHandler=f[52]),d[2]&256&&(g.$$scope={dirty:d,ctx:f}),a.$set(g);const u={};d[0]&229376&&(u.clickHandler=f[53]),d[2]&256&&(u.$$scope={dirty:d,ctx:f}),s.$set(u)},i(f){o||(K(a.$$.fragment,f),K(s.$$.fragment,f),o=!0)},o(f){Q(a.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&pt(t),dt(a),dt(s),l=!1,c()}}}function $o(r){let t;return{c(){t=It("Create")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Co(r){let t;return{c(){t=It("Cancel")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function So(r){let t,e=[],n=new Map,a,i=_e(r[13]);const s=o=>o[64].chapterName;for(let o=0;o<i.length;o+=1){let l=_r(r,i,o),c=s(l);n.set(c,e[o]=Ar(c,l))}return{c(){t=ct("div");for(let o=0;o<e.length;o+=1)e[o].c();et(t,"class","wa-draft-list")},m(o,l){gt(o,t,l);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);a=!0},p(o,l){if(l[0]&1610620928|l[1]&7){i=_e(o[13]),Vt();for(let c=0;c<e.length;c+=1)e[c].r();e=Jr(e,l,s,1,o,i,n,t,wi,Ar,null,_r);for(let c=0;c<e.length;c+=1)e[c].a();Zt()}},i(o){if(!a){for(let l=0;l<i.length;l+=1)K(e[l]);a=!0}},o(o){for(let l=0;l<e.length;l+=1)Q(e[l]);a=!1},d(o){o&&pt(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function Fo(r){let t;return{c(){t=ct("div"),t.textContent="No chapters found.",ve(t,"margin-top","1em")},m(e,n){gt(e,t,n)},p:xt,i:xt,o:xt,d(e){e&&pt(t)}}}function Eo(r){let t;return{c(){t=ct("div"),t.textContent="Loading chapters..."},m(e,n){gt(e,t,n)},p:xt,i:xt,o:xt,d(e){e&&pt(t)}}}function xo(r){let t,e;return t=new wa({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Do(r){let t,e;return t=new ga({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Po(r){let t,e;return t=new ba({props:{size:Ce}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:xt,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function No(r){let t,e;return t=new va({props:{size:Ce}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:xt,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function jo(r){let t,e;return t=new ya({props:{size:Ce}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:xt,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ar(r,t){let e,n,a=t[64].chapterName+"",i,s,o,l,c,f,d,g,u,m,p,v,h,b,y=xt,$;function k(){return t[54](t[66])}l=new be({props:{title:"Move chapter up",clickHandler:k,disabled:t[66]===0,$$slots:{default:[xo]},$$scope:{ctx:t}}});function N(){return t[55](t[66])}f=new be({props:{title:"Move chapter down",clickHandler:N,disabled:t[66]===t[13].length-1,$$slots:{default:[Do]},$$scope:{ctx:t}}});function j(){return t[56](t[64])}g=new se({props:{ariaLabel:"Open chapter",title:void 0,clickHandler:j,$$slots:{default:[Po]},$$scope:{ctx:t}}});function z(){return t[57](t[64])}m=new se({props:{ariaLabel:"Rename chapter",title:void 0,clickHandler:z,$$slots:{default:[No]},$$scope:{ctx:t}}});function A(){return t[58](t[64])}return v=new se({props:{ariaLabel:"Delete chapter",title:void 0,clickHandler:A,$$slots:{default:[jo]},$$scope:{ctx:t}}}),{key:r,first:null,c(){e=ct("div"),n=ct("div"),i=It(a),s=mt(),o=ct("div"),ht(l.$$.fragment),c=mt(),ht(f.$$.fragment),d=mt(),ht(g.$$.fragment),u=mt(),ht(m.$$.fragment),p=mt(),ht(v.$$.fragment),h=mt(),et(n,"class","wa-draft-name"),et(o,"class","wa-draft-actions"),et(e,"class","wa-draft-item"),this.first=e},m(O,q){gt(O,e,q),nt(e,n),nt(n,i),nt(e,s),nt(e,o),ut(l,o,null),nt(o,c),ut(f,o,null),nt(o,d),ut(g,o,null),nt(o,u),ut(m,o,null),nt(o,p),ut(v,o,null),nt(e,h),$=!0},p(O,q){t=O,(!$||q[0]&8192)&&a!==(a=t[64].chapterName+"")&&We(i,a);const F={};q[0]&8192&&(F.clickHandler=k),q[0]&8192&&(F.disabled=t[66]===0),q[2]&256&&(F.$$scope={dirty:q,ctx:t}),l.$set(F);const L={};q[0]&8192&&(L.clickHandler=N),q[0]&8192&&(L.disabled=t[66]===t[13].length-1),q[2]&256&&(L.$$scope={dirty:q,ctx:t}),f.$set(L);const _={};q[0]&8192&&(_.clickHandler=j),q[2]&256&&(_.$$scope={dirty:q,ctx:t}),g.$set(_);const W={};q[0]&8192&&(W.clickHandler=z),q[2]&256&&(W.$$scope={dirty:q,ctx:t}),m.$set(W);const st={};q[0]&8192&&(st.clickHandler=A),q[2]&256&&(st.$$scope={dirty:q,ctx:t}),v.$set(st)},r(){b=e.getBoundingClientRect()},f(){oi(e),y()},a(){y(),y=si(e,b,so,{duration:500,easing:ka})},i(O){$||(K(l.$$.fragment,O),K(f.$$.fragment,O),K(g.$$.fragment,O),K(m.$$.fragment,O),K(v.$$.fragment,O),$=!0)},o(O){Q(l.$$.fragment,O),Q(f.$$.fragment,O),Q(g.$$.fragment,O),Q(m.$$.fragment,O),Q(v.$$.fragment,O),$=!1},d(O){O&&pt(e),dt(l),dt(f),dt(g),dt(m),dt(v)}}}function Ao(r){var y;let t,e,n,a,i,s,o,l,c,f,d,g,u,m;s=new se({props:{ariaLabel:"Refresh projects",clickHandler:r[40],title:void 0,spinning:r[6],$$slots:{default:[oo]},$$scope:{ctx:r}}}),c=new be({props:{title:"Create New Project",clickHandler:r[35],variant:"primary",style:"width: 40%; margin: 0 auto;",$$slots:{default:[lo]},$$scope:{ctx:r}}});let p=r[2].length===0&&kr(),v=r[2].length>0&&$r(r),h=r[4]&&Cr(r),b=r[4]&&((y=r[0])==null?void 0:y.activeDraft)&&r[18]&&Nr(r);return{c(){t=ct("div"),e=ct("div"),n=ct("div"),n.textContent=`${Et} Projects`,a=mt(),i=ct("div"),ht(s.$$.fragment),o=mt(),l=ct("div"),ht(c.$$.fragment),f=mt(),p&&p.c(),d=mt(),v&&v.c(),g=mt(),h&&h.c(),u=mt(),b&&b.c(),et(n,"class","wa-title"),et(e,"class","wa-row justify-between"),et(l,"class","wa-row"),ve(l,"margin","18px 0 10px 0"),et(t,"class","project-list wa-panel")},m($,k){gt($,t,k),nt(t,e),nt(e,n),nt(e,a),nt(e,i),ut(s,i,null),nt(t,o),nt(t,l),ut(c,l,null),nt(t,f),p&&p.m(t,null),nt(t,d),v&&v.m(t,null),nt(t,g),h&&h.m(t,null),nt(t,u),b&&b.m(t,null),m=!0},p($,k){var z;const N={};k[0]&64&&(N.spinning=$[6]),k[2]&256&&(N.$$scope={dirty:k,ctx:$}),s.$set(N);const j={};k[2]&256&&(j.$$scope={dirty:k,ctx:$}),c.$set(j),$[2].length===0?p||(p=kr(),p.c(),p.m(t,d)):p&&(p.d(1),p=null),$[2].length>0?v?(v.p($,k),k[0]&4&&K(v,1)):(v=$r($),v.c(),K(v,1),v.m(t,g)):v&&(Vt(),Q(v,1,1,()=>{v=null}),Zt()),$[4]?h?(h.p($,k),k[0]&16&&K(h,1)):(h=Cr($),h.c(),K(h,1),h.m(t,u)):h&&(Vt(),Q(h,1,1,()=>{h=null}),Zt()),$[4]&&((z=$[0])!=null&&z.activeDraft)&&$[18]?b?(b.p($,k),k[0]&262161&&K(b,1)):(b=Nr($),b.c(),K(b,1),b.m(t,null)):b&&(Vt(),Q(b,1,1,()=>{b=null}),Zt())},i($){m||(K(s.$$.fragment,$),K(c.$$.fragment,$),K(v),K(h),K(b),m=!0)},o($){Q(s.$$.fragment,$),Q(c.$$.fragment,$),Q(v),Q(h),Q(b),m=!1},d($){$&&pt(t),dt(s),dt(c),p&&p.d(),v&&v.d(),h&&h.d(),b&&b.d()}}}let To=!1,Oo="";const Ce=20;let Bo=null;function Ro(r,t,e){let{manager:n}=t,{projectService:a}=t,{projectFileService:i}=t,s=null,o=[],l,c=null,f=[],d=!1,g=[],u=!1,m=!1,p="",v=!0,h=null,b=null,y=[],$=!1,k=!1,N="",j="",z=!1,A=!1;On(()=>{try{n&&b&&n.removeActiveProjectListener(b)}catch{}});async function O(I=!1){if(!a)return[];e(6,d=!0);const rt=new Promise(yt=>setTimeout(yt,400)),it=[...o],_t=s;let Tt=[],$t=[];try{Tt=a.listAllFolders(),$t=[];for(const yt of Tt)await a.isProjectFolder(yt)&&$t.push(yt)}catch{$t=[]}const Qt=$t.filter(yt=>!it.includes(yt)),Ct=it.filter(yt=>!$t.includes(yt));if(I&&Qt.length>0&&new D.Notice(`${Qt.length} new project${Qt.length>1?"s":""} discovered.`),I&&Ct.length>0&&new D.Notice(`${Ct.length} project${Ct.length>1?"s":""} removed.`),e(2,o=$t),e(7,g=$t.map(yt=>({value:yt,label:yt}))),$t.length===0)e(1,s=null),e(3,l=void 0),e(4,c=null);else if($t.length===1){e(1,s=$t[0]),e(3,l=g[0]),e(4,c=$t[0]);try{x(`${E} panel refresh selected single project '${c}'`)}catch{}}else if(_t&&!$t.includes(_t)){e(1,s=$t[0]),e(3,l=g[0]),e(4,c=$t[0]);try{x(`${E} panel refresh selected fallback project '${c}'`)}catch{}}else{const yt=g.find(me=>me.value===_t);if(yt){e(1,s=_t),e(3,l=yt),e(4,c=yt.value);try{x(`${E} panel refresh kept project '${c}'`)}catch{}}else e(1,s=null),e(3,l=void 0),e(4,c=null)}return await rt,e(6,d=!1),c&&await q(),$t}async function q(){if(!i||!c){e(5,f=[]);return}const I=h;e(8,u=!0);const rt=new Promise(it=>setTimeout(it,400));try{e(5,f=i.drafts.listDrafts(c)||[]),e(5,f=Array.from(f)),f.sort((it,_t)=>it>_t?1:it<_t?-1:0),v||f.reverse();try{x(`${E} refreshDrafts: loaded ${f.length} drafts, preserving active draft: ${I}`)}catch{}}catch{e(5,f=[])}finally{await rt,e(8,u=!1)}}async function F(){if(!n||!i)return;e(14,$=!0);const I=new Promise(rt=>setTimeout(rt,400));try{if(!c){e(13,y=[]),e(18,z=!1);return}const rt=`${c}/${ie(n==null?void 0:n.settings)}`,it=await De(n.app,rt);if(e(18,z=(it==null?void 0:it.project_type)==="multi-file"),!z){e(13,y=[]);return}if(!(n!=null&&n.activeDraft)){e(13,y=[]);return}let _t=[];_t=await i.chapters.listChapters(c,n.activeDraft),e(13,y=Array.isArray(_t)?_t:[])}catch{e(13,y=[]),e(18,z=!1)}finally{await I,e(14,$=!1)}}async function L(){if(!n||!c||!p.trim())return;const I=p.trim();try{await n.createNewDraft(I,Oo||void 0,c),e(12,h=n.activeDraft),new D.Notice(`Draft "${I}" created.`)}catch(rt){x(`${E} Failed to create draft:`,rt),new D.Notice("Failed to create draft.")}e(10,p=""),e(9,m=!1),await q()}async function _(){e(9,m=!0)}async function W(I){if(!i||!n||!c)return;let rt=!1;rt=await i.drafts.openDraft(c,I),rt||n!=null&&n.setActiveDraft&&await n.setActiveDraft(I,c),await q(),await F()}async function st(I){if(!n||!c)return;const rt=`${I} Copy`;new ro(n.app,{sourceDraftName:I,suggestedName:rt,onSubmit:async it=>{if(n)try{await n.createNewDraft(it,I,c||void 0),await q(),new D.Notice(`Draft '${it}' created as duplicate of '${I}'.`)}catch(_t){x(`${E} Failed to duplicate draft:`,_t),new D.Notice("Failed to duplicate draft.")}}}).open()}async function V(I){if(!n||!c)return;new io(n.app,I,async(it,_t)=>{try{x(`${E} renameDraft: user entered: ${it}, renameFile: ${_t}`),await n.renameDraft(I,it,c||void 0,_t),x(`${E} renameDraft: rename successful, refreshing drafts`),await q(),new D.Notice(`Draft '${I}' renamed to '${it}'.`)}catch(Tt){x(`${E} renameDraft: error:`,Tt),new D.Notice("Failed to rename draft.")}}).open()}async function ot(I){if(!n||!c)return;new vr(n.app,I,async()=>{n&&(await n.deleteDraft(I,c||void 0),await q())},"draft").open()}async function G(I){I&&(n!=null&&n.setActiveProject&&await n.setActiveProject(I),e(1,s=I),e(4,c=I),e(12,h=(n==null?void 0:n.activeDraft)??null),await q(),await F())}async function ft(I){if(I===0||!n||!c||!n.activeDraft)return;const rt=y.slice();[rt[I-1],rt[I]]=[rt[I],rt[I-1]];const it=rt.map((_t,Tt)=>({chapterName:_t.chapterName||"",order:Tt+1}));await n.reorderChapters(c,n.activeDraft,it),await F()}async function R(I){if(I===y.length-1||!n||!c||!n.activeDraft)return;const rt=y.slice();[rt[I],rt[I+1]]=[rt[I+1],rt[I]];const it=rt.map((_t,Tt)=>({chapterName:_t.chapterName||"",order:Tt+1}));await n.reorderChapters(c,n.activeDraft,it),await F()}async function B(I){!c||!(n!=null&&n.activeDraft)||await n.openChapter(c,n.activeDraft,I)}function lt(I){if(!c||!(n!=null&&n.activeDraft))return;new ao(n.app,I,async it=>{!(n!=null&&n.activeDraft)||!c||(await n.renameChapter(c,n.activeDraft,I,it),await F())}).open()}function U(I){new vr(n.app,I,async()=>{!(n!=null&&n.activeDraft)||!c||(await n.deleteChapter(c,n.activeDraft,I),await F())},"chapter").open()}async function X(I){c&&(n!=null&&n.setActiveDraft&&await n.setActiveDraft(I,c),e(12,h=(n==null?void 0:n.activeDraft)??null),await q(),await F())}async function St(){if(!n||!a)return;const I=n.app,{CreateProjectModal:rt}=await Promise.resolve().then(()=>rl);let it=null;new rt(I,async(Tt,$t,Qt)=>{if(!Tt||!n||!a||(it=await a.createProject(Tt,$t,Qt,void 0,n.settings),!it))return;let Ct=[],yt=null;for(let me=0;me<20;me++){await new Promise(Pe=>setTimeout(Pe,100)),Ct=await O();const te=Ct.find(Pe=>Pe===it);if(yt=typeof te=="string"?te:null,yt)break}typeof yt=="string"&&yt&&(e(1,s=yt),e(3,l={value:yt,label:yt}),e(4,c=yt),n.setActiveDraft&&await n.setActiveDraft(Qt??"Draft 1",yt),await q(),await F())}).open()}On(()=>{zt(()=>{n&&n.removeActiveDraftListener}),zt(()=>{n&&typeof n.removeActiveProjectListener=="function"&&b&&n.removeActiveProjectListener(b)})});const Nt=()=>O(!0),wt=I=>{const rt=I.detail;e(3,l=rt),e(4,c=typeof rt=="string"?rt:rt?rt.value:void 0),e(1,s=c??null),G(c??null)},kt=()=>{e(11,v=!v),q()};function jt(){p=this.value,e(10,p)}const Dt=()=>{e(9,m=!1),e(10,p="")},Jt=I=>W(I),Ut=I=>X(I),w=I=>V(I),H=I=>st(I),M=I=>ot(I),S=()=>e(15,k=!k);function C(){N=this.value,e(16,N)}const P=async()=>{!c||!(n!=null&&n.activeDraft)||!N.trim()||(await n.createChapter(c,n.activeDraft,N.trim()),e(16,N=""),e(17,j=""),e(15,k=!1),await F())},Z=()=>{e(15,k=!1),e(16,N=""),e(17,j="")},Y=I=>ft(I),T=I=>R(I),J=I=>B(I.name),at=I=>lt(I.chapterName||""),tt=I=>U(I.chapterName||"");return r.$$set=I=>{"manager"in I&&e(0,n=I.manager),"projectService"in I&&e(36,a=I.projectService),"projectFileService"in I&&e(37,i=I.projectFileService)},r.$$.update=()=>{if(r.$$.dirty[0]&1|r.$$.dirty[1]&480&&n&&a&&i&&!A){e(39,A=!0),x(`${E} ProjectPanel initializing with manager`),e(12,h=n.activeDraft??null),e(1,s=n.activeProject??null);const I=rt=>{e(12,h=rt),x(`${E} active draft updated -> ${rt}`),F()};n.addActiveDraftListener(I),e(38,b=rt=>{e(1,s=rt),x(`${E} active project updated -> ${rt}`),rt?O():(e(3,l=void 0),e(4,c=null),e(5,f=[]),e(13,y=[]),e(18,z=!1))}),n.addActiveProjectListener(b),O()}},[n,s,o,l,c,f,d,g,u,m,p,v,h,y,$,k,N,j,z,O,q,F,L,_,W,st,V,ot,G,ft,R,B,lt,U,X,St,a,i,b,A,Nt,wt,kt,jt,Dt,Jt,Ut,w,H,M,S,C,P,Z,Y,T,J,at,tt]}class zo extends Mt{constructor(t){super(),Lt(this,t,Ro,Ao,Bt,{manager:0,projectService:36,projectFileService:37},null,[-1,-1,-1])}}const ge="writeaid-project-panel";class Io extends D.ItemView{constructor(t,e,n){super(t),this.panelEl=null,this.selectedProject=null,this.app=e,this.manager=n,this.projectService=new un(e),this.projectFileService=new Wn(e,this.projectService)}getViewType(){return ge}getDisplayText(){return`${Et} Projects`}getIcon(){return Ln}async onOpen(){this.panelEl=this.contentEl.createEl("div",{cls:"writeaid-project-panel"});try{if(!this.manager){x(`${E} Manager not available in ProjectPanelView.onOpen`),new D.Notice(`${Et}: manager not available, cannot mount project panel.`);return}x(`${E} Mounting ProjectPanel with manager:`,!!this.manager),this.projectPanel=new zo({target:this.panelEl,props:{manager:this.manager,projectService:this.projectService,projectFileService:this.projectFileService}}),x(`${E} ProjectPanel mounted successfully`)}catch(t){x(`${E} failed to mount project panel:`,t),new D.Notice(`${Et}: failed to mount project panel. Check console for details.`)}}async onClose(){if(this.projectPanel){try{this.projectPanel.$destroy()}catch(t){x(`${E} Error destroying project panel:`,t)}this.projectPanel=void 0}}refreshDraftsSection(){this.projectPanel&&typeof this.projectPanel.refreshDrafts=="function"&&(x(`${E} Refreshing drafts section in project panel`),this.projectPanel.refreshDrafts())}}function Lo(r){return async()=>{x(`${E} List backups command called`);let t;const e=r.app.workspace.getLeavesOfType(ge);if(e.length>0){const a=e[0].view;t=()=>{a.refreshDraftsSection()}}new Ba(r.app,r,t).open()}}function Mo(r){return()=>(x(`${E} Create new draft command called`),r.createNewDraftPrompt())}async function Uo(r){x(`${E} createOutlineCommand called`);try{const t=r.activeProject,e=r.activeDraft;if(!t||!e){new D.Notice("No active project or draft selected. Please select a project and draft first.");return}const n=r.projectFileService.drafts.getOutlineFile(t,e);if(n){new D.Notice(`Outline file already exists: ${n.path}`);return}await r.projectFileService.drafts.createOutline(t,e,r.settings.outlineTemplate),new D.Notice(`Outline created for draft: ${e}`),x(`${E} Outline created successfully for draft: ${e}`)}catch(t){x(`${E} Error creating outline:`,t),new D.Notice(`Failed to create outline: ${t.message}`)}}function Wo(r){return async()=>{var i;const t=r.projectFileService.drafts,e=r.activeProject,n=r.activeDraft;if(x(`${E} Generate manuscript command called`),x(`${E} Active project: ${e}, active draft: ${n}`),x(`${E} Manager settings manuscript template: ${(i=r.settings)==null?void 0:i.manuscriptNameTemplate}`),!Ue(e,n))return;await t.generateManuscript(e,n,r.settings)?new D.Notice("Manuscript generated successfully."):new D.Notice("Failed to generate manuscript.")}}function Tr(r){const t={},e=r.match(Rt);if(e){const n=e[1],a=n.match(/^id:\s*(.+?)$/m),i=n.match(/^draft:\s*(.+?)$/m),s=n.match(/^project:\s*(.+?)$/m),o=n.match(/^created:\s*(.+?)$/m);a&&(t.id=a[1].trim()),i&&(t.draft=i[1].trim()),s&&(t.project=s[1].trim()),o&&(t.created=o[1].trim())}return t}function Or(r){return!!(r.id&&r.draft&&r.project&&r.created)}function xn(r,t,e){return{id:r.id||Je(),draft:r.draft||t,project:r.project||e,created:r.created||new Date().toISOString()}}function Dn(r,t){const e=r.match(Rt);if(e){const n=e[1],a=r.substring(e[0].length),i=n.split(`
`),s=[],o=new Set;for(const c of i)c.match(/^id:/i)?(s.push(`id: ${t.id}`),o.add("id")):c.match(/^draft:/i)?(s.push(`draft: ${t.draft}`),o.add("draft")):c.match(/^project:/i)?(s.push(`project: ${t.project}`),o.add("project")):c.match(/^created:/i)?(s.push(`created: ${t.created}`),o.add("created")):s.push(c);o.has("id")||s.push(`id: ${t.id}`),o.has("draft")||s.push(`draft: ${t.draft}`),o.has("project")||s.push(`project: ${t.project}`),o.has("created")||s.push(`created: ${t.created}`);const l=s.join(`
`);return`${Ft}
${l}
${Ft}${a}`}else return`${Ft}
id: ${t.id}
draft: ${t.draft}
project: ${t.project}
created: ${t.created}
${Ft}

`+r}class Ho extends D.SuggestModal{constructor(t,e,n){super(t),this.onSelect=n,this.files=[],this.files=e,this.setPlaceholder("Select a file to initialize as draft file..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"esc",purpose:"to cancel"}]),this.setTitle("Select File for Draft Metadata")}getSuggestions(){return this.files}renderSuggestion(t,e){e.createEl("div",{text:t.name})}async onChooseSuggestion(t){await this.onSelect(t)}}function Vo(r){return async()=>{const t=r.activeProject,e=r.activeDraft;x(`${E} Initialize draft file command called`),x(`${E} Active project: ${t}, active draft: ${e}`);try{if(!Ue(t,e)){x(`${E} Initialize draft file: active project/draft check failed`);return}if(!t||!e){x(`${E} Initialize draft file: no active project or draft`),new D.Notice("Active project or draft not found.");return}const n=At(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const g of a.children)if(g instanceof D.TFolder&&g.name.toLowerCase()===n.toLowerCase()){i=g.name;break}}const s=`${t}/${i}/${e}`,o=t.split("/").pop()||t;x(`${E} Initialize draft file: using drafts folder: ${i}`);const l=r.app.vault.getAbstractFileByPath(s);if(!l||!(l instanceof D.TFolder)){x(`${E} Initialize draft file: draft folder not found at ${s}`),new D.Notice("Draft folder not found.");return}const c=l.children.filter(g=>g instanceof D.TFile&&g.extension==="md").filter(g=>!g.path.includes("/Chapters/")&&g.name!=="outline.md");if(x(`${E} Found ${c.length} markdown files in draft folder`),c.length===0){x(`${E} No files found, creating new draft file`);const g=xn({},e,o),u=Dn("",g),m=`${e}${bt}`;await r.app.vault.create(`${s}/${m}`,u),new D.Notice(`Draft file created with metadata for "${e}".`);return}if(c.length===1){const g=c[0],u=await r.app.vault.read(g),m=Tr(u);if(Or(m)){x(`${E} Initialize draft file: file already has complete metadata`),new D.Notice(`"${g.name}" already has complete draft metadata.`);return}x(`${E} Adding missing metadata to ${g.name}`);const p=xn(m,e,o),v=Dn(u,p);await r.app.vault.modify(g,v),x(`${E} Initialize draft file: successfully updated ${g.name}`),new D.Notice(`Draft metadata added to "${g.name}".`);return}x(`${E} Multiple files found, showing selection modal`);const f=c.map(g=>({path:g.path,name:g.name,file:g}));new Ho(r.app,f,async g=>{const u=g.file,m=await r.app.vault.read(u),p=Tr(m);if(Or(p)){x(`${E} Initialize draft file: selected file already has complete metadata`),new D.Notice(`"${u.name}" already has complete draft metadata.`);return}x(`${E} Adding missing metadata to ${u.name}`);const v=xn(p,e,o),h=Dn(m,v);await r.app.vault.modify(u,h),x(`${E} Initialize draft file: successfully updated ${u.name} from modal`),new D.Notice(`Draft metadata added to "${u.name}".`)}).open()}catch(n){x(`${E} Initialize draft file command error:`,n),new D.Notice("Failed to initialize draft file metadata.")}}}function Zo(r){return()=>(x(`${E} Switch draft command called`),r.switchDraftPrompt())}function Go(r){return async()=>{x(`${E} Navigate to next chapter command called`);const t=r.app.workspace.getActiveFile();if(!t){x(`${E} navigateToNextChapter: no active file`),new D.Notice("No file is currently open.");return}const e=t.path,n=At(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${bt}$`));if(!a){x(`${E} navigateToNextChapter: file is not a chapter`),new D.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{x(`${E} navigateToNextChapter: looking for next chapter after ${o}`);const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(d=>d.name===o);if(c===-1){new D.Notice("Unable to find the current chapter in the draft.");return}if(c>=l.length-1)return;const f=l[c+1];await r.openChapter(i,s,f.name)}catch(l){x(`${E} Failed to navigate to next chapter:`,l),new D.Notice("Failed to navigate to next chapter.")}}}function Yo(r){return async()=>{x(`${E} Navigate to previous chapter command called`);const t=r.app.workspace.getActiveFile();if(!t){x(`${E} navigateToPreviousChapter: no active file`),new D.Notice("No file is currently open.");return}const e=t.path,n=At(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${bt}$`));if(!a){x(`${E} navigateToPreviousChapter: file is not a chapter`),new D.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{x(`${E} navigateToPreviousChapter: looking for previous chapter before ${o}`);const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(d=>d.name===o);if(c===-1){x(`${E} navigateToPreviousChapter: current chapter not found`),new D.Notice("Unable to find the current chapter in the draft.");return}if(c<=0){x(`${E} navigateToPreviousChapter: already at first chapter`);return}const f=l[c-1];await r.openChapter(i,s,f.name)}catch(l){x(`${E} Failed to navigate to previous chapter:`,l),new D.Notice("Failed to navigate to previous chapter.")}}}async function Ko(r,t,e){const n=`${t}/${ie(e)}`,a=await De(r,n);if(!a||a.project_type!==Ht.SINGLE)return new D.Notice(`Project is not a ${Ht.SINGLE} project.`),!1;a.project_type=Ht.MULTI,await Un(r,n,a);const i=At(e),s=r.vault.getAbstractFileByPath(`${t}/${i}`);if(!s||!(s instanceof D.TFolder))return new D.Notice("Drafts folder not found."),!1;let o=!1;for(const l of s.children)if(l instanceof D.TFolder){const c=ae(l.name),f=l.children.find(d=>d instanceof D.TFile&&d.name===`${c}${bt}`);if(f){const d=`${l.path}/Chapter 1${bt}`;if(f.path!==d){const g=await r.vault.read(f);await r.vault.create(d,g),await r.vault.delete(f),o=!0}}}return o?new D.Notice(`Converted to multi-file project. Draft files renamed to "Chapter 1${bt}".`):new D.Notice("Converted to multi-file project. No draft files needed renaming."),!0}async function qo(r,t,e){if(!t){new D.Notice("No active project selected.");return}await Ko(r,t,e)}function Xo(r){return()=>(x(`${E} Create new project command called`),r.createNewProjectPrompt())}function Jo(r){return()=>(x(`${E} Select active project command called`),r.selectActiveProjectPrompt())}function Qo(r,t){return()=>{x(`${E} Toggle project panel command called`);const e={type:ge,active:!0},n=t.workspace.getLeavesOfType(ge);if(n.length>0){x(`${E} Revealing existing project panel`);const a=n[0];t.workspace.revealLeaf(a)}else{x(`${E} Creating new project panel`);let a=t.workspace.getRightLeaf(!1);a||(a=t.workspace.getRightLeaf(!0)),a.setViewState(e),t.workspace.revealLeaf(a)}}}function tl(r){return()=>(x(`${E} Update project metadata command called`),r.updateProjectMetadataPrompt())}class el extends D.Modal{constructor(t,e,n,a){super(t),this.path=e,this.onCreateAnyway=n,this.onOpenExisting=a}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project already exists"}),t.createEl("p",{text:`A folder named '${this.path}' already exists in the vault.`}),new D.Setting(t).addButton(e=>e.setButtonText("Open Existing").onClick(()=>{x(`${E} ConfirmExistingProjectModal: opening existing project "${this.path}"`),this.close(),this.onOpenExisting()})),new D.Setting(t).addButton(e=>e.setButtonText("Create Anyway").setCta().onClick(()=>{x(`${E} ConfirmExistingProjectModal: creating new project anyway "${this.path}"`),this.close(),this.onCreateAnyway(!0)})),new D.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{x(`${E} ConfirmExistingProjectModal: cancelled for project "${this.path}"`),this.close()}))}onClose(){this.contentEl.empty()}}class nl extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Draft"});const e=this.props.suggestedName;let n="",a="";new D.Setting(t).setName("Draft name").addText(s=>s.setPlaceholder(e).onChange(o=>n=o));const i=this.props.drafts;i.length>0&&new D.Setting(t).setName("Copy from existing draft").addDropdown(s=>{s.addOption("","Start blank");for(const o of i)s.addOption(o,o);s.onChange(o=>a=o)}),new D.Setting(t).addButton(s=>s.setButtonText("Create").setCta().onClick(()=>{const o=n&&n.trim()?n.trim():e;x(`${E} CreateDraftModal: creating draft "${o}", copyFrom: "${a||"none"}"`),this.close(),this.props.onSubmit(o,a||void 0)}))}onClose(){this.contentEl.empty()}}class $a extends D.Modal{constructor(t,e){super(t),this.onSubmit=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Project"});let e="",n=!0,a="Draft 1";new D.Setting(t).setName("Project folder name").addText(i=>i.onChange(s=>e=s)),new D.Setting(t).setName("Project type").addDropdown(i=>{i.addOption("single","Single-file project"),i.addOption("multi","Multi-file project (chapters)"),i.onChange(s=>n=s==="single")}),new D.Setting(t).setName("Initial draft name (optional)").addText(i=>i.setPlaceholder("Draft 1").onChange(s=>a=s||"Draft 1")),new D.Setting(t).addButton(i=>i.setButtonText("Create Project").setCta().onClick(()=>{x(`${E} CreateProjectModal: creating project "${e}", singleFile: ${n}, initialDraftName: ${a}`),this.close(),this.onSubmit(e,n,a||void 0)}))}onClose(){this.contentEl.empty()}}const rl=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectModal:$a},Symbol.toStringTag,{value:"Module"}));class Br extends D.Modal{constructor(t,e,n){super(t),this.projectPath=e,this.onOpenProject=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project created"}),t.createEl("p",{text:`Project '${this.projectPath}' was created.`}),new D.Setting(t).addButton(e=>e.setButtonText("Open Project").setCta().onClick(async()=>{x(`${E} PostCreateModal: opening project "${this.projectPath}"`),this.close(),this.onOpenProject&&await this.onOpenProject()})),new D.Setting(t).addButton(e=>e.setButtonText("Close").onClick(()=>{x(`${E} PostCreateModal: closed for project "${this.projectPath}"`),this.close()}))}onClose(){this.contentEl.empty()}}class Pn extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Select Project for Draft"});let e="";const n=this.props.folders||[];new D.Setting(t).setName("Project folder").addDropdown(a=>{a.addOption("","(Vault root)");for(const i of n)a.addOption(i,i||"(Vault root)");a.onChange(i=>e=i)}),new D.Setting(t).addButton(a=>a.setButtonText("Select").setCta().onClick(()=>{x(`${E} SelectProjectModal: selected project "${e||"(Vault root)"}"`),this.close(),this.props.onSubmit(e||"")}))}onClose(){this.contentEl.empty()}}class al extends D.Modal{constructor(t,e,n){super(t),this.drafts=e,this.onSubmit=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Switch Active Draft"});for(const e of this.drafts)new D.Setting(t).setName(e).addButton(n=>n.setButtonText("Select").onClick(()=>{x(`${E} SwitchDraftModal: selected draft "${e}"`),this.close(),this.onSubmit(e)}))}onClose(){this.contentEl.empty()}}class il{constructor(t,e,n){var a;this.activeDraft=null,this.activeProject=null,this.activeProjectListeners=[],this.activeDraftListeners=[],this.panelRefreshListeners=[],this._panelRefreshTimer=null,this._panelRefreshDebounceMs=250,this.app=t,this.plugin=e,this.settings=e==null?void 0:e.settings,typeof n=="number"&&Number.isFinite(n)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(n))),this.activeProject=((a=this.settings)==null?void 0:a.activeProject)||null,this.projectService=new un(t),this.projectFileService=new Wn(t,this.projectService,this.settings)}async reorderChapters(t,e,n){return await this.projectFileService.chapters.reorderChapters(t,e,n)}async listChapters(t,e){return await this.projectFileService.chapters.listChapters(t,e)}async createChapter(t,e,n){return await this.projectFileService.chapters.createChapter(t,e,n,this.settings)}async deleteChapter(t,e,n){return await this.projectFileService.chapters.deleteChapter(t,e,n)}async renameChapter(t,e,n,a){return await this.projectFileService.chapters.renameChapter(t,e,n,a)}async openChapter(t,e,n){return await this.projectFileService.chapters.openChapter(t,e,n)}get panelRefreshDebounceMs(){return this._panelRefreshDebounceMs}set panelRefreshDebounceMs(t){typeof t=="number"&&Number.isFinite(t)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(t)))}addActiveProjectListener(t){this.activeProjectListeners.push(t)}addActiveDraftListener(t){this.activeDraftListeners.push(t)}removeActiveDraftListener(t){this.activeDraftListeners=this.activeDraftListeners.filter(e=>e!==t)}notifyActiveDraftListeners(t){for(const e of this.activeDraftListeners)zt(()=>e(t))}addPanelRefreshListener(t){this.panelRefreshListeners.push(t)}removePanelRefreshListener(t){this.panelRefreshListeners=this.panelRefreshListeners.filter(e=>e!==t)}notifyPanelRefresh(){try{this._panelRefreshTimer&&clearTimeout(this._panelRefreshTimer),this._panelRefreshTimer=setTimeout(()=>{for(const t of this.panelRefreshListeners)zt(()=>t());this._panelRefreshTimer=null},this._panelRefreshDebounceMs)}catch{for(const t of this.panelRefreshListeners)zt(()=>t())}}removeActiveProjectListener(t){this.activeProjectListeners=this.activeProjectListeners.filter(e=>e!==t)}async setActiveProject(t){t&&(t=t.trim().replace(/^\/+/,"").replace(/\/+$/,"")),x(`${E} setActiveProject called with '${t}'`),this.activeProject=t,await Ot(async()=>{if(this.plugin){const e=this.plugin;e.settings||(e.settings={}),e.settings.activeProject=t??void 0,typeof e.saveSettings=="function"&&await e.saveSettings()}});for(const e of this.activeProjectListeners)zt(()=>e(t))}async createNewProjectPrompt(){new $a(this.app,async(t,e,n,a)=>{if(!t){new D.Notice("Project name is required.");return}const i=a&&a!==""?`${a}/${t}`:t;this.app.vault.getAbstractFileByPath(i)?new el(this.app,i,async o=>{o&&(await this.createNewProject(t,e,n,a),new Br(this.app,i,async()=>await this.openProject(i)).open())},async()=>{await this.openProject(i)}).open():(await this.createNewProject(t,e,n,a),new Br(this.app,i,async()=>await this.openProject(i)).open())}).open()}async openProject(t){return await this.projectService.openProject(t)}async createNewProject(t,e,n,a){const i=await this.projectService.createProject(t,e,n,a,this.settings);if(i){await this.setActiveProject(i);const s=n||"Draft 1";await this.setActiveDraft(s,i),zt(()=>this.notifyPanelRefresh())}return i}listAllFolders(){return this.projectService.listAllFolders()}async createNewDraftPrompt(){const t=this.listAllFolders(),e=await Oe(t,n=>this.projectService.isProjectFolder(n));new Pn(this.app,{folders:e,onSubmit:async n=>{const a=await this.suggestNextDraftName(n);new nl(this.app,{suggestedName:a,drafts:this.listDrafts(n),projectPath:n,onSubmit:async(i,s)=>{await this.createNewDraft(i,s,n),new D.Notice(`Draft "${i}" created in ${n}.`)}}).open()}}).open()}async switchDraftPrompt(){const t=this.listDrafts();if(t.length===0){new D.Notice("No drafts found in the current project.");return}new al(this.app,t,async e=>{await this.setActiveDraft(e)&&new D.Notice(`Switched to draft: ${e}`)}).open()}async updateProjectMetadataPrompt(){if(this.activeProject){await Ke(this.app,this.activeProject,void 0,void 0,this.settings),new D.Notice(`Metadata updated for ${this.activeProject}`);return}(async()=>{const t=this.listAllFolders(),e=await Oe(t,n=>this.projectService.isProjectFolder(n));new Pn(this.app,{folders:e,onSubmit:async n=>{await Ke(this.app,n,void 0,void 0,this.settings),new D.Notice(`Metadata updated for ${n}`)}}).open()})()}async selectActiveProjectPrompt(){const t=this.listAllFolders(),e=await Oe(t,n=>this.projectService.isProjectFolder(n));if(e.length===0){new D.Notice(`No ${Et} projects found in the vault.`);return}new Pn(this.app,{folders:e,onSubmit:async n=>{await this.setActiveProject(n),new D.Notice(`Active project set to ${n}`)}}).open()}async createNewDraft(t,e,n){const a=n||this.activeProject||this.getCurrentProjectPath();if(!a){new D.Notice("No project folder detected. Please open a folder named after your project.");return}if(this.listDrafts(a).includes(t)){new D.Notice(`Draft with name "${t}" already exists. Please choose a different name.`);return}if(await this.projectFileService.drafts.createDraft(t,e,a,this.settings),zt(()=>this.notifyPanelRefresh()),a&&t)try{await this.setActiveDraft(t,a,!1)}catch{}}listDrafts(t){return this.projectFileService.drafts.listDrafts(t)}async setActiveDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();return a?(this.activeDraft=t,await Ot(async()=>{await Ke(this.app,a,t,void 0,this.settings)}),this.notifyActiveDraftListeners(this.activeDraft),n&&new D.Notice(`Active draft set to ${t}`),!0):(n&&new D.Notice("No project selected to set active draft on."),!1)}async renameDraft(t,e,n,a=!1){const i=n||this.activeProject||this.getCurrentProjectPath();if(!i)return new D.Notice("No project selected to rename draft."),!1;const s=this.activeDraft===t;return await this.projectFileService.drafts.renameDraft(i,t,e,a,this.settings)?(s&&(this.activeDraft=e),new D.Notice(`Renamed draft ${t} → ${e}`),!0):(new D.Notice("Failed to rename draft."),!1)}async deleteDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();if(!a)return new D.Notice("No project selected to delete draft."),!1;if(await this.projectFileService.drafts.deleteDraft(a,t,n)){new D.Notice(`Deleted draft ${t}`);const s=this.listDrafts(a);if(s.length>0){if(this.activeDraft===t||!this.activeDraft){let o;if(s.length===1)o=s[0];else{const l=[...s].sort((c,f)=>c.localeCompare(f));if(this.activeDraft===t){const c=l.findIndex(f=>f===t);if(c!==-1){const f=c<l.length-1?c:0;o=l[f]}else o=l[0]}else o=this.activeDraft}await this.setActiveDraft(o,a,!1)}}else this.activeDraft=null,this.notifyActiveDraftListeners(null);return!0}return new D.Notice("Failed to delete draft."),!1}async suggestNextDraftName(t){return await this.projectFileService.drafts.suggestNextDraftName(t)}getCurrentProjectPath(){const t=this.app.workspace.getActiveFile();if(!t)return null;const e=t.parent;return e?e.path:null}}class sl extends D.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,x(`${E} Settings tab created`),typeof e.registerSettingsChangedCallback=="function"&&e.registerSettingsChangedCallback(()=>{x(`${E} Settings changed externally, refreshing UI`),this.containerEl&&this.containerEl.parentElement&&this.display()})}display(){const{containerEl:t}=this;t.empty(),t.createEl("h2",{text:`${Et} Settings`}),x(`${E} Displaying settings UI`);const e=this.plugin;t.createEl("h3",{text:"Templates"}),new D.Setting(t).setName("Include outline file on draft creation").setDesc("If enabled, each new draft will include an outline file using the outline template.").addToggle(o=>o.setValue(!!e.settings.includeDraftOutline).onChange(l=>{x(`${E} Include draft outline changed: ${l}`),e.settings.includeDraftOutline=l,e.saveSettings()})),new D.Setting(t).setName("Outline template").setDesc("Template for outline files. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{x(`${E} Opening file picker for outline template`),new Nn(this.app,l=>{x(`${E} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Outline template").setDesc("Template for outline documents. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{x(`${E} Opening file picker for outline template`),new Nn(this.app,l=>{x(`${E} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Chapter template").setDesc("Template for newly created chapter files. Use {{chapterTitle}}").addTextArea(o=>{o.setValue(e.settings.chapterTemplate||""),o.inputEl.setAttribute("data-setting","chapter")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{x(`${E} Opening file picker for chapter template`),new Nn(this.app,l=>{x(`${E} Chapter template selected: ${l}`),e.settings.chapterTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Manuscript name template").setDesc("Template for manuscript filenames. Use {{draftName}}, {{projectName}}, and moment.js date qualifiers like {{YYYY-MM-DD}}").addText(o=>{o.setValue(e.settings.manuscriptNameTemplate||"{{draftName}}"),o.inputEl.setAttribute("data-setting","manuscript")}),new D.Setting(t).addButton(o=>o.setButtonText("Save Templates").setCta().onClick(async()=>{var d,g;x(`${E} Save Templates button clicked`);const l=t.querySelector('textarea[data-setting="outline"]'),c=t.querySelector('textarea[data-setting="chapter"]'),f=t.querySelector('input[data-setting="manuscript"]');x(`${E} Found inputs - outline: ${!!l}, chapter: ${!!c}, manuscript: ${!!f}`),x(`${E} Manuscript input value: "${f==null?void 0:f.value}"`),l&&(e.settings.outlineTemplate=l.value),c&&(e.settings.chapterTemplate=c.value),f&&(e.settings.manuscriptNameTemplate=f.value),x(`${E} Saving templates: outline=${(d=e.settings.outlineTemplate)==null?void 0:d.substring(0,50)}..., chapter=${(g=e.settings.chapterTemplate)==null?void 0:g.substring(0,50)}..., manuscript=${e.settings.manuscriptNameTemplate}`),await e.saveSettings(),new D.Notice("Templates saved successfully!")})),t.createEl("h3",{text:"Filenames"}),new D.Setting(t).setName("Draft filename slug style").setDesc("How per-draft main filenames are generated").addDropdown(o=>{o.addOption("compact","compact (draft1)"),o.addOption("kebab","kebab (draft-1)"),o.setValue(e.settings.slugStyle||"compact"),o.onChange(l=>{x(`${E} Slug style changed: ${l}`),e.settings.slugStyle=l,e.saveSettings();const c=t.querySelector(".wat-slug-preview");c&&(c.textContent=`Example: Draft 1 → ${ae("Draft 1",l)}${bt}`)})});let n="Draft 1";new D.Setting(t).setName("Sample draft name").setDesc("Type a sample draft name to preview the generated filename").addText(o=>o.setPlaceholder("Draft 1").setValue(n).onChange(l=>{n=l||"Draft 1";const c=t.querySelector(".wat-slug-preview");if(c){const f=ae(n,e.settings.slugStyle);c.textContent=`Example: ${n} → ${f}${bt}`}}));const a=t.createDiv({cls:"wat-slug-preview"}),i=ae(n,e.settings.slugStyle);a.setText(`Example: ${n} → ${i}${bt}`),t.createEl("h3",{text:"Folders & Files"}),new D.Setting(t).setName("Drafts folder name").setDesc("Name of the folder containing draft subfolders (default: drafts)").addText(o=>o.setValue(e.settings.draftsFolderName||"drafts").onChange(l=>{x(`${E} Drafts folder name changed: ${l}`),e.settings.draftsFolderName=l||"drafts",e.saveSettings()})),new D.Setting(t).setName("Manuscripts folder name").setDesc("Name of the folder containing generated manuscripts (default: manuscripts)").addText(o=>o.setValue(e.settings.manuscriptsFolderName||"manuscripts").onChange(l=>{x(`${E} Manuscripts folder name changed: ${l}`),e.settings.manuscriptsFolderName=l||"manuscripts",e.saveSettings()})),new D.Setting(t).setName("Backups folder name").setDesc("Name of the folder containing draft backups (default: .writeaid-backups)").addText(o=>o.setValue(e.settings.backupsFolderName||".writeaid-backups").onChange(l=>{x(`${E} Backups folder name changed: ${l}`),e.settings.backupsFolderName=l||".writeaid-backups",e.saveSettings()})),new D.Setting(t).setName("Meta file name").setDesc(`Name of the project metadata file (default: ${re.META})`).addText(o=>o.setValue(e.settings.metaFileName||re.META).onChange(l=>{x(`${E} Meta file name changed: ${l}`),e.settings.metaFileName=l||re.META,e.saveSettings()})),new D.Setting(t).setName("Outline file name").setDesc(`Name of the draft outline file (default: ${re.OUTLINE})`).addText(o=>o.setValue(e.settings.outlineFileName||re.OUTLINE).onChange(l=>{x(`${E} Outline file name changed: ${l}`),e.settings.outlineFileName=l||re.OUTLINE,e.saveSettings()})),t.createEl("h3",{text:"Word Count Targets"}),new D.Setting(t).setName("Default target word count for multi-file projects").setDesc("Target word count automatically set for new multi-file projects (chapters)").addText(o=>o.setValue(String(e.settings.defaultMultiTargetWordCount??5e4)).setPlaceholder("50000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(x(`${E} Default multi-file target word count changed: ${c}`),e.settings.defaultMultiTargetWordCount=c,e.saveSettings())})),new D.Setting(t).setName(`Default target word count for ${Ht.SINGLE} projects`).setDesc(`Target word count automatically set for new ${Ht.SINGLE} projects`).addText(o=>o.setValue(String(e.settings.defaultSingleTargetWordCount??2e4)).setPlaceholder("20000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(x(`${E} Default ${Ht.SINGLE} target word count changed: ${c}`),e.settings.defaultSingleTargetWordCount=c,e.saveSettings())})),t.createEl("h3",{text:"Backup Settings"}),new D.Setting(t).setName("Maximum number of backups per draft").setDesc("Maximum number of backup files to keep per draft (default: 5)").addText(o=>o.setValue(String(e.settings.maxBackups??5)).setPlaceholder("5").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(x(`${E} Max backups changed: ${c}`),e.settings.maxBackups=c,e.saveSettings())})),new D.Setting(t).setName("Maximum backup age (days)").setDesc("Automatically delete backups older than this many days (default: 30)").addText(o=>o.setValue(String(e.settings.maxBackupAgeDays??30)).setPlaceholder("30").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(x(`${E} Max backup age changed: ${c}`),e.settings.maxBackupAgeDays=c,e.saveSettings())})),t.createEl("h3",{text:"UI & Startup"}),t.createEl("p",{text:"Most settings take effect immediately. Settings marked with ⚠️ require a plugin reload to take effect.",cls:"setting-item-description"}),new D.Setting(t).setName("Ribbon placement").setDesc(`Place the ${Et} icon on the left or right ribbon`).addDropdown(o=>{o.addOption("left","Left"),o.addOption("right","Right"),o.setValue(e.settings.ribbonPlacement||"left"),o.onChange(l=>{x(`${E} Ribbon placement changed: ${l}`),e.settings.ribbonPlacement=l,e.saveSettings(),typeof this.plugin.moveRibbon=="function"&&(l==="left"||l==="right")&&this.plugin.moveRibbon(l),this.display()})}),new D.Setting(t).setName("Always show ribbon").setDesc(`If enabled, the ${Et} ribbon icon will always be visible regardless of whether projects are detected`).addToggle(o=>o.setValue(!!e.settings.ribbonAlwaysShow).onChange(l=>{x(`${E} Always show ribbon changed: ${l}`),e.settings.ribbonAlwaysShow=l,e.saveSettings(),typeof this.plugin.refreshRibbonVisibility=="function"&&this.plugin.refreshRibbonVisibility()})),new D.Setting(t).setName("Auto-open project panel on startup").setDesc(`If enabled, the ${Et} project panel will open on plugin load when an active project is saved. ⚠️ Requires plugin reload to take effect.`).addToggle(o=>o.setValue(!!e.settings.autoOpenPanelOnStartup).onChange(l=>{x(`${E} Auto-open panel on startup changed: ${l}`),e.settings.autoOpenPanelOnStartup=l,e.saveSettings()})),new D.Setting(t).setName("Auto-select persisted project on startup").setDesc("If enabled, the persisted active project will be selected as the plugin's active project on load without opening the panel. ⚠️ Requires plugin reload to take effect.").addToggle(o=>o.setValue(!!e.settings.autoSelectProjectOnStartup).onChange(l=>{x(`${E} Auto-select project on startup changed: ${l}`),e.settings.autoSelectProjectOnStartup=l,e.saveSettings()})),new D.Setting(t).setName(`Enable ${Et} debug logs`).setDesc(`When enabled, ${Et} will set window.__${Et.toUpperCase()}__ to true to show verbose runtime logs useful during development.`).addToggle(o=>o.setValue(!!e.settings.debug).onChange(l=>{x(`${E} Debug logs setting changed: ${l}`),e.settings.debug=l,window.__WRITEAID_DEBUG__=!!l,e.saveSettings(),l?new D.Notice(`${Et}: debug logs enabled — verbose logs will appear in the DevTools console.`):new D.Notice(`${Et}: debug logs disabled.`)})),t.createEl("h3",{text:"Panel performance"}),new D.Setting(t).setName("Panel refresh debounce (ms)").setDesc("Debounce timeout (milliseconds) for side-panel refresh notifications. Lower values mean more frequent refreshes; 0 disables debouncing.").addText(o=>{const l=e.settings.panelRefreshDebounceMs,c=Number(l??Ge);o.setPlaceholder(String(Ge)),o.setValue(String(c));let f=null;const d=g=>{const u=Number(g);if(!Number.isFinite(u)||u<Se){new D.Notice(`Please enter a valid number ≥ ${Se}.`);return}const m=Math.min(Math.floor(u),Ze);x(`${E} Panel refresh debounce changed: ${m}ms`),e.settings.panelRefreshDebounceMs=m;try{const p=e.saveSettings();p&&typeof p.catch=="function"&&p.catch(()=>{})}catch{}this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=m),o.inputEl.value=String(m),f&&(f.value=String(m))};try{const g=o.inputEl;g.setAttribute("type","number"),g.setAttribute("min",String(Se)),g.setAttribute("max",String(Ze)),g.setAttribute("step","50"),g.setAttribute("aria-label","Panel refresh debounce in milliseconds"),zt(()=>{g.insertAdjacentHTML("afterend",'<span class="wa-unit">ms</span>')}),f=document.createElement("input"),f.type="range",f.min=String(Se),f.max=String(Ze),f.step="50",f.value=String(c),f.className="wa-debounce-range",zt(()=>{const u=g.nextSibling;u&&u.parentElement?u.insertAdjacentElement("afterend",f):g.insertAdjacentElement("afterend",f)}),o.onChange(u=>{const m=Number(u);d(m)}),f.addEventListener("input",u=>{const m=Number(u.target.value);o.inputEl.value=String(m),d(m)})}catch{o.onChange(g=>{const u=Number(g);if(!Number.isFinite(u)||u<Se){new D.Notice(`Please enter a valid number ≥ ${Se}.`);return}const m=Math.min(Math.floor(u),Ze);e.settings.panelRefreshDebounceMs=m,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=m)})}}).addButton(o=>o.setButtonText("Reset").setTooltip(`Reset to default (${Ge} ms)`).onClick(()=>{const l=Ge;e.settings.panelRefreshDebounceMs=l,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=l),this.display()}))}}class Nn extends D.Modal{constructor(t,e){super(t),this.currentFolder=null,this.expanded={},this.onPick=e,x(`${E} FilePickerModal created`)}onOpen(){x(`${E} FilePickerModal opened`);const t=this.app.vault.getRoot();this.currentFolder=t,this.expanded={},this.render()}render(){const{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Select template file"}),!this.currentFolder)return;const e=this.currentFolder.path?this.currentFolder.path.split("/"):[],n=t.createDiv({cls:"wat-breadcrumbs"}),a=n.createEl("a",{text:"(Vault root)",href:"#"});a.onclick=c=>{c.preventDefault(),this.currentFolder=this.app.vault.getRoot(),this.render()};let i="";for(const c of e){i=i?`${i}/${c}`:c,n.createDiv({text:" / "});const f=n.createEl("a",{text:c,href:"#"}),d=i;f.onclick=g=>{g.preventDefault();const u=this.app.vault.getAbstractFileByPath(d);u&&u instanceof D.TFolder&&(this.currentFolder=u,this.render())}}const o=t.createDiv({cls:"wat-controls"}).createEl("button",{text:"Up"});o.onclick=c=>{var g;if(c.preventDefault(),!this.currentFolder)return;const f=((g=this.currentFolder.parent)==null?void 0:g.path)||"",d=f?this.app.vault.getAbstractFileByPath(f):this.app.vault.getRoot();d&&d instanceof D.TFolder&&(this.currentFolder=d,this.render())};const l=t.createDiv({cls:"wat-list"});for(const c of this.currentFolder.children)if(c instanceof D.TFolder){const f=l.createDiv({cls:"wat-row folder-row"}),d=f.createEl("button",{text:this.expanded[c.path]?"▾":"▸"});d.onclick=u=>{u.preventDefault(),this.expanded[c.path]=!this.expanded[c.path],this.render()};const g=f.createEl("a",{text:c.name,href:"#"});if(g.onclick=u=>{u.preventDefault(),this.currentFolder=c,this.render()},this.expanded[c.path]){const u=l.createDiv({cls:"wat-sub"});for(const m of c.children)if(m instanceof D.TFolder){const v=u.createDiv({cls:"wat-row sub-folder"}).createEl("a",{text:m.name,href:"#"});v.onclick=h=>{h.preventDefault(),this.currentFolder=m,this.render()}}else if(m instanceof D.TFile&&m.path.toLowerCase().endsWith(bt)){const v=u.createDiv({cls:"wat-row sub-file"}).createEl("a",{text:m.name,href:"#"});v.onclick=h=>{h.preventDefault(),x(`${E} File selected from file picker: ${m.path}`),this.close(),this.onPick(m.path)}}}}else if(c instanceof D.TFile&&c.path.toLowerCase().endsWith(bt)){const d=l.createDiv({cls:"wat-row file-row"}).createEl("a",{text:c.name,href:"#"});d.onclick=g=>{g.preventDefault(),x(`${E} File selected from file picker: ${c.path}`),this.close(),this.onPick(c.path)}}}onClose(){this.contentEl.empty()}}const ol=":root{--wa-bg: var(--background-primary, #ffffff);--wa-surface: var(--background-modifier-hover, #f7f7fb);--wa-muted: var(--text-muted, #6b7280);--wa-text: var(--text-normal, #0f172a);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(15, 23, 42, .08);--wa-radius: 8px;--wa-gap: 8px;--select-bg: var(--background-primary, #fff);--select-border: var(--background-modifier-border, #ccc);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #222);--select-placeholder: var(--text-muted, #888);--select-dropdown-bg: var(--background-secondary, #f6f6f6);--select-dropdown-border: var(--background-modifier-border, #e0e0e0);--select-option-hover: #f0f0ff;--select-option-active: #eaeaff;--select-chevron: var(--text-muted, #888)}@media (prefers-color-scheme: dark){:root{--wa-bg: var(--background-primary, #0b0b0c);--wa-surface: var(--background-modifier-hover, #121212);--wa-muted: var(--text-muted, #9aa4b2);--wa-text: var(--text-normal, #e6eef8);--wa-accent: var(--interactive-accent, #8b5cf6);--wa-border: rgba(255, 255, 255, .06)}}.theme-dark{--wa-bg: var(--background-primary, #23232b);--wa-surface: var(--background-modifier-hover, #2a2a4a);--wa-muted: var(--text-muted, #aaa);--wa-text: var(--text-normal, #e0e0e0);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(255, 255, 255, .06);--select-bg: var(--background-primary, #23232b);--select-border: var(--background-modifier-border, #333);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #e0e0e0);--select-placeholder: var(--text-muted, #aaa);--select-dropdown-bg: var(--background-secondary, #23233a);--select-dropdown-border: var(--background-modifier-border, #333);--select-option-hover: #2a2a4a;--select-option-active: #2a2a4a;--select-chevron: var(--text-muted, #aaa)}.theme-dark .wa-panel{background:var(--background-primary, #23232b);color:var(--text-normal, #e0e0e0);border:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-title{color:var(--text-title, var(--text-normal, #e0e0e0))}.theme-dark .wa-muted{color:var(--text-faint, var(--text-muted, #aaa))}.theme-dark .wa-draft-list{background:var(--background-secondary, #23233a)}.theme-dark .wa-draft-item{color:var(--text-normal, #e0e0e0);border-bottom:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-draft-item.active{background:var(--background-modifier-active, #2a2a4a)}.theme-dark .wa-draft-name{color:var(--text-normal, #e0e0e0)}",ll="button:hover{cursor:pointer}.writeaid-ribbon{padding-left:6px}.writeaid-ribbon .wa-icon{display:inline-block;vertical-align:middle}.writeaid-ribbon .wa-icon svg{width:16px;height:16px;fill:currentColor;display:block}.view-content:has(.writeaid-project-panel){padding:0}.writeaid-project-panel{height:100%;display:flex;flex-direction:column}.create-inline{margin-top:8px;justify-content:center}.wa-panel.project-list{padding:1em;height:100%;border-radius:0}.wa-panel-header{display:flex;flex-direction:column}.wa-draft-item.active .wa-draft-name{font-weight:700;color:var(--color-accent, #3b82f6)}.wa-draft-active-indicator{color:var(--color-accent, #3b82f6);font-size:1em;vertical-align:middle}@keyframes spin{to{transform:rotate(360deg)}}:root{--wa-slider-track-height: 6px;--wa-slider-thumb-size: 12px;--wa-slider-accent: var(--interactive-accent, #7c5cff);--wa-slider-background: var(--background-modifier-host, #eee);--wa-slider-gap: 12px}.wa-debounce-range{margin-left:var(--wa-slider-gap);vertical-align:middle;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:var(--wa-slider-track-height);background:linear-gradient(90deg,var(--wa-slider-accent) 0%,var(--wa-slider-accent) 50%,var(--wa-slider-background) 50%,var(--wa-slider-background) 100%);border-radius:999px;outline:none}.wa-debounce-range::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);box-shadow:0 0 0 4px #0000000d;cursor:pointer}.wa-debounce-range::-moz-range-thumb{width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);cursor:pointer}.wa-unit{color:var(--text-muted, #666);margin-left:6px}.justify-between{justify-content:space-between}.wa-rename-info{margin-bottom:8px;color:var(--text-muted, #888);font-size:.95em}.wa-rename-label{display:block;font-weight:500;margin-bottom:4px;color:var(--text-normal, #222)}.wa-rename-input{width:100%;padding:7px 10px;font-size:1em;border:1px solid var(--background-modifier-border, #ccc);border-radius:5px;margin-bottom:10px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s}.wa-rename-input:focus{border-color:var(--interactive-accent, #7c5cff);outline:none}.wa-rename-checkbox-label{display:flex;align-items:center;gap:6px;margin-bottom:10px;font-size:.97em;color:var(--text-muted, #666)}.wa-rename-btn-row{display:flex;gap:10px;margin-top:8px;justify-content:flex-end}.wa-rename-btn-row button{min-width:80px;padding:6px 14px;font-size:1em;border-radius:4px;border:none;cursor:pointer;transition:background .2s}.wa-rename-btn-row .mod-cta{background:var(--interactive-accent, #7c5cff);color:#fff;font-weight:600}.wa-rename-btn-row .mod-cta:hover{background:#5a3fd6}.wa-rename-btn-row .mod-cancel{background:var(--background-modifier-border, #eee);color:var(--text-muted, #666)}.wa-rename-btn-row .mod-cancel:hover{background:#e0e0e0}.wa-rename-error{min-height:18px;margin-bottom:4px;font-size:.97em;color:var(--color-red, #d43c3c);transition:opacity .2s}.wa-create-draft-input{width:100%;padding:8px 12px;font-size:1.05em;border:1.5px solid var(--background-modifier-border, #bbb);border-radius:6px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s,box-shadow .2s;outline:none;box-shadow:0 1px 2px #3c3c3c0a}.wa-create-draft-input:focus{border-color:var(--interactive-accent, #7c5cff);box-shadow:0 2px 8px #7c5cff14;background:var(--background-secondary, #fafaff)}.wa-panel{background:var(--background-primary, #fff);color:var(--text-normal, #222);padding:1em}.wa-title{font-size:1.2em;font-weight:600;color:var(--text-title, var(--text-normal, #222))}.wa-muted{color:var(--text-faint, var(--text-muted, #888))}.wa-row{display:flex;gap:8px;align-items:center;width:100%}.wa-button-group{display:flex;gap:8px}.wa-draft-list{background:var(--background-secondary, #f6f6f6);border-radius:6px;padding:8px 0;margin-top:8px}.wa-draft-item{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-bottom:1px solid var(--background-modifier-border, #e0e0e0);background:transparent;color:var(--text-normal, #222);transition:background .15s}.wa-draft-item:last-child{border-bottom:none}.wa-draft-item.active{background:var(--background-modifier-active, #eaeaff)}.wa-draft-name{font-size:1em;font-weight:500;color:var(--text-normal, #222)}.wa-draft-actions{display:flex;gap:6px}.wa-select-container.wa-select{position:relative;width:100%;display:flex;flex-direction:column;gap:4px}.wa-select-label-text{font-size:.9em;font-weight:500;color:var(--select-text, var(--text-normal, #222))}.wa-select-trigger{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:6px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));cursor:pointer;transition:all .2s ease;min-height:38px;font-size:1em}.wa-select-trigger:hover:not(.disabled){border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.open{border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.disabled{opacity:.6;cursor:not-allowed;background:var(--disabled-background, #f3f3f3)}.wa-select-value{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.wa-select-label,.wa-select-placeholder{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wa-select-placeholder{color:var(--select-placeholder, var(--text-muted, #888))}.wa-select-controls{display:flex;align-items:center;gap:4px;flex-shrink:0;margin-left:8px}.wa-select-clear{display:flex;align-items:center;justify-content:center;width:20px;height:20px;padding:0;border:none;background:none;color:var(--select-chevron, var(--text-muted, #888));cursor:pointer;border-radius:3px;transition:background .2s;font-size:.8em}.wa-select-clear:hover{background:var(--background-modifier-hover, #f0f0f0)}.wa-select-chevron{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:var(--select-chevron, var(--text-muted, #888));font-size:.7em;transition:transform .3s cubic-bezier(.4,0,.2,1)}.wa-select-chevron.rotated{transform:rotate(180deg)}.wa-select-dropdown{position:absolute;z-index:1000;background:var(--select-dropdown-bg, var(--background-secondary, #f6f6f6));border:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0));border-radius:8px;box-shadow:0 4px 12px #00000026,0 2px 4px #0000001a;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .15s ease-out}@keyframes slideIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.wa-select-dropdown[data-placement*=top]{animation:slideInTop .15s ease-out}@keyframes slideInTop{0%{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}.wa-select-search{padding:8px;border-bottom:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0))}.wa-select-search-input{width:100%;padding:6px 8px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:4px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));font-size:.95em}.wa-select-search-input:focus{outline:none;border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-list{flex:1;overflow-y:auto;max-height:300px}.wa-select-list::-webkit-scrollbar{width:6px}.wa-select-list::-webkit-scrollbar-track{background:transparent}.wa-select-list::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb-bg, rgba(0, 0, 0, .2));border-radius:3px}.wa-select-list::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover-bg, rgba(0, 0, 0, .3))}.wa-select-empty{padding:12px 10px;text-align:center;color:var(--select-placeholder, var(--text-muted, #888));font-size:.95em}.wa-select-option{width:100%;margin-top:2px;padding:8px 10px;border-radius:0;box-shadow:none!important;border:none;background:transparent;color:var(--select-text, var(--text-normal, #222));text-align:left;cursor:pointer;transition:background .15s;font-size:.95em}.wa-select-option:hover{background:var(--select-option-hover, #f0f0ff);box-shadow:none!important}.wa-select-option.selected{background:var(--select-option-active, #eaeaff);box-shadow:none!important}.wa-select-option.active{background:var(--select-option-active, #eaeaff);font-weight:500;box-shadow:none!important}";if(typeof globalThis<"u"){const r=globalThis;r.__BROWSER__||(r.__BROWSER__=!0)}function Rr(r,t=20){return r.length<=t?r:r.substring(0,t-3)+"..."}const Ca={outlineTemplate:`# {{draftName}} Outline

## Overview
Brief description of the story goes here.

## Characters
- Character 1: Description
- Character 2: Description

## Plot Points
- Opening: 
- Middle: 
- Climax: 
- Resolution: 

## Chapters
- Chapter 1: Title
- Chapter 2: Title
- Chapter 3: Title`,chapterTemplate:`# {{chapterName}}

## Summary
Chapter summary goes here.

## Scene 1
Scene content goes here.

## Scene 2
Scene content goes here.`,manuscriptNameTemplate:"{{draftName}}",slugStyle:"compact",ribbonPlacement:"left",ribbonAlwaysShow:!1,autoOpenPanelOnStartup:!0,autoSelectProjectOnStartup:!0,activeProject:void 0,panelRefreshDebounceMs:250,debug:!1,includeDraftOutline:!1,draftsFolderName:Ee.DRAFTS,manuscriptsFolderName:Ee.MANUSCRIPTS,backupsFolderName:Ee.BACKUPS,metaFileName:re.META,outlineFileName:re.OUTLINE,maxBackups:5,maxBackupAgeDays:30};function zr(r){return Object.assign({},Ca,r??{})}class cl extends D.Plugin{constructor(){super(...arguments),this.settings=Ca,this.settingsChangedCallbacks=[]}async loadSettings(){const t=await this.loadData();this.settings=zr(t),t&&t.activeProject!==void 0&&(this.settings.activeProject=t.activeProject),this.manager&&(this.manager.settings=this.settings),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){x(`${E} Error in settings changed callback:`,n)}})}async saveSettings(){await Ot(async()=>{const e=zr(this.settings);await this.saveData(e),this.settings=e})===void 0&&await this.saveData(this.settings),this.manager&&(this.manager.settings=this.settings,x(`${E} Updated manager settings reference, manuscript template: ${this.settings.manuscriptNameTemplate}`)),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){x(`${E} Error in settings changed callback:`,n)}})}registerSettingsChangedCallback(t){this.settingsChangedCallbacks.push(t)}async runBackupCleanup(){if(this.manager)try{const e=await new un(this.app).listProjects();for(const n of e){const a=At(this.settings),i=`${n}/${a}`,s=this.app.vault.getAbstractFileByPath(i);if(!(!s||!(s instanceof D.TFolder))){for(const o of s.children)if(o instanceof D.TFolder){const l=`${i}/${o.name}`,c=await this.manager.projectFileService.drafts.getDraftId(l);c&&await this.manager.projectFileService.backups.clearOldBackups(l,c,this.manager.settings)}}}x(`${E} Backup cleanup completed on startup`)}catch(t){x(`${E} Error during backup cleanup:`,t)}}async onload(){await this.loadSettings(),this.manager=new il(this.app,this,typeof this.settings.panelRefreshDebounceMs=="number"?this.settings.panelRefreshDebounceMs:void 0),x(`${E} Manager created:`,!!this.manager);const t=new un(this.app);this.app.workspace.onLayoutReady(async()=>{const a=await t.listProjects();let i=null;if(a.length===1)i=a[0];else if(a.length>1){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");x(`${E} lastActiveRaw='${s}', normalized='${o}', includes=${o&&a.includes(o)}`),o&&a.includes(o)?i=o:i=a[0]}else if(a.length===0){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");await t.isProjectFolder(s||"")&&(x(`${E} activating saved project '${o}' as it exists and has valid meta file`),i=o??null)}if(x(`${E} toActivate='${i}'`),i){await this.manager.setActiveProject(i),this.settings.activeProject=i;const s=await De(this.app,`${i}/${ie(this.settings)}`);if(s!=null&&s.current_active_draft&&this.manager.listDrafts(i).includes(s.current_active_draft)&&(x(`${E} auto-restoring draft '${s.current_active_draft}' for project '${i}'`),await this.manager.setActiveDraft(s.current_active_draft,i,!1)),await this.saveSettings(),this.settings.autoOpenPanelOnStartup){const o=this.app.workspace.getLeavesOfType(ge);if(o.length>0)this.app.workspace.revealLeaf(o[0]);else{let l=null;this.settings.ribbonPlacement==="right"?l=this.app.workspace.getRightLeaf(!0):l=this.app.workspace.getLeftLeaf(!0);const c={type:ge,active:!0};l.setViewState(c),this.app.workspace.revealLeaf(l)}}}else await this.manager.setActiveProject(null),this.settings.activeProject=void 0,await this.saveSettings()}),this.statusBarEl=this.addStatusBarItem(),this.statusBarEl.setText(`${Et}: No active project`),this.runBackupCleanup().catch(a=>{x(`${E} Failed to run backup cleanup on startup:`,a)}),zt(()=>{this.waStyleEl||(this.waStyleEl=document.createElement("style"),this.waStyleEl.setAttribute("data-writeaid-style",""),this.waStyleEl.textContent=ol+ll,this.waStyleEl.classList.add("writeaid-plugin-style"),document.head.appendChild(this.waStyleEl))}),await this.loadSettings(),zt(()=>{window.__WRITEAID_DEBUG__=!!this.settings.debug}),x(`${E} Loading ${Et} Novel Multi-Draft Plugin`),this.manager.addActiveProjectListener(a=>{this.statusBarEl&&(a?(this.statusBarEl.setText(`${Et}: ${Rr(a)}`),x(`${E} active project updated -> ${a}`)):this.statusBarEl.setText(`${Et}: No active project`))}),this.manager.activeProject&&this.statusBarEl.setText(`${Et}: ${Rr(this.manager.activeProject)}`),x(`${E} Registering ProjectPanelView with manager:`,!!this.manager),this.registerView(ge,a=>(x(`${E} Creating ProjectPanelView instance with manager:`,!!this.manager),new Io(a,this.app,this.manager)));const e=this.addRibbonIcon(Ln,`${Et} Projects`,()=>{});e.classList.add("writeaid-ribbon"),this.ribbonEl=e,e.setAttr("aria-label",`${Et} Projects`),e.onclick=()=>{const a=this.app.workspace.getLeavesOfType(ge);if(a.length>0){const i=a[0];this.app.workspace.revealLeaf(i)}else{let i=this.app.workspace.getLeftLeaf(!1);i||(i=this.app.workspace.getLeftLeaf(!0));const s={type:ge,active:!0};i.setViewState(s),this.app.workspace.revealLeaf(i)}};const n=async()=>{await Ot(async()=>{if(this.settings.ribbonAlwaysShow){e.style.display="";return}const i=t.listAllFolders();(await Oe(i,o=>t.isProjectFolder(o))).length>0?e.style.display="":e.style.display="none"})===void 0&&(e.style.display="")};this.refreshRibbonVisibility=n,n().catch(()=>{}),this.settings.ribbonPlacement==="right"&&this.moveRibbon("right"),this.registerEvent(this.app.vault.on("create",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("delete",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("modify",()=>{n().catch(()=>{})})),this.addCommand({id:"create-new-draft",name:"Create New Draft",callback:Mo(this.manager)}),this.addCommand({id:"create-outline",name:"Create Outline",callback:()=>Uo(this.manager)}),this.addCommand({id:"create-new-project",name:"Create New Project",callback:Xo(this.manager)}),this.addCommand({id:"switch-draft",name:"Switch Active Draft",callback:Zo(this.manager)}),this.addCommand({id:"update-project-metadata",name:"Update Project Metadata",callback:tl(this.manager)}),this.addCommand({id:"select-active-project",name:"Select Active Project",callback:Jo(this.manager)}),this.addCommand({id:"generate-manuscript",name:"Generate Manuscript",callback:Wo(this.manager)}),this.addCommand({id:"toggle-project-panel",name:`Toggle ${Et} Project Panel`,callback:Qo(this.manager,this.app)}),this.addCommand({id:"convert-single-to-multi-file-project",name:"Convert Single-File Project to Multi-File",callback:()=>{var a,i;return qo(this.app,this.manager.activeProject||((i=(a=this.manager).getCurrentProjectPath)==null?void 0:i.call(a))||void 0,this.manager.settings)}}),this.addCommand({id:"navigate-to-next-chapter",name:"Navigate to Next Chapter",callback:Go(this.manager)}),this.addCommand({id:"navigate-to-previous-chapter",name:"Navigate to Previous Chapter",callback:Yo(this.manager)}),this.addCommand({id:"create-backup",name:"Create Backup",callback:Aa(this.manager)}),this.addCommand({id:"list-and-restore-backups",name:"List and Restore Backups",callback:Lo(this.manager)}),this.addCommand({id:"delete-backup",name:"Delete Oldest Backup",callback:Ta(this.manager)}),this.addCommand({id:"clear-old-backups",name:"Clear Old Backups",callback:ja(this.manager)}),this.addCommand({id:"initialize-draft-file",name:"Initialize Draft File Metadata",callback:Vo(this.manager)}),this.addSettingTab(new sl(this.app,this))}moveRibbon(t){zt(()=>{if(!this.ribbonEl)return;const e=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-right"),n=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-left");t==="right"&&e?e.appendChild(this.ribbonEl):t==="left"&&n&&n.appendChild(this.ribbonEl)})}onunload(){this.statusBarEl&&this.statusBarEl.parentElement&&this.statusBarEl.parentElement.removeChild(this.statusBarEl),x(`${E} Unloading ${Et} Novel Multi-Draft Plugin`),this.waStyleEl&&this.waStyleEl.parentElement&&this.waStyleEl.parentElement.removeChild(this.waStyleEl)}}module.exports=cl;
//# sourceMappingURL=main.js.map
