"use strict";var ja=Object.defineProperty;var Na=(r,t,e)=>t in r?ja(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Dn=(r,t,e)=>Na(r,typeof t!="symbol"?t+"":t,e);const D=require("obsidian"),pn={ACTIVE_PROJECT_NOT_FOUND:"No active project found.",ACTIVE_DRAFT_NOT_FOUND:"No active draft found.",BACKUPS_NOT_FOUND_PROJECT:"No backups found for the current project.",BACKUPS_NOT_FOUND_DRAFT:"No backups found for the current draft."},Oe={DRAFTS:"drafts",MANUSCRIPTS:"manuscripts",BACKUPS:".writeaid-backups"},ue={META:"meta.md",OUTLINE:"outline.md"},Rn={COMPACT:"compact",KEBAB:"kebab"},Rt={SINGLE:"single-file",MULTI:"multi-file"},Aa=Object.values(Rt),Et="WriteAid",S=`${Et} debug:`,Gn="pen-tool",Zr="1.0.0",mt=".md",Te=0,tn=5e3,en=250,Le=".zip",Gr=/^(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})\.zip$/,Ft="---",zt=new RegExp(`^${Ft}
([\\s\\S]*?)
${Ft}`),In=1024,Yr=["B","KB","MB","GB"];function Bt(r){return(r==null?void 0:r.draftsFolderName)||Oe.DRAFTS}function Yn(r){return(r==null?void 0:r.manuscriptsFolderName)||Oe.MANUSCRIPTS}function Ue(r){return(r==null?void 0:r.backupsFolderName)||Oe.BACKUPS}function Gt(r){return(r==null?void 0:r.metaFileName)||ue.META}function We(r){return(r==null?void 0:r.outlineFileName)||ue.OUTLINE}function Xt(r,t=Rn.COMPACT){if(!r)return"";const e=r.trim();return t===Rn.KEBAB?e.replace(/\s+/g,"-").toLowerCase():e.replace(/\s+/g,"").toLowerCase()}async function Se(r,t){const e=await Promise.all(r.map(n=>Promise.resolve(t(n))));return r.filter((n,a)=>e[a])}function Mt(r,...t){try{return r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}async function Ut(r,...t){try{return await r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}function Re(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const r=Date.now().toString(36),t=Math.random().toString(36).substring(2,15);return`${r}-${t}`}function F(...r){Mt(()=>{window.__WRITEAID_DEBUG__&&(console.debug||console.log).apply(console,r)})}function Xe(r,t){return r?t?!0:(new D.Notice(pn.ACTIVE_DRAFT_NOT_FOUND),!1):(new D.Notice(pn.ACTIVE_PROJECT_NOT_FOUND),!1)}function zn(r){return r?r.trim().split(/\s+/).filter(e=>e.length>0).length:0}const Ta=Object.freeze(Object.defineProperty({__proto__:null,APP_NAME:Et,BACKUP_FILE_EXTENSION:Le,BACKUP_TIMESTAMP_REGEX:Gr,BYTES_PER_KILOBYTE:In,DEBUG_PREFIX:S,FILES:ue,FILE_SIZE_UNITS:Yr,FOLDERS:Oe,FRONTMATTER_DELIMITER:Ft,FRONTMATTER_REGEX:zt,MARKDOWN_FILE_EXTENSION:mt,PANEL_DEBOUNCE_DEFAULT:en,PANEL_DEBOUNCE_MAX:tn,PANEL_DEBOUNCE_MIN:Te,PROJECT_TYPE:Rt,SLUG_STYLE:Rn,VALID_PROJECT_TYPES:Aa,WRITEAID_VERSION:Zr,WRITE_AID_ICON_NAME:Gn,asyncFilter:Se,checkActive:Xe,countWords:zn,debug:F,generateDraftId:Re,getBackupsFolderName:Ue,getDraftsFolderName:Bt,getManuscriptsFolderName:Yn,getMetaFileName:Gt,getOutlineFileName:We,slugifyDraftName:Xt,suppress:Mt,suppressAsync:Ut},Symbol.toStringTag,{value:"Module"}));function Ba(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Clear old backups command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Xe(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=Bt(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const c of a.children)if(c instanceof D.TFolder&&c.name.toLowerCase()===n.toLowerCase()){i=c.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID.");return}const l=r.projectFileService.backups.maxBackupAgeDays;await r.projectFileService.backups.clearOldBackups(s,o,r.settings),new D.Notice(`Old backups cleared (older than ${l} days).`)}}class Oa extends D.Modal{constructor(t,e,n){super(t),this.result=!1,this.resolvePromise=null,this.draftName=e,this.backupsToDelete=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Confirm Backup Creation"}),t.createEl("p",{text:`Creating a new backup for draft "${this.draftName}" will exceed the maximum number of backups allowed. The following will happen:`}),t.createEl("ul").createEl("li",{text:`${this.backupsToDelete} oldest backup(s) will be deleted to make room for the new one.`}),t.createEl("p",{text:"Do you want to continue?"}),new D.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.result=!1,this.close()})).addButton(e=>e.setButtonText("Continue").setCta().onClick(()=>{this.result=!0,this.close()}))}onClose(){this.resolvePromise&&this.resolvePromise(this.result)}showModal(){return new Promise(t=>{this.resolvePromise=t,this.open()})}}function Ra(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Create backup command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Xe(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=Bt(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const u of a.children)if(u instanceof D.TFolder&&u.name.toLowerCase()===n.toLowerCase()){i=u.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID for backup.");return}const l=await r.projectFileService.backups.willExceedMaxBackups(s,o,r.settings);if(l>0&&!await new Oa(r.app,e,l).showModal()){F(`${S} User cancelled backup creation due to cleanup`),new D.Notice("Backup creation cancelled.");return}if(await r.projectFileService.backups.createBackup(s,o,r.settings)){if(F(`${S} Backup created successfully, backupsToDelete=${l}`),l>0){F(`${S} Starting cleanup of ${l} excess backups for ${o}`);const u=await r.projectFileService.backups.cleanupExcessBackups(s,o,r.settings);F(`${S} Cleanup complete, deleted ${u} backups`)}new D.Notice("Backup created successfully.")}else F(`${S} Backup creation failed`),new D.Notice("Failed to create backup.")}}function Ia(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Delete backup command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Xe(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=Bt(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const m of a.children)if(m instanceof D.TFolder&&m.name.toLowerCase()===n.toLowerCase()){i=m.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID.");return}const l=await r.projectFileService.backups.listBackups(s,o,r.settings);if(l.length===0){new D.Notice(pn.BACKUPS_NOT_FOUND_DRAFT);return}const c=l[l.length-1];await r.projectFileService.backups.deleteBackup(s,o,c,r.settings)?new D.Notice(`Backup deleted successfully: ${c}.`):new D.Notice("Failed to delete backup.")}}class Ln extends D.Modal{constructor(t,e,n=!1){super(t),this.path=e,this.isDraft=n,this.setTitle("Confirm Overwrite")}onOpen(){const{contentEl:t}=this,e=this.isDraft?"draft folder":"manuscript file";t.createEl("p",{text:`The ${e} "${this.path}" already exists. Do you want to overwrite it?`});const n=t.createDiv({cls:"modal-button-container"});new D.ButtonComponent(n).setButtonText("Cancel").onClick(()=>{F(`${S} ConfirmOverwriteModal: cancelled overwrite for ${this.isDraft?"draft":"manuscript"} "${this.path}"`),this.resolve(!1),this.close()}),new D.ButtonComponent(n).setButtonText("Overwrite").setCta().onClick(()=>{F(`${S} ConfirmOverwriteModal: confirmed overwrite for ${this.isDraft?"draft":"manuscript"} "${this.path}"`),this.resolve(!0),this.close()})}onClose(){const{contentEl:t}=this;t.empty()}open(){return new Promise(t=>{this.resolve=t,super.open()})}}class za extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Restored Draft"}),t.createEl("div",{text:`The original draft '${this.oldName}' no longer exists. Please provide a new name for the restored draft.`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Restore",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameRestoredDraftModal: restoring draft as "${t}"`),this.onSubmit(t),this.close()}onClose(){this.contentEl.empty()}}class La extends D.SuggestModal{constructor(t,e,n){super(t),this.manager=e,this.backups=[],this.draftFolder="",this.draftName="",this.onRestoreComplete=n,this.setPlaceholder("Select a backup to restore..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to restore"},{command:"esc",purpose:"to cancel"}])}async onOpen(){const t=this.manager.activeProject;if(F(`${S} RestoreBackupModal opened for project: ${t}`),!t){new D.Notice("No active project found."),this.close();return}const e=Bt(this.manager.settings);if(this.draftFolder=`${t}/${e}`,this.draftName=t,this.backups=await this.getBackupDetails(),F(`${S} Found ${this.backups.length} backups for project: ${t}`),this.backups.length===0){new D.Notice(pn.BACKUPS_NOT_FOUND_PROJECT),this.close();return}this.setTitle(`Restore Backup for Project "${t}"`),super.onOpen()}async getBackupDetails(){const t=this.draftFolder.split("/")[0]||"unknown",e=`${Ue(this.manager.settings)}/${t}`;try{const n=[],a=Bt(this.manager.settings);let i=a;try{const l=await this.app.vault.adapter.list(e);for(const c of l.folders){const u=c.split("/").pop()||c;if(u.toLowerCase()===a.toLowerCase()){i=u;break}}}catch{F(`${S} Could not read backup project directory: ${e}`)}const s=`${e}/${i}`;F(`${S} Looking for backups in: ${s}`);const o=await this.app.vault.adapter.list(s);for(const l of o.folders){const c=l.split("/").pop()||l;let u=c;const m=`${t}/${a}`,g=this.manager.projectFileService.drafts.listDrafts(t);for(const v of g){const y=`${m}/${v}`;if(await this.manager.projectFileService.drafts.getDraftId(y)===c){u=v;break}}const f=`${s}/${c}`,p=await this.app.vault.adapter.list(f),d=this.app.vault.getAbstractFileByPath(t);let b=a;if(d&&d instanceof D.TFolder){for(const v of d.children)if(v instanceof D.TFolder&&v.name.toLowerCase()===a.toLowerCase()){b=v.name;break}}const h=`${t}/${b}/${u}`;for(const v of p.files){const y=v.split("/").pop()||v,k=new RegExp("^(\\d{4}-\\d{2}-\\d{2}T\\d{2}-\\d{2}-\\d{2})\\.zip$"),$=y.match(k);if($){const P=await this.app.vault.adapter.stat(v),j=(P==null?void 0:P.size)||0,I=$[1],N=I.replace(/T(\d{2})-(\d{2})-(\d{2})/,"T$1:$2:$3"),Q=new Date(N).toLocaleString(),E=this.formatFileSize(j);n.push({timestamp:I,size:j,displayText:`${u}: ${Q} (${E})`,draftName:u,draftFolder:h,draftId:c})}}}return n.sort((l,c)=>c.timestamp.localeCompare(l.timestamp))}catch{return F(`${S} Backup directory does not exist yet for project '${e}' (this is normal for new projects)`),[]}}formatFileSize(t){if(t===0)return"0 B";const e=Math.floor(Math.log(t)/Math.log(In));return parseFloat((t/Math.pow(In,e)).toFixed(1))+" "+Yr[e]}getSuggestions(t){return this.backups.filter(e=>e.displayText.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.createEl("div",{text:t.displayText})}async onChooseSuggestion(t,e){const n=this.manager.activeDraft;F(`${S} Restoring backup: ${t.draftName} (${t.timestamp}), current active draft: ${n}`);const a=this.app.vault.getAbstractFileByPath(t.draftFolder);let i=t.draftFolder,s=t.draftName;if(a&&a instanceof D.TFolder){if(!await new Ln(this.app,t.draftFolder,!0).open()){F(`${S} Backup restore cancelled by user`);return}}else{const l=new za(this.app,t.draftName,u=>{s=u});if(await new Promise(u=>{const m=l.onClose;l.onClose=()=>{m&&m.call(l),u()},l.open()}),s===t.draftName&&!a){F(`${S} Backup restore cancelled by user (rename modal)`);return}i=`${t.draftFolder.split("/").slice(0,-1).join("/")}/${s}`}await this.manager.projectFileService.backups.restoreBackup(i,t.draftId,t.timestamp,this.manager.settings)?(new D.Notice(`Backup restored successfully for "${s}" from ${t.displayText.split(": ")[1].split(" (")[0]}.`),F(`${S} Backup restore successful for: ${s}, active draft preserved: ${n} -> ${this.manager.activeDraft}`),this.onRestoreComplete&&this.onRestoreComplete()):(new D.Notice("Failed to restore backup."),F(`${S} Backup restore failed for: ${s}`))}}function Ma(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function fn(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(r,t){(function(e){r.exports=e()})(function(){return function e(n,a,i){function s(c,u){if(!a[c]){if(!n[c]){var m=typeof fn=="function"&&fn;if(!u&&m)return m(c,!0);if(o)return o(c,!0);var g=new Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g}var f=a[c]={exports:{}};n[c][0].call(f.exports,function(p){var d=n[c][1][p];return s(d||p)},f,f.exports,e,n,a,i)}return a[c].exports}for(var o=typeof fn=="function"&&fn,l=0;l<i.length;l++)s(i[l]);return s}({1:[function(e,n,a){var i=e("./utils"),s=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var c,u,m,g,f,p,d,b=[],h=0,v=l.length,y=v,k=i.getTypeOf(l)!=="string";h<l.length;)y=v-h,m=k?(c=l[h++],u=h<v?l[h++]:0,h<v?l[h++]:0):(c=l.charCodeAt(h++),u=h<v?l.charCodeAt(h++):0,h<v?l.charCodeAt(h++):0),g=c>>2,f=(3&c)<<4|u>>4,p=1<y?(15&u)<<2|m>>6:64,d=2<y?63&m:64,b.push(o.charAt(g)+o.charAt(f)+o.charAt(p)+o.charAt(d));return b.join("")},a.decode=function(l){var c,u,m,g,f,p,d=0,b=0,h="data:";if(l.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var v,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|y):new Array(0|y);d<l.length;)c=o.indexOf(l.charAt(d++))<<2|(g=o.indexOf(l.charAt(d++)))>>4,u=(15&g)<<4|(f=o.indexOf(l.charAt(d++)))>>2,m=(3&f)<<6|(p=o.indexOf(l.charAt(d++))),v[b++]=c,f!==64&&(v[b++]=u),p!==64&&(v[b++]=m);return v}},{"./support":30,"./utils":32}],2:[function(e,n,a){var i=e("./external"),s=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(u,m,g,f,p){this.compressedSize=u,this.uncompressedSize=m,this.crc32=g,this.compression=f,this.compressedContent=p}c.prototype={getContentWorker:function(){var u=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),m=this;return u.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(u,m,g){return u.pipe(new o).pipe(new l("uncompressedSize")).pipe(m.compressWorker(g)).pipe(new l("compressedSize")).withStreamInfo("compression",m)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,a){var i=e("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},a.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,a){var i=e("./utils"),s=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?function(c,u,m,g){var f=s,p=g+m;c^=-1;for(var d=g;d<p;d++)c=c>>>8^f[255&(c^u[d])];return-1^c}(0|l,o,o.length,0):function(c,u,m,g){var f=s,p=g+m;c^=-1;for(var d=g;d<p;d++)c=c>>>8^f[255&(c^u.charCodeAt(d))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(e,n,a){var i=null;i=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:i}},{lie:37}],7:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=i?"uint8array":"array";function u(m,g){l.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=g,this.meta={}}a.magic="\b\0",o.inherits(u,l),u.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,m.data),!1)},u.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(g){m.push({data:g,meta:m.meta})}},a.compressWorker=function(m){return new u("Deflate",m)},a.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,a){function i(f,p){var d,b="";for(d=0;d<p;d++)b+=String.fromCharCode(255&f),f>>>=8;return b}function s(f,p,d,b,h,v){var y,k,$=f.file,P=f.compression,j=v!==c.utf8encode,I=o.transformTo("string",v($.name)),N=o.transformTo("string",c.utf8encode($.name)),T=$.comment,Q=o.transformTo("string",v(T)),E=o.transformTo("string",c.utf8encode(T)),R=N.length!==$.name.length,_=E.length!==T.length,U="",at="",V="",it=$.dir,Z=$.date,ct={crc32:0,compressedSize:0,uncompressedSize:0};p&&!d||(ct.crc32=f.crc32,ct.compressedSize=f.compressedSize,ct.uncompressedSize=f.uncompressedSize);var z=0;p&&(z|=8),j||!R&&!_||(z|=2048);var O=0,st=0;it&&(O|=16),h==="UNIX"?(st=798,O|=function(K,Ct){var At=K;return K||(At=Ct?16893:33204),(65535&At)<<16}($.unixPermissions,it)):(st=20,O|=function(K){return 63&(K||0)}($.dosPermissions)),y=Z.getUTCHours(),y<<=6,y|=Z.getUTCMinutes(),y<<=5,y|=Z.getUTCSeconds()/2,k=Z.getUTCFullYear()-1980,k<<=4,k|=Z.getUTCMonth()+1,k<<=5,k|=Z.getUTCDate(),R&&(at=i(1,1)+i(u(I),4)+N,U+="up"+i(at.length,2)+at),_&&(V=i(1,1)+i(u(Q),4)+E,U+="uc"+i(V.length,2)+V);var M="";return M+=`
\0`,M+=i(z,2),M+=P.magic,M+=i(y,2),M+=i(k,2),M+=i(ct.crc32,4),M+=i(ct.compressedSize,4),M+=i(ct.uncompressedSize,4),M+=i(I.length,2),M+=i(U.length,2),{fileRecord:m.LOCAL_FILE_HEADER+M+I+U,dirRecord:m.CENTRAL_FILE_HEADER+i(st,2)+M+i(Q.length,2)+"\0\0\0\0"+i(O,4)+i(b,4)+I+U+Q}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),u=e("../crc32"),m=e("../signature");function g(f,p,d,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=d,this.encodeFileName=b,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(g,l),g.prototype.push=function(f){var p=f.meta.percent||0,d=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:d?(p+100*(d-b-1))/d:100}}))},g.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var d=s(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,d=s(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),p)this.push({data:function(b){return m.DATA_DESCRIPTOR+i(b.crc32,4)+i(b.compressedSize,4)+i(b.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var d=this.bytesWritten-f,b=function(h,v,y,k,$){var P=o.transformTo("string",$(k));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(h,2)+i(h,2)+i(v,4)+i(y,4)+i(P.length,2)+P}(this.dirRecords.length,d,f,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(d){p.processChunk(d)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(d){p.error(d)}),this},g.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(f){var p=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var d=0;d<p.length;d++)try{p[d].error(f)}catch{}return!0},g.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},n.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,a){var i=e("../compressions"),s=e("./ZipFileWorker");a.generateWorker=function(o,l,c){var u=new s(l.streamFiles,c,l.platform,l.encodeFileName),m=0;try{o.forEach(function(g,f){m++;var p=function(v,y){var k=v||y,$=i[k];if(!$)throw new Error(k+" is not a valid compression method !");return $}(f.options.compression,l.compression),d=f.options.compressionOptions||l.compressionOptions||{},b=f.dir,h=f.date;f._compressWorker(p,d).withStreamInfo("file",{name:g,dir:b,date:h,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=m}catch(g){u.error(g)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,a){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(s,o){return new i().loadAsync(s,o)},i.external=e("./external"),n.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,a){var i=e("./utils"),s=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),u=e("./nodejsUtils");function m(g){return new s.Promise(function(f,p){var d=g.decompressed.getContentWorker().pipe(new c);d.on("error",function(b){p(b)}).on("end",function(){d.streamInfo.crc32!==g.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(g,f){var p=this;return f=i.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(g)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",g,!0,f.optimizedBinaryString,f.base64).then(function(d){var b=new l(f);return b.load(d),b}).then(function(d){var b=[s.Promise.resolve(d)],h=d.files;if(f.checkCRC32)for(var v=0;v<h.length;v++)b.push(m(h[v]));return s.Promise.all(b)}).then(function(d){for(var b=d.shift(),h=b.files,v=0;v<h.length;v++){var y=h[v],k=y.fileNameStr,$=i.resolve(y.fileNameStr);p.file($,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:f.createFolders}),y.dir||(p.file($).unsafeOriginalName=k)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,a){var i=e("../utils"),s=e("../stream/GenericWorker");function o(l,c){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(o,s),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(u){c.push({data:u,meta:{percent:0}})}).on("error",function(u){c.isPaused?this.generatedError=u:c.error(u)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,a){var i=e("readable-stream").Readable;function s(o,l,c){i.call(this,l),this._helper=o;var u=this;o.on("data",function(m,g){u.push(m)||u._helper.pause(),c&&c(g)}).on("error",function(m){u.emit("error",m)}).on("end",function(){u.push(null)})}e("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(e,n,a){function i($,P,j){var I,N=o.getTypeOf(P),T=o.extend(j||{},u);T.date=T.date||new Date,T.compression!==null&&(T.compression=T.compression.toUpperCase()),typeof T.unixPermissions=="string"&&(T.unixPermissions=parseInt(T.unixPermissions,8)),T.unixPermissions&&16384&T.unixPermissions&&(T.dir=!0),T.dosPermissions&&16&T.dosPermissions&&(T.dir=!0),T.dir&&($=h($)),T.createFolders&&(I=b($))&&v.call(this,I,!0);var Q=N==="string"&&T.binary===!1&&T.base64===!1;j&&j.binary!==void 0||(T.binary=!Q),(P instanceof m&&P.uncompressedSize===0||T.dir||!P||P.length===0)&&(T.base64=!1,T.binary=!0,P="",T.compression="STORE",N="string");var E=null;E=P instanceof m||P instanceof l?P:p.isNode&&p.isStream(P)?new d($,P):o.prepareContent($,P,T.binary,T.optimizedBinaryString,T.base64);var R=new g($,E,T);this.files[$]=R}var s=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),u=e("./defaults"),m=e("./compressedObject"),g=e("./zipObject"),f=e("./generate"),p=e("./nodejsUtils"),d=e("./nodejs/NodejsStreamInputAdapter"),b=function($){$.slice(-1)==="/"&&($=$.substring(0,$.length-1));var P=$.lastIndexOf("/");return 0<P?$.substring(0,P):""},h=function($){return $.slice(-1)!=="/"&&($+="/"),$},v=function($,P){return P=P!==void 0?P:u.createFolders,$=h($),this.files[$]||i.call(this,$,null,{dir:!0,createFolders:P}),this.files[$]};function y($){return Object.prototype.toString.call($)==="[object RegExp]"}var k={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function($){var P,j,I;for(P in this.files)I=this.files[P],(j=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&$(j,I)},filter:function($){var P=[];return this.forEach(function(j,I){$(j,I)&&P.push(I)}),P},file:function($,P,j){if(arguments.length!==1)return $=this.root+$,i.call(this,$,P,j),this;if(y($)){var I=$;return this.filter(function(T,Q){return!Q.dir&&I.test(T)})}var N=this.files[this.root+$];return N&&!N.dir?N:null},folder:function($){if(!$)return this;if(y($))return this.filter(function(N,T){return T.dir&&$.test(N)});var P=this.root+$,j=v.call(this,P),I=this.clone();return I.root=j.name,I},remove:function($){$=this.root+$;var P=this.files[$];if(P||($.slice(-1)!=="/"&&($+="/"),P=this.files[$]),P&&!P.dir)delete this.files[$];else for(var j=this.filter(function(N,T){return T.name.slice(0,$.length)===$}),I=0;I<j.length;I++)delete this.files[j[I].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function($){var P,j={};try{if((j=o.extend($||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=j.type.toLowerCase(),j.compression=j.compression.toUpperCase(),j.type==="binarystring"&&(j.type="string"),!j.type)throw new Error("No output type specified.");o.checkSupport(j.type),j.platform!=="darwin"&&j.platform!=="freebsd"&&j.platform!=="linux"&&j.platform!=="sunos"||(j.platform="UNIX"),j.platform==="win32"&&(j.platform="DOS");var I=j.comment||this.comment||"";P=f.generateWorker(this,j,I)}catch(N){(P=new l("error")).error(N)}return new c(P,j.type||"string",j.mimeType)},generateAsync:function($,P){return this.generateInternalStream($).accumulate(P)},generateNodeStream:function($,P){return($=$||{}).type||($.type="nodebuffer"),this.generateInternalStream($).toNodejsStream(P)}};n.exports=k},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,a){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),m=o.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===l&&this.data[g+1]===c&&this.data[g+2]===u&&this.data[g+3]===m)return g-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),m=o.charCodeAt(3),g=this.readData(4);return l===g[0]&&c===g[1]&&u===g[2]&&m===g[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,n,a){var i=e("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(e,n,a){var i=e("./Uint8ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,n,a){var i=e("./ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,a){var i=e("../utils"),s=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");n.exports=function(m){var g=i.getTypeOf(m);return i.checkSupport(g),g!=="string"||s.uint8array?g==="nodebuffer"?new c(m):s.uint8array?new u(i.transformTo("uint8array",m)):new o(i.transformTo("array",m)):new l(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,a){var i=e("./GenericWorker"),s=e("../utils");function o(l){i.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,i),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,a){var i=e("./GenericWorker"),s=e("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,i),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(o,s),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(u){c.dataIsReady=!0,c.data=u,c.max=u&&u.length||0,c.type=i.getTypeOf(u),c.isPaused||c._tickAndRepeat()},function(u){c.error(u)})}i.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,a){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=i},{}],29:[function(e,n,a){var i=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),u=e("../external"),m=null;if(c.nodestream)try{m=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(p,d){return new u.Promise(function(b,h){var v=[],y=p._internalType,k=p._outputType,$=p._mimeType;p.on("data",function(P,j){v.push(P),d&&d(j)}).on("error",function(P){v=[],h(P)}).on("end",function(){try{var P=function(j,I,N){switch(j){case"blob":return i.newBlob(i.transformTo("arraybuffer",I),N);case"base64":return l.encode(I);default:return i.transformTo(j,I)}}(k,function(j,I){var N,T=0,Q=null,E=0;for(N=0;N<I.length;N++)E+=I[N].length;switch(j){case"string":return I.join("");case"array":return Array.prototype.concat.apply([],I);case"uint8array":for(Q=new Uint8Array(E),N=0;N<I.length;N++)Q.set(I[N],T),T+=I[N].length;return Q;case"nodebuffer":return Buffer.concat(I);default:throw new Error("concat : unsupported type '"+j+"'")}}(y,v),$);b(P)}catch(j){h(j)}v=[]}).resume()})}function f(p,d,b){var h=d;switch(d){case"blob":case"arraybuffer":h="uint8array";break;case"base64":h="string"}try{this._internalType=h,this._outputType=d,this._mimeType=b,i.checkSupport(h),this._worker=p.pipe(new s(h)),p.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}f.prototype={accumulate:function(p){return g(this,p)},on:function(p,d){var b=this;return p==="data"?this._worker.on(p,function(h){d.call(b,h.data,h.meta)}):this._worker.on(p,function(){i.delay(d,arguments,b)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},p)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var i=new ArrayBuffer(0);try{a.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!e("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,a){for(var i=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;c[254]=c[254]=1;function m(){l.call(this,"utf-8 decode"),this.leftOver=null}function g(){l.call(this,"utf-8 encode")}a.utf8encode=function(f){return s.nodebuffer?o.newBufferFrom(f,"utf-8"):function(p){var d,b,h,v,y,k=p.length,$=0;for(v=0;v<k;v++)(64512&(b=p.charCodeAt(v)))==55296&&v+1<k&&(64512&(h=p.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(h-56320),v++),$+=b<128?1:b<2048?2:b<65536?3:4;for(d=s.uint8array?new Uint8Array($):new Array($),v=y=0;y<$;v++)(64512&(b=p.charCodeAt(v)))==55296&&v+1<k&&(64512&(h=p.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(h-56320),v++),b<128?d[y++]=b:(b<2048?d[y++]=192|b>>>6:(b<65536?d[y++]=224|b>>>12:(d[y++]=240|b>>>18,d[y++]=128|b>>>12&63),d[y++]=128|b>>>6&63),d[y++]=128|63&b);return d}(f)},a.utf8decode=function(f){return s.nodebuffer?i.transformTo("nodebuffer",f).toString("utf-8"):function(p){var d,b,h,v,y=p.length,k=new Array(2*y);for(d=b=0;d<y;)if((h=p[d++])<128)k[b++]=h;else if(4<(v=c[h]))k[b++]=65533,d+=v-1;else{for(h&=v===2?31:v===3?15:7;1<v&&d<y;)h=h<<6|63&p[d++],v--;1<v?k[b++]=65533:h<65536?k[b++]=h:(h-=65536,k[b++]=55296|h>>10&1023,k[b++]=56320|1023&h)}return k.length!==b&&(k.subarray?k=k.subarray(0,b):k.length=b),i.applyFromCharCode(k)}(f=i.transformTo(s.uint8array?"uint8array":"array",f))},i.inherits(m,l),m.prototype.processChunk=function(f){var p=i.transformTo(s.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var d=p;(p=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),p.set(d,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(v,y){var k;for((y=y||v.length)>v.length&&(y=v.length),k=y-1;0<=k&&(192&v[k])==128;)k--;return k<0||k===0?y:k+c[v[k]]>y?k:y}(p),h=p;b!==p.length&&(s.uint8array?(h=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(h=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:a.utf8decode(h),meta:f.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=m,i.inherits(g,l),g.prototype.processChunk=function(f){this.push({data:a.utf8encode(f.data),meta:f.meta})},a.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,a){var i=e("./support"),s=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(d){return d}function u(d,b){for(var h=0;h<d.length;++h)b[h]=255&d.charCodeAt(h);return b}e("setimmediate"),a.newBlob=function(d,b){a.checkSupport("blob");try{return new Blob([d],{type:b})}catch{try{var h=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return h.append(d),h.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(d,b,h){var v=[],y=0,k=d.length;if(k<=h)return String.fromCharCode.apply(null,d);for(;y<k;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,d.slice(y,Math.min(y+h,k)))):v.push(String.fromCharCode.apply(null,d.subarray(y,Math.min(y+h,k)))),y+=h;return v.join("")},stringifyByChar:function(d){for(var b="",h=0;h<d.length;h++)b+=String.fromCharCode(d[h]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function g(d){var b=65536,h=a.getTypeOf(d),v=!0;if(h==="uint8array"?v=m.applyCanBeUsed.uint8array:h==="nodebuffer"&&(v=m.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return m.stringifyByChunk(d,h,b)}catch{b=Math.floor(b/2)}return m.stringifyByChar(d)}function f(d,b){for(var h=0;h<d.length;h++)b[h]=d[h];return b}a.applyFromCharCode=g;var p={};p.string={string:c,array:function(d){return u(d,new Array(d.length))},arraybuffer:function(d){return p.string.uint8array(d).buffer},uint8array:function(d){return u(d,new Uint8Array(d.length))},nodebuffer:function(d){return u(d,o.allocBuffer(d.length))}},p.array={string:g,array:c,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return o.newBufferFrom(d)}},p.arraybuffer={string:function(d){return g(new Uint8Array(d))},array:function(d){return f(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:c,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return o.newBufferFrom(new Uint8Array(d))}},p.uint8array={string:g,array:function(d){return f(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:c,nodebuffer:function(d){return o.newBufferFrom(d)}},p.nodebuffer={string:g,array:function(d){return f(d,new Array(d.length))},arraybuffer:function(d){return p.nodebuffer.uint8array(d).buffer},uint8array:function(d){return f(d,new Uint8Array(d.length))},nodebuffer:c},a.transformTo=function(d,b){if(b=b||"",!d)return b;a.checkSupport(d);var h=a.getTypeOf(b);return p[h][d](b)},a.resolve=function(d){for(var b=d.split("/"),h=[],v=0;v<b.length;v++){var y=b[v];y==="."||y===""&&v!==0&&v!==b.length-1||(y===".."?h.pop():h.push(y))}return h.join("/")},a.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(d)?"nodebuffer":i.uint8array&&d instanceof Uint8Array?"uint8array":i.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(d){if(!i[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(d){var b,h,v="";for(h=0;h<(d||"").length;h++)v+="\\x"+((b=d.charCodeAt(h))<16?"0":"")+b.toString(16).toUpperCase();return v},a.delay=function(d,b,h){setImmediate(function(){d.apply(h||null,b||[])})},a.inherits=function(d,b){function h(){}h.prototype=b.prototype,d.prototype=new h},a.extend=function(){var d,b,h={};for(d=0;d<arguments.length;d++)for(b in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],b)&&h[b]===void 0&&(h[b]=arguments[d][b]);return h},a.prepareContent=function(d,b,h,v,y){return l.Promise.resolve(b).then(function(k){return i.blob&&(k instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(k))!==-1)&&typeof FileReader<"u"?new l.Promise(function($,P){var j=new FileReader;j.onload=function(I){$(I.target.result)},j.onerror=function(I){P(I.target.error)},j.readAsArrayBuffer(k)}):k}).then(function(k){var $=a.getTypeOf(k);return $?($==="arraybuffer"?k=a.transformTo("uint8array",k):$==="string"&&(y?k=s.decode(k):h&&v!==!0&&(k=function(P){return u(P,i.uint8array?new Uint8Array(P.length):new Array(P.length))}(k))),k):l.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function u(m){this.files=[],this.loadOptions=m}u.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(g)+", expected "+s.pretty(m)+")")}},isSignature:function(m,g){var f=this.reader.index;this.reader.setIndex(m);var p=this.reader.readString(4)===g;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),g=c.uint8array?"uint8array":"array",f=s.transformTo(g,m);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,g,f,p=this.zip64EndOfCentralSize-44;0<p;)m=this.reader.readInt(2),g=this.reader.readInt(4),f=this.reader.readData(g),this.zip64ExtensibleData[m]={id:m,length:g,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,g;for(m=0;m<this.files.length;m++)g=this.files[m],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(m=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var g=m;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=g-f;if(0<p)this.isSignature(g,o.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(m){this.reader=i(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),u=e("./compressions"),m=e("./support");function g(f,p){this.options=f,this.loadOptions=p}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,d;if(f.skip(22),this.fileNameLength=f.readInt(2),d=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var h in u)if(Object.prototype.hasOwnProperty.call(u,h)&&u[h].magic===b)return u[h];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,d,b,h=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<h;)p=f.readInt(2),d=f.readInt(2),b=f.readData(d),this.extraFields[p]={id:p,length:d,value:b};f.setIndex(h)},handleUTF8:function(){var f=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var d=s.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var h=s.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(h)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=i(f.value);return p.readInt(1)!==1||l(this.fileName)!==p.readInt(4)?null:c.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=i(f.value);return p.readInt(1)!==1||l(this.fileComment)!==p.readInt(4)?null:c.utf8decode(p.readData(f.length-5))}return null}},n.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,a){function i(p,d,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=d,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var s=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),u=e("./stream/GenericWorker");i.prototype={internalStream:function(p){var d=null,b="string";try{if(!p)throw new Error("No output type specified.");var h=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),d=this._decompressWorker();var v=!this._dataBinary;v&&!h&&(d=d.pipe(new l.Utf8EncodeWorker)),!v&&h&&(d=d.pipe(new l.Utf8DecodeWorker))}catch(y){(d=new u("error")).error(y)}return new s(d,b,"")},async:function(p,d){return this.internalStream(p).accumulate(d)},nodeStream:function(p,d){return this.internalStream(p||"nodebuffer").toNodejsStream(d)},_compressWorker:function(p,d){if(this._data instanceof c&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,p,d)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<m.length;f++)i.prototype[m[f]]=g;n.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,a){(function(i){var s,o,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var c=0,u=new l(p),m=i.document.createTextNode("");u.observe(m,{characterData:!0}),s=function(){m.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var d=i.document.createElement("script");d.onreadystatechange=function(){p(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},i.document.documentElement.appendChild(d)}:function(){setTimeout(p,0)};else{var g=new i.MessageChannel;g.port1.onmessage=p,s=function(){g.port2.postMessage(0)}}var f=[];function p(){var d,b;o=!0;for(var h=f.length;h;){for(b=f,f=[],d=-1;++d<h;)b[d]();h=f.length}o=!1}n.exports=function(d){f.push(d)!==1||o||s()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,a){var i=e("immediate");function s(){}var o={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function m(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,h!==s&&d(this,h)}function g(h,v,y){this.promise=h,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function f(h,v,y){i(function(){var k;try{k=v(y)}catch($){return o.reject(h,$)}k===h?o.reject(h,new TypeError("Cannot resolve promise with itself")):o.resolve(h,k)})}function p(h){var v=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof v=="function")return function(){v.apply(h,arguments)}}function d(h,v){var y=!1;function k(j){y||(y=!0,o.reject(h,j))}function $(j){y||(y=!0,o.resolve(h,j))}var P=b(function(){v($,k)});P.status==="error"&&k(P.value)}function b(h,v){var y={};try{y.value=h(v),y.status="success"}catch(k){y.status="error",y.value=k}return y}(n.exports=m).prototype.finally=function(h){if(typeof h!="function")return this;var v=this.constructor;return this.then(function(y){return v.resolve(h()).then(function(){return y})},function(y){return v.resolve(h()).then(function(){throw y})})},m.prototype.catch=function(h){return this.then(null,h)},m.prototype.then=function(h,v){if(typeof h!="function"&&this.state===c||typeof v!="function"&&this.state===l)return this;var y=new this.constructor(s);return this.state!==u?f(y,this.state===c?h:v,this.outcome):this.queue.push(new g(y,h,v)),y},g.prototype.callFulfilled=function(h){o.resolve(this.promise,h)},g.prototype.otherCallFulfilled=function(h){f(this.promise,this.onFulfilled,h)},g.prototype.callRejected=function(h){o.reject(this.promise,h)},g.prototype.otherCallRejected=function(h){f(this.promise,this.onRejected,h)},o.resolve=function(h,v){var y=b(p,v);if(y.status==="error")return o.reject(h,y.value);var k=y.value;if(k)d(h,k);else{h.state=c,h.outcome=v;for(var $=-1,P=h.queue.length;++$<P;)h.queue[$].callFulfilled(v)}return h},o.reject=function(h,v){h.state=l,h.outcome=v;for(var y=-1,k=h.queue.length;++y<k;)h.queue[y].callRejected(v);return h},m.resolve=function(h){return h instanceof this?h:o.resolve(new this(s),h)},m.reject=function(h){var v=new this(s);return o.reject(v,h)},m.all=function(h){var v=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=h.length,k=!1;if(!y)return this.resolve([]);for(var $=new Array(y),P=0,j=-1,I=new this(s);++j<y;)N(h[j],j);return I;function N(T,Q){v.resolve(T).then(function(E){$[Q]=E,++P!==y||k||(k=!0,o.resolve(I,$))},function(E){k||(k=!0,o.reject(I,E))})}},m.race=function(h){var v=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=h.length,k=!1;if(!y)return this.resolve([]);for(var $=-1,P=new this(s);++$<y;)j=h[$],v.resolve(j).then(function(I){k||(k=!0,o.resolve(P,I))},function(I){k||(k=!0,o.reject(P,I))});var j;return P}},{immediate:36}],38:[function(e,n,a){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,a){var i=e("./zlib/deflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),u=Object.prototype.toString,m=0,g=-1,f=0,p=8;function d(h){if(!(this instanceof d))return new d(h);this.options=s.assign({level:g,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},h||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=i.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(y!==m)throw new Error(l[y]);if(v.header&&i.deflateSetHeader(this.strm,v.header),v.dictionary){var k;if(k=typeof v.dictionary=="string"?o.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(y=i.deflateSetDictionary(this.strm,k))!==m)throw new Error(l[y]);this._dict_set=!0}}function b(h,v){var y=new d(v);if(y.push(h,!0),y.err)throw y.msg||l[y.err];return y.result}d.prototype.push=function(h,v){var y,k,$=this.strm,P=this.options.chunkSize;if(this.ended)return!1;k=v===~~v?v:v===!0?4:0,typeof h=="string"?$.input=o.string2buf(h):u.call(h)==="[object ArrayBuffer]"?$.input=new Uint8Array(h):$.input=h,$.next_in=0,$.avail_in=$.input.length;do{if($.avail_out===0&&($.output=new s.Buf8(P),$.next_out=0,$.avail_out=P),(y=i.deflate($,k))!==1&&y!==m)return this.onEnd(y),!(this.ended=!0);$.avail_out!==0&&($.avail_in!==0||k!==4&&k!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf($.output,$.next_out))):this.onData(s.shrinkBuf($.output,$.next_out)))}while((0<$.avail_in||$.avail_out===0)&&y!==1);return k===4?(y=i.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===m):k!==2||(this.onEnd(m),!($.avail_out=0))},d.prototype.onData=function(h){this.chunks.push(h)},d.prototype.onEnd=function(h){h===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},a.Deflate=d,a.deflate=b,a.deflateRaw=function(h,v){return(v=v||{}).raw=!0,b(h,v)},a.gzip=function(h,v){return(v=v||{}).gzip=!0,b(h,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,a){var i=e("./zlib/inflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),u=e("./zlib/zstream"),m=e("./zlib/gzheader"),g=Object.prototype.toString;function f(d){if(!(this instanceof f))return new f(d);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},d||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||d&&d.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var h=i.inflateInit2(this.strm,b.windowBits);if(h!==l.Z_OK)throw new Error(c[h]);this.header=new m,i.inflateGetHeader(this.strm,this.header)}function p(d,b){var h=new f(b);if(h.push(d,!0),h.err)throw h.msg||c[h.err];return h.result}f.prototype.push=function(d,b){var h,v,y,k,$,P,j=this.strm,I=this.options.chunkSize,N=this.options.dictionary,T=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof d=="string"?j.input=o.binstring2buf(d):g.call(d)==="[object ArrayBuffer]"?j.input=new Uint8Array(d):j.input=d,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new s.Buf8(I),j.next_out=0,j.avail_out=I),(h=i.inflate(j,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&N&&(P=typeof N=="string"?o.string2buf(N):g.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,h=i.inflateSetDictionary(this.strm,P)),h===l.Z_BUF_ERROR&&T===!0&&(h=l.Z_OK,T=!1),h!==l.Z_STREAM_END&&h!==l.Z_OK)return this.onEnd(h),!(this.ended=!0);j.next_out&&(j.avail_out!==0&&h!==l.Z_STREAM_END&&(j.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(j.output,j.next_out),k=j.next_out-y,$=o.buf2string(j.output,y),j.next_out=k,j.avail_out=I-k,k&&s.arraySet(j.output,j.output,y,k,0),this.onData($)):this.onData(s.shrinkBuf(j.output,j.next_out)))),j.avail_in===0&&j.avail_out===0&&(T=!0)}while((0<j.avail_in||j.avail_out===0)&&h!==l.Z_STREAM_END);return h===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(h=i.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(j.avail_out=0))},f.prototype.onData=function(d){this.chunks.push(d)},f.prototype.onEnd=function(d){d===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},a.Inflate=f,a.inflate=p,a.inflateRaw=function(d,b){return(b=b||{}).raw=!0,p(d,b)},a.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var u=c.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var m in u)u.hasOwnProperty(m)&&(l[m]=u[m])}}return l},a.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var s={arraySet:function(l,c,u,m,g){if(c.subarray&&l.subarray)l.set(c.subarray(u,u+m),g);else for(var f=0;f<m;f++)l[g+f]=c[u+f]},flattenChunks:function(l){var c,u,m,g,f,p;for(c=m=0,u=l.length;c<u;c++)m+=l[c].length;for(p=new Uint8Array(m),c=g=0,u=l.length;c<u;c++)f=l[c],p.set(f,g),g+=f.length;return p}},o={arraySet:function(l,c,u,m,g){for(var f=0;f<m;f++)l[g+f]=c[u+f]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,o))},a.setTyped(i)},{}],42:[function(e,n,a){var i=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new i.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(m,g){if(g<65537&&(m.subarray&&o||!m.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(m,g));for(var f="",p=0;p<g;p++)f+=String.fromCharCode(m[p]);return f}l[254]=l[254]=1,a.string2buf=function(m){var g,f,p,d,b,h=m.length,v=0;for(d=0;d<h;d++)(64512&(f=m.charCodeAt(d)))==55296&&d+1<h&&(64512&(p=m.charCodeAt(d+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),d++),v+=f<128?1:f<2048?2:f<65536?3:4;for(g=new i.Buf8(v),d=b=0;b<v;d++)(64512&(f=m.charCodeAt(d)))==55296&&d+1<h&&(64512&(p=m.charCodeAt(d+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),d++),f<128?g[b++]=f:(f<2048?g[b++]=192|f>>>6:(f<65536?g[b++]=224|f>>>12:(g[b++]=240|f>>>18,g[b++]=128|f>>>12&63),g[b++]=128|f>>>6&63),g[b++]=128|63&f);return g},a.buf2binstring=function(m){return u(m,m.length)},a.binstring2buf=function(m){for(var g=new i.Buf8(m.length),f=0,p=g.length;f<p;f++)g[f]=m.charCodeAt(f);return g},a.buf2string=function(m,g){var f,p,d,b,h=g||m.length,v=new Array(2*h);for(f=p=0;f<h;)if((d=m[f++])<128)v[p++]=d;else if(4<(b=l[d]))v[p++]=65533,f+=b-1;else{for(d&=b===2?31:b===3?15:7;1<b&&f<h;)d=d<<6|63&m[f++],b--;1<b?v[p++]=65533:d<65536?v[p++]=d:(d-=65536,v[p++]=55296|d>>10&1023,v[p++]=56320|1023&d)}return u(v,p)},a.utf8border=function(m,g){var f;for((g=g||m.length)>m.length&&(g=m.length),f=g-1;0<=f&&(192&m[f])==128;)f--;return f<0||f===0?g:f+l[m[f]]>g?f:g}},{"./common":41}],43:[function(e,n,a){n.exports=function(i,s,o,l){for(var c=65535&i|0,u=i>>>16&65535|0,m=0;o!==0;){for(o-=m=2e3<o?2e3:o;u=u+(c=c+s[l++]|0)|0,--m;);c%=65521,u%=65521}return c|u<<16|0}},{}],44:[function(e,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,a){var i=function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o}();n.exports=function(s,o,l,c){var u=i,m=c+l;s^=-1;for(var g=c;g<m;g++)s=s>>>8^u[255&(s^o[g])];return-1^s}},{}],46:[function(e,n,a){var i,s=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),u=e("./messages"),m=0,g=4,f=0,p=-2,d=-1,b=4,h=2,v=8,y=9,k=286,$=30,P=19,j=2*k+1,I=15,N=3,T=258,Q=T+N+1,E=42,R=113,_=1,U=2,at=3,V=4;function it(w,W){return w.msg=u[W],W}function Z(w){return(w<<1)-(4<w?9:0)}function ct(w){for(var W=w.length;0<=--W;)w[W]=0}function z(w){var W=w.state,L=W.pending;L>w.avail_out&&(L=w.avail_out),L!==0&&(s.arraySet(w.output,W.pending_buf,W.pending_out,L,w.next_out),w.next_out+=L,W.pending_out+=L,w.total_out+=L,w.avail_out-=L,W.pending-=L,W.pending===0&&(W.pending_out=0))}function O(w,W){o._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,W),w.block_start=w.strstart,z(w.strm)}function st(w,W){w.pending_buf[w.pending++]=W}function M(w,W){w.pending_buf[w.pending++]=W>>>8&255,w.pending_buf[w.pending++]=255&W}function K(w,W){var L,x,C=w.max_chain_length,A=w.strstart,H=w.prev_length,G=w.nice_match,B=w.strstart>w.w_size-Q?w.strstart-(w.w_size-Q):0,X=w.window,rt=w.w_mask,tt=w.prev,ot=w.strstart+T,St=X[A+H-1],_t=X[A+H];w.prev_length>=w.good_match&&(C>>=2),G>w.lookahead&&(G=w.lookahead);do if(X[(L=W)+H]===_t&&X[L+H-1]===St&&X[L]===X[A]&&X[++L]===X[A+1]){A+=2,L++;do;while(X[++A]===X[++L]&&X[++A]===X[++L]&&X[++A]===X[++L]&&X[++A]===X[++L]&&X[++A]===X[++L]&&X[++A]===X[++L]&&X[++A]===X[++L]&&X[++A]===X[++L]&&A<ot);if(x=T-(ot-A),A=ot-T,H<x){if(w.match_start=W,G<=(H=x))break;St=X[A+H-1],_t=X[A+H]}}while((W=tt[W&rt])>B&&--C!=0);return H<=w.lookahead?H:w.lookahead}function Ct(w){var W,L,x,C,A,H,G,B,X,rt,tt=w.w_size;do{if(C=w.window_size-w.lookahead-w.strstart,w.strstart>=tt+(tt-Q)){for(s.arraySet(w.window,w.window,tt,tt,0),w.match_start-=tt,w.strstart-=tt,w.block_start-=tt,W=L=w.hash_size;x=w.head[--W],w.head[W]=tt<=x?x-tt:0,--L;);for(W=L=tt;x=w.prev[--W],w.prev[W]=tt<=x?x-tt:0,--L;);C+=tt}if(w.strm.avail_in===0)break;if(H=w.strm,G=w.window,B=w.strstart+w.lookahead,X=C,rt=void 0,rt=H.avail_in,X<rt&&(rt=X),L=rt===0?0:(H.avail_in-=rt,s.arraySet(G,H.input,H.next_in,rt,B),H.state.wrap===1?H.adler=l(H.adler,G,rt,B):H.state.wrap===2&&(H.adler=c(H.adler,G,rt,B)),H.next_in+=rt,H.total_in+=rt,rt),w.lookahead+=L,w.lookahead+w.insert>=N)for(A=w.strstart-w.insert,w.ins_h=w.window[A],w.ins_h=(w.ins_h<<w.hash_shift^w.window[A+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[A+N-1])&w.hash_mask,w.prev[A&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=A,A++,w.insert--,!(w.lookahead+w.insert<N)););}while(w.lookahead<Q&&w.strm.avail_in!==0)}function At(w,W){for(var L,x;;){if(w.lookahead<Q){if(Ct(w),w.lookahead<Q&&W===m)return _;if(w.lookahead===0)break}if(L=0,w.lookahead>=N&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+N-1])&w.hash_mask,L=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),L!==0&&w.strstart-L<=w.w_size-Q&&(w.match_length=K(w,L)),w.match_length>=N)if(x=o._tr_tally(w,w.strstart-w.match_start,w.match_length-N),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=N){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+N-1])&w.hash_mask,L=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else x=o._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(x&&(O(w,!1),w.strm.avail_out===0))return _}return w.insert=w.strstart<N-1?w.strstart:N-1,W===g?(O(w,!0),w.strm.avail_out===0?at:V):w.last_lit&&(O(w,!1),w.strm.avail_out===0)?_:U}function vt(w,W){for(var L,x,C;;){if(w.lookahead<Q){if(Ct(w),w.lookahead<Q&&W===m)return _;if(w.lookahead===0)break}if(L=0,w.lookahead>=N&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+N-1])&w.hash_mask,L=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=N-1,L!==0&&w.prev_length<w.max_lazy_match&&w.strstart-L<=w.w_size-Q&&(w.match_length=K(w,L),w.match_length<=5&&(w.strategy===1||w.match_length===N&&4096<w.strstart-w.match_start)&&(w.match_length=N-1)),w.prev_length>=N&&w.match_length<=w.prev_length){for(C=w.strstart+w.lookahead-N,x=o._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-N),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=C&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+N-1])&w.hash_mask,L=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=N-1,w.strstart++,x&&(O(w,!1),w.strm.avail_out===0))return _}else if(w.match_available){if((x=o._tr_tally(w,0,w.window[w.strstart-1]))&&O(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return _}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(x=o._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<N-1?w.strstart:N-1,W===g?(O(w,!0),w.strm.avail_out===0?at:V):w.last_lit&&(O(w,!1),w.strm.avail_out===0)?_:U}function $t(w,W,L,x,C){this.good_length=w,this.max_lazy=W,this.nice_length=L,this.max_chain=x,this.func=C}function xt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*j),this.dyn_dtree=new s.Buf16(2*(2*$+1)),this.bl_tree=new s.Buf16(2*(2*P+1)),ct(this.dyn_ltree),ct(this.dyn_dtree),ct(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(I+1),this.heap=new s.Buf16(2*k+1),ct(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*k+1),ct(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pt(w){var W;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=h,(W=w.state).pending=0,W.pending_out=0,W.wrap<0&&(W.wrap=-W.wrap),W.status=W.wrap?E:R,w.adler=W.wrap===2?0:1,W.last_flush=m,o._tr_init(W),f):it(w,p)}function se(w){var W=Pt(w);return W===f&&function(L){L.window_size=2*L.w_size,ct(L.head),L.max_lazy_match=i[L.level].max_lazy,L.good_match=i[L.level].good_length,L.nice_match=i[L.level].nice_length,L.max_chain_length=i[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=N-1,L.match_available=0,L.ins_h=0}(w.state),W}function Yt(w,W,L,x,C,A){if(!w)return p;var H=1;if(W===d&&(W=6),x<0?(H=0,x=-x):15<x&&(H=2,x-=16),C<1||y<C||L!==v||x<8||15<x||W<0||9<W||A<0||b<A)return it(w,p);x===8&&(x=9);var G=new xt;return(w.state=G).strm=w,G.wrap=H,G.gzhead=null,G.w_bits=x,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=C+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+N-1)/N),G.window=new s.Buf8(2*G.w_size),G.head=new s.Buf16(G.hash_size),G.prev=new s.Buf16(G.w_size),G.lit_bufsize=1<<C+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new s.Buf8(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=W,G.strategy=A,G.method=L,se(w)}i=[new $t(0,0,0,0,function(w,W){var L=65535;for(L>w.pending_buf_size-5&&(L=w.pending_buf_size-5);;){if(w.lookahead<=1){if(Ct(w),w.lookahead===0&&W===m)return _;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var x=w.block_start+L;if((w.strstart===0||w.strstart>=x)&&(w.lookahead=w.strstart-x,w.strstart=x,O(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-Q&&(O(w,!1),w.strm.avail_out===0))return _}return w.insert=0,W===g?(O(w,!0),w.strm.avail_out===0?at:V):(w.strstart>w.block_start&&(O(w,!1),w.strm.avail_out),_)}),new $t(4,4,8,4,At),new $t(4,5,16,8,At),new $t(4,6,32,32,At),new $t(4,4,16,16,vt),new $t(8,16,32,32,vt),new $t(8,16,128,128,vt),new $t(8,32,128,256,vt),new $t(32,128,258,1024,vt),new $t(32,258,258,4096,vt)],a.deflateInit=function(w,W){return Yt(w,W,v,15,8,0)},a.deflateInit2=Yt,a.deflateReset=se,a.deflateResetKeep=Pt,a.deflateSetHeader=function(w,W){return w&&w.state?w.state.wrap!==2?p:(w.state.gzhead=W,f):p},a.deflate=function(w,W){var L,x,C,A;if(!w||!w.state||5<W||W<0)return w?it(w,p):p;if(x=w.state,!w.output||!w.input&&w.avail_in!==0||x.status===666&&W!==g)return it(w,w.avail_out===0?-5:p);if(x.strm=w,L=x.last_flush,x.last_flush=W,x.status===E)if(x.wrap===2)w.adler=0,st(x,31),st(x,139),st(x,8),x.gzhead?(st(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),st(x,255&x.gzhead.time),st(x,x.gzhead.time>>8&255),st(x,x.gzhead.time>>16&255),st(x,x.gzhead.time>>24&255),st(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),st(x,255&x.gzhead.os),x.gzhead.extra&&x.gzhead.extra.length&&(st(x,255&x.gzhead.extra.length),st(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(w.adler=c(w.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=69):(st(x,0),st(x,0),st(x,0),st(x,0),st(x,0),st(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),st(x,3),x.status=R);else{var H=v+(x.w_bits-8<<4)<<8;H|=(2<=x.strategy||x.level<2?0:x.level<6?1:x.level===6?2:3)<<6,x.strstart!==0&&(H|=32),H+=31-H%31,x.status=R,M(x,H),x.strstart!==0&&(M(x,w.adler>>>16),M(x,65535&w.adler)),w.adler=1}if(x.status===69)if(x.gzhead.extra){for(C=x.pending;x.gzindex<(65535&x.gzhead.extra.length)&&(x.pending!==x.pending_buf_size||(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),z(w),C=x.pending,x.pending!==x.pending_buf_size));)st(x,255&x.gzhead.extra[x.gzindex]),x.gzindex++;x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=73)}else x.status=73;if(x.status===73)if(x.gzhead.name){C=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),z(w),C=x.pending,x.pending===x.pending_buf_size)){A=1;break}A=x.gzindex<x.gzhead.name.length?255&x.gzhead.name.charCodeAt(x.gzindex++):0,st(x,A)}while(A!==0);x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),A===0&&(x.gzindex=0,x.status=91)}else x.status=91;if(x.status===91)if(x.gzhead.comment){C=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),z(w),C=x.pending,x.pending===x.pending_buf_size)){A=1;break}A=x.gzindex<x.gzhead.comment.length?255&x.gzhead.comment.charCodeAt(x.gzindex++):0,st(x,A)}while(A!==0);x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),A===0&&(x.status=103)}else x.status=103;if(x.status===103&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&z(w),x.pending+2<=x.pending_buf_size&&(st(x,255&w.adler),st(x,w.adler>>8&255),w.adler=0,x.status=R)):x.status=R),x.pending!==0){if(z(w),w.avail_out===0)return x.last_flush=-1,f}else if(w.avail_in===0&&Z(W)<=Z(L)&&W!==g)return it(w,-5);if(x.status===666&&w.avail_in!==0)return it(w,-5);if(w.avail_in!==0||x.lookahead!==0||W!==m&&x.status!==666){var G=x.strategy===2?function(B,X){for(var rt;;){if(B.lookahead===0&&(Ct(B),B.lookahead===0)){if(X===m)return _;break}if(B.match_length=0,rt=o._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,rt&&(O(B,!1),B.strm.avail_out===0))return _}return B.insert=0,X===g?(O(B,!0),B.strm.avail_out===0?at:V):B.last_lit&&(O(B,!1),B.strm.avail_out===0)?_:U}(x,W):x.strategy===3?function(B,X){for(var rt,tt,ot,St,_t=B.window;;){if(B.lookahead<=T){if(Ct(B),B.lookahead<=T&&X===m)return _;if(B.lookahead===0)break}if(B.match_length=0,B.lookahead>=N&&0<B.strstart&&(tt=_t[ot=B.strstart-1])===_t[++ot]&&tt===_t[++ot]&&tt===_t[++ot]){St=B.strstart+T;do;while(tt===_t[++ot]&&tt===_t[++ot]&&tt===_t[++ot]&&tt===_t[++ot]&&tt===_t[++ot]&&tt===_t[++ot]&&tt===_t[++ot]&&tt===_t[++ot]&&ot<St);B.match_length=T-(St-ot),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=N?(rt=o._tr_tally(B,1,B.match_length-N),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(rt=o._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),rt&&(O(B,!1),B.strm.avail_out===0))return _}return B.insert=0,X===g?(O(B,!0),B.strm.avail_out===0?at:V):B.last_lit&&(O(B,!1),B.strm.avail_out===0)?_:U}(x,W):i[x.level].func(x,W);if(G!==at&&G!==V||(x.status=666),G===_||G===at)return w.avail_out===0&&(x.last_flush=-1),f;if(G===U&&(W===1?o._tr_align(x):W!==5&&(o._tr_stored_block(x,0,0,!1),W===3&&(ct(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),z(w),w.avail_out===0))return x.last_flush=-1,f}return W!==g?f:x.wrap<=0?1:(x.wrap===2?(st(x,255&w.adler),st(x,w.adler>>8&255),st(x,w.adler>>16&255),st(x,w.adler>>24&255),st(x,255&w.total_in),st(x,w.total_in>>8&255),st(x,w.total_in>>16&255),st(x,w.total_in>>24&255)):(M(x,w.adler>>>16),M(x,65535&w.adler)),z(w),0<x.wrap&&(x.wrap=-x.wrap),x.pending!==0?f:1)},a.deflateEnd=function(w){var W;return w&&w.state?(W=w.state.status)!==E&&W!==69&&W!==73&&W!==91&&W!==103&&W!==R&&W!==666?it(w,p):(w.state=null,W===R?it(w,-3):f):p},a.deflateSetDictionary=function(w,W){var L,x,C,A,H,G,B,X,rt=W.length;if(!w||!w.state||(A=(L=w.state).wrap)===2||A===1&&L.status!==E||L.lookahead)return p;for(A===1&&(w.adler=l(w.adler,W,rt,0)),L.wrap=0,rt>=L.w_size&&(A===0&&(ct(L.head),L.strstart=0,L.block_start=0,L.insert=0),X=new s.Buf8(L.w_size),s.arraySet(X,W,rt-L.w_size,L.w_size,0),W=X,rt=L.w_size),H=w.avail_in,G=w.next_in,B=w.input,w.avail_in=rt,w.next_in=0,w.input=W,Ct(L);L.lookahead>=N;){for(x=L.strstart,C=L.lookahead-(N-1);L.ins_h=(L.ins_h<<L.hash_shift^L.window[x+N-1])&L.hash_mask,L.prev[x&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=x,x++,--C;);L.strstart=x,L.lookahead=N-1,Ct(L)}return L.strstart+=L.lookahead,L.block_start=L.strstart,L.insert=L.lookahead,L.lookahead=0,L.match_length=L.prev_length=N-1,L.match_available=0,w.next_in=G,w.input=B,w.avail_in=H,L.wrap=A,f},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,a){n.exports=function(i,s){var o,l,c,u,m,g,f,p,d,b,h,v,y,k,$,P,j,I,N,T,Q,E,R,_,U;o=i.state,l=i.next_in,_=i.input,c=l+(i.avail_in-5),u=i.next_out,U=i.output,m=u-(s-i.avail_out),g=u+(i.avail_out-257),f=o.dmax,p=o.wsize,d=o.whave,b=o.wnext,h=o.window,v=o.hold,y=o.bits,k=o.lencode,$=o.distcode,P=(1<<o.lenbits)-1,j=(1<<o.distbits)-1;t:do{y<15&&(v+=_[l++]<<y,y+=8,v+=_[l++]<<y,y+=8),I=k[v&P];e:for(;;){if(v>>>=N=I>>>24,y-=N,(N=I>>>16&255)===0)U[u++]=65535&I;else{if(!(16&N)){if(!(64&N)){I=k[(65535&I)+(v&(1<<N)-1)];continue e}if(32&N){o.mode=12;break t}i.msg="invalid literal/length code",o.mode=30;break t}T=65535&I,(N&=15)&&(y<N&&(v+=_[l++]<<y,y+=8),T+=v&(1<<N)-1,v>>>=N,y-=N),y<15&&(v+=_[l++]<<y,y+=8,v+=_[l++]<<y,y+=8),I=$[v&j];n:for(;;){if(v>>>=N=I>>>24,y-=N,!(16&(N=I>>>16&255))){if(!(64&N)){I=$[(65535&I)+(v&(1<<N)-1)];continue n}i.msg="invalid distance code",o.mode=30;break t}if(Q=65535&I,y<(N&=15)&&(v+=_[l++]<<y,(y+=8)<N&&(v+=_[l++]<<y,y+=8)),f<(Q+=v&(1<<N)-1)){i.msg="invalid distance too far back",o.mode=30;break t}if(v>>>=N,y-=N,(N=u-m)<Q){if(d<(N=Q-N)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break t}if(R=h,(E=0)===b){if(E+=p-N,N<T){for(T-=N;U[u++]=h[E++],--N;);E=u-Q,R=U}}else if(b<N){if(E+=p+b-N,(N-=b)<T){for(T-=N;U[u++]=h[E++],--N;);if(E=0,b<T){for(T-=N=b;U[u++]=h[E++],--N;);E=u-Q,R=U}}}else if(E+=b-N,N<T){for(T-=N;U[u++]=h[E++],--N;);E=u-Q,R=U}for(;2<T;)U[u++]=R[E++],U[u++]=R[E++],U[u++]=R[E++],T-=3;T&&(U[u++]=R[E++],1<T&&(U[u++]=R[E++]))}else{for(E=u-Q;U[u++]=U[E++],U[u++]=U[E++],U[u++]=U[E++],2<(T-=3););T&&(U[u++]=U[E++],1<T&&(U[u++]=U[E++]))}break}}break}}while(l<c&&u<g);l-=T=y>>3,v&=(1<<(y-=T<<3))-1,i.next_in=l,i.next_out=u,i.avail_in=l<c?c-l+5:5-(l-c),i.avail_out=u<g?g-u+257:257-(u-g),o.hold=v,o.bits=y}},{}],49:[function(e,n,a){var i=e("../utils/common"),s=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),u=1,m=2,g=0,f=-2,p=1,d=852,b=592;function h(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(E){var R;return E&&E.state?(R=E.state,E.total_in=E.total_out=R.total=0,E.msg="",R.wrap&&(E.adler=1&R.wrap),R.mode=p,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new i.Buf32(d),R.distcode=R.distdyn=new i.Buf32(b),R.sane=1,R.back=-1,g):f}function k(E){var R;return E&&E.state?((R=E.state).wsize=0,R.whave=0,R.wnext=0,y(E)):f}function $(E,R){var _,U;return E&&E.state?(U=E.state,R<0?(_=0,R=-R):(_=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?f:(U.window!==null&&U.wbits!==R&&(U.window=null),U.wrap=_,U.wbits=R,k(E))):f}function P(E,R){var _,U;return E?(U=new v,(E.state=U).window=null,(_=$(E,R))!==g&&(E.state=null),_):f}var j,I,N=!0;function T(E){if(N){var R;for(j=new i.Buf32(512),I=new i.Buf32(32),R=0;R<144;)E.lens[R++]=8;for(;R<256;)E.lens[R++]=9;for(;R<280;)E.lens[R++]=7;for(;R<288;)E.lens[R++]=8;for(c(u,E.lens,0,288,j,0,E.work,{bits:9}),R=0;R<32;)E.lens[R++]=5;c(m,E.lens,0,32,I,0,E.work,{bits:5}),N=!1}E.lencode=j,E.lenbits=9,E.distcode=I,E.distbits=5}function Q(E,R,_,U){var at,V=E.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new i.Buf8(V.wsize)),U>=V.wsize?(i.arraySet(V.window,R,_-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(U<(at=V.wsize-V.wnext)&&(at=U),i.arraySet(V.window,R,_-U,at,V.wnext),(U-=at)?(i.arraySet(V.window,R,_-U,U,0),V.wnext=U,V.whave=V.wsize):(V.wnext+=at,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=at))),0}a.inflateReset=k,a.inflateReset2=$,a.inflateResetKeep=y,a.inflateInit=function(E){return P(E,15)},a.inflateInit2=P,a.inflate=function(E,R){var _,U,at,V,it,Z,ct,z,O,st,M,K,Ct,At,vt,$t,xt,Pt,se,Yt,w,W,L,x,C=0,A=new i.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return f;(_=E.state).mode===12&&(_.mode=13),it=E.next_out,at=E.output,ct=E.avail_out,V=E.next_in,U=E.input,Z=E.avail_in,z=_.hold,O=_.bits,st=Z,M=ct,W=g;t:for(;;)switch(_.mode){case p:if(_.wrap===0){_.mode=13;break}for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(2&_.wrap&&z===35615){A[_.check=0]=255&z,A[1]=z>>>8&255,_.check=o(_.check,A,2,0),O=z=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&z)<<8)+(z>>8))%31){E.msg="incorrect header check",_.mode=30;break}if((15&z)!=8){E.msg="unknown compression method",_.mode=30;break}if(O-=4,w=8+(15&(z>>>=4)),_.wbits===0)_.wbits=w;else if(w>_.wbits){E.msg="invalid window size",_.mode=30;break}_.dmax=1<<w,E.adler=_.check=1,_.mode=512&z?10:12,O=z=0;break;case 2:for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(_.flags=z,(255&_.flags)!=8){E.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){E.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=z>>8&1),512&_.flags&&(A[0]=255&z,A[1]=z>>>8&255,_.check=o(_.check,A,2,0)),O=z=0,_.mode=3;case 3:for(;O<32;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.head&&(_.head.time=z),512&_.flags&&(A[0]=255&z,A[1]=z>>>8&255,A[2]=z>>>16&255,A[3]=z>>>24&255,_.check=o(_.check,A,4,0)),O=z=0,_.mode=4;case 4:for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.head&&(_.head.xflags=255&z,_.head.os=z>>8),512&_.flags&&(A[0]=255&z,A[1]=z>>>8&255,_.check=o(_.check,A,2,0)),O=z=0,_.mode=5;case 5:if(1024&_.flags){for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.length=z,_.head&&(_.head.extra_len=z),512&_.flags&&(A[0]=255&z,A[1]=z>>>8&255,_.check=o(_.check,A,2,0)),O=z=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(Z<(K=_.length)&&(K=Z),K&&(_.head&&(w=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),i.arraySet(_.head.extra,U,V,K,w)),512&_.flags&&(_.check=o(_.check,U,K,V)),Z-=K,V+=K,_.length-=K),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(Z===0)break t;for(K=0;w=U[V+K++],_.head&&w&&_.length<65536&&(_.head.name+=String.fromCharCode(w)),w&&K<Z;);if(512&_.flags&&(_.check=o(_.check,U,K,V)),Z-=K,V+=K,w)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(Z===0)break t;for(K=0;w=U[V+K++],_.head&&w&&_.length<65536&&(_.head.comment+=String.fromCharCode(w)),w&&K<Z;);if(512&_.flags&&(_.check=o(_.check,U,K,V)),Z-=K,V+=K,w)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;O<16;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(z!==(65535&_.check)){E.msg="header crc mismatch",_.mode=30;break}O=z=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),E.adler=_.check=0,_.mode=12;break;case 10:for(;O<32;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}E.adler=_.check=h(z),O=z=0,_.mode=11;case 11:if(_.havedict===0)return E.next_out=it,E.avail_out=ct,E.next_in=V,E.avail_in=Z,_.hold=z,_.bits=O,2;E.adler=_.check=1,_.mode=12;case 12:if(R===5||R===6)break t;case 13:if(_.last){z>>>=7&O,O-=7&O,_.mode=27;break}for(;O<3;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}switch(_.last=1&z,O-=1,3&(z>>>=1)){case 0:_.mode=14;break;case 1:if(T(_),_.mode=20,R!==6)break;z>>>=2,O-=2;break t;case 2:_.mode=17;break;case 3:E.msg="invalid block type",_.mode=30}z>>>=2,O-=2;break;case 14:for(z>>>=7&O,O-=7&O;O<32;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if((65535&z)!=(z>>>16^65535)){E.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&z,O=z=0,_.mode=15,R===6)break t;case 15:_.mode=16;case 16:if(K=_.length){if(Z<K&&(K=Z),ct<K&&(K=ct),K===0)break t;i.arraySet(at,U,V,K,it),Z-=K,V+=K,ct-=K,it+=K,_.length-=K;break}_.mode=12;break;case 17:for(;O<14;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(_.nlen=257+(31&z),z>>>=5,O-=5,_.ndist=1+(31&z),z>>>=5,O-=5,_.ncode=4+(15&z),z>>>=4,O-=4,286<_.nlen||30<_.ndist){E.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;O<3;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.lens[H[_.have++]]=7&z,z>>>=3,O-=3}for(;_.have<19;)_.lens[H[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,L={bits:_.lenbits},W=c(0,_.lens,0,19,_.lencode,0,_.work,L),_.lenbits=L.bits,W){E.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;$t=(C=_.lencode[z&(1<<_.lenbits)-1])>>>16&255,xt=65535&C,!((vt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(xt<16)z>>>=vt,O-=vt,_.lens[_.have++]=xt;else{if(xt===16){for(x=vt+2;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(z>>>=vt,O-=vt,_.have===0){E.msg="invalid bit length repeat",_.mode=30;break}w=_.lens[_.have-1],K=3+(3&z),z>>>=2,O-=2}else if(xt===17){for(x=vt+3;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}O-=vt,w=0,K=3+(7&(z>>>=vt)),z>>>=3,O-=3}else{for(x=vt+7;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}O-=vt,w=0,K=11+(127&(z>>>=vt)),z>>>=7,O-=7}if(_.have+K>_.nlen+_.ndist){E.msg="invalid bit length repeat",_.mode=30;break}for(;K--;)_.lens[_.have++]=w}}if(_.mode===30)break;if(_.lens[256]===0){E.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,L={bits:_.lenbits},W=c(u,_.lens,0,_.nlen,_.lencode,0,_.work,L),_.lenbits=L.bits,W){E.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,L={bits:_.distbits},W=c(m,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,L),_.distbits=L.bits,W){E.msg="invalid distances set",_.mode=30;break}if(_.mode=20,R===6)break t;case 20:_.mode=21;case 21:if(6<=Z&&258<=ct){E.next_out=it,E.avail_out=ct,E.next_in=V,E.avail_in=Z,_.hold=z,_.bits=O,l(E,M),it=E.next_out,at=E.output,ct=E.avail_out,V=E.next_in,U=E.input,Z=E.avail_in,z=_.hold,O=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;$t=(C=_.lencode[z&(1<<_.lenbits)-1])>>>16&255,xt=65535&C,!((vt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if($t&&!(240&$t)){for(Pt=vt,se=$t,Yt=xt;$t=(C=_.lencode[Yt+((z&(1<<Pt+se)-1)>>Pt)])>>>16&255,xt=65535&C,!(Pt+(vt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}z>>>=Pt,O-=Pt,_.back+=Pt}if(z>>>=vt,O-=vt,_.back+=vt,_.length=xt,$t===0){_.mode=26;break}if(32&$t){_.back=-1,_.mode=12;break}if(64&$t){E.msg="invalid literal/length code",_.mode=30;break}_.extra=15&$t,_.mode=22;case 22:if(_.extra){for(x=_.extra;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.length+=z&(1<<_.extra)-1,z>>>=_.extra,O-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;$t=(C=_.distcode[z&(1<<_.distbits)-1])>>>16&255,xt=65535&C,!((vt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(!(240&$t)){for(Pt=vt,se=$t,Yt=xt;$t=(C=_.distcode[Yt+((z&(1<<Pt+se)-1)>>Pt)])>>>16&255,xt=65535&C,!(Pt+(vt=C>>>24)<=O);){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}z>>>=Pt,O-=Pt,_.back+=Pt}if(z>>>=vt,O-=vt,_.back+=vt,64&$t){E.msg="invalid distance code",_.mode=30;break}_.offset=xt,_.extra=15&$t,_.mode=24;case 24:if(_.extra){for(x=_.extra;O<x;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}_.offset+=z&(1<<_.extra)-1,z>>>=_.extra,O-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){E.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ct===0)break t;if(K=M-ct,_.offset>K){if((K=_.offset-K)>_.whave&&_.sane){E.msg="invalid distance too far back",_.mode=30;break}Ct=K>_.wnext?(K-=_.wnext,_.wsize-K):_.wnext-K,K>_.length&&(K=_.length),At=_.window}else At=at,Ct=it-_.offset,K=_.length;for(ct<K&&(K=ct),ct-=K,_.length-=K;at[it++]=At[Ct++],--K;);_.length===0&&(_.mode=21);break;case 26:if(ct===0)break t;at[it++]=_.length,ct--,_.mode=21;break;case 27:if(_.wrap){for(;O<32;){if(Z===0)break t;Z--,z|=U[V++]<<O,O+=8}if(M-=ct,E.total_out+=M,_.total+=M,M&&(E.adler=_.check=_.flags?o(_.check,at,M,it-M):s(_.check,at,M,it-M)),M=ct,(_.flags?z:h(z))!==_.check){E.msg="incorrect data check",_.mode=30;break}O=z=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;O<32;){if(Z===0)break t;Z--,z+=U[V++]<<O,O+=8}if(z!==(4294967295&_.total)){E.msg="incorrect length check",_.mode=30;break}O=z=0}_.mode=29;case 29:W=1;break t;case 30:W=-3;break t;case 31:return-4;case 32:default:return f}return E.next_out=it,E.avail_out=ct,E.next_in=V,E.avail_in=Z,_.hold=z,_.bits=O,(_.wsize||M!==E.avail_out&&_.mode<30&&(_.mode<27||R!==4))&&Q(E,E.output,E.next_out,M-E.avail_out)?(_.mode=31,-4):(st-=E.avail_in,M-=E.avail_out,E.total_in+=st,E.total_out+=M,_.total+=M,_.wrap&&M&&(E.adler=_.check=_.flags?o(_.check,at,M,E.next_out-M):s(_.check,at,M,E.next_out-M)),E.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(st==0&&M===0||R===4)&&W===g&&(W=-5),W)},a.inflateEnd=function(E){if(!E||!E.state)return f;var R=E.state;return R.window&&(R.window=null),E.state=null,g},a.inflateGetHeader=function(E,R){var _;return E&&E.state&&2&(_=E.state).wrap?((_.head=R).done=!1,g):f},a.inflateSetDictionary=function(E,R){var _,U=R.length;return E&&E.state?(_=E.state).wrap!==0&&_.mode!==11?f:_.mode===11&&s(1,R,U,0)!==_.check?-3:Q(E,R,U,U)?(_.mode=31,-4):(_.havedict=1,g):f},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,a){var i=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,m,g,f,p,d,b,h){var v,y,k,$,P,j,I,N,T,Q=h.bits,E=0,R=0,_=0,U=0,at=0,V=0,it=0,Z=0,ct=0,z=0,O=null,st=0,M=new i.Buf16(16),K=new i.Buf16(16),Ct=null,At=0;for(E=0;E<=15;E++)M[E]=0;for(R=0;R<f;R++)M[m[g+R]]++;for(at=Q,U=15;1<=U&&M[U]===0;U--);if(U<at&&(at=U),U===0)return p[d++]=20971520,p[d++]=20971520,h.bits=1,0;for(_=1;_<U&&M[_]===0;_++);for(at<_&&(at=_),E=Z=1;E<=15;E++)if(Z<<=1,(Z-=M[E])<0)return-1;if(0<Z&&(u===0||U!==1))return-1;for(K[1]=0,E=1;E<15;E++)K[E+1]=K[E]+M[E];for(R=0;R<f;R++)m[g+R]!==0&&(b[K[m[g+R]]++]=R);if(j=u===0?(O=Ct=b,19):u===1?(O=s,st-=257,Ct=o,At-=257,256):(O=l,Ct=c,-1),E=_,P=d,it=R=z=0,k=-1,$=(ct=1<<(V=at))-1,u===1&&852<ct||u===2&&592<ct)return 1;for(;;){for(I=E-it,T=b[R]<j?(N=0,b[R]):b[R]>j?(N=Ct[At+b[R]],O[st+b[R]]):(N=96,0),v=1<<E-it,_=y=1<<V;p[P+(z>>it)+(y-=v)]=I<<24|N<<16|T|0,y!==0;);for(v=1<<E-1;z&v;)v>>=1;if(v!==0?(z&=v-1,z+=v):z=0,R++,--M[E]==0){if(E===U)break;E=m[g+b[R]]}if(at<E&&(z&$)!==k){for(it===0&&(it=at),P+=_,Z=1<<(V=E-it);V+it<U&&!((Z-=M[V+it])<=0);)V++,Z<<=1;if(ct+=1<<V,u===1&&852<ct||u===2&&592<ct)return 1;p[k=z&$]=at<<24|V<<16|P-d|0}}return z!==0&&(p[P+z]=E-it<<24|64<<16|0),h.bits=at,0}},{"../utils/common":41}],51:[function(e,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,a){var i=e("../utils/common"),s=0,o=1;function l(C){for(var A=C.length;0<=--A;)C[A]=0}var c=0,u=29,m=256,g=m+1+u,f=30,p=19,d=2*g+1,b=15,h=16,v=7,y=256,k=16,$=17,P=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(g+2));l(Q);var E=new Array(2*f);l(E);var R=new Array(512);l(R);var _=new Array(256);l(_);var U=new Array(u);l(U);var at,V,it,Z=new Array(f);function ct(C,A,H,G,B){this.static_tree=C,this.extra_bits=A,this.extra_base=H,this.elems=G,this.max_length=B,this.has_stree=C&&C.length}function z(C,A){this.dyn_tree=C,this.max_code=0,this.stat_desc=A}function O(C){return C<256?R[C]:R[256+(C>>>7)]}function st(C,A){C.pending_buf[C.pending++]=255&A,C.pending_buf[C.pending++]=A>>>8&255}function M(C,A,H){C.bi_valid>h-H?(C.bi_buf|=A<<C.bi_valid&65535,st(C,C.bi_buf),C.bi_buf=A>>h-C.bi_valid,C.bi_valid+=H-h):(C.bi_buf|=A<<C.bi_valid&65535,C.bi_valid+=H)}function K(C,A,H){M(C,H[2*A],H[2*A+1])}function Ct(C,A){for(var H=0;H|=1&C,C>>>=1,H<<=1,0<--A;);return H>>>1}function At(C,A,H){var G,B,X=new Array(b+1),rt=0;for(G=1;G<=b;G++)X[G]=rt=rt+H[G-1]<<1;for(B=0;B<=A;B++){var tt=C[2*B+1];tt!==0&&(C[2*B]=Ct(X[tt]++,tt))}}function vt(C){var A;for(A=0;A<g;A++)C.dyn_ltree[2*A]=0;for(A=0;A<f;A++)C.dyn_dtree[2*A]=0;for(A=0;A<p;A++)C.bl_tree[2*A]=0;C.dyn_ltree[2*y]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0}function $t(C){8<C.bi_valid?st(C,C.bi_buf):0<C.bi_valid&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0}function xt(C,A,H,G){var B=2*A,X=2*H;return C[B]<C[X]||C[B]===C[X]&&G[A]<=G[H]}function Pt(C,A,H){for(var G=C.heap[H],B=H<<1;B<=C.heap_len&&(B<C.heap_len&&xt(A,C.heap[B+1],C.heap[B],C.depth)&&B++,!xt(A,G,C.heap[B],C.depth));)C.heap[H]=C.heap[B],H=B,B<<=1;C.heap[H]=G}function se(C,A,H){var G,B,X,rt,tt=0;if(C.last_lit!==0)for(;G=C.pending_buf[C.d_buf+2*tt]<<8|C.pending_buf[C.d_buf+2*tt+1],B=C.pending_buf[C.l_buf+tt],tt++,G===0?K(C,B,A):(K(C,(X=_[B])+m+1,A),(rt=j[X])!==0&&M(C,B-=U[X],rt),K(C,X=O(--G),H),(rt=I[X])!==0&&M(C,G-=Z[X],rt)),tt<C.last_lit;);K(C,y,A)}function Yt(C,A){var H,G,B,X=A.dyn_tree,rt=A.stat_desc.static_tree,tt=A.stat_desc.has_stree,ot=A.stat_desc.elems,St=-1;for(C.heap_len=0,C.heap_max=d,H=0;H<ot;H++)X[2*H]!==0?(C.heap[++C.heap_len]=St=H,C.depth[H]=0):X[2*H+1]=0;for(;C.heap_len<2;)X[2*(B=C.heap[++C.heap_len]=St<2?++St:0)]=1,C.depth[B]=0,C.opt_len--,tt&&(C.static_len-=rt[2*B+1]);for(A.max_code=St,H=C.heap_len>>1;1<=H;H--)Pt(C,X,H);for(B=ot;H=C.heap[1],C.heap[1]=C.heap[C.heap_len--],Pt(C,X,1),G=C.heap[1],C.heap[--C.heap_max]=H,C.heap[--C.heap_max]=G,X[2*B]=X[2*H]+X[2*G],C.depth[B]=(C.depth[H]>=C.depth[G]?C.depth[H]:C.depth[G])+1,X[2*H+1]=X[2*G+1]=B,C.heap[1]=B++,Pt(C,X,1),2<=C.heap_len;);C.heap[--C.heap_max]=C.heap[1],function(_t,Zt){var Y,ft,yt,pt,Ot,jt,It=Zt.dyn_tree,Ce=Zt.max_code,oe=Zt.stat_desc.static_tree,Tt=Zt.stat_desc.has_stree,Ne=Zt.stat_desc.extra_bits,qt=Zt.stat_desc.extra_base,Kt=Zt.stat_desc.max_length,Ae=0;for(pt=0;pt<=b;pt++)_t.bl_count[pt]=0;for(It[2*_t.heap[_t.heap_max]+1]=0,Y=_t.heap_max+1;Y<d;Y++)Kt<(pt=It[2*It[2*(ft=_t.heap[Y])+1]+1]+1)&&(pt=Kt,Ae++),It[2*ft+1]=pt,Ce<ft||(_t.bl_count[pt]++,Ot=0,qt<=ft&&(Ot=Ne[ft-qt]),jt=It[2*ft],_t.opt_len+=jt*(pt+Ot),Tt&&(_t.static_len+=jt*(oe[2*ft+1]+Ot)));if(Ae!==0){do{for(pt=Kt-1;_t.bl_count[pt]===0;)pt--;_t.bl_count[pt]--,_t.bl_count[pt+1]+=2,_t.bl_count[Kt]--,Ae-=2}while(0<Ae);for(pt=Kt;pt!==0;pt--)for(ft=_t.bl_count[pt];ft!==0;)Ce<(yt=_t.heap[--Y])||(It[2*yt+1]!==pt&&(_t.opt_len+=(pt-It[2*yt+1])*It[2*yt],It[2*yt+1]=pt),ft--)}}(C,A),At(X,St,C.bl_count)}function w(C,A,H){var G,B,X=-1,rt=A[1],tt=0,ot=7,St=4;for(rt===0&&(ot=138,St=3),A[2*(H+1)+1]=65535,G=0;G<=H;G++)B=rt,rt=A[2*(G+1)+1],++tt<ot&&B===rt||(tt<St?C.bl_tree[2*B]+=tt:B!==0?(B!==X&&C.bl_tree[2*B]++,C.bl_tree[2*k]++):tt<=10?C.bl_tree[2*$]++:C.bl_tree[2*P]++,X=B,St=(tt=0)===rt?(ot=138,3):B===rt?(ot=6,3):(ot=7,4))}function W(C,A,H){var G,B,X=-1,rt=A[1],tt=0,ot=7,St=4;for(rt===0&&(ot=138,St=3),G=0;G<=H;G++)if(B=rt,rt=A[2*(G+1)+1],!(++tt<ot&&B===rt)){if(tt<St)for(;K(C,B,C.bl_tree),--tt!=0;);else B!==0?(B!==X&&(K(C,B,C.bl_tree),tt--),K(C,k,C.bl_tree),M(C,tt-3,2)):tt<=10?(K(C,$,C.bl_tree),M(C,tt-3,3)):(K(C,P,C.bl_tree),M(C,tt-11,7));X=B,St=(tt=0)===rt?(ot=138,3):B===rt?(ot=6,3):(ot=7,4)}}l(Z);var L=!1;function x(C,A,H,G){M(C,(c<<1)+(G?1:0),3),function(B,X,rt,tt){$t(B),st(B,rt),st(B,~rt),i.arraySet(B.pending_buf,B.window,X,rt,B.pending),B.pending+=rt}(C,A,H)}a._tr_init=function(C){L||(function(){var A,H,G,B,X,rt=new Array(b+1);for(B=G=0;B<u-1;B++)for(U[B]=G,A=0;A<1<<j[B];A++)_[G++]=B;for(_[G-1]=B,B=X=0;B<16;B++)for(Z[B]=X,A=0;A<1<<I[B];A++)R[X++]=B;for(X>>=7;B<f;B++)for(Z[B]=X<<7,A=0;A<1<<I[B]-7;A++)R[256+X++]=B;for(H=0;H<=b;H++)rt[H]=0;for(A=0;A<=143;)Q[2*A+1]=8,A++,rt[8]++;for(;A<=255;)Q[2*A+1]=9,A++,rt[9]++;for(;A<=279;)Q[2*A+1]=7,A++,rt[7]++;for(;A<=287;)Q[2*A+1]=8,A++,rt[8]++;for(At(Q,g+1,rt),A=0;A<f;A++)E[2*A+1]=5,E[2*A]=Ct(A,5);at=new ct(Q,j,m+1,g,b),V=new ct(E,I,0,f,b),it=new ct(new Array(0),N,0,p,v)}(),L=!0),C.l_desc=new z(C.dyn_ltree,at),C.d_desc=new z(C.dyn_dtree,V),C.bl_desc=new z(C.bl_tree,it),C.bi_buf=0,C.bi_valid=0,vt(C)},a._tr_stored_block=x,a._tr_flush_block=function(C,A,H,G){var B,X,rt=0;0<C.level?(C.strm.data_type===2&&(C.strm.data_type=function(tt){var ot,St=4093624447;for(ot=0;ot<=31;ot++,St>>>=1)if(1&St&&tt.dyn_ltree[2*ot]!==0)return s;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return o;for(ot=32;ot<m;ot++)if(tt.dyn_ltree[2*ot]!==0)return o;return s}(C)),Yt(C,C.l_desc),Yt(C,C.d_desc),rt=function(tt){var ot;for(w(tt,tt.dyn_ltree,tt.l_desc.max_code),w(tt,tt.dyn_dtree,tt.d_desc.max_code),Yt(tt,tt.bl_desc),ot=p-1;3<=ot&&tt.bl_tree[2*T[ot]+1]===0;ot--);return tt.opt_len+=3*(ot+1)+5+5+4,ot}(C),B=C.opt_len+3+7>>>3,(X=C.static_len+3+7>>>3)<=B&&(B=X)):B=X=H+5,H+4<=B&&A!==-1?x(C,A,H,G):C.strategy===4||X===B?(M(C,2+(G?1:0),3),se(C,Q,E)):(M(C,4+(G?1:0),3),function(tt,ot,St,_t){var Zt;for(M(tt,ot-257,5),M(tt,St-1,5),M(tt,_t-4,4),Zt=0;Zt<_t;Zt++)M(tt,tt.bl_tree[2*T[Zt]+1],3);W(tt,tt.dyn_ltree,ot-1),W(tt,tt.dyn_dtree,St-1)}(C,C.l_desc.max_code+1,C.d_desc.max_code+1,rt+1),se(C,C.dyn_ltree,C.dyn_dtree)),vt(C),G&&$t(C)},a._tr_tally=function(C,A,H){return C.pending_buf[C.d_buf+2*C.last_lit]=A>>>8&255,C.pending_buf[C.d_buf+2*C.last_lit+1]=255&A,C.pending_buf[C.l_buf+C.last_lit]=255&H,C.last_lit++,A===0?C.dyn_ltree[2*H]++:(C.matches++,A--,C.dyn_ltree[2*(_[H]+m+1)]++,C.dyn_dtree[2*O(A)]++),C.last_lit===C.lit_bufsize-1},a._tr_align=function(C){M(C,2,3),K(C,y,Q),function(A){A.bi_valid===16?(st(A,A.bi_buf),A.bi_buf=0,A.bi_valid=0):8<=A.bi_valid&&(A.pending_buf[A.pending++]=255&A.bi_buf,A.bi_buf>>=8,A.bi_valid-=8)}(C)}},{"../utils/common":41}],53:[function(e,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,a){(function(i){(function(s,o){if(!s.setImmediate){var l,c,u,m,g=1,f={},p=!1,d=s.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(s);b=b&&b.setTimeout?b:s,l={}.toString.call(s.process)==="[object process]"?function(k){process.nextTick(function(){v(k)})}:function(){if(s.postMessage&&!s.importScripts){var k=!0,$=s.onmessage;return s.onmessage=function(){k=!1},s.postMessage("","*"),s.onmessage=$,k}}()?(m="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",y,!1):s.attachEvent("onmessage",y),function(k){s.postMessage(m+k,"*")}):s.MessageChannel?((u=new MessageChannel).port1.onmessage=function(k){v(k.data)},function(k){u.port2.postMessage(k)}):d&&"onreadystatechange"in d.createElement("script")?(c=d.documentElement,function(k){var $=d.createElement("script");$.onreadystatechange=function(){v(k),$.onreadystatechange=null,c.removeChild($),$=null},c.appendChild($)}):function(k){setTimeout(v,0,k)},b.setImmediate=function(k){typeof k!="function"&&(k=new Function(""+k));for(var $=new Array(arguments.length-1),P=0;P<$.length;P++)$[P]=arguments[P+1];var j={callback:k,args:$};return f[g]=j,l(g),g++},b.clearImmediate=h}function h(k){delete f[k]}function v(k){if(p)setTimeout(v,0,k);else{var $=f[k];if($){p=!0;try{(function(P){var j=P.callback,I=P.args;switch(I.length){case 0:j();break;case 1:j(I[0]);break;case 2:j(I[0],I[1]);break;case 3:j(I[0],I[1],I[2]);break;default:j.apply(o,I)}})($)}finally{h(k),p=!1}}}}function y(k){k.source===s&&typeof k.data=="string"&&k.data.indexOf(m)===0&&v(+k.data.slice(m.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(qr);var Ua=qr.exports;const ar=Ma(Ua);class Wa{constructor(t,e){this.app=t,this.settings=e}get maxBackups(){var t;return((t=this.settings)==null?void 0:t.maxBackups)??5}get maxBackupAgeDays(){var t;return((t=this.settings)==null?void 0:t.maxBackupAgeDays)??30}async willExceedMaxBackups(t,e,n){const i=(await this.listBackups(t,e,n)).length,s=(n==null?void 0:n.maxBackups)??5,o=i+1;return o>s?o-s:0}async cleanupExcessBackups(t,e,n){const a=await this.listBackups(t,e,n),i=(n==null?void 0:n.maxBackups)??5;F(`${S} cleanupExcessBackups: found ${a.length} backups, max allowed: ${i}`);let s=0;if(a.length>i)for(let o=i;o<a.length;o++)F(`${S} cleanupExcessBackups: deleting backup ${o+1}/${a.length}`),await this.deleteBackup(t,e,a[o],n)&&s++;return F(`${S} cleanupExcessBackups: deleted ${s} backups`),s}async createBackup(t,e,n){try{const a=this.app.vault.getAbstractFileByPath(t);if(!a||!(a instanceof D.TFolder))return F(`${S} Draft folder not found: ${t}`),!1;const i=this.getAllFilesInFolder(a);if(i.length===0)return F(`${S} No files to backup in: ${t}`),!1;const s=t.split("/")[0]||"unknown",o=t.split("/")[1]||"drafts",l=`${Ue(n)}/${s}/${o}/${e}`;await this.app.vault.adapter.exists(l)||await this.app.vault.createFolder(l);const m=`${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}${Le}`,g=`${l}/${m}`,f=new ar;for(const b of i){const h=b.path.substring(t.length+1),v=await this.app.vault.read(b);f.file(h,v)}const p=await f.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}),d=new Uint8Array(p).buffer;return await this.app.vault.createBinary(g,d),F(`${S} Created backup: ${g}`),!0}catch(a){return F(`${S} Failed to create backup:`,a),!1}}async listBackups(t,e,n){F(`${S} listBackups called for draftFolder: ${t}, draftId: ${e}`);try{const a=t.split("/")[0]||"unknown",i=t.split("/")[1]||"drafts",s=`${Ue(n)}/${a}/${i}/${e}`;if(F(`${S} listBackups checking backupDir: ${s}`),!await this.app.vault.adapter.exists(s))return F(`${S} listBackups backupDir does not exist on disk`),[];const l=[];try{const u=await this.app.vault.adapter.list(s);F(`${S} listBackups adapter found ${u.files.length} files, ${u.folders.length} folders`);for(const m of u.files){const g=m.split("/").pop()||"";if(F(`${S} listBackups examining file: ${g}, endsWith .zip: ${g.endsWith(Le)}`),g.endsWith(Le)){const f=g.match(Gr);F(`${S} listBackups match for ${g}: ${(f==null?void 0:f[1])??"no match"}`),f&&l.push(f[1])}}}catch(u){return F(`${S} listBackups error reading backup directory: ${u}`),[]}const c=l.sort().reverse();return F(`${S} listBackups found ${c.length} backups for ${e}: [${c.join(", ")}]`),c}catch(a){return F(`${S} Failed to list backups:`,a),[]}}async restoreBackup(t,e,n,a){F(`${S} restoreBackup called for draftFolder: ${t}, draftId: ${e}, timestamp: ${n}`);try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${Ue(a)}/${i}/${s}/${e}`,l=`${n}${Le}`,c=`${o}/${l}`;if(!await this.app.vault.adapter.stat(c))return F(`${S} Backup file not found: ${c}`),!1;const m=await this.app.vault.adapter.readBinary(c),g=await ar.loadAsync(m);this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);for(const[p,d]of Object.entries(g.files))if(d.dir){const b=`${t}/${p}`;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b)}else{const b=await d.async("text"),h=`${t}/${p}`,v=h.substring(0,h.lastIndexOf("/"));this.app.vault.getAbstractFileByPath(v)||await this.app.vault.createFolder(v);const y=this.app.vault.getAbstractFileByPath(h);y&&y instanceof D.TFile?await this.app.vault.modify(y,b):await this.app.vault.create(h,b)}return F(`${S} Restored backup: ${c}`),!0}catch(i){return F(`${S} Failed to restore backup:`,i),!1}}async deleteBackup(t,e,n,a){F(`${S} deleteBackup called for draftFolder: ${t}, draftId: ${e}, timestamp: ${n}`);try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${Ue(a)}/${i}/${s}/${e}`,l=`${n}${Le}`,c=`${o}/${l}`;return await this.app.vault.adapter.stat(c)?(await this.app.vault.adapter.remove(c),F(`${S} Deleted backup: ${c}`),!0):(F(`${S} Backup file not found for deletion: ${c}`),!1)}catch(i){return F(`${S} Failed to delete backup:`,i),!1}}async clearOldBackups(t,e,n){F(`${S} clearOldBackups called for draftFolder: ${t}, draftId: ${e}`);try{const a=await this.listBackups(t,e,n),i=new Date;i.setDate(i.getDate()-this.maxBackupAgeDays);let s=0;for(const o of a)new Date(o.replace(/-/g,":"))<i&&(await this.deleteBackup(t,e,o,n),s++);F(`${S} clearOldBackups removed ${s} old backups for ${e}`)}catch(a){F(`${S} Failed to clear old backups:`,a)}}getAllFilesInFolder(t){const e=[];function n(a){for(const i of a.children)i instanceof D.TFile?e.push(i):i instanceof D.TFolder&&n(i)}return n(t),e}}class Ha{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null}async reorderChapters(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;for(let o=0;o<n.length;o++){const{chapterName:l}=n[o],c=`${s}/${l}${mt}`,u=this.app.vault.getAbstractFileByPath(c);if(u&&u instanceof D.TFile){let m=await this.app.vault.read(u);m.match(zt)&&(m=m.replace(zt,(g,f)=>{let p=f.replace(/^order:.*\n?/gm,"");return p.endsWith(`
`)||(p+=`
`),p+=`order: ${o+1}
`,`${Ft}
${p}${Ft}`}),await this.app.vault.modify(u,m))}}return!0}async listChapters(t,e){F(`${S} ChapterFileService.listChapters: projectPath=${t}, draftName=${e}`);const n=this.resolveProjectPath(t);if(!n)return F(`${S} ChapterFileService.listChapters: no project resolved`),[];const a=this.getDraftsFolderName(n);if(!a)return F(`${S} ChapterFileService.listChapters: no drafts folder found in project ${n}`),[];const i=`${n}/${a}/${e}`;F(`${S} ChapterFileService.listChapters: resolved project=${n}, draftsFolder=${a}, draftFolder=${i}`);const s=this.app.vault.getAbstractFileByPath(i),o=[];if(s&&s instanceof D.TFolder){F(`${S} ChapterFileService.listChapters: found folder with ${s.children.length} children`);for(const l of s.children)l instanceof D.TFile&&l.extension===mt.slice(1)&&(F(`${S} ChapterFileService.listChapters: processing file ${l.path}`),await Ut(async()=>{const c=await this.app.vault.read(l);if(F(`${S} ChapterFileService.listChapters: content length ${c.length}`),!this.isValidChapter(c)){F(`${S} ChapterFileService.listChapters: ${l.path} is not a valid chapter (missing required fields)`);return}const u=c.match(zt);let m,g;if(u){F(`${S} ChapterFileService.listChapters: found frontmatter`);const d=u[1].split(/\r?\n/);for(const b of d){const h=b.match(/^order:\s*(\d+)/i);h&&(m=parseInt(h[1],10));const v=b.match(/^chapter_name:\s*(.*)$/i);if(v){let y=v[1].trim();(y.startsWith('"')&&y.endsWith('"')||y.startsWith("'")&&y.endsWith("'"))&&(y=y.slice(1,-1)),y.length>0&&(g=y)}}}else F(`${S} ChapterFileService.listChapters: no frontmatter`);F(`${S} ChapterFileService.listChapters: parsed order=${m}, chapterName=${g}`);const f=g&&g.length>0?g:l.name.replace(new RegExp(`\\${mt}$`),""),p=typeof m=="number"&&!isNaN(m)?m:0;F(`${S} ChapterFileService.listChapters: adding chapter ${l.name} with name ${f}, order ${p}`),o.push({name:l.name.replace(new RegExp(`\\${mt}$`),""),chapterName:f,order:p})}))}else F(`${S} ChapterFileService.listChapters: no folder found`);return o.sort((l,c)=>l.order-c.order),F(`${S} ChapterFileService.listChapters: returning ${o.length} chapters`),o.map(({name:l,chapterName:c})=>({name:l,chapterName:c}))}async createChapter(t,e,n,a,i){F(`${S} createChapter called: chapterName=${n}, draft=${e}, draftId=${i}`);const s=this.resolveProjectPath(t);if(!s)return F(`${S} createChapter: no project resolved`),!1;const o=this.getDraftsFolderName(s);if(!o)return F(`${S} createChapter: no drafts folder found`),!1;const l=`${s}/${o}/${e}`,u=`${Xt(n,a==null?void 0:a.slugStyle)}${mt}`,m=`${l}/${u}`;if(this.app.vault.getAbstractFileByPath(m))return F(`${S} createChapter: file already exists at ${m}`),!1;let g=0,f=null;const p=this.app.vault.getAbstractFileByPath(l);if(p&&p instanceof D.TFolder)for(const y of p.children)y instanceof D.TFile&&y.extension===mt.slice(1)&&await Ut(async()=>{const k=await this.app.vault.read(y);if(this.isValidChapter(k)){const $=k.match(zt);if($){const P=$[1].split(/\r?\n/);for(const j of P){const I=j.match(/^order:\s*(\d+)/i);if(I){const N=parseInt(I[1],10);!isNaN(N)&&N>g&&(g=N)}if(!f){const N=j.match(/^id:\s*(.+)/i);N&&(f=N[1].trim())}}}}});const d=g+1;let b=`# ${n}`;const h=i||f||Re();let v=`${Ft}
id: ${h}
order: ${d}
chapter_name: ${JSON.stringify(n)}
${Ft}
`;return await this.app.vault.create(m,`${v}${b}

`),F(`${S} createChapter: created ${m} with order ${d}, chapter_name "${n}", and draft id ${h}`),!0}async deleteChapter(t,e,n){F(`${S} deleteChapter called: chapterName=${n}, draft=${e}`);const a=this.resolveProjectPath(t);if(!a)return F(`${S} deleteChapter: no project resolved`),!1;const i=this.getDraftsFolderName(a);if(!i)return F(`${S} deleteChapter: no drafts folder found`),!1;const s=`${a}/${i}/${e}`,o=`${n}${mt}`,l=`${s}/${o}`,c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof D.TFile){await this.app.vault.delete(c);const u=await this.listChapters(t,e);for(let m=0;m<u.length;m++){const{name:g}=u[m],f=`${s}/${g}${mt}`,p=this.app.vault.getAbstractFileByPath(f);if(p&&p instanceof D.TFile){let d=await this.app.vault.read(p);d.match(zt)&&(d=d.replace(zt,(b,h)=>{let v=h.replace(/^order:.*\n?/gm,"");return v.endsWith(`
`)||(v+=`
`),v+=`order: ${m+1}
`,`${Ft}
${v}${Ft}`}),await this.app.vault.modify(p,d))}}return!0}return!1}async renameChapter(t,e,n,a){F(`${S} renameChapter called: ${n} -> ${a}`);const i=this.resolveProjectPath(t);if(!i)return F(`${S} renameChapter: no project resolved`),!1;const s=this.getDraftsFolderName(i);if(!s)return F(`${S} renameChapter: no drafts folder found`),!1;const o=`${i}/${s}/${e}`,l=`${o}/${n}${mt}`,c=`${o}/${a}${mt}`,u=this.app.vault.getAbstractFileByPath(l);if(!u||!(u instanceof D.TFile))return F(`${S} renameChapter: file not found at ${l}`),!1;let m=await this.app.vault.read(u),g=`# ${a}`;return m.match(zt)&&(m=m.replace(zt,(f,p)=>{let d=p.replace(/^chapter_name:.*\n?/gm,"");return d.endsWith(`
`)||(d+=`
`),d+=`chapter_name: ${JSON.stringify(a)}
`,`${Ft}
${d}${Ft}`})),m=m.replace(/^#.*$/m,g),n!==a?(await this.app.vault.create(c,m),await this.app.vault.delete(u)):await this.app.vault.modify(u,m),!0}async openChapter(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}/${n}${mt}`,o=this.app.vault.getAbstractFileByPath(s);return o&&o instanceof D.TFile?(await Ut(async()=>{await this.app.workspace.getLeaf().openFile(o)}),!0):!1}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=Bt((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof D.TFolder){for(const i of e.children)if(i instanceof D.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}hasRequiredChapterFields(t){const e=/^id:\s*\S+/im.test(t),n=/^order:\s*\d+/im.test(t),a=/^chapter_name:\s*\S+/im.test(t);return e&&n&&a}extractChapterMetadata(t){if(!this.hasRequiredChapterFields(t))return null;let e,n,a;const i=t.split(/\r?\n/);for(const s of i){const o=s.match(/^id:\s*(.+?)$/i);o&&(e=o[1].trim());const l=s.match(/^order:\s*(\d+)/i);l&&(n=parseInt(l[1],10));const c=s.match(/^chapter_name:\s*(.*)$/i);if(c){let u=c[1].trim();(u.startsWith('"')&&u.endsWith('"')||u.startsWith("'")&&u.endsWith("'"))&&(u=u.slice(1,-1)),u.length>0&&(a=u)}}return{id:e,order:n,chapterName:a}}isValidChapter(t){const e=t.match(zt);return e?this.hasRequiredChapterFields(e[1]):!1}}class Kr{constructor(t){this.app=t,F(`${S} TemplateService created`)}async render(t,e={}){let n=t||"";return F(`${S} TemplateService.render called with template: "${n.substring(0,100)}${n.length>100?"...":""}", vars:`,Object.keys(e)),!n.includes("{{")&&!n.includes("}}")?(F(`${S} Template doesn't contain template syntax, checking if it's a file path`),await Ut(async()=>{const a=this.app.vault.getAbstractFileByPath(n);a&&a instanceof D.TFile?(F(`${S} Reading template from file: ${n}`),n=await this.app.vault.read(a),F(`${S} Template loaded from file, length: ${n.length} chars`)):F(`${S} Template path "${n}" is not a valid file, treating as inline template`)})):F(`${S} Template contains template syntax, treating as inline template`),F(`${S} Performing template variable substitution`),n=n.replace(/{{\s*(\w+(?:[-:]\w+)*)\s*}}/g,(a,i)=>{if(e[i]!==void 0)return F(`${S} Substituting variable {{${i}}} with provided value: "${e[i]}"`),e[i];try{const s=window.moment().format(i);return F(`${S} Substituting {{${i}}} with moment.js format: "${s}"`),s}catch{return F(`${S} Neither variable nor moment.js format found for {{${i}}}, returning as-is`),i}}),F(`${S} Template rendering complete, result length: ${n.length} chars`),n}}async function ke(r,t){const e=r.vault.getAbstractFileByPath(t);if(!e||!(e instanceof D.TFile))return null;try{const n=await r.vault.read(e);return Va(n)}catch(n){return F(`${S} Error reading meta file:`,n),null}}async function qn(r,t,e){const n=Za(e),a=r.vault.getAbstractFileByPath(t);a&&a instanceof D.TFile?await r.vault.modify(a,n):await r.vault.create(t,n)}async function He(r,t,e,n,a){const i=`${t}/${Gt(a)}`;let s=await ke(r,i);s||(s={version:Zr,total_drafts:0});const o=Bt(a),l=r.vault.getAbstractFileByPath(`${t}/${o}`);if(l&&l instanceof D.TFolder){const c=l.children.filter(u=>u instanceof D.TFolder);s.total_drafts=c.length}e!==void 0&&(s.current_active_draft=e,s.active_draft_last_modified=new Date().toISOString()),n&&Object.assign(s,n),s.total_drafts>0&&s.total_word_count&&(s.average_draft_word_count=Math.round(s.total_word_count/s.total_drafts)),await qn(r,i,s)}function Va(r){const t=r.match(new RegExp(`${Ft}\\s*\\n([\\s\\S]*?)\\n${Ft}`));if(!t)return null;const e=t[1],n={},a=e.split(`
`);for(const i of a){const s=i.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(s){const o=s[1];let l=s[2].trim();/^-?\d+(\.\d+)?$/.test(l)?l=Number(l):(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),n[o]=l}}return n}function Za(r){const t=[Ft];if(r.version!==void 0&&t.push(`version: "${r.version}"`),r.current_active_draft!==void 0&&t.push(`current_active_draft: "${r.current_active_draft}"`),r.current_draft_word_count!==void 0&&t.push(`current_draft_word_count: ${r.current_draft_word_count}`),t.push(`total_drafts: ${r.total_drafts}`),r.target_word_count!==void 0&&t.push(`target_word_count: ${r.target_word_count}`),r.active_draft_last_modified!==void 0&&t.push(`active_draft_last_modified: "${r.active_draft_last_modified}"`),r.total_word_count!==void 0&&t.push(`total_word_count: ${r.total_word_count}`),r.average_draft_word_count!==void 0&&t.push(`average_draft_word_count: ${r.average_draft_word_count}`),r.project_type!==void 0&&t.push(`project_type: ${r.project_type}`),t.push(Ft),t.push(""),t.push("# Project Statistics"),t.push(""),r.current_active_draft&&t.push(`**Active Draft:** ${r.current_active_draft}`),r.current_draft_word_count!==void 0&&t.push(`**Current Draft Word Count:** ${r.current_draft_word_count.toLocaleString()}`),t.push(`**Total Drafts:** ${r.total_drafts}`),r.target_word_count&&t.push(`**Target Word Count:** ${r.target_word_count.toLocaleString()}`),r.active_draft_last_modified){const e=new Date(r.active_draft_last_modified);t.push(`**Last Modified:** ${e.toLocaleString()}`)}return r.total_word_count&&t.push(`**Total Word Count:** ${r.total_word_count.toLocaleString()}`),r.average_draft_word_count&&t.push(`**Average Draft Word Count:** ${r.average_draft_word_count.toLocaleString()}`),t.push(""),t.join(`
`)}const Mn=Object.freeze(Object.defineProperty({__proto__:null,readMetaFile:ke,updateMetaStats:He,writeMetaFile:qn},Symbol.toStringTag,{value:"Module"}));class mn{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null,this.tpl=new Kr(t),this.projectFileService=new Kn(t,this)}async createProject(t,e,n,a,i){if(F(`${S} createProject called: projectName=${t}, singleFile=${e}`),!t)return F(`${S} createProject: project name is empty`),new D.Notice("Project name is required."),null;const s=a&&a!==""?`${a}/${t}`:t,o=`${s}/${Bt(i)}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);const l=`${s}/${Gt(i)}`;if(!this.app.vault.getAbstractFileByPath(l)){const u=e?Rt.SINGLE:Rt.MULTI,m=e?(i==null?void 0:i.defaultSingleTargetWordCount)??2e4:(i==null?void 0:i.defaultMultiTargetWordCount)??5e4;await He(this.app,s,void 0,{project_type:u,target_word_count:m},i)}const c=n||"Draft 1";return await this.projectFileService.drafts.createDraft(c,void 0,s,i),s}async openProject(t){var s,o;const e=`${t}/${Gt((s=this.manager)==null?void 0:s.settings)}`,n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(n),!0;const a=We((o=this.manager)==null?void 0:o.settings),i=[`${t}/${t}${mt}`,`${t}/Chapter 1${mt}`,`${t}/Chapter 01${mt}`,`${t}/${a}`,`${t}/${Bt()}/Draft 1/${a}`];for(const l of i){const c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(c),!0}return new D.Notice("Could not find a file to open in the project."),!1}listAllFolders(){const t=this.app.vault.getRoot(),e=[""];function n(a){for(const i of a.children)i instanceof D.TFolder&&(e.push(i.path),n(i))}return n(t),e}async listProjects(){const t=this.listAllFolders(),e=t.filter(a=>!!a);F(`${S} allFolders:`,t),F(`${S} filteredFolders:`,e);const n=await Se(e,a=>this.isProjectFolder(a));return F(`${S} found ${e.length} folders, ${n.length} projects:`,n),n}async getProjectType(t){const e=`${t}/${Gt()}`,n=await ke(this.app,e);if(n&&n.project_type){const a=n.project_type;if(Object.values(Rt).includes(a))return a}return null}getDraftsFolder(t){const e=`${t}/${Bt()}`;let n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof D.TFolder)return n;const a=`${t}/Drafts`;return n=this.app.vault.getAbstractFileByPath(a),n&&n instanceof D.TFolder?n:null}async getManuscriptsFolder(t){const e=`${t}/${Yn()}`,n=this.app.vault.getAbstractFileByPath(e);return n&&n instanceof D.TFolder?n:null}async isProjectFolder(t){if(!t||typeof t!="string")return F(`${S} isProjectFolder: invalid path`),!1;const e=t.trim().replace(/\\/g,"/").replace(/\/+$/,"");try{const n=D.normalizePath(`${e}/${Gt()}`),a=await this.app.vault.adapter.exists(n),i=D.normalizePath(`${e}/${Bt()}`);let s=await this.app.vault.adapter.exists(i);if(!s){const o=D.normalizePath(`${e}/Drafts`);s=await this.app.vault.adapter.exists(o)}if(!a&&!s)return F(`${S} isProjectFolder ${t}: no meta.md or drafts folder found`),!1;if(a)try{const{readMetaFile:o}=await Promise.resolve().then(()=>Mn),{VALID_PROJECT_TYPES:l}=await Promise.resolve().then(()=>Ta),c=await o(this.app,n);if(!c||!l.includes(c.project_type))return!1}catch{return!1}return!0}catch{return!1}}}class Ga{constructor(t,e,n,a){var i,s,o;this.app=t,this.tpl=new Kr(t),this.projectSvc=n,this.backupSvc=a,this.chapters=e,this.manager=((o=(s=(i=this.app.plugins).getPlugin)==null?void 0:s.call(i,"obsidian-writeaid-plugin"))==null?void 0:o.manager)??null}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=Bt((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof D.TFolder){for(const i of e.children)if(i instanceof D.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}async suggestNextDraftName(t){var i;const e=this.resolveProjectPath(t);if(!e)return"Draft 1";const n=`${e}/${Gt((i=this.manager)==null?void 0:i.settings)}`;let a=0;return await Ut(async()=>{const s=await ke(this.app,n);s&&typeof s.total_drafts=="number"&&(a=s.total_drafts)}),`Draft ${a+1}`}async createDraft(t,e,n,a){var m,g,f;F(`${S} createDraft called with draftName: ${t}, copyFromDraft: ${e}`);const i=this.resolveProjectPath(n);if(!i){F(`${S} createDraft: no project path resolved`),new D.Notice("No project folder detected. Please open a folder named after your project.");return}const o=this.getDraftsFolderName(i)||Bt((m=this.manager)==null?void 0:m.settings),l=`${i}/${o}`,c=`${l}/${t}`,u=i.split("/").pop()||i;if(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),e){F(`${S} createDraft: copying from draft ${e}`);const p=`${l}/${e}`,d=this.app.vault.getFiles().filter(v=>v.path.startsWith(p)),h=`${Xt(e,a==null?void 0:a.slugStyle)}${mt}`;for(const v of d){let y=v.path.substring(p.length+1);y===h&&(y=`${Xt(t,a==null?void 0:a.slugStyle)}${mt}`);const k=`${c}/${y}`,$=k.substring(0,k.lastIndexOf("/"));$!==c&&!this.app.vault.getAbstractFileByPath($)&&await this.app.vault.createFolder($);let P=await this.app.vault.read(v);P=Ya(P,t,u),await this.app.vault.create(k,P)}}else{if((a==null?void 0:a.includeDraftOutline)===!0){const b=(a==null?void 0:a.outlineTemplate)??"",h=await this.tpl.render(b,{draftName:t});await this.app.vault.create(`${c}/${We((g=this.manager)==null?void 0:g.settings)}`,h)}if(await this.projectSvc.getProjectType(i)===Rt.SINGLE){const h=`${Xt(t,a==null?void 0:a.slugStyle)}${mt}`,v=`${c}/${h}`;if(!this.app.vault.getAbstractFileByPath(v)){const y=Re(),k=`${Ft}
draft: ${t}
id: ${y}
project: ${u}
created: ${new Date().toISOString()}
${Ft}

`,$=await this.tpl.render("# {{draftName}}",{draftName:t});await this.app.vault.create(v,k+$)}}else{const b=this.app.vault.getAbstractFileByPath(c);let h=!1;if(b&&b instanceof D.TFolder){for(const v of b.children)if(v instanceof D.TFile&&v.extension===mt.slice(1)&&(await Ut(async()=>{const y=await this.app.vault.read(v);this.chapters.isValidChapter(y)&&(h=!0)}),h))break}if(!h){const v=Re();await this.chapters.createChapter(i,t,"Chapter 1",a,v)}}}await He(this.app,i,t,void 0,(f=this.manager)==null?void 0:f.settings)}listDrafts(t){var a;const e=this.resolveProjectPath(t);if(F(`${S} listDrafts called with projectPath:`,t,"resolved to:",e),!e)return[];const n=this.projectSvc.getDraftsFolder(e);if(F(`${S} getDraftsFolder for ${e} returned:`,n==null?void 0:n.path,(a=n==null?void 0:n.children)==null?void 0:a.length),n&&n instanceof D.TFolder){const i=n.children.filter(s=>s instanceof D.TFolder).map(s=>s.name);return F(`${S} found drafts:`,i),i}return[]}async getDraftId(t){F(`${S} getDraftId called for draftFolder: ${t}`);try{const e=this.app.vault.getFiles().filter(n=>n.path.startsWith(t));for(const n of e)if(n.extension===mt.slice(1)){const i=(await this.app.vault.read(n)).match(zt);if(i){const o=i[1].match(/^id:\s*(.+?)$/m);if(o){const l=o[1].trim();return F(`${S} getDraftId found: ${l}`),l}}}return F(`${S} getDraftId: no draft ID found in ${t}`),null}catch(e){return F(`${S} getDraftId error:`,e),null}}async ensureChaptersDraftId(t,e){const n=this.resolveProjectPath(t);if(!n)return;const a=this.getDraftsFolderName(n);if(!a)return;const i=`${n}/${a}/${e}`,s=await this.getDraftId(i);if(!s){F(`${S} ensureChaptersDraftId: no draft ID found for draft ${e}`);return}try{const o=this.app.vault.getFiles().filter(l=>l.path.startsWith(i));for(const l of o)if(l.extension===mt.slice(1)){const c=await this.app.vault.read(l),u=c.match(zt);if(u){const m=u[1];if(!m.match(/^id:\s*/m)){const g=c.substring(u[0].length),f=m.split(`
`);f.push(`id: ${s}`);const p=f.join(`
`),d=`${Ft}
${p}
${Ft}${g}`;await this.app.vault.modify(l,d),F(`${S} ensureChaptersDraftId: added draft ID to ${l.path}`)}}}}catch(o){F(`${S} ensureChaptersDraftId error:`,o)}}async openDraft(t,e){var u,m,g,f;const n=this.resolveProjectPath(t);if(!n)return!1;const a=this.getDraftsFolderName(n);if(!a)return!1;const i=`${n}/${Gt((u=this.manager)==null?void 0:u.settings)}`,s=await ke(this.app,i);if(((s==null?void 0:s.project_type)||Rt.MULTI)===Rt.SINGLE){const p=Xt(e,(g=(m=this.manager)==null?void 0:m.settings)==null?void 0:g.slugStyle),d=`${n}/${a}/${e}/${p}${mt}`,b=this.app.vault.getAbstractFileByPath(d);if(b&&b instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(b),!0}else{const p=await this.chapters.listChapters(n,e);if(p.length>0){const d=p[p.length-1],b=`${n}/${a}/${e}/${d.name}${mt}`,h=this.app.vault.getAbstractFileByPath(b);if(h&&h instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(h),!0}}const l=`${n}/${a}/${e}/${We((f=this.manager)==null?void 0:f.settings)}`,c=this.app.vault.getAbstractFileByPath(l);return c&&c instanceof D.TFile?(await this.app.workspace.getLeaf().openFile(c),!0):!1}async renameDraft(t,e,n,a=!1,i){var u;F(`${S} renameDraft called: ${e} -> ${n}, renameFile: ${a}`);const s=this.resolveProjectPath(t);if(!s)return F(`${S} renameDraft: no project resolved`),!1;const o=this.getDraftsFolderName(s);if(!o)return F(`${S} renameDraft: no drafts folder found`),!1;const l=`${s}/${o}/${e}`,c=`${s}/${o}/${n}`;try{this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c);const m=this.app.vault.getFiles().filter(h=>h.path.startsWith(l));let g="";if(a){const h=i==null?void 0:i.slugStyle;g=Xt(n,h)}let f=null;for(const h of m){const v=h.path.substring(l.length+1);if(h.extension===mt.slice(1)&&!v.includes("/")){f=h;break}}for(const h of m){let v=h.path.substring(l.length+1),y=`${c}/${v}`;a&&g&&h===f&&!v.includes("/")&&(v=`${g}${mt}`,y=`${c}/${v}`);let k=await this.app.vault.read(h);h.extension===mt.slice(1)&&(k=k.replace(new RegExp(`^(${Ft}\\s*\\n[\\s\\S]*?\\n)(draft:.*\\n)?`,"m"),($,P)=>P.replace(/^draft:.*\n/m,"").replace(new RegExp(`^(${Ft}\\s*\\n)`),`$1draft: ${n}
`))),await this.app.vault.create(y,k),await this.app.vault.delete(h)}const p=this.app.vault.getAbstractFileByPath(l);p&&p instanceof D.TFolder&&await this.app.vault.delete(p,!0),await Ut(async()=>{await Promise.resolve().then(()=>Mn).then(h=>{var v;return h.updateMetaStats(this.app,s,n,void 0,(v=this.manager)==null?void 0:v.settings)})});const d=`${c}/${Gt((u=this.manager)==null?void 0:u.settings)}`;return this.app.vault.getAbstractFileByPath(d)&&await Ut(async()=>{const{readMetaFile:h,writeMetaFile:v}=await Promise.resolve().then(()=>Mn),y=await h(this.app,d);y&&(y.draft=n,await v(this.app,d,y))}),!0}catch{return!1}}async deleteDraft(t,e,n=!0){var o;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;try{const l=this.app.vault.getFiles().filter(u=>u.path.startsWith(s));if(n){const u=await this.getDraftId(s);u&&await this.backupSvc.createBackup(s,u,(o=this.manager)==null?void 0:o.settings)}for(const u of l)await Ut(async()=>{await this.app.vault.delete(u)});const c=this.app.vault.getAbstractFileByPath(s);return c&&c instanceof D.TFolder&&await Ut(async()=>{await this.app.vault.delete(c)}),!0}catch{return!1}}async generateManuscript(t,e,n){var d;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=await this.projectSvc.getProjectType(a),o=`${a}/${i}/${e}`;if(!this.app.vault.getAbstractFileByPath(o))return new D.Notice(`Draft folder ${o} does not exist.`),!1;const l=`${a}/${Yn((d=this.manager)==null?void 0:d.settings)}`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);const c=a.split("/").pop()||a,u=(n==null?void 0:n.manuscriptNameTemplate)||"{{draftName}}";F(`${S} DraftFileService.generateManuscript - manuscriptNameTemplate: "${u}"`),F(`${S} DraftFileService.generateManuscript - settings object:`,n);const m=Xt(e,n==null?void 0:n.slugStyle),g=await this.tpl.render(u,{draftName:e,projectName:c,draftSlug:m}),f=`${l}/${g}${mt}`;let p=`# Manuscript for ${e}

`;if(s===Rt.SINGLE){const b=`${m}${mt}`,h=`${o}/${b}`,v=this.app.vault.getAbstractFileByPath(h);if(v&&v instanceof D.TFile){const y=await this.app.vault.read(v);p+=ir(un(y));const k=this.app.vault.getAbstractFileByPath(f);if(k&&k instanceof D.TFile){if(!await new Ln(this.app,f).open())return!1;F(`${S} Overwriting existing manuscript: ${f}`),await this.app.vault.modify(k,p)}else F(`${S} Creating new manuscript: ${f}`),await this.app.vault.create(f,p)}else return new D.Notice(`Main draft file ${h} not found.`),!1}else if(s===Rt.MULTI){const b=await this.chapters.listChapters(a,e);if(b.length===0)return new D.Notice("No chapters found in draft."),!1;for(const v of b){const y=`${o}/${v.name}${mt}`,k=this.app.vault.getAbstractFileByPath(y);if(k&&k instanceof D.TFile){const $=await this.app.vault.read(k),P=v.chapterName||v.name;p+=`## ${P}

`,p+=ir(un($)),p+=`

`}}const h=this.app.vault.getAbstractFileByPath(f);if(h&&h instanceof D.TFile){if(!await new Ln(this.app,f).open())return!1;F(`${S} Overwriting existing manuscript: ${f}`),await this.app.vault.modify(h,p)}else F(`${S} Creating new manuscript: ${f}`),await this.app.vault.create(f,p)}return!0}getOutlineFile(t,e){var o;const n=this.resolveProjectPath(t);if(!n)return null;const a=this.getDraftsFolderName(n);if(!a)return null;const i=`${n}/${a}/${e}/${We((o=this.manager)==null?void 0:o.settings)}`,s=this.app.vault.getAbstractFileByPath(i);return s&&s instanceof D.TFile?s:null}async createOutline(t,e,n){var u;const a=this.resolveProjectPath(t);if(!a)throw new Error("Project not found");const i=this.getDraftsFolderName(a);if(!i)throw new Error("Drafts folder not found");const o=`${`${a}/${i}/${e}`}/${We((u=this.manager)==null?void 0:u.settings)}`;if(this.app.vault.getAbstractFileByPath(o))throw new Error("Outline file already exists");const c=await this.tpl.render(n,{draftName:e});await this.app.vault.create(o,c)}async calculateDraftWordCount(t,e){var a,i,s;const n=this.resolveProjectPath(t);if(!n)return F(`${S} No project path found for word count calculation`),0;try{const o=this.getDraftsFolderName(n);if(!o)return F(`${S} No drafts folder found in project`),0;const l=`${n}/${o}/${e}`,c=this.app.vault.getAbstractFileByPath(n);if(!c||!(c instanceof D.TFolder))return F(`${S} Project folder not found at: ${n}`),0;const u=`${n}/${Gt((a=this.manager)==null?void 0:a.settings)}`,m=await ke(this.app,u),g=(m==null?void 0:m.project_type)||Rt.MULTI;if(F(`${S} Calculating word count for ${g} project, draft: ${e}`),g===Rt.SINGLE){const f=Xt(e,(s=(i=this.manager)==null?void 0:i.settings)==null?void 0:s.slugStyle),p=`${l}/${f}${mt}`,d=this.app.vault.getAbstractFileByPath(p);if(F(`${S} Looking for single-file draft at: ${p}`),d&&d instanceof D.TFile){const b=await this.app.vault.read(d),h=un(b),v=zn(h);return F(`${S} Single-file draft word count: ${v}`),v}F(`${S} Draft file not found for single-file project`)}else{const f=this.app.vault.getAbstractFileByPath(l);if(!f||!(f instanceof D.TFolder))return F(`${S} Draft folder not found at: ${l}`),0;let p=0;for(const d of f.children)if(d instanceof D.TFile&&d.extension==="md"){const b=await this.app.vault.read(d);if(this.chapters.isValidChapter(b)){const h=un(b),v=zn(h);F(`${S} Chapter "${d.name}" word count: ${v}`),p+=v}}return F(`${S} Multi-file draft total word count: ${p}`),p}}catch(o){F(`${S} Error calculating draft word count:`,o)}return 0}}function un(r){return r.replace(zt,"").trim()}function ir(r){return r.replace(/^#{1,6} .*\n/,"").trim()}function Ya(r,t,e){const n=r.match(zt);if(!n)return r;const a=n[1],i=r.substring(n[0].length),s=a.split(`
`),o=[];let l=!1;for(const u of s)u.match(/^draft:/i)?o.push(`draft: ${t}`):u.match(/^id:/i)?(o.push(`id: ${Re()}`),l=!0):u.match(/^project:/i)?o.push(`project: ${e}`):u.match(/^created:/i)?o.push(`created: ${new Date().toISOString()}`):o.push(u);l||o.push(`id: ${Re()}`);const c=o.join(`
`);return`${Ft}
${c}
${Ft}${i}`}class Kn{constructor(t,e,n){this.chapters=new Ha(t),this.backups=new Wa(t,n),this.drafts=new Ga(t,this.chapters,e,this.backups)}}function Dt(){}const qa=r=>r;function kt(r,t){for(const e in t)r[e]=t[e];return r}function Xr(r){return r()}function sr(){return Object.create(null)}function Pe(r){r.forEach(Xr)}function sn(r){return typeof r=="function"}function Lt(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function Ka(r){return Object.keys(r).length===0}function ne(r,t,e,n){if(r){const a=Jr(r,t,e,n);return r[0](a)}}function Jr(r,t,e,n){return r[1]&&n?kt(e.ctx.slice(),r[1](n(t))):e.ctx}function re(r,t,e,n){return r[2],t.dirty}function ae(r,t,e,n,a,i){if(a){const s=Jr(t,e,n,i);r.p(s,a)}}function ie(r){if(r.ctx.length>32){const t=[],e=r.ctx.length/32;for(let n=0;n<e;n++)t[n]=-1;return t}return-1}function Nt(r){const t={};for(const e in r)e[0]!=="$"&&(t[e]=r[e]);return t}function or(r,t){const e={};t=new Set(t);for(const n in r)!t.has(n)&&n[0]!=="$"&&(e[n]=r[n]);return e}const Qr=typeof window<"u";let Xa=Qr?()=>window.performance.now():()=>Date.now(),Xn=Qr?r=>requestAnimationFrame(r):Dt;const Ve=new Set;function ta(r){Ve.forEach(t=>{t.c(r)||(Ve.delete(t),t.f())}),Ve.size!==0&&Xn(ta)}function Ja(r){let t;return Ve.size===0&&Xn(ta),{promise:new Promise(e=>{Ve.add(t={c:r,f:e})}),abort(){Ve.delete(t)}}}function nt(r,t){r.appendChild(t)}function ea(r){if(!r)return document;const t=r.getRootNode?r.getRootNode():r.ownerDocument;return t&&t.host?t:r.ownerDocument}function Qa(r){const t=lt("style");return t.textContent="/* empty */",ti(ea(r),t),t.sheet}function ti(r,t){return nt(r.head||r,t),t.sheet}function bt(r,t,e){r.insertBefore(t,e||null)}function gt(r){r.parentNode&&r.parentNode.removeChild(r)}function na(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function lt(r){return document.createElement(r)}function ra(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Wt(r){return document.createTextNode(r)}function wt(){return Wt(" ")}function $n(){return Wt("")}function me(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function et(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function gn(r,t){for(const e in t)et(r,e,t[e])}function ei(r){return Array.from(r.childNodes)}function Je(r,t){t=""+t,r.data!==t&&(r.data=t)}function wn(r,t){r.value=t??""}function Fe(r,t,e,n){e==null?r.style.removeProperty(t):r.style.setProperty(t,e,"")}function le(r,t,e){r.classList.toggle(t,!!e)}function ni(r,t,{bubbles:e=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:t,bubbles:e,cancelable:n})}const vn=new Map;let bn=0;function ri(r){let t=5381,e=r.length;for(;e--;)t=(t<<5)-t^r.charCodeAt(e);return t>>>0}function ai(r,t){const e={stylesheet:Qa(t),rules:{}};return vn.set(r,e),e}function ii(r,t,e,n,a,i,s,o=0){const l=16.666/n;let c=`{
`;for(let b=0;b<=1;b+=l){const h=t+(e-t)*i(b);c+=b*100+`%{${s(h,1-h)}}
`}const u=c+`100% {${s(e,1-e)}}
}`,m=`__svelte_${ri(u)}_${o}`,g=ea(r),{stylesheet:f,rules:p}=vn.get(g)||ai(g,r);p[m]||(p[m]=!0,f.insertRule(`@keyframes ${m} ${u}`,f.cssRules.length));const d=r.style.animation||"";return r.style.animation=`${d?`${d}, `:""}${m} ${n}ms linear ${a}ms 1 both`,bn+=1,m}function si(r,t){const e=(r.style.animation||"").split(", "),n=e.filter(t?i=>i.indexOf(t)<0:i=>i.indexOf("__svelte")===-1),a=e.length-n.length;a&&(r.style.animation=n.join(", "),bn-=a,bn||oi())}function oi(){Xn(()=>{bn||(vn.forEach(r=>{const{ownerNode:t}=r.stylesheet;t&&gt(t)}),vn.clear())})}function li(r,t,e,n){if(!t)return Dt;const a=r.getBoundingClientRect();if(t.left===a.left&&t.right===a.right&&t.top===a.top&&t.bottom===a.bottom)return Dt;const{delay:i=0,duration:s=300,easing:o=qa,start:l=Xa()+i,end:c=l+s,tick:u=Dt,css:m}=e(r,{from:t,to:a},n);let g=!0,f=!1,p;function d(){m&&(p=ii(r,0,1,s,i,o,m)),i||(f=!0)}function b(){m&&si(r,p),g=!1}return Ja(h=>{if(!f&&h>=l&&(f=!0),f&&h>=c&&(u(1,0),b()),!g)return!1;if(f){const v=h-l,y=0+1*o(v/s);u(y,1-y)}return!0}),d(),u(0,1),b}function ci(r){const t=getComputedStyle(r);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:e,height:n}=t,a=r.getBoundingClientRect();r.style.position="absolute",r.style.width=e,r.style.height=n,fi(r,a)}}function fi(r,t){const e=r.getBoundingClientRect();if(t.left!==e.left||t.top!==e.top){const n=getComputedStyle(r),a=n.transform==="none"?"":n.transform;r.style.transform=`${a} translate(${t.left-e.left}px, ${t.top-e.top}px)`}}let an;function nn(r){an=r}function Jn(){if(!an)throw new Error("Function called outside component initialization");return an}function ui(r){Jn().$$.on_mount.push(r)}function Un(r){Jn().$$.on_destroy.push(r)}function di(){const r=Jn();return(t,e,{cancelable:n=!1}={})=>{const a=r.$$.callbacks[t];if(a){const i=ni(t,e,{cancelable:n});return a.slice().forEach(s=>{s.call(r,i)}),!i.defaultPrevented}return!0}}const Me=[],rn=[];let Ze=[];const lr=[],hi=Promise.resolve();let Wn=!1;function pi(){Wn||(Wn=!0,hi.then(aa))}function Hn(r){Ze.push(r)}const Pn=new Set;let ze=0;function aa(){if(ze!==0)return;const r=an;do{try{for(;ze<Me.length;){const t=Me[ze];ze++,nn(t),mi(t.$$)}}catch(t){throw Me.length=0,ze=0,t}for(nn(null),Me.length=0,ze=0;rn.length;)rn.pop()();for(let t=0;t<Ze.length;t+=1){const e=Ze[t];Pn.has(e)||(Pn.add(e),e())}Ze.length=0}while(Me.length);for(;lr.length;)lr.pop()();Wn=!1,Pn.clear(),nn(r)}function mi(r){if(r.fragment!==null){r.update(),Pe(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Hn)}}function gi(r){const t=[],e=[];Ze.forEach(n=>r.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),Ze=t}const hn=new Set;let Be;function Qt(){Be={r:0,c:[],p:Be}}function te(){Be.r||Pe(Be.c),Be=Be.p}function q(r,t){r&&r.i&&(hn.delete(r),r.i(t))}function J(r,t,e,n){if(r&&r.o){if(hn.has(r))return;hn.add(r),Be.c.push(()=>{hn.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}function xe(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function wi(r,t){r.d(1),t.delete(r.key)}function vi(r,t){J(r,1,1,()=>{t.delete(r.key)})}function bi(r,t){r.f(),vi(r,t)}function ia(r,t,e,n,a,i,s,o,l,c,u,m){let g=r.length,f=i.length,p=g;const d={};for(;p--;)d[r[p].key]=p;const b=[],h=new Map,v=new Map,y=[];for(p=f;p--;){const j=m(a,i,p),I=e(j);let N=s.get(I);N?y.push(()=>N.p(j,t)):(N=c(I,j),N.c()),h.set(I,b[p]=N),I in d&&v.set(I,Math.abs(p-d[I]))}const k=new Set,$=new Set;function P(j){q(j,1),j.m(o,u),s.set(j.key,j),u=j.first,f--}for(;g&&f;){const j=b[f-1],I=r[g-1],N=j.key,T=I.key;j===I?(u=j.first,g--,f--):h.has(T)?!s.has(N)||k.has(N)?P(j):$.has(T)?g--:v.get(N)>v.get(T)?($.add(N),P(j)):(k.add(T),g--):(l(I,s),g--)}for(;g--;){const j=r[g];h.has(j.key)||l(j,s)}for(;f;)P(b[f-1]);return Pe(y),b}function fe(r,t){const e={},n={},a={$$scope:1};let i=r.length;for(;i--;){const s=r[i],o=t[i];if(o){for(const l in s)l in o||(n[l]=1);for(const l in o)a[l]||(e[l]=o[l],a[l]=1);r[i]=o}else for(const l in s)a[l]=1}for(const s in n)s in e||(e[s]=void 0);return e}function we(r){return typeof r=="object"&&r!==null?r:{}}function ht(r){r&&r.c()}function ut(r,t,e){const{fragment:n,after_update:a}=r.$$;n&&n.m(t,e),Hn(()=>{const i=r.$$.on_mount.map(Xr).filter(sn);r.$$.on_destroy?r.$$.on_destroy.push(...i):Pe(i),r.$$.on_mount=[]}),a.forEach(Hn)}function dt(r,t){const e=r.$$;e.fragment!==null&&(gi(e.after_update),Pe(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function _i(r,t){r.$$.dirty[0]===-1&&(Me.push(r),pi(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function Ht(r,t,e,n,a,i,s=null,o=[-1]){const l=an;nn(r);const c=r.$$={fragment:null,ctx:[],props:i,update:Dt,not_equal:a,bound:sr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:sr(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let u=!1;if(c.ctx=e?e(r,t.props||{},(m,g,...f)=>{const p=f.length?f[0]:g;return c.ctx&&a(c.ctx[m],c.ctx[m]=p)&&(!c.skip_bound&&c.bound[m]&&c.bound[m](p),u&&_i(r,m)),g}):[],c.update(),u=!0,Pe(c.before_update),c.fragment=n?n(c.ctx):!1,t.target){if(t.hydrate){const m=ei(t.target);c.fragment&&c.fragment.l(m),m.forEach(gt)}else c.fragment&&c.fragment.c();t.intro&&q(r.$$.fragment),ut(r,t.target,t.anchor),aa()}nn(l)}class Vt{constructor(){Dn(this,"$$");Dn(this,"$$set")}$destroy(){dt(this,1),this.$destroy=Dt}$on(t,e){if(!sn(e))return Dt;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const a=n.indexOf(e);a!==-1&&n.splice(a,1)}}$set(t){this.$$set&&!Ka(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const yi="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yi);function ki(r){let t,e,n,a,i;const s=r[6].default,o=ne(s,r,r[5],null);return{c(){t=lt("button"),o&&o.c(),et(t,"class",e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`),et(t,"aria-label",r[3]),t.disabled=r[1],et(t,"style",r[2])},m(l,c){bt(l,t,c),o&&o.m(t,null),n=!0,a||(i=me(t,"click",function(){sn(r[4])&&r[4].apply(this,arguments)}),a=!0)},p(l,[c]){r=l,o&&o.p&&(!n||c&32)&&ae(o,s,r,r[5],n?re(s,r[5],c,null):ie(r[5]),null),(!n||c&1&&e!==(e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`))&&et(t,"class",e),(!n||c&8)&&et(t,"aria-label",r[3]),(!n||c&2)&&(t.disabled=r[1]),(!n||c&4)&&et(t,"style",r[2])},i(l){n||(q(o,l),n=!0)},o(l){J(o,l),n=!1},d(l){l&&gt(t),o&&o.d(l),a=!1,i()}}}function $i(r,t,e){let{$$slots:n={},$$scope:a}=t,{variant:i="default"}=t,{disabled:s=!1}=t,{style:o=""}=t,{title:l=""}=t,{clickHandler:c=void 0}=t;return r.$$set=u=>{"variant"in u&&e(0,i=u.variant),"disabled"in u&&e(1,s=u.disabled),"style"in u&&e(2,o=u.style),"title"in u&&e(3,l=u.title),"clickHandler"in u&&e(4,c=u.clickHandler),"$$scope"in u&&e(5,a=u.$$scope)},[i,s,o,l,c,a,n]}class $e extends Vt{constructor(t){super(),Ht(this,t,$i,ki,Lt,{variant:0,disabled:1,style:2,title:3,clickHandler:4})}}function Ci(r){let t,e,n,a,i;const s=r[7].default,o=ne(s,r,r[6],null);return{c(){t=lt("button"),o&&o.c(),et(t,"class",e=`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""} ${r[5]?"spinning":""}`),et(t,"aria-label",r[0]),t.disabled=r[2],et(t,"title",r[3])},m(l,c){bt(l,t,c),o&&o.m(t,null),n=!0,a||(i=me(t,"click",function(){sn(r[4])&&r[4].apply(this,arguments)}),a=!0)},p(l,[c]){r=l,o&&o.p&&(!n||c&64)&&ae(o,s,r,r[6],n?re(s,r[6],c,null):ie(r[6]),null),(!n||c&34&&e!==(e=`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""} ${r[5]?"spinning":""}`))&&et(t,"class",e),(!n||c&1)&&et(t,"aria-label",r[0]),(!n||c&4)&&(t.disabled=r[2]),(!n||c&8)&&et(t,"title",r[3])},i(l){n||(q(o,l),n=!0)},o(l){J(o,l),n=!1},d(l){l&&gt(t),o&&o.d(l),a=!1,i()}}}function Si(r,t,e){let{$$slots:n={},$$scope:a}=t,{ariaLabel:i=""}=t,{variant:s="default"}=t,{disabled:o=!1}=t,{title:l}=t,{clickHandler:c=void 0}=t,{spinning:u=!1}=t;return r.$$set=m=>{"ariaLabel"in m&&e(0,i=m.ariaLabel),"variant"in m&&e(1,s=m.variant),"disabled"in m&&e(2,o=m.disabled),"title"in m&&e(3,l=m.title),"clickHandler"in m&&e(4,c=m.clickHandler),"spinning"in m&&e(5,u=m.spinning),"$$scope"in m&&e(6,a=m.$$scope)},[i,s,o,l,c,u,a,n]}class ce extends Vt{constructor(t){super(),Ht(this,t,Si,Ci,Lt,{ariaLabel:0,variant:1,disabled:2,title:3,clickHandler:4,spinning:5})}}const Ye=Math.min,Jt=Math.max,_n=Math.round,dn=Math.floor,pe=r=>({x:r,y:r}),Fi={left:"right",right:"left",bottom:"top",top:"bottom"},xi={start:"end",end:"start"};function cr(r,t,e){return Jt(r,Ye(t,e))}function on(r,t){return typeof r=="function"?r(t):r}function Ee(r){return r.split("-")[0]}function ln(r){return r.split("-")[1]}function sa(r){return r==="x"?"y":"x"}function oa(r){return r==="y"?"height":"width"}const Ei=new Set(["top","bottom"]);function ye(r){return Ei.has(Ee(r))?"y":"x"}function la(r){return sa(ye(r))}function Di(r,t,e){e===void 0&&(e=!1);const n=ln(r),a=la(r),i=oa(a);let s=a==="x"?n===(e?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=yn(s)),[s,yn(s)]}function Pi(r){const t=yn(r);return[Vn(r),t,Vn(t)]}function Vn(r){return r.replace(/start|end/g,t=>xi[t])}const fr=["left","right"],ur=["right","left"],ji=["top","bottom"],Ni=["bottom","top"];function Ai(r,t,e){switch(r){case"top":case"bottom":return e?t?ur:fr:t?fr:ur;case"left":case"right":return t?ji:Ni;default:return[]}}function Ti(r,t,e,n){const a=ln(r);let i=Ai(Ee(r),e==="start",n);return a&&(i=i.map(s=>s+"-"+a),t&&(i=i.concat(i.map(Vn)))),i}function yn(r){return r.replace(/left|right|bottom|top/g,t=>Fi[t])}function Bi(r){return{top:0,right:0,bottom:0,left:0,...r}}function Oi(r){return typeof r!="number"?Bi(r):{top:r,right:r,bottom:r,left:r}}function kn(r){const{x:t,y:e,width:n,height:a}=r;return{width:n,height:a,top:e,left:t,right:t+n,bottom:e+a,x:t,y:e}}function dr(r,t,e){let{reference:n,floating:a}=r;const i=ye(t),s=la(t),o=oa(s),l=Ee(t),c=i==="y",u=n.x+n.width/2-a.width/2,m=n.y+n.height/2-a.height/2,g=n[o]/2-a[o]/2;let f;switch(l){case"top":f={x:u,y:n.y-a.height};break;case"bottom":f={x:u,y:n.y+n.height};break;case"right":f={x:n.x+n.width,y:m};break;case"left":f={x:n.x-a.width,y:m};break;default:f={x:n.x,y:n.y}}switch(ln(t)){case"start":f[s]-=g*(e&&c?-1:1);break;case"end":f[s]+=g*(e&&c?-1:1);break}return f}const Ri=async(r,t,e)=>{const{placement:n="bottom",strategy:a="absolute",middleware:i=[],platform:s}=e,o=i.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(t));let c=await s.getElementRects({reference:r,floating:t,strategy:a}),{x:u,y:m}=dr(c,n,l),g=n,f={},p=0;for(let d=0;d<o.length;d++){const{name:b,fn:h}=o[d],{x:v,y,data:k,reset:$}=await h({x:u,y:m,initialPlacement:n,placement:g,strategy:a,middlewareData:f,rects:c,platform:s,elements:{reference:r,floating:t}});u=v??u,m=y??m,f={...f,[b]:{...f[b],...k}},$&&p<=50&&(p++,typeof $=="object"&&($.placement&&(g=$.placement),$.rects&&(c=$.rects===!0?await s.getElementRects({reference:r,floating:t,strategy:a}):$.rects),{x:u,y:m}=dr(c,g,l)),d=-1)}return{x:u,y:m,placement:g,strategy:a,middlewareData:f}};async function Qn(r,t){var e;t===void 0&&(t={});const{x:n,y:a,platform:i,rects:s,elements:o,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:m="floating",altBoundary:g=!1,padding:f=0}=on(t,r),p=Oi(f),b=o[g?m==="floating"?"reference":"floating":m],h=kn(await i.getClippingRect({element:(e=await(i.isElement==null?void 0:i.isElement(b)))==null||e?b:b.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:c,rootBoundary:u,strategy:l})),v=m==="floating"?{x:n,y:a,width:s.floating.width,height:s.floating.height}:s.reference,y=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),k=await(i.isElement==null?void 0:i.isElement(y))?await(i.getScale==null?void 0:i.getScale(y))||{x:1,y:1}:{x:1,y:1},$=kn(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:v,offsetParent:y,strategy:l}):v);return{top:(h.top-$.top+p.top)/k.y,bottom:($.bottom-h.bottom+p.bottom)/k.y,left:(h.left-$.left+p.left)/k.x,right:($.right-h.right+p.right)/k.x}}const Ii=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var e,n;const{placement:a,middlewareData:i,rects:s,initialPlacement:o,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:m=!0,fallbackPlacements:g,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:d=!0,...b}=on(r,t);if((e=i.arrow)!=null&&e.alignmentOffset)return{};const h=Ee(a),v=ye(o),y=Ee(o)===o,k=await(l.isRTL==null?void 0:l.isRTL(c.floating)),$=g||(y||!d?[yn(o)]:Pi(o)),P=p!=="none";!g&&P&&$.push(...Ti(o,d,p,k));const j=[o,...$],I=await Qn(t,b),N=[];let T=((n=i.flip)==null?void 0:n.overflows)||[];if(u&&N.push(I[h]),m){const _=Di(a,s,k);N.push(I[_[0]],I[_[1]])}if(T=[...T,{placement:a,overflows:N}],!N.every(_=>_<=0)){var Q,E;const _=(((Q=i.flip)==null?void 0:Q.index)||0)+1,U=j[_];if(U&&(!(m==="alignment"?v!==ye(U):!1)||T.every(it=>ye(it.placement)===v?it.overflows[0]>0:!0)))return{data:{index:_,overflows:T},reset:{placement:U}};let at=(E=T.filter(V=>V.overflows[0]<=0).sort((V,it)=>V.overflows[1]-it.overflows[1])[0])==null?void 0:E.placement;if(!at)switch(f){case"bestFit":{var R;const V=(R=T.filter(it=>{if(P){const Z=ye(it.placement);return Z===v||Z==="y"}return!0}).map(it=>[it.placement,it.overflows.filter(Z=>Z>0).reduce((Z,ct)=>Z+ct,0)]).sort((it,Z)=>it[1]-Z[1])[0])==null?void 0:R[0];V&&(at=V);break}case"initialPlacement":at=o;break}if(a!==at)return{reset:{placement:at}}}return{}}}},zi=new Set(["left","top"]);async function Li(r,t){const{placement:e,platform:n,elements:a}=r,i=await(n.isRTL==null?void 0:n.isRTL(a.floating)),s=Ee(e),o=ln(e),l=ye(e)==="y",c=zi.has(s)?-1:1,u=i&&l?-1:1,m=on(t,r);let{mainAxis:g,crossAxis:f,alignmentAxis:p}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return o&&typeof p=="number"&&(f=o==="end"?p*-1:p),l?{x:f*u,y:g*c}:{x:g*c,y:f*u}}const Mi=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var e,n;const{x:a,y:i,placement:s,middlewareData:o}=t,l=await Li(t,r);return s===((e=o.offset)==null?void 0:e.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:a+l.x,y:i+l.y,data:{...l,placement:s}}}}},Ui=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:e,y:n,placement:a}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:o={fn:b=>{let{x:h,y:v}=b;return{x:h,y:v}}},...l}=on(r,t),c={x:e,y:n},u=await Qn(t,l),m=ye(Ee(a)),g=sa(m);let f=c[g],p=c[m];if(i){const b=g==="y"?"top":"left",h=g==="y"?"bottom":"right",v=f+u[b],y=f-u[h];f=cr(v,f,y)}if(s){const b=m==="y"?"top":"left",h=m==="y"?"bottom":"right",v=p+u[b],y=p-u[h];p=cr(v,p,y)}const d=o.fn({...t,[g]:f,[m]:p});return{...d,data:{x:d.x-e,y:d.y-n,enabled:{[g]:i,[m]:s}}}}}},Wi=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var e,n;const{placement:a,rects:i,platform:s,elements:o}=t,{apply:l=()=>{},...c}=on(r,t),u=await Qn(t,c),m=Ee(a),g=ln(a),f=ye(a)==="y",{width:p,height:d}=i.floating;let b,h;m==="top"||m==="bottom"?(b=m,h=g===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(h=m,b=g==="end"?"top":"bottom");const v=d-u.top-u.bottom,y=p-u.left-u.right,k=Ye(d-u[b],v),$=Ye(p-u[h],y),P=!t.middlewareData.shift;let j=k,I=$;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(I=y),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(j=v),P&&!g){const T=Jt(u.left,0),Q=Jt(u.right,0),E=Jt(u.top,0),R=Jt(u.bottom,0);f?I=p-2*(T!==0||Q!==0?T+Q:Jt(u.left,u.right)):j=d-2*(E!==0||R!==0?E+R:Jt(u.top,u.bottom))}await l({...t,availableWidth:I,availableHeight:j});const N=await s.getDimensions(o.floating);return p!==N.width||d!==N.height?{reset:{rects:!0}}:{}}}};function Cn(){return typeof window<"u"}function Qe(r){return ca(r)?(r.nodeName||"").toLowerCase():"#document"}function ee(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function ve(r){var t;return(t=(ca(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function ca(r){return Cn()?r instanceof Node||r instanceof ee(r).Node:!1}function de(r){return Cn()?r instanceof Element||r instanceof ee(r).Element:!1}function ge(r){return Cn()?r instanceof HTMLElement||r instanceof ee(r).HTMLElement:!1}function hr(r){return!Cn()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof ee(r).ShadowRoot}const Hi=new Set(["inline","contents"]);function cn(r){const{overflow:t,overflowX:e,overflowY:n,display:a}=he(r);return/auto|scroll|overlay|hidden|clip/.test(t+n+e)&&!Hi.has(a)}const Vi=new Set(["table","td","th"]);function Zi(r){return Vi.has(Qe(r))}const Gi=[":popover-open",":modal"];function Sn(r){return Gi.some(t=>{try{return r.matches(t)}catch{return!1}})}const Yi=["transform","translate","scale","rotate","perspective"],qi=["transform","translate","scale","rotate","perspective","filter"],Ki=["paint","layout","strict","content"];function tr(r){const t=er(),e=de(r)?he(r):r;return Yi.some(n=>e[n]?e[n]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||qi.some(n=>(e.willChange||"").includes(n))||Ki.some(n=>(e.contain||"").includes(n))}function Xi(r){let t=De(r);for(;ge(t)&&!qe(t);){if(tr(t))return t;if(Sn(t))return null;t=De(t)}return null}function er(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Ji=new Set(["html","body","#document"]);function qe(r){return Ji.has(Qe(r))}function he(r){return ee(r).getComputedStyle(r)}function Fn(r){return de(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function De(r){if(Qe(r)==="html")return r;const t=r.assignedSlot||r.parentNode||hr(r)&&r.host||ve(r);return hr(t)?t.host:t}function fa(r){const t=De(r);return qe(t)?r.ownerDocument?r.ownerDocument.body:r.body:ge(t)&&cn(t)?t:fa(t)}function Ke(r,t,e){var n;t===void 0&&(t=[]),e===void 0&&(e=!0);const a=fa(r),i=a===((n=r.ownerDocument)==null?void 0:n.body),s=ee(a);if(i){const o=Zn(s);return t.concat(s,s.visualViewport||[],cn(a)?a:[],o&&e?Ke(o):[])}return t.concat(a,Ke(a,[],e))}function Zn(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function ua(r){const t=he(r);let e=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=ge(r),i=a?r.offsetWidth:e,s=a?r.offsetHeight:n,o=_n(e)!==i||_n(n)!==s;return o&&(e=i,n=s),{width:e,height:n,$:o}}function nr(r){return de(r)?r:r.contextElement}function Ge(r){const t=nr(r);if(!ge(t))return pe(1);const e=t.getBoundingClientRect(),{width:n,height:a,$:i}=ua(t);let s=(i?_n(e.width):e.width)/n,o=(i?_n(e.height):e.height)/a;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const Qi=pe(0);function da(r){const t=ee(r);return!er()||!t.visualViewport?Qi:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function ts(r,t,e){return t===void 0&&(t=!1),!e||t&&e!==ee(r)?!1:t}function Ie(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=!1);const a=r.getBoundingClientRect(),i=nr(r);let s=pe(1);t&&(n?de(n)&&(s=Ge(n)):s=Ge(r));const o=ts(i,e,n)?da(i):pe(0);let l=(a.left+o.x)/s.x,c=(a.top+o.y)/s.y,u=a.width/s.x,m=a.height/s.y;if(i){const g=ee(i),f=n&&de(n)?ee(n):n;let p=g,d=Zn(p);for(;d&&n&&f!==p;){const b=Ge(d),h=d.getBoundingClientRect(),v=he(d),y=h.left+(d.clientLeft+parseFloat(v.paddingLeft))*b.x,k=h.top+(d.clientTop+parseFloat(v.paddingTop))*b.y;l*=b.x,c*=b.y,u*=b.x,m*=b.y,l+=y,c+=k,p=ee(d),d=Zn(p)}}return kn({width:u,height:m,x:l,y:c})}function xn(r,t){const e=Fn(r).scrollLeft;return t?t.left+e:Ie(ve(r)).left+e}function ha(r,t){const e=r.getBoundingClientRect(),n=e.left+t.scrollLeft-xn(r,e),a=e.top+t.scrollTop;return{x:n,y:a}}function es(r){let{elements:t,rect:e,offsetParent:n,strategy:a}=r;const i=a==="fixed",s=ve(n),o=t?Sn(t.floating):!1;if(n===s||o&&i)return e;let l={scrollLeft:0,scrollTop:0},c=pe(1);const u=pe(0),m=ge(n);if((m||!m&&!i)&&((Qe(n)!=="body"||cn(s))&&(l=Fn(n)),ge(n))){const f=Ie(n);c=Ge(n),u.x=f.x+n.clientLeft,u.y=f.y+n.clientTop}const g=s&&!m&&!i?ha(s,l):pe(0);return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+u.x+g.x,y:e.y*c.y-l.scrollTop*c.y+u.y+g.y}}function ns(r){return Array.from(r.getClientRects())}function rs(r){const t=ve(r),e=Fn(r),n=r.ownerDocument.body,a=Jt(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),i=Jt(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let s=-e.scrollLeft+xn(r);const o=-e.scrollTop;return he(n).direction==="rtl"&&(s+=Jt(t.clientWidth,n.clientWidth)-a),{width:a,height:i,x:s,y:o}}const pr=25;function as(r,t){const e=ee(r),n=ve(r),a=e.visualViewport;let i=n.clientWidth,s=n.clientHeight,o=0,l=0;if(a){i=a.width,s=a.height;const u=er();(!u||u&&t==="fixed")&&(o=a.offsetLeft,l=a.offsetTop)}const c=xn(n);if(c<=0){const u=n.ownerDocument,m=u.body,g=getComputedStyle(m),f=u.compatMode==="CSS1Compat"&&parseFloat(g.marginLeft)+parseFloat(g.marginRight)||0,p=Math.abs(n.clientWidth-m.clientWidth-f);p<=pr&&(i-=p)}else c<=pr&&(i+=c);return{width:i,height:s,x:o,y:l}}const is=new Set(["absolute","fixed"]);function ss(r,t){const e=Ie(r,!0,t==="fixed"),n=e.top+r.clientTop,a=e.left+r.clientLeft,i=ge(r)?Ge(r):pe(1),s=r.clientWidth*i.x,o=r.clientHeight*i.y,l=a*i.x,c=n*i.y;return{width:s,height:o,x:l,y:c}}function mr(r,t,e){let n;if(t==="viewport")n=as(r,e);else if(t==="document")n=rs(ve(r));else if(de(t))n=ss(t,e);else{const a=da(r);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return kn(n)}function pa(r,t){const e=De(r);return e===t||!de(e)||qe(e)?!1:he(e).position==="fixed"||pa(e,t)}function os(r,t){const e=t.get(r);if(e)return e;let n=Ke(r,[],!1).filter(o=>de(o)&&Qe(o)!=="body"),a=null;const i=he(r).position==="fixed";let s=i?De(r):r;for(;de(s)&&!qe(s);){const o=he(s),l=tr(s);!l&&o.position==="fixed"&&(a=null),(i?!l&&!a:!l&&o.position==="static"&&!!a&&is.has(a.position)||cn(s)&&!l&&pa(r,s))?n=n.filter(u=>u!==s):a=o,s=De(s)}return t.set(r,n),n}function ls(r){let{element:t,boundary:e,rootBoundary:n,strategy:a}=r;const s=[...e==="clippingAncestors"?Sn(t)?[]:os(t,this._c):[].concat(e),n],o=s[0],l=s.reduce((c,u)=>{const m=mr(t,u,a);return c.top=Jt(m.top,c.top),c.right=Ye(m.right,c.right),c.bottom=Ye(m.bottom,c.bottom),c.left=Jt(m.left,c.left),c},mr(t,o,a));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function cs(r){const{width:t,height:e}=ua(r);return{width:t,height:e}}function fs(r,t,e){const n=ge(t),a=ve(t),i=e==="fixed",s=Ie(r,!0,i,t);let o={scrollLeft:0,scrollTop:0};const l=pe(0);function c(){l.x=xn(a)}if(n||!n&&!i)if((Qe(t)!=="body"||cn(a))&&(o=Fn(t)),n){const f=Ie(t,!0,i,t);l.x=f.x+t.clientLeft,l.y=f.y+t.clientTop}else a&&c();i&&!n&&a&&c();const u=a&&!n&&!i?ha(a,o):pe(0),m=s.left+o.scrollLeft-l.x-u.x,g=s.top+o.scrollTop-l.y-u.y;return{x:m,y:g,width:s.width,height:s.height}}function jn(r){return he(r).position==="static"}function gr(r,t){if(!ge(r)||he(r).position==="fixed")return null;if(t)return t(r);let e=r.offsetParent;return ve(r)===e&&(e=e.ownerDocument.body),e}function ma(r,t){const e=ee(r);if(Sn(r))return e;if(!ge(r)){let a=De(r);for(;a&&!qe(a);){if(de(a)&&!jn(a))return a;a=De(a)}return e}let n=gr(r,t);for(;n&&Zi(n)&&jn(n);)n=gr(n,t);return n&&qe(n)&&jn(n)&&!tr(n)?e:n||Xi(r)||e}const us=async function(r){const t=this.getOffsetParent||ma,e=this.getDimensions,n=await e(r.floating);return{reference:fs(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function ds(r){return he(r).direction==="rtl"}const ga={convertOffsetParentRelativeRectToViewportRelativeRect:es,getDocumentElement:ve,getClippingRect:ls,getOffsetParent:ma,getElementRects:us,getClientRects:ns,getDimensions:cs,getScale:Ge,isElement:de,isRTL:ds};function wa(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function hs(r,t){let e=null,n;const a=ve(r);function i(){var o;clearTimeout(n),(o=e)==null||o.disconnect(),e=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),i();const c=r.getBoundingClientRect(),{left:u,top:m,width:g,height:f}=c;if(o||t(),!g||!f)return;const p=dn(m),d=dn(a.clientWidth-(u+g)),b=dn(a.clientHeight-(m+f)),h=dn(u),y={rootMargin:-p+"px "+-d+"px "+-b+"px "+-h+"px",threshold:Jt(0,Ye(1,l))||1};let k=!0;function $(P){const j=P[0].intersectionRatio;if(j!==l){if(!k)return s();j?s(!1,j):n=setTimeout(()=>{s(!1,1e-7)},1e3)}j===1&&!wa(c,r.getBoundingClientRect())&&s(),k=!1}try{e=new IntersectionObserver($,{...y,root:a.ownerDocument})}catch{e=new IntersectionObserver($,y)}e.observe(r)}return s(!0),i}function va(r,t,e,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=nr(r),u=a||i?[...c?Ke(c):[],...Ke(t)]:[];u.forEach(h=>{a&&h.addEventListener("scroll",e,{passive:!0}),i&&h.addEventListener("resize",e)});const m=c&&o?hs(c,e):null;let g=-1,f=null;s&&(f=new ResizeObserver(h=>{let[v]=h;v&&v.target===c&&f&&(f.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var y;(y=f)==null||y.observe(t)})),e()}),c&&!l&&f.observe(c),f.observe(t));let p,d=l?Ie(r):null;l&&b();function b(){const h=Ie(r);d&&!wa(d,h)&&e(),d=h,p=requestAnimationFrame(b)}return e(),()=>{var h;u.forEach(v=>{a&&v.removeEventListener("scroll",e),i&&v.removeEventListener("resize",e)}),m==null||m(),(h=f)==null||h.disconnect(),f=null,l&&cancelAnimationFrame(p)}}const ba=Mi,_a=Ui,ya=Ii,ka=Wi,ps=(r,t,e)=>{const n=new Map,a={platform:ga,...e},i={...a.platform,_c:n};return Ri(r,t,{...a,platform:i})},ms=Object.freeze(Object.defineProperty({__proto__:null,autoUpdate:va,computePosition:ps,flip:ya,getOverflowAncestors:Ke,offset:ba,platform:ga,shift:_a,size:ka},Symbol.toStringTag,{value:"Module"}));/**
 * @license lucide-svelte v0.546.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const wr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};function vr(r,t,e){const n=r.slice();return n[11]=t[e][0],n[12]=t[e][1],n}function Nn(r){let t,e=[r[12]],n={};for(let a=0;a<e.length;a+=1)n=kt(n,e[a]);return{c(){t=ra(r[11]),gn(t,n)},m(a,i){bt(a,t,i)},p(a,i){gn(t,n=fe(e,[i&32&&a[12]]))},d(a){a&&gt(t)}}}function br(r){let t=r[11],e,n=r[11]&&Nn(r);return{c(){n&&n.c(),e=$n()},m(a,i){n&&n.m(a,i),bt(a,e,i)},p(a,i){a[11]?t?Lt(t,a[11])?(n.d(1),n=Nn(a),t=a[11],n.c(),n.m(e.parentNode,e)):n.p(a,i):(n=Nn(a),t=a[11],n.c(),n.m(e.parentNode,e)):t&&(n.d(1),n=null,t=a[11])},d(a){a&&gt(e),n&&n.d(a)}}}function gs(r){let t,e,n,a,i,s=xe(r[5]),o=[];for(let g=0;g<s.length;g+=1)o[g]=br(vr(r,s,g));const l=r[10].default,c=ne(l,r,r[9],null);let u=[wr,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:a=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],m={};for(let g=0;g<u.length;g+=1)m=kt(m,u[g]);return{c(){t=ra("svg");for(let g=0;g<o.length;g+=1)o[g].c();e=$n(),c&&c.c(),gn(t,m)},m(g,f){bt(g,t,f);for(let p=0;p<o.length;p+=1)o[p]&&o[p].m(t,null);nt(t,e),c&&c.m(t,null),i=!0},p(g,[f]){if(f&32){s=xe(g[5]);let p;for(p=0;p<s.length;p+=1){const d=vr(g,s,p);o[p]?o[p].p(d,f):(o[p]=br(d),o[p].c(),o[p].m(t,e))}for(;p<o.length;p+=1)o[p].d(1);o.length=s.length}c&&c.p&&(!i||f&512)&&ae(c,l,g,g[9],i?re(l,g[9],f,null):ie(g[9]),null),gn(t,m=fe(u,[wr,f&128&&g[7],(!i||f&4)&&{width:g[2]},(!i||f&4)&&{height:g[2]},(!i||f&2)&&{stroke:g[1]},(!i||f&28&&n!==(n=g[4]?Number(g[3])*24/Number(g[2]):g[3]))&&{"stroke-width":n},(!i||f&257&&a!==(a=g[6]("lucide-icon","lucide",g[0]?`lucide-${g[0]}`:"",g[8].class)))&&{class:a}]))},i(g){i||(q(c,g),i=!0)},o(g){J(c,g),i=!1},d(g){g&&gt(t),na(o,g),c&&c.d(g)}}}function ws(r,t,e){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let a=or(t,n),{$$slots:i={},$$scope:s}=t,{name:o=void 0}=t,{color:l="currentColor"}=t,{size:c=24}=t,{strokeWidth:u=2}=t,{absoluteStrokeWidth:m=!1}=t,{iconNode:g=[]}=t;const f=(...p)=>p.filter((d,b,h)=>!!d&&h.indexOf(d)===b).join(" ");return r.$$set=p=>{e(8,t=kt(kt({},t),Nt(p))),e(7,a=or(t,n)),"name"in p&&e(0,o=p.name),"color"in p&&e(1,l=p.color),"size"in p&&e(2,c=p.size),"strokeWidth"in p&&e(3,u=p.strokeWidth),"absoluteStrokeWidth"in p&&e(4,m=p.absoluteStrokeWidth),"iconNode"in p&&e(5,g=p.iconNode),"$$scope"in p&&e(9,s=p.$$scope)},t=Nt(t),[o,l,c,u,m,g,f,a,t,s,i]}class be extends Vt{constructor(t){super(),Ht(this,t,ws,gs,Lt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}function vs(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function bs(r){let t,e;const n=[{name:"arrow-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[vs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function _s(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class $a extends Vt{constructor(t){super(),Ht(this,t,_s,bs,Lt,{})}}function ys(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function ks(r){let t,e;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[ys]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function $s(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Ca extends Vt{constructor(t){super(),Ht(this,t,$s,ks,Lt,{})}}function Cs(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function Ss(r){let t,e;const n=[{name:"book-open-check"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Cs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Fs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 21V7"}],["path",{d:"m16 12 2 2 4-4"}],["path",{d:"M22 6V4a1 1 0 0 0-1-1h-5a4 4 0 0 0-4 4 4 4 0 0 0-4-4H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h6a3 3 0 0 1 3 3 3 3 0 0 1 3-3h6a1 1 0 0 0 1-1v-1.3"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class xs extends Vt{constructor(t){super(),Ht(this,t,Fs,Ss,Lt,{})}}function Es(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function Ds(r){let t,e;const n=[{name:"chevron-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Es]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ps(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m6 9 6 6 6-6"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class js extends Vt{constructor(t){super(),Ht(this,t,Ps,Ds,Lt,{})}}function Ns(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function As(r){let t,e;const n=[{name:"copy"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ns]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ts(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Bs extends Vt{constructor(t){super(),Ht(this,t,Ts,As,Lt,{})}}function Os(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function Rs(r){let t,e;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Os]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Is(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Sa extends Vt{constructor(t){super(),Ht(this,t,Is,Rs,Lt,{})}}function zs(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function Ls(r){let t,e;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[zs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ms(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Fa extends Vt{constructor(t){super(),Ht(this,t,Ms,Ls,Lt,{})}}function Us(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function Ws(r){let t,e;const n=[{name:"rotate-ccw"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Us]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Hs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class rr extends Vt{constructor(t){super(),Ht(this,t,Hs,Ws,Lt,{})}}function Vs(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function Zs(r){let t,e;const n=[{name:"trash"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Vs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Gs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class xa extends Vt{constructor(t){super(),Ht(this,t,Gs,Zs,Lt,{})}}function Ys(r){let t;const e=r[2].default,n=ne(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&ae(n,e,a,a[3],t?re(e,a[3],i,null):ie(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){J(n,a),t=!1},d(a){n&&n.d(a)}}}function qs(r){let t,e;const n=[{name:"x"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ys]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=kt(a,n[i]);return t=new be({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?fe(n,[n[0],s&2&&we(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){J(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ks(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return r.$$set=s=>{e(1,t=kt(kt({},t),Nt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Nt(t),[i,t,n,a]}class Xs extends Vt{constructor(t){super(),Ht(this,t,Ks,qs,Lt,{})}}function _r(r,t,e){const n=r.slice();return n[38]=t[e],n[40]=e,n}function yr(r){let t,e,n;return{c(){t=lt("label"),e=Wt(r[2]),et(t,"class","wa-select-label-text"),et(t,"for",n="wa-select-"+r[7])},m(a,i){bt(a,t,i),nt(t,e)},p(a,i){i[0]&4&&Je(e,a[2]),i[0]&128&&n!==(n="wa-select-"+a[7])&&et(t,"for",n)},d(a){a&&gt(t)}}}function Js(r){let t,e;return{c(){t=lt("span"),e=Wt(r[1]),et(t,"class","wa-select-placeholder")},m(n,a){bt(n,t,a),nt(t,e)},p(n,a){a[0]&2&&Je(e,n[1])},d(n){n&&gt(t)}}}function Qs(r){let t,e;return{c(){t=lt("span"),e=Wt(r[16]),et(t,"class","wa-select-label")},m(n,a){bt(n,t,a),nt(t,e)},p(n,a){a[0]&65536&&Je(e,n[16])},d(n){n&&gt(t)}}}function kr(r){let t,e,n,a,i;return e=new Xs({}),{c(){t=lt("button"),ht(e.$$.fragment),et(t,"type","button"),et(t,"class","wa-select-clear"),et(t,"aria-label","Clear selection")},m(s,o){bt(s,t,o),ut(e,t,null),n=!0,a||(i=me(t,"click",r[21]),a=!0)},p:Dt,i(s){n||(q(e.$$.fragment,s),n=!0)},o(s){J(e.$$.fragment,s),n=!1},d(s){s&&gt(t),dt(e),a=!1,i()}}}function $r(r){let t,e,n;return e=new js({}),{c(){t=lt("div"),ht(e.$$.fragment),et(t,"class","wa-select-chevron"),le(t,"rotated",r[9])},m(a,i){bt(a,t,i),ut(e,t,null),n=!0},p(a,i){(!n||i[0]&512)&&le(t,"rotated",a[9])},i(a){n||(q(e.$$.fragment,a),n=!0)},o(a){J(e.$$.fragment,a),n=!1},d(a){a&&gt(t),dt(e)}}}function Cr(r){let t,e,n,a=r[4]&&Sr(r);function i(l,c){return l[10].length===0?eo:to}let s=i(r),o=s(r);return{c(){t=lt("div"),a&&a.c(),e=wt(),n=lt("div"),o.c(),et(n,"class","wa-select-list"),et(t,"class","wa-select-dropdown")},m(l,c){bt(l,t,c),a&&a.m(t,null),nt(t,e),nt(t,n),o.m(n,null),r[30](t)},p(l,c){l[4]?a?a.p(l,c):(a=Sr(l),a.c(),a.m(t,e)):a&&(a.d(1),a=null),s===(s=i(l))&&o?o.p(l,c):(o.d(1),o=s(l),o&&(o.c(),o.m(n,null)))},d(l){l&&gt(t),a&&a.d(),o.d(),r[30](null)}}}function Sr(r){let t,e,n,a;return{c(){t=lt("div"),e=lt("input"),et(e,"type","text"),et(e,"class","wa-select-search-input"),et(e,"placeholder","Search..."),e.value=r[13],et(t,"class","wa-select-search")},m(i,s){bt(i,t,s),nt(t,e),r[27](e),n||(a=me(e,"input",r[23]),n=!0)},p(i,s){s[0]&8192&&e.value!==i[13]&&(e.value=i[13])},d(i){i&&gt(t),r[27](null),n=!1,a()}}}function to(r){let t=[],e=new Map,n,a=xe(r[10]);const i=s=>s[38].value;for(let s=0;s<a.length;s+=1){let o=_r(r,a,s),l=i(o);e.set(l,t[s]=Fr(l,o))}return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=$n()},m(s,o){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(s,o);bt(s,n,o)},p(s,o){o[0]&1197056&&(a=xe(s[10]),t=ia(t,o,i,1,s,a,e,n.parentNode,wi,Fr,n,_r))},d(s){s&&gt(n);for(let o=0;o<t.length;o+=1)t[o].d(s)}}}function eo(r){let t;return{c(){t=lt("div"),t.textContent="No options available",et(t,"class","wa-select-empty")},m(e,n){bt(e,t,n)},p:Dt,d(e){e&&gt(t)}}}function Fr(r,t){let e,n=t[38].label+"",a,i,s,o,l;function c(){return t[28](t[38])}function u(){return t[29](t[40])}return{key:r,first:null,c(){e=lt("button"),a=Wt(n),i=wt(),et(e,"type","button"),et(e,"class","wa-select-option"),et(e,"data-select-index",s=t[40]),le(e,"selected",t[14]===t[40]),le(e,"active",t[17]()===t[38].value),this.first=e},m(m,g){bt(m,e,g),nt(e,a),nt(e,i),o||(l=[me(e,"click",c),me(e,"mouseenter",u)],o=!0)},p(m,g){t=m,g[0]&1024&&n!==(n=t[38].label+"")&&Je(a,n),g[0]&1024&&s!==(s=t[40])&&et(e,"data-select-index",s),g[0]&17408&&le(e,"selected",t[14]===t[40]),g[0]&132096&&le(e,"active",t[17]()===t[38].value)},d(m){m&&gt(e),o=!1,Pe(l)}}}function no(r){let t,e,n,a,i,s,o,l,c,u,m,g,f,p=r[2]&&yr(r);function d($,P){return $[0]?Qs:Js}let b=d(r),h=b(r),v=r[5]&&r[0]&&kr(r),y=r[6]&&$r(r),k=r[9]&&Cr(r);return{c(){t=lt("div"),p&&p.c(),e=wt(),n=lt("div"),a=lt("div"),h.c(),i=wt(),s=lt("div"),v&&v.c(),o=wt(),y&&y.c(),u=wt(),k&&k.c(),et(a,"class","wa-select-value"),et(s,"class","wa-select-controls"),et(n,"id",l="wa-select-"+r[7]),et(n,"class","wa-select-trigger"),et(n,"role","button"),et(n,"tabindex",c=r[3]?-1:0),et(n,"style",r[8]),le(n,"open",r[9]),le(n,"disabled",r[3]),le(n,"has-value",r[0]),et(t,"class","wa-select-container wa-select")},m($,P){bt($,t,P),p&&p.m(t,null),nt(t,e),nt(t,n),nt(n,a),h.m(a,null),nt(n,i),nt(n,s),v&&v.m(s,null),nt(s,o),y&&y.m(s,null),r[25](n),nt(t,u),k&&k.m(t,null),m=!0,g||(f=[me(n,"click",r[26]),me(n,"keydown",r[22])],g=!0)},p($,P){$[2]?p?p.p($,P):(p=yr($),p.c(),p.m(t,e)):p&&(p.d(1),p=null),b===(b=d($))&&h?h.p($,P):(h.d(1),h=b($),h&&(h.c(),h.m(a,null))),$[5]&&$[0]?v?(v.p($,P),P[0]&33&&q(v,1)):(v=kr($),v.c(),q(v,1),v.m(s,o)):v&&(Qt(),J(v,1,1,()=>{v=null}),te()),$[6]?y?(y.p($,P),P[0]&64&&q(y,1)):(y=$r($),y.c(),q(y,1),y.m(s,null)):y&&(Qt(),J(y,1,1,()=>{y=null}),te()),(!m||P[0]&128&&l!==(l="wa-select-"+$[7]))&&et(n,"id",l),(!m||P[0]&8&&c!==(c=$[3]?-1:0))&&et(n,"tabindex",c),(!m||P[0]&256)&&et(n,"style",$[8]),(!m||P[0]&512)&&le(n,"open",$[9]),(!m||P[0]&8)&&le(n,"disabled",$[3]),(!m||P[0]&1)&&le(n,"has-value",$[0]),$[9]?k?k.p($,P):(k=Cr($),k.c(),k.m(t,null)):k&&(k.d(1),k=null)},i($){m||(q(v),q(y),m=!0)},o($){J(v),J(y),m=!1},d($){$&&gt(t),p&&p.d(),h.d(),v&&v.d(),y&&y.d(),r[25](null),k&&k.d(),g=!1,Pe(f)}}}function ro(r,t,e){let n,{items:a=[]}=t,{value:i=null}=t,{placeholder:s="Select..."}=t,{label:o=""}=t,{disabled:l=!1}=t,{searchable:c=!1}=t,{clearable:u=!1}=t,{showChevron:m=!0}=t,{name:g=""}=t,{containerStyles:f=""}=t,p=!1,d="",b=[],h=-1,v,y,k,$=null;const P=di();function j(){return i?typeof i=="string"?i:i.value||"":""}function I(){d?e(10,b=a.filter(M=>M.label.toLowerCase().includes(d.toLowerCase())||M.value.toLowerCase().includes(d.toLowerCase()))):e(10,b=a),e(14,h=-1)}function N(){l||p||(e(9,p=!0),e(13,d=""),I(),c&&setTimeout(()=>{k&&k.focus()},0),v&&y&&Q())}function T(){e(9,p=!1),e(13,d=""),e(14,h=-1)}function Q(){if(!v||!y)return;const M=[ba(6),ya({padding:8,fallbackAxisSideDirection:"end"}),_a({padding:8}),ka({padding:8,apply({availableHeight:K}){Object.assign(y.style,{maxHeight:`${Math.min(K-10,350)}px`,width:`${v.offsetWidth}px`})}})];$=va(v,y,async()=>{const{computePosition:K}=await Promise.resolve().then(()=>ms),{x:Ct,y:At,placement:vt}=await K(v,y,{middleware:M,placement:"bottom-start"});y.setAttribute("data-placement",vt),Object.assign(y.style,{left:`${Ct}px`,top:`${At}px`})})}function E(M){e(0,i=M),T(),P("select",M)}function R(M){M.stopPropagation(),e(0,i=null),T(),P("clear")}function _(M){if(!p){(M.key==="Enter"||M.key===" ")&&(M.preventDefault(),N());return}switch(M.key){case"ArrowDown":M.preventDefault(),e(14,h=Math.min(h+1,b.length-1)),U();break;case"ArrowUp":M.preventDefault(),e(14,h=Math.max(h-1,-1)),U();break;case"Enter":M.preventDefault(),h>=0?E(b[h]):T();break;case"Escape":M.preventDefault(),T();break}}function U(){if(h<0)return;const M=document.querySelector(`[data-select-index="${h}"]`);M&&M.scrollIntoView({block:"nearest"})}function at(M){e(13,d=M.target.value),I()}function V(M){if(p&&v&&y){const K=M.target;!v.contains(K)&&!y.contains(K)&&T()}}ui(()=>{document.addEventListener("click",V),I()}),Un(()=>{document.removeEventListener("click",V),$&&$()});function it(M){rn[M?"unshift":"push"](()=>{v=M,e(11,v)})}const Z=()=>p?T():N();function ct(M){rn[M?"unshift":"push"](()=>{k=M,e(15,k)})}const z=M=>E(M),O=M=>e(14,h=M);function st(M){rn[M?"unshift":"push"](()=>{y=M,e(12,y),e(9,p),e(11,v)})}return r.$$set=M=>{"items"in M&&e(24,a=M.items),"value"in M&&e(0,i=M.value),"placeholder"in M&&e(1,s=M.placeholder),"label"in M&&e(2,o=M.label),"disabled"in M&&e(3,l=M.disabled),"searchable"in M&&e(4,c=M.searchable),"clearable"in M&&e(5,u=M.clearable),"showChevron"in M&&e(6,m=M.showChevron),"name"in M&&e(7,g=M.name),"containerStyles"in M&&e(8,f=M.containerStyles)},r.$$.update=()=>{var M;if(r.$$.dirty[0]&16777219&&e(16,n=i?typeof i=="string"?((M=a.find(K=>K.value===i))==null?void 0:M.label)||i:i.label||s:s),r.$$.dirty[0]&1025&&i!==void 0&&b.length>0){const K=j();e(14,h=b.findIndex(Ct=>Ct.value===K))}r.$$.dirty[0]&6656&&p&&y&&v&&(e(12,y.style.width=`${v.offsetWidth}px`,y),e(12,y.style.top=`${v.offsetTop+v.offsetHeight+6}px`,y))},I(),[i,s,o,l,c,u,m,g,f,p,b,v,y,d,h,k,n,j,N,T,E,R,_,at,a,it,Z,ct,z,O,st]}class ao extends Vt{constructor(t){super(),Ht(this,t,ro,no,Lt,{items:24,value:0,placeholder:1,label:2,disabled:3,searchable:4,clearable:5,showChevron:6,name:7,containerStyles:8},null,[-1,-1])}}class xr extends D.Modal{constructor(t,e,n,a="draft"){super(t),this.name=e,this.onConfirm=n,this.type=a}onOpen(){const{contentEl:t}=this;t.addClass("wa-centered-modal");const e=this.type==="chapter"?"chapter":"draft";t.createEl("h3",{text:`Delete ${e} '${this.name}'?`}),this.type==="draft"&&t.createEl("p",{text:"This will create a backup copy before deleting."});const n=t.createDiv({cls:"modal-button-row wa-button-group"}),a=n.createEl("button",{text:"Delete",cls:"mod-cta wa-button"}),i=n.createEl("button",{text:"Cancel",cls:"wa-button"});a.onclick=async()=>{F(`${S} ConfirmDeleteModal: confirmed delete for ${this.type} "${this.name}"`),this.close(),await this.onConfirm()},i.onclick=()=>{F(`${S} ConfirmDeleteModal: cancelled delete for ${this.type} "${this.name}"`),this.close()}}}class io extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:`Duplicate Draft: ${this.props.sourceDraftName}`});let e="";new D.Setting(t).setName("New draft name").addText(n=>n.setPlaceholder(this.props.suggestedName).setValue(this.props.suggestedName).onChange(a=>e=a)),new D.Setting(t).addButton(n=>n.setButtonText("Duplicate").setCta().onClick(()=>{const a=e&&e.trim()?e.trim():this.props.suggestedName;F(`${S} DuplicateDraftModal: duplicating draft from "${this.props.sourceDraftName}" to "${a}"`),this.close(),this.props.onSubmit(a)}))}onClose(){this.contentEl.empty()}}class so extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Chapter"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New chapter name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new chapter name",cls:"wa-rename-input",attr:{"aria-label":"New chapter name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n,a;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Chapter name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameChapterModal: renaming chapter from "${this.oldName}" to "${t}"`),this.onSubmit(t),this.close()}}class oo extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var s;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Draft"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("label",{cls:"wa-rename-checkbox-label"});this.checkboxEl=n.createEl("input",{type:"checkbox",attr:{checked:"checked"}}),n.appendText(" Also rename the main draft file (filename)");const a=t.createEl("div",{cls:"wa-rename-btn-row"}),i=a.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=a.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var o,l;(o=this.inputEl)==null||o.focus(),(l=this.inputEl)==null||l.select()},0),(s=this.inputEl)==null||s.addEventListener("keydown",o=>{o.key==="Enter"?this.submit():o.key==="Escape"&&this.close()}),i.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var n,a,i;const t=(n=this.inputEl)==null?void 0:n.value.trim(),e=this.checkboxEl?this.checkboxEl.checked:!1;if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(i=this.inputEl)==null||i.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameDraftModal: renaming draft from "${this.oldName}" to "${t}", renameFile: ${e}`),this.onSubmit(t,e),this.close()}}function Ea(r){const t=r-1;return t*t*t+1}function lo(r,{from:t,to:e},n={}){const a=getComputedStyle(r),i=a.transform==="none"?"":a.transform,[s,o]=a.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*s/e.width-(e.left+s),c=t.top+t.height*o/e.height-(e.top+o),{delay:u=0,duration:m=f=>Math.sqrt(f)*120,easing:g=Ea}=n;return{delay:u,duration:sn(m)?m(Math.sqrt(l*l+c*c)):m,easing:g,css:(f,p)=>{const d=p*l,b=p*c,h=f+p*t.width/e.width,v=f+p*t.height/e.height;return`transform: ${i} translate(${d}px, ${b}px) scale(${h}, ${v});`}}}function Er(r,t,e){const n=r.slice();return n[68]=t[e],n[70]=e,n}function Dr(r,t,e){const n=r.slice();return n[71]=t[e],n}function co(r){let t,e;return t=new rr({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function fo(r){let t;return{c(){t=Wt("New Project")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Pr(r){let t;return{c(){t=lt("div"),t.textContent="No projects found.",et(t,"class","wa-muted"),Fe(t,"margin","4rem auto 0"),Fe(t,"font-size","18px"),Fe(t,"width","fit-content")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function jr(r){let t,e,n,a,i,s;return i=new ao({props:{name:"wa-project-select",value:r[3],items:r[7],placeholder:"Choose a project...",showChevron:!0,disabled:Ro,clearable:!1,searchable:!1}}),i.$on("select",r[42]),{c(){t=lt("div"),e=lt("label"),e.textContent="Select project",n=wt(),a=lt("div"),ht(i.$$.fragment),et(e,"for","wa-project-select"),et(a,"class","wa-row"),Fe(t,"margin","20px 0")},m(o,l){bt(o,t,l),nt(t,e),nt(t,n),nt(t,a),ut(i,a,null),s=!0},p(o,l){const c={};l[0]&8&&(c.value=o[3]),l[0]&128&&(c.items=o[7]),i.$set(c)},i(o){s||(q(i.$$.fragment,o),s=!0)},o(o){J(i.$$.fragment,o),s=!1},d(o){o&&gt(t),dt(i)}}}function Nr(r){let t,e,n,a,i,s,o,l,c,u,m,g,f,p,d,b;o=new ce({props:{ariaLabel:"Toggle draft sort order",title:void 0,clickHandler:r[43],$$slots:{default:[po]},$$scope:{ctx:r}}}),u=new $e({props:{title:"New draft",clickHandler:r[23],variant:"primary",$$slots:{default:[mo]},$$scope:{ctx:r}}}),g=new ce({props:{ariaLabel:"Refresh drafts",title:void 0,clickHandler:r[20],disabled:r[8],spinning:r[8],$$slots:{default:[go]},$$scope:{ctx:r}}});let h=r[9]&&Ar(r),v=r[5].length===0&&Tr(),y=r[5].length>0&&Br(r);return{c(){t=lt("div"),e=lt("div"),n=lt("div"),a=lt("div"),i=lt("div"),i.textContent="Drafts",s=wt(),ht(o.$$.fragment),l=wt(),c=lt("div"),ht(u.$$.fragment),m=wt(),ht(g.$$.fragment),f=wt(),h&&h.c(),p=wt(),v&&v.c(),d=wt(),y&&y.c(),et(i,"class","wa-title"),et(a,"class","wa-button-group"),et(c,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","draft-controls"),Fe(t,"margin-top","16px")},m(k,$){bt(k,t,$),nt(t,e),nt(e,n),nt(n,a),nt(a,i),nt(a,s),ut(o,a,null),nt(n,l),nt(n,c),ut(u,c,null),nt(c,m),ut(g,c,null),nt(t,f),h&&h.m(t,null),nt(t,p),v&&v.m(t,null),nt(t,d),y&&y.m(t,null),b=!0},p(k,$){const P={};$[0]&2048&&(P.clickHandler=k[43]),$[0]&2048|$[2]&4096&&(P.$$scope={dirty:$,ctx:k}),o.$set(P);const j={};$[2]&4096&&(j.$$scope={dirty:$,ctx:k}),u.$set(j);const I={};$[0]&256&&(I.disabled=k[8]),$[0]&256&&(I.spinning=k[8]),$[2]&4096&&(I.$$scope={dirty:$,ctx:k}),g.$set(I),k[9]?h?(h.p(k,$),$[0]&512&&q(h,1)):(h=Ar(k),h.c(),q(h,1),h.m(t,p)):h&&(Qt(),J(h,1,1,()=>{h=null}),te()),k[5].length===0?v||(v=Tr(),v.c(),v.m(t,d)):v&&(v.d(1),v=null),k[5].length>0?y?(y.p(k,$),$[0]&32&&q(y,1)):(y=Br(k),y.c(),q(y,1),y.m(t,null)):y&&(Qt(),J(y,1,1,()=>{y=null}),te())},i(k){b||(q(o.$$.fragment,k),q(u.$$.fragment,k),q(g.$$.fragment,k),q(h),q(y),b=!0)},o(k){J(o.$$.fragment,k),J(u.$$.fragment,k),J(g.$$.fragment,k),J(h),J(y),b=!1},d(k){k&&gt(t),dt(o),dt(u),dt(g),h&&h.d(),v&&v.d(),y&&y.d()}}}function uo(r){let t,e;return t=new $a({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function ho(r){let t,e;return t=new Ca({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function po(r){let t,e,n,a;const i=[ho,uo],s=[];function o(l,c){return l[11]?0:1}return t=o(r),e=s[t]=i[t](r),{c(){e.c(),n=$n()},m(l,c){s[t].m(l,c),bt(l,n,c),a=!0},p(l,c){let u=t;t=o(l),t!==u&&(Qt(),J(s[u],1,1,()=>{s[u]=null}),te(),e=s[t],e||(e=s[t]=i[t](l),e.c()),q(e,1),e.m(n.parentNode,n))},i(l){a||(q(e),a=!0)},o(l){J(e),a=!1},d(l){l&&gt(n),s[t].d(l)}}}function mo(r){let t;return{c(){t=Wt("New Draft")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function go(r){let t,e;return t=new rr({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ar(r){let t,e,n,a,i,s,o,l,c;return a=new $e({props:{clickHandler:r[22],variant:"primary",$$slots:{default:[wo]},$$scope:{ctx:r}}}),s=new $e({props:{clickHandler:r[45],$$slots:{default:[vo]},$$scope:{ctx:r}}}),{c(){t=lt("div"),e=lt("input"),n=wt(),ht(a.$$.fragment),i=wt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Draft name"),et(t,"class","create-inline wa-row")},m(u,m){bt(u,t,m),nt(t,e),wn(e,r[10]),nt(t,n),ut(a,t,null),nt(t,i),ut(s,t,null),o=!0,l||(c=me(e,"input",r[44]),l=!0)},p(u,m){m[0]&1024&&e.value!==u[10]&&wn(e,u[10]);const g={};m[2]&4096&&(g.$$scope={dirty:m,ctx:u}),a.$set(g);const f={};m[0]&1536&&(f.clickHandler=u[45]),m[2]&4096&&(f.$$scope={dirty:m,ctx:u}),s.$set(f)},i(u){o||(q(a.$$.fragment,u),q(s.$$.fragment,u),o=!0)},o(u){J(a.$$.fragment,u),J(s.$$.fragment,u),o=!1},d(u){u&&gt(t),dt(a),dt(s),l=!1,c()}}}function wo(r){let t;return{c(){t=Wt("Create")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function vo(r){let t;return{c(){t=Wt("Cancel")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Tr(r){let t;return{c(){t=lt("div"),t.textContent="No drafts found."},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Br(r){let t,e,n=xe(r[5]),a=[];for(let s=0;s<n.length;s+=1)a[s]=Ir(Dr(r,n,s));const i=s=>J(a[s],1,1,()=>{a[s]=null});return{c(){t=lt("div");for(let s=0;s<a.length;s+=1)a[s].c();et(t,"class","wa-draft-list")},m(s,o){bt(s,t,o);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(t,null);e=!0},p(s,o){if(o[0]&251662368|o[1]&8){n=xe(s[5]);let l;for(l=0;l<n.length;l+=1){const c=Dr(s,n,l);a[l]?(a[l].p(c,o),q(a[l],1)):(a[l]=Ir(c),a[l].c(),q(a[l],1),a[l].m(t,null))}for(Qt(),l=n.length;l<a.length;l+=1)i(l);te()}},i(s){if(!e){for(let o=0;o<n.length;o+=1)q(a[o]);e=!0}},o(s){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)J(a[o]);e=!1},d(s){s&&gt(t),na(a,s)}}}function Or(r){let t;return{c(){t=lt("span"),t.textContent="●",et(t,"class","wa-draft-active-indicator"),et(t,"title","Active draft")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function bo(r){let t,e;return t=new Sa({props:{size:je}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Rr(r){let t,e;function n(){return r[47](r[71])}return t=new ce({props:{ariaLabel:"Set active draft",title:void 0,clickHandler:n,$$slots:{default:[_o]},$$scope:{ctx:r}}}),{c(){ht(t.$$.fragment)},m(a,i){ut(t,a,i),e=!0},p(a,i){r=a;const s={};i[0]&32&&(s.clickHandler=n),i[2]&4096&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(a){e||(q(t.$$.fragment,a),e=!0)},o(a){J(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function _o(r){let t,e;return t=new xs({props:{size:je}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function yo(r){let t,e;return t=new Fa({props:{size:je}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function ko(r){let t,e;return t=new Bs({props:{size:je}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function $o(r){let t,e;return t=new xa({props:{size:je}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ir(r){let t,e,n,a=r[71]+"",i,s,o,l,c,u,m,g,f,p,d,b,h,v,y=r[12]===r[71]&&Or();function k(){return r[46](r[71])}l=new ce({props:{ariaLabel:"Open draft",title:void 0,clickHandler:k,$$slots:{default:[bo]},$$scope:{ctx:r}}});let $=r[12]!==r[71]&&Rr(r);function P(){return r[48](r[71])}m=new ce({props:{ariaLabel:"Rename draft",title:void 0,clickHandler:P,$$slots:{default:[yo]},$$scope:{ctx:r}}});function j(){return r[49](r[71])}f=new ce({props:{ariaLabel:"Duplicate draft",title:void 0,clickHandler:j,$$slots:{default:[ko]},$$scope:{ctx:r}}});function I(){return r[50](r[71])}return d=new ce({props:{ariaLabel:"Delete draft",title:void 0,clickHandler:I,$$slots:{default:[$o]},$$scope:{ctx:r}}}),{c(){t=lt("div"),e=lt("div"),y&&y.c(),n=wt(),i=Wt(a),s=wt(),o=lt("div"),ht(l.$$.fragment),c=wt(),$&&$.c(),u=wt(),ht(m.$$.fragment),g=wt(),ht(f.$$.fragment),p=wt(),ht(d.$$.fragment),b=wt(),et(e,"class","wa-draft-name wa-row"),et(o,"class","wa-draft-actions"),et(t,"class",h="wa-draft-item "+(r[12]===r[71]?"active":""))},m(N,T){bt(N,t,T),nt(t,e),y&&y.m(e,null),nt(e,n),nt(e,i),nt(t,s),nt(t,o),ut(l,o,null),nt(o,c),$&&$.m(o,null),nt(o,u),ut(m,o,null),nt(o,g),ut(f,o,null),nt(o,p),ut(d,o,null),nt(t,b),v=!0},p(N,T){r=N,r[12]===r[71]?y||(y=Or(),y.c(),y.m(e,n)):y&&(y.d(1),y=null),(!v||T[0]&32)&&a!==(a=r[71]+"")&&Je(i,a);const Q={};T[0]&32&&(Q.clickHandler=k),T[2]&4096&&(Q.$$scope={dirty:T,ctx:r}),l.$set(Q),r[12]!==r[71]?$?($.p(r,T),T[0]&4128&&q($,1)):($=Rr(r),$.c(),q($,1),$.m(o,u)):$&&(Qt(),J($,1,1,()=>{$=null}),te());const E={};T[0]&32&&(E.clickHandler=P),T[2]&4096&&(E.$$scope={dirty:T,ctx:r}),m.$set(E);const R={};T[0]&32&&(R.clickHandler=j),T[2]&4096&&(R.$$scope={dirty:T,ctx:r}),f.$set(R);const _={};T[0]&32&&(_.clickHandler=I),T[2]&4096&&(_.$$scope={dirty:T,ctx:r}),d.$set(_),(!v||T[0]&4128&&h!==(h="wa-draft-item "+(r[12]===r[71]?"active":"")))&&et(t,"class",h)},i(N){v||(q(l.$$.fragment,N),q($),q(m.$$.fragment,N),q(f.$$.fragment,N),q(d.$$.fragment,N),v=!0)},o(N){J(l.$$.fragment,N),J($),J(m.$$.fragment,N),J(f.$$.fragment,N),J(d.$$.fragment,N),v=!1},d(N){N&&gt(t),y&&y.d(),dt(l),$&&$.d(),dt(m),dt(f),dt(d)}}}function zr(r){let t,e,n,a,i,s,o,l,c,u,m,g,f,p;o=new $e({props:{clickHandler:r[51],variant:"primary",$$slots:{default:[Co]},$$scope:{ctx:r}}}),c=new ce({props:{ariaLabel:"Refresh chapters",title:void 0,clickHandler:r[21],disabled:r[14],spinning:r[14],$$slots:{default:[So]},$$scope:{ctx:r}}});let d=r[15]&&Lr(r);const b=[Po,Do,Eo],h=[];function v(y,k){return y[14]?0:y[13].length===0?1:2}return g=v(r),f=h[g]=b[g](r),{c(){t=lt("div"),e=lt("div"),n=lt("div"),a=lt("div"),a.textContent="Chapters",i=wt(),s=lt("div"),ht(o.$$.fragment),l=wt(),ht(c.$$.fragment),u=wt(),d&&d.c(),m=wt(),f.c(),et(a,"class","wa-title"),et(s,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","chapter-controls"),Fe(t,"margin-top","18px")},m(y,k){bt(y,t,k),nt(t,e),nt(e,n),nt(n,a),nt(n,i),nt(n,s),ut(o,s,null),nt(s,l),ut(c,s,null),nt(t,u),d&&d.m(t,null),nt(t,m),h[g].m(t,null),p=!0},p(y,k){const $={};k[0]&32768&&($.clickHandler=y[51]),k[2]&4096&&($.$$scope={dirty:k,ctx:y}),o.$set($);const P={};k[0]&16384&&(P.disabled=y[14]),k[0]&16384&&(P.spinning=y[14]),k[2]&4096&&(P.$$scope={dirty:k,ctx:y}),c.$set(P),y[15]?d?(d.p(y,k),k[0]&32768&&q(d,1)):(d=Lr(y),d.c(),q(d,1),d.m(t,m)):d&&(Qt(),J(d,1,1,()=>{d=null}),te());let j=g;g=v(y),g===j?h[g].p(y,k):(Qt(),J(h[j],1,1,()=>{h[j]=null}),te(),f=h[g],f?f.p(y,k):(f=h[g]=b[g](y),f.c()),q(f,1),f.m(t,null))},i(y){p||(q(o.$$.fragment,y),q(c.$$.fragment,y),q(d),q(f),p=!0)},o(y){J(o.$$.fragment,y),J(c.$$.fragment,y),J(d),J(f),p=!1},d(y){y&&gt(t),dt(o),dt(c),d&&d.d(),h[g].d()}}}function Co(r){let t;return{c(){t=Wt("New Chapter")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function So(r){let t,e;return t=new rr({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Lr(r){let t,e,n,a,i,s,o,l,c;return a=new $e({props:{clickHandler:r[53],variant:"primary",$$slots:{default:[Fo]},$$scope:{ctx:r}}}),s=new $e({props:{clickHandler:r[54],$$slots:{default:[xo]},$$scope:{ctx:r}}}),{c(){t=lt("div"),e=lt("input"),n=wt(),ht(a.$$.fragment),i=wt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Chapter name"),et(t,"class","create-inline wa-row")},m(u,m){bt(u,t,m),nt(t,e),wn(e,r[16]),nt(t,n),ut(a,t,null),nt(t,i),ut(s,t,null),o=!0,l||(c=me(e,"input",r[52]),l=!0)},p(u,m){m[0]&65536&&e.value!==u[16]&&wn(e,u[16]);const g={};m[0]&229393&&(g.clickHandler=u[53]),m[2]&4096&&(g.$$scope={dirty:m,ctx:u}),a.$set(g);const f={};m[0]&229376&&(f.clickHandler=u[54]),m[2]&4096&&(f.$$scope={dirty:m,ctx:u}),s.$set(f)},i(u){o||(q(a.$$.fragment,u),q(s.$$.fragment,u),o=!0)},o(u){J(a.$$.fragment,u),J(s.$$.fragment,u),o=!1},d(u){u&&gt(t),dt(a),dt(s),l=!1,c()}}}function Fo(r){let t;return{c(){t=Wt("Create")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function xo(r){let t;return{c(){t=Wt("Cancel")},m(e,n){bt(e,t,n)},d(e){e&&gt(t)}}}function Eo(r){let t,e=[],n=new Map,a,i=xe(r[13]);const s=o=>o[68].chapterName;for(let o=0;o<i.length;o+=1){let l=Er(r,i,o),c=s(l);n.set(c,e[o]=Mr(c,l))}return{c(){t=lt("div");for(let o=0;o<e.length;o+=1)e[o].c();et(t,"class","wa-draft-list")},m(o,l){bt(o,t,l);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);a=!0},p(o,l){if(l[0]&1610620928|l[1]&7){i=xe(o[13]),Qt();for(let c=0;c<e.length;c+=1)e[c].r();e=ia(e,l,s,1,o,i,n,t,bi,Mr,null,Er);for(let c=0;c<e.length;c+=1)e[c].a();te()}},i(o){if(!a){for(let l=0;l<i.length;l+=1)q(e[l]);a=!0}},o(o){for(let l=0;l<e.length;l+=1)J(e[l]);a=!1},d(o){o&&gt(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function Do(r){let t;return{c(){t=lt("div"),t.textContent="No chapters found.",Fe(t,"margin-top","1em")},m(e,n){bt(e,t,n)},p:Dt,i:Dt,o:Dt,d(e){e&&gt(t)}}}function Po(r){let t;return{c(){t=lt("div"),t.textContent="Loading chapters..."},m(e,n){bt(e,t,n)},p:Dt,i:Dt,o:Dt,d(e){e&&gt(t)}}}function jo(r){let t,e;return t=new Ca({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function No(r){let t,e;return t=new $a({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ao(r){let t,e;return t=new Sa({props:{size:je}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function To(r){let t,e;return t=new Fa({props:{size:je}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Bo(r){let t,e;return t=new xa({props:{size:je}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Dt,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){J(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Mr(r,t){let e,n,a=t[68].chapterName+"",i,s,o,l,c,u,m,g,f,p,d,b,h,v,y=Dt,k;function $(){return t[55](t[70])}l=new $e({props:{title:"Move chapter up",clickHandler:$,disabled:t[13].length<=1||t[70]===0,$$slots:{default:[jo]},$$scope:{ctx:t}}});function P(){return t[56](t[70])}u=new $e({props:{title:"Move chapter down",clickHandler:P,disabled:t[13].length<=1||t[70]===t[13].length-1,$$slots:{default:[No]},$$scope:{ctx:t}}});function j(){return t[57](t[68])}g=new ce({props:{ariaLabel:"Open chapter",title:void 0,clickHandler:j,$$slots:{default:[Ao]},$$scope:{ctx:t}}});function I(){return t[58](t[68])}p=new ce({props:{ariaLabel:"Rename chapter",title:void 0,clickHandler:I,$$slots:{default:[To]},$$scope:{ctx:t}}});function N(){return t[59](t[68])}return b=new ce({props:{ariaLabel:"Delete chapter",title:void 0,clickHandler:N,$$slots:{default:[Bo]},$$scope:{ctx:t}}}),{key:r,first:null,c(){e=lt("div"),n=lt("div"),i=Wt(a),s=wt(),o=lt("div"),ht(l.$$.fragment),c=wt(),ht(u.$$.fragment),m=wt(),ht(g.$$.fragment),f=wt(),ht(p.$$.fragment),d=wt(),ht(b.$$.fragment),h=wt(),et(n,"class","wa-draft-name"),et(o,"class","wa-draft-actions"),et(e,"class","wa-draft-item"),this.first=e},m(T,Q){bt(T,e,Q),nt(e,n),nt(n,i),nt(e,s),nt(e,o),ut(l,o,null),nt(o,c),ut(u,o,null),nt(o,m),ut(g,o,null),nt(o,f),ut(p,o,null),nt(o,d),ut(b,o,null),nt(e,h),k=!0},p(T,Q){t=T,(!k||Q[0]&8192)&&a!==(a=t[68].chapterName+"")&&Je(i,a);const E={};Q[0]&8192&&(E.clickHandler=$),Q[0]&8192&&(E.disabled=t[13].length<=1||t[70]===0),Q[2]&4096&&(E.$$scope={dirty:Q,ctx:t}),l.$set(E);const R={};Q[0]&8192&&(R.clickHandler=P),Q[0]&8192&&(R.disabled=t[13].length<=1||t[70]===t[13].length-1),Q[2]&4096&&(R.$$scope={dirty:Q,ctx:t}),u.$set(R);const _={};Q[0]&8192&&(_.clickHandler=j),Q[2]&4096&&(_.$$scope={dirty:Q,ctx:t}),g.$set(_);const U={};Q[0]&8192&&(U.clickHandler=I),Q[2]&4096&&(U.$$scope={dirty:Q,ctx:t}),p.$set(U);const at={};Q[0]&8192&&(at.clickHandler=N),Q[2]&4096&&(at.$$scope={dirty:Q,ctx:t}),b.$set(at)},r(){v=e.getBoundingClientRect()},f(){ci(e),y()},a(){y(),y=li(e,v,lo,{duration:500,easing:Ea})},i(T){k||(q(l.$$.fragment,T),q(u.$$.fragment,T),q(g.$$.fragment,T),q(p.$$.fragment,T),q(b.$$.fragment,T),k=!0)},o(T){J(l.$$.fragment,T),J(u.$$.fragment,T),J(g.$$.fragment,T),J(p.$$.fragment,T),J(b.$$.fragment,T),k=!1},d(T){T&&gt(e),dt(l),dt(u),dt(g),dt(p),dt(b)}}}function Oo(r){var y;let t,e,n,a,i,s,o,l,c,u,m,g,f,p;s=new ce({props:{ariaLabel:"Refresh projects",clickHandler:r[41],title:void 0,spinning:r[6],$$slots:{default:[co]},$$scope:{ctx:r}}}),c=new $e({props:{title:"Create New Project",clickHandler:r[35],variant:"primary",style:"width: 40%; margin: 0 auto;",$$slots:{default:[fo]},$$scope:{ctx:r}}});let d=r[2].length===0&&Pr(),b=r[2].length>0&&jr(r),h=r[4]&&Nr(r),v=r[4]&&((y=r[0])==null?void 0:y.activeDraft)&&r[18]&&zr(r);return{c(){t=lt("div"),e=lt("div"),n=lt("div"),n.textContent=`${Et} Projects`,a=wt(),i=lt("div"),ht(s.$$.fragment),o=wt(),l=lt("div"),ht(c.$$.fragment),u=wt(),d&&d.c(),m=wt(),b&&b.c(),g=wt(),h&&h.c(),f=wt(),v&&v.c(),et(n,"class","wa-title"),et(e,"class","wa-row justify-between"),et(l,"class","wa-row"),Fe(l,"margin","18px 0 10px 0"),et(t,"class","project-list wa-panel")},m(k,$){bt(k,t,$),nt(t,e),nt(e,n),nt(e,a),nt(e,i),ut(s,i,null),nt(t,o),nt(t,l),ut(c,l,null),nt(t,u),d&&d.m(t,null),nt(t,m),b&&b.m(t,null),nt(t,g),h&&h.m(t,null),nt(t,f),v&&v.m(t,null),p=!0},p(k,$){var I;const P={};$[0]&64&&(P.spinning=k[6]),$[2]&4096&&(P.$$scope={dirty:$,ctx:k}),s.$set(P);const j={};$[2]&4096&&(j.$$scope={dirty:$,ctx:k}),c.$set(j),k[2].length===0?d||(d=Pr(),d.c(),d.m(t,m)):d&&(d.d(1),d=null),k[2].length>0?b?(b.p(k,$),$[0]&4&&q(b,1)):(b=jr(k),b.c(),q(b,1),b.m(t,g)):b&&(Qt(),J(b,1,1,()=>{b=null}),te()),k[4]?h?(h.p(k,$),$[0]&16&&q(h,1)):(h=Nr(k),h.c(),q(h,1),h.m(t,f)):h&&(Qt(),J(h,1,1,()=>{h=null}),te()),k[4]&&((I=k[0])!=null&&I.activeDraft)&&k[18]?v?(v.p(k,$),$[0]&262161&&q(v,1)):(v=zr(k),v.c(),q(v,1),v.m(t,null)):v&&(Qt(),J(v,1,1,()=>{v=null}),te())},i(k){p||(q(s.$$.fragment,k),q(c.$$.fragment,k),q(b),q(h),q(v),p=!0)},o(k){J(s.$$.fragment,k),J(c.$$.fragment,k),J(b),J(h),J(v),p=!1},d(k){k&&gt(t),dt(s),dt(c),d&&d.d(),b&&b.d(),h&&h.d(),v&&v.d()}}}let Ro=!1,Io="";const je=20;let zo=null;function Lo(r,t,e){let{manager:n}=t,{projectService:a}=t,{projectFileService:i}=t,s=null,o=[],l,c=null,u=[],m=!1,g=[],f=!1,p=!1,d="",b=!0,h=null,v=null,y=[],k=!1,$=!1,P="",j="",I=!1,N=!1,T=null,Q=0;Un(()=>{try{n&&v&&n.removeActiveProjectListener(v),T&&clearTimeout(T)}catch{}});async function E(Y=!1){if(!a)return[];e(6,m=!0);const ft=new Promise(Tt=>setTimeout(Tt,400)),yt=[...o],pt=s;let Ot=[],jt=[];try{Ot=a.listAllFolders(),jt=[];for(const Tt of Ot)await a.isProjectFolder(Tt)&&jt.push(Tt)}catch{jt=[]}const It=jt.filter(Tt=>!yt.includes(Tt)),Ce=yt.filter(Tt=>!jt.includes(Tt));Y&&It.length>0&&new D.Notice(`${It.length} new project${It.length>1?"s":""} discovered.`),Y&&Ce.length>0&&new D.Notice(`${Ce.length} project${Ce.length>1?"s":""} removed.`),e(2,o=jt),e(7,g=jt.map(Tt=>({value:Tt,label:Tt})));let oe=null;if(jt.length===0)e(1,s=null),e(3,l=void 0),e(4,c=null),oe=null;else if(jt.length===1){e(1,s=jt[0]),e(3,l=g[0]),e(4,c=jt[0]),oe=jt[0];try{F(`${S} panel refresh selected single project '${c}'`)}catch{}}else if(pt&&!jt.includes(pt)){e(1,s=jt[0]),e(3,l=g[0]),e(4,c=jt[0]),oe=jt[0];try{F(`${S} panel refresh selected fallback project '${c}'`)}catch{}}else if(pt){const Tt=g.find(Ne=>Ne.value===pt);if(Tt){e(1,s=pt),e(3,l=Tt),e(4,c=Tt.value),oe=pt;try{F(`${S} panel refresh kept project '${c}'`)}catch{}}else e(1,s=null),e(3,l=void 0),e(4,c=null),oe=null}else e(1,s=null),e(3,l=void 0),e(4,c=null),oe=null;return n&&oe!==pt&&(F(`${S} panel refresh: active project changed from '${pt}' to '${oe}'`),n!=null&&n.setActiveProject&&await n.setActiveProject(oe)),await ft,e(6,m=!1),c&&await R(),c&&(n!=null&&n.activeDraft)&&await _(),jt}async function R(){if(!i||!c){e(5,u=[]);return}const Y=h;e(8,f=!0);const ft=new Promise(yt=>setTimeout(yt,600));try{e(5,u=i.drafts.listDrafts(c)||[]),e(5,u=Array.from(u)),u.sort((yt,pt)=>yt>pt?1:yt<pt?-1:0),b||u.reverse();try{F(`${S} refreshDrafts: loaded ${u.length} drafts, preserving active draft: ${Y}`)}catch{}}catch{e(5,u=[])}finally{await ft,e(8,f=!1)}}async function _(){if(!n||!i)return;const Y=Date.now();if(Y-Q<500){T&&clearTimeout(T),T=setTimeout(()=>{U()},500);return}Q=Y,T&&clearTimeout(T),T=null,await U()}async function U(){if(!n||!i)return;e(14,k=!0);const Y=new Promise(ft=>setTimeout(ft,600));try{if(!c){e(13,y=[]),e(18,I=!1);return}const ft=`${c}/${Gt(n==null?void 0:n.settings)}`,yt=await ke(n.app,ft);if(e(18,I=(yt==null?void 0:yt.project_type)==="multi-file"),!I){e(13,y=[]);return}if(!(n!=null&&n.activeDraft)){e(13,y=[]);return}let pt=[];pt=await i.chapters.listChapters(c,n.activeDraft),e(13,y=Array.isArray(pt)?pt:[])}catch{e(13,y=[]),e(18,I=!1)}finally{await Y,e(14,k=!1)}}async function at(){if(!n||!c||!d.trim())return;const Y=d.trim();try{await n.createNewDraft(Y,Io||void 0,c),e(12,h=n.activeDraft),new D.Notice(`Draft "${Y}" created.`)}catch(ft){F(`${S} Failed to create draft:`,ft),new D.Notice("Failed to create draft.")}e(10,d=""),e(9,p=!1),await R()}async function V(){e(9,p=!0)}async function it(Y){if(!i||!n||!c)return;let ft=!1;ft=await i.drafts.openDraft(c,Y),ft||n!=null&&n.setActiveDraft&&await n.setActiveDraft(Y,c),await R(),await _()}async function Z(Y){if(!n||!c)return;const ft=`${Y} Copy`;new io(n.app,{sourceDraftName:Y,suggestedName:ft,onSubmit:async yt=>{if(n)try{await n.createNewDraft(yt,Y,c||void 0),await R(),new D.Notice(`Draft '${yt}' created as duplicate of '${Y}'.`)}catch(pt){F(`${S} Failed to duplicate draft:`,pt),new D.Notice("Failed to duplicate draft.")}}}).open()}async function ct(Y){if(!n||!c)return;new oo(n.app,Y,async(yt,pt)=>{try{F(`${S} renameDraft: user entered: ${yt}, renameFile: ${pt}`),await n.renameDraft(Y,yt,c||void 0,pt),F(`${S} renameDraft: rename successful, refreshing drafts`),await R(),new D.Notice(`Draft '${Y}' renamed to '${yt}'.`)}catch(Ot){F(`${S} renameDraft: error:`,Ot),new D.Notice("Failed to rename draft.")}}).open()}async function z(Y){if(!n||!c)return;new xr(n.app,Y,async()=>{n&&(await n.deleteDraft(Y,c||void 0),await R())},"draft").open()}async function O(Y){Y&&(n!=null&&n.setActiveProject&&await n.setActiveProject(Y),e(1,s=Y),e(4,c=Y),e(12,h=(n==null?void 0:n.activeDraft)??null),await R(),await _())}async function st(Y){if(Y===0||!n||!c||!n.activeDraft)return;const ft=y.slice();[ft[Y-1],ft[Y]]=[ft[Y],ft[Y-1]];const yt=ft.map((pt,Ot)=>({chapterName:pt.chapterName||"",order:Ot+1}));await n.reorderChapters(c,n.activeDraft,yt),await _()}async function M(Y){if(Y===y.length-1||!n||!c||!n.activeDraft)return;const ft=y.slice();[ft[Y],ft[Y+1]]=[ft[Y+1],ft[Y]];const yt=ft.map((pt,Ot)=>({chapterName:pt.chapterName||"",order:Ot+1}));await n.reorderChapters(c,n.activeDraft,yt),await _()}async function K(Y){!c||!(n!=null&&n.activeDraft)||await n.openChapter(c,n.activeDraft,Y)}function Ct(Y){if(!c||!(n!=null&&n.activeDraft))return;new so(n.app,Y,async yt=>{!(n!=null&&n.activeDraft)||!c||(await n.renameChapter(c,n.activeDraft,Y,yt),await _())}).open()}function At(Y){new xr(n.app,Y,async()=>{!(n!=null&&n.activeDraft)||!c||(await n.deleteChapter(c,n.activeDraft,Y),await _())},"chapter").open()}async function vt(Y){c&&(n!=null&&n.setActiveDraft&&await n.setActiveDraft(Y,c),e(12,h=(n==null?void 0:n.activeDraft)??null),await R(),await _())}async function $t(){if(!n||!a)return;const Y=n.app,{CreateProjectModal:ft}=await Promise.resolve().then(()=>ol);let yt=null;new ft(Y,async(Ot,jt,It)=>{if(!Ot||!n||!a)return;const Ce=n.listAllFolders();if((await Se(Ce,Kt=>n.projectService.isProjectFolder(Kt))).map(Kt=>Kt.split("/").pop()||Kt).includes(Ot)){new D.Notice(`A project with the name "${Ot}" already exists. Please choose a different name.`);return}if(yt=await a.createProject(Ot,jt,It,void 0,n.settings),!yt)return;let Ne=[],qt=null;for(let Kt=0;Kt<20;Kt++){await new Promise(En=>setTimeout(En,100)),Ne=await E();const Ae=Ne.find(En=>En===yt);if(qt=typeof Ae=="string"?Ae:null,qt)break}typeof qt=="string"&&qt&&(e(1,s=qt),e(3,l={value:qt,label:qt}),e(4,c=qt),n.setActiveDraft&&await n.setActiveDraft(It??"Draft 1",qt),await R(),await _(),n.openProject&&await n.openProject(qt))}).open()}let xt=null;Un(()=>{Mt(()=>{n&&typeof n.removeActiveDraftListener=="function"&&xt&&n.removeActiveDraftListener(xt)}),Mt(()=>{n&&typeof n.removeActiveProjectListener=="function"&&v&&n.removeActiveProjectListener(v)})});const Pt=()=>E(!0),se=Y=>{const ft=Y.detail;e(3,l=ft),e(4,c=typeof ft=="string"?ft:ft?ft.value:void 0),e(1,s=c??null),O(c??null)},Yt=()=>{e(11,b=!b),R()};function w(){d=this.value,e(10,d)}const W=()=>{e(9,p=!1),e(10,d="")},L=Y=>it(Y),x=Y=>vt(Y),C=Y=>ct(Y),A=Y=>Z(Y),H=Y=>z(Y),G=()=>e(15,$=!$);function B(){P=this.value,e(16,P)}const X=async()=>{!c||!(n!=null&&n.activeDraft)||!P.trim()||(await n.createChapter(c,n.activeDraft,P.trim()),e(16,P=""),e(17,j=""),e(15,$=!1),await _())},rt=()=>{e(15,$=!1),e(16,P=""),e(17,j="")},tt=Y=>st(Y),ot=Y=>M(Y),St=Y=>K(Y.name),_t=Y=>Ct(Y.chapterName||""),Zt=Y=>At(Y.chapterName||"");return r.$$set=Y=>{"manager"in Y&&e(0,n=Y.manager),"projectService"in Y&&e(36,a=Y.projectService),"projectFileService"in Y&&e(37,i=Y.projectFileService)},r.$$.update=()=>{r.$$.dirty[0]&1|r.$$.dirty[1]&992&&n&&a&&i&&!N&&(e(39,N=!0),F(`${S} ProjectPanel initializing with manager`),e(12,h=n.activeDraft??null),e(1,s=n.activeProject??null),xt&&typeof n.removeActiveDraftListener=="function"&&n.removeActiveDraftListener(xt),e(40,xt=Y=>{e(12,h=Y),F(`${S} active draft updated -> ${Y}`),_()}),n.addActiveDraftListener(xt),v&&typeof n.removeActiveProjectListener=="function"&&n.removeActiveProjectListener(v),e(38,v=Y=>{e(1,s=Y),F(`${S} active project updated -> ${Y}`),Y?E():(e(3,l=void 0),e(4,c=null),e(5,u=[]),e(13,y=[]),e(18,I=!1))}),n.addActiveProjectListener(v),E())},[n,s,o,l,c,u,m,g,f,p,d,b,h,y,k,$,P,j,I,E,R,_,at,V,it,Z,ct,z,O,st,M,K,Ct,At,vt,$t,a,i,v,N,xt,Pt,se,Yt,w,W,L,x,C,A,H,G,B,X,rt,tt,ot,St,_t,Zt]}class Mo extends Vt{constructor(t){super(),Ht(this,t,Lo,Oo,Lt,{manager:0,projectService:36,projectFileService:37},null,[-1,-1,-1])}}const _e="writeaid-project-panel";class Uo extends D.ItemView{constructor(t,e,n){super(t),this.panelEl=null,this.selectedProject=null,this.app=e,this.manager=n,this.projectService=new mn(e),this.projectFileService=new Kn(e,this.projectService)}getViewType(){return _e}getDisplayText(){return`${Et} Projects`}getIcon(){return Gn}async onOpen(){this.panelEl=this.contentEl.createEl("div",{cls:"writeaid-project-panel"});try{if(!this.manager){F(`${S} Manager not available in ProjectPanelView.onOpen`),new D.Notice(`${Et}: manager not available, cannot mount project panel.`);return}F(`${S} Mounting ProjectPanel with manager:`,!!this.manager),this.projectPanel=new Mo({target:this.panelEl,props:{manager:this.manager,projectService:this.projectService,projectFileService:this.projectFileService}}),F(`${S} ProjectPanel mounted successfully`)}catch(t){F(`${S} failed to mount project panel:`,t),new D.Notice(`${Et}: failed to mount project panel. Check console for details.`)}}async onClose(){if(this.projectPanel){try{this.projectPanel.$destroy()}catch(t){F(`${S} Error destroying project panel:`,t)}this.projectPanel=void 0}}refreshDraftsSection(){this.projectPanel&&typeof this.projectPanel.refreshDrafts=="function"&&(F(`${S} Refreshing drafts section in project panel`),this.projectPanel.refreshDrafts())}}function Wo(r){return async()=>{F(`${S} List backups command called`);let t;const e=r.app.workspace.getLeavesOfType(_e);if(e.length>0){const a=e[0].view;t=()=>{a.refreshDraftsSection()}}new La(r.app,r,t).open()}}function Ho(r){return()=>(F(`${S} Create new draft command called`),r.createNewDraftPrompt())}async function Vo(r){F(`${S} createOutlineCommand called`);try{const t=r.activeProject,e=r.activeDraft;if(!t||!e){new D.Notice("No active project or draft selected. Please select a project and draft first.");return}const n=r.projectFileService.drafts.getOutlineFile(t,e);if(n){new D.Notice(`Outline file already exists: ${n.path}`);return}await r.projectFileService.drafts.createOutline(t,e,r.settings.outlineTemplate),new D.Notice(`Outline created for draft: ${e}`),F(`${S} Outline created successfully for draft: ${e}`)}catch(t){F(`${S} Error creating outline:`,t),new D.Notice(`Failed to create outline: ${t.message}`)}}function Zo(r){return async()=>{var i;const t=r.projectFileService.drafts,e=r.activeProject,n=r.activeDraft;if(F(`${S} Generate manuscript command called`),F(`${S} Active project: ${e}, active draft: ${n}`),F(`${S} Manager settings manuscript template: ${(i=r.settings)==null?void 0:i.manuscriptNameTemplate}`),!Xe(e,n))return;await t.generateManuscript(e,n,r.settings)?new D.Notice("Manuscript generated successfully."):new D.Notice("Failed to generate manuscript.")}}function Ur(r){const t={},e=r.match(zt);if(e){const n=e[1],a=n.match(/^id:\s*(.+?)$/m),i=n.match(/^draft:\s*(.+?)$/m),s=n.match(/^project:\s*(.+?)$/m),o=n.match(/^created:\s*(.+?)$/m);a&&(t.id=a[1].trim()),i&&(t.draft=i[1].trim()),s&&(t.project=s[1].trim()),o&&(t.created=o[1].trim())}return t}function Wr(r){return!!(r.id&&r.draft&&r.project&&r.created)}function An(r,t,e){return{id:r.id||Re(),draft:r.draft||t,project:r.project||e,created:r.created||new Date().toISOString()}}function Tn(r,t){const e=r.match(zt);if(e){const n=e[1],a=r.substring(e[0].length),i=n.split(`
`),s=[],o=new Set;for(const c of i)c.match(/^id:/i)?(s.push(`id: ${t.id}`),o.add("id")):c.match(/^draft:/i)?(s.push(`draft: ${t.draft}`),o.add("draft")):c.match(/^project:/i)?(s.push(`project: ${t.project}`),o.add("project")):c.match(/^created:/i)?(s.push(`created: ${t.created}`),o.add("created")):s.push(c);o.has("id")||s.push(`id: ${t.id}`),o.has("draft")||s.push(`draft: ${t.draft}`),o.has("project")||s.push(`project: ${t.project}`),o.has("created")||s.push(`created: ${t.created}`);const l=s.join(`
`);return`${Ft}
${l}
${Ft}${a}`}else return`${Ft}
id: ${t.id}
draft: ${t.draft}
project: ${t.project}
created: ${t.created}
${Ft}

`+r}class Go extends D.SuggestModal{constructor(t,e,n){super(t),this.onSelect=n,this.files=[],this.files=e,this.setPlaceholder("Select a file to initialize as draft file..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"esc",purpose:"to cancel"}]),this.setTitle("Select File for Draft Metadata")}getSuggestions(){return this.files}renderSuggestion(t,e){e.createEl("div",{text:t.name})}async onChooseSuggestion(t){await this.onSelect(t)}}function Yo(r){return async()=>{const t=r.activeProject,e=r.activeDraft;F(`${S} Initialize draft file command called`),F(`${S} Active project: ${t}, active draft: ${e}`);try{if(!Xe(t,e)){F(`${S} Initialize draft file: active project/draft check failed`);return}if(!t||!e){F(`${S} Initialize draft file: no active project or draft`),new D.Notice("Active project or draft not found.");return}const n=Bt(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const g of a.children)if(g instanceof D.TFolder&&g.name.toLowerCase()===n.toLowerCase()){i=g.name;break}}const s=`${t}/${i}/${e}`,o=t.split("/").pop()||t;F(`${S} Initialize draft file: using drafts folder: ${i}`);const l=r.app.vault.getAbstractFileByPath(s);if(!l||!(l instanceof D.TFolder)){F(`${S} Initialize draft file: draft folder not found at ${s}`),new D.Notice("Draft folder not found.");return}const c=l.children.filter(g=>g instanceof D.TFile&&g.extension==="md").filter(g=>!g.path.includes("/Chapters/")&&g.name!=="outline.md");if(F(`${S} Found ${c.length} markdown files in draft folder`),c.length===0){F(`${S} No files found, creating new draft file`);const g=An({},e,o),f=Tn("",g),p=`${e}${mt}`;await r.app.vault.create(`${s}/${p}`,f),new D.Notice(`Draft file created with metadata for "${e}".`);return}if(c.length===1){const g=c[0],f=await r.app.vault.read(g),p=Ur(f);if(Wr(p)){F(`${S} Initialize draft file: file already has complete metadata`),new D.Notice(`"${g.name}" already has complete draft metadata.`);return}F(`${S} Adding missing metadata to ${g.name}`);const d=An(p,e,o),b=Tn(f,d);await r.app.vault.modify(g,b),F(`${S} Initialize draft file: successfully updated ${g.name}`),new D.Notice(`Draft metadata added to "${g.name}".`);return}F(`${S} Multiple files found, showing selection modal`);const u=c.map(g=>({path:g.path,name:g.name,file:g}));new Go(r.app,u,async g=>{const f=g.file,p=await r.app.vault.read(f),d=Ur(p);if(Wr(d)){F(`${S} Initialize draft file: selected file already has complete metadata`),new D.Notice(`"${f.name}" already has complete draft metadata.`);return}F(`${S} Adding missing metadata to ${f.name}`);const b=An(d,e,o),h=Tn(p,b);await r.app.vault.modify(f,h),F(`${S} Initialize draft file: successfully updated ${f.name} from modal`),new D.Notice(`Draft metadata added to "${f.name}".`)}).open()}catch(n){F(`${S} Initialize draft file command error:`,n),new D.Notice("Failed to initialize draft file metadata.")}}}function qo(r){return()=>(F(`${S} Switch draft command called`),r.switchDraftPrompt())}function Ko(r){return async()=>{F(`${S} Navigate to next chapter command called`);const t=r.app.workspace.getActiveFile();if(!t){F(`${S} navigateToNextChapter: no active file`),new D.Notice("No file is currently open.");return}const e=t.path,n=Bt(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${mt}$`));if(!a){F(`${S} navigateToNextChapter: file is not a chapter`),new D.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{F(`${S} navigateToNextChapter: looking for next chapter after ${o}`);const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(m=>m.name===o);if(c===-1){new D.Notice("Unable to find the current chapter in the draft.");return}if(c>=l.length-1)return;const u=l[c+1];await r.openChapter(i,s,u.name)}catch(l){F(`${S} Failed to navigate to next chapter:`,l),new D.Notice("Failed to navigate to next chapter.")}}}function Xo(r){return async()=>{F(`${S} Navigate to previous chapter command called`);const t=r.app.workspace.getActiveFile();if(!t){F(`${S} navigateToPreviousChapter: no active file`),new D.Notice("No file is currently open.");return}const e=t.path,n=Bt(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${mt}$`));if(!a){F(`${S} navigateToPreviousChapter: file is not a chapter`),new D.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{F(`${S} navigateToPreviousChapter: looking for previous chapter before ${o}`);const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(m=>m.name===o);if(c===-1){F(`${S} navigateToPreviousChapter: current chapter not found`),new D.Notice("Unable to find the current chapter in the draft.");return}if(c<=0){F(`${S} navigateToPreviousChapter: already at first chapter`);return}const u=l[c-1];await r.openChapter(i,s,u.name)}catch(l){F(`${S} Failed to navigate to previous chapter:`,l),new D.Notice("Failed to navigate to previous chapter.")}}}async function Jo(r,t,e){const n=`${t}/${Gt(e)}`,a=await ke(r,n);if(!a||a.project_type!==Rt.SINGLE)return new D.Notice(`Project is not a ${Rt.SINGLE} project.`),!1;a.project_type=Rt.MULTI,await qn(r,n,a);const i=Bt(e),s=r.vault.getAbstractFileByPath(`${t}/${i}`);if(!s||!(s instanceof D.TFolder))return new D.Notice("Drafts folder not found."),!1;let o=!1;for(const l of s.children)if(l instanceof D.TFolder){const c=Xt(l.name),u=l.children.find(m=>m instanceof D.TFile&&m.name===`${c}${mt}`);if(u){const m=`${l.path}/Chapter 1${mt}`;if(u.path!==m){const g=await r.vault.read(u);await r.vault.create(m,g),await r.vault.delete(u),o=!0}}}return o?new D.Notice(`Converted to multi-file project. Draft files renamed to "Chapter 1${mt}".`):new D.Notice("Converted to multi-file project. No draft files needed renaming."),!0}async function Qo(r,t,e){if(!t){new D.Notice("No active project selected.");return}await Jo(r,t,e)}function tl(r){return()=>(F(`${S} Create new project command called`),r.createNewProjectPrompt())}function el(r){return async()=>{const t=r.activeProject;if(F(`${S} Open project meta command called`),!t){new D.Notice("No active project.");return}try{const e=Gt(r.settings),n=`${t}/${e}`,a=r.app.vault.getAbstractFileByPath(n);if(!a||!(a instanceof D.TFile)){new D.Notice(`Meta file not found: ${e}`);return}const i=r.app.workspace.getLeaf();await(i==null?void 0:i.openFile(a)),F(`${S} Opened project meta file: ${n}`)}catch(e){F(`${S} Error opening project meta file:`,e),new D.Notice("Failed to open project meta file.")}}}function nl(r){return()=>(F(`${S} Select active project command called`),r.selectActiveProjectPrompt())}function rl(r,t){return()=>{F(`${S} Toggle project panel command called`);const e={type:_e,active:!0},n=t.workspace.getLeavesOfType(_e);if(n.length>0){F(`${S} Revealing existing project panel`);const a=n[0];t.workspace.revealLeaf(a)}else{F(`${S} Creating new project panel`);let a=t.workspace.getRightLeaf(!1);a||(a=t.workspace.getRightLeaf(!0)),a.setViewState(e),t.workspace.revealLeaf(a)}}}function al(r){return()=>(F(`${S} Update project metadata command called`),r.updateProjectMetadataPrompt())}class il extends D.Modal{constructor(t,e,n,a){super(t),this.path=e,this.onCreateAnyway=n,this.onOpenExisting=a}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project already exists"}),t.createEl("p",{text:`A folder named '${this.path}' already exists in the vault.`}),new D.Setting(t).addButton(e=>e.setButtonText("Open Existing").onClick(()=>{F(`${S} ConfirmExistingProjectModal: opening existing project "${this.path}"`),this.close(),this.onOpenExisting()})),new D.Setting(t).addButton(e=>e.setButtonText("Create Anyway").setCta().onClick(()=>{F(`${S} ConfirmExistingProjectModal: creating new project anyway "${this.path}"`),this.close(),this.onCreateAnyway(!0)})),new D.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{F(`${S} ConfirmExistingProjectModal: cancelled for project "${this.path}"`),this.close()}))}onClose(){this.contentEl.empty()}}class sl extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Draft"});const e=this.props.suggestedName;let n="",a="";new D.Setting(t).setName("Draft name").addText(s=>s.setPlaceholder(e).onChange(o=>n=o));const i=this.props.drafts;i.length>0&&new D.Setting(t).setName("Copy from existing draft").addDropdown(s=>{s.addOption("","Start blank");for(const o of i)s.addOption(o,o);s.onChange(o=>a=o)}),new D.Setting(t).addButton(s=>s.setButtonText("Create").setCta().onClick(()=>{const o=n&&n.trim()?n.trim():e;F(`${S} CreateDraftModal: creating draft "${o}", copyFrom: "${a||"none"}"`),this.close(),this.props.onSubmit(o,a||void 0)}))}onClose(){this.contentEl.empty()}}class Da extends D.Modal{constructor(t,e){super(t),this.onSubmit=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Project"});let e="",n=!0,a="Draft 1";new D.Setting(t).setName("Project folder name").addText(i=>i.onChange(s=>e=s)),new D.Setting(t).setName("Project type").addDropdown(i=>{i.addOption("single","Single-file project"),i.addOption("multi","Multi-file project (chapters)"),i.onChange(s=>n=s==="single")}),new D.Setting(t).setName("Initial draft name (optional)").addText(i=>i.setPlaceholder("Draft 1").onChange(s=>a=s||"Draft 1")),new D.Setting(t).addButton(i=>i.setButtonText("Create Project").setCta().onClick(()=>{F(`${S} CreateProjectModal: creating project "${e}", singleFile: ${n}, initialDraftName: ${a}`),this.close(),this.onSubmit(e,n,a||void 0)}))}onClose(){this.contentEl.empty()}}const ol=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectModal:Da},Symbol.toStringTag,{value:"Module"}));class Bn extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Select Project for Draft"});let e="";const n=this.props.folders||[];new D.Setting(t).setName("Project folder").addDropdown(a=>{a.addOption("","(Vault root)");for(const i of n)a.addOption(i,i||"(Vault root)");a.onChange(i=>e=i)}),new D.Setting(t).addButton(a=>a.setButtonText("Select").setCta().onClick(()=>{F(`${S} SelectProjectModal: selected project "${e||"(Vault root)"}"`),this.close(),this.props.onSubmit(e||"")}))}onClose(){this.contentEl.empty()}}class ll extends D.Modal{constructor(t,e,n){super(t),this.drafts=e,this.onSubmit=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Switch Active Draft"});for(const e of this.drafts)new D.Setting(t).setName(e).addButton(n=>n.setButtonText("Select").onClick(()=>{F(`${S} SwitchDraftModal: selected draft "${e}"`),this.close(),this.onSubmit(e)}))}onClose(){this.contentEl.empty()}}class cl{constructor(t,e,n){var a;this.activeDraft=null,this.activeProject=null,this.activeProjectListeners=[],this.activeDraftListeners=[],this.panelRefreshListeners=[],this._panelRefreshTimer=null,this._panelRefreshDebounceMs=250,this.app=t,this.plugin=e,this.settings=e==null?void 0:e.settings,typeof n=="number"&&Number.isFinite(n)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(n))),this.activeProject=((a=this.settings)==null?void 0:a.activeProject)||null,this.projectService=new mn(t),this.projectFileService=new Kn(t,this.projectService,this.settings)}async reorderChapters(t,e,n){return await this.projectFileService.chapters.reorderChapters(t,e,n)}async listChapters(t,e){return await this.projectFileService.chapters.listChapters(t,e)}async createChapter(t,e,n){const a=Bt(this.settings),i=`${t}/${a}/${e}`,s=await this.projectFileService.drafts.getDraftId(i);return await this.projectFileService.chapters.createChapter(t,e,n,this.settings,s||void 0)}async deleteChapter(t,e,n){return await this.projectFileService.chapters.deleteChapter(t,e,n)}async renameChapter(t,e,n,a){return await this.projectFileService.chapters.renameChapter(t,e,n,a)}async openChapter(t,e,n){return await this.projectFileService.chapters.openChapter(t,e,n)}get panelRefreshDebounceMs(){return this._panelRefreshDebounceMs}set panelRefreshDebounceMs(t){typeof t=="number"&&Number.isFinite(t)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(t)))}addActiveProjectListener(t){this.activeProjectListeners.push(t)}addActiveDraftListener(t){this.activeDraftListeners.push(t)}removeActiveDraftListener(t){this.activeDraftListeners=this.activeDraftListeners.filter(e=>e!==t)}notifyActiveDraftListeners(t){for(const e of this.activeDraftListeners)Mt(()=>e(t))}addPanelRefreshListener(t){this.panelRefreshListeners.push(t)}removePanelRefreshListener(t){this.panelRefreshListeners=this.panelRefreshListeners.filter(e=>e!==t)}notifyPanelRefresh(){try{this._panelRefreshTimer&&clearTimeout(this._panelRefreshTimer),this._panelRefreshTimer=setTimeout(()=>{for(const t of this.panelRefreshListeners)Mt(()=>t());this._panelRefreshTimer=null},this._panelRefreshDebounceMs)}catch{for(const t of this.panelRefreshListeners)Mt(()=>t())}}removeActiveProjectListener(t){this.activeProjectListeners=this.activeProjectListeners.filter(e=>e!==t)}async setActiveProject(t){t&&(t=t.trim().replace(/^\/+/,"").replace(/\/+$/,"")),F(`${S} setActiveProject called with '${t}'`),this.activeProject=t,await Ut(async()=>{if(this.plugin){const e=this.plugin;e.settings||(e.settings={}),e.settings.activeProject=t??void 0,typeof e.saveSettings=="function"&&await e.saveSettings()}});for(const e of this.activeProjectListeners)Mt(()=>e(t))}async createNewProjectPrompt(){new Da(this.app,async(t,e,n,a)=>{if(!t){new D.Notice("Project name is required.");return}const i=this.listAllFolders();if((await Se(i,u=>this.projectService.isProjectFolder(u))).map(u=>u.split("/").pop()||u).includes(t)){new D.Notice(`A project with the name "${t}" already exists. Please choose a different name.`);return}const l=a&&a!==""?`${a}/${t}`:t;this.app.vault.getAbstractFileByPath(l)?new il(this.app,l,async u=>{u&&(await this.createNewProject(t,e,n,a),await this.openProject(l))},async()=>{await this.openProject(l)}).open():(await this.createNewProject(t,e,n,a),await this.openProject(l))}).open()}async openProject(t){return await this.projectService.openProject(t)}async createNewProject(t,e,n,a){const i=await this.projectService.createProject(t,e,n,a,this.settings);if(i){await this.setActiveProject(i);const s=n||"Draft 1";await this.setActiveDraft(s,i),Mt(()=>this.notifyPanelRefresh())}return i}listAllFolders(){return this.projectService.listAllFolders()}async createNewDraftPrompt(){const t=this.listAllFolders(),e=await Se(t,n=>this.projectService.isProjectFolder(n));new Bn(this.app,{folders:e,onSubmit:async n=>{const a=await this.suggestNextDraftName(n);new sl(this.app,{suggestedName:a,drafts:this.listDrafts(n),projectPath:n,onSubmit:async(i,s)=>{await this.createNewDraft(i,s,n),new D.Notice(`Draft "${i}" created in ${n}.`)}}).open()}}).open()}async switchDraftPrompt(){const t=this.listDrafts();if(t.length===0){new D.Notice("No drafts found in the current project.");return}new ll(this.app,t,async e=>{await this.setActiveDraft(e)&&new D.Notice(`Switched to draft: ${e}`)}).open()}async updateProjectMetadataPrompt(){if(this.activeProject){await He(this.app,this.activeProject,void 0,void 0,this.settings),new D.Notice(`Metadata updated for ${this.activeProject}`);return}(async()=>{const t=this.listAllFolders(),e=await Se(t,n=>this.projectService.isProjectFolder(n));new Bn(this.app,{folders:e,onSubmit:async n=>{await He(this.app,n,void 0,void 0,this.settings),new D.Notice(`Metadata updated for ${n}`)}}).open()})()}async selectActiveProjectPrompt(){const t=this.listAllFolders(),e=await Se(t,n=>this.projectService.isProjectFolder(n));if(e.length===0){new D.Notice(`No ${Et} projects found in the vault.`);return}new Bn(this.app,{folders:e,onSubmit:async n=>{await this.setActiveProject(n),new D.Notice(`Active project set to ${n}`)}}).open()}async createNewDraft(t,e,n){const a=n||this.activeProject||this.getCurrentProjectPath();if(!a){new D.Notice("No project folder detected. Please open a folder named after your project.");return}if(this.listDrafts(a).includes(t)){new D.Notice(`Draft with name "${t}" already exists. Please choose a different name.`);return}if(await this.projectFileService.drafts.createDraft(t,e,a,this.settings),Mt(()=>this.notifyPanelRefresh()),a&&t)try{await this.setActiveDraft(t,a,!1)}catch{}}listDrafts(t){return this.projectFileService.drafts.listDrafts(t)}async setActiveDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();return a?(this.activeDraft=t,await Ut(async()=>{F(`${S} Calculating word count for draft: ${t}`);const i=await this.projectFileService.drafts.calculateDraftWordCount(a,t);F(`${S} Word count calculated: ${i}`),await He(this.app,a,t,{current_draft_word_count:i},this.settings)}),this.notifyActiveDraftListeners(this.activeDraft),n&&new D.Notice(`Active draft set to ${t}`),!0):(n&&new D.Notice("No project selected to set active draft on."),!1)}async renameDraft(t,e,n,a=!1){const i=n||this.activeProject||this.getCurrentProjectPath();if(!i)return new D.Notice("No project selected to rename draft."),!1;const s=this.activeDraft===t;return await this.projectFileService.drafts.renameDraft(i,t,e,a,this.settings)?(s&&(this.activeDraft=e),new D.Notice(`Renamed draft ${t} → ${e}`),!0):(new D.Notice("Failed to rename draft."),!1)}async deleteDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();if(!a)return new D.Notice("No project selected to delete draft."),!1;if(await this.projectFileService.drafts.deleteDraft(a,t,n)){new D.Notice(`Deleted draft ${t}`);const s=this.listDrafts(a);if(s.length>0){if(this.activeDraft===t||!this.activeDraft){let o;if(s.length===1)o=s[0];else{const l=[...s].sort((c,u)=>c.localeCompare(u));if(this.activeDraft===t){const c=l.findIndex(u=>u===t);if(c!==-1){const u=c<l.length-1?c:0;o=l[u]}else o=l[0]}else o=this.activeDraft}await this.setActiveDraft(o,a,!1)}}else this.activeDraft=null,this.notifyActiveDraftListeners(null);return!0}return new D.Notice("Failed to delete draft."),!1}async suggestNextDraftName(t){return await this.projectFileService.drafts.suggestNextDraftName(t)}getCurrentProjectPath(){const t=this.app.workspace.getActiveFile();if(!t)return null;const e=t.parent;return e?e.path:null}}class fl extends D.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,F(`${S} Settings tab created`),typeof e.registerSettingsChangedCallback=="function"&&e.registerSettingsChangedCallback(()=>{F(`${S} Settings changed externally, refreshing UI`),this.containerEl&&this.containerEl.parentElement&&this.display()})}display(){const{containerEl:t}=this;t.empty(),t.createEl("h2",{text:`${Et} Settings`}),F(`${S} Displaying settings UI`);const e=this.plugin;t.createEl("h3",{text:"Templates"}),new D.Setting(t).setName("Include outline file on draft creation").setDesc("If enabled, each new draft will include an outline file using the outline template.").addToggle(o=>o.setValue(!!e.settings.includeDraftOutline).onChange(l=>{F(`${S} Include draft outline changed: ${l}`),e.settings.includeDraftOutline=l,e.saveSettings()})),new D.Setting(t).setName("Outline template").setDesc("Template for outline files. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for outline template`),new On(this.app,l=>{F(`${S} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Outline template").setDesc("Template for outline documents. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for outline template`),new On(this.app,l=>{F(`${S} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Chapter template").setDesc("Template for newly created chapter files. Use {{chapterTitle}}").addTextArea(o=>{o.setValue(e.settings.chapterTemplate||""),o.inputEl.setAttribute("data-setting","chapter")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for chapter template`),new On(this.app,l=>{F(`${S} Chapter template selected: ${l}`),e.settings.chapterTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Manuscript name template").setDesc("Template for manuscript filenames. Use {{draftName}}, {{projectName}}, and moment.js date qualifiers like {{YYYY-MM-DD}}").addText(o=>{o.setValue(e.settings.manuscriptNameTemplate||"{{draftName}}"),o.inputEl.setAttribute("data-setting","manuscript")}),new D.Setting(t).addButton(o=>o.setButtonText("Save Templates").setCta().onClick(async()=>{var m,g;F(`${S} Save Templates button clicked`);const l=t.querySelector('textarea[data-setting="outline"]'),c=t.querySelector('textarea[data-setting="chapter"]'),u=t.querySelector('input[data-setting="manuscript"]');F(`${S} Found inputs - outline: ${!!l}, chapter: ${!!c}, manuscript: ${!!u}`),F(`${S} Manuscript input value: "${u==null?void 0:u.value}"`),l&&(e.settings.outlineTemplate=l.value),c&&(e.settings.chapterTemplate=c.value),u&&(e.settings.manuscriptNameTemplate=u.value),F(`${S} Saving templates: outline=${(m=e.settings.outlineTemplate)==null?void 0:m.substring(0,50)}..., chapter=${(g=e.settings.chapterTemplate)==null?void 0:g.substring(0,50)}..., manuscript=${e.settings.manuscriptNameTemplate}`),await e.saveSettings(),new D.Notice("Templates saved successfully!")})),t.createEl("h3",{text:"Filenames"}),new D.Setting(t).setName("Draft filename slug style").setDesc("How per-draft main filenames are generated").addDropdown(o=>{o.addOption("compact","compact (draft1)"),o.addOption("kebab","kebab (draft-1)"),o.setValue(e.settings.slugStyle||"compact"),o.onChange(l=>{F(`${S} Slug style changed: ${l}`),e.settings.slugStyle=l,e.saveSettings();const c=t.querySelector(".wat-slug-preview");c&&(c.textContent=`Example: Draft 1 → ${Xt("Draft 1",l)}${mt}`)})});let n="Draft 1";new D.Setting(t).setName("Sample draft name").setDesc("Type a sample draft name to preview the generated filename").addText(o=>o.setPlaceholder("Draft 1").setValue(n).onChange(l=>{n=l||"Draft 1";const c=t.querySelector(".wat-slug-preview");if(c){const u=Xt(n,e.settings.slugStyle);c.textContent=`Example: ${n} → ${u}${mt}`}}));const a=t.createDiv({cls:"wat-slug-preview"}),i=Xt(n,e.settings.slugStyle);a.setText(`Example: ${n} → ${i}${mt}`),t.createEl("h3",{text:"Folders & Files"}),new D.Setting(t).setName("Drafts folder name").setDesc("Name of the folder containing draft subfolders (default: drafts)").addText(o=>o.setValue(e.settings.draftsFolderName||"drafts").onChange(l=>{F(`${S} Drafts folder name changed: ${l}`),e.settings.draftsFolderName=l||"drafts",e.saveSettings()})),new D.Setting(t).setName("Manuscripts folder name").setDesc("Name of the folder containing generated manuscripts (default: manuscripts)").addText(o=>o.setValue(e.settings.manuscriptsFolderName||"manuscripts").onChange(l=>{F(`${S} Manuscripts folder name changed: ${l}`),e.settings.manuscriptsFolderName=l||"manuscripts",e.saveSettings()})),new D.Setting(t).setName("Backups folder name").setDesc("Name of the folder containing draft backups (default: .writeaid-backups)").addText(o=>o.setValue(e.settings.backupsFolderName||".writeaid-backups").onChange(l=>{F(`${S} Backups folder name changed: ${l}`),e.settings.backupsFolderName=l||".writeaid-backups",e.saveSettings()})),new D.Setting(t).setName("Meta file name").setDesc(`Name of the project metadata file (default: ${ue.META})`).addText(o=>o.setValue(e.settings.metaFileName||ue.META).onChange(l=>{F(`${S} Meta file name changed: ${l}`),e.settings.metaFileName=l||ue.META,e.saveSettings()})),new D.Setting(t).setName("Outline file name").setDesc(`Name of the draft outline file (default: ${ue.OUTLINE})`).addText(o=>o.setValue(e.settings.outlineFileName||ue.OUTLINE).onChange(l=>{F(`${S} Outline file name changed: ${l}`),e.settings.outlineFileName=l||ue.OUTLINE,e.saveSettings()})),t.createEl("h3",{text:"Word Count Targets"}),new D.Setting(t).setName("Default target word count for multi-file projects").setDesc("Target word count automatically set for new multi-file projects (chapters)").addText(o=>o.setValue(String(e.settings.defaultMultiTargetWordCount??5e4)).setPlaceholder("50000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(F(`${S} Default multi-file target word count changed: ${c}`),e.settings.defaultMultiTargetWordCount=c,e.saveSettings())})),new D.Setting(t).setName(`Default target word count for ${Rt.SINGLE} projects`).setDesc(`Target word count automatically set for new ${Rt.SINGLE} projects`).addText(o=>o.setValue(String(e.settings.defaultSingleTargetWordCount??2e4)).setPlaceholder("20000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(F(`${S} Default ${Rt.SINGLE} target word count changed: ${c}`),e.settings.defaultSingleTargetWordCount=c,e.saveSettings())})),t.createEl("h3",{text:"Backup Settings"}),new D.Setting(t).setName("Maximum number of backups per draft").setDesc("Maximum number of backup files to keep per draft (default: 5)").addText(o=>o.setValue(String(e.settings.maxBackups??5)).setPlaceholder("5").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(F(`${S} Max backups changed: ${c}`),e.settings.maxBackups=c,e.saveSettings())})),new D.Setting(t).setName("Maximum backup age (days)").setDesc("Automatically delete backups older than this many days (default: 30)").addText(o=>o.setValue(String(e.settings.maxBackupAgeDays??30)).setPlaceholder("30").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(F(`${S} Max backup age changed: ${c}`),e.settings.maxBackupAgeDays=c,e.saveSettings())})),t.createEl("h3",{text:"UI & Startup"}),t.createEl("p",{text:"Most settings take effect immediately. Settings marked with ⚠️ require a plugin reload to take effect.",cls:"setting-item-description"}),new D.Setting(t).setName("Ribbon placement").setDesc(`Place the ${Et} icon on the left or right ribbon`).addDropdown(o=>{o.addOption("left","Left"),o.addOption("right","Right"),o.setValue(e.settings.ribbonPlacement||"left"),o.onChange(l=>{F(`${S} Ribbon placement changed: ${l}`),e.settings.ribbonPlacement=l,e.saveSettings(),typeof this.plugin.moveRibbon=="function"&&(l==="left"||l==="right")&&this.plugin.moveRibbon(l),this.display()})}),new D.Setting(t).setName("Always show ribbon").setDesc(`If enabled, the ${Et} ribbon icon will always be visible regardless of whether projects are detected`).addToggle(o=>o.setValue(!!e.settings.ribbonAlwaysShow).onChange(l=>{F(`${S} Always show ribbon changed: ${l}`),e.settings.ribbonAlwaysShow=l,e.saveSettings(),typeof this.plugin.refreshRibbonVisibility=="function"&&this.plugin.refreshRibbonVisibility()})),new D.Setting(t).setName("Auto-open project panel on startup").setDesc(`If enabled, the ${Et} project panel will open on plugin load when an active project is saved. ⚠️ Requires plugin reload to take effect.`).addToggle(o=>o.setValue(!!e.settings.autoOpenPanelOnStartup).onChange(l=>{F(`${S} Auto-open panel on startup changed: ${l}`),e.settings.autoOpenPanelOnStartup=l,e.saveSettings()})),new D.Setting(t).setName("Auto-select persisted project on startup").setDesc("If enabled, the persisted active project will be selected as the plugin's active project on load without opening the panel. ⚠️ Requires plugin reload to take effect.").addToggle(o=>o.setValue(!!e.settings.autoSelectProjectOnStartup).onChange(l=>{F(`${S} Auto-select project on startup changed: ${l}`),e.settings.autoSelectProjectOnStartup=l,e.saveSettings()})),new D.Setting(t).setName(`Enable ${Et} debug logs`).setDesc(`When enabled, ${Et} will set window.__${Et.toUpperCase()}__ to true to show verbose runtime logs useful during development.`).addToggle(o=>o.setValue(!!e.settings.debug).onChange(l=>{F(`${S} Debug logs setting changed: ${l}`),e.settings.debug=l,window.__WRITEAID_DEBUG__=!!l,e.saveSettings(),l?new D.Notice(`${Et}: debug logs enabled — verbose logs will appear in the DevTools console.`):new D.Notice(`${Et}: debug logs disabled.`)})),t.createEl("h3",{text:"Panel performance"}),new D.Setting(t).setName("Panel refresh debounce (ms)").setDesc("Debounce timeout (milliseconds) for side-panel refresh notifications. Lower values mean more frequent refreshes; 0 disables debouncing.").addText(o=>{const l=e.settings.panelRefreshDebounceMs,c=Number(l??en);o.setPlaceholder(String(en)),o.setValue(String(c));let u=null;const m=g=>{const f=Number(g);if(!Number.isFinite(f)||f<Te){new D.Notice(`Please enter a valid number ≥ ${Te}.`);return}const p=Math.min(Math.floor(f),tn);F(`${S} Panel refresh debounce changed: ${p}ms`),e.settings.panelRefreshDebounceMs=p;try{const d=e.saveSettings();d&&typeof d.catch=="function"&&d.catch(()=>{})}catch{}this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=p),o.inputEl.value=String(p),u&&(u.value=String(p))};try{const g=o.inputEl;g.setAttribute("type","number"),g.setAttribute("min",String(Te)),g.setAttribute("max",String(tn)),g.setAttribute("step","50"),g.setAttribute("aria-label","Panel refresh debounce in milliseconds"),Mt(()=>{g.insertAdjacentHTML("afterend",'<span class="wa-unit">ms</span>')}),u=document.createElement("input"),u.type="range",u.min=String(Te),u.max=String(tn),u.step="50",u.value=String(c),u.className="wa-debounce-range",Mt(()=>{const f=g.nextSibling;f&&f.parentElement?f.insertAdjacentElement("afterend",u):g.insertAdjacentElement("afterend",u)}),o.onChange(f=>{const p=Number(f);m(p)}),u.addEventListener("input",f=>{const p=Number(f.target.value);o.inputEl.value=String(p),m(p)})}catch{o.onChange(g=>{const f=Number(g);if(!Number.isFinite(f)||f<Te){new D.Notice(`Please enter a valid number ≥ ${Te}.`);return}const p=Math.min(Math.floor(f),tn);e.settings.panelRefreshDebounceMs=p,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=p)})}}).addButton(o=>o.setButtonText("Reset").setTooltip(`Reset to default (${en} ms)`).onClick(()=>{const l=en;e.settings.panelRefreshDebounceMs=l,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=l),this.display()}))}}class On extends D.Modal{constructor(t,e){super(t),this.currentFolder=null,this.expanded={},this.onPick=e,F(`${S} FilePickerModal created`)}onOpen(){F(`${S} FilePickerModal opened`);const t=this.app.vault.getRoot();this.currentFolder=t,this.expanded={},this.render()}render(){const{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Select template file"}),!this.currentFolder)return;const e=this.currentFolder.path?this.currentFolder.path.split("/"):[],n=t.createDiv({cls:"wat-breadcrumbs"}),a=n.createEl("a",{text:"(Vault root)",href:"#"});a.onclick=c=>{c.preventDefault(),this.currentFolder=this.app.vault.getRoot(),this.render()};let i="";for(const c of e){i=i?`${i}/${c}`:c,n.createDiv({text:" / "});const u=n.createEl("a",{text:c,href:"#"}),m=i;u.onclick=g=>{g.preventDefault();const f=this.app.vault.getAbstractFileByPath(m);f&&f instanceof D.TFolder&&(this.currentFolder=f,this.render())}}const o=t.createDiv({cls:"wat-controls"}).createEl("button",{text:"Up"});o.onclick=c=>{var g;if(c.preventDefault(),!this.currentFolder)return;const u=((g=this.currentFolder.parent)==null?void 0:g.path)||"",m=u?this.app.vault.getAbstractFileByPath(u):this.app.vault.getRoot();m&&m instanceof D.TFolder&&(this.currentFolder=m,this.render())};const l=t.createDiv({cls:"wat-list"});for(const c of this.currentFolder.children)if(c instanceof D.TFolder){const u=l.createDiv({cls:"wat-row folder-row"}),m=u.createEl("button",{text:this.expanded[c.path]?"▾":"▸"});m.onclick=f=>{f.preventDefault(),this.expanded[c.path]=!this.expanded[c.path],this.render()};const g=u.createEl("a",{text:c.name,href:"#"});if(g.onclick=f=>{f.preventDefault(),this.currentFolder=c,this.render()},this.expanded[c.path]){const f=l.createDiv({cls:"wat-sub"});for(const p of c.children)if(p instanceof D.TFolder){const b=f.createDiv({cls:"wat-row sub-folder"}).createEl("a",{text:p.name,href:"#"});b.onclick=h=>{h.preventDefault(),this.currentFolder=p,this.render()}}else if(p instanceof D.TFile&&p.path.toLowerCase().endsWith(mt)){const b=f.createDiv({cls:"wat-row sub-file"}).createEl("a",{text:p.name,href:"#"});b.onclick=h=>{h.preventDefault(),F(`${S} File selected from file picker: ${p.path}`),this.close(),this.onPick(p.path)}}}}else if(c instanceof D.TFile&&c.path.toLowerCase().endsWith(mt)){const m=l.createDiv({cls:"wat-row file-row"}).createEl("a",{text:c.name,href:"#"});m.onclick=g=>{g.preventDefault(),F(`${S} File selected from file picker: ${c.path}`),this.close(),this.onPick(c.path)}}}onClose(){this.contentEl.empty()}}const ul=":root{--wa-bg: var(--background-primary, #ffffff);--wa-surface: var(--background-modifier-hover, #f7f7fb);--wa-muted: var(--text-muted, #6b7280);--wa-text: var(--text-normal, #0f172a);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(15, 23, 42, .08);--wa-radius: 8px;--wa-gap: 8px;--select-bg: var(--background-primary, #fff);--select-border: var(--background-modifier-border, #ccc);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #222);--select-placeholder: var(--text-muted, #888);--select-dropdown-bg: var(--background-secondary, #f6f6f6);--select-dropdown-border: var(--background-modifier-border, #e0e0e0);--select-option-hover: #f0f0ff;--select-option-active: #eaeaff;--select-chevron: var(--text-muted, #888)}@media (prefers-color-scheme: dark){:root{--wa-bg: var(--background-primary, #0b0b0c);--wa-surface: var(--background-modifier-hover, #121212);--wa-muted: var(--text-muted, #9aa4b2);--wa-text: var(--text-normal, #e6eef8);--wa-accent: var(--interactive-accent, #8b5cf6);--wa-border: rgba(255, 255, 255, .06)}}.theme-dark{--wa-bg: var(--background-primary, #23232b);--wa-surface: var(--background-modifier-hover, #2a2a4a);--wa-muted: var(--text-muted, #aaa);--wa-text: var(--text-normal, #e0e0e0);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(255, 255, 255, .06);--select-bg: var(--background-primary, #23232b);--select-border: var(--background-modifier-border, #333);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #e0e0e0);--select-placeholder: var(--text-muted, #aaa);--select-dropdown-bg: var(--background-secondary, #23233a);--select-dropdown-border: var(--background-modifier-border, #333);--select-option-hover: #2a2a4a;--select-option-active: #2a2a4a;--select-chevron: var(--text-muted, #aaa)}.theme-dark .wa-panel{background:var(--background-primary, #23232b);color:var(--text-normal, #e0e0e0);border:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-title{color:var(--text-title, var(--text-normal, #e0e0e0))}.theme-dark .wa-muted{color:var(--text-faint, var(--text-muted, #aaa))}.theme-dark .wa-draft-list{background:var(--background-secondary, #23233a)}.theme-dark .wa-draft-item{color:var(--text-normal, #e0e0e0);border-bottom:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-draft-item.active{background:var(--background-modifier-active, #2a2a4a)}.theme-dark .wa-draft-name{color:var(--text-normal, #e0e0e0)}",dl="button:hover{cursor:pointer}button:disabled{cursor:not-allowed}.writeaid-ribbon{padding-left:6px}.writeaid-ribbon .wa-icon{display:inline-block;vertical-align:middle}.writeaid-ribbon .wa-icon svg{width:16px;height:16px;fill:currentColor;display:block}.view-content:has(.writeaid-project-panel){padding:0}.writeaid-project-panel{height:100%;display:flex;flex-direction:column}.create-inline{margin-top:8px;justify-content:center}.wa-panel.project-list{padding:1em;height:100%;border-radius:0}.wa-panel-header{display:flex;flex-direction:column}.wa-draft-item.active .wa-draft-name{font-weight:700;color:var(--color-accent, #3b82f6)}.wa-draft-active-indicator{color:var(--color-accent, #3b82f6);font-size:1em;vertical-align:middle}@keyframes spin{to{transform:rotate(360deg)}}.wa-icon-btn.spinning svg{animation:spin 1s linear infinite}:root{--wa-slider-track-height: 6px;--wa-slider-thumb-size: 12px;--wa-slider-accent: var(--interactive-accent, #7c5cff);--wa-slider-background: var(--background-modifier-host, #eee);--wa-slider-gap: 12px}.wa-debounce-range{margin-left:var(--wa-slider-gap);vertical-align:middle;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:var(--wa-slider-track-height);background:linear-gradient(90deg,var(--wa-slider-accent) 0%,var(--wa-slider-accent) 50%,var(--wa-slider-background) 50%,var(--wa-slider-background) 100%);border-radius:999px;outline:none}.wa-debounce-range::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);box-shadow:0 0 0 4px #0000000d;cursor:pointer}.wa-debounce-range::-moz-range-thumb{width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);cursor:pointer}.wa-unit{color:var(--text-muted, #666);margin-left:6px}.justify-between{justify-content:space-between}.wa-rename-info{margin-bottom:8px;color:var(--text-muted, #888);font-size:.95em}.wa-rename-label{display:block;font-weight:500;margin-bottom:4px;color:var(--text-normal, #222)}.wa-rename-input{width:100%;padding:7px 10px;font-size:1em;border:1px solid var(--background-modifier-border, #ccc);border-radius:5px;margin-bottom:10px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s}.wa-rename-input:focus{border-color:var(--interactive-accent, #7c5cff);outline:none}.wa-rename-checkbox-label{display:flex;align-items:center;gap:6px;margin-bottom:10px;font-size:.97em;color:var(--text-muted, #666)}.wa-rename-btn-row{display:flex;gap:10px;margin-top:8px;justify-content:flex-end}.wa-rename-btn-row button{min-width:80px;padding:6px 14px;font-size:1em;border-radius:4px;border:none;cursor:pointer;transition:background .2s}.wa-rename-btn-row .mod-cta{background:var(--interactive-accent, #7c5cff);color:#fff;font-weight:600}.wa-rename-btn-row .mod-cta:hover{background:#5a3fd6}.wa-rename-btn-row .mod-cancel{background:var(--background-modifier-border, #eee);color:var(--text-muted, #666)}.wa-rename-btn-row .mod-cancel:hover{background:#e0e0e0}.wa-rename-error{min-height:18px;margin-bottom:4px;font-size:.97em;color:var(--color-red, #d43c3c);transition:opacity .2s}.wa-create-draft-input{width:100%;padding:8px 12px;font-size:1.05em;border:1.5px solid var(--background-modifier-border, #bbb);border-radius:6px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s,box-shadow .2s;outline:none;box-shadow:0 1px 2px #3c3c3c0a}.wa-create-draft-input:focus{border-color:var(--interactive-accent, #7c5cff);box-shadow:0 2px 8px #7c5cff14;background:var(--background-secondary, #fafaff)}.wa-panel{background:var(--background-primary, #fff);color:var(--text-normal, #222);padding:1em}.wa-title{font-size:1.2em;font-weight:600;color:var(--text-title, var(--text-normal, #222))}.wa-muted{color:var(--text-faint, var(--text-muted, #888))}.wa-row{display:flex;gap:8px;align-items:center;width:100%}.wa-button-group{display:flex;gap:8px;align-items:center}.wa-draft-list{background:var(--background-secondary, #f6f6f6);border-radius:6px;padding:8px 0;margin-top:8px}.wa-draft-item{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-bottom:1px solid var(--background-modifier-border, #e0e0e0);background:transparent;color:var(--text-normal, #222);transition:background .15s}.wa-draft-item:last-child{border-bottom:none}.wa-draft-item.active{background:var(--background-modifier-active, #eaeaff)}.wa-draft-name{font-size:1em;font-weight:500;color:var(--text-normal, #222)}.wa-draft-actions{display:flex;gap:6px}.wa-select-container.wa-select{position:relative;width:100%;display:flex;flex-direction:column;gap:4px}.wa-select-label-text{font-size:.9em;font-weight:500;color:var(--select-text, var(--text-normal, #222))}.wa-select-trigger{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:6px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));cursor:pointer;transition:all .2s ease;min-height:38px;font-size:1em}.wa-select-trigger:hover:not(.disabled){border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.open{border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.disabled{opacity:.6;cursor:not-allowed;background:var(--disabled-background, #f3f3f3)}.wa-select-value{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.wa-select-label,.wa-select-placeholder{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wa-select-placeholder{color:var(--select-placeholder, var(--text-muted, #888))}.wa-select-controls{display:flex;align-items:center;gap:4px;flex-shrink:0;margin-left:8px}.wa-select-clear{display:flex;align-items:center;justify-content:center;width:20px;height:20px;padding:0;border:none;background:none;color:var(--select-chevron, var(--text-muted, #888));cursor:pointer;border-radius:3px;transition:background .2s;font-size:.8em}.wa-select-clear:hover{background:var(--background-modifier-hover, #f0f0f0)}.wa-select-chevron{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:var(--select-chevron, var(--text-muted, #888));font-size:.7em;transition:transform .3s cubic-bezier(.4,0,.2,1)}.wa-select-chevron.rotated{transform:rotate(180deg)}.wa-select-dropdown{position:absolute;z-index:1000;background:var(--select-dropdown-bg, var(--background-secondary, #f6f6f6));border:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0));border-radius:8px;box-shadow:0 4px 12px #00000026,0 2px 4px #0000001a;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .15s ease-out}@keyframes slideIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.wa-select-dropdown[data-placement*=top]{animation:slideInTop .15s ease-out}@keyframes slideInTop{0%{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}.wa-select-search{padding:8px;border-bottom:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0))}.wa-select-search-input{width:100%;padding:6px 8px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:4px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));font-size:.95em}.wa-select-search-input:focus{outline:none;border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-list{flex:1;overflow-y:auto;max-height:300px}.wa-select-list::-webkit-scrollbar{width:6px}.wa-select-list::-webkit-scrollbar-track{background:transparent}.wa-select-list::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb-bg, rgba(0, 0, 0, .2));border-radius:3px}.wa-select-list::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover-bg, rgba(0, 0, 0, .3))}.wa-select-empty{padding:12px 10px;text-align:center;color:var(--select-placeholder, var(--text-muted, #888));font-size:.95em}.wa-select-option{width:100%;margin-top:2px;padding:8px 10px;border-radius:0;box-shadow:none!important;border:none;background:transparent;color:var(--select-text, var(--text-normal, #222));text-align:left;cursor:pointer;transition:background .15s;font-size:.95em}.wa-select-option:hover{background:var(--select-option-hover, #f0f0ff);box-shadow:none!important}.wa-select-option.selected{background:var(--select-option-active, #eaeaff);box-shadow:none!important}.wa-select-option.active{background:var(--select-option-active, #eaeaff);font-weight:500;box-shadow:none!important}";if(typeof globalThis<"u"){const r=globalThis;r.__BROWSER__||(r.__BROWSER__=!0)}function Hr(r,t=20){return r.length<=t?r:r.substring(0,t-3)+"..."}const Pa={outlineTemplate:`# {{draftName}} Outline

## Overview
Brief description of the story goes here.

## Characters
- Character 1: Description
- Character 2: Description

## Plot Points
- Opening: 
- Middle: 
- Climax: 
- Resolution: 

## Chapters
- Chapter 1: Title
- Chapter 2: Title
- Chapter 3: Title`,chapterTemplate:`# {{chapterName}}

## Summary
Chapter summary goes here.

## Scene 1
Scene content goes here.

## Scene 2
Scene content goes here.`,manuscriptNameTemplate:"{{draftName}}",slugStyle:"compact",ribbonPlacement:"left",ribbonAlwaysShow:!1,autoOpenPanelOnStartup:!1,autoSelectProjectOnStartup:!0,activeProject:void 0,panelRefreshDebounceMs:250,debug:!1,includeDraftOutline:!1,draftsFolderName:Oe.DRAFTS,manuscriptsFolderName:Oe.MANUSCRIPTS,backupsFolderName:Oe.BACKUPS,metaFileName:ue.META,outlineFileName:ue.OUTLINE,maxBackups:5,maxBackupAgeDays:30};function Vr(r){return Object.assign({},Pa,r??{})}class hl extends D.Plugin{constructor(){super(...arguments),this.settings=Pa,this.settingsChangedCallbacks=[]}async loadSettings(){const t=await this.loadData();this.settings=Vr(t),t&&t.activeProject!==void 0&&(this.settings.activeProject=t.activeProject),this.manager&&(this.manager.settings=this.settings),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){F(`${S} Error in settings changed callback:`,n)}})}async saveSettings(){await Ut(async()=>{const e=Vr(this.settings);await this.saveData(e),this.settings=e})===void 0&&await this.saveData(this.settings),this.manager&&(this.manager.settings=this.settings,F(`${S} Updated manager settings reference, manuscript template: ${this.settings.manuscriptNameTemplate}`)),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){F(`${S} Error in settings changed callback:`,n)}})}registerSettingsChangedCallback(t){this.settingsChangedCallbacks.push(t)}async runBackupCleanup(){if(this.manager)try{const e=await new mn(this.app).listProjects();for(const n of e){const a=Bt(this.settings),i=`${n}/${a}`,s=this.app.vault.getAbstractFileByPath(i);if(!(!s||!(s instanceof D.TFolder))){for(const o of s.children)if(o instanceof D.TFolder){const l=`${i}/${o.name}`,c=await this.manager.projectFileService.drafts.getDraftId(l);c&&await this.manager.projectFileService.backups.clearOldBackups(l,c,this.manager.settings)}}}F(`${S} Backup cleanup completed on startup`)}catch(t){F(`${S} Error during backup cleanup:`,t)}}async onload(){await this.loadSettings(),this.manager=new cl(this.app,this,typeof this.settings.panelRefreshDebounceMs=="number"?this.settings.panelRefreshDebounceMs:void 0),F(`${S} Manager created:`,!!this.manager);const t=new mn(this.app);this.app.workspace.onLayoutReady(async()=>{let a=null;if(this.settings.autoSelectProjectOnStartup!==!1){const i=await t.listProjects();if(i.length===1)a=i[0];else if(i.length>1){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");F(`${S} lastActiveRaw='${s}', normalized='${o}', includes=${o&&i.includes(o)}`),o&&i.includes(o)?a=o:a=i[0]}else if(i.length===0){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");await t.isProjectFolder(s||"")&&(F(`${S} activating saved project '${o}' as it exists and has valid meta file`),a=o??null)}}if(F(`${S} toActivate='${a}'`),a){await this.manager.setActiveProject(a),this.settings.activeProject=a;const i=await ke(this.app,`${a}/${Gt(this.settings)}`);if(i!=null&&i.current_active_draft&&this.manager.listDrafts(a).includes(i.current_active_draft)&&(F(`${S} auto-restoring draft '${i.current_active_draft}' for project '${a}'`),await this.manager.setActiveDraft(i.current_active_draft,a,!1)),await this.saveSettings(),this.settings.autoOpenPanelOnStartup){const s=this.app.workspace.getLeavesOfType(_e);if(s.length>0)this.app.workspace.revealLeaf(s[0]);else{let o=null;this.settings.ribbonPlacement==="right"?o=this.app.workspace.getRightLeaf(!0):o=this.app.workspace.getLeftLeaf(!0);const l={type:_e,active:!0};o.setViewState(l),this.app.workspace.revealLeaf(o)}}}else await this.manager.setActiveProject(null),this.settings.activeProject=void 0,await this.saveSettings()}),this.statusBarEl=this.addStatusBarItem(),this.statusBarEl.setText(`${Et}: No active project`),this.runBackupCleanup().catch(a=>{F(`${S} Failed to run backup cleanup on startup:`,a)}),Mt(()=>{this.waStyleEl||(this.waStyleEl=document.createElement("style"),this.waStyleEl.setAttribute("data-writeaid-style",""),this.waStyleEl.textContent=ul+dl,this.waStyleEl.classList.add("writeaid-plugin-style"),document.head.appendChild(this.waStyleEl))}),await this.loadSettings(),Mt(()=>{window.__WRITEAID_DEBUG__=!!this.settings.debug}),F(`${S} Loading ${Et} Novel Multi-Draft Plugin`),this.manager.addActiveProjectListener(a=>{this.statusBarEl&&(a?(this.statusBarEl.setText(`${Et}: ${Hr(a)}`),F(`${S} active project updated -> ${a}`)):this.statusBarEl.setText(`${Et}: No active project`))}),this.manager.activeProject&&this.statusBarEl.setText(`${Et}: ${Hr(this.manager.activeProject)}`),F(`${S} Registering ProjectPanelView with manager:`,!!this.manager),this.registerView(_e,a=>(F(`${S} Creating ProjectPanelView instance with manager:`,!!this.manager),new Uo(a,this.app,this.manager)));const e=this.addRibbonIcon(Gn,`${Et} Projects`,()=>{});e.classList.add("writeaid-ribbon"),this.ribbonEl=e,e.setAttr("aria-label",`${Et} Projects`),e.onclick=()=>{const a=this.app.workspace.getLeavesOfType(_e);if(a.length>0){const i=a[0];this.app.workspace.revealLeaf(i)}else{let i=this.app.workspace.getLeftLeaf(!1);i||(i=this.app.workspace.getLeftLeaf(!0));const s={type:_e,active:!0};i.setViewState(s),this.app.workspace.revealLeaf(i)}};const n=async()=>{await Ut(async()=>{if(this.settings.ribbonAlwaysShow){e.style.display="";return}const i=t.listAllFolders();(await Se(i,o=>t.isProjectFolder(o))).length>0?e.style.display="":e.style.display="none"})===void 0&&(e.style.display="")};this.refreshRibbonVisibility=n,n().catch(()=>{}),this.settings.ribbonPlacement==="right"&&this.moveRibbon("right"),this.registerEvent(this.app.vault.on("create",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("delete",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("modify",()=>{n().catch(()=>{})})),this.addCommand({id:"create-new-draft",name:"Create New Draft",callback:Ho(this.manager)}),this.addCommand({id:"create-outline",name:"Create Outline",callback:()=>Vo(this.manager)}),this.addCommand({id:"create-new-project",name:"Create New Project",callback:tl(this.manager)}),this.addCommand({id:"switch-draft",name:"Switch Active Draft",callback:qo(this.manager)}),this.addCommand({id:"update-project-metadata",name:"Update Project Metadata",callback:al(this.manager)}),this.addCommand({id:"select-active-project",name:"Select Active Project",callback:nl(this.manager)}),this.addCommand({id:"open-project-meta",name:"Open Project Meta",callback:el(this.manager)}),this.addCommand({id:"generate-manuscript",name:"Generate Manuscript",callback:Zo(this.manager)}),this.addCommand({id:"toggle-project-panel",name:`Toggle ${Et} Project Panel`,callback:rl(this.manager,this.app)}),this.addCommand({id:"convert-single-to-multi-file-project",name:"Convert Single-File Project to Multi-File",callback:()=>{var a,i;return Qo(this.app,this.manager.activeProject||((i=(a=this.manager).getCurrentProjectPath)==null?void 0:i.call(a))||void 0,this.manager.settings)}}),this.addCommand({id:"navigate-to-next-chapter",name:"Navigate to Next Chapter",callback:Ko(this.manager)}),this.addCommand({id:"navigate-to-previous-chapter",name:"Navigate to Previous Chapter",callback:Xo(this.manager)}),this.addCommand({id:"create-backup",name:"Create Backup",callback:Ra(this.manager)}),this.addCommand({id:"list-and-restore-backups",name:"List and Restore Backups",callback:Wo(this.manager)}),this.addCommand({id:"delete-backup",name:"Delete Oldest Backup",callback:Ia(this.manager)}),this.addCommand({id:"clear-old-backups",name:"Clear Old Backups",callback:Ba(this.manager)}),this.addCommand({id:"initialize-draft-file",name:"Initialize Draft File Metadata",callback:Yo(this.manager)}),this.addSettingTab(new fl(this.app,this))}moveRibbon(t){Mt(()=>{if(!this.ribbonEl)return;const e=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-right"),n=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-left");t==="right"&&e?e.appendChild(this.ribbonEl):t==="left"&&n&&n.appendChild(this.ribbonEl)})}onunload(){this.statusBarEl&&this.statusBarEl.parentElement&&this.statusBarEl.parentElement.removeChild(this.statusBarEl),F(`${S} Unloading ${Et} Novel Multi-Draft Plugin`),this.waStyleEl&&this.waStyleEl.parentElement&&this.waStyleEl.parentElement.removeChild(this.waStyleEl)}}module.exports=hl;
//# sourceMappingURL=main.js.map
