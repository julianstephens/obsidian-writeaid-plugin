"use strict";var Ea=Object.defineProperty;var Da=(r,t,e)=>t in r?Ea(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Sn=(r,t,e)=>Da(r,typeof t!="symbol"?t+"":t,e);const F=require("obsidian"),fn={ACTIVE_PROJECT_NOT_FOUND:"No active project found.",ACTIVE_DRAFT_NOT_FOUND:"No active draft found.",BACKUPS_NOT_FOUND_PROJECT:"No backups found for the current project.",BACKUPS_NOT_FOUND_DRAFT:"No backups found for the current draft."},Fe={DRAFTS:"drafts",MANUSCRIPTS:"manuscripts",BACKUPS:".writeaid-backups"},re={META:"meta.md",OUTLINE:"outline.md"},An={COMPACT:"compact",KEBAB:"kebab"},Vt={SINGLE:"single-file",MULTI:"multi-file"},Pa=Object.values(Vt),Ft="WriteAid",B=`${Ft} debug:`,Ln="pen-tool",bt=".md",Ce=0,Ge=5e3,Ye=250,Ke=".zip",Ir=/_(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})\.zip$/,xt="---",Rt=new RegExp(`^${xt}
([\\s\\S]*?)
${xt}`),jn=1024,Lr=["B","KB","MB","GB"];function jt(r){return(r==null?void 0:r.draftsFolderName)||Fe.DRAFTS}function Mn(r){return(r==null?void 0:r.manuscriptsFolderName)||Fe.MANUSCRIPTS}function je(r){return(r==null?void 0:r.backupsFolderName)||Fe.BACKUPS}function ie(r){return(r==null?void 0:r.metaFileName)||re.META}function Te(r){return(r==null?void 0:r.outlineFileName)||re.OUTLINE}function ae(r,t=An.COMPACT){if(!r)return"";const e=r.trim();return t===An.KEBAB?e.replace(/\s+/g,"-").toLowerCase():e.replace(/\s+/g,"").toLowerCase()}async function Be(r,t){const e=await Promise.all(r.map(n=>Promise.resolve(t(n))));return r.filter((n,a)=>e[a])}function zt(r,...t){try{return r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}async function Ot(r,...t){try{return await r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}function Je(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const r=Date.now().toString(36),t=Math.random().toString(36).substring(2,15);return`${r}-${t}`}function R(...r){zt(()=>{window.__WRITEAID_DEBUG__&&(console.debug||console.log).apply(console,r)})}function We(r,t){return r?t?!0:(new F.Notice(fn.ACTIVE_DRAFT_NOT_FOUND),!1):(new F.Notice(fn.ACTIVE_PROJECT_NOT_FOUND),!1)}const Na=Object.freeze(Object.defineProperty({__proto__:null,APP_NAME:Ft,BACKUP_FILE_EXTENSION:Ke,BACKUP_TIMESTAMP_REGEX:Ir,BYTES_PER_KILOBYTE:jn,DEBUG_PREFIX:B,FILES:re,FILE_SIZE_UNITS:Lr,FOLDERS:Fe,FRONTMATTER_DELIMITER:xt,FRONTMATTER_REGEX:Rt,MARKDOWN_FILE_EXTENSION:bt,PANEL_DEBOUNCE_DEFAULT:Ye,PANEL_DEBOUNCE_MAX:Ge,PANEL_DEBOUNCE_MIN:Ce,PROJECT_TYPE:Vt,SLUG_STYLE:An,VALID_PROJECT_TYPES:Pa,WRITE_AID_ICON_NAME:Ln,asyncFilter:Be,checkActive:We,debug:R,generateDraftId:Je,getBackupsFolderName:je,getDraftsFolderName:jt,getManuscriptsFolderName:Mn,getMetaFileName:ie,getOutlineFileName:Te,slugifyDraftName:ae,suppress:zt,suppressAsync:Ot},Symbol.toStringTag,{value:"Module"}));function Aa(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(R(`${B} Clear old backups command called`),R(`${B} Active project: ${t}, active draft: ${e}`),!We(t,e))return;const n=jt(r.settings),a=`${t}/${n}/${e}`,i=await r.projectFileService.drafts.getDraftId(a);if(!i){new F.Notice("Failed to get draft ID.");return}const s=r.projectFileService.backups.maxBackupAgeDays;await r.projectFileService.backups.clearOldBackups(a,i,r.settings),new F.Notice(`Old backups cleared (older than ${s} days).`)}}function ja(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(R(`${B} Create backup command called`),R(`${B} Active project: ${t}, active draft: ${e}`),!We(t,e))return;const n=jt(r.settings),a=`${t}/${n}/${e}`,i=await r.projectFileService.drafts.getDraftId(a);if(!i){new F.Notice("Failed to get draft ID for backup.");return}await r.projectFileService.backups.createBackup(a,i,r.settings)?new F.Notice("Backup created successfully."):new F.Notice("Failed to create backup.")}}function Ta(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(R(`${B} Delete backup command called`),R(`${B} Active project: ${t}, active draft: ${e}`),!We(t,e))return;const n=jt(r.settings),a=`${t}/${n}/${e}`,i=await r.projectFileService.drafts.getDraftId(a);if(!i){new F.Notice("Failed to get draft ID.");return}const s=await r.projectFileService.backups.listBackups(a,i,r.settings);if(s.length===0){new F.Notice(fn.BACKUPS_NOT_FOUND_DRAFT);return}const o=s[s.length-1];await r.projectFileService.backups.deleteBackup(a,i,o,r.settings)?new F.Notice(`Backup deleted successfully: ${o}.`):new F.Notice("Failed to delete backup.")}}class Mr extends F.Modal{constructor(t,e,n=!1){super(t),this.path=e,this.isDraft=n,this.setTitle("Confirm Overwrite")}onOpen(){const{contentEl:t}=this,e=this.isDraft?"draft folder":"manuscript file";t.createEl("p",{text:`The ${e} "${this.path}" already exists. Do you want to overwrite it?`});const n=t.createDiv({cls:"modal-button-container"});new F.ButtonComponent(n).setButtonText("Cancel").onClick(()=>{this.resolve(!1),this.close()}),new F.ButtonComponent(n).setButtonText("Overwrite").setCta().onClick(()=>{this.resolve(!0),this.close()})}onClose(){const{contentEl:t}=this;t.empty()}open(){return new Promise(t=>{this.resolve=t,super.open()})}}class Oa extends F.SuggestModal{constructor(t,e){super(t),this.manager=e,this.backups=[],this.draftFolder="",this.draftName="",this.setPlaceholder("Select a backup to restore..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to restore"},{command:"esc",purpose:"to cancel"}])}async onOpen(){const t=this.manager.activeProject;if(!t){new F.Notice("No active project found."),this.close();return}const e=jt(this.manager.settings);if(this.draftFolder=`${t}/${e}`,this.draftName=t,this.backups=await this.getBackupDetails(),this.backups.length===0){new F.Notice(fn.BACKUPS_NOT_FOUND_PROJECT),this.close();return}this.setTitle(`Restore Backup for Project "${t}"`),super.onOpen()}async getBackupDetails(){const t=this.draftFolder.split("/")[0]||"unknown",e=`${je(this.manager.settings)}/${t}`;try{const n=[],a=jt(this.manager.settings),i=`${e}/${a}`,s=await this.app.vault.adapter.list(i);for(const o of s.folders){const l=o.split("/").pop()||o;let c=l;const f=`${t}/${a}`,d=this.manager.projectFileService.drafts.listDrafts(t);for(const p of d){const v=`${f}/${p}`;if(await this.manager.projectFileService.drafts.getDraftId(v)===l){c=p;break}}const w=`${i}/${l}`,u=await this.app.vault.adapter.list(w),m=`${t}/${a}/${c}`;for(const p of u.files){const v=p.split("/").pop()||p,h=new RegExp("^(\\d{4}-\\d{2}-\\d{2}T\\d{2}-\\d{2}-\\d{2})\\.zip$"),b=v.match(h);if(b){const y=await this.app.vault.adapter.stat(p),$=(y==null?void 0:y.size)||0,k=b[1],D=k.replace(/T(\d{2})-(\d{2})-(\d{2})/,"T$1:$2:$3"),z=new Date(D).toLocaleString(),N=this.formatFileSize($);n.push({timestamp:k,size:$,displayText:`${c}: ${z} (${N})`,draftName:c,draftFolder:m,draftId:l})}}}return n.sort((o,l)=>l.timestamp.localeCompare(o.timestamp))}catch{return R(`${B} Backup directory does not exist yet for project '${e}' (this is normal for new projects)`),[]}}formatFileSize(t){if(t===0)return"0 B";const e=Math.floor(Math.log(t)/Math.log(jn));return parseFloat((t/Math.pow(jn,e)).toFixed(1))+" "+Lr[e]}getSuggestions(t){return this.backups.filter(e=>e.displayText.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.createEl("div",{text:t.displayText})}async onChooseSuggestion(t,e){const n=this.app.vault.getAbstractFileByPath(t.draftFolder);if(n&&n instanceof F.TFolder&&!await new Mr(this.app,t.draftFolder,!0).open())return;await this.manager.projectFileService.backups.restoreBackup(t.draftFolder,t.draftId,t.timestamp,this.manager.settings)?new F.Notice(`Backup restored successfully for "${t.draftName}" from ${t.displayText.split(": ")[1].split(" (")[0]}.`):new F.Notice("Failed to restore backup.")}}function Ba(r){return async()=>{R(`${B} List backups command called`),new Oa(r.app,r).open()}}function Ra(r){return()=>r.createNewDraftPrompt()}async function za(r){R(`${B} createOutlineCommand called`);try{const t=r.activeProject,e=r.activeDraft;if(!t||!e){new F.Notice("No active project or draft selected. Please select a project and draft first.");return}const n=r.projectFileService.drafts.getOutlineFile(t,e);if(n){new F.Notice(`Outline file already exists: ${n.path}`);return}await r.projectFileService.drafts.createOutline(t,e,r.settings.outlineTemplate),new F.Notice(`Outline created for draft: ${e}`),R(`${B} Outline created successfully for draft: ${e}`)}catch(t){R(`${B} Error creating outline:`,t),new F.Notice(`Failed to create outline: ${t.message}`)}}function Ia(r){return async()=>{var i;const t=r.projectFileService.drafts,e=r.activeProject,n=r.activeDraft;if(R(`${B} Generate manuscript command called`),R(`${B} Active project: ${e}, active draft: ${n}`),R(`${B} Manager settings manuscript template: ${(i=r.settings)==null?void 0:i.manuscriptNameTemplate}`),!We(e,n))return;await t.generateManuscript(e,n,r.settings)?new F.Notice("Manuscript generated successfully."):new F.Notice("Failed to generate manuscript.")}}function Xn(r){const t={},e=r.match(Rt);if(e){const n=e[1],a=n.match(/^id:\s*(.+?)$/m),i=n.match(/^draft:\s*(.+?)$/m),s=n.match(/^project:\s*(.+?)$/m),o=n.match(/^created:\s*(.+?)$/m);a&&(t.id=a[1].trim()),i&&(t.draft=i[1].trim()),s&&(t.project=s[1].trim()),o&&(t.created=o[1].trim())}return t}function Jn(r){return!!(r.id&&r.draft&&r.project&&r.created)}function Cn(r,t,e){return{id:r.id||Je(),draft:r.draft||t,project:r.project||e,created:r.created||new Date().toISOString()}}function xn(r,t){const e=r.match(Rt);if(e){const n=e[1],a=r.substring(e[0].length),i=n.split(`
`),s=[],o=new Set;for(const c of i)c.match(/^id:/i)?(s.push(`id: ${t.id}`),o.add("id")):c.match(/^draft:/i)?(s.push(`draft: ${t.draft}`),o.add("draft")):c.match(/^project:/i)?(s.push(`project: ${t.project}`),o.add("project")):c.match(/^created:/i)?(s.push(`created: ${t.created}`),o.add("created")):s.push(c);o.has("id")||s.push(`id: ${t.id}`),o.has("draft")||s.push(`draft: ${t.draft}`),o.has("project")||s.push(`project: ${t.project}`),o.has("created")||s.push(`created: ${t.created}`);const l=s.join(`
`);return`${xt}
${l}
${xt}${a}`}else return`${xt}
id: ${t.id}
draft: ${t.draft}
project: ${t.project}
created: ${t.created}
${xt}

`+r}class La extends F.SuggestModal{constructor(t,e,n){super(t),this.onSelect=n,this.files=[],this.files=e,this.setPlaceholder("Select a file to initialize as draft file..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"esc",purpose:"to cancel"}]),this.setTitle("Select File for Draft Metadata")}getSuggestions(t){return this.files}renderSuggestion(t,e){e.createEl("div",{text:t.name})}async onChooseSuggestion(t,e){await this.onSelect(t)}}function Ma(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(R(`${B} Initialize draft file command called`),R(`${B} Active project: ${t}, active draft: ${e}`),!We(t,e))return;if(!t||!e){new F.Notice("Active project or draft not found.");return}const n=jt(r.settings),a=`${t}/${n}/${e}`,i=t.split("/").pop()||t,s=r.app.vault.getAbstractFileByPath(a);if(!s||!(s instanceof F.TFolder)){new F.Notice("Draft folder not found.");return}const o=s.children.filter(f=>f instanceof F.TFile&&f.extension==="md").filter(f=>!f.path.includes("/Chapters/")&&f.name!=="outline.md");if(R(`${B} Found ${o.length} markdown files in draft folder`),o.length===0){R(`${B} No files found, creating new draft file`);const f=Cn({},e,i),d=xn("",f),w=`${e}${bt}`;await r.app.vault.create(`${a}/${w}`,d),new F.Notice(`Draft file created with metadata for "${e}".`);return}if(o.length===1){const f=o[0],d=await r.app.vault.read(f),w=Xn(d);if(Jn(w)){new F.Notice(`"${f.name}" already has complete draft metadata.`);return}R(`${B} Adding missing metadata to ${f.name}`);const u=Cn(w,e,i),m=xn(d,u);await r.app.vault.modify(f,m),new F.Notice(`Draft metadata added to "${f.name}".`);return}R(`${B} Multiple files found, showing selection modal`);const l=o.map(f=>({path:f.path,name:f.name,file:f}));new La(r.app,l,async f=>{const d=f.file,w=await r.app.vault.read(d),u=Xn(w);if(Jn(u)){new F.Notice(`"${d.name}" already has complete draft metadata.`);return}R(`${B} Adding missing metadata to ${d.name}`);const m=Cn(u,e,i),p=xn(w,m);await r.app.vault.modify(d,p),new F.Notice(`Draft metadata added to "${d.name}".`)}).open()}}function Ua(r){return()=>r.switchDraftPrompt()}function Wa(r){return async()=>{const t=r.app.workspace.getActiveFile();if(!t){new F.Notice("No file is currently open.");return}const e=t.path,n=jt(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${bt}$`));if(!a){new F.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(d=>d.name===o);if(c===-1){new F.Notice("Unable to find the current chapter in the draft.");return}if(c>=l.length-1)return;const f=l[c+1];await r.openChapter(i,s,f.name)}catch(l){R(`${B} Failed to navigate to next chapter:`,l),new F.Notice("Failed to navigate to next chapter.")}}}function Ha(r){return async()=>{const t=r.app.workspace.getActiveFile();if(!t){new F.Notice("No file is currently open.");return}const e=t.path,n=jt(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${bt}$`));if(!a){new F.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(d=>d.name===o);if(c===-1){new F.Notice("Unable to find the current chapter in the draft.");return}if(c<=0)return;const f=l[c-1];await r.openChapter(i,s,f.name)}catch(l){R(`${B} Failed to navigate to previous chapter:`,l),new F.Notice("Failed to navigate to previous chapter.")}}}async function De(r,t){const e=r.vault.getAbstractFileByPath(t);if(!e||!(e instanceof F.TFile))return null;try{const n=await r.vault.read(e);return Va(n)}catch(n){return R(`${B} Error reading meta file:`,n),null}}async function Un(r,t,e){const n=Za(e),a=r.vault.getAbstractFileByPath(t);a&&a instanceof F.TFile?await r.vault.modify(a,n):await r.vault.create(t,n)}async function Oe(r,t,e,n,a){const i=`${t}/${ie(a)}`;let s=await De(r,i);s||(s={total_drafts:0});const o=jt(a),l=r.vault.getAbstractFileByPath(`${t}/${o}`);if(l&&l instanceof F.TFolder){const c=l.children.filter(f=>f instanceof F.TFolder);s.total_drafts=c.length}e!==void 0&&(s.current_active_draft=e,s.active_draft_last_modified=new Date().toISOString()),n&&Object.assign(s,n),s.total_drafts>0&&s.total_word_count&&(s.average_draft_word_count=Math.round(s.total_word_count/s.total_drafts)),await Un(r,i,s)}function Va(r){const t=r.match(new RegExp(`${xt}\\s*\\n([\\s\\S]*?)\\n${xt}`));if(!t)return null;const e=t[1],n={},a=e.split(`
`);for(const i of a){const s=i.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(s){const o=s[1];let l=s[2].trim();/^-?\d+(\.\d+)?$/.test(l)?l=Number(l):(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),n[o]=l}}return n}function Za(r){const t=[xt];if(r.current_active_draft!==void 0&&t.push(`current_active_draft: "${r.current_active_draft}"`),t.push(`total_drafts: ${r.total_drafts}`),r.target_word_count!==void 0&&t.push(`target_word_count: ${r.target_word_count}`),r.active_draft_last_modified!==void 0&&t.push(`active_draft_last_modified: "${r.active_draft_last_modified}"`),r.total_word_count!==void 0&&t.push(`total_word_count: ${r.total_word_count}`),r.average_draft_word_count!==void 0&&t.push(`average_draft_word_count: ${r.average_draft_word_count}`),r.project_type!==void 0&&t.push(`project_type: ${r.project_type}`),t.push(xt),t.push(""),t.push("# Project Statistics"),t.push(""),r.current_active_draft&&t.push(`**Active Draft:** ${r.current_active_draft}`),t.push(`**Total Drafts:** ${r.total_drafts}`),r.target_word_count&&t.push(`**Target Word Count:** ${r.target_word_count.toLocaleString()}`),r.active_draft_last_modified){const e=new Date(r.active_draft_last_modified);t.push(`**Last Modified:** ${e.toLocaleString()}`)}return r.total_word_count&&t.push(`**Total Word Count:** ${r.total_word_count.toLocaleString()}`),r.average_draft_word_count&&t.push(`**Average Draft Word Count:** ${r.average_draft_word_count.toLocaleString()}`),t.push(""),t.join(`
`)}const Tn=Object.freeze(Object.defineProperty({__proto__:null,readMetaFile:De,updateMetaStats:Oe,writeMetaFile:Un},Symbol.toStringTag,{value:"Module"}));async function Ga(r,t,e){const n=`${t}/${ie(e)}`,a=await De(r,n);if(!a||a.project_type!==Vt.SINGLE)return new F.Notice(`Project is not a ${Vt.SINGLE} project.`),!1;a.project_type=Vt.MULTI,await Un(r,n,a);const i=jt(e),s=r.vault.getAbstractFileByPath(`${t}/${i}`);if(!s||!(s instanceof F.TFolder))return new F.Notice("Drafts folder not found."),!1;let o=!1;for(const l of s.children)if(l instanceof F.TFolder){const c=ae(l.name),f=l.children.find(d=>d instanceof F.TFile&&d.name===`${c}${bt}`);if(f){const d=`${l.path}/Chapter 1${bt}`;if(f.path!==d){const w=await r.vault.read(f);await r.vault.create(d,w),await r.vault.delete(f),o=!0}}}return o?new F.Notice(`Converted to multi-file project. Draft files renamed to "Chapter 1${bt}".`):new F.Notice("Converted to multi-file project. No draft files needed renaming."),!0}async function Ya(r,t,e){if(!t){new F.Notice("No active project selected.");return}await Ga(r,t,e)}function Ka(r){return()=>r.createNewProjectPrompt()}function qa(r){return()=>r.selectActiveProjectPrompt()}function Xa(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function sn(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ur={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(r,t){(function(e){r.exports=e()})(function(){return function e(n,a,i){function s(c,f){if(!a[c]){if(!n[c]){var d=typeof sn=="function"&&sn;if(!f&&d)return d(c,!0);if(o)return o(c,!0);var w=new Error("Cannot find module '"+c+"'");throw w.code="MODULE_NOT_FOUND",w}var u=a[c]={exports:{}};n[c][0].call(u.exports,function(m){var p=n[c][1][m];return s(p||m)},u,u.exports,e,n,a,i)}return a[c].exports}for(var o=typeof sn=="function"&&sn,l=0;l<i.length;l++)s(i[l]);return s}({1:[function(e,n,a){var i=e("./utils"),s=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var c,f,d,w,u,m,p,v=[],h=0,b=l.length,y=b,$=i.getTypeOf(l)!=="string";h<l.length;)y=b-h,d=$?(c=l[h++],f=h<b?l[h++]:0,h<b?l[h++]:0):(c=l.charCodeAt(h++),f=h<b?l.charCodeAt(h++):0,h<b?l.charCodeAt(h++):0),w=c>>2,u=(3&c)<<4|f>>4,m=1<y?(15&f)<<2|d>>6:64,p=2<y?63&d:64,v.push(o.charAt(w)+o.charAt(u)+o.charAt(m)+o.charAt(p));return v.join("")},a.decode=function(l){var c,f,d,w,u,m,p=0,v=0,h="data:";if(l.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var b,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=s.uint8array?new Uint8Array(0|y):new Array(0|y);p<l.length;)c=o.indexOf(l.charAt(p++))<<2|(w=o.indexOf(l.charAt(p++)))>>4,f=(15&w)<<4|(u=o.indexOf(l.charAt(p++)))>>2,d=(3&u)<<6|(m=o.indexOf(l.charAt(p++))),b[v++]=c,u!==64&&(b[v++]=f),m!==64&&(b[v++]=d);return b}},{"./support":30,"./utils":32}],2:[function(e,n,a){var i=e("./external"),s=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(f,d,w,u,m){this.compressedSize=f,this.uncompressedSize=d,this.crc32=w,this.compression=u,this.compressedContent=m}c.prototype={getContentWorker:function(){var f=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return f.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(f,d,w){return f.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(w)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,a){var i=e("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},a.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,a){var i=e("./utils"),s=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var f=0;f<8;f++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?function(c,f,d,w){var u=s,m=w+d;c^=-1;for(var p=w;p<m;p++)c=c>>>8^u[255&(c^f[p])];return-1^c}(0|l,o,o.length,0):function(c,f,d,w){var u=s,m=w+d;c^=-1;for(var p=w;p<m;p++)c=c>>>8^u[255&(c^f.charCodeAt(p))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(e,n,a){var i=null;i=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:i}},{lie:37}],7:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=i?"uint8array":"array";function f(d,w){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=w,this.meta={}}a.magic="\b\0",o.inherits(f,l),f.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,d.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(w){d.push({data:w,meta:d.meta})}},a.compressWorker=function(d){return new f("Deflate",d)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,a){function i(u,m){var p,v="";for(p=0;p<m;p++)v+=String.fromCharCode(255&u),u>>>=8;return v}function s(u,m,p,v,h,b){var y,$,k=u.file,D=u.compression,P=b!==c.utf8encode,z=o.transformTo("string",b(k.name)),N=o.transformTo("string",c.utf8encode(k.name)),j=k.comment,q=o.transformTo("string",b(j)),x=o.transformTo("string",c.utf8encode(j)),I=N.length!==k.name.length,_=x.length!==j.length,W="",st="",V="",ot=k.dir,G=k.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(ft.crc32=u.crc32,ft.compressedSize=u.compressedSize,ft.uncompressedSize=u.uncompressedSize);var O=0;m&&(O|=8),P||!I&&!_||(O|=2048);var T=0,lt=0;ot&&(T|=16),h==="UNIX"?(lt=798,T|=function(X,Ct){var Nt=X;return X||(Nt=Ct?16893:33204),(65535&Nt)<<16}(k.unixPermissions,ot)):(lt=20,T|=function(X){return 63&(X||0)}(k.dosPermissions)),y=G.getUTCHours(),y<<=6,y|=G.getUTCMinutes(),y<<=5,y|=G.getUTCSeconds()/2,$=G.getUTCFullYear()-1980,$<<=4,$|=G.getUTCMonth()+1,$<<=5,$|=G.getUTCDate(),I&&(st=i(1,1)+i(f(z),4)+N,W+="up"+i(st.length,2)+st),_&&(V=i(1,1)+i(f(q),4)+x,W+="uc"+i(V.length,2)+V);var U="";return U+=`
\0`,U+=i(O,2),U+=D.magic,U+=i(y,2),U+=i($,2),U+=i(ft.crc32,4),U+=i(ft.compressedSize,4),U+=i(ft.uncompressedSize,4),U+=i(z.length,2),U+=i(W.length,2),{fileRecord:d.LOCAL_FILE_HEADER+U+z+W,dirRecord:d.CENTRAL_FILE_HEADER+i(lt,2)+U+i(q.length,2)+"\0\0\0\0"+i(T,4)+i(v,4)+z+W+q}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),f=e("../crc32"),d=e("../signature");function w(u,m,p,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=v,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(w,l),w.prototype.push=function(u){var m=u.meta.percent||0,p=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-v-1))/p:100}}))},w.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var m=this.streamFiles&&!u.file.dir;if(m){var p=s(u,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},w.prototype.closedSource=function(u){this.accumulate=!1;var m=this.streamFiles&&!u.file.dir,p=s(u,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(v){return d.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},w.prototype.flush=function(){for(var u=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-u,v=function(h,b,y,$,k){var D=o.transformTo("string",k($));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(h,2)+i(h,2)+i(b,4)+i(y,4)+i(D.length,2)+D}(this.dirRecords.length,p,u,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},w.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},w.prototype.registerPrevious=function(u){this._sources.push(u);var m=this;return u.on("data",function(p){m.processChunk(p)}),u.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),u.on("error",function(p){m.error(p)}),this},w.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},w.prototype.error=function(u){var m=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var p=0;p<m.length;p++)try{m[p].error(u)}catch{}return!0},w.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,m=0;m<u.length;m++)u[m].lock()},n.exports=w},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,a){var i=e("../compressions"),s=e("./ZipFileWorker");a.generateWorker=function(o,l,c){var f=new s(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{o.forEach(function(w,u){d++;var m=function(b,y){var $=b||y,k=i[$];if(!k)throw new Error($+" is not a valid compression method !");return k}(u.options.compression,l.compression),p=u.options.compressionOptions||l.compressionOptions||{},v=u.dir,h=u.date;u._compressWorker(m,p).withStreamInfo("file",{name:w,dir:v,date:h,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(f)}),f.entriesCount=d}catch(w){f.error(w)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,a){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(s,o){return new i().loadAsync(s,o)},i.external=e("./external"),n.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,a){var i=e("./utils"),s=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),f=e("./nodejsUtils");function d(w){return new s.Promise(function(u,m){var p=w.decompressed.getContentWorker().pipe(new c);p.on("error",function(v){m(v)}).on("end",function(){p.streamInfo.crc32!==w.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}n.exports=function(w,u){var m=this;return u=i.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),f.isNode&&f.isStream(w)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",w,!0,u.optimizedBinaryString,u.base64).then(function(p){var v=new l(u);return v.load(p),v}).then(function(p){var v=[s.Promise.resolve(p)],h=p.files;if(u.checkCRC32)for(var b=0;b<h.length;b++)v.push(d(h[b]));return s.Promise.all(v)}).then(function(p){for(var v=p.shift(),h=v.files,b=0;b<h.length;b++){var y=h[b],$=y.fileNameStr,k=i.resolve(y.fileNameStr);m.file(k,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:u.createFolders}),y.dir||(m.file(k).unsafeOriginalName=$)}return v.zipComment.length&&(m.comment=v.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,a){var i=e("../utils"),s=e("../stream/GenericWorker");function o(l,c){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(o,s),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(f){c.push({data:f,meta:{percent:0}})}).on("error",function(f){c.isPaused?this.generatedError=f:c.error(f)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,a){var i=e("readable-stream").Readable;function s(o,l,c){i.call(this,l),this._helper=o;var f=this;o.on("data",function(d,w){f.push(d)||f._helper.pause(),c&&c(w)}).on("error",function(d){f.emit("error",d)}).on("end",function(){f.push(null)})}e("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(e,n,a){function i(k,D,P){var z,N=o.getTypeOf(D),j=o.extend(P||{},f);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(k=h(k)),j.createFolders&&(z=v(k))&&b.call(this,z,!0);var q=N==="string"&&j.binary===!1&&j.base64===!1;P&&P.binary!==void 0||(j.binary=!q),(D instanceof d&&D.uncompressedSize===0||j.dir||!D||D.length===0)&&(j.base64=!1,j.binary=!0,D="",j.compression="STORE",N="string");var x=null;x=D instanceof d||D instanceof l?D:m.isNode&&m.isStream(D)?new p(k,D):o.prepareContent(k,D,j.binary,j.optimizedBinaryString,j.base64);var I=new w(k,x,j);this.files[k]=I}var s=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),f=e("./defaults"),d=e("./compressedObject"),w=e("./zipObject"),u=e("./generate"),m=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),v=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var D=k.lastIndexOf("/");return 0<D?k.substring(0,D):""},h=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},b=function(k,D){return D=D!==void 0?D:f.createFolders,k=h(k),this.files[k]||i.call(this,k,null,{dir:!0,createFolders:D}),this.files[k]};function y(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var $={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var D,P,z;for(D in this.files)z=this.files[D],(P=D.slice(this.root.length,D.length))&&D.slice(0,this.root.length)===this.root&&k(P,z)},filter:function(k){var D=[];return this.forEach(function(P,z){k(P,z)&&D.push(z)}),D},file:function(k,D,P){if(arguments.length!==1)return k=this.root+k,i.call(this,k,D,P),this;if(y(k)){var z=k;return this.filter(function(j,q){return!q.dir&&z.test(j)})}var N=this.files[this.root+k];return N&&!N.dir?N:null},folder:function(k){if(!k)return this;if(y(k))return this.filter(function(N,j){return j.dir&&k.test(N)});var D=this.root+k,P=b.call(this,D),z=this.clone();return z.root=P.name,z},remove:function(k){k=this.root+k;var D=this.files[k];if(D||(k.slice(-1)!=="/"&&(k+="/"),D=this.files[k]),D&&!D.dir)delete this.files[k];else for(var P=this.filter(function(N,j){return j.name.slice(0,k.length)===k}),z=0;z<P.length;z++)delete this.files[P[z].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var D,P={};try{if((P=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");o.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var z=P.comment||this.comment||"";D=u.generateWorker(this,P,z)}catch(N){(D=new l("error")).error(N)}return new c(D,P.type||"string",P.mimeType)},generateAsync:function(k,D){return this.generateInternalStream(k).accumulate(D)},generateNodeStream:function(k,D){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(D)}};n.exports=$},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,a){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),d=o.charCodeAt(3),w=this.length-4;0<=w;--w)if(this.data[w]===l&&this.data[w+1]===c&&this.data[w+2]===f&&this.data[w+3]===d)return w-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),d=o.charCodeAt(3),w=this.readData(4);return l===w[0]&&c===w[1]&&f===w[2]&&d===w[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,n,a){var i=e("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(e,n,a){var i=e("./Uint8ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,n,a){var i=e("./ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,a){var i=e("../utils"),s=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),f=e("./Uint8ArrayReader");n.exports=function(d){var w=i.getTypeOf(d);return i.checkSupport(w),w!=="string"||s.uint8array?w==="nodebuffer"?new c(d):s.uint8array?new f(i.transformTo("uint8array",d)):new o(i.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,a){var i=e("./GenericWorker"),s=e("../utils");function o(l){i.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,i),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,a){var i=e("./GenericWorker"),s=e("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,i),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(o,s),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){c.dataIsReady=!0,c.data=f,c.max=f&&f.length||0,c.type=i.getTypeOf(f),c.isPaused||c._tickAndRepeat()},function(f){c.error(f)})}i.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,a){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=i},{}],29:[function(e,n,a){var i=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),f=e("../external"),d=null;if(c.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function w(m,p){return new f.Promise(function(v,h){var b=[],y=m._internalType,$=m._outputType,k=m._mimeType;m.on("data",function(D,P){b.push(D),p&&p(P)}).on("error",function(D){b=[],h(D)}).on("end",function(){try{var D=function(P,z,N){switch(P){case"blob":return i.newBlob(i.transformTo("arraybuffer",z),N);case"base64":return l.encode(z);default:return i.transformTo(P,z)}}($,function(P,z){var N,j=0,q=null,x=0;for(N=0;N<z.length;N++)x+=z[N].length;switch(P){case"string":return z.join("");case"array":return Array.prototype.concat.apply([],z);case"uint8array":for(q=new Uint8Array(x),N=0;N<z.length;N++)q.set(z[N],j),j+=z[N].length;return q;case"nodebuffer":return Buffer.concat(z);default:throw new Error("concat : unsupported type '"+P+"'")}}(y,b),k);v(D)}catch(P){h(P)}b=[]}).resume()})}function u(m,p,v){var h=p;switch(p){case"blob":case"arraybuffer":h="uint8array";break;case"base64":h="string"}try{this._internalType=h,this._outputType=p,this._mimeType=v,i.checkSupport(h),this._worker=m.pipe(new s(h)),m.lock()}catch(b){this._worker=new o("error"),this._worker.error(b)}}u.prototype={accumulate:function(m){return w(this,m)},on:function(m,p){var v=this;return m==="data"?this._worker.on(m,function(h){p.call(v,h.data,h.meta)}):this._worker.on(m,function(){i.delay(p,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var i=new ArrayBuffer(0);try{a.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!e("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,a){for(var i=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),f=0;f<256;f++)c[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function w(){l.call(this,"utf-8 encode")}a.utf8encode=function(u){return s.nodebuffer?o.newBufferFrom(u,"utf-8"):function(m){var p,v,h,b,y,$=m.length,k=0;for(b=0;b<$;b++)(64512&(v=m.charCodeAt(b)))==55296&&b+1<$&&(64512&(h=m.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(h-56320),b++),k+=v<128?1:v<2048?2:v<65536?3:4;for(p=s.uint8array?new Uint8Array(k):new Array(k),b=y=0;y<k;b++)(64512&(v=m.charCodeAt(b)))==55296&&b+1<$&&(64512&(h=m.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(h-56320),b++),v<128?p[y++]=v:(v<2048?p[y++]=192|v>>>6:(v<65536?p[y++]=224|v>>>12:(p[y++]=240|v>>>18,p[y++]=128|v>>>12&63),p[y++]=128|v>>>6&63),p[y++]=128|63&v);return p}(u)},a.utf8decode=function(u){return s.nodebuffer?i.transformTo("nodebuffer",u).toString("utf-8"):function(m){var p,v,h,b,y=m.length,$=new Array(2*y);for(p=v=0;p<y;)if((h=m[p++])<128)$[v++]=h;else if(4<(b=c[h]))$[v++]=65533,p+=b-1;else{for(h&=b===2?31:b===3?15:7;1<b&&p<y;)h=h<<6|63&m[p++],b--;1<b?$[v++]=65533:h<65536?$[v++]=h:(h-=65536,$[v++]=55296|h>>10&1023,$[v++]=56320|1023&h)}return $.length!==v&&($.subarray?$=$.subarray(0,v):$.length=v),i.applyFromCharCode($)}(u=i.transformTo(s.uint8array?"uint8array":"array",u))},i.inherits(d,l),d.prototype.processChunk=function(u){var m=i.transformTo(s.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var v=function(b,y){var $;for((y=y||b.length)>b.length&&(y=b.length),$=y-1;0<=$&&(192&b[$])==128;)$--;return $<0||$===0?y:$+c[b[$]]>y?$:y}(m),h=m;v!==m.length&&(s.uint8array?(h=m.subarray(0,v),this.leftOver=m.subarray(v,m.length)):(h=m.slice(0,v),this.leftOver=m.slice(v,m.length))),this.push({data:a.utf8decode(h),meta:u.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=d,i.inherits(w,l),w.prototype.processChunk=function(u){this.push({data:a.utf8encode(u.data),meta:u.meta})},a.Utf8EncodeWorker=w},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,a){var i=e("./support"),s=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(p){return p}function f(p,v){for(var h=0;h<p.length;++h)v[h]=255&p.charCodeAt(h);return v}e("setimmediate"),a.newBlob=function(p,v){a.checkSupport("blob");try{return new Blob([p],{type:v})}catch{try{var h=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return h.append(p),h.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,v,h){var b=[],y=0,$=p.length;if($<=h)return String.fromCharCode.apply(null,p);for(;y<$;)v==="array"||v==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(y,Math.min(y+h,$)))):b.push(String.fromCharCode.apply(null,p.subarray(y,Math.min(y+h,$)))),y+=h;return b.join("")},stringifyByChar:function(p){for(var v="",h=0;h<p.length;h++)v+=String.fromCharCode(p[h]);return v},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function w(p){var v=65536,h=a.getTypeOf(p),b=!0;if(h==="uint8array"?b=d.applyCanBeUsed.uint8array:h==="nodebuffer"&&(b=d.applyCanBeUsed.nodebuffer),b)for(;1<v;)try{return d.stringifyByChunk(p,h,v)}catch{v=Math.floor(v/2)}return d.stringifyByChar(p)}function u(p,v){for(var h=0;h<p.length;h++)v[h]=p[h];return v}a.applyFromCharCode=w;var m={};m.string={string:c,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:function(p){return f(p,o.allocBuffer(p.length))}},m.array={string:w,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},m.arraybuffer={string:function(p){return w(new Uint8Array(p))},array:function(p){return u(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:w,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return o.newBufferFrom(p)}},m.nodebuffer={string:w,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:c},a.transformTo=function(p,v){if(v=v||"",!p)return v;a.checkSupport(p);var h=a.getTypeOf(v);return m[h][p](v)},a.resolve=function(p){for(var v=p.split("/"),h=[],b=0;b<v.length;b++){var y=v[b];y==="."||y===""&&b!==0&&b!==v.length-1||(y===".."?h.pop():h.push(y))}return h.join("/")},a.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(p)?"nodebuffer":i.uint8array&&p instanceof Uint8Array?"uint8array":i.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(p){if(!i[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(p){var v,h,b="";for(h=0;h<(p||"").length;h++)b+="\\x"+((v=p.charCodeAt(h))<16?"0":"")+v.toString(16).toUpperCase();return b},a.delay=function(p,v,h){setImmediate(function(){p.apply(h||null,v||[])})},a.inherits=function(p,v){function h(){}h.prototype=v.prototype,p.prototype=new h},a.extend=function(){var p,v,h={};for(p=0;p<arguments.length;p++)for(v in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],v)&&h[v]===void 0&&(h[v]=arguments[p][v]);return h},a.prepareContent=function(p,v,h,b,y){return l.Promise.resolve(v).then(function($){return i.blob&&($ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call($))!==-1)&&typeof FileReader<"u"?new l.Promise(function(k,D){var P=new FileReader;P.onload=function(z){k(z.target.result)},P.onerror=function(z){D(z.target.error)},P.readAsArrayBuffer($)}):$}).then(function($){var k=a.getTypeOf($);return k?(k==="arraybuffer"?$=a.transformTo("uint8array",$):k==="string"&&(y?$=s.decode($):h&&b!==!0&&($=function(D){return f(D,i.uint8array?new Uint8Array(D.length):new Array(D.length))}($))),$):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function f(d){this.files=[],this.loadOptions=d}f.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var w=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(w)+", expected "+s.pretty(d)+")")}},isSignature:function(d,w){var u=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===w;return this.reader.setIndex(u),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),w=c.uint8array?"uint8array":"array",u=s.transformTo(w,d);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,w,u,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),w=this.reader.readInt(4),u=this.reader.readData(w),this.zip64ExtensibleData[d]={id:d,length:w,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,w;for(d=0;d<this.files.length;d++)w=this.files[d],this.reader.setIndex(w.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),w.readLocalPart(this.reader),w.handleUTF8(),w.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var w=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var m=w-u;if(0<m)this.isSignature(w,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=i(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),f=e("./compressions"),d=e("./support");function w(u,m){this.options=u,this.loadOptions=m}w.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var m,p;if(u.skip(22),this.fileNameLength=u.readInt(2),p=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(v){for(var h in f)if(Object.prototype.hasOwnProperty.call(f,h)&&f[h].magic===v)return f[h];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var m=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(m),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var m,p,v,h=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<h;)m=u.readInt(2),p=u.readInt(2),v=u.readData(p),this.extraFields[m]={id:m,length:p,value:v};u.setIndex(h)},handleUTF8:function(){var u=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=s.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var h=s.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(h)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var m=i(u.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var m=i(u.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null}},n.exports=w},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,a){function i(m,p,v){this.name=m,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=p,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var s=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),f=e("./stream/GenericWorker");i.prototype={internalStream:function(m){var p=null,v="string";try{if(!m)throw new Error("No output type specified.");var h=(v=m.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!h&&(p=p.pipe(new l.Utf8EncodeWorker)),!b&&h&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(y){(p=new f("error")).error(y)}return new s(p,v,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof c&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(v,m,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof f?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],w=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)i.prototype[d[u]]=w;n.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,a){(function(i){var s,o,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var c=0,f=new l(m),d=i.document.createTextNode("");f.observe(d,{characterData:!0}),s=function(){d.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var p=i.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},i.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var w=new i.MessageChannel;w.port1.onmessage=m,s=function(){w.port2.postMessage(0)}}var u=[];function m(){var p,v;o=!0;for(var h=u.length;h;){for(v=u,u=[],p=-1;++p<h;)v[p]();h=u.length}o=!1}n.exports=function(p){u.push(p)!==1||o||s()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,a){var i=e("immediate");function s(){}var o={},l=["REJECTED"],c=["FULFILLED"],f=["PENDING"];function d(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,h!==s&&p(this,h)}function w(h,b,y){this.promise=h,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function u(h,b,y){i(function(){var $;try{$=b(y)}catch(k){return o.reject(h,k)}$===h?o.reject(h,new TypeError("Cannot resolve promise with itself")):o.resolve(h,$)})}function m(h){var b=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof b=="function")return function(){b.apply(h,arguments)}}function p(h,b){var y=!1;function $(P){y||(y=!0,o.reject(h,P))}function k(P){y||(y=!0,o.resolve(h,P))}var D=v(function(){b(k,$)});D.status==="error"&&$(D.value)}function v(h,b){var y={};try{y.value=h(b),y.status="success"}catch($){y.status="error",y.value=$}return y}(n.exports=d).prototype.finally=function(h){if(typeof h!="function")return this;var b=this.constructor;return this.then(function(y){return b.resolve(h()).then(function(){return y})},function(y){return b.resolve(h()).then(function(){throw y})})},d.prototype.catch=function(h){return this.then(null,h)},d.prototype.then=function(h,b){if(typeof h!="function"&&this.state===c||typeof b!="function"&&this.state===l)return this;var y=new this.constructor(s);return this.state!==f?u(y,this.state===c?h:b,this.outcome):this.queue.push(new w(y,h,b)),y},w.prototype.callFulfilled=function(h){o.resolve(this.promise,h)},w.prototype.otherCallFulfilled=function(h){u(this.promise,this.onFulfilled,h)},w.prototype.callRejected=function(h){o.reject(this.promise,h)},w.prototype.otherCallRejected=function(h){u(this.promise,this.onRejected,h)},o.resolve=function(h,b){var y=v(m,b);if(y.status==="error")return o.reject(h,y.value);var $=y.value;if($)p(h,$);else{h.state=c,h.outcome=b;for(var k=-1,D=h.queue.length;++k<D;)h.queue[k].callFulfilled(b)}return h},o.reject=function(h,b){h.state=l,h.outcome=b;for(var y=-1,$=h.queue.length;++y<$;)h.queue[y].callRejected(b);return h},d.resolve=function(h){return h instanceof this?h:o.resolve(new this(s),h)},d.reject=function(h){var b=new this(s);return o.reject(b,h)},d.all=function(h){var b=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=h.length,$=!1;if(!y)return this.resolve([]);for(var k=new Array(y),D=0,P=-1,z=new this(s);++P<y;)N(h[P],P);return z;function N(j,q){b.resolve(j).then(function(x){k[q]=x,++D!==y||$||($=!0,o.resolve(z,k))},function(x){$||($=!0,o.reject(z,x))})}},d.race=function(h){var b=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=h.length,$=!1;if(!y)return this.resolve([]);for(var k=-1,D=new this(s);++k<y;)P=h[k],b.resolve(P).then(function(z){$||($=!0,o.resolve(D,z))},function(z){$||($=!0,o.reject(D,z))});var P;return D}},{immediate:36}],38:[function(e,n,a){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,a){var i=e("./zlib/deflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),f=Object.prototype.toString,d=0,w=-1,u=0,m=8;function p(h){if(!(this instanceof p))return new p(h);this.options=s.assign({level:w,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},h||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=i.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(y!==d)throw new Error(l[y]);if(b.header&&i.deflateSetHeader(this.strm,b.header),b.dictionary){var $;if($=typeof b.dictionary=="string"?o.string2buf(b.dictionary):f.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(y=i.deflateSetDictionary(this.strm,$))!==d)throw new Error(l[y]);this._dict_set=!0}}function v(h,b){var y=new p(b);if(y.push(h,!0),y.err)throw y.msg||l[y.err];return y.result}p.prototype.push=function(h,b){var y,$,k=this.strm,D=this.options.chunkSize;if(this.ended)return!1;$=b===~~b?b:b===!0?4:0,typeof h=="string"?k.input=o.string2buf(h):f.call(h)==="[object ArrayBuffer]"?k.input=new Uint8Array(h):k.input=h,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(D),k.next_out=0,k.avail_out=D),(y=i.deflate(k,$))!==1&&y!==d)return this.onEnd(y),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||$!==4&&$!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(k.output,k.next_out))):this.onData(s.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&y!==1);return $===4?(y=i.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===d):$!==2||(this.onEnd(d),!(k.avail_out=0))},p.prototype.onData=function(h){this.chunks.push(h)},p.prototype.onEnd=function(h){h===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},a.Deflate=p,a.deflate=v,a.deflateRaw=function(h,b){return(b=b||{}).raw=!0,v(h,b)},a.gzip=function(h,b){return(b=b||{}).gzip=!0,v(h,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,a){var i=e("./zlib/inflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),f=e("./zlib/zstream"),d=e("./zlib/gzheader"),w=Object.prototype.toString;function u(p){if(!(this instanceof u))return new u(p);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},p||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||p&&p.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var h=i.inflateInit2(this.strm,v.windowBits);if(h!==l.Z_OK)throw new Error(c[h]);this.header=new d,i.inflateGetHeader(this.strm,this.header)}function m(p,v){var h=new u(v);if(h.push(p,!0),h.err)throw h.msg||c[h.err];return h.result}u.prototype.push=function(p,v){var h,b,y,$,k,D,P=this.strm,z=this.options.chunkSize,N=this.options.dictionary,j=!1;if(this.ended)return!1;b=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?P.input=o.binstring2buf(p):w.call(p)==="[object ArrayBuffer]"?P.input=new Uint8Array(p):P.input=p,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new s.Buf8(z),P.next_out=0,P.avail_out=z),(h=i.inflate(P,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&N&&(D=typeof N=="string"?o.string2buf(N):w.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,h=i.inflateSetDictionary(this.strm,D)),h===l.Z_BUF_ERROR&&j===!0&&(h=l.Z_OK,j=!1),h!==l.Z_STREAM_END&&h!==l.Z_OK)return this.onEnd(h),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&h!==l.Z_STREAM_END&&(P.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(P.output,P.next_out),$=P.next_out-y,k=o.buf2string(P.output,y),P.next_out=$,P.avail_out=z-$,$&&s.arraySet(P.output,P.output,y,$,0),this.onData(k)):this.onData(s.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(j=!0)}while((0<P.avail_in||P.avail_out===0)&&h!==l.Z_STREAM_END);return h===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(h=i.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(P.avail_out=0))},u.prototype.onData=function(p){this.chunks.push(p)},u.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},a.Inflate=u,a.inflate=m,a.inflateRaw=function(p,v){return(v=v||{}).raw=!0,m(p,v)},a.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var f=c.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var d in f)f.hasOwnProperty(d)&&(l[d]=f[d])}}return l},a.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var s={arraySet:function(l,c,f,d,w){if(c.subarray&&l.subarray)l.set(c.subarray(f,f+d),w);else for(var u=0;u<d;u++)l[w+u]=c[f+u]},flattenChunks:function(l){var c,f,d,w,u,m;for(c=d=0,f=l.length;c<f;c++)d+=l[c].length;for(m=new Uint8Array(d),c=w=0,f=l.length;c<f;c++)u=l[c],m.set(u,w),w+=u.length;return m}},o={arraySet:function(l,c,f,d,w){for(var u=0;u<d;u++)l[w+u]=c[f+u]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,o))},a.setTyped(i)},{}],42:[function(e,n,a){var i=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new i.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function f(d,w){if(w<65537&&(d.subarray&&o||!d.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(d,w));for(var u="",m=0;m<w;m++)u+=String.fromCharCode(d[m]);return u}l[254]=l[254]=1,a.string2buf=function(d){var w,u,m,p,v,h=d.length,b=0;for(p=0;p<h;p++)(64512&(u=d.charCodeAt(p)))==55296&&p+1<h&&(64512&(m=d.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),b+=u<128?1:u<2048?2:u<65536?3:4;for(w=new i.Buf8(b),p=v=0;v<b;p++)(64512&(u=d.charCodeAt(p)))==55296&&p+1<h&&(64512&(m=d.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),u<128?w[v++]=u:(u<2048?w[v++]=192|u>>>6:(u<65536?w[v++]=224|u>>>12:(w[v++]=240|u>>>18,w[v++]=128|u>>>12&63),w[v++]=128|u>>>6&63),w[v++]=128|63&u);return w},a.buf2binstring=function(d){return f(d,d.length)},a.binstring2buf=function(d){for(var w=new i.Buf8(d.length),u=0,m=w.length;u<m;u++)w[u]=d.charCodeAt(u);return w},a.buf2string=function(d,w){var u,m,p,v,h=w||d.length,b=new Array(2*h);for(u=m=0;u<h;)if((p=d[u++])<128)b[m++]=p;else if(4<(v=l[p]))b[m++]=65533,u+=v-1;else{for(p&=v===2?31:v===3?15:7;1<v&&u<h;)p=p<<6|63&d[u++],v--;1<v?b[m++]=65533:p<65536?b[m++]=p:(p-=65536,b[m++]=55296|p>>10&1023,b[m++]=56320|1023&p)}return f(b,m)},a.utf8border=function(d,w){var u;for((w=w||d.length)>d.length&&(w=d.length),u=w-1;0<=u&&(192&d[u])==128;)u--;return u<0||u===0?w:u+l[d[u]]>w?u:w}},{"./common":41}],43:[function(e,n,a){n.exports=function(i,s,o,l){for(var c=65535&i|0,f=i>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;f=f+(c=c+s[l++]|0)|0,--d;);c%=65521,f%=65521}return c|f<<16|0}},{}],44:[function(e,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,a){var i=function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o}();n.exports=function(s,o,l,c){var f=i,d=c+l;s^=-1;for(var w=c;w<d;w++)s=s>>>8^f[255&(s^o[w])];return-1^s}},{}],46:[function(e,n,a){var i,s=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),f=e("./messages"),d=0,w=4,u=0,m=-2,p=-1,v=4,h=2,b=8,y=9,$=286,k=30,D=19,P=2*$+1,z=15,N=3,j=258,q=j+N+1,x=42,I=113,_=1,W=2,st=3,V=4;function ot(g,H){return g.msg=f[H],H}function G(g){return(g<<1)-(4<g?9:0)}function ft(g){for(var H=g.length;0<=--H;)g[H]=0}function O(g){var H=g.state,M=H.pending;M>g.avail_out&&(M=g.avail_out),M!==0&&(s.arraySet(g.output,H.pending_buf,H.pending_out,M,g.next_out),g.next_out+=M,H.pending_out+=M,g.total_out+=M,g.avail_out-=M,H.pending-=M,H.pending===0&&(H.pending_out=0))}function T(g,H){o._tr_flush_block(g,0<=g.block_start?g.block_start:-1,g.strstart-g.block_start,H),g.block_start=g.strstart,O(g.strm)}function lt(g,H){g.pending_buf[g.pending++]=H}function U(g,H){g.pending_buf[g.pending++]=H>>>8&255,g.pending_buf[g.pending++]=255&H}function X(g,H){var M,C,S=g.max_chain_length,E=g.strstart,Z=g.prev_length,Y=g.nice_match,A=g.strstart>g.w_size-q?g.strstart-(g.w_size-q):0,J=g.window,at=g.w_mask,tt=g.prev,L=g.strstart+j,nt=J[E+Z-1],it=J[E+Z];g.prev_length>=g.good_match&&(S>>=2),Y>g.lookahead&&(Y=g.lookahead);do if(J[(M=H)+Z]===it&&J[M+Z-1]===nt&&J[M]===J[E]&&J[++M]===J[E+1]){E+=2,M++;do;while(J[++E]===J[++M]&&J[++E]===J[++M]&&J[++E]===J[++M]&&J[++E]===J[++M]&&J[++E]===J[++M]&&J[++E]===J[++M]&&J[++E]===J[++M]&&J[++E]===J[++M]&&E<L);if(C=j-(L-E),E=L-j,Z<C){if(g.match_start=H,Y<=(Z=C))break;nt=J[E+Z-1],it=J[E+Z]}}while((H=tt[H&at])>A&&--S!=0);return Z<=g.lookahead?Z:g.lookahead}function Ct(g){var H,M,C,S,E,Z,Y,A,J,at,tt=g.w_size;do{if(S=g.window_size-g.lookahead-g.strstart,g.strstart>=tt+(tt-q)){for(s.arraySet(g.window,g.window,tt,tt,0),g.match_start-=tt,g.strstart-=tt,g.block_start-=tt,H=M=g.hash_size;C=g.head[--H],g.head[H]=tt<=C?C-tt:0,--M;);for(H=M=tt;C=g.prev[--H],g.prev[H]=tt<=C?C-tt:0,--M;);S+=tt}if(g.strm.avail_in===0)break;if(Z=g.strm,Y=g.window,A=g.strstart+g.lookahead,J=S,at=void 0,at=Z.avail_in,J<at&&(at=J),M=at===0?0:(Z.avail_in-=at,s.arraySet(Y,Z.input,Z.next_in,at,A),Z.state.wrap===1?Z.adler=l(Z.adler,Y,at,A):Z.state.wrap===2&&(Z.adler=c(Z.adler,Y,at,A)),Z.next_in+=at,Z.total_in+=at,at),g.lookahead+=M,g.lookahead+g.insert>=N)for(E=g.strstart-g.insert,g.ins_h=g.window[E],g.ins_h=(g.ins_h<<g.hash_shift^g.window[E+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[E+N-1])&g.hash_mask,g.prev[E&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=E,E++,g.insert--,!(g.lookahead+g.insert<N)););}while(g.lookahead<q&&g.strm.avail_in!==0)}function Nt(g,H){for(var M,C;;){if(g.lookahead<q){if(Ct(g),g.lookahead<q&&H===d)return _;if(g.lookahead===0)break}if(M=0,g.lookahead>=N&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+N-1])&g.hash_mask,M=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),M!==0&&g.strstart-M<=g.w_size-q&&(g.match_length=X(g,M)),g.match_length>=N)if(C=o._tr_tally(g,g.strstart-g.match_start,g.match_length-N),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=N){for(g.match_length--;g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+N-1])&g.hash_mask,M=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart,--g.match_length!=0;);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else C=o._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(C&&(T(g,!1),g.strm.avail_out===0))return _}return g.insert=g.strstart<N-1?g.strstart:N-1,H===w?(T(g,!0),g.strm.avail_out===0?st:V):g.last_lit&&(T(g,!1),g.strm.avail_out===0)?_:W}function wt(g,H){for(var M,C,S;;){if(g.lookahead<q){if(Ct(g),g.lookahead<q&&H===d)return _;if(g.lookahead===0)break}if(M=0,g.lookahead>=N&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+N-1])&g.hash_mask,M=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=N-1,M!==0&&g.prev_length<g.max_lazy_match&&g.strstart-M<=g.w_size-q&&(g.match_length=X(g,M),g.match_length<=5&&(g.strategy===1||g.match_length===N&&4096<g.strstart-g.match_start)&&(g.match_length=N-1)),g.prev_length>=N&&g.match_length<=g.prev_length){for(S=g.strstart+g.lookahead-N,C=o._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-N),g.lookahead-=g.prev_length-1,g.prev_length-=2;++g.strstart<=S&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+N-1])&g.hash_mask,M=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),--g.prev_length!=0;);if(g.match_available=0,g.match_length=N-1,g.strstart++,C&&(T(g,!1),g.strm.avail_out===0))return _}else if(g.match_available){if((C=o._tr_tally(g,0,g.window[g.strstart-1]))&&T(g,!1),g.strstart++,g.lookahead--,g.strm.avail_out===0)return _}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(C=o._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<N-1?g.strstart:N-1,H===w?(T(g,!0),g.strm.avail_out===0?st:V):g.last_lit&&(T(g,!1),g.strm.avail_out===0)?_:W}function yt(g,H,M,C,S){this.good_length=g,this.max_lazy=H,this.nice_length=M,this.max_chain=C,this.func=S}function At(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*P),this.dyn_dtree=new s.Buf16(2*(2*k+1)),this.bl_tree=new s.Buf16(2*(2*D+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(z+1),this.heap=new s.Buf16(2*$+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*$+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dt(g){var H;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=h,(H=g.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?x:I,g.adler=H.wrap===2?0:1,H.last_flush=d,o._tr_init(H),u):ot(g,m)}function Qt(g){var H=Dt(g);return H===u&&function(M){M.window_size=2*M.w_size,ft(M.head),M.max_lazy_match=i[M.level].max_lazy,M.good_match=i[M.level].good_length,M.nice_match=i[M.level].nice_length,M.max_chain_length=i[M.level].max_chain,M.strstart=0,M.block_start=0,M.lookahead=0,M.insert=0,M.match_length=M.prev_length=N-1,M.match_available=0,M.ins_h=0}(g.state),H}function Ut(g,H,M,C,S,E){if(!g)return m;var Z=1;if(H===p&&(H=6),C<0?(Z=0,C=-C):15<C&&(Z=2,C-=16),S<1||y<S||M!==b||C<8||15<C||H<0||9<H||E<0||v<E)return ot(g,m);C===8&&(C=9);var Y=new At;return(g.state=Y).strm=g,Y.wrap=Z,Y.gzhead=null,Y.w_bits=C,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=S+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+N-1)/N),Y.window=new s.Buf8(2*Y.w_size),Y.head=new s.Buf16(Y.hash_size),Y.prev=new s.Buf16(Y.w_size),Y.lit_bufsize=1<<S+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new s.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=H,Y.strategy=E,Y.method=M,Qt(g)}i=[new yt(0,0,0,0,function(g,H){var M=65535;for(M>g.pending_buf_size-5&&(M=g.pending_buf_size-5);;){if(g.lookahead<=1){if(Ct(g),g.lookahead===0&&H===d)return _;if(g.lookahead===0)break}g.strstart+=g.lookahead,g.lookahead=0;var C=g.block_start+M;if((g.strstart===0||g.strstart>=C)&&(g.lookahead=g.strstart-C,g.strstart=C,T(g,!1),g.strm.avail_out===0)||g.strstart-g.block_start>=g.w_size-q&&(T(g,!1),g.strm.avail_out===0))return _}return g.insert=0,H===w?(T(g,!0),g.strm.avail_out===0?st:V):(g.strstart>g.block_start&&(T(g,!1),g.strm.avail_out),_)}),new yt(4,4,8,4,Nt),new yt(4,5,16,8,Nt),new yt(4,6,32,32,Nt),new yt(4,4,16,16,wt),new yt(8,16,32,32,wt),new yt(8,16,128,128,wt),new yt(8,32,128,256,wt),new yt(32,128,258,1024,wt),new yt(32,258,258,4096,wt)],a.deflateInit=function(g,H){return Ut(g,H,b,15,8,0)},a.deflateInit2=Ut,a.deflateReset=Qt,a.deflateResetKeep=Dt,a.deflateSetHeader=function(g,H){return g&&g.state?g.state.wrap!==2?m:(g.state.gzhead=H,u):m},a.deflate=function(g,H){var M,C,S,E;if(!g||!g.state||5<H||H<0)return g?ot(g,m):m;if(C=g.state,!g.output||!g.input&&g.avail_in!==0||C.status===666&&H!==w)return ot(g,g.avail_out===0?-5:m);if(C.strm=g,M=C.last_flush,C.last_flush=H,C.status===x)if(C.wrap===2)g.adler=0,lt(C,31),lt(C,139),lt(C,8),C.gzhead?(lt(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),lt(C,255&C.gzhead.time),lt(C,C.gzhead.time>>8&255),lt(C,C.gzhead.time>>16&255),lt(C,C.gzhead.time>>24&255),lt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),lt(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(lt(C,255&C.gzhead.extra.length),lt(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(g.adler=c(g.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(lt(C,0),lt(C,0),lt(C,0),lt(C,0),lt(C,0),lt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),lt(C,3),C.status=I);else{var Z=b+(C.w_bits-8<<4)<<8;Z|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(Z|=32),Z+=31-Z%31,C.status=I,U(C,Z),C.strstart!==0&&(U(C,g.adler>>>16),U(C,65535&g.adler)),g.adler=1}if(C.status===69)if(C.gzhead.extra){for(S=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>S&&(g.adler=c(g.adler,C.pending_buf,C.pending-S,S)),O(g),S=C.pending,C.pending!==C.pending_buf_size));)lt(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>S&&(g.adler=c(g.adler,C.pending_buf,C.pending-S,S)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){S=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>S&&(g.adler=c(g.adler,C.pending_buf,C.pending-S,S)),O(g),S=C.pending,C.pending===C.pending_buf_size)){E=1;break}E=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,lt(C,E)}while(E!==0);C.gzhead.hcrc&&C.pending>S&&(g.adler=c(g.adler,C.pending_buf,C.pending-S,S)),E===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){S=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>S&&(g.adler=c(g.adler,C.pending_buf,C.pending-S,S)),O(g),S=C.pending,C.pending===C.pending_buf_size)){E=1;break}E=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,lt(C,E)}while(E!==0);C.gzhead.hcrc&&C.pending>S&&(g.adler=c(g.adler,C.pending_buf,C.pending-S,S)),E===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&O(g),C.pending+2<=C.pending_buf_size&&(lt(C,255&g.adler),lt(C,g.adler>>8&255),g.adler=0,C.status=I)):C.status=I),C.pending!==0){if(O(g),g.avail_out===0)return C.last_flush=-1,u}else if(g.avail_in===0&&G(H)<=G(M)&&H!==w)return ot(g,-5);if(C.status===666&&g.avail_in!==0)return ot(g,-5);if(g.avail_in!==0||C.lookahead!==0||H!==d&&C.status!==666){var Y=C.strategy===2?function(A,J){for(var at;;){if(A.lookahead===0&&(Ct(A),A.lookahead===0)){if(J===d)return _;break}if(A.match_length=0,at=o._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++,at&&(T(A,!1),A.strm.avail_out===0))return _}return A.insert=0,J===w?(T(A,!0),A.strm.avail_out===0?st:V):A.last_lit&&(T(A,!1),A.strm.avail_out===0)?_:W}(C,H):C.strategy===3?function(A,J){for(var at,tt,L,nt,it=A.window;;){if(A.lookahead<=j){if(Ct(A),A.lookahead<=j&&J===d)return _;if(A.lookahead===0)break}if(A.match_length=0,A.lookahead>=N&&0<A.strstart&&(tt=it[L=A.strstart-1])===it[++L]&&tt===it[++L]&&tt===it[++L]){nt=A.strstart+j;do;while(tt===it[++L]&&tt===it[++L]&&tt===it[++L]&&tt===it[++L]&&tt===it[++L]&&tt===it[++L]&&tt===it[++L]&&tt===it[++L]&&L<nt);A.match_length=j-(nt-L),A.match_length>A.lookahead&&(A.match_length=A.lookahead)}if(A.match_length>=N?(at=o._tr_tally(A,1,A.match_length-N),A.lookahead-=A.match_length,A.strstart+=A.match_length,A.match_length=0):(at=o._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++),at&&(T(A,!1),A.strm.avail_out===0))return _}return A.insert=0,J===w?(T(A,!0),A.strm.avail_out===0?st:V):A.last_lit&&(T(A,!1),A.strm.avail_out===0)?_:W}(C,H):i[C.level].func(C,H);if(Y!==st&&Y!==V||(C.status=666),Y===_||Y===st)return g.avail_out===0&&(C.last_flush=-1),u;if(Y===W&&(H===1?o._tr_align(C):H!==5&&(o._tr_stored_block(C,0,0,!1),H===3&&(ft(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),O(g),g.avail_out===0))return C.last_flush=-1,u}return H!==w?u:C.wrap<=0?1:(C.wrap===2?(lt(C,255&g.adler),lt(C,g.adler>>8&255),lt(C,g.adler>>16&255),lt(C,g.adler>>24&255),lt(C,255&g.total_in),lt(C,g.total_in>>8&255),lt(C,g.total_in>>16&255),lt(C,g.total_in>>24&255)):(U(C,g.adler>>>16),U(C,65535&g.adler)),O(g),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?u:1)},a.deflateEnd=function(g){var H;return g&&g.state?(H=g.state.status)!==x&&H!==69&&H!==73&&H!==91&&H!==103&&H!==I&&H!==666?ot(g,m):(g.state=null,H===I?ot(g,-3):u):m},a.deflateSetDictionary=function(g,H){var M,C,S,E,Z,Y,A,J,at=H.length;if(!g||!g.state||(E=(M=g.state).wrap)===2||E===1&&M.status!==x||M.lookahead)return m;for(E===1&&(g.adler=l(g.adler,H,at,0)),M.wrap=0,at>=M.w_size&&(E===0&&(ft(M.head),M.strstart=0,M.block_start=0,M.insert=0),J=new s.Buf8(M.w_size),s.arraySet(J,H,at-M.w_size,M.w_size,0),H=J,at=M.w_size),Z=g.avail_in,Y=g.next_in,A=g.input,g.avail_in=at,g.next_in=0,g.input=H,Ct(M);M.lookahead>=N;){for(C=M.strstart,S=M.lookahead-(N-1);M.ins_h=(M.ins_h<<M.hash_shift^M.window[C+N-1])&M.hash_mask,M.prev[C&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=C,C++,--S;);M.strstart=C,M.lookahead=N-1,Ct(M)}return M.strstart+=M.lookahead,M.block_start=M.strstart,M.insert=M.lookahead,M.lookahead=0,M.match_length=M.prev_length=N-1,M.match_available=0,g.next_in=Y,g.input=A,g.avail_in=Z,M.wrap=E,u},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,a){n.exports=function(i,s){var o,l,c,f,d,w,u,m,p,v,h,b,y,$,k,D,P,z,N,j,q,x,I,_,W;o=i.state,l=i.next_in,_=i.input,c=l+(i.avail_in-5),f=i.next_out,W=i.output,d=f-(s-i.avail_out),w=f+(i.avail_out-257),u=o.dmax,m=o.wsize,p=o.whave,v=o.wnext,h=o.window,b=o.hold,y=o.bits,$=o.lencode,k=o.distcode,D=(1<<o.lenbits)-1,P=(1<<o.distbits)-1;t:do{y<15&&(b+=_[l++]<<y,y+=8,b+=_[l++]<<y,y+=8),z=$[b&D];e:for(;;){if(b>>>=N=z>>>24,y-=N,(N=z>>>16&255)===0)W[f++]=65535&z;else{if(!(16&N)){if(!(64&N)){z=$[(65535&z)+(b&(1<<N)-1)];continue e}if(32&N){o.mode=12;break t}i.msg="invalid literal/length code",o.mode=30;break t}j=65535&z,(N&=15)&&(y<N&&(b+=_[l++]<<y,y+=8),j+=b&(1<<N)-1,b>>>=N,y-=N),y<15&&(b+=_[l++]<<y,y+=8,b+=_[l++]<<y,y+=8),z=k[b&P];n:for(;;){if(b>>>=N=z>>>24,y-=N,!(16&(N=z>>>16&255))){if(!(64&N)){z=k[(65535&z)+(b&(1<<N)-1)];continue n}i.msg="invalid distance code",o.mode=30;break t}if(q=65535&z,y<(N&=15)&&(b+=_[l++]<<y,(y+=8)<N&&(b+=_[l++]<<y,y+=8)),u<(q+=b&(1<<N)-1)){i.msg="invalid distance too far back",o.mode=30;break t}if(b>>>=N,y-=N,(N=f-d)<q){if(p<(N=q-N)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break t}if(I=h,(x=0)===v){if(x+=m-N,N<j){for(j-=N;W[f++]=h[x++],--N;);x=f-q,I=W}}else if(v<N){if(x+=m+v-N,(N-=v)<j){for(j-=N;W[f++]=h[x++],--N;);if(x=0,v<j){for(j-=N=v;W[f++]=h[x++],--N;);x=f-q,I=W}}}else if(x+=v-N,N<j){for(j-=N;W[f++]=h[x++],--N;);x=f-q,I=W}for(;2<j;)W[f++]=I[x++],W[f++]=I[x++],W[f++]=I[x++],j-=3;j&&(W[f++]=I[x++],1<j&&(W[f++]=I[x++]))}else{for(x=f-q;W[f++]=W[x++],W[f++]=W[x++],W[f++]=W[x++],2<(j-=3););j&&(W[f++]=W[x++],1<j&&(W[f++]=W[x++]))}break}}break}}while(l<c&&f<w);l-=j=y>>3,b&=(1<<(y-=j<<3))-1,i.next_in=l,i.next_out=f,i.avail_in=l<c?c-l+5:5-(l-c),i.avail_out=f<w?w-f+257:257-(f-w),o.hold=b,o.bits=y}},{}],49:[function(e,n,a){var i=e("../utils/common"),s=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),f=1,d=2,w=0,u=-2,m=1,p=852,v=592;function h(x){return(x>>>24&255)+(x>>>8&65280)+((65280&x)<<8)+((255&x)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(x){var I;return x&&x.state?(I=x.state,x.total_in=x.total_out=I.total=0,x.msg="",I.wrap&&(x.adler=1&I.wrap),I.mode=m,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new i.Buf32(p),I.distcode=I.distdyn=new i.Buf32(v),I.sane=1,I.back=-1,w):u}function $(x){var I;return x&&x.state?((I=x.state).wsize=0,I.whave=0,I.wnext=0,y(x)):u}function k(x,I){var _,W;return x&&x.state?(W=x.state,I<0?(_=0,I=-I):(_=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?u:(W.window!==null&&W.wbits!==I&&(W.window=null),W.wrap=_,W.wbits=I,$(x))):u}function D(x,I){var _,W;return x?(W=new b,(x.state=W).window=null,(_=k(x,I))!==w&&(x.state=null),_):u}var P,z,N=!0;function j(x){if(N){var I;for(P=new i.Buf32(512),z=new i.Buf32(32),I=0;I<144;)x.lens[I++]=8;for(;I<256;)x.lens[I++]=9;for(;I<280;)x.lens[I++]=7;for(;I<288;)x.lens[I++]=8;for(c(f,x.lens,0,288,P,0,x.work,{bits:9}),I=0;I<32;)x.lens[I++]=5;c(d,x.lens,0,32,z,0,x.work,{bits:5}),N=!1}x.lencode=P,x.lenbits=9,x.distcode=z,x.distbits=5}function q(x,I,_,W){var st,V=x.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new i.Buf8(V.wsize)),W>=V.wsize?(i.arraySet(V.window,I,_-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(W<(st=V.wsize-V.wnext)&&(st=W),i.arraySet(V.window,I,_-W,st,V.wnext),(W-=st)?(i.arraySet(V.window,I,_-W,W,0),V.wnext=W,V.whave=V.wsize):(V.wnext+=st,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=st))),0}a.inflateReset=$,a.inflateReset2=k,a.inflateResetKeep=y,a.inflateInit=function(x){return D(x,15)},a.inflateInit2=D,a.inflate=function(x,I){var _,W,st,V,ot,G,ft,O,T,lt,U,X,Ct,Nt,wt,yt,At,Dt,Qt,Ut,g,H,M,C,S=0,E=new i.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!x||!x.state||!x.output||!x.input&&x.avail_in!==0)return u;(_=x.state).mode===12&&(_.mode=13),ot=x.next_out,st=x.output,ft=x.avail_out,V=x.next_in,W=x.input,G=x.avail_in,O=_.hold,T=_.bits,lt=G,U=ft,H=w;t:for(;;)switch(_.mode){case m:if(_.wrap===0){_.mode=13;break}for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(2&_.wrap&&O===35615){E[_.check=0]=255&O,E[1]=O>>>8&255,_.check=o(_.check,E,2,0),T=O=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&O)<<8)+(O>>8))%31){x.msg="incorrect header check",_.mode=30;break}if((15&O)!=8){x.msg="unknown compression method",_.mode=30;break}if(T-=4,g=8+(15&(O>>>=4)),_.wbits===0)_.wbits=g;else if(g>_.wbits){x.msg="invalid window size",_.mode=30;break}_.dmax=1<<g,x.adler=_.check=1,_.mode=512&O?10:12,T=O=0;break;case 2:for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(_.flags=O,(255&_.flags)!=8){x.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){x.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=O>>8&1),512&_.flags&&(E[0]=255&O,E[1]=O>>>8&255,_.check=o(_.check,E,2,0)),T=O=0,_.mode=3;case 3:for(;T<32;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}_.head&&(_.head.time=O),512&_.flags&&(E[0]=255&O,E[1]=O>>>8&255,E[2]=O>>>16&255,E[3]=O>>>24&255,_.check=o(_.check,E,4,0)),T=O=0,_.mode=4;case 4:for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}_.head&&(_.head.xflags=255&O,_.head.os=O>>8),512&_.flags&&(E[0]=255&O,E[1]=O>>>8&255,_.check=o(_.check,E,2,0)),T=O=0,_.mode=5;case 5:if(1024&_.flags){for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}_.length=O,_.head&&(_.head.extra_len=O),512&_.flags&&(E[0]=255&O,E[1]=O>>>8&255,_.check=o(_.check,E,2,0)),T=O=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(G<(X=_.length)&&(X=G),X&&(_.head&&(g=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),i.arraySet(_.head.extra,W,V,X,g)),512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,_.length-=X),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(G===0)break t;for(X=0;g=W[V+X++],_.head&&g&&_.length<65536&&(_.head.name+=String.fromCharCode(g)),g&&X<G;);if(512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,g)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(G===0)break t;for(X=0;g=W[V+X++],_.head&&g&&_.length<65536&&(_.head.comment+=String.fromCharCode(g)),g&&X<G;);if(512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,g)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;T<16;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(O!==(65535&_.check)){x.msg="header crc mismatch",_.mode=30;break}T=O=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),x.adler=_.check=0,_.mode=12;break;case 10:for(;T<32;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}x.adler=_.check=h(O),T=O=0,_.mode=11;case 11:if(_.havedict===0)return x.next_out=ot,x.avail_out=ft,x.next_in=V,x.avail_in=G,_.hold=O,_.bits=T,2;x.adler=_.check=1,_.mode=12;case 12:if(I===5||I===6)break t;case 13:if(_.last){O>>>=7&T,T-=7&T,_.mode=27;break}for(;T<3;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}switch(_.last=1&O,T-=1,3&(O>>>=1)){case 0:_.mode=14;break;case 1:if(j(_),_.mode=20,I!==6)break;O>>>=2,T-=2;break t;case 2:_.mode=17;break;case 3:x.msg="invalid block type",_.mode=30}O>>>=2,T-=2;break;case 14:for(O>>>=7&T,T-=7&T;T<32;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if((65535&O)!=(O>>>16^65535)){x.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&O,T=O=0,_.mode=15,I===6)break t;case 15:_.mode=16;case 16:if(X=_.length){if(G<X&&(X=G),ft<X&&(X=ft),X===0)break t;i.arraySet(st,W,V,X,ot),G-=X,V+=X,ft-=X,ot+=X,_.length-=X;break}_.mode=12;break;case 17:for(;T<14;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(_.nlen=257+(31&O),O>>>=5,T-=5,_.ndist=1+(31&O),O>>>=5,T-=5,_.ncode=4+(15&O),O>>>=4,T-=4,286<_.nlen||30<_.ndist){x.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;T<3;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}_.lens[Z[_.have++]]=7&O,O>>>=3,T-=3}for(;_.have<19;)_.lens[Z[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,M={bits:_.lenbits},H=c(0,_.lens,0,19,_.lencode,0,_.work,M),_.lenbits=M.bits,H){x.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;yt=(S=_.lencode[O&(1<<_.lenbits)-1])>>>16&255,At=65535&S,!((wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(At<16)O>>>=wt,T-=wt,_.lens[_.have++]=At;else{if(At===16){for(C=wt+2;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(O>>>=wt,T-=wt,_.have===0){x.msg="invalid bit length repeat",_.mode=30;break}g=_.lens[_.have-1],X=3+(3&O),O>>>=2,T-=2}else if(At===17){for(C=wt+3;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}T-=wt,g=0,X=3+(7&(O>>>=wt)),O>>>=3,T-=3}else{for(C=wt+7;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}T-=wt,g=0,X=11+(127&(O>>>=wt)),O>>>=7,T-=7}if(_.have+X>_.nlen+_.ndist){x.msg="invalid bit length repeat",_.mode=30;break}for(;X--;)_.lens[_.have++]=g}}if(_.mode===30)break;if(_.lens[256]===0){x.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,M={bits:_.lenbits},H=c(f,_.lens,0,_.nlen,_.lencode,0,_.work,M),_.lenbits=M.bits,H){x.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,M={bits:_.distbits},H=c(d,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,M),_.distbits=M.bits,H){x.msg="invalid distances set",_.mode=30;break}if(_.mode=20,I===6)break t;case 20:_.mode=21;case 21:if(6<=G&&258<=ft){x.next_out=ot,x.avail_out=ft,x.next_in=V,x.avail_in=G,_.hold=O,_.bits=T,l(x,U),ot=x.next_out,st=x.output,ft=x.avail_out,V=x.next_in,W=x.input,G=x.avail_in,O=_.hold,T=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;yt=(S=_.lencode[O&(1<<_.lenbits)-1])>>>16&255,At=65535&S,!((wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(yt&&!(240&yt)){for(Dt=wt,Qt=yt,Ut=At;yt=(S=_.lencode[Ut+((O&(1<<Dt+Qt)-1)>>Dt)])>>>16&255,At=65535&S,!(Dt+(wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}O>>>=Dt,T-=Dt,_.back+=Dt}if(O>>>=wt,T-=wt,_.back+=wt,_.length=At,yt===0){_.mode=26;break}if(32&yt){_.back=-1,_.mode=12;break}if(64&yt){x.msg="invalid literal/length code",_.mode=30;break}_.extra=15&yt,_.mode=22;case 22:if(_.extra){for(C=_.extra;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}_.length+=O&(1<<_.extra)-1,O>>>=_.extra,T-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;yt=(S=_.distcode[O&(1<<_.distbits)-1])>>>16&255,At=65535&S,!((wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(!(240&yt)){for(Dt=wt,Qt=yt,Ut=At;yt=(S=_.distcode[Ut+((O&(1<<Dt+Qt)-1)>>Dt)])>>>16&255,At=65535&S,!(Dt+(wt=S>>>24)<=T);){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}O>>>=Dt,T-=Dt,_.back+=Dt}if(O>>>=wt,T-=wt,_.back+=wt,64&yt){x.msg="invalid distance code",_.mode=30;break}_.offset=At,_.extra=15&yt,_.mode=24;case 24:if(_.extra){for(C=_.extra;T<C;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}_.offset+=O&(1<<_.extra)-1,O>>>=_.extra,T-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){x.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ft===0)break t;if(X=U-ft,_.offset>X){if((X=_.offset-X)>_.whave&&_.sane){x.msg="invalid distance too far back",_.mode=30;break}Ct=X>_.wnext?(X-=_.wnext,_.wsize-X):_.wnext-X,X>_.length&&(X=_.length),Nt=_.window}else Nt=st,Ct=ot-_.offset,X=_.length;for(ft<X&&(X=ft),ft-=X,_.length-=X;st[ot++]=Nt[Ct++],--X;);_.length===0&&(_.mode=21);break;case 26:if(ft===0)break t;st[ot++]=_.length,ft--,_.mode=21;break;case 27:if(_.wrap){for(;T<32;){if(G===0)break t;G--,O|=W[V++]<<T,T+=8}if(U-=ft,x.total_out+=U,_.total+=U,U&&(x.adler=_.check=_.flags?o(_.check,st,U,ot-U):s(_.check,st,U,ot-U)),U=ft,(_.flags?O:h(O))!==_.check){x.msg="incorrect data check",_.mode=30;break}T=O=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;T<32;){if(G===0)break t;G--,O+=W[V++]<<T,T+=8}if(O!==(4294967295&_.total)){x.msg="incorrect length check",_.mode=30;break}T=O=0}_.mode=29;case 29:H=1;break t;case 30:H=-3;break t;case 31:return-4;case 32:default:return u}return x.next_out=ot,x.avail_out=ft,x.next_in=V,x.avail_in=G,_.hold=O,_.bits=T,(_.wsize||U!==x.avail_out&&_.mode<30&&(_.mode<27||I!==4))&&q(x,x.output,x.next_out,U-x.avail_out)?(_.mode=31,-4):(lt-=x.avail_in,U-=x.avail_out,x.total_in+=lt,x.total_out+=U,_.total+=U,_.wrap&&U&&(x.adler=_.check=_.flags?o(_.check,st,U,x.next_out-U):s(_.check,st,U,x.next_out-U)),x.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(lt==0&&U===0||I===4)&&H===w&&(H=-5),H)},a.inflateEnd=function(x){if(!x||!x.state)return u;var I=x.state;return I.window&&(I.window=null),x.state=null,w},a.inflateGetHeader=function(x,I){var _;return x&&x.state&&2&(_=x.state).wrap?((_.head=I).done=!1,w):u},a.inflateSetDictionary=function(x,I){var _,W=I.length;return x&&x.state?(_=x.state).wrap!==0&&_.mode!==11?u:_.mode===11&&s(1,I,W,0)!==_.check?-3:q(x,I,W,W)?(_.mode=31,-4):(_.havedict=1,w):u},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,a){var i=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,d,w,u,m,p,v,h){var b,y,$,k,D,P,z,N,j,q=h.bits,x=0,I=0,_=0,W=0,st=0,V=0,ot=0,G=0,ft=0,O=0,T=null,lt=0,U=new i.Buf16(16),X=new i.Buf16(16),Ct=null,Nt=0;for(x=0;x<=15;x++)U[x]=0;for(I=0;I<u;I++)U[d[w+I]]++;for(st=q,W=15;1<=W&&U[W]===0;W--);if(W<st&&(st=W),W===0)return m[p++]=20971520,m[p++]=20971520,h.bits=1,0;for(_=1;_<W&&U[_]===0;_++);for(st<_&&(st=_),x=G=1;x<=15;x++)if(G<<=1,(G-=U[x])<0)return-1;if(0<G&&(f===0||W!==1))return-1;for(X[1]=0,x=1;x<15;x++)X[x+1]=X[x]+U[x];for(I=0;I<u;I++)d[w+I]!==0&&(v[X[d[w+I]]++]=I);if(P=f===0?(T=Ct=v,19):f===1?(T=s,lt-=257,Ct=o,Nt-=257,256):(T=l,Ct=c,-1),x=_,D=p,ot=I=O=0,$=-1,k=(ft=1<<(V=st))-1,f===1&&852<ft||f===2&&592<ft)return 1;for(;;){for(z=x-ot,j=v[I]<P?(N=0,v[I]):v[I]>P?(N=Ct[Nt+v[I]],T[lt+v[I]]):(N=96,0),b=1<<x-ot,_=y=1<<V;m[D+(O>>ot)+(y-=b)]=z<<24|N<<16|j|0,y!==0;);for(b=1<<x-1;O&b;)b>>=1;if(b!==0?(O&=b-1,O+=b):O=0,I++,--U[x]==0){if(x===W)break;x=d[w+v[I]]}if(st<x&&(O&k)!==$){for(ot===0&&(ot=st),D+=_,G=1<<(V=x-ot);V+ot<W&&!((G-=U[V+ot])<=0);)V++,G<<=1;if(ft+=1<<V,f===1&&852<ft||f===2&&592<ft)return 1;m[$=O&k]=st<<24|V<<16|D-p|0}}return O!==0&&(m[D+O]=x-ot<<24|64<<16|0),h.bits=st,0}},{"../utils/common":41}],51:[function(e,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,a){var i=e("../utils/common"),s=0,o=1;function l(S){for(var E=S.length;0<=--E;)S[E]=0}var c=0,f=29,d=256,w=d+1+f,u=30,m=19,p=2*w+1,v=15,h=16,b=7,y=256,$=16,k=17,D=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(w+2));l(q);var x=new Array(2*u);l(x);var I=new Array(512);l(I);var _=new Array(256);l(_);var W=new Array(f);l(W);var st,V,ot,G=new Array(u);function ft(S,E,Z,Y,A){this.static_tree=S,this.extra_bits=E,this.extra_base=Z,this.elems=Y,this.max_length=A,this.has_stree=S&&S.length}function O(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function T(S){return S<256?I[S]:I[256+(S>>>7)]}function lt(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function U(S,E,Z){S.bi_valid>h-Z?(S.bi_buf|=E<<S.bi_valid&65535,lt(S,S.bi_buf),S.bi_buf=E>>h-S.bi_valid,S.bi_valid+=Z-h):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=Z)}function X(S,E,Z){U(S,Z[2*E],Z[2*E+1])}function Ct(S,E){for(var Z=0;Z|=1&S,S>>>=1,Z<<=1,0<--E;);return Z>>>1}function Nt(S,E,Z){var Y,A,J=new Array(v+1),at=0;for(Y=1;Y<=v;Y++)J[Y]=at=at+Z[Y-1]<<1;for(A=0;A<=E;A++){var tt=S[2*A+1];tt!==0&&(S[2*A]=Ct(J[tt]++,tt))}}function wt(S){var E;for(E=0;E<w;E++)S.dyn_ltree[2*E]=0;for(E=0;E<u;E++)S.dyn_dtree[2*E]=0;for(E=0;E<m;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*y]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function yt(S){8<S.bi_valid?lt(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function At(S,E,Z,Y){var A=2*E,J=2*Z;return S[A]<S[J]||S[A]===S[J]&&Y[E]<=Y[Z]}function Dt(S,E,Z){for(var Y=S.heap[Z],A=Z<<1;A<=S.heap_len&&(A<S.heap_len&&At(E,S.heap[A+1],S.heap[A],S.depth)&&A++,!At(E,Y,S.heap[A],S.depth));)S.heap[Z]=S.heap[A],Z=A,A<<=1;S.heap[Z]=Y}function Qt(S,E,Z){var Y,A,J,at,tt=0;if(S.last_lit!==0)for(;Y=S.pending_buf[S.d_buf+2*tt]<<8|S.pending_buf[S.d_buf+2*tt+1],A=S.pending_buf[S.l_buf+tt],tt++,Y===0?X(S,A,E):(X(S,(J=_[A])+d+1,E),(at=P[J])!==0&&U(S,A-=W[J],at),X(S,J=T(--Y),Z),(at=z[J])!==0&&U(S,Y-=G[J],at)),tt<S.last_lit;);X(S,y,E)}function Ut(S,E){var Z,Y,A,J=E.dyn_tree,at=E.stat_desc.static_tree,tt=E.stat_desc.has_stree,L=E.stat_desc.elems,nt=-1;for(S.heap_len=0,S.heap_max=p,Z=0;Z<L;Z++)J[2*Z]!==0?(S.heap[++S.heap_len]=nt=Z,S.depth[Z]=0):J[2*Z+1]=0;for(;S.heap_len<2;)J[2*(A=S.heap[++S.heap_len]=nt<2?++nt:0)]=1,S.depth[A]=0,S.opt_len--,tt&&(S.static_len-=at[2*A+1]);for(E.max_code=nt,Z=S.heap_len>>1;1<=Z;Z--)Dt(S,J,Z);for(A=L;Z=S.heap[1],S.heap[1]=S.heap[S.heap_len--],Dt(S,J,1),Y=S.heap[1],S.heap[--S.heap_max]=Z,S.heap[--S.heap_max]=Y,J[2*A]=J[2*Z]+J[2*Y],S.depth[A]=(S.depth[Z]>=S.depth[Y]?S.depth[Z]:S.depth[Y])+1,J[2*Z+1]=J[2*Y+1]=A,S.heap[1]=A++,Dt(S,J,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(it,kt){var Tt,$t,Wt,St,_t,me,te=kt.dyn_tree,Pe=kt.max_code,Ca=kt.stat_desc.static_tree,xa=kt.stat_desc.has_stree,Fa=kt.stat_desc.extra_bits,qn=kt.stat_desc.extra_base,Ze=kt.stat_desc.max_length,an=0;for(St=0;St<=v;St++)it.bl_count[St]=0;for(te[2*it.heap[it.heap_max]+1]=0,Tt=it.heap_max+1;Tt<p;Tt++)Ze<(St=te[2*te[2*($t=it.heap[Tt])+1]+1]+1)&&(St=Ze,an++),te[2*$t+1]=St,Pe<$t||(it.bl_count[St]++,_t=0,qn<=$t&&(_t=Fa[$t-qn]),me=te[2*$t],it.opt_len+=me*(St+_t),xa&&(it.static_len+=me*(Ca[2*$t+1]+_t)));if(an!==0){do{for(St=Ze-1;it.bl_count[St]===0;)St--;it.bl_count[St]--,it.bl_count[St+1]+=2,it.bl_count[Ze]--,an-=2}while(0<an);for(St=Ze;St!==0;St--)for($t=it.bl_count[St];$t!==0;)Pe<(Wt=it.heap[--Tt])||(te[2*Wt+1]!==St&&(it.opt_len+=(St-te[2*Wt+1])*te[2*Wt],te[2*Wt+1]=St),$t--)}}(S,E),Nt(J,nt,S.bl_count)}function g(S,E,Z){var Y,A,J=-1,at=E[1],tt=0,L=7,nt=4;for(at===0&&(L=138,nt=3),E[2*(Z+1)+1]=65535,Y=0;Y<=Z;Y++)A=at,at=E[2*(Y+1)+1],++tt<L&&A===at||(tt<nt?S.bl_tree[2*A]+=tt:A!==0?(A!==J&&S.bl_tree[2*A]++,S.bl_tree[2*$]++):tt<=10?S.bl_tree[2*k]++:S.bl_tree[2*D]++,J=A,nt=(tt=0)===at?(L=138,3):A===at?(L=6,3):(L=7,4))}function H(S,E,Z){var Y,A,J=-1,at=E[1],tt=0,L=7,nt=4;for(at===0&&(L=138,nt=3),Y=0;Y<=Z;Y++)if(A=at,at=E[2*(Y+1)+1],!(++tt<L&&A===at)){if(tt<nt)for(;X(S,A,S.bl_tree),--tt!=0;);else A!==0?(A!==J&&(X(S,A,S.bl_tree),tt--),X(S,$,S.bl_tree),U(S,tt-3,2)):tt<=10?(X(S,k,S.bl_tree),U(S,tt-3,3)):(X(S,D,S.bl_tree),U(S,tt-11,7));J=A,nt=(tt=0)===at?(L=138,3):A===at?(L=6,3):(L=7,4)}}l(G);var M=!1;function C(S,E,Z,Y){U(S,(c<<1)+(Y?1:0),3),function(A,J,at,tt){yt(A),lt(A,at),lt(A,~at),i.arraySet(A.pending_buf,A.window,J,at,A.pending),A.pending+=at}(S,E,Z)}a._tr_init=function(S){M||(function(){var E,Z,Y,A,J,at=new Array(v+1);for(A=Y=0;A<f-1;A++)for(W[A]=Y,E=0;E<1<<P[A];E++)_[Y++]=A;for(_[Y-1]=A,A=J=0;A<16;A++)for(G[A]=J,E=0;E<1<<z[A];E++)I[J++]=A;for(J>>=7;A<u;A++)for(G[A]=J<<7,E=0;E<1<<z[A]-7;E++)I[256+J++]=A;for(Z=0;Z<=v;Z++)at[Z]=0;for(E=0;E<=143;)q[2*E+1]=8,E++,at[8]++;for(;E<=255;)q[2*E+1]=9,E++,at[9]++;for(;E<=279;)q[2*E+1]=7,E++,at[7]++;for(;E<=287;)q[2*E+1]=8,E++,at[8]++;for(Nt(q,w+1,at),E=0;E<u;E++)x[2*E+1]=5,x[2*E]=Ct(E,5);st=new ft(q,P,d+1,w,v),V=new ft(x,z,0,u,v),ot=new ft(new Array(0),N,0,m,b)}(),M=!0),S.l_desc=new O(S.dyn_ltree,st),S.d_desc=new O(S.dyn_dtree,V),S.bl_desc=new O(S.bl_tree,ot),S.bi_buf=0,S.bi_valid=0,wt(S)},a._tr_stored_block=C,a._tr_flush_block=function(S,E,Z,Y){var A,J,at=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(tt){var L,nt=4093624447;for(L=0;L<=31;L++,nt>>>=1)if(1&nt&&tt.dyn_ltree[2*L]!==0)return s;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return o;for(L=32;L<d;L++)if(tt.dyn_ltree[2*L]!==0)return o;return s}(S)),Ut(S,S.l_desc),Ut(S,S.d_desc),at=function(tt){var L;for(g(tt,tt.dyn_ltree,tt.l_desc.max_code),g(tt,tt.dyn_dtree,tt.d_desc.max_code),Ut(tt,tt.bl_desc),L=m-1;3<=L&&tt.bl_tree[2*j[L]+1]===0;L--);return tt.opt_len+=3*(L+1)+5+5+4,L}(S),A=S.opt_len+3+7>>>3,(J=S.static_len+3+7>>>3)<=A&&(A=J)):A=J=Z+5,Z+4<=A&&E!==-1?C(S,E,Z,Y):S.strategy===4||J===A?(U(S,2+(Y?1:0),3),Qt(S,q,x)):(U(S,4+(Y?1:0),3),function(tt,L,nt,it){var kt;for(U(tt,L-257,5),U(tt,nt-1,5),U(tt,it-4,4),kt=0;kt<it;kt++)U(tt,tt.bl_tree[2*j[kt]+1],3);H(tt,tt.dyn_ltree,L-1),H(tt,tt.dyn_dtree,nt-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,at+1),Qt(S,S.dyn_ltree,S.dyn_dtree)),wt(S),Y&&yt(S)},a._tr_tally=function(S,E,Z){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&Z,S.last_lit++,E===0?S.dyn_ltree[2*Z]++:(S.matches++,E--,S.dyn_ltree[2*(_[Z]+d+1)]++,S.dyn_dtree[2*T(E)]++),S.last_lit===S.lit_bufsize-1},a._tr_align=function(S){U(S,2,3),X(S,y,q),function(E){E.bi_valid===16?(lt(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(e,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,a){(function(i){(function(s,o){if(!s.setImmediate){var l,c,f,d,w=1,u={},m=!1,p=s.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(s);v=v&&v.setTimeout?v:s,l={}.toString.call(s.process)==="[object process]"?function($){process.nextTick(function(){b($)})}:function(){if(s.postMessage&&!s.importScripts){var $=!0,k=s.onmessage;return s.onmessage=function(){$=!1},s.postMessage("","*"),s.onmessage=k,$}}()?(d="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",y,!1):s.attachEvent("onmessage",y),function($){s.postMessage(d+$,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function($){b($.data)},function($){f.port2.postMessage($)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function($){var k=p.createElement("script");k.onreadystatechange=function(){b($),k.onreadystatechange=null,c.removeChild(k),k=null},c.appendChild(k)}):function($){setTimeout(b,0,$)},v.setImmediate=function($){typeof $!="function"&&($=new Function(""+$));for(var k=new Array(arguments.length-1),D=0;D<k.length;D++)k[D]=arguments[D+1];var P={callback:$,args:k};return u[w]=P,l(w),w++},v.clearImmediate=h}function h($){delete u[$]}function b($){if(m)setTimeout(b,0,$);else{var k=u[$];if(k){m=!0;try{(function(D){var P=D.callback,z=D.args;switch(z.length){case 0:P();break;case 1:P(z[0]);break;case 2:P(z[0],z[1]);break;case 3:P(z[0],z[1],z[2]);break;default:P.apply(o,z)}})(k)}finally{h($),m=!1}}}}function y($){$.source===s&&typeof $.data=="string"&&$.data.indexOf(d)===0&&b(+$.data.slice(d.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ur);var Ja=Ur.exports;const Qn=Xa(Ja);class Qa{constructor(t,e){this.app=t,this.settings=e}get maxBackups(){var t;return((t=this.settings)==null?void 0:t.maxBackups)??5}get maxBackupAgeDays(){var t;return((t=this.settings)==null?void 0:t.maxBackupAgeDays)??30}async createBackup(t,e,n){try{const a=this.app.vault.getAbstractFileByPath(t);if(!a||!(a instanceof F.TFolder))return R(`${B} Draft folder not found: ${t}`),!1;const i=this.getAllFilesInFolder(a);if(i.length===0)return R(`${B} No files to backup in: ${t}`),!1;const s=t.split("/")[0]||"unknown",o=t.split("/")[1]||"drafts",l=`${je(n)}/${s}/${o}/${e}`;await this.app.vault.adapter.exists(l)||await this.app.vault.createFolder(l);const d=`${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}${Ke}`,w=`${l}/${d}`,u=new Qn;for(const v of i){const h=v.path.substring(t.length+1),b=await this.app.vault.read(v);u.file(h,b)}const m=await u.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}),p=new Uint8Array(m).buffer;return await this.app.vault.createBinary(w,p),R(`${B} Created backup: ${w}`),!0}catch(a){return R(`${B} Failed to create backup:`,a),!1}}async listBackups(t,e,n){try{const a=t.split("/")[0]||"unknown",i=t.split("/")[1]||"drafts",s=`${je(n)}/${a}/${i}/${e}`,o=this.app.vault.getAbstractFileByPath(s);if(!o||!(o instanceof F.TFolder))return[];const l=[];for(const c of o.children)if(c instanceof F.TFile&&c.name.endsWith(Ke)){const f=c.name.match(Ir);f&&l.push(f[1])}return l.sort().reverse()}catch(a){return R(`${B} Failed to list backups:`,a),[]}}async restoreBackup(t,e,n,a){try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${je(a)}/${i}/${s}/${e}`,l=`${n}${Ke}`,c=`${o}/${l}`;if(!await this.app.vault.adapter.stat(c))return R(`${B} Backup file not found: ${c}`),!1;const d=await this.app.vault.adapter.readBinary(c),w=await Qn.loadAsync(d);this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);for(const[m,p]of Object.entries(w.files))if(p.dir){const v=`${t}/${m}`;this.app.vault.getAbstractFileByPath(v)||await this.app.vault.createFolder(v)}else{const v=await p.async("text"),h=`${t}/${m}`,b=h.substring(0,h.lastIndexOf("/"));this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b);const y=this.app.vault.getAbstractFileByPath(h);y&&y instanceof F.TFile?await this.app.vault.modify(y,v):await this.app.vault.create(h,v)}return R(`${B} Restored backup: ${c}`),!0}catch(i){return R(`${B} Failed to restore backup:`,i),!1}}async deleteBackup(t,e,n,a){try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${je(a)}/${i}/${s}/${e}`,l=`${n}${Ke}`,c=`${o}/${l}`;return await this.app.vault.adapter.stat(c)?(await this.app.vault.adapter.remove(c),R(`${B} Deleted backup: ${c}`),!0):(R(`${B} Backup file not found for deletion: ${c}`),!1)}catch(i){return R(`${B} Failed to delete backup:`,i),!1}}async clearOldBackups(t,e,n){try{const a=await this.listBackups(t,e,n),i=new Date;i.setDate(i.getDate()-this.maxBackupAgeDays);for(const s of a)new Date(s.replace(/-/g,":"))<i&&await this.deleteBackup(t,e,s,n)}catch(a){R(`${B} Failed to clear old backups:`,a)}}getAllFilesInFolder(t){const e=[];function n(a){for(const i of a.children)i instanceof F.TFile?e.push(i):i instanceof F.TFolder&&n(i)}return n(t),e}}class ti{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null}async reorderChapters(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;for(let o=0;o<n.length;o++){const{chapterName:l}=n[o],c=`${s}/${l}${bt}`,f=this.app.vault.getAbstractFileByPath(c);if(f&&f instanceof F.TFile){let d=await this.app.vault.read(f);d.match(Rt)&&(d=d.replace(Rt,(w,u)=>{let m=u.replace(/^order:.*\n?/gm,"");return m.endsWith(`
`)||(m+=`
`),m+=`order: ${o+1}
`,`${xt}
${m}${xt}`}),await this.app.vault.modify(f,d))}}return!0}async listChapters(t,e){R(`${B} ChapterFileService.listChapters: projectPath=${t}, draftName=${e}`);const n=this.resolveProjectPath(t);if(!n)return R(`${B} ChapterFileService.listChapters: no project resolved`),[];const a=this.getDraftsFolderName(n);if(!a)return R(`${B} ChapterFileService.listChapters: no drafts folder found in project ${n}`),[];const i=`${n}/${a}/${e}`;R(`${B} ChapterFileService.listChapters: resolved project=${n}, draftsFolder=${a}, draftFolder=${i}`);const s=this.app.vault.getAbstractFileByPath(i),o=[];if(s&&s instanceof F.TFolder){R(`${B} ChapterFileService.listChapters: found folder with ${s.children.length} children`);for(const l of s.children)l instanceof F.TFile&&l.extension===bt.slice(1)&&(R(`${B} ChapterFileService.listChapters: processing file ${l.path}`),await Ot(async()=>{const c=await this.app.vault.read(l);R(`${B} ChapterFileService.listChapters: content length ${c.length}`);const f=c.match(Rt);let d,w;if(f){R(`${B} ChapterFileService.listChapters: found frontmatter`);const p=f[1].split(/\r?\n/);for(const v of p){const h=v.match(/^order:\s*(\d+)/i);h&&(d=parseInt(h[1],10));const b=v.match(/^chapter_name:\s*(.*)$/i);if(b){let y=b[1].trim();(y.startsWith('"')&&y.endsWith('"')||y.startsWith("'")&&y.endsWith("'"))&&(y=y.slice(1,-1)),y.length>0&&(w=y)}}}else R(`${B} ChapterFileService.listChapters: no frontmatter`);R(`${B} ChapterFileService.listChapters: parsed order=${d}, chapterName=${w}`);const u=w&&w.length>0?w:l.name.replace(new RegExp(`\\${bt}$`),""),m=typeof d=="number"&&!isNaN(d)?d:0;R(`${B} ChapterFileService.listChapters: adding chapter ${l.name} with name ${u}, order ${m}`),o.push({name:l.name.replace(new RegExp(`\\${bt}$`),""),chapterName:u,order:m})}))}else R(`${B} ChapterFileService.listChapters: no folder found`);return o.sort((l,c)=>l.order-c.order),R(`${B} ChapterFileService.listChapters: returning ${o.length} chapters`),o.map(({name:l,chapterName:c})=>({name:l,chapterName:c}))}async createChapter(t,e,n,a){const i=this.resolveProjectPath(t);if(!i)return!1;const s=this.getDraftsFolderName(i);if(!s)return!1;const o=`${i}/${s}/${e}`,c=`${ae(n,a==null?void 0:a.slugStyle)}${bt}`,f=`${o}/${c}`;if(this.app.vault.getAbstractFileByPath(f))return!1;let d=0;const w=this.app.vault.getAbstractFileByPath(o);if(w&&w instanceof F.TFolder)for(const v of w.children)v instanceof F.TFile&&v.extension===bt.slice(1)&&await Ot(async()=>{const b=(await this.app.vault.read(v)).match(Rt);if(b){const y=b[1].split(/\r?\n/);for(const $ of y){const k=$.match(/^order:\s*(\d+)/i);if(k){const D=parseInt(k[1],10);!isNaN(D)&&D>d&&(d=D)}}}});const u=d+1;let m=`# ${n}`;const p=`${xt}
order: ${u}
chapter_name: ${JSON.stringify(n)}
${xt}
`;return await this.app.vault.create(f,`${p}
${m}

`),!0}async deleteChapter(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`,o=`${n}${bt}`,l=`${s}/${o}`,c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof F.TFile){await this.app.vault.delete(c);const f=await this.listChapters(t,e);for(let d=0;d<f.length;d++){const{name:w}=f[d],u=`${s}/${w}${bt}`,m=this.app.vault.getAbstractFileByPath(u);if(m&&m instanceof F.TFile){let p=await this.app.vault.read(m);p.match(Rt)&&(p=p.replace(Rt,(v,h)=>{let b=h.replace(/^order:.*\n?/gm,"");return b.endsWith(`
`)||(b+=`
`),b+=`order: ${d+1}
`,`${xt}
${b}${xt}`}),await this.app.vault.modify(m,p))}}return!0}return!1}async renameChapter(t,e,n,a){const i=this.resolveProjectPath(t);if(!i)return!1;const s=this.getDraftsFolderName(i);if(!s)return!1;const o=`${i}/${s}/${e}`,l=`${o}/${n}${bt}`,c=`${o}/${a}${bt}`,f=this.app.vault.getAbstractFileByPath(l);if(!f||!(f instanceof F.TFile))return!1;let d=await this.app.vault.read(f),w=`# ${a}`;return d.match(Rt)&&(d=d.replace(Rt,(u,m)=>{let p=m.replace(/^chapter_name:.*\n?/gm,"");return p.endsWith(`
`)||(p+=`
`),p+=`chapter_name: ${JSON.stringify(a)}
`,`${xt}
${p}${xt}`})),d=d.replace(/^#.*$/m,w),n!==a?(await this.app.vault.create(c,d),await this.app.vault.delete(f)):await this.app.vault.modify(f,d),!0}async openChapter(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}/${n}${bt}`,o=this.app.vault.getAbstractFileByPath(s);return o&&o instanceof F.TFile?(await Ot(async()=>{await this.app.workspace.getLeaf().openFile(o)}),!0):!1}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=jt((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof F.TFolder){for(const i of e.children)if(i instanceof F.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}}class Wr{constructor(t){this.app=t,R(`${B} TemplateService created`)}async render(t,e={}){let n=t||"";return R(`${B} TemplateService.render called with template: "${n.substring(0,100)}${n.length>100?"...":""}", vars:`,Object.keys(e)),!n.includes("{{")&&!n.includes("}}")?(R(`${B} Template doesn't contain template syntax, checking if it's a file path`),await Ot(async()=>{const a=this.app.vault.getAbstractFileByPath(n);a&&a instanceof F.TFile?(R(`${B} Reading template from file: ${n}`),n=await this.app.vault.read(a),R(`${B} Template loaded from file, length: ${n.length} chars`)):R(`${B} Template path "${n}" is not a valid file, treating as inline template`)})):R(`${B} Template contains template syntax, treating as inline template`),R(`${B} Performing template variable substitution`),n=n.replace(/{{\s*(\w+(?:[-:]\w+)*)\s*}}/g,(a,i)=>{if(e[i]!==void 0)return R(`${B} Substituting variable {{${i}}} with provided value: "${e[i]}"`),e[i];try{const s=window.moment().format(i);return R(`${B} Substituting {{${i}}} with moment.js format: "${s}"`),s}catch{return R(`${B} Neither variable nor moment.js format found for {{${i}}}, returning as-is`),i}}),R(`${B} Template rendering complete, result length: ${n.length} chars`),n}}class un{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null,this.tpl=new Wr(t),this.projectFileService=new Wn(t,this)}async createProject(t,e,n,a,i){if(!t)return new F.Notice("Project name is required."),null;const s=a&&a!==""?`${a}/${t}`:t,o=`${s}/${jt(i)}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);const l=`${s}/${ie(i)}`;if(!this.app.vault.getAbstractFileByPath(l)){const f=e?Vt.SINGLE:Vt.MULTI,d=e?(i==null?void 0:i.defaultSingleTargetWordCount)??2e4:(i==null?void 0:i.defaultMultiTargetWordCount)??5e4,w=`${xt}
project_type: ${f}
target_word_count: ${d}
${xt}
`;await this.app.vault.create(l,w)}const c=n||"Draft 1";return await this.projectFileService.drafts.createDraft(c,void 0,s,i),s}async openProject(t){var s,o;const e=`${t}/${ie((s=this.manager)==null?void 0:s.settings)}`,n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof F.TFile)return await this.app.workspace.getLeaf().openFile(n),!0;const a=Te((o=this.manager)==null?void 0:o.settings),i=[`${t}/${t}${bt}`,`${t}/Chapter 1${bt}`,`${t}/Chapter 01${bt}`,`${t}/${a}`,`${t}/${jt()}/Draft 1/${a}`];for(const l of i){const c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof F.TFile)return await this.app.workspace.getLeaf().openFile(c),!0}return new F.Notice("Could not find a file to open in the project."),!1}listAllFolders(){const t=this.app.vault.getRoot(),e=[""];function n(a){for(const i of a.children)i instanceof F.TFolder&&(e.push(i.path),n(i))}return n(t),e}async listProjects(){const t=this.listAllFolders(),e=t.filter(a=>!!a);R(`${B} allFolders:`,t),R(`${B} filteredFolders:`,e);const n=await Be(e,a=>this.isProjectFolder(a));return R(`${B} found ${e.length} folders, ${n.length} projects:`,n),n}async getProjectType(t){const e=`${t}/${ie()}`,n=await De(this.app,e);if(n&&n.project_type){const a=n.project_type;if(Object.values(Vt).includes(a))return a}return null}getDraftsFolder(t){const e=`${t}/${jt()}`;let n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof F.TFolder)return n;const a=`${t}/Drafts`;return n=this.app.vault.getAbstractFileByPath(a),n&&n instanceof F.TFolder?n:null}async getManuscriptsFolder(t){const e=`${t}/${Mn()}`,n=this.app.vault.getAbstractFileByPath(e);return n&&n instanceof F.TFolder?n:null}async isProjectFolder(t){if(!t||typeof t!="string")return!1;const e=t.trim().replace(/\\/g,"/").replace(/\/+$/,"");try{const n=F.normalizePath(`${e}/${ie()}`),a=await this.app.vault.adapter.exists(n),i=F.normalizePath(`${e}/${jt()}`);let s=await this.app.vault.adapter.exists(i);if(!s){const o=F.normalizePath(`${e}/Drafts`);s=await this.app.vault.adapter.exists(o)}if(!a&&!s)return!1;if(a)try{const{readMetaFile:o}=await Promise.resolve().then(()=>Tn),{VALID_PROJECT_TYPES:l}=await Promise.resolve().then(()=>Na),c=await o(this.app,n);if(!c||!l.includes(c.project_type))return!1}catch{return!1}return!0}catch{return!1}}}class ei{constructor(t,e,n,a){var i,s,o;this.app=t,this.tpl=new Wr(t),this.projectSvc=n,this.backupSvc=a,this.chapters=e,this.manager=((o=(s=(i=this.app.plugins).getPlugin)==null?void 0:s.call(i,"obsidian-writeaid-plugin"))==null?void 0:o.manager)??null}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=jt((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof F.TFolder){for(const i of e.children)if(i instanceof F.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}async suggestNextDraftName(t){var i;const e=this.resolveProjectPath(t);if(!e)return"Draft 1";const n=`${e}/${ie((i=this.manager)==null?void 0:i.settings)}`;let a=0;return await Ot(async()=>{const s=await De(this.app,n);s&&typeof s.total_drafts=="number"&&(a=s.total_drafts)}),`Draft ${a+1}`}async createDraft(t,e,n,a){var d,w,u;const i=this.resolveProjectPath(n);if(!i){new F.Notice("No project folder detected. Please open a folder named after your project.");return}const o=this.getDraftsFolderName(i)||jt((d=this.manager)==null?void 0:d.settings),l=`${i}/${o}`,c=`${l}/${t}`,f=i.split("/").pop()||i;if(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),e){const m=`${l}/${e}`,p=this.app.vault.getFiles().filter(b=>b.path.startsWith(m)),h=`${ae(e,a==null?void 0:a.slugStyle)}${bt}`;for(const b of p){let y=b.path.substring(m.length+1);y===h&&(y=`${ae(t,a==null?void 0:a.slugStyle)}${bt}`);const $=`${c}/${y}`,k=$.substring(0,$.lastIndexOf("/"));k!==c&&!this.app.vault.getAbstractFileByPath(k)&&await this.app.vault.createFolder(k);let D=await this.app.vault.read(b);D=ai(D,t,f),await this.app.vault.create($,D)}}else{if((a==null?void 0:a.includeDraftOutline)===!0){const v=(a==null?void 0:a.outlineTemplate)??"",h=await this.tpl.render(v,{draftName:t});await this.app.vault.create(`${c}/${Te((w=this.manager)==null?void 0:w.settings)}`,h)}if(await this.projectSvc.getProjectType(i)===Vt.SINGLE){const h=`${ae(t,a==null?void 0:a.slugStyle)}${bt}`,b=`${c}/${h}`;if(!this.app.vault.getAbstractFileByPath(b)){const y=Je(),$=`${xt}
draft: ${t}
id: ${y}
project: ${f}
created: ${new Date().toISOString()}
${xt}

`,k=await this.tpl.render("# {{draftName}}",{draftName:t});await this.app.vault.create(b,$+k)}}else{const v=this.app.vault.getAbstractFileByPath(c);let h=!1;if(v&&v instanceof F.TFolder){for(const b of v.children)if(b instanceof F.TFile&&b.extension===bt.slice(1)&&(await Ot(async()=>{const $=(await this.app.vault.read(b)).match(Rt);if($){const k=$[1].split(/\r?\n/);for(const D of k){const P=D.match(/^order:\s*(\d+)/i);if(P&&!isNaN(parseInt(P[1],10))){h=!0;break}}}}),h))break}h||await this.chapters.createChapter(i,t,"Chapter 1",a)}}await Oe(this.app,i,t,void 0,(u=this.manager)==null?void 0:u.settings)}listDrafts(t){var a;const e=this.resolveProjectPath(t);if(R(`${B} listDrafts called with projectPath:`,t,"resolved to:",e),!e)return[];const n=this.projectSvc.getDraftsFolder(e);if(R(`${B} getDraftsFolder for ${e} returned:`,n==null?void 0:n.path,(a=n==null?void 0:n.children)==null?void 0:a.length),n&&n instanceof F.TFolder){const i=n.children.filter(s=>s instanceof F.TFolder).map(s=>s.name);return R(`${B} found drafts:`,i),i}return[]}async getDraftId(t){try{const e=this.app.vault.getFiles().filter(n=>n.path.startsWith(t));for(const n of e)if(n.extension===bt.slice(1)){const i=(await this.app.vault.read(n)).match(Rt);if(i){const o=i[1].match(/^id:\s*(.+?)$/m);if(o)return o[1].trim()}}return null}catch{return null}}async openDraft(t,e){var f;const n=this.resolveProjectPath(t);if(!n)return!1;const a=this.getDraftsFolderName(n);if(!a)return!1;const i=`${n}/${a}/${e}/${Te((f=this.manager)==null?void 0:f.settings)}`,s=this.app.vault.getAbstractFileByPath(i);if(await Ot(async()=>s&&s instanceof F.TFile?(await this.app.workspace.getLeaf().openFile(s),!0):!1))return!0;const l=`${n}/${a}/${e}`,c=this.app.vault.getFiles().filter(d=>d.path.startsWith(l));return c.length>0?(await this.app.workspace.getLeaf().openFile(c[0]),!0):!1}async renameDraft(t,e,n,a=!1,i){var f;const s=this.resolveProjectPath(t);if(!s)return!1;const o=this.getDraftsFolderName(s);if(!o)return!1;const l=`${s}/${o}/${e}`,c=`${s}/${o}/${n}`;try{this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c);const d=this.app.vault.getFiles().filter(h=>h.path.startsWith(l));let w="";if(a){const h=i==null?void 0:i.slugStyle;w=ae(n,h)}let u=null;for(const h of d){const b=h.path.substring(l.length+1);if(h.extension===bt.slice(1)&&!b.includes("/")){u=h;break}}for(const h of d){let b=h.path.substring(l.length+1),y=`${c}/${b}`;a&&w&&h===u&&!b.includes("/")&&(b=`${w}${bt}`,y=`${c}/${b}`);let $=await this.app.vault.read(h);h.extension===bt.slice(1)&&($=$.replace(new RegExp(`^(${xt}\\s*\\n[\\s\\S]*?\\n)(draft:.*\\n)?`,"m"),(k,D)=>D.replace(/^draft:.*\n/m,"").replace(new RegExp(`^(${xt}\\s*\\n)`),`$1draft: ${n}
`))),await this.app.vault.create(y,$),await this.app.vault.delete(h)}const m=this.app.vault.getAbstractFileByPath(l);m&&m instanceof F.TFolder&&await this.app.vault.delete(m,!0),await Ot(async()=>{await Promise.resolve().then(()=>Tn).then(h=>{var b;return h.updateMetaStats(this.app,s,n,void 0,(b=this.manager)==null?void 0:b.settings)})});const p=`${c}/${ie((f=this.manager)==null?void 0:f.settings)}`;return this.app.vault.getAbstractFileByPath(p)&&await Ot(async()=>{const{readMetaFile:h,writeMetaFile:b}=await Promise.resolve().then(()=>Tn),y=await h(this.app,p);y&&(y.draft=n,await b(this.app,p,y))}),!0}catch{return!1}}async deleteDraft(t,e,n=!0){var o;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;try{const l=this.app.vault.getFiles().filter(f=>f.path.startsWith(s));if(n){const f=await this.getDraftId(s);f&&await this.backupSvc.createBackup(s,f,(o=this.manager)==null?void 0:o.settings)}for(const f of l)await Ot(async()=>{await this.app.vault.delete(f)});const c=this.app.vault.getAbstractFileByPath(s);return c&&c instanceof F.TFolder&&await Ot(async()=>{await this.app.vault.delete(c)}),!0}catch{return!1}}async generateManuscript(t,e,n){var p;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=await this.projectSvc.getProjectType(a),o=`${a}/${i}/${e}`;if(!this.app.vault.getAbstractFileByPath(o))return new F.Notice(`Draft folder ${o} does not exist.`),!1;const l=`${a}/${Mn((p=this.manager)==null?void 0:p.settings)}`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);const c=a.split("/").pop()||a,f=(n==null?void 0:n.manuscriptNameTemplate)||"{{draftName}}";R(`${B} DraftFileService.generateManuscript - manuscriptNameTemplate: "${f}"`),R(`${B} DraftFileService.generateManuscript - settings object:`,n);const d=ae(e,n==null?void 0:n.slugStyle),w=await this.tpl.render(f,{draftName:e,projectName:c,draftSlug:d}),u=`${l}/${w}${bt}`;let m=`# Manuscript for ${e}

`;if(s===Vt.SINGLE){const v=`${d}${bt}`,h=`${o}/${v}`,b=this.app.vault.getAbstractFileByPath(h);if(b&&b instanceof F.TFile){const y=await this.app.vault.read(b);m+=ri(ni(y));const $=this.app.vault.getAbstractFileByPath(u);if($&&$ instanceof F.TFile){if(!await new Mr(this.app,u).open())return!1;R(`${B} Overwriting existing manuscript: ${u}`),await this.app.vault.modify($,m)}else R(`${B} Creating new manuscript: ${u}`),await this.app.vault.create(u,m)}else return new F.Notice(`Main draft file ${h} not found.`),!1}return!0}getOutlineFile(t,e){var o;const n=this.resolveProjectPath(t);if(!n)return null;const a=this.getDraftsFolderName(n);if(!a)return null;const i=`${n}/${a}/${e}/${Te((o=this.manager)==null?void 0:o.settings)}`,s=this.app.vault.getAbstractFileByPath(i);return s&&s instanceof F.TFile?s:null}async createOutline(t,e,n){var f;const a=this.resolveProjectPath(t);if(!a)throw new Error("Project not found");const i=this.getDraftsFolderName(a);if(!i)throw new Error("Drafts folder not found");const o=`${`${a}/${i}/${e}`}/${Te((f=this.manager)==null?void 0:f.settings)}`;if(this.app.vault.getAbstractFileByPath(o))throw new Error("Outline file already exists");const c=await this.tpl.render(n,{draftName:e});await this.app.vault.create(o,c)}}function ni(r){return r.replace(Rt,"").trim()}function ri(r){return r.replace(/^#{1,6} .*\n/,"").trim()}function ai(r,t,e){const n=r.match(Rt);if(!n)return r;const a=n[1],i=r.substring(n[0].length),s=a.split(`
`),o=[];let l=!1;for(const f of s)f.match(/^draft:/i)?o.push(`draft: ${t}`):f.match(/^id:/i)?(o.push(`id: ${Je()}`),l=!0):f.match(/^project:/i)?o.push(`project: ${e}`):f.match(/^created:/i)?o.push(`created: ${new Date().toISOString()}`):o.push(f);l||o.push(`id: ${Je()}`);const c=o.join(`
`);return`${xt}
${c}
${xt}${i}`}class Wn{constructor(t,e,n){this.chapters=new ti(t),this.backups=new Qa(t,n),this.drafts=new ei(t,this.chapters,e,this.backups)}}function Et(){}const ii=r=>r;function vt(r,t){for(const e in t)r[e]=t[e];return r}function Hr(r){return r()}function tr(){return Object.create(null)}function $e(r){r.forEach(Hr)}function tn(r){return typeof r=="function"}function Bt(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function si(r){return Object.keys(r).length===0}function Kt(r,t,e,n){if(r){const a=Vr(r,t,e,n);return r[0](a)}}function Vr(r,t,e,n){return r[1]&&n?vt(e.ctx.slice(),r[1](n(t))):e.ctx}function qt(r,t,e,n){return r[2],t.dirty}function Xt(r,t,e,n,a,i){if(a){const s=Vr(t,e,n,i);r.p(s,a)}}function Jt(r){if(r.ctx.length>32){const t=[],e=r.ctx.length/32;for(let n=0;n<e;n++)t[n]=-1;return t}return-1}function Pt(r){const t={};for(const e in r)e[0]!=="$"&&(t[e]=r[e]);return t}function er(r,t){const e={};t=new Set(t);for(const n in r)!t.has(n)&&n[0]!=="$"&&(e[n]=r[n]);return e}function on(r){return r??""}const Zr=typeof window<"u";let oi=Zr?()=>window.performance.now():()=>Date.now(),Hn=Zr?r=>requestAnimationFrame(r):Et;const Re=new Set;function Gr(r){Re.forEach(t=>{t.c(r)||(Re.delete(t),t.f())}),Re.size!==0&&Hn(Gr)}function li(r){let t;return Re.size===0&&Hn(Gr),{promise:new Promise(e=>{Re.add(t={c:r,f:e})}),abort(){Re.delete(t)}}}function rt(r,t){r.appendChild(t)}function Yr(r){if(!r)return document;const t=r.getRootNode?r.getRootNode():r.ownerDocument;return t&&t.host?t:r.ownerDocument}function ci(r){const t=ct("style");return t.textContent="/* empty */",fi(Yr(r),t),t.sheet}function fi(r,t){return rt(r.head||r,t),t.sheet}function gt(r,t,e){r.insertBefore(t,e||null)}function pt(r){r.parentNode&&r.parentNode.removeChild(r)}function Kr(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function ct(r){return document.createElement(r)}function qr(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function It(r){return document.createTextNode(r)}function mt(){return It(" ")}function vn(){return It("")}function fe(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function et(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function dn(r,t){for(const e in t)et(r,e,t[e])}function ui(r){return Array.from(r.childNodes)}function He(r,t){t=""+t,r.data!==t&&(r.data=t)}function hn(r,t){r.value=t??""}function ve(r,t,e,n){e==null?r.style.removeProperty(t):r.style.setProperty(t,e,"")}function ee(r,t,e){r.classList.toggle(t,!!e)}function di(r,t,{bubbles:e=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:t,bubbles:e,cancelable:n})}const pn=new Map;let mn=0;function hi(r){let t=5381,e=r.length;for(;e--;)t=(t<<5)-t^r.charCodeAt(e);return t>>>0}function pi(r,t){const e={stylesheet:ci(t),rules:{}};return pn.set(r,e),e}function mi(r,t,e,n,a,i,s,o=0){const l=16.666/n;let c=`{
`;for(let v=0;v<=1;v+=l){const h=t+(e-t)*i(v);c+=v*100+`%{${s(h,1-h)}}
`}const f=c+`100% {${s(e,1-e)}}
}`,d=`__svelte_${hi(f)}_${o}`,w=Yr(r),{stylesheet:u,rules:m}=pn.get(w)||pi(w,r);m[d]||(m[d]=!0,u.insertRule(`@keyframes ${d} ${f}`,u.cssRules.length));const p=r.style.animation||"";return r.style.animation=`${p?`${p}, `:""}${d} ${n}ms linear ${a}ms 1 both`,mn+=1,d}function gi(r,t){const e=(r.style.animation||"").split(", "),n=e.filter(t?i=>i.indexOf(t)<0:i=>i.indexOf("__svelte")===-1),a=e.length-n.length;a&&(r.style.animation=n.join(", "),mn-=a,mn||wi())}function wi(){Hn(()=>{mn||(pn.forEach(r=>{const{ownerNode:t}=r.stylesheet;t&&pt(t)}),pn.clear())})}function bi(r,t,e,n){if(!t)return Et;const a=r.getBoundingClientRect();if(t.left===a.left&&t.right===a.right&&t.top===a.top&&t.bottom===a.bottom)return Et;const{delay:i=0,duration:s=300,easing:o=ii,start:l=oi()+i,end:c=l+s,tick:f=Et,css:d}=e(r,{from:t,to:a},n);let w=!0,u=!1,m;function p(){d&&(m=mi(r,0,1,s,i,o,d)),i||(u=!0)}function v(){d&&gi(r,m),w=!1}return li(h=>{if(!u&&h>=l&&(u=!0),u&&h>=c&&(f(1,0),v()),!w)return!1;if(u){const b=h-l,y=0+1*o(b/s);f(y,1-y)}return!0}),p(),f(0,1),v}function vi(r){const t=getComputedStyle(r);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:e,height:n}=t,a=r.getBoundingClientRect();r.style.position="absolute",r.style.width=e,r.style.height=n,_i(r,a)}}function _i(r,t){const e=r.getBoundingClientRect();if(t.left!==e.left||t.top!==e.top){const n=getComputedStyle(r),a=n.transform==="none"?"":n.transform;r.style.transform=`${a} translate(${t.left-e.left}px, ${t.top-e.top}px)`}}let Qe;function qe(r){Qe=r}function Vn(){if(!Qe)throw new Error("Function called outside component initialization");return Qe}function yi(r){Vn().$$.on_mount.push(r)}function On(r){Vn().$$.on_destroy.push(r)}function ki(){const r=Vn();return(t,e,{cancelable:n=!1}={})=>{const a=r.$$.callbacks[t];if(a){const i=di(t,e,{cancelable:n});return a.slice().forEach(s=>{s.call(r,i)}),!i.defaultPrevented}return!0}}const Ae=[],Xe=[];let ze=[];const nr=[],$i=Promise.resolve();let Bn=!1;function Si(){Bn||(Bn=!0,$i.then(Xr))}function Rn(r){ze.push(r)}const Fn=new Set;let Ne=0;function Xr(){if(Ne!==0)return;const r=Qe;do{try{for(;Ne<Ae.length;){const t=Ae[Ne];Ne++,qe(t),Ci(t.$$)}}catch(t){throw Ae.length=0,Ne=0,t}for(qe(null),Ae.length=0,Ne=0;Xe.length;)Xe.pop()();for(let t=0;t<ze.length;t+=1){const e=ze[t];Fn.has(e)||(Fn.add(e),e())}ze.length=0}while(Ae.length);for(;nr.length;)nr.pop()();Bn=!1,Fn.clear(),qe(r)}function Ci(r){if(r.fragment!==null){r.update(),$e(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Rn)}}function xi(r){const t=[],e=[];ze.forEach(n=>r.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),ze=t}const cn=new Set;let xe;function Zt(){xe={r:0,c:[],p:xe}}function Gt(){xe.r||$e(xe.c),xe=xe.p}function K(r,t){r&&r.i&&(cn.delete(r),r.i(t))}function Q(r,t,e,n){if(r&&r.o){if(cn.has(r))return;cn.add(r),xe.c.push(()=>{cn.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}function _e(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Fi(r,t){r.d(1),t.delete(r.key)}function Ei(r,t){Q(r,1,1,()=>{t.delete(r.key)})}function Di(r,t){r.f(),Ei(r,t)}function Jr(r,t,e,n,a,i,s,o,l,c,f,d){let w=r.length,u=i.length,m=w;const p={};for(;m--;)p[r[m].key]=m;const v=[],h=new Map,b=new Map,y=[];for(m=u;m--;){const P=d(a,i,m),z=e(P);let N=s.get(z);N?y.push(()=>N.p(P,t)):(N=c(z,P),N.c()),h.set(z,v[m]=N),z in p&&b.set(z,Math.abs(m-p[z]))}const $=new Set,k=new Set;function D(P){K(P,1),P.m(o,f),s.set(P.key,P),f=P.first,u--}for(;w&&u;){const P=v[u-1],z=r[w-1],N=P.key,j=z.key;P===z?(f=P.first,w--,u--):h.has(j)?!s.has(N)||$.has(N)?D(P):k.has(j)?w--:b.get(N)>b.get(j)?(k.add(N),D(P)):($.add(j),w--):(l(z,s),w--)}for(;w--;){const P=r[w];h.has(P.key)||l(P,s)}for(;u;)D(v[u-1]);return $e(y),v}function ne(r,t){const e={},n={},a={$$scope:1};let i=r.length;for(;i--;){const s=r[i],o=t[i];if(o){for(const l in s)l in o||(n[l]=1);for(const l in o)a[l]||(e[l]=o[l],a[l]=1);r[i]=o}else for(const l in s)a[l]=1}for(const s in n)s in e||(e[s]=void 0);return e}function de(r){return typeof r=="object"&&r!==null?r:{}}function ht(r){r&&r.c()}function ut(r,t,e){const{fragment:n,after_update:a}=r.$$;n&&n.m(t,e),Rn(()=>{const i=r.$$.on_mount.map(Hr).filter(tn);r.$$.on_destroy?r.$$.on_destroy.push(...i):$e(i),r.$$.on_mount=[]}),a.forEach(Rn)}function dt(r,t){const e=r.$$;e.fragment!==null&&(xi(e.after_update),$e(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function Pi(r,t){r.$$.dirty[0]===-1&&(Ae.push(r),Si(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function Lt(r,t,e,n,a,i,s=null,o=[-1]){const l=Qe;qe(r);const c=r.$$={fragment:null,ctx:[],props:i,update:Et,not_equal:a,bound:tr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:tr(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let f=!1;if(c.ctx=e?e(r,t.props||{},(d,w,...u)=>{const m=u.length?u[0]:w;return c.ctx&&a(c.ctx[d],c.ctx[d]=m)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](m),f&&Pi(r,d)),w}):[],c.update(),f=!0,$e(c.before_update),c.fragment=n?n(c.ctx):!1,t.target){if(t.hydrate){const d=ui(t.target);c.fragment&&c.fragment.l(d),d.forEach(pt)}else c.fragment&&c.fragment.c();t.intro&&K(r.$$.fragment),ut(r,t.target,t.anchor),Xr()}qe(l)}class Mt{constructor(){Sn(this,"$$");Sn(this,"$$set")}$destroy(){dt(this,1),this.$destroy=Et}$on(t,e){if(!tn(e))return Et;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const a=n.indexOf(e);a!==-1&&n.splice(a,1)}}$set(t){this.$$set&&!si(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ni="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ni);function Ai(r){let t,e,n,a,i;const s=r[6].default,o=Kt(s,r,r[5],null);return{c(){t=ct("button"),o&&o.c(),et(t,"class",e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`),et(t,"aria-label",r[3]),t.disabled=r[1],et(t,"style",r[2])},m(l,c){gt(l,t,c),o&&o.m(t,null),n=!0,a||(i=fe(t,"click",function(){tn(r[4])&&r[4].apply(this,arguments)}),a=!0)},p(l,[c]){r=l,o&&o.p&&(!n||c&32)&&Xt(o,s,r,r[5],n?qt(s,r[5],c,null):Jt(r[5]),null),(!n||c&1&&e!==(e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`))&&et(t,"class",e),(!n||c&8)&&et(t,"aria-label",r[3]),(!n||c&2)&&(t.disabled=r[1]),(!n||c&4)&&et(t,"style",r[2])},i(l){n||(K(o,l),n=!0)},o(l){Q(o,l),n=!1},d(l){l&&pt(t),o&&o.d(l),a=!1,i()}}}function ji(r,t,e){let{$$slots:n={},$$scope:a}=t,{variant:i="default"}=t,{disabled:s=!1}=t,{style:o=""}=t,{title:l=""}=t,{clickHandler:c=void 0}=t;return r.$$set=f=>{"variant"in f&&e(0,i=f.variant),"disabled"in f&&e(1,s=f.disabled),"style"in f&&e(2,o=f.style),"title"in f&&e(3,l=f.title),"clickHandler"in f&&e(4,c=f.clickHandler),"$$scope"in f&&e(5,a=f.$$scope)},[i,s,o,l,c,a,n]}class we extends Mt{constructor(t){super(),Lt(this,t,ji,Ai,Bt,{variant:0,disabled:1,style:2,title:3,clickHandler:4})}}function Ti(r){let t,e,n,a,i,s,o;const l=r[7].default,c=Kt(l,r,r[6],null);return{c(){t=ct("button"),e=ct("span"),c&&c.c(),et(e,"class",n=on(r[5]?"spinning":"")+" svelte-10fbbmm"),et(t,"class",a=on(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"),et(t,"aria-label",r[0]),t.disabled=r[2],et(t,"title",r[3])},m(f,d){gt(f,t,d),rt(t,e),c&&c.m(e,null),i=!0,s||(o=fe(t,"click",function(){tn(r[4])&&r[4].apply(this,arguments)}),s=!0)},p(f,[d]){r=f,c&&c.p&&(!i||d&64)&&Xt(c,l,r,r[6],i?qt(l,r[6],d,null):Jt(r[6]),null),(!i||d&32&&n!==(n=on(r[5]?"spinning":"")+" svelte-10fbbmm"))&&et(e,"class",n),(!i||d&2&&a!==(a=on(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"))&&et(t,"class",a),(!i||d&1)&&et(t,"aria-label",r[0]),(!i||d&4)&&(t.disabled=r[2]),(!i||d&8)&&et(t,"title",r[3])},i(f){i||(K(c,f),i=!0)},o(f){Q(c,f),i=!1},d(f){f&&pt(t),c&&c.d(f),s=!1,o()}}}function Oi(r,t,e){let{$$slots:n={},$$scope:a}=t,{ariaLabel:i=""}=t,{variant:s="default"}=t,{disabled:o=!1}=t,{title:l}=t,{clickHandler:c=void 0}=t,{spinning:f=!1}=t;return r.$$set=d=>{"ariaLabel"in d&&e(0,i=d.ariaLabel),"variant"in d&&e(1,s=d.variant),"disabled"in d&&e(2,o=d.disabled),"title"in d&&e(3,l=d.title),"clickHandler"in d&&e(4,c=d.clickHandler),"spinning"in d&&e(5,f=d.spinning),"$$scope"in d&&e(6,a=d.$$scope)},[i,s,o,l,c,f,a,n]}class se extends Mt{constructor(t){super(),Lt(this,t,Oi,Ti,Bt,{ariaLabel:0,variant:1,disabled:2,title:3,clickHandler:4,spinning:5})}}const Le=Math.min,Ht=Math.max,gn=Math.round,ln=Math.floor,ce=r=>({x:r,y:r}),Bi={left:"right",right:"left",bottom:"top",top:"bottom"},Ri={start:"end",end:"start"};function rr(r,t,e){return Ht(r,Le(t,e))}function en(r,t){return typeof r=="function"?r(t):r}function ye(r){return r.split("-")[0]}function nn(r){return r.split("-")[1]}function Qr(r){return r==="x"?"y":"x"}function ta(r){return r==="y"?"height":"width"}const zi=new Set(["top","bottom"]);function ge(r){return zi.has(ye(r))?"y":"x"}function ea(r){return Qr(ge(r))}function Ii(r,t,e){e===void 0&&(e=!1);const n=nn(r),a=ea(r),i=ta(a);let s=a==="x"?n===(e?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=wn(s)),[s,wn(s)]}function Li(r){const t=wn(r);return[zn(r),t,zn(t)]}function zn(r){return r.replace(/start|end/g,t=>Ri[t])}const ar=["left","right"],ir=["right","left"],Mi=["top","bottom"],Ui=["bottom","top"];function Wi(r,t,e){switch(r){case"top":case"bottom":return e?t?ir:ar:t?ar:ir;case"left":case"right":return t?Mi:Ui;default:return[]}}function Hi(r,t,e,n){const a=nn(r);let i=Wi(ye(r),e==="start",n);return a&&(i=i.map(s=>s+"-"+a),t&&(i=i.concat(i.map(zn)))),i}function wn(r){return r.replace(/left|right|bottom|top/g,t=>Bi[t])}function Vi(r){return{top:0,right:0,bottom:0,left:0,...r}}function Zi(r){return typeof r!="number"?Vi(r):{top:r,right:r,bottom:r,left:r}}function bn(r){const{x:t,y:e,width:n,height:a}=r;return{width:n,height:a,top:e,left:t,right:t+n,bottom:e+a,x:t,y:e}}function sr(r,t,e){let{reference:n,floating:a}=r;const i=ge(t),s=ea(t),o=ta(s),l=ye(t),c=i==="y",f=n.x+n.width/2-a.width/2,d=n.y+n.height/2-a.height/2,w=n[o]/2-a[o]/2;let u;switch(l){case"top":u={x:f,y:n.y-a.height};break;case"bottom":u={x:f,y:n.y+n.height};break;case"right":u={x:n.x+n.width,y:d};break;case"left":u={x:n.x-a.width,y:d};break;default:u={x:n.x,y:n.y}}switch(nn(t)){case"start":u[s]-=w*(e&&c?-1:1);break;case"end":u[s]+=w*(e&&c?-1:1);break}return u}const Gi=async(r,t,e)=>{const{placement:n="bottom",strategy:a="absolute",middleware:i=[],platform:s}=e,o=i.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(t));let c=await s.getElementRects({reference:r,floating:t,strategy:a}),{x:f,y:d}=sr(c,n,l),w=n,u={},m=0;for(let p=0;p<o.length;p++){const{name:v,fn:h}=o[p],{x:b,y,data:$,reset:k}=await h({x:f,y:d,initialPlacement:n,placement:w,strategy:a,middlewareData:u,rects:c,platform:s,elements:{reference:r,floating:t}});f=b??f,d=y??d,u={...u,[v]:{...u[v],...$}},k&&m<=50&&(m++,typeof k=="object"&&(k.placement&&(w=k.placement),k.rects&&(c=k.rects===!0?await s.getElementRects({reference:r,floating:t,strategy:a}):k.rects),{x:f,y:d}=sr(c,w,l)),p=-1)}return{x:f,y:d,placement:w,strategy:a,middlewareData:u}};async function Zn(r,t){var e;t===void 0&&(t={});const{x:n,y:a,platform:i,rects:s,elements:o,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:f="viewport",elementContext:d="floating",altBoundary:w=!1,padding:u=0}=en(t,r),m=Zi(u),v=o[w?d==="floating"?"reference":"floating":d],h=bn(await i.getClippingRect({element:(e=await(i.isElement==null?void 0:i.isElement(v)))==null||e?v:v.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:c,rootBoundary:f,strategy:l})),b=d==="floating"?{x:n,y:a,width:s.floating.width,height:s.floating.height}:s.reference,y=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),$=await(i.isElement==null?void 0:i.isElement(y))?await(i.getScale==null?void 0:i.getScale(y))||{x:1,y:1}:{x:1,y:1},k=bn(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:b,offsetParent:y,strategy:l}):b);return{top:(h.top-k.top+m.top)/$.y,bottom:(k.bottom-h.bottom+m.bottom)/$.y,left:(h.left-k.left+m.left)/$.x,right:(k.right-h.right+m.right)/$.x}}const Yi=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var e,n;const{placement:a,middlewareData:i,rects:s,initialPlacement:o,platform:l,elements:c}=t,{mainAxis:f=!0,crossAxis:d=!0,fallbackPlacements:w,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...v}=en(r,t);if((e=i.arrow)!=null&&e.alignmentOffset)return{};const h=ye(a),b=ge(o),y=ye(o)===o,$=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=w||(y||!p?[wn(o)]:Li(o)),D=m!=="none";!w&&D&&k.push(...Hi(o,p,m,$));const P=[o,...k],z=await Zn(t,v),N=[];let j=((n=i.flip)==null?void 0:n.overflows)||[];if(f&&N.push(z[h]),d){const _=Ii(a,s,$);N.push(z[_[0]],z[_[1]])}if(j=[...j,{placement:a,overflows:N}],!N.every(_=>_<=0)){var q,x;const _=(((q=i.flip)==null?void 0:q.index)||0)+1,W=P[_];if(W&&(!(d==="alignment"?b!==ge(W):!1)||j.every(ot=>ge(ot.placement)===b?ot.overflows[0]>0:!0)))return{data:{index:_,overflows:j},reset:{placement:W}};let st=(x=j.filter(V=>V.overflows[0]<=0).sort((V,ot)=>V.overflows[1]-ot.overflows[1])[0])==null?void 0:x.placement;if(!st)switch(u){case"bestFit":{var I;const V=(I=j.filter(ot=>{if(D){const G=ge(ot.placement);return G===b||G==="y"}return!0}).map(ot=>[ot.placement,ot.overflows.filter(G=>G>0).reduce((G,ft)=>G+ft,0)]).sort((ot,G)=>ot[1]-G[1])[0])==null?void 0:I[0];V&&(st=V);break}case"initialPlacement":st=o;break}if(a!==st)return{reset:{placement:st}}}return{}}}},Ki=new Set(["left","top"]);async function qi(r,t){const{placement:e,platform:n,elements:a}=r,i=await(n.isRTL==null?void 0:n.isRTL(a.floating)),s=ye(e),o=nn(e),l=ge(e)==="y",c=Ki.has(s)?-1:1,f=i&&l?-1:1,d=en(t,r);let{mainAxis:w,crossAxis:u,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof m=="number"&&(u=o==="end"?m*-1:m),l?{x:u*f,y:w*c}:{x:w*c,y:u*f}}const Xi=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var e,n;const{x:a,y:i,placement:s,middlewareData:o}=t,l=await qi(t,r);return s===((e=o.offset)==null?void 0:e.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:a+l.x,y:i+l.y,data:{...l,placement:s}}}}},Ji=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:e,y:n,placement:a}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:o={fn:v=>{let{x:h,y:b}=v;return{x:h,y:b}}},...l}=en(r,t),c={x:e,y:n},f=await Zn(t,l),d=ge(ye(a)),w=Qr(d);let u=c[w],m=c[d];if(i){const v=w==="y"?"top":"left",h=w==="y"?"bottom":"right",b=u+f[v],y=u-f[h];u=rr(b,u,y)}if(s){const v=d==="y"?"top":"left",h=d==="y"?"bottom":"right",b=m+f[v],y=m-f[h];m=rr(b,m,y)}const p=o.fn({...t,[w]:u,[d]:m});return{...p,data:{x:p.x-e,y:p.y-n,enabled:{[w]:i,[d]:s}}}}}},Qi=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var e,n;const{placement:a,rects:i,platform:s,elements:o}=t,{apply:l=()=>{},...c}=en(r,t),f=await Zn(t,c),d=ye(a),w=nn(a),u=ge(a)==="y",{width:m,height:p}=i.floating;let v,h;d==="top"||d==="bottom"?(v=d,h=w===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(h=d,v=w==="end"?"top":"bottom");const b=p-f.top-f.bottom,y=m-f.left-f.right,$=Le(p-f[v],b),k=Le(m-f[h],y),D=!t.middlewareData.shift;let P=$,z=k;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(z=y),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(P=b),D&&!w){const j=Ht(f.left,0),q=Ht(f.right,0),x=Ht(f.top,0),I=Ht(f.bottom,0);u?z=m-2*(j!==0||q!==0?j+q:Ht(f.left,f.right)):P=p-2*(x!==0||I!==0?x+I:Ht(f.top,f.bottom))}await l({...t,availableWidth:z,availableHeight:P});const N=await s.getDimensions(o.floating);return m!==N.width||p!==N.height?{reset:{rects:!0}}:{}}}};function _n(){return typeof window<"u"}function Ve(r){return na(r)?(r.nodeName||"").toLowerCase():"#document"}function Yt(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function he(r){var t;return(t=(na(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function na(r){return _n()?r instanceof Node||r instanceof Yt(r).Node:!1}function oe(r){return _n()?r instanceof Element||r instanceof Yt(r).Element:!1}function ue(r){return _n()?r instanceof HTMLElement||r instanceof Yt(r).HTMLElement:!1}function or(r){return!_n()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Yt(r).ShadowRoot}const ts=new Set(["inline","contents"]);function rn(r){const{overflow:t,overflowX:e,overflowY:n,display:a}=le(r);return/auto|scroll|overlay|hidden|clip/.test(t+n+e)&&!ts.has(a)}const es=new Set(["table","td","th"]);function ns(r){return es.has(Ve(r))}const rs=[":popover-open",":modal"];function yn(r){return rs.some(t=>{try{return r.matches(t)}catch{return!1}})}const as=["transform","translate","scale","rotate","perspective"],is=["transform","translate","scale","rotate","perspective","filter"],ss=["paint","layout","strict","content"];function Gn(r){const t=Yn(),e=oe(r)?le(r):r;return as.some(n=>e[n]?e[n]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||is.some(n=>(e.willChange||"").includes(n))||ss.some(n=>(e.contain||"").includes(n))}function os(r){let t=ke(r);for(;ue(t)&&!Me(t);){if(Gn(t))return t;if(yn(t))return null;t=ke(t)}return null}function Yn(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ls=new Set(["html","body","#document"]);function Me(r){return ls.has(Ve(r))}function le(r){return Yt(r).getComputedStyle(r)}function kn(r){return oe(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function ke(r){if(Ve(r)==="html")return r;const t=r.assignedSlot||r.parentNode||or(r)&&r.host||he(r);return or(t)?t.host:t}function ra(r){const t=ke(r);return Me(t)?r.ownerDocument?r.ownerDocument.body:r.body:ue(t)&&rn(t)?t:ra(t)}function Ue(r,t,e){var n;t===void 0&&(t=[]),e===void 0&&(e=!0);const a=ra(r),i=a===((n=r.ownerDocument)==null?void 0:n.body),s=Yt(a);if(i){const o=In(s);return t.concat(s,s.visualViewport||[],rn(a)?a:[],o&&e?Ue(o):[])}return t.concat(a,Ue(a,[],e))}function In(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function aa(r){const t=le(r);let e=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=ue(r),i=a?r.offsetWidth:e,s=a?r.offsetHeight:n,o=gn(e)!==i||gn(n)!==s;return o&&(e=i,n=s),{width:e,height:n,$:o}}function Kn(r){return oe(r)?r:r.contextElement}function Ie(r){const t=Kn(r);if(!ue(t))return ce(1);const e=t.getBoundingClientRect(),{width:n,height:a,$:i}=aa(t);let s=(i?gn(e.width):e.width)/n,o=(i?gn(e.height):e.height)/a;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const cs=ce(0);function ia(r){const t=Yt(r);return!Yn()||!t.visualViewport?cs:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function fs(r,t,e){return t===void 0&&(t=!1),!e||t&&e!==Yt(r)?!1:t}function Ee(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=!1);const a=r.getBoundingClientRect(),i=Kn(r);let s=ce(1);t&&(n?oe(n)&&(s=Ie(n)):s=Ie(r));const o=fs(i,e,n)?ia(i):ce(0);let l=(a.left+o.x)/s.x,c=(a.top+o.y)/s.y,f=a.width/s.x,d=a.height/s.y;if(i){const w=Yt(i),u=n&&oe(n)?Yt(n):n;let m=w,p=In(m);for(;p&&n&&u!==m;){const v=Ie(p),h=p.getBoundingClientRect(),b=le(p),y=h.left+(p.clientLeft+parseFloat(b.paddingLeft))*v.x,$=h.top+(p.clientTop+parseFloat(b.paddingTop))*v.y;l*=v.x,c*=v.y,f*=v.x,d*=v.y,l+=y,c+=$,m=Yt(p),p=In(m)}}return bn({width:f,height:d,x:l,y:c})}function $n(r,t){const e=kn(r).scrollLeft;return t?t.left+e:Ee(he(r)).left+e}function sa(r,t){const e=r.getBoundingClientRect(),n=e.left+t.scrollLeft-$n(r,e),a=e.top+t.scrollTop;return{x:n,y:a}}function us(r){let{elements:t,rect:e,offsetParent:n,strategy:a}=r;const i=a==="fixed",s=he(n),o=t?yn(t.floating):!1;if(n===s||o&&i)return e;let l={scrollLeft:0,scrollTop:0},c=ce(1);const f=ce(0),d=ue(n);if((d||!d&&!i)&&((Ve(n)!=="body"||rn(s))&&(l=kn(n)),ue(n))){const u=Ee(n);c=Ie(n),f.x=u.x+n.clientLeft,f.y=u.y+n.clientTop}const w=s&&!d&&!i?sa(s,l):ce(0);return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+f.x+w.x,y:e.y*c.y-l.scrollTop*c.y+f.y+w.y}}function ds(r){return Array.from(r.getClientRects())}function hs(r){const t=he(r),e=kn(r),n=r.ownerDocument.body,a=Ht(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),i=Ht(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let s=-e.scrollLeft+$n(r);const o=-e.scrollTop;return le(n).direction==="rtl"&&(s+=Ht(t.clientWidth,n.clientWidth)-a),{width:a,height:i,x:s,y:o}}const lr=25;function ps(r,t){const e=Yt(r),n=he(r),a=e.visualViewport;let i=n.clientWidth,s=n.clientHeight,o=0,l=0;if(a){i=a.width,s=a.height;const f=Yn();(!f||f&&t==="fixed")&&(o=a.offsetLeft,l=a.offsetTop)}const c=$n(n);if(c<=0){const f=n.ownerDocument,d=f.body,w=getComputedStyle(d),u=f.compatMode==="CSS1Compat"&&parseFloat(w.marginLeft)+parseFloat(w.marginRight)||0,m=Math.abs(n.clientWidth-d.clientWidth-u);m<=lr&&(i-=m)}else c<=lr&&(i+=c);return{width:i,height:s,x:o,y:l}}const ms=new Set(["absolute","fixed"]);function gs(r,t){const e=Ee(r,!0,t==="fixed"),n=e.top+r.clientTop,a=e.left+r.clientLeft,i=ue(r)?Ie(r):ce(1),s=r.clientWidth*i.x,o=r.clientHeight*i.y,l=a*i.x,c=n*i.y;return{width:s,height:o,x:l,y:c}}function cr(r,t,e){let n;if(t==="viewport")n=ps(r,e);else if(t==="document")n=hs(he(r));else if(oe(t))n=gs(t,e);else{const a=ia(r);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return bn(n)}function oa(r,t){const e=ke(r);return e===t||!oe(e)||Me(e)?!1:le(e).position==="fixed"||oa(e,t)}function ws(r,t){const e=t.get(r);if(e)return e;let n=Ue(r,[],!1).filter(o=>oe(o)&&Ve(o)!=="body"),a=null;const i=le(r).position==="fixed";let s=i?ke(r):r;for(;oe(s)&&!Me(s);){const o=le(s),l=Gn(s);!l&&o.position==="fixed"&&(a=null),(i?!l&&!a:!l&&o.position==="static"&&!!a&&ms.has(a.position)||rn(s)&&!l&&oa(r,s))?n=n.filter(f=>f!==s):a=o,s=ke(s)}return t.set(r,n),n}function bs(r){let{element:t,boundary:e,rootBoundary:n,strategy:a}=r;const s=[...e==="clippingAncestors"?yn(t)?[]:ws(t,this._c):[].concat(e),n],o=s[0],l=s.reduce((c,f)=>{const d=cr(t,f,a);return c.top=Ht(d.top,c.top),c.right=Le(d.right,c.right),c.bottom=Le(d.bottom,c.bottom),c.left=Ht(d.left,c.left),c},cr(t,o,a));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function vs(r){const{width:t,height:e}=aa(r);return{width:t,height:e}}function _s(r,t,e){const n=ue(t),a=he(t),i=e==="fixed",s=Ee(r,!0,i,t);let o={scrollLeft:0,scrollTop:0};const l=ce(0);function c(){l.x=$n(a)}if(n||!n&&!i)if((Ve(t)!=="body"||rn(a))&&(o=kn(t)),n){const u=Ee(t,!0,i,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else a&&c();i&&!n&&a&&c();const f=a&&!n&&!i?sa(a,o):ce(0),d=s.left+o.scrollLeft-l.x-f.x,w=s.top+o.scrollTop-l.y-f.y;return{x:d,y:w,width:s.width,height:s.height}}function En(r){return le(r).position==="static"}function fr(r,t){if(!ue(r)||le(r).position==="fixed")return null;if(t)return t(r);let e=r.offsetParent;return he(r)===e&&(e=e.ownerDocument.body),e}function la(r,t){const e=Yt(r);if(yn(r))return e;if(!ue(r)){let a=ke(r);for(;a&&!Me(a);){if(oe(a)&&!En(a))return a;a=ke(a)}return e}let n=fr(r,t);for(;n&&ns(n)&&En(n);)n=fr(n,t);return n&&Me(n)&&En(n)&&!Gn(n)?e:n||os(r)||e}const ys=async function(r){const t=this.getOffsetParent||la,e=this.getDimensions,n=await e(r.floating);return{reference:_s(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function ks(r){return le(r).direction==="rtl"}const ca={convertOffsetParentRelativeRectToViewportRelativeRect:us,getDocumentElement:he,getClippingRect:bs,getOffsetParent:la,getElementRects:ys,getClientRects:ds,getDimensions:vs,getScale:Ie,isElement:oe,isRTL:ks};function fa(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function $s(r,t){let e=null,n;const a=he(r);function i(){var o;clearTimeout(n),(o=e)==null||o.disconnect(),e=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),i();const c=r.getBoundingClientRect(),{left:f,top:d,width:w,height:u}=c;if(o||t(),!w||!u)return;const m=ln(d),p=ln(a.clientWidth-(f+w)),v=ln(a.clientHeight-(d+u)),h=ln(f),y={rootMargin:-m+"px "+-p+"px "+-v+"px "+-h+"px",threshold:Ht(0,Le(1,l))||1};let $=!0;function k(D){const P=D[0].intersectionRatio;if(P!==l){if(!$)return s();P?s(!1,P):n=setTimeout(()=>{s(!1,1e-7)},1e3)}P===1&&!fa(c,r.getBoundingClientRect())&&s(),$=!1}try{e=new IntersectionObserver(k,{...y,root:a.ownerDocument})}catch{e=new IntersectionObserver(k,y)}e.observe(r)}return s(!0),i}function ua(r,t,e,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Kn(r),f=a||i?[...c?Ue(c):[],...Ue(t)]:[];f.forEach(h=>{a&&h.addEventListener("scroll",e,{passive:!0}),i&&h.addEventListener("resize",e)});const d=c&&o?$s(c,e):null;let w=-1,u=null;s&&(u=new ResizeObserver(h=>{let[b]=h;b&&b.target===c&&u&&(u.unobserve(t),cancelAnimationFrame(w),w=requestAnimationFrame(()=>{var y;(y=u)==null||y.observe(t)})),e()}),c&&!l&&u.observe(c),u.observe(t));let m,p=l?Ee(r):null;l&&v();function v(){const h=Ee(r);p&&!fa(p,h)&&e(),p=h,m=requestAnimationFrame(v)}return e(),()=>{var h;f.forEach(b=>{a&&b.removeEventListener("scroll",e),i&&b.removeEventListener("resize",e)}),d==null||d(),(h=u)==null||h.disconnect(),u=null,l&&cancelAnimationFrame(m)}}const da=Xi,ha=Ji,pa=Yi,ma=Qi,Ss=(r,t,e)=>{const n=new Map,a={platform:ca,...e},i={...a.platform,_c:n};return Gi(r,t,{...a,platform:i})},Cs=Object.freeze(Object.defineProperty({__proto__:null,autoUpdate:ua,computePosition:Ss,flip:pa,getOverflowAncestors:Ue,offset:da,platform:ca,shift:ha,size:ma},Symbol.toStringTag,{value:"Module"}));/**
 * @license lucide-svelte v0.546.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const ur={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};function dr(r,t,e){const n=r.slice();return n[11]=t[e][0],n[12]=t[e][1],n}function Dn(r){let t,e=[r[12]],n={};for(let a=0;a<e.length;a+=1)n=vt(n,e[a]);return{c(){t=qr(r[11]),dn(t,n)},m(a,i){gt(a,t,i)},p(a,i){dn(t,n=ne(e,[i&32&&a[12]]))},d(a){a&&pt(t)}}}function hr(r){let t=r[11],e,n=r[11]&&Dn(r);return{c(){n&&n.c(),e=vn()},m(a,i){n&&n.m(a,i),gt(a,e,i)},p(a,i){a[11]?t?Bt(t,a[11])?(n.d(1),n=Dn(a),t=a[11],n.c(),n.m(e.parentNode,e)):n.p(a,i):(n=Dn(a),t=a[11],n.c(),n.m(e.parentNode,e)):t&&(n.d(1),n=null,t=a[11])},d(a){a&&pt(e),n&&n.d(a)}}}function xs(r){let t,e,n,a,i,s=_e(r[5]),o=[];for(let w=0;w<s.length;w+=1)o[w]=hr(dr(r,s,w));const l=r[10].default,c=Kt(l,r,r[9],null);let f=[ur,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:a=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],d={};for(let w=0;w<f.length;w+=1)d=vt(d,f[w]);return{c(){t=qr("svg");for(let w=0;w<o.length;w+=1)o[w].c();e=vn(),c&&c.c(),dn(t,d)},m(w,u){gt(w,t,u);for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(t,null);rt(t,e),c&&c.m(t,null),i=!0},p(w,[u]){if(u&32){s=_e(w[5]);let m;for(m=0;m<s.length;m+=1){const p=dr(w,s,m);o[m]?o[m].p(p,u):(o[m]=hr(p),o[m].c(),o[m].m(t,e))}for(;m<o.length;m+=1)o[m].d(1);o.length=s.length}c&&c.p&&(!i||u&512)&&Xt(c,l,w,w[9],i?qt(l,w[9],u,null):Jt(w[9]),null),dn(t,d=ne(f,[ur,u&128&&w[7],(!i||u&4)&&{width:w[2]},(!i||u&4)&&{height:w[2]},(!i||u&2)&&{stroke:w[1]},(!i||u&28&&n!==(n=w[4]?Number(w[3])*24/Number(w[2]):w[3]))&&{"stroke-width":n},(!i||u&257&&a!==(a=w[6]("lucide-icon","lucide",w[0]?`lucide-${w[0]}`:"",w[8].class)))&&{class:a}]))},i(w){i||(K(c,w),i=!0)},o(w){Q(c,w),i=!1},d(w){w&&pt(t),Kr(o,w),c&&c.d(w)}}}function Fs(r,t,e){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let a=er(t,n),{$$slots:i={},$$scope:s}=t,{name:o=void 0}=t,{color:l="currentColor"}=t,{size:c=24}=t,{strokeWidth:f=2}=t,{absoluteStrokeWidth:d=!1}=t,{iconNode:w=[]}=t;const u=(...m)=>m.filter((p,v,h)=>!!p&&h.indexOf(p)===v).join(" ");return r.$$set=m=>{e(8,t=vt(vt({},t),Pt(m))),e(7,a=er(t,n)),"name"in m&&e(0,o=m.name),"color"in m&&e(1,l=m.color),"size"in m&&e(2,c=m.size),"strokeWidth"in m&&e(3,f=m.strokeWidth),"absoluteStrokeWidth"in m&&e(4,d=m.absoluteStrokeWidth),"iconNode"in m&&e(5,w=m.iconNode),"$$scope"in m&&e(9,s=m.$$scope)},t=Pt(t),[o,l,c,f,d,w,u,a,t,s,i]}class pe extends Mt{constructor(t){super(),Lt(this,t,Fs,xs,Bt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}function Es(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ds(r){let t,e;const n=[{name:"arrow-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Es]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ps(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class ga extends Mt{constructor(t){super(),Lt(this,t,Ps,Ds,Bt,{})}}function Ns(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function As(r){let t,e;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ns]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function js(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class wa extends Mt{constructor(t){super(),Lt(this,t,js,As,Bt,{})}}function Ts(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Os(r){let t,e;const n=[{name:"book-open-check"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ts]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Bs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 21V7"}],["path",{d:"m16 12 2 2 4-4"}],["path",{d:"M22 6V4a1 1 0 0 0-1-1h-5a4 4 0 0 0-4 4 4 4 0 0 0-4-4H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h6a3 3 0 0 1 3 3 3 3 0 0 1 3-3h6a1 1 0 0 0 1-1v-1.3"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Rs extends Mt{constructor(t){super(),Lt(this,t,Bs,Os,Bt,{})}}function zs(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Is(r){let t,e;const n=[{name:"chevron-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[zs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ls(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m6 9 6 6 6-6"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Ms extends Mt{constructor(t){super(),Lt(this,t,Ls,Is,Bt,{})}}function Us(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ws(r){let t,e;const n=[{name:"copy"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Us]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Hs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Vs extends Mt{constructor(t){super(),Lt(this,t,Hs,Ws,Bt,{})}}function Zs(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Gs(r){let t,e;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Zs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ys(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class ba extends Mt{constructor(t){super(),Lt(this,t,Ys,Gs,Bt,{})}}function Ks(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function qs(r){let t,e;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ks]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Xs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class va extends Mt{constructor(t){super(),Lt(this,t,Xs,qs,Bt,{})}}function Js(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Qs(r){let t,e;const n=[{name:"rotate-ccw"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Js]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function to(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class _a extends Mt{constructor(t){super(),Lt(this,t,to,Qs,Bt,{})}}function eo(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function no(r){let t,e;const n=[{name:"trash"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[eo]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function ro(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class ya extends Mt{constructor(t){super(),Lt(this,t,ro,no,Bt,{})}}function ao(r){let t;const e=r[2].default,n=Kt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Xt(n,e,a,a[3],t?qt(e,a[3],i,null):Jt(a[3]),null)},i(a){t||(K(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function io(r){let t,e;const n=[{name:"x"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[ao]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=vt(a,n[i]);return t=new pe({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ne(n,[n[0],s&2&&de(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(K(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function so(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return r.$$set=s=>{e(1,t=vt(vt({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class oo extends Mt{constructor(t){super(),Lt(this,t,so,io,Bt,{})}}function pr(r,t,e){const n=r.slice();return n[38]=t[e],n[40]=e,n}function mr(r){let t,e,n;return{c(){t=ct("label"),e=It(r[2]),et(t,"class","wa-select-label-text"),et(t,"for",n="wa-select-"+r[7])},m(a,i){gt(a,t,i),rt(t,e)},p(a,i){i[0]&4&&He(e,a[2]),i[0]&128&&n!==(n="wa-select-"+a[7])&&et(t,"for",n)},d(a){a&&pt(t)}}}function lo(r){let t,e;return{c(){t=ct("span"),e=It(r[1]),et(t,"class","wa-select-placeholder")},m(n,a){gt(n,t,a),rt(t,e)},p(n,a){a[0]&2&&He(e,n[1])},d(n){n&&pt(t)}}}function co(r){let t,e;return{c(){t=ct("span"),e=It(r[16]),et(t,"class","wa-select-label")},m(n,a){gt(n,t,a),rt(t,e)},p(n,a){a[0]&65536&&He(e,n[16])},d(n){n&&pt(t)}}}function gr(r){let t,e,n,a,i;return e=new oo({}),{c(){t=ct("button"),ht(e.$$.fragment),et(t,"type","button"),et(t,"class","wa-select-clear"),et(t,"aria-label","Clear selection")},m(s,o){gt(s,t,o),ut(e,t,null),n=!0,a||(i=fe(t,"click",r[21]),a=!0)},p:Et,i(s){n||(K(e.$$.fragment,s),n=!0)},o(s){Q(e.$$.fragment,s),n=!1},d(s){s&&pt(t),dt(e),a=!1,i()}}}function wr(r){let t,e,n;return e=new Ms({}),{c(){t=ct("div"),ht(e.$$.fragment),et(t,"class","wa-select-chevron"),ee(t,"rotated",r[9])},m(a,i){gt(a,t,i),ut(e,t,null),n=!0},p(a,i){(!n||i[0]&512)&&ee(t,"rotated",a[9])},i(a){n||(K(e.$$.fragment,a),n=!0)},o(a){Q(e.$$.fragment,a),n=!1},d(a){a&&pt(t),dt(e)}}}function br(r){let t,e,n,a=r[4]&&vr(r);function i(l,c){return l[10].length===0?uo:fo}let s=i(r),o=s(r);return{c(){t=ct("div"),a&&a.c(),e=mt(),n=ct("div"),o.c(),et(n,"class","wa-select-list"),et(t,"class","wa-select-dropdown")},m(l,c){gt(l,t,c),a&&a.m(t,null),rt(t,e),rt(t,n),o.m(n,null),r[30](t)},p(l,c){l[4]?a?a.p(l,c):(a=vr(l),a.c(),a.m(t,e)):a&&(a.d(1),a=null),s===(s=i(l))&&o?o.p(l,c):(o.d(1),o=s(l),o&&(o.c(),o.m(n,null)))},d(l){l&&pt(t),a&&a.d(),o.d(),r[30](null)}}}function vr(r){let t,e,n,a;return{c(){t=ct("div"),e=ct("input"),et(e,"type","text"),et(e,"class","wa-select-search-input"),et(e,"placeholder","Search..."),e.value=r[13],et(t,"class","wa-select-search")},m(i,s){gt(i,t,s),rt(t,e),r[27](e),n||(a=fe(e,"input",r[23]),n=!0)},p(i,s){s[0]&8192&&e.value!==i[13]&&(e.value=i[13])},d(i){i&&pt(t),r[27](null),n=!1,a()}}}function fo(r){let t=[],e=new Map,n,a=_e(r[10]);const i=s=>s[38].value;for(let s=0;s<a.length;s+=1){let o=pr(r,a,s),l=i(o);e.set(l,t[s]=_r(l,o))}return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=vn()},m(s,o){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(s,o);gt(s,n,o)},p(s,o){o[0]&1197056&&(a=_e(s[10]),t=Jr(t,o,i,1,s,a,e,n.parentNode,Fi,_r,n,pr))},d(s){s&&pt(n);for(let o=0;o<t.length;o+=1)t[o].d(s)}}}function uo(r){let t;return{c(){t=ct("div"),t.textContent="No options available",et(t,"class","wa-select-empty")},m(e,n){gt(e,t,n)},p:Et,d(e){e&&pt(t)}}}function _r(r,t){let e,n=t[38].label+"",a,i,s,o,l;function c(){return t[28](t[38])}function f(){return t[29](t[40])}return{key:r,first:null,c(){e=ct("button"),a=It(n),i=mt(),et(e,"type","button"),et(e,"class","wa-select-option"),et(e,"data-select-index",s=t[40]),ee(e,"selected",t[14]===t[40]),ee(e,"active",t[17]()===t[38].value),this.first=e},m(d,w){gt(d,e,w),rt(e,a),rt(e,i),o||(l=[fe(e,"click",c),fe(e,"mouseenter",f)],o=!0)},p(d,w){t=d,w[0]&1024&&n!==(n=t[38].label+"")&&He(a,n),w[0]&1024&&s!==(s=t[40])&&et(e,"data-select-index",s),w[0]&17408&&ee(e,"selected",t[14]===t[40]),w[0]&132096&&ee(e,"active",t[17]()===t[38].value)},d(d){d&&pt(e),o=!1,$e(l)}}}function ho(r){let t,e,n,a,i,s,o,l,c,f,d,w,u,m=r[2]&&mr(r);function p(k,D){return k[0]?co:lo}let v=p(r),h=v(r),b=r[5]&&r[0]&&gr(r),y=r[6]&&wr(r),$=r[9]&&br(r);return{c(){t=ct("div"),m&&m.c(),e=mt(),n=ct("div"),a=ct("div"),h.c(),i=mt(),s=ct("div"),b&&b.c(),o=mt(),y&&y.c(),f=mt(),$&&$.c(),et(a,"class","wa-select-value"),et(s,"class","wa-select-controls"),et(n,"id",l="wa-select-"+r[7]),et(n,"class","wa-select-trigger"),et(n,"role","button"),et(n,"tabindex",c=r[3]?-1:0),et(n,"style",r[8]),ee(n,"open",r[9]),ee(n,"disabled",r[3]),ee(n,"has-value",r[0]),et(t,"class","wa-select-container wa-select")},m(k,D){gt(k,t,D),m&&m.m(t,null),rt(t,e),rt(t,n),rt(n,a),h.m(a,null),rt(n,i),rt(n,s),b&&b.m(s,null),rt(s,o),y&&y.m(s,null),r[25](n),rt(t,f),$&&$.m(t,null),d=!0,w||(u=[fe(n,"click",r[26]),fe(n,"keydown",r[22])],w=!0)},p(k,D){k[2]?m?m.p(k,D):(m=mr(k),m.c(),m.m(t,e)):m&&(m.d(1),m=null),v===(v=p(k))&&h?h.p(k,D):(h.d(1),h=v(k),h&&(h.c(),h.m(a,null))),k[5]&&k[0]?b?(b.p(k,D),D[0]&33&&K(b,1)):(b=gr(k),b.c(),K(b,1),b.m(s,o)):b&&(Zt(),Q(b,1,1,()=>{b=null}),Gt()),k[6]?y?(y.p(k,D),D[0]&64&&K(y,1)):(y=wr(k),y.c(),K(y,1),y.m(s,null)):y&&(Zt(),Q(y,1,1,()=>{y=null}),Gt()),(!d||D[0]&128&&l!==(l="wa-select-"+k[7]))&&et(n,"id",l),(!d||D[0]&8&&c!==(c=k[3]?-1:0))&&et(n,"tabindex",c),(!d||D[0]&256)&&et(n,"style",k[8]),(!d||D[0]&512)&&ee(n,"open",k[9]),(!d||D[0]&8)&&ee(n,"disabled",k[3]),(!d||D[0]&1)&&ee(n,"has-value",k[0]),k[9]?$?$.p(k,D):($=br(k),$.c(),$.m(t,null)):$&&($.d(1),$=null)},i(k){d||(K(b),K(y),d=!0)},o(k){Q(b),Q(y),d=!1},d(k){k&&pt(t),m&&m.d(),h.d(),b&&b.d(),y&&y.d(),r[25](null),$&&$.d(),w=!1,$e(u)}}}function po(r,t,e){let n,{items:a=[]}=t,{value:i=null}=t,{placeholder:s="Select..."}=t,{label:o=""}=t,{disabled:l=!1}=t,{searchable:c=!1}=t,{clearable:f=!1}=t,{showChevron:d=!0}=t,{name:w=""}=t,{containerStyles:u=""}=t,m=!1,p="",v=[],h=-1,b,y,$,k=null;const D=ki();function P(){return i?typeof i=="string"?i:i.value||"":""}function z(){p?e(10,v=a.filter(U=>U.label.toLowerCase().includes(p.toLowerCase())||U.value.toLowerCase().includes(p.toLowerCase()))):e(10,v=a),e(14,h=-1)}function N(){l||m||(e(9,m=!0),e(13,p=""),z(),c&&setTimeout(()=>{$&&$.focus()},0),b&&y&&q())}function j(){e(9,m=!1),e(13,p=""),e(14,h=-1)}function q(){if(!b||!y)return;const U=[da(6),pa({padding:8,fallbackAxisSideDirection:"end"}),ha({padding:8}),ma({padding:8,apply({availableHeight:X}){Object.assign(y.style,{maxHeight:`${Math.min(X-10,350)}px`,width:`${b.offsetWidth}px`})}})];k=ua(b,y,async()=>{const{computePosition:X}=await Promise.resolve().then(()=>Cs),{x:Ct,y:Nt,placement:wt}=await X(b,y,{middleware:U,placement:"bottom-start"});y.setAttribute("data-placement",wt),Object.assign(y.style,{left:`${Ct}px`,top:`${Nt}px`})})}function x(U){e(0,i=U),j(),D("select",U)}function I(U){U.stopPropagation(),e(0,i=null),j(),D("clear")}function _(U){if(!m){(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),N());return}switch(U.key){case"ArrowDown":U.preventDefault(),e(14,h=Math.min(h+1,v.length-1)),W();break;case"ArrowUp":U.preventDefault(),e(14,h=Math.max(h-1,-1)),W();break;case"Enter":U.preventDefault(),h>=0?x(v[h]):j();break;case"Escape":U.preventDefault(),j();break}}function W(){if(h<0)return;const U=document.querySelector(`[data-select-index="${h}"]`);U&&U.scrollIntoView({block:"nearest"})}function st(U){e(13,p=U.target.value),z()}function V(U){if(m&&b&&y){const X=U.target;!b.contains(X)&&!y.contains(X)&&j()}}yi(()=>{document.addEventListener("click",V),z()}),On(()=>{document.removeEventListener("click",V),k&&k()});function ot(U){Xe[U?"unshift":"push"](()=>{b=U,e(11,b)})}const G=()=>m?j():N();function ft(U){Xe[U?"unshift":"push"](()=>{$=U,e(15,$)})}const O=U=>x(U),T=U=>e(14,h=U);function lt(U){Xe[U?"unshift":"push"](()=>{y=U,e(12,y),e(9,m),e(11,b)})}return r.$$set=U=>{"items"in U&&e(24,a=U.items),"value"in U&&e(0,i=U.value),"placeholder"in U&&e(1,s=U.placeholder),"label"in U&&e(2,o=U.label),"disabled"in U&&e(3,l=U.disabled),"searchable"in U&&e(4,c=U.searchable),"clearable"in U&&e(5,f=U.clearable),"showChevron"in U&&e(6,d=U.showChevron),"name"in U&&e(7,w=U.name),"containerStyles"in U&&e(8,u=U.containerStyles)},r.$$.update=()=>{var U;if(r.$$.dirty[0]&16777219&&e(16,n=i?typeof i=="string"?((U=a.find(X=>X.value===i))==null?void 0:U.label)||i:i.label||s:s),r.$$.dirty[0]&1025&&i!==void 0&&v.length>0){const X=P();e(14,h=v.findIndex(Ct=>Ct.value===X))}r.$$.dirty[0]&6656&&m&&y&&b&&(e(12,y.style.width=`${b.offsetWidth}px`,y),e(12,y.style.top=`${b.offsetTop+b.offsetHeight+6}px`,y))},z(),[i,s,o,l,c,f,d,w,u,m,v,b,y,p,h,$,n,P,N,j,x,I,_,st,a,ot,G,ft,O,T,lt]}class mo extends Mt{constructor(t){super(),Lt(this,t,po,ho,Bt,{items:24,value:0,placeholder:1,label:2,disabled:3,searchable:4,clearable:5,showChevron:6,name:7,containerStyles:8},null,[-1,-1])}}class yr extends F.Modal{constructor(t,e,n,a="draft"){super(t),this.name=e,this.onConfirm=n,this.type=a}onOpen(){const{contentEl:t}=this;t.addClass("wa-centered-modal");const e=this.type==="chapter"?"chapter":"draft";t.createEl("h3",{text:`Delete ${e} '${this.name}'?`}),this.type==="draft"&&t.createEl("p",{text:"This will create a backup copy before deleting."});const n=t.createDiv({cls:"modal-button-row wa-button-group"}),a=n.createEl("button",{text:"Delete",cls:"mod-cta wa-button"}),i=n.createEl("button",{text:"Cancel",cls:"wa-button"});a.onclick=async()=>{this.close(),await this.onConfirm()},i.onclick=()=>{this.close()}}}class go extends F.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:`Duplicate Draft: ${this.props.sourceDraftName}`});let e="";new F.Setting(t).setName("New draft name").addText(n=>n.setPlaceholder(this.props.suggestedName).setValue(this.props.suggestedName).onChange(a=>e=a)),new F.Setting(t).addButton(n=>n.setButtonText("Duplicate").setCta().onClick(()=>{this.close();const a=e&&e.trim()?e.trim():this.props.suggestedName;this.props.onSubmit(a)}))}onClose(){this.contentEl.empty()}}class wo extends F.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Chapter"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New chapter name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new chapter name",cls:"wa-rename-input",attr:{"aria-label":"New chapter name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n,a;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Chapter name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}this.errorEl&&(this.errorEl.style.display="none"),this.onSubmit(t),this.close()}}class bo extends F.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var s;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Draft"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("label",{cls:"wa-rename-checkbox-label"});this.checkboxEl=n.createEl("input",{type:"checkbox",attr:{checked:"checked"}}),n.appendText(" Also rename the main draft file (filename)");const a=t.createEl("div",{cls:"wa-rename-btn-row"}),i=a.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=a.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var o,l;(o=this.inputEl)==null||o.focus(),(l=this.inputEl)==null||l.select()},0),(s=this.inputEl)==null||s.addEventListener("keydown",o=>{o.key==="Enter"?this.submit():o.key==="Escape"&&this.close()}),i.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var n,a,i;const t=(n=this.inputEl)==null?void 0:n.value.trim(),e=this.checkboxEl?this.checkboxEl.checked:!1;if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(i=this.inputEl)==null||i.focus();return}this.errorEl&&(this.errorEl.style.display="none"),this.onSubmit(t,e),this.close()}}function ka(r){const t=r-1;return t*t*t+1}function vo(r,{from:t,to:e},n={}){const a=getComputedStyle(r),i=a.transform==="none"?"":a.transform,[s,o]=a.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*s/e.width-(e.left+s),c=t.top+t.height*o/e.height-(e.top+o),{delay:f=0,duration:d=u=>Math.sqrt(u)*120,easing:w=ka}=n;return{delay:f,duration:tn(d)?d(Math.sqrt(l*l+c*c)):d,easing:w,css:(u,m)=>{const p=m*l,v=m*c,h=u+m*t.width/e.width,b=u+m*t.height/e.height;return`transform: ${i} translate(${p}px, ${v}px) scale(${h}, ${b});`}}}function kr(r,t,e){const n=r.slice();return n[64]=t[e],n[66]=e,n}function $r(r,t,e){const n=r.slice();return n[67]=t[e],n}function _o(r){let t,e;return t=new _a({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function yo(r){let t;return{c(){t=It("New Project")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Sr(r){let t;return{c(){t=ct("div"),t.textContent="No projects found.",et(t,"class","wa-muted"),ve(t,"margin","4rem auto 0"),ve(t,"font-size","18px"),ve(t,"width","fit-content")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Cr(r){let t,e,n,a,i,s;return i=new mo({props:{name:"wa-project-select",value:r[3],items:r[7],placeholder:"Choose a project...",showChevron:!0,disabled:Zo,clearable:!1,searchable:!1}}),i.$on("select",r[41]),{c(){t=ct("div"),e=ct("label"),e.textContent="Select project",n=mt(),a=ct("div"),ht(i.$$.fragment),et(e,"for","wa-project-select"),et(a,"class","wa-row"),ve(t,"margin","20px 0")},m(o,l){gt(o,t,l),rt(t,e),rt(t,n),rt(t,a),ut(i,a,null),s=!0},p(o,l){const c={};l[0]&8&&(c.value=o[3]),l[0]&128&&(c.items=o[7]),i.$set(c)},i(o){s||(K(i.$$.fragment,o),s=!0)},o(o){Q(i.$$.fragment,o),s=!1},d(o){o&&pt(t),dt(i)}}}function xr(r){let t,e,n,a,i,s,o,l,c,f,d,w,u,m,p,v;o=new se({props:{ariaLabel:"Toggle draft sort order",title:void 0,clickHandler:r[42],$$slots:{default:[So]},$$scope:{ctx:r}}}),f=new we({props:{title:"New draft",clickHandler:r[23],variant:"primary",$$slots:{default:[Co]},$$scope:{ctx:r}}}),w=new se({props:{ariaLabel:"Refresh drafts",title:void 0,clickHandler:r[20],disabled:r[8],spinning:r[8],$$slots:{default:[xo]},$$scope:{ctx:r}}});let h=r[9]&&Fr(r),b=r[5].length===0&&Er(),y=r[5].length>0&&Dr(r);return{c(){t=ct("div"),e=ct("div"),n=ct("div"),a=ct("div"),i=ct("div"),i.textContent="Drafts",s=mt(),ht(o.$$.fragment),l=mt(),c=ct("div"),ht(f.$$.fragment),d=mt(),ht(w.$$.fragment),u=mt(),h&&h.c(),m=mt(),b&&b.c(),p=mt(),y&&y.c(),et(i,"class","wa-title"),et(a,"class","wa-button-group"),et(c,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","draft-controls"),ve(t,"margin-top","16px")},m($,k){gt($,t,k),rt(t,e),rt(e,n),rt(n,a),rt(a,i),rt(a,s),ut(o,a,null),rt(n,l),rt(n,c),ut(f,c,null),rt(c,d),ut(w,c,null),rt(t,u),h&&h.m(t,null),rt(t,m),b&&b.m(t,null),rt(t,p),y&&y.m(t,null),v=!0},p($,k){const D={};k[0]&2048&&(D.clickHandler=$[42]),k[0]&2048|k[2]&256&&(D.$$scope={dirty:k,ctx:$}),o.$set(D);const P={};k[2]&256&&(P.$$scope={dirty:k,ctx:$}),f.$set(P);const z={};k[0]&256&&(z.disabled=$[8]),k[0]&256&&(z.spinning=$[8]),k[2]&256&&(z.$$scope={dirty:k,ctx:$}),w.$set(z),$[9]?h?(h.p($,k),k[0]&512&&K(h,1)):(h=Fr($),h.c(),K(h,1),h.m(t,m)):h&&(Zt(),Q(h,1,1,()=>{h=null}),Gt()),$[5].length===0?b||(b=Er(),b.c(),b.m(t,p)):b&&(b.d(1),b=null),$[5].length>0?y?(y.p($,k),k[0]&32&&K(y,1)):(y=Dr($),y.c(),K(y,1),y.m(t,null)):y&&(Zt(),Q(y,1,1,()=>{y=null}),Gt())},i($){v||(K(o.$$.fragment,$),K(f.$$.fragment,$),K(w.$$.fragment,$),K(h),K(y),v=!0)},o($){Q(o.$$.fragment,$),Q(f.$$.fragment,$),Q(w.$$.fragment,$),Q(h),Q(y),v=!1},d($){$&&pt(t),dt(o),dt(f),dt(w),h&&h.d(),b&&b.d(),y&&y.d()}}}function ko(r){let t,e;return t=new ga({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function $o(r){let t,e;return t=new wa({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function So(r){let t,e,n,a;const i=[$o,ko],s=[];function o(l,c){return l[11]?0:1}return t=o(r),e=s[t]=i[t](r),{c(){e.c(),n=vn()},m(l,c){s[t].m(l,c),gt(l,n,c),a=!0},p(l,c){let f=t;t=o(l),t!==f&&(Zt(),Q(s[f],1,1,()=>{s[f]=null}),Gt(),e=s[t],e||(e=s[t]=i[t](l),e.c()),K(e,1),e.m(n.parentNode,n))},i(l){a||(K(e),a=!0)},o(l){Q(e),a=!1},d(l){l&&pt(n),s[t].d(l)}}}function Co(r){let t;return{c(){t=It("New Draft")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function xo(r){let t,e;return t=new _a({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Fr(r){let t,e,n,a,i,s,o,l,c;return a=new we({props:{clickHandler:r[22],variant:"primary",$$slots:{default:[Fo]},$$scope:{ctx:r}}}),s=new we({props:{clickHandler:r[44],$$slots:{default:[Eo]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("input"),n=mt(),ht(a.$$.fragment),i=mt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Draft name"),et(t,"class","create-inline wa-row")},m(f,d){gt(f,t,d),rt(t,e),hn(e,r[10]),rt(t,n),ut(a,t,null),rt(t,i),ut(s,t,null),o=!0,l||(c=fe(e,"input",r[43]),l=!0)},p(f,d){d[0]&1024&&e.value!==f[10]&&hn(e,f[10]);const w={};d[2]&256&&(w.$$scope={dirty:d,ctx:f}),a.$set(w);const u={};d[0]&1536&&(u.clickHandler=f[44]),d[2]&256&&(u.$$scope={dirty:d,ctx:f}),s.$set(u)},i(f){o||(K(a.$$.fragment,f),K(s.$$.fragment,f),o=!0)},o(f){Q(a.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&pt(t),dt(a),dt(s),l=!1,c()}}}function Fo(r){let t;return{c(){t=It("Create")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Eo(r){let t;return{c(){t=It("Cancel")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Er(r){let t;return{c(){t=ct("div"),t.textContent="No drafts found."},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Dr(r){let t,e,n=_e(r[5]),a=[];for(let s=0;s<n.length;s+=1)a[s]=Ar($r(r,n,s));const i=s=>Q(a[s],1,1,()=>{a[s]=null});return{c(){t=ct("div");for(let s=0;s<a.length;s+=1)a[s].c();et(t,"class","wa-draft-list")},m(s,o){gt(s,t,o);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(t,null);e=!0},p(s,o){if(o[0]&251662368|o[1]&8){n=_e(s[5]);let l;for(l=0;l<n.length;l+=1){const c=$r(s,n,l);a[l]?(a[l].p(c,o),K(a[l],1)):(a[l]=Ar(c),a[l].c(),K(a[l],1),a[l].m(t,null))}for(Zt(),l=n.length;l<a.length;l+=1)i(l);Gt()}},i(s){if(!e){for(let o=0;o<n.length;o+=1)K(a[o]);e=!0}},o(s){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)Q(a[o]);e=!1},d(s){s&&pt(t),Kr(a,s)}}}function Pr(r){let t;return{c(){t=ct("span"),t.textContent="●",et(t,"class","wa-draft-active-indicator"),et(t,"title","Active draft")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Do(r){let t,e;return t=new ba({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Nr(r){let t,e;function n(){return r[46](r[67])}return t=new se({props:{ariaLabel:"Set active draft",title:void 0,clickHandler:n,$$slots:{default:[Po]},$$scope:{ctx:r}}}),{c(){ht(t.$$.fragment)},m(a,i){ut(t,a,i),e=!0},p(a,i){r=a;const s={};i[0]&32&&(s.clickHandler=n),i[2]&256&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(a){e||(K(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function Po(r){let t,e;return t=new Rs({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function No(r){let t,e;return t=new va({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ao(r){let t,e;return t=new Vs({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function jo(r){let t,e;return t=new ya({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ar(r){let t,e,n,a=r[67]+"",i,s,o,l,c,f,d,w,u,m,p,v,h,b,y=r[12]===r[67]&&Pr();function $(){return r[45](r[67])}l=new se({props:{ariaLabel:"Open draft",title:void 0,clickHandler:$,$$slots:{default:[Do]},$$scope:{ctx:r}}});let k=r[12]!==r[67]&&Nr(r);function D(){return r[47](r[67])}d=new se({props:{ariaLabel:"Rename draft",title:void 0,clickHandler:D,$$slots:{default:[No]},$$scope:{ctx:r}}});function P(){return r[48](r[67])}u=new se({props:{ariaLabel:"Duplicate draft",title:void 0,clickHandler:P,$$slots:{default:[Ao]},$$scope:{ctx:r}}});function z(){return r[49](r[67])}return p=new se({props:{ariaLabel:"Delete draft",title:void 0,clickHandler:z,$$slots:{default:[jo]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("div"),y&&y.c(),n=mt(),i=It(a),s=mt(),o=ct("div"),ht(l.$$.fragment),c=mt(),k&&k.c(),f=mt(),ht(d.$$.fragment),w=mt(),ht(u.$$.fragment),m=mt(),ht(p.$$.fragment),v=mt(),et(e,"class","wa-draft-name wa-row"),et(o,"class","wa-draft-actions"),et(t,"class",h="wa-draft-item "+(r[12]===r[67]?"active":""))},m(N,j){gt(N,t,j),rt(t,e),y&&y.m(e,null),rt(e,n),rt(e,i),rt(t,s),rt(t,o),ut(l,o,null),rt(o,c),k&&k.m(o,null),rt(o,f),ut(d,o,null),rt(o,w),ut(u,o,null),rt(o,m),ut(p,o,null),rt(t,v),b=!0},p(N,j){r=N,r[12]===r[67]?y||(y=Pr(),y.c(),y.m(e,n)):y&&(y.d(1),y=null),(!b||j[0]&32)&&a!==(a=r[67]+"")&&He(i,a);const q={};j[0]&32&&(q.clickHandler=$),j[2]&256&&(q.$$scope={dirty:j,ctx:r}),l.$set(q),r[12]!==r[67]?k?(k.p(r,j),j[0]&4128&&K(k,1)):(k=Nr(r),k.c(),K(k,1),k.m(o,f)):k&&(Zt(),Q(k,1,1,()=>{k=null}),Gt());const x={};j[0]&32&&(x.clickHandler=D),j[2]&256&&(x.$$scope={dirty:j,ctx:r}),d.$set(x);const I={};j[0]&32&&(I.clickHandler=P),j[2]&256&&(I.$$scope={dirty:j,ctx:r}),u.$set(I);const _={};j[0]&32&&(_.clickHandler=z),j[2]&256&&(_.$$scope={dirty:j,ctx:r}),p.$set(_),(!b||j[0]&4128&&h!==(h="wa-draft-item "+(r[12]===r[67]?"active":"")))&&et(t,"class",h)},i(N){b||(K(l.$$.fragment,N),K(k),K(d.$$.fragment,N),K(u.$$.fragment,N),K(p.$$.fragment,N),b=!0)},o(N){Q(l.$$.fragment,N),Q(k),Q(d.$$.fragment,N),Q(u.$$.fragment,N),Q(p.$$.fragment,N),b=!1},d(N){N&&pt(t),y&&y.d(),dt(l),k&&k.d(),dt(d),dt(u),dt(p)}}}function jr(r){let t,e,n,a,i,s,o,l,c,f,d,w;o=new we({props:{clickHandler:r[50],variant:"primary",$$slots:{default:[To]},$$scope:{ctx:r}}});let u=r[15]&&Tr(r);const m=[Io,zo,Ro],p=[];function v(h,b){return h[14]?0:h[13].length===0?1:2}return f=v(r),d=p[f]=m[f](r),{c(){t=ct("div"),e=ct("div"),n=ct("div"),a=ct("div"),a.textContent="Chapters",i=mt(),s=ct("div"),ht(o.$$.fragment),l=mt(),u&&u.c(),c=mt(),d.c(),et(a,"class","wa-title"),et(s,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","chapter-controls"),ve(t,"margin-top","18px")},m(h,b){gt(h,t,b),rt(t,e),rt(e,n),rt(n,a),rt(n,i),rt(n,s),ut(o,s,null),rt(t,l),u&&u.m(t,null),rt(t,c),p[f].m(t,null),w=!0},p(h,b){const y={};b[0]&32768&&(y.clickHandler=h[50]),b[2]&256&&(y.$$scope={dirty:b,ctx:h}),o.$set(y),h[15]?u?(u.p(h,b),b[0]&32768&&K(u,1)):(u=Tr(h),u.c(),K(u,1),u.m(t,c)):u&&(Zt(),Q(u,1,1,()=>{u=null}),Gt());let $=f;f=v(h),f===$?p[f].p(h,b):(Zt(),Q(p[$],1,1,()=>{p[$]=null}),Gt(),d=p[f],d?d.p(h,b):(d=p[f]=m[f](h),d.c()),K(d,1),d.m(t,null))},i(h){w||(K(o.$$.fragment,h),K(u),K(d),w=!0)},o(h){Q(o.$$.fragment,h),Q(u),Q(d),w=!1},d(h){h&&pt(t),dt(o),u&&u.d(),p[f].d()}}}function To(r){let t;return{c(){t=It("New Chapter")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Tr(r){let t,e,n,a,i,s,o,l,c;return a=new we({props:{clickHandler:r[52],variant:"primary",$$slots:{default:[Oo]},$$scope:{ctx:r}}}),s=new we({props:{clickHandler:r[53],$$slots:{default:[Bo]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("input"),n=mt(),ht(a.$$.fragment),i=mt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Chapter name"),et(t,"class","create-inline wa-row")},m(f,d){gt(f,t,d),rt(t,e),hn(e,r[16]),rt(t,n),ut(a,t,null),rt(t,i),ut(s,t,null),o=!0,l||(c=fe(e,"input",r[51]),l=!0)},p(f,d){d[0]&65536&&e.value!==f[16]&&hn(e,f[16]);const w={};d[0]&229393&&(w.clickHandler=f[52]),d[2]&256&&(w.$$scope={dirty:d,ctx:f}),a.$set(w);const u={};d[0]&229376&&(u.clickHandler=f[53]),d[2]&256&&(u.$$scope={dirty:d,ctx:f}),s.$set(u)},i(f){o||(K(a.$$.fragment,f),K(s.$$.fragment,f),o=!0)},o(f){Q(a.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&pt(t),dt(a),dt(s),l=!1,c()}}}function Oo(r){let t;return{c(){t=It("Create")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Bo(r){let t;return{c(){t=It("Cancel")},m(e,n){gt(e,t,n)},d(e){e&&pt(t)}}}function Ro(r){let t,e=[],n=new Map,a,i=_e(r[13]);const s=o=>o[64].chapterName;for(let o=0;o<i.length;o+=1){let l=kr(r,i,o),c=s(l);n.set(c,e[o]=Or(c,l))}return{c(){t=ct("div");for(let o=0;o<e.length;o+=1)e[o].c();et(t,"class","wa-draft-list")},m(o,l){gt(o,t,l);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);a=!0},p(o,l){if(l[0]&1610620928|l[1]&7){i=_e(o[13]),Zt();for(let c=0;c<e.length;c+=1)e[c].r();e=Jr(e,l,s,1,o,i,n,t,Di,Or,null,kr);for(let c=0;c<e.length;c+=1)e[c].a();Gt()}},i(o){if(!a){for(let l=0;l<i.length;l+=1)K(e[l]);a=!0}},o(o){for(let l=0;l<e.length;l+=1)Q(e[l]);a=!1},d(o){o&&pt(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function zo(r){let t;return{c(){t=ct("div"),t.textContent="No chapters found.",ve(t,"margin-top","1em")},m(e,n){gt(e,t,n)},p:Et,i:Et,o:Et,d(e){e&&pt(t)}}}function Io(r){let t;return{c(){t=ct("div"),t.textContent="Loading chapters..."},m(e,n){gt(e,t,n)},p:Et,i:Et,o:Et,d(e){e&&pt(t)}}}function Lo(r){let t,e;return t=new wa({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Mo(r){let t,e;return t=new ga({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Uo(r){let t,e;return t=new ba({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Wo(r){let t,e;return t=new va({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ho(r){let t,e;return t=new ya({props:{size:Se}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(K(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Or(r,t){let e,n,a=t[64].chapterName+"",i,s,o,l,c,f,d,w,u,m,p,v,h,b,y=Et,$;function k(){return t[54](t[66])}l=new we({props:{title:"Move chapter up",clickHandler:k,disabled:t[66]===0,$$slots:{default:[Lo]},$$scope:{ctx:t}}});function D(){return t[55](t[66])}f=new we({props:{title:"Move chapter down",clickHandler:D,disabled:t[66]===t[13].length-1,$$slots:{default:[Mo]},$$scope:{ctx:t}}});function P(){return t[56](t[64])}w=new se({props:{ariaLabel:"Open chapter",title:void 0,clickHandler:P,$$slots:{default:[Uo]},$$scope:{ctx:t}}});function z(){return t[57](t[64])}m=new se({props:{ariaLabel:"Rename chapter",title:void 0,clickHandler:z,$$slots:{default:[Wo]},$$scope:{ctx:t}}});function N(){return t[58](t[64])}return v=new se({props:{ariaLabel:"Delete chapter",title:void 0,clickHandler:N,$$slots:{default:[Ho]},$$scope:{ctx:t}}}),{key:r,first:null,c(){e=ct("div"),n=ct("div"),i=It(a),s=mt(),o=ct("div"),ht(l.$$.fragment),c=mt(),ht(f.$$.fragment),d=mt(),ht(w.$$.fragment),u=mt(),ht(m.$$.fragment),p=mt(),ht(v.$$.fragment),h=mt(),et(n,"class","wa-draft-name"),et(o,"class","wa-draft-actions"),et(e,"class","wa-draft-item"),this.first=e},m(j,q){gt(j,e,q),rt(e,n),rt(n,i),rt(e,s),rt(e,o),ut(l,o,null),rt(o,c),ut(f,o,null),rt(o,d),ut(w,o,null),rt(o,u),ut(m,o,null),rt(o,p),ut(v,o,null),rt(e,h),$=!0},p(j,q){t=j,(!$||q[0]&8192)&&a!==(a=t[64].chapterName+"")&&He(i,a);const x={};q[0]&8192&&(x.clickHandler=k),q[0]&8192&&(x.disabled=t[66]===0),q[2]&256&&(x.$$scope={dirty:q,ctx:t}),l.$set(x);const I={};q[0]&8192&&(I.clickHandler=D),q[0]&8192&&(I.disabled=t[66]===t[13].length-1),q[2]&256&&(I.$$scope={dirty:q,ctx:t}),f.$set(I);const _={};q[0]&8192&&(_.clickHandler=P),q[2]&256&&(_.$$scope={dirty:q,ctx:t}),w.$set(_);const W={};q[0]&8192&&(W.clickHandler=z),q[2]&256&&(W.$$scope={dirty:q,ctx:t}),m.$set(W);const st={};q[0]&8192&&(st.clickHandler=N),q[2]&256&&(st.$$scope={dirty:q,ctx:t}),v.$set(st)},r(){b=e.getBoundingClientRect()},f(){vi(e),y()},a(){y(),y=bi(e,b,vo,{duration:500,easing:ka})},i(j){$||(K(l.$$.fragment,j),K(f.$$.fragment,j),K(w.$$.fragment,j),K(m.$$.fragment,j),K(v.$$.fragment,j),$=!0)},o(j){Q(l.$$.fragment,j),Q(f.$$.fragment,j),Q(w.$$.fragment,j),Q(m.$$.fragment,j),Q(v.$$.fragment,j),$=!1},d(j){j&&pt(e),dt(l),dt(f),dt(w),dt(m),dt(v)}}}function Vo(r){var y;let t,e,n,a,i,s,o,l,c,f,d,w,u,m;s=new se({props:{ariaLabel:"Refresh projects",clickHandler:r[40],title:void 0,spinning:r[6],$$slots:{default:[_o]},$$scope:{ctx:r}}}),c=new we({props:{title:"Create New Project",clickHandler:r[35],variant:"primary",style:"width: 40%; margin: 0 auto;",$$slots:{default:[yo]},$$scope:{ctx:r}}});let p=r[2].length===0&&Sr(),v=r[2].length>0&&Cr(r),h=r[4]&&xr(r),b=r[4]&&((y=r[0])==null?void 0:y.activeDraft)&&r[18]&&jr(r);return{c(){t=ct("div"),e=ct("div"),n=ct("div"),n.textContent=`${Ft} Projects`,a=mt(),i=ct("div"),ht(s.$$.fragment),o=mt(),l=ct("div"),ht(c.$$.fragment),f=mt(),p&&p.c(),d=mt(),v&&v.c(),w=mt(),h&&h.c(),u=mt(),b&&b.c(),et(n,"class","wa-title"),et(e,"class","wa-row justify-between"),et(l,"class","wa-row"),ve(l,"margin","18px 0 10px 0"),et(t,"class","project-list wa-panel")},m($,k){gt($,t,k),rt(t,e),rt(e,n),rt(e,a),rt(e,i),ut(s,i,null),rt(t,o),rt(t,l),ut(c,l,null),rt(t,f),p&&p.m(t,null),rt(t,d),v&&v.m(t,null),rt(t,w),h&&h.m(t,null),rt(t,u),b&&b.m(t,null),m=!0},p($,k){var z;const D={};k[0]&64&&(D.spinning=$[6]),k[2]&256&&(D.$$scope={dirty:k,ctx:$}),s.$set(D);const P={};k[2]&256&&(P.$$scope={dirty:k,ctx:$}),c.$set(P),$[2].length===0?p||(p=Sr(),p.c(),p.m(t,d)):p&&(p.d(1),p=null),$[2].length>0?v?(v.p($,k),k[0]&4&&K(v,1)):(v=Cr($),v.c(),K(v,1),v.m(t,w)):v&&(Zt(),Q(v,1,1,()=>{v=null}),Gt()),$[4]?h?(h.p($,k),k[0]&16&&K(h,1)):(h=xr($),h.c(),K(h,1),h.m(t,u)):h&&(Zt(),Q(h,1,1,()=>{h=null}),Gt()),$[4]&&((z=$[0])!=null&&z.activeDraft)&&$[18]?b?(b.p($,k),k[0]&262161&&K(b,1)):(b=jr($),b.c(),K(b,1),b.m(t,null)):b&&(Zt(),Q(b,1,1,()=>{b=null}),Gt())},i($){m||(K(s.$$.fragment,$),K(c.$$.fragment,$),K(v),K(h),K(b),m=!0)},o($){Q(s.$$.fragment,$),Q(c.$$.fragment,$),Q(v),Q(h),Q(b),m=!1},d($){$&&pt(t),dt(s),dt(c),p&&p.d(),v&&v.d(),h&&h.d(),b&&b.d()}}}let Zo=!1,Go="";const Se=20;let Yo=null;function Ko(r,t,e){let{manager:n}=t,{projectService:a}=t,{projectFileService:i}=t,s=null,o=[],l,c=null,f=[],d=!1,w=[],u=!1,m=!1,p="",v=!0,h=null,b=null,y=[],$=!1,k=!1,D="",P="",z=!1,N=!1;On(()=>{try{n&&b&&n.removeActiveProjectListener(b)}catch{}});async function j(L=!1){if(!a)return[];e(6,d=!0);const nt=new Promise(_t=>setTimeout(_t,400)),it=[...o],kt=s;let Tt=[],$t=[];try{Tt=a.listAllFolders(),$t=[];for(const _t of Tt)await a.isProjectFolder(_t)&&$t.push(_t)}catch{$t=[]}const Wt=$t.filter(_t=>!it.includes(_t)),St=it.filter(_t=>!$t.includes(_t));if(L&&Wt.length>0&&new F.Notice(`${Wt.length} new project${Wt.length>1?"s":""} discovered.`),L&&St.length>0&&new F.Notice(`${St.length} project${St.length>1?"s":""} removed.`),e(2,o=$t),e(7,w=$t.map(_t=>({value:_t,label:_t}))),$t.length===0)e(1,s=null),e(3,l=void 0),e(4,c=null);else if($t.length===1){e(1,s=$t[0]),e(3,l=w[0]),e(4,c=$t[0]);try{R(`${B} panel refresh selected single project '${c}'`)}catch{}}else if(kt&&!$t.includes(kt)){e(1,s=$t[0]),e(3,l=w[0]),e(4,c=$t[0]);try{R(`${B} panel refresh selected fallback project '${c}'`)}catch{}}else{const _t=w.find(me=>me.value===kt);if(_t){e(1,s=kt),e(3,l=_t),e(4,c=_t.value);try{R(`${B} panel refresh kept project '${c}'`)}catch{}}else e(1,s=null),e(3,l=void 0),e(4,c=null)}return await nt,e(6,d=!1),c&&await q(),$t}async function q(){if(!i||!c){e(5,f=[]);return}e(8,u=!0);const L=new Promise(nt=>setTimeout(nt,400));try{e(5,f=i.drafts.listDrafts(c)||[]),e(5,f=Array.from(f)),f.sort((nt,it)=>nt>it?1:nt<it?-1:0),v||f.reverse()}catch{e(5,f=[])}finally{await L,e(8,u=!1)}}async function x(){if(!n||!i)return;e(14,$=!0);const L=new Promise(nt=>setTimeout(nt,400));try{if(!c){e(13,y=[]),e(18,z=!1);return}const nt=`${c}/${ie(n==null?void 0:n.settings)}`,it=await De(n.app,nt);if(e(18,z=(it==null?void 0:it.project_type)==="multi-file"),!z){e(13,y=[]);return}if(!(n!=null&&n.activeDraft)){e(13,y=[]);return}let kt=[];kt=await i.chapters.listChapters(c,n.activeDraft),e(13,y=Array.isArray(kt)?kt:[])}catch{e(13,y=[]),e(18,z=!1)}finally{await L,e(14,$=!1)}}async function I(){if(!(!i||!c||!p.trim())){try{await i.drafts.createDraft(p.trim(),Go||void 0,c)}catch{}e(10,p=""),e(9,m=!1),await q()}}async function _(){e(9,m=!0)}async function W(L){if(!i||!n||!c)return;let nt=!1;nt=await i.drafts.openDraft(c,L),nt||n!=null&&n.setActiveDraft&&await n.setActiveDraft(L,c),await q(),await x()}async function st(L){if(!n||!c)return;const nt=`${L} Copy`;new go(n.app,{sourceDraftName:L,suggestedName:nt,onSubmit:async it=>{if(n)try{await n.createNewDraft(it,L,c||void 0),await q(),new F.Notice(`Draft '${it}' created as duplicate of '${L}'.`)}catch(kt){R(`${B} Failed to duplicate draft:`,kt),new F.Notice("Failed to duplicate draft.")}}}).open()}async function V(L){if(!n||!c)return;new bo(n.app,L,async(it,kt)=>{try{R(`${B} renameDraft: user entered: ${it}, renameFile: ${kt}`),await n.renameDraft(L,it,c||void 0,kt),R(`${B} renameDraft: rename successful, refreshing drafts`),await q(),new F.Notice(`Draft '${L}' renamed to '${it}'.`)}catch(Tt){R(`${B} renameDraft: error:`,Tt),new F.Notice("Failed to rename draft.")}}).open()}async function ot(L){if(!n||!c)return;new yr(n.app,L,async()=>{n&&(await n.deleteDraft(L,c||void 0),await q())},"draft").open()}async function G(L){L&&(n!=null&&n.setActiveProject&&await n.setActiveProject(L),e(1,s=L),e(4,c=L),e(12,h=(n==null?void 0:n.activeDraft)??null),await q(),await x())}async function ft(L){if(L===0||!n||!c||!n.activeDraft)return;const nt=y.slice();[nt[L-1],nt[L]]=[nt[L],nt[L-1]];const it=nt.map((kt,Tt)=>({chapterName:kt.chapterName||"",order:Tt+1}));await n.reorderChapters(c,n.activeDraft,it),await x()}async function O(L){if(L===y.length-1||!n||!c||!n.activeDraft)return;const nt=y.slice();[nt[L],nt[L+1]]=[nt[L+1],nt[L]];const it=nt.map((kt,Tt)=>({chapterName:kt.chapterName||"",order:Tt+1}));await n.reorderChapters(c,n.activeDraft,it),await x()}async function T(L){!c||!(n!=null&&n.activeDraft)||await n.openChapter(c,n.activeDraft,L)}function lt(L){if(!c||!(n!=null&&n.activeDraft))return;new wo(n.app,L,async it=>{!(n!=null&&n.activeDraft)||!c||(await n.renameChapter(c,n.activeDraft,L,it),await x())}).open()}function U(L){new yr(n.app,L,async()=>{!(n!=null&&n.activeDraft)||!c||(await n.deleteChapter(c,n.activeDraft,L),await x())},"chapter").open()}async function X(L){c&&(n!=null&&n.setActiveDraft&&await n.setActiveDraft(L,c),e(12,h=(n==null?void 0:n.activeDraft)??null),await q(),await x())}async function Ct(){if(!n||!a)return;const L=n.app,{CreateProjectModal:nt}=await Promise.resolve().then(()=>nl);let it=null;new nt(L,async(Tt,$t,Wt)=>{if(!Tt||!n||!a||(it=await a.createProject(Tt,$t,Wt,void 0,n.settings),!it))return;let St=[],_t=null;for(let me=0;me<20;me++){await new Promise(Pe=>setTimeout(Pe,100)),St=await j();const te=St.find(Pe=>Pe===it);if(_t=typeof te=="string"?te:null,_t)break}typeof _t=="string"&&_t&&(e(1,s=_t),e(3,l={value:_t,label:_t}),e(4,c=_t),n.setActiveDraft?await n.setActiveDraft(_t,Wt):e(0,n.activeDraft=Wt??null,n),await q(),await x())}).open()}On(()=>{zt(()=>{n&&n.removeActiveDraftListener}),zt(()=>{n&&typeof n.removeActiveProjectListener=="function"&&b&&n.removeActiveProjectListener(b)})});const Nt=()=>j(!0),wt=L=>{const nt=L.detail;e(3,l=nt),e(4,c=typeof nt=="string"?nt:nt?nt.value:void 0),e(1,s=c??null),G(c??null)},yt=()=>{e(11,v=!v),q()};function At(){p=this.value,e(10,p)}const Dt=()=>{e(9,m=!1),e(10,p="")},Qt=L=>W(L),Ut=L=>X(L),g=L=>V(L),H=L=>st(L),M=L=>ot(L),C=()=>e(15,k=!k);function S(){D=this.value,e(16,D)}const E=async()=>{!c||!(n!=null&&n.activeDraft)||!D.trim()||(await n.createChapter(c,n.activeDraft,D.trim()),e(16,D=""),e(17,P=""),e(15,k=!1),await x())},Z=()=>{e(15,k=!1),e(16,D=""),e(17,P="")},Y=L=>ft(L),A=L=>O(L),J=L=>T(L.name),at=L=>lt(L.chapterName||""),tt=L=>U(L.chapterName||"");return r.$$set=L=>{"manager"in L&&e(0,n=L.manager),"projectService"in L&&e(36,a=L.projectService),"projectFileService"in L&&e(37,i=L.projectFileService)},r.$$.update=()=>{if(r.$$.dirty[0]&1|r.$$.dirty[1]&480&&n&&a&&i&&!N){e(39,N=!0),R(`${B} ProjectPanel initializing with manager`),e(12,h=n.activeDraft??null),e(1,s=n.activeProject??null);const L=nt=>{e(12,h=nt),R(`${B} active draft updated -> ${nt}`),x()};n.addActiveDraftListener(L),e(38,b=nt=>{e(1,s=nt),R(`${B} active project updated -> ${nt}`),nt?j():(e(3,l=void 0),e(4,c=null),e(5,f=[]),e(13,y=[]),e(18,z=!1))}),n.addActiveProjectListener(b),j()}},[n,s,o,l,c,f,d,w,u,m,p,v,h,y,$,k,D,P,z,j,q,x,I,_,W,st,V,ot,G,ft,O,T,lt,U,X,Ct,a,i,b,N,Nt,wt,yt,At,Dt,Qt,Ut,g,H,M,C,S,E,Z,Y,A,J,at,tt]}class qo extends Mt{constructor(t){super(),Lt(this,t,Ko,Vo,Bt,{manager:0,projectService:36,projectFileService:37},null,[-1,-1,-1])}}const be="writeaid-project-panel";class Xo extends F.ItemView{constructor(t,e,n){super(t),this.panelEl=null,this.selectedProject=null,this.app=e,this.manager=n,this.projectService=new un(e),this.projectFileService=new Wn(e,this.projectService)}getViewType(){return be}getDisplayText(){return`${Ft} Projects`}getIcon(){return Ln}async onOpen(){this.panelEl=this.contentEl.createEl("div",{cls:"writeaid-project-panel"});try{if(!this.manager){R(`${B} Manager not available in ProjectPanelView.onOpen`),new F.Notice(`${Ft}: manager not available, cannot mount project panel.`);return}R(`${B} Mounting ProjectPanel with manager:`,!!this.manager),this.projectPanel=new qo({target:this.panelEl,props:{manager:this.manager,projectService:this.projectService,projectFileService:this.projectFileService}}),R(`${B} ProjectPanel mounted successfully`)}catch(t){R(`${B} failed to mount project panel:`,t),new F.Notice(`${Ft}: failed to mount project panel. Check console for details.`)}}async onClose(){if(this.projectPanel){try{this.projectPanel.$destroy()}catch(t){R(`${B} Error destroying project panel:`,t)}this.projectPanel=void 0}}}function Jo(r,t){return()=>{const e={type:be,active:!0},n=t.workspace.getLeavesOfType(be);if(n.length>0){const a=n[0];t.workspace.revealLeaf(a)}else{let a=t.workspace.getRightLeaf(!1);a||(a=t.workspace.getRightLeaf(!0)),a.setViewState(e),t.workspace.revealLeaf(a)}}}function Qo(r){return()=>r.updateProjectMetadataPrompt()}class tl extends F.Modal{constructor(t,e,n,a){super(t),this.path=e,this.onCreateAnyway=n,this.onOpenExisting=a}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project already exists"}),t.createEl("p",{text:`A folder named '${this.path}' already exists in the vault.`}),new F.Setting(t).addButton(e=>e.setButtonText("Open Existing").onClick(()=>{this.close(),this.onOpenExisting()})),new F.Setting(t).addButton(e=>e.setButtonText("Create Anyway").setCta().onClick(()=>{this.close(),this.onCreateAnyway(!0)})),new F.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}onClose(){this.contentEl.empty()}}class el extends F.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Draft"});const e=this.props.suggestedName;let n="",a="";new F.Setting(t).setName("Draft name").addText(s=>s.setPlaceholder(e).onChange(o=>n=o));const i=this.props.drafts;i.length>0&&new F.Setting(t).setName("Copy from existing draft").addDropdown(s=>{s.addOption("","Start blank");for(const o of i)s.addOption(o,o);s.onChange(o=>a=o)}),new F.Setting(t).addButton(s=>s.setButtonText("Create").setCta().onClick(()=>{this.close();const o=n&&n.trim()?n.trim():e;this.props.onSubmit(o,a||void 0)}))}onClose(){this.contentEl.empty()}}class $a extends F.Modal{constructor(t,e){super(t),this.onSubmit=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Project"});let e="",n=!0,a="Draft 1";new F.Setting(t).setName("Project folder name").addText(i=>i.onChange(s=>e=s)),new F.Setting(t).setName("Project type").addDropdown(i=>{i.addOption("single","Single-file project"),i.addOption("multi","Multi-file project (chapters)"),i.onChange(s=>n=s==="single")}),new F.Setting(t).setName("Initial draft name (optional)").addText(i=>i.setPlaceholder("Draft 1").onChange(s=>a=s||"Draft 1")),new F.Setting(t).addButton(i=>i.setButtonText("Create Project").setCta().onClick(()=>{this.close(),this.onSubmit(e,n,a||void 0)}))}onClose(){this.contentEl.empty()}}const nl=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectModal:$a},Symbol.toStringTag,{value:"Module"}));class Br extends F.Modal{constructor(t,e,n){super(t),this.projectPath=e,this.onOpenProject=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project created"}),t.createEl("p",{text:`Project '${this.projectPath}' was created.`}),new F.Setting(t).addButton(e=>e.setButtonText("Open Project").setCta().onClick(async()=>{this.close(),this.onOpenProject&&await this.onOpenProject()})),new F.Setting(t).addButton(e=>e.setButtonText("Close").onClick(()=>this.close()))}onClose(){this.contentEl.empty()}}class Pn extends F.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Select Project for Draft"});let e="";const n=this.props.folders||[];new F.Setting(t).setName("Project folder").addDropdown(a=>{a.addOption("","(Vault root)");for(const i of n)a.addOption(i,i||"(Vault root)");a.onChange(i=>e=i)}),new F.Setting(t).addButton(a=>a.setButtonText("Select").setCta().onClick(()=>{this.close(),this.props.onSubmit(e||"")}))}onClose(){this.contentEl.empty()}}class rl extends F.Modal{constructor(t,e,n){super(t),this.drafts=e,this.onSubmit=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Switch Active Draft"});for(const e of this.drafts)new F.Setting(t).setName(e).addButton(n=>n.setButtonText("Select").onClick(()=>{this.close(),this.onSubmit(e)}))}onClose(){this.contentEl.empty()}}class al{constructor(t,e,n){var a;this.activeDraft=null,this.activeProject=null,this.activeProjectListeners=[],this.activeDraftListeners=[],this.panelRefreshListeners=[],this._panelRefreshTimer=null,this._panelRefreshDebounceMs=250,this.app=t,this.plugin=e,this.settings=e==null?void 0:e.settings,typeof n=="number"&&Number.isFinite(n)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(n))),this.activeProject=((a=this.settings)==null?void 0:a.activeProject)||null,this.projectService=new un(t),this.projectFileService=new Wn(t,this.projectService,this.settings)}async reorderChapters(t,e,n){return await this.projectFileService.chapters.reorderChapters(t,e,n)}async listChapters(t,e){return await this.projectFileService.chapters.listChapters(t,e)}async createChapter(t,e,n){return await this.projectFileService.chapters.createChapter(t,e,n,this.settings)}async deleteChapter(t,e,n){return await this.projectFileService.chapters.deleteChapter(t,e,n)}async renameChapter(t,e,n,a){return await this.projectFileService.chapters.renameChapter(t,e,n,a)}async openChapter(t,e,n){return await this.projectFileService.chapters.openChapter(t,e,n)}get panelRefreshDebounceMs(){return this._panelRefreshDebounceMs}set panelRefreshDebounceMs(t){typeof t=="number"&&Number.isFinite(t)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(t)))}addActiveProjectListener(t){this.activeProjectListeners.push(t)}addActiveDraftListener(t){this.activeDraftListeners.push(t)}removeActiveDraftListener(t){this.activeDraftListeners=this.activeDraftListeners.filter(e=>e!==t)}notifyActiveDraftListeners(t){for(const e of this.activeDraftListeners)zt(()=>e(t))}addPanelRefreshListener(t){this.panelRefreshListeners.push(t)}removePanelRefreshListener(t){this.panelRefreshListeners=this.panelRefreshListeners.filter(e=>e!==t)}notifyPanelRefresh(){try{this._panelRefreshTimer&&clearTimeout(this._panelRefreshTimer),this._panelRefreshTimer=setTimeout(()=>{for(const t of this.panelRefreshListeners)zt(()=>t());this._panelRefreshTimer=null},this._panelRefreshDebounceMs)}catch{for(const t of this.panelRefreshListeners)zt(()=>t())}}removeActiveProjectListener(t){this.activeProjectListeners=this.activeProjectListeners.filter(e=>e!==t)}async setActiveProject(t){t&&(t=t.trim().replace(/^\/+/,"").replace(/\/+$/,"")),R(`${B} setActiveProject called with '${t}'`),this.activeProject=t,await Ot(async()=>{if(this.plugin){const e=this.plugin;e.settings||(e.settings={}),e.settings.activeProject=t??void 0,typeof e.saveSettings=="function"&&await e.saveSettings()}});for(const e of this.activeProjectListeners)zt(()=>e(t));try{if(!t){this.activeDraft=null,this.notifyActiveDraftListeners(null);return}const e=this.listDrafts(t);if(!e||e.length===0){this.activeDraft=null;return}if(e.length===1){await this.setActiveDraft(e[0],t,!1),R(`${B} auto-selected single draft '${e[0]}' for project '${t}'`);return}await Ot(async()=>{const o=await De(this.app,`${t}/${ie(this.settings)}`);if(o&&o.current_active_draft&&e.includes(o.current_active_draft)){await this.setActiveDraft(o.current_active_draft,t,!1),R(`${B} auto-selected meta draft '${o.current_active_draft}' for project '${t}'`);return}});let n=null,a=0;const i=this.app.vault.getFiles(),s=jt(this.settings);for(const o of e){const l=`${t}/${s}/${o}/`;let c=0;for(const f of i)if(f.path.startsWith(l)){const d=f.stat&&typeof f.stat.mtime=="number"?f.stat.mtime:0;d>c&&(c=d)}c>a&&(a=c,n=o)}n||(n=e[0]),R(`${B} auto-selected draft '${n}' for project '${t}'`),await this.setActiveDraft(n,t,!1)}catch{}}async createNewProjectPrompt(){new $a(this.app,async(t,e,n,a)=>{if(!t){new F.Notice("Project name is required.");return}const i=a&&a!==""?`${a}/${t}`:t;this.app.vault.getAbstractFileByPath(i)?new tl(this.app,i,async o=>{o&&(await this.createNewProject(t,e,n,a),new Br(this.app,i,async()=>await this.openProject(i)).open())},async()=>{await this.openProject(i)}).open():(await this.createNewProject(t,e,n,a),new Br(this.app,i,async()=>await this.openProject(i)).open())}).open()}async openProject(t){return await this.projectService.openProject(t)}async createNewProject(t,e,n,a){const i=await this.projectService.createProject(t,e,n,a,this.settings);if(i){await this.setActiveProject(i);const s=n||"Draft 1";await this.setActiveDraft(s,i),zt(()=>this.notifyPanelRefresh())}return i}listAllFolders(){return this.projectService.listAllFolders()}async createNewDraftPrompt(){const t=this.listAllFolders(),e=await Be(t,n=>this.projectService.isProjectFolder(n));new Pn(this.app,{folders:e,onSubmit:async n=>{const a=await this.suggestNextDraftName(n);new el(this.app,{suggestedName:a,drafts:this.listDrafts(n),projectPath:n,onSubmit:async(i,s)=>{await this.projectFileService.drafts.createDraft(i,s,n,this.settings),new F.Notice(`Draft "${i}" created in ${n}.`)}}).open()}}).open()}async switchDraftPrompt(){const t=this.listDrafts();if(t.length===0){new F.Notice("No drafts found in the current project.");return}new rl(this.app,t,async e=>{this.activeDraft=e,new F.Notice(`Switched to draft: ${e}`);const n=this.getCurrentProjectPath();n&&await Oe(this.app,n,e,void 0,this.settings)}).open()}async updateProjectMetadataPrompt(){if(this.activeProject){await Oe(this.app,this.activeProject,void 0,void 0,this.settings),new F.Notice(`Metadata updated for ${this.activeProject}`);return}(async()=>{const t=this.listAllFolders(),e=await Be(t,n=>this.projectService.isProjectFolder(n));new Pn(this.app,{folders:e,onSubmit:async n=>{await Oe(this.app,n,void 0,void 0,this.settings),new F.Notice(`Metadata updated for ${n}`)}}).open()})()}async selectActiveProjectPrompt(){const t=this.listAllFolders(),e=await Be(t,n=>this.projectService.isProjectFolder(n));if(e.length===0){new F.Notice(`No ${Ft} projects found in the vault.`);return}new Pn(this.app,{folders:e,onSubmit:async n=>{await this.setActiveProject(n),new F.Notice(`Active project set to ${n}`)}}).open()}async createNewDraft(t,e,n){const a=await this.projectFileService.drafts.createDraft(t,e,n,this.settings);return zt(()=>this.notifyPanelRefresh()),a}listDrafts(t){return this.projectFileService.drafts.listDrafts(t)}async setActiveDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();return a?(this.activeDraft=t,await Ot(async()=>{await Oe(this.app,a,t,void 0,this.settings)}),this.notifyActiveDraftListeners(this.activeDraft),n&&new F.Notice(`Active draft set to ${t}`),!0):(n&&new F.Notice("No project selected to set active draft on."),!1)}async renameDraft(t,e,n,a=!1){const i=n||this.activeProject||this.getCurrentProjectPath();if(!i)return new F.Notice("No project selected to rename draft."),!1;const s=this.activeDraft===t;return await this.projectFileService.drafts.renameDraft(i,t,e,a,this.settings)?(s&&(this.activeDraft=e),new F.Notice(`Renamed draft ${t} → ${e}`),!0):(new F.Notice("Failed to rename draft."),!1)}async deleteDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();if(!a)return new F.Notice("No project selected to delete draft."),!1;if(await this.projectFileService.drafts.deleteDraft(a,t,n)){new F.Notice(`Deleted draft ${t}`);const s=this.listDrafts(a);if(s.length>0){if(this.activeDraft===t||!this.activeDraft){let o;if(s.length===1)o=s[0];else{const l=[...s].sort((c,f)=>c.localeCompare(f));if(this.activeDraft===t){const c=l.findIndex(f=>f===t);if(c!==-1){const f=c<l.length-1?c:0;o=l[f]}else o=l[0]}else o=this.activeDraft}await this.setActiveDraft(o,a,!1)}}else this.activeDraft=null,this.notifyActiveDraftListeners(null);return!0}return new F.Notice("Failed to delete draft."),!1}async suggestNextDraftName(t){return await this.projectFileService.drafts.suggestNextDraftName(t)}getCurrentProjectPath(){const t=this.app.workspace.getActiveFile();if(!t)return null;const e=t.parent;return e?e.path:null}}class il extends F.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,R(`${B} Settings tab created`),typeof e.registerSettingsChangedCallback=="function"&&e.registerSettingsChangedCallback(()=>{R(`${B} Settings changed externally, refreshing UI`),this.containerEl&&this.containerEl.parentElement&&this.display()})}display(){const{containerEl:t}=this;t.empty(),t.createEl("h2",{text:`${Ft} Settings`}),R(`${B} Displaying settings UI`);const e=this.plugin;t.createEl("h3",{text:"Templates"}),new F.Setting(t).setName("Include outline file on draft creation").setDesc("If enabled, each new draft will include an outline file using the outline template.").addToggle(o=>o.setValue(!!e.settings.includeDraftOutline).onChange(l=>{R(`${B} Include draft outline changed: ${l}`),e.settings.includeDraftOutline=l,e.saveSettings()})),new F.Setting(t).setName("Outline template").setDesc("Template for outline files. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{R(`${B} Opening file picker for outline template`),new Nn(this.app,l=>{R(`${B} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new F.Setting(t).setName("Outline template").setDesc("Template for outline documents. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{R(`${B} Opening file picker for outline template`),new Nn(this.app,l=>{R(`${B} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new F.Setting(t).setName("Chapter template").setDesc("Template for newly created chapter files. Use {{chapterTitle}}").addTextArea(o=>{o.setValue(e.settings.chapterTemplate||""),o.inputEl.setAttribute("data-setting","chapter")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{R(`${B} Opening file picker for chapter template`),new Nn(this.app,l=>{R(`${B} Chapter template selected: ${l}`),e.settings.chapterTemplate=l,this.display()}).open()})),new F.Setting(t).setName("Manuscript name template").setDesc("Template for manuscript filenames. Use {{draftName}}, {{projectName}}, and moment.js date qualifiers like {{YYYY-MM-DD}}").addText(o=>{o.setValue(e.settings.manuscriptNameTemplate||"{{draftName}}"),o.inputEl.setAttribute("data-setting","manuscript")}),new F.Setting(t).addButton(o=>o.setButtonText("Save Templates").setCta().onClick(async()=>{var d,w;R(`${B} Save Templates button clicked`);const l=t.querySelector('textarea[data-setting="outline"]'),c=t.querySelector('textarea[data-setting="chapter"]'),f=t.querySelector('input[data-setting="manuscript"]');R(`${B} Found inputs - outline: ${!!l}, chapter: ${!!c}, manuscript: ${!!f}`),R(`${B} Manuscript input value: "${f==null?void 0:f.value}"`),l&&(e.settings.outlineTemplate=l.value),c&&(e.settings.chapterTemplate=c.value),f&&(e.settings.manuscriptNameTemplate=f.value),R(`${B} Saving templates: outline=${(d=e.settings.outlineTemplate)==null?void 0:d.substring(0,50)}..., chapter=${(w=e.settings.chapterTemplate)==null?void 0:w.substring(0,50)}..., manuscript=${e.settings.manuscriptNameTemplate}`),await e.saveSettings(),new F.Notice("Templates saved successfully!")})),t.createEl("h3",{text:"Filenames"}),new F.Setting(t).setName("Draft filename slug style").setDesc("How per-draft main filenames are generated").addDropdown(o=>{o.addOption("compact","compact (draft1)"),o.addOption("kebab","kebab (draft-1)"),o.setValue(e.settings.slugStyle||"compact"),o.onChange(l=>{R(`${B} Slug style changed: ${l}`),e.settings.slugStyle=l,e.saveSettings();const c=t.querySelector(".wat-slug-preview");c&&(c.textContent=`Example: Draft 1 → ${ae("Draft 1",l)}${bt}`)})});let n="Draft 1";new F.Setting(t).setName("Sample draft name").setDesc("Type a sample draft name to preview the generated filename").addText(o=>o.setPlaceholder("Draft 1").setValue(n).onChange(l=>{n=l||"Draft 1";const c=t.querySelector(".wat-slug-preview");if(c){const f=ae(n,e.settings.slugStyle);c.textContent=`Example: ${n} → ${f}${bt}`}}));const a=t.createDiv({cls:"wat-slug-preview"}),i=ae(n,e.settings.slugStyle);a.setText(`Example: ${n} → ${i}${bt}`),t.createEl("h3",{text:"Folders & Files"}),new F.Setting(t).setName("Drafts folder name").setDesc("Name of the folder containing draft subfolders (default: drafts)").addText(o=>o.setValue(e.settings.draftsFolderName||"drafts").onChange(l=>{R(`${B} Drafts folder name changed: ${l}`),e.settings.draftsFolderName=l||"drafts",e.saveSettings()})),new F.Setting(t).setName("Manuscripts folder name").setDesc("Name of the folder containing generated manuscripts (default: manuscripts)").addText(o=>o.setValue(e.settings.manuscriptsFolderName||"manuscripts").onChange(l=>{R(`${B} Manuscripts folder name changed: ${l}`),e.settings.manuscriptsFolderName=l||"manuscripts",e.saveSettings()})),new F.Setting(t).setName("Backups folder name").setDesc("Name of the folder containing draft backups (default: .writeaid-backups)").addText(o=>o.setValue(e.settings.backupsFolderName||".writeaid-backups").onChange(l=>{R(`${B} Backups folder name changed: ${l}`),e.settings.backupsFolderName=l||".writeaid-backups",e.saveSettings()})),new F.Setting(t).setName("Meta file name").setDesc(`Name of the project metadata file (default: ${re.META})`).addText(o=>o.setValue(e.settings.metaFileName||re.META).onChange(l=>{R(`${B} Meta file name changed: ${l}`),e.settings.metaFileName=l||re.META,e.saveSettings()})),new F.Setting(t).setName("Outline file name").setDesc(`Name of the draft outline file (default: ${re.OUTLINE})`).addText(o=>o.setValue(e.settings.outlineFileName||re.OUTLINE).onChange(l=>{R(`${B} Outline file name changed: ${l}`),e.settings.outlineFileName=l||re.OUTLINE,e.saveSettings()})),t.createEl("h3",{text:"Word Count Targets"}),new F.Setting(t).setName("Default target word count for multi-file projects").setDesc("Target word count automatically set for new multi-file projects (chapters)").addText(o=>o.setValue(String(e.settings.defaultMultiTargetWordCount??5e4)).setPlaceholder("50000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(R(`${B} Default multi-file target word count changed: ${c}`),e.settings.defaultMultiTargetWordCount=c,e.saveSettings())})),new F.Setting(t).setName(`Default target word count for ${Vt.SINGLE} projects`).setDesc(`Target word count automatically set for new ${Vt.SINGLE} projects`).addText(o=>o.setValue(String(e.settings.defaultSingleTargetWordCount??2e4)).setPlaceholder("20000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(R(`${B} Default ${Vt.SINGLE} target word count changed: ${c}`),e.settings.defaultSingleTargetWordCount=c,e.saveSettings())})),t.createEl("h3",{text:"Backup Settings"}),new F.Setting(t).setName("Maximum number of backups per draft").setDesc("Maximum number of backup files to keep per draft (default: 5)").addText(o=>o.setValue(String(e.settings.maxBackups??5)).setPlaceholder("5").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(R(`${B} Max backups changed: ${c}`),e.settings.maxBackups=c,e.saveSettings())})),new F.Setting(t).setName("Maximum backup age (days)").setDesc("Automatically delete backups older than this many days (default: 30)").addText(o=>o.setValue(String(e.settings.maxBackupAgeDays??30)).setPlaceholder("30").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(R(`${B} Max backup age changed: ${c}`),e.settings.maxBackupAgeDays=c,e.saveSettings())})),t.createEl("h3",{text:"UI & Startup"}),t.createEl("p",{text:"Most settings take effect immediately. Settings marked with ⚠️ require a plugin reload to take effect.",cls:"setting-item-description"}),new F.Setting(t).setName("Ribbon placement").setDesc(`Place the ${Ft} icon on the left or right ribbon`).addDropdown(o=>{o.addOption("left","Left"),o.addOption("right","Right"),o.setValue(e.settings.ribbonPlacement||"left"),o.onChange(l=>{R(`${B} Ribbon placement changed: ${l}`),e.settings.ribbonPlacement=l,e.saveSettings(),typeof this.plugin.moveRibbon=="function"&&(l==="left"||l==="right")&&this.plugin.moveRibbon(l),this.display()})}),new F.Setting(t).setName("Always show ribbon").setDesc(`If enabled, the ${Ft} ribbon icon will always be visible regardless of whether projects are detected`).addToggle(o=>o.setValue(!!e.settings.ribbonAlwaysShow).onChange(l=>{R(`${B} Always show ribbon changed: ${l}`),e.settings.ribbonAlwaysShow=l,e.saveSettings(),typeof this.plugin.refreshRibbonVisibility=="function"&&this.plugin.refreshRibbonVisibility()})),new F.Setting(t).setName("Auto-open project panel on startup").setDesc(`If enabled, the ${Ft} project panel will open on plugin load when an active project is saved. ⚠️ Requires plugin reload to take effect.`).addToggle(o=>o.setValue(!!e.settings.autoOpenPanelOnStartup).onChange(l=>{R(`${B} Auto-open panel on startup changed: ${l}`),e.settings.autoOpenPanelOnStartup=l,e.saveSettings()})),new F.Setting(t).setName("Auto-select persisted project on startup").setDesc("If enabled, the persisted active project will be selected as the plugin's active project on load without opening the panel. ⚠️ Requires plugin reload to take effect.").addToggle(o=>o.setValue(!!e.settings.autoSelectProjectOnStartup).onChange(l=>{R(`${B} Auto-select project on startup changed: ${l}`),e.settings.autoSelectProjectOnStartup=l,e.saveSettings()})),new F.Setting(t).setName(`Enable ${Ft} debug logs`).setDesc(`When enabled, ${Ft} will set window.__${Ft.toUpperCase()}__ to true to show verbose runtime logs useful during development.`).addToggle(o=>o.setValue(!!e.settings.debug).onChange(l=>{R(`${B} Debug logs setting changed: ${l}`),e.settings.debug=l,window.__WRITEAID_DEBUG__=!!l,e.saveSettings(),l?new F.Notice(`${Ft}: debug logs enabled — verbose logs will appear in the DevTools console.`):new F.Notice(`${Ft}: debug logs disabled.`)})),t.createEl("h3",{text:"Panel performance"}),new F.Setting(t).setName("Panel refresh debounce (ms)").setDesc("Debounce timeout (milliseconds) for side-panel refresh notifications. Lower values mean more frequent refreshes; 0 disables debouncing.").addText(o=>{const l=e.settings.panelRefreshDebounceMs,c=Number(l??Ye);o.setPlaceholder(String(Ye)),o.setValue(String(c));let f=null;const d=w=>{const u=Number(w);if(!Number.isFinite(u)||u<Ce){new F.Notice(`Please enter a valid number ≥ ${Ce}.`);return}const m=Math.min(Math.floor(u),Ge);R(`${B} Panel refresh debounce changed: ${m}ms`),e.settings.panelRefreshDebounceMs=m;try{const p=e.saveSettings();p&&typeof p.catch=="function"&&p.catch(()=>{})}catch{}this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=m),o.inputEl.value=String(m),f&&(f.value=String(m))};try{const w=o.inputEl;w.setAttribute("type","number"),w.setAttribute("min",String(Ce)),w.setAttribute("max",String(Ge)),w.setAttribute("step","50"),w.setAttribute("aria-label","Panel refresh debounce in milliseconds"),zt(()=>{w.insertAdjacentHTML("afterend",'<span class="wa-unit">ms</span>')}),f=document.createElement("input"),f.type="range",f.min=String(Ce),f.max=String(Ge),f.step="50",f.value=String(c),f.className="wa-debounce-range",zt(()=>{const u=w.nextSibling;u&&u.parentElement?u.insertAdjacentElement("afterend",f):w.insertAdjacentElement("afterend",f)}),o.onChange(u=>{const m=Number(u);d(m)}),f.addEventListener("input",u=>{const m=Number(u.target.value);o.inputEl.value=String(m),d(m)})}catch{o.onChange(w=>{const u=Number(w);if(!Number.isFinite(u)||u<Ce){new F.Notice(`Please enter a valid number ≥ ${Ce}.`);return}const m=Math.min(Math.floor(u),Ge);e.settings.panelRefreshDebounceMs=m,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=m)})}}).addButton(o=>o.setButtonText("Reset").setTooltip(`Reset to default (${Ye} ms)`).onClick(()=>{const l=Ye;e.settings.panelRefreshDebounceMs=l,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=l),this.display()}))}}class Nn extends F.Modal{constructor(t,e){super(t),this.currentFolder=null,this.expanded={},this.onPick=e,R(`${B} FilePickerModal created`)}onOpen(){R(`${B} FilePickerModal opened`);const t=this.app.vault.getRoot();this.currentFolder=t,this.expanded={},this.render()}render(){const{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Select template file"}),!this.currentFolder)return;const e=this.currentFolder.path?this.currentFolder.path.split("/"):[],n=t.createDiv({cls:"wat-breadcrumbs"}),a=n.createEl("a",{text:"(Vault root)",href:"#"});a.onclick=c=>{c.preventDefault(),this.currentFolder=this.app.vault.getRoot(),this.render()};let i="";for(const c of e){i=i?`${i}/${c}`:c,n.createDiv({text:" / "});const f=n.createEl("a",{text:c,href:"#"}),d=i;f.onclick=w=>{w.preventDefault();const u=this.app.vault.getAbstractFileByPath(d);u&&u instanceof F.TFolder&&(this.currentFolder=u,this.render())}}const o=t.createDiv({cls:"wat-controls"}).createEl("button",{text:"Up"});o.onclick=c=>{var w;if(c.preventDefault(),!this.currentFolder)return;const f=((w=this.currentFolder.parent)==null?void 0:w.path)||"",d=f?this.app.vault.getAbstractFileByPath(f):this.app.vault.getRoot();d&&d instanceof F.TFolder&&(this.currentFolder=d,this.render())};const l=t.createDiv({cls:"wat-list"});for(const c of this.currentFolder.children)if(c instanceof F.TFolder){const f=l.createDiv({cls:"wat-row folder-row"}),d=f.createEl("button",{text:this.expanded[c.path]?"▾":"▸"});d.onclick=u=>{u.preventDefault(),this.expanded[c.path]=!this.expanded[c.path],this.render()};const w=f.createEl("a",{text:c.name,href:"#"});if(w.onclick=u=>{u.preventDefault(),this.currentFolder=c,this.render()},this.expanded[c.path]){const u=l.createDiv({cls:"wat-sub"});for(const m of c.children)if(m instanceof F.TFolder){const v=u.createDiv({cls:"wat-row sub-folder"}).createEl("a",{text:m.name,href:"#"});v.onclick=h=>{h.preventDefault(),this.currentFolder=m,this.render()}}else if(m instanceof F.TFile&&m.path.toLowerCase().endsWith(bt)){const v=u.createDiv({cls:"wat-row sub-file"}).createEl("a",{text:m.name,href:"#"});v.onclick=h=>{h.preventDefault(),R(`${B} File selected from file picker: ${m.path}`),this.close(),this.onPick(m.path)}}}}else if(c instanceof F.TFile&&c.path.toLowerCase().endsWith(bt)){const d=l.createDiv({cls:"wat-row file-row"}).createEl("a",{text:c.name,href:"#"});d.onclick=w=>{w.preventDefault(),R(`${B} File selected from file picker: ${c.path}`),this.close(),this.onPick(c.path)}}}onClose(){this.contentEl.empty()}}const sl=":root{--wa-bg: var(--background-primary, #ffffff);--wa-surface: var(--background-modifier-hover, #f7f7fb);--wa-muted: var(--text-muted, #6b7280);--wa-text: var(--text-normal, #0f172a);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(15, 23, 42, .08);--wa-radius: 8px;--wa-gap: 8px;--select-bg: var(--background-primary, #fff);--select-border: var(--background-modifier-border, #ccc);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #222);--select-placeholder: var(--text-muted, #888);--select-dropdown-bg: var(--background-secondary, #f6f6f6);--select-dropdown-border: var(--background-modifier-border, #e0e0e0);--select-option-hover: #f0f0ff;--select-option-active: #eaeaff;--select-chevron: var(--text-muted, #888)}@media (prefers-color-scheme: dark){:root{--wa-bg: var(--background-primary, #0b0b0c);--wa-surface: var(--background-modifier-hover, #121212);--wa-muted: var(--text-muted, #9aa4b2);--wa-text: var(--text-normal, #e6eef8);--wa-accent: var(--interactive-accent, #8b5cf6);--wa-border: rgba(255, 255, 255, .06)}}.theme-dark{--wa-bg: var(--background-primary, #23232b);--wa-surface: var(--background-modifier-hover, #2a2a4a);--wa-muted: var(--text-muted, #aaa);--wa-text: var(--text-normal, #e0e0e0);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(255, 255, 255, .06);--select-bg: var(--background-primary, #23232b);--select-border: var(--background-modifier-border, #333);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #e0e0e0);--select-placeholder: var(--text-muted, #aaa);--select-dropdown-bg: var(--background-secondary, #23233a);--select-dropdown-border: var(--background-modifier-border, #333);--select-option-hover: #2a2a4a;--select-option-active: #2a2a4a;--select-chevron: var(--text-muted, #aaa)}.theme-dark .wa-panel{background:var(--background-primary, #23232b);color:var(--text-normal, #e0e0e0);border:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-title{color:var(--text-title, var(--text-normal, #e0e0e0))}.theme-dark .wa-muted{color:var(--text-faint, var(--text-muted, #aaa))}.theme-dark .wa-draft-list{background:var(--background-secondary, #23233a)}.theme-dark .wa-draft-item{color:var(--text-normal, #e0e0e0);border-bottom:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-draft-item.active{background:var(--background-modifier-active, #2a2a4a)}.theme-dark .wa-draft-name{color:var(--text-normal, #e0e0e0)}",ol="button:hover{cursor:pointer}.writeaid-ribbon{padding-left:6px}.writeaid-ribbon .wa-icon{display:inline-block;vertical-align:middle}.writeaid-ribbon .wa-icon svg{width:16px;height:16px;fill:currentColor;display:block}.view-content:has(.writeaid-project-panel){padding:0}.writeaid-project-panel{height:100%;display:flex;flex-direction:column}.create-inline{margin-top:8px;justify-content:center}.wa-panel.project-list{padding:1em;height:100%;border-radius:0}.wa-panel-header{display:flex;flex-direction:column}.wa-draft-item.active .wa-draft-name{font-weight:700;color:var(--color-accent, #3b82f6)}.wa-draft-active-indicator{color:var(--color-accent, #3b82f6);font-size:1em;vertical-align:middle}@keyframes spin{to{transform:rotate(360deg)}}:root{--wa-slider-track-height: 6px;--wa-slider-thumb-size: 12px;--wa-slider-accent: var(--interactive-accent, #7c5cff);--wa-slider-background: var(--background-modifier-host, #eee);--wa-slider-gap: 12px}.wa-debounce-range{margin-left:var(--wa-slider-gap);vertical-align:middle;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:var(--wa-slider-track-height);background:linear-gradient(90deg,var(--wa-slider-accent) 0%,var(--wa-slider-accent) 50%,var(--wa-slider-background) 50%,var(--wa-slider-background) 100%);border-radius:999px;outline:none}.wa-debounce-range::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);box-shadow:0 0 0 4px #0000000d;cursor:pointer}.wa-debounce-range::-moz-range-thumb{width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);cursor:pointer}.wa-unit{color:var(--text-muted, #666);margin-left:6px}.justify-between{justify-content:space-between}.wa-rename-info{margin-bottom:8px;color:var(--text-muted, #888);font-size:.95em}.wa-rename-label{display:block;font-weight:500;margin-bottom:4px;color:var(--text-normal, #222)}.wa-rename-input{width:100%;padding:7px 10px;font-size:1em;border:1px solid var(--background-modifier-border, #ccc);border-radius:5px;margin-bottom:10px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s}.wa-rename-input:focus{border-color:var(--interactive-accent, #7c5cff);outline:none}.wa-rename-checkbox-label{display:flex;align-items:center;gap:6px;margin-bottom:10px;font-size:.97em;color:var(--text-muted, #666)}.wa-rename-btn-row{display:flex;gap:10px;margin-top:8px;justify-content:flex-end}.wa-rename-btn-row button{min-width:80px;padding:6px 14px;font-size:1em;border-radius:4px;border:none;cursor:pointer;transition:background .2s}.wa-rename-btn-row .mod-cta{background:var(--interactive-accent, #7c5cff);color:#fff;font-weight:600}.wa-rename-btn-row .mod-cta:hover{background:#5a3fd6}.wa-rename-btn-row .mod-cancel{background:var(--background-modifier-border, #eee);color:var(--text-muted, #666)}.wa-rename-btn-row .mod-cancel:hover{background:#e0e0e0}.wa-rename-error{min-height:18px;margin-bottom:4px;font-size:.97em;color:var(--color-red, #d43c3c);transition:opacity .2s}.wa-create-draft-input{width:100%;padding:8px 12px;font-size:1.05em;border:1.5px solid var(--background-modifier-border, #bbb);border-radius:6px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s,box-shadow .2s;outline:none;box-shadow:0 1px 2px #3c3c3c0a}.wa-create-draft-input:focus{border-color:var(--interactive-accent, #7c5cff);box-shadow:0 2px 8px #7c5cff14;background:var(--background-secondary, #fafaff)}.wa-panel{background:var(--background-primary, #fff);color:var(--text-normal, #222);padding:1em}.wa-title{font-size:1.2em;font-weight:600;color:var(--text-title, var(--text-normal, #222))}.wa-muted{color:var(--text-faint, var(--text-muted, #888))}.wa-row{display:flex;gap:8px;align-items:center;width:100%}.wa-button-group{display:flex;gap:8px}.wa-draft-list{background:var(--background-secondary, #f6f6f6);border-radius:6px;padding:8px 0;margin-top:8px}.wa-draft-item{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-bottom:1px solid var(--background-modifier-border, #e0e0e0);background:transparent;color:var(--text-normal, #222);transition:background .15s}.wa-draft-item:last-child{border-bottom:none}.wa-draft-item.active{background:var(--background-modifier-active, #eaeaff)}.wa-draft-name{font-size:1em;font-weight:500;color:var(--text-normal, #222)}.wa-draft-actions{display:flex;gap:6px}.wa-select-container.wa-select{position:relative;width:100%;display:flex;flex-direction:column;gap:4px}.wa-select-label-text{font-size:.9em;font-weight:500;color:var(--select-text, var(--text-normal, #222))}.wa-select-trigger{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:6px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));cursor:pointer;transition:all .2s ease;min-height:38px;font-size:1em}.wa-select-trigger:hover:not(.disabled){border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.open{border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.disabled{opacity:.6;cursor:not-allowed;background:var(--disabled-background, #f3f3f3)}.wa-select-value{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.wa-select-label,.wa-select-placeholder{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wa-select-placeholder{color:var(--select-placeholder, var(--text-muted, #888))}.wa-select-controls{display:flex;align-items:center;gap:4px;flex-shrink:0;margin-left:8px}.wa-select-clear{display:flex;align-items:center;justify-content:center;width:20px;height:20px;padding:0;border:none;background:none;color:var(--select-chevron, var(--text-muted, #888));cursor:pointer;border-radius:3px;transition:background .2s;font-size:.8em}.wa-select-clear:hover{background:var(--background-modifier-hover, #f0f0f0)}.wa-select-chevron{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:var(--select-chevron, var(--text-muted, #888));font-size:.7em;transition:transform .3s cubic-bezier(.4,0,.2,1)}.wa-select-chevron.rotated{transform:rotate(180deg)}.wa-select-dropdown{position:absolute;z-index:1000;background:var(--select-dropdown-bg, var(--background-secondary, #f6f6f6));border:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0));border-radius:8px;box-shadow:0 4px 12px #00000026,0 2px 4px #0000001a;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .15s ease-out}@keyframes slideIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.wa-select-dropdown[data-placement*=top]{animation:slideInTop .15s ease-out}@keyframes slideInTop{0%{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}.wa-select-search{padding:8px;border-bottom:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0))}.wa-select-search-input{width:100%;padding:6px 8px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:4px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));font-size:.95em}.wa-select-search-input:focus{outline:none;border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-list{flex:1;overflow-y:auto;max-height:300px}.wa-select-list::-webkit-scrollbar{width:6px}.wa-select-list::-webkit-scrollbar-track{background:transparent}.wa-select-list::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb-bg, rgba(0, 0, 0, .2));border-radius:3px}.wa-select-list::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover-bg, rgba(0, 0, 0, .3))}.wa-select-empty{padding:12px 10px;text-align:center;color:var(--select-placeholder, var(--text-muted, #888));font-size:.95em}.wa-select-option{width:100%;margin-top:2px;padding:8px 10px;border-radius:0;box-shadow:none!important;border:none;background:transparent;color:var(--select-text, var(--text-normal, #222));text-align:left;cursor:pointer;transition:background .15s;font-size:.95em}.wa-select-option:hover{background:var(--select-option-hover, #f0f0ff);box-shadow:none!important}.wa-select-option.selected{background:var(--select-option-active, #eaeaff);box-shadow:none!important}.wa-select-option.active{background:var(--select-option-active, #eaeaff);font-weight:500;box-shadow:none!important}";if(typeof globalThis<"u"){const r=globalThis;r.__BROWSER__||(r.__BROWSER__=!0)}function Rr(r,t=20){return r.length<=t?r:r.substring(0,t-3)+"..."}const Sa={outlineTemplate:`# {{draftName}} Outline

## Overview
Brief description of the story goes here.

## Characters
- Character 1: Description
- Character 2: Description

## Plot Points
- Opening: 
- Middle: 
- Climax: 
- Resolution: 

## Chapters
- Chapter 1: Title
- Chapter 2: Title
- Chapter 3: Title`,chapterTemplate:`# {{chapterName}}

## Summary
Chapter summary goes here.

## Scene 1
Scene content goes here.

## Scene 2
Scene content goes here.`,manuscriptNameTemplate:"{{draftName}}",slugStyle:"compact",ribbonPlacement:"left",ribbonAlwaysShow:!1,autoOpenPanelOnStartup:!0,autoSelectProjectOnStartup:!0,activeProject:void 0,panelRefreshDebounceMs:250,debug:!1,includeDraftOutline:!1,draftsFolderName:Fe.DRAFTS,manuscriptsFolderName:Fe.MANUSCRIPTS,backupsFolderName:Fe.BACKUPS,metaFileName:re.META,outlineFileName:re.OUTLINE,maxBackups:5,maxBackupAgeDays:30};function zr(r){return Object.assign({},Sa,r??{})}class ll extends F.Plugin{constructor(){super(...arguments),this.settings=Sa,this.settingsChangedCallbacks=[]}async loadSettings(){const t=await this.loadData();this.settings=zr(t),t&&t.activeProject!==void 0&&(this.settings.activeProject=t.activeProject),this.manager&&(this.manager.settings=this.settings),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){R(`${B} Error in settings changed callback:`,n)}})}async saveSettings(){await Ot(async()=>{const e=zr(this.settings);await this.saveData(e),this.settings=e})===void 0&&await this.saveData(this.settings),this.manager&&(this.manager.settings=this.settings,R(`${B} Updated manager settings reference, manuscript template: ${this.settings.manuscriptNameTemplate}`)),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){R(`${B} Error in settings changed callback:`,n)}})}registerSettingsChangedCallback(t){this.settingsChangedCallbacks.push(t)}async runBackupCleanup(){if(this.manager)try{const e=await new un(this.app).listProjects();for(const n of e){const a=jt(this.settings),i=`${n}/${a}`,s=this.app.vault.getAbstractFileByPath(i);if(!(!s||!(s instanceof F.TFolder))){for(const o of s.children)if(o instanceof F.TFolder){const l=`${i}/${o.name}`;await this.manager.projectFileService.backups.clearOldBackups(l,this.manager.settings)}}}R(`${B} Backup cleanup completed on startup`)}catch(t){R(`${B} Error during backup cleanup:`,t)}}async onload(){await this.loadSettings(),this.manager=new al(this.app,this,typeof this.settings.panelRefreshDebounceMs=="number"?this.settings.panelRefreshDebounceMs:void 0),R(`${B} Manager created:`,!!this.manager);const t=new un(this.app);this.app.workspace.onLayoutReady(async()=>{const a=await t.listProjects();let i=null;if(a.length===1)i=a[0];else if(a.length>1){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");R(`${B} lastActiveRaw='${s}', normalized='${o}', includes=${o&&a.includes(o)}`),o&&a.includes(o)?i=o:i=a[0]}else if(a.length===0){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");await t.isProjectFolder(s||"")&&(R(`${B} activating saved project '${o}' as it exists and has valid meta file`),i=o??null)}if(R(`${B} toActivate='${i}'`),i){if(await this.manager.setActiveProject(i),this.settings.activeProject=i,await this.saveSettings(),this.settings.autoOpenPanelOnStartup){const s=this.app.workspace.getLeavesOfType(be);if(s.length>0)this.app.workspace.revealLeaf(s[0]);else{let o=null;this.settings.ribbonPlacement==="right"?o=this.app.workspace.getRightLeaf(!0):o=this.app.workspace.getLeftLeaf(!0);const l={type:be,active:!0};o.setViewState(l),this.app.workspace.revealLeaf(o)}}}else await this.manager.setActiveProject(null),this.settings.activeProject=void 0,await this.saveSettings()}),this.statusBarEl=this.addStatusBarItem(),this.statusBarEl.setText(`${Ft}: No active project`),this.runBackupCleanup().catch(a=>{R(`${B} Failed to run backup cleanup on startup:`,a)}),zt(()=>{this.waStyleEl||(this.waStyleEl=document.createElement("style"),this.waStyleEl.setAttribute("data-writeaid-style",""),this.waStyleEl.textContent=sl+ol,this.waStyleEl.classList.add("writeaid-plugin-style"),document.head.appendChild(this.waStyleEl))}),await this.loadSettings(),zt(()=>{window.__WRITEAID_DEBUG__=!!this.settings.debug}),R(`${B} Loading ${Ft} Novel Multi-Draft Plugin`),this.manager.addActiveProjectListener(a=>{this.statusBarEl&&(a?(this.statusBarEl.setText(`${Ft}: ${Rr(a)}`),R(`${B} active project updated -> ${a}`)):this.statusBarEl.setText(`${Ft}: No active project`))}),this.manager.activeProject&&this.statusBarEl.setText(`${Ft}: ${Rr(this.manager.activeProject)}`),R(`${B} Registering ProjectPanelView with manager:`,!!this.manager),this.registerView(be,a=>(R(`${B} Creating ProjectPanelView instance with manager:`,!!this.manager),new Xo(a,this.app,this.manager)));const e=this.addRibbonIcon(Ln,`${Ft} Projects`,()=>{});e.classList.add("writeaid-ribbon"),this.ribbonEl=e,e.setAttr("aria-label",`${Ft} Projects`),e.onclick=()=>{const a=this.app.workspace.getLeavesOfType(be);if(a.length>0){const i=a[0];this.app.workspace.revealLeaf(i)}else{let i=this.app.workspace.getLeftLeaf(!1);i||(i=this.app.workspace.getLeftLeaf(!0));const s={type:be,active:!0};i.setViewState(s),this.app.workspace.revealLeaf(i)}};const n=async()=>{await Ot(async()=>{if(this.settings.ribbonAlwaysShow){e.style.display="";return}const i=t.listAllFolders();(await Be(i,o=>t.isProjectFolder(o))).length>0?e.style.display="":e.style.display="none"})===void 0&&(e.style.display="")};this.refreshRibbonVisibility=n,n().catch(()=>{}),this.settings.ribbonPlacement==="right"&&this.moveRibbon("right"),this.registerEvent(this.app.vault.on("create",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("delete",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("modify",()=>{n().catch(()=>{})})),this.addCommand({id:"create-new-draft",name:"Create New Draft",callback:Ra(this.manager)}),this.addCommand({id:"create-outline",name:"Create Outline",callback:()=>za(this.manager)}),this.addCommand({id:"create-new-project",name:"Create New Project",callback:Ka(this.manager)}),this.addCommand({id:"switch-draft",name:"Switch Active Draft",callback:Ua(this.manager)}),this.addCommand({id:"update-project-metadata",name:"Update Project Metadata",callback:Qo(this.manager)}),this.addCommand({id:"select-active-project",name:"Select Active Project",callback:qa(this.manager)}),this.addCommand({id:"generate-manuscript",name:"Generate Manuscript",callback:Ia(this.manager)}),this.addCommand({id:"toggle-project-panel",name:`Toggle ${Ft} Project Panel`,callback:Jo(this.manager,this.app)}),this.addCommand({id:"convert-single-to-multi-file-project",name:"Convert Single-File Project to Multi-File",callback:()=>{var a,i;return Ya(this.app,this.manager.activeProject||((i=(a=this.manager).getCurrentProjectPath)==null?void 0:i.call(a))||void 0,this.manager.settings)}}),this.addCommand({id:"navigate-to-next-chapter",name:"Navigate to Next Chapter",callback:Wa(this.manager)}),this.addCommand({id:"navigate-to-previous-chapter",name:"Navigate to Previous Chapter",callback:Ha(this.manager)}),this.addCommand({id:"create-backup",name:"Create Backup",callback:ja(this.manager)}),this.addCommand({id:"list-and-restore-backups",name:"List and Restore Backups",callback:Ba(this.manager)}),this.addCommand({id:"delete-backup",name:"Delete Oldest Backup",callback:Ta(this.manager)}),this.addCommand({id:"clear-old-backups",name:"Clear Old Backups",callback:Aa(this.manager)}),this.addCommand({id:"initialize-draft-file",name:"Initialize Draft File Metadata",callback:Ma(this.manager)}),this.addSettingTab(new il(this.app,this))}moveRibbon(t){zt(()=>{if(!this.ribbonEl)return;const e=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-right"),n=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-left");t==="right"&&e?e.appendChild(this.ribbonEl):t==="left"&&n&&n.appendChild(this.ribbonEl)})}onunload(){this.statusBarEl&&this.statusBarEl.parentElement&&this.statusBarEl.parentElement.removeChild(this.statusBarEl),R(`${B} Unloading ${Ft} Novel Multi-Draft Plugin`),this.waStyleEl&&this.waStyleEl.parentElement&&this.waStyleEl.parentElement.removeChild(this.waStyleEl)}}module.exports=ll;
//# sourceMappingURL=main.js.map
