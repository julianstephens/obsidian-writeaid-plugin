"use strict";var ja=Object.defineProperty;var Na=(r,t,e)=>t in r?ja(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var En=(r,t,e)=>Na(r,typeof t!="symbol"?t+"":t,e);const D=require("obsidian"),pn={ACTIVE_PROJECT_NOT_FOUND:"No active project found.",ACTIVE_DRAFT_NOT_FOUND:"No active draft found.",BACKUPS_NOT_FOUND_PROJECT:"No backups found for the current project.",BACKUPS_NOT_FOUND_DRAFT:"No backups found for the current draft."},je={DRAFTS:"drafts",MANUSCRIPTS:"manuscripts",BACKUPS:".writeaid-backups"},se={META:"meta.md",OUTLINE:"outline.md"},On={COMPACT:"compact",KEBAB:"kebab"},Bt={SINGLE:"single-file",MULTI:"multi-file"},Aa=Object.values(Bt),Ft="WriteAid",S=`${Ft} debug:`,Zn="pen-tool",Vr="1.0.0",pt=".md",De=0,Xe=5e3,Je=250,Be=".zip",Zr=/^(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})\.zip$/,St="---",Ot=new RegExp(`^${St}
([\\s\\S]*?)
${St}`),Rn=1024,Gr=["B","KB","MB","GB"];function At(r){return(r==null?void 0:r.draftsFolderName)||je.DRAFTS}function Gn(r){return(r==null?void 0:r.manuscriptsFolderName)||je.MANUSCRIPTS}function Re(r){return(r==null?void 0:r.backupsFolderName)||je.BACKUPS}function Gt(r){return(r==null?void 0:r.metaFileName)||se.META}function Ie(r){return(r==null?void 0:r.outlineFileName)||se.OUTLINE}function Vt(r,t=On.COMPACT){if(!r)return"";const e=r.trim();return t===On.KEBAB?e.replace(/\s+/g,"-").toLowerCase():e.replace(/\s+/g,"").toLowerCase()}async function ye(r,t){const e=await Promise.all(r.map(n=>Promise.resolve(t(n))));return r.filter((n,a)=>e[a])}function It(r,...t){try{return r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}async function zt(r,...t){try{return await r()}catch(e){if(t.length>0&&t.some(n=>e instanceof n)||t.length===0)return;throw e}}function Ne(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const r=Date.now().toString(36),t=Math.random().toString(36).substring(2,15);return`${r}-${t}`}function F(...r){It(()=>{window.__WRITEAID_DEBUG__&&(console.debug||console.log).apply(console,r)})}function Ze(r,t){return r?t?!0:(new D.Notice(pn.ACTIVE_DRAFT_NOT_FOUND),!1):(new D.Notice(pn.ACTIVE_PROJECT_NOT_FOUND),!1)}function In(r){return r?r.trim().split(/\s+/).filter(e=>e.length>0).length:0}const Ta=Object.freeze(Object.defineProperty({__proto__:null,APP_NAME:Ft,BACKUP_FILE_EXTENSION:Be,BACKUP_TIMESTAMP_REGEX:Zr,BYTES_PER_KILOBYTE:Rn,DEBUG_PREFIX:S,FILES:se,FILE_SIZE_UNITS:Gr,FOLDERS:je,FRONTMATTER_DELIMITER:St,FRONTMATTER_REGEX:Ot,MARKDOWN_FILE_EXTENSION:pt,PANEL_DEBOUNCE_DEFAULT:Je,PANEL_DEBOUNCE_MAX:Xe,PANEL_DEBOUNCE_MIN:De,PROJECT_TYPE:Bt,SLUG_STYLE:On,VALID_PROJECT_TYPES:Aa,WRITEAID_VERSION:Vr,WRITE_AID_ICON_NAME:Zn,asyncFilter:ye,checkActive:Ze,countWords:In,debug:F,generateDraftId:Ne,getBackupsFolderName:Re,getDraftsFolderName:At,getManuscriptsFolderName:Gn,getMetaFileName:Gt,getOutlineFileName:Ie,slugifyDraftName:Vt,suppress:It,suppressAsync:zt},Symbol.toStringTag,{value:"Module"}));function Ba(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Clear old backups command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Ze(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=At(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const c of a.children)if(c instanceof D.TFolder&&c.name.toLowerCase()===n.toLowerCase()){i=c.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID.");return}const l=r.projectFileService.backups.maxBackupAgeDays;await r.projectFileService.backups.clearOldBackups(s,o,r.settings),new D.Notice(`Old backups cleared (older than ${l} days).`)}}class Oa extends D.Modal{constructor(t,e,n){super(t),this.result=!1,this.resolvePromise=null,this.draftName=e,this.backupsToDelete=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Confirm Backup Creation"}),t.createEl("p",{text:`Creating a new backup for draft "${this.draftName}" will exceed the maximum number of backups allowed. The following will happen:`}),t.createEl("ul").createEl("li",{text:`${this.backupsToDelete} oldest backup(s) will be deleted to make room for the new one.`}),t.createEl("p",{text:"Do you want to continue?"}),new D.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.result=!1,this.close()})).addButton(e=>e.setButtonText("Continue").setCta().onClick(()=>{this.result=!0,this.close()}))}onClose(){this.resolvePromise&&this.resolvePromise(this.result)}showModal(){return new Promise(t=>{this.resolvePromise=t,this.open()})}}function Ra(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Create backup command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Ze(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=At(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const f of a.children)if(f instanceof D.TFolder&&f.name.toLowerCase()===n.toLowerCase()){i=f.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID for backup.");return}const l=await r.projectFileService.backups.willExceedMaxBackups(s,o,r.settings);if(l>0&&!await new Oa(r.app,e,l).showModal()){F(`${S} User cancelled backup creation due to cleanup`),new D.Notice("Backup creation cancelled.");return}if(await r.projectFileService.backups.createBackup(s,o,r.settings)){if(F(`${S} Backup created successfully, backupsToDelete=${l}`),l>0){F(`${S} Starting cleanup of ${l} excess backups for ${o}`);const f=await r.projectFileService.backups.cleanupExcessBackups(s,o,r.settings);F(`${S} Cleanup complete, deleted ${f} backups`)}new D.Notice("Backup created successfully.")}else F(`${S} Backup creation failed`),new D.Notice("Failed to create backup.")}}function Ia(r){return async()=>{const t=r.activeProject,e=r.activeDraft;if(F(`${S} Delete backup command called`),F(`${S} Active project: ${t}, active draft: ${e}`),!Ze(t,e))return;if(!t||!e){new D.Notice("Active project or draft not found.");return}const n=At(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const h of a.children)if(h instanceof D.TFolder&&h.name.toLowerCase()===n.toLowerCase()){i=h.name;break}}const s=`${t}/${i}/${e}`,o=await r.projectFileService.drafts.getDraftId(s);if(!o){new D.Notice("Failed to get draft ID.");return}const l=await r.projectFileService.backups.listBackups(s,o,r.settings);if(l.length===0){new D.Notice(pn.BACKUPS_NOT_FOUND_DRAFT);return}const c=l[l.length-1];await r.projectFileService.backups.deleteBackup(s,o,c,r.settings)?new D.Notice(`Backup deleted successfully: ${c}.`):new D.Notice("Failed to delete backup.")}}class zn extends D.Modal{constructor(t,e,n=!1){super(t),this.path=e,this.isDraft=n,this.setTitle("Confirm Overwrite")}onOpen(){const{contentEl:t}=this,e=this.isDraft?"draft folder":"manuscript file";t.createEl("p",{text:`The ${e} "${this.path}" already exists. Do you want to overwrite it?`});const n=t.createDiv({cls:"modal-button-container"});new D.ButtonComponent(n).setButtonText("Cancel").onClick(()=>{F(`${S} ConfirmOverwriteModal: cancelled overwrite for ${this.isDraft?"draft":"manuscript"} "${this.path}"`),this.resolve(!1),this.close()}),new D.ButtonComponent(n).setButtonText("Overwrite").setCta().onClick(()=>{F(`${S} ConfirmOverwriteModal: confirmed overwrite for ${this.isDraft?"draft":"manuscript"} "${this.path}"`),this.resolve(!0),this.close()})}onClose(){const{contentEl:t}=this;t.empty()}open(){return new Promise(t=>{this.resolve=t,super.open()})}}class za extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Restored Draft"}),t.createEl("div",{text:`The original draft '${this.oldName}' no longer exists. Please provide a new name for the restored draft.`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Restore",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameRestoredDraftModal: restoring draft as "${t}"`),this.onSubmit(t),this.close()}onClose(){this.contentEl.empty()}}class La extends D.SuggestModal{constructor(t,e,n){super(t),this.manager=e,this.backups=[],this.draftFolder="",this.draftName="",this.onRestoreComplete=n,this.setPlaceholder("Select a backup to restore..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to restore"},{command:"esc",purpose:"to cancel"}])}async onOpen(){const t=this.manager.activeProject;if(F(`${S} RestoreBackupModal opened for project: ${t}`),!t){new D.Notice("No active project found."),this.close();return}const e=At(this.manager.settings);if(this.draftFolder=`${t}/${e}`,this.draftName=t,this.backups=await this.getBackupDetails(),F(`${S} Found ${this.backups.length} backups for project: ${t}`),this.backups.length===0){new D.Notice(pn.BACKUPS_NOT_FOUND_PROJECT),this.close();return}this.setTitle(`Restore Backup for Project "${t}"`),super.onOpen()}async getBackupDetails(){const t=this.draftFolder.split("/")[0]||"unknown",e=`${Re(this.manager.settings)}/${t}`;try{const n=[],a=At(this.manager.settings);let i=a;try{const l=await this.app.vault.adapter.list(e);for(const c of l.folders){const f=c.split("/").pop()||c;if(f.toLowerCase()===a.toLowerCase()){i=f;break}}}catch{F(`${S} Could not read backup project directory: ${e}`)}const s=`${e}/${i}`;F(`${S} Looking for backups in: ${s}`);const o=await this.app.vault.adapter.list(s);for(const l of o.folders){const c=l.split("/").pop()||l;let f=c;const h=`${t}/${a}`,g=this.manager.projectFileService.drafts.listDrafts(t);for(const v of g){const y=`${h}/${v}`;if(await this.manager.projectFileService.drafts.getDraftId(y)===c){f=v;break}}const u=`${s}/${c}`,m=await this.app.vault.adapter.list(u),p=this.app.vault.getAbstractFileByPath(t);let b=a;if(p&&p instanceof D.TFolder){for(const v of p.children)if(v instanceof D.TFolder&&v.name.toLowerCase()===a.toLowerCase()){b=v.name;break}}const d=`${t}/${b}/${f}`;for(const v of m.files){const y=v.split("/").pop()||v,$=new RegExp("^(\\d{4}-\\d{2}-\\d{2}T\\d{2}-\\d{2}-\\d{2})\\.zip$"),k=y.match($);if(k){const N=await this.app.vault.adapter.stat(v),A=(N==null?void 0:N.size)||0,R=k[1],P=R.replace(/T(\d{2})-(\d{2})-(\d{2})/,"T$1:$2:$3"),K=new Date(P).toLocaleString(),E=this.formatFileSize(A);n.push({timestamp:R,size:A,displayText:`${f}: ${K} (${E})`,draftName:f,draftFolder:d,draftId:c})}}}return n.sort((l,c)=>c.timestamp.localeCompare(l.timestamp))}catch{return F(`${S} Backup directory does not exist yet for project '${e}' (this is normal for new projects)`),[]}}formatFileSize(t){if(t===0)return"0 B";const e=Math.floor(Math.log(t)/Math.log(Rn));return parseFloat((t/Math.pow(Rn,e)).toFixed(1))+" "+Gr[e]}getSuggestions(t){return this.backups.filter(e=>e.displayText.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.createEl("div",{text:t.displayText})}async onChooseSuggestion(t,e){const n=this.manager.activeDraft;F(`${S} Restoring backup: ${t.draftName} (${t.timestamp}), current active draft: ${n}`);const a=this.app.vault.getAbstractFileByPath(t.draftFolder);let i=t.draftFolder,s=t.draftName;if(a&&a instanceof D.TFolder){if(!await new zn(this.app,t.draftFolder,!0).open()){F(`${S} Backup restore cancelled by user`);return}}else{const l=new za(this.app,t.draftName,f=>{s=f});if(await new Promise(f=>{const h=l.onClose;l.onClose=()=>{h&&h.call(l),f()},l.open()}),s===t.draftName&&!a){F(`${S} Backup restore cancelled by user (rename modal)`);return}i=`${t.draftFolder.split("/").slice(0,-1).join("/")}/${s}`}await this.manager.projectFileService.backups.restoreBackup(i,t.draftId,t.timestamp,this.manager.settings)?(new D.Notice(`Backup restored successfully for "${s}" from ${t.displayText.split(": ")[1].split(" (")[0]}.`),F(`${S} Backup restore successful for: ${s}, active draft preserved: ${n} -> ${this.manager.activeDraft}`),this.onRestoreComplete&&this.onRestoreComplete()):(new D.Notice("Failed to restore backup."),F(`${S} Backup restore failed for: ${s}`))}}function Ma(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function cn(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Yr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(r,t){(function(e){r.exports=e()})(function(){return function e(n,a,i){function s(c,f){if(!a[c]){if(!n[c]){var h=typeof cn=="function"&&cn;if(!f&&h)return h(c,!0);if(o)return o(c,!0);var g=new Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g}var u=a[c]={exports:{}};n[c][0].call(u.exports,function(m){var p=n[c][1][m];return s(p||m)},u,u.exports,e,n,a,i)}return a[c].exports}for(var o=typeof cn=="function"&&cn,l=0;l<i.length;l++)s(i[l]);return s}({1:[function(e,n,a){var i=e("./utils"),s=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var c,f,h,g,u,m,p,b=[],d=0,v=l.length,y=v,$=i.getTypeOf(l)!=="string";d<l.length;)y=v-d,h=$?(c=l[d++],f=d<v?l[d++]:0,d<v?l[d++]:0):(c=l.charCodeAt(d++),f=d<v?l.charCodeAt(d++):0,d<v?l.charCodeAt(d++):0),g=c>>2,u=(3&c)<<4|f>>4,m=1<y?(15&f)<<2|h>>6:64,p=2<y?63&h:64,b.push(o.charAt(g)+o.charAt(u)+o.charAt(m)+o.charAt(p));return b.join("")},a.decode=function(l){var c,f,h,g,u,m,p=0,b=0,d="data:";if(l.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var v,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|y):new Array(0|y);p<l.length;)c=o.indexOf(l.charAt(p++))<<2|(g=o.indexOf(l.charAt(p++)))>>4,f=(15&g)<<4|(u=o.indexOf(l.charAt(p++)))>>2,h=(3&u)<<6|(m=o.indexOf(l.charAt(p++))),v[b++]=c,u!==64&&(v[b++]=f),m!==64&&(v[b++]=h);return v}},{"./support":30,"./utils":32}],2:[function(e,n,a){var i=e("./external"),s=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(f,h,g,u,m){this.compressedSize=f,this.uncompressedSize=h,this.crc32=g,this.compression=u,this.compressedContent=m}c.prototype={getContentWorker:function(){var f=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),h=this;return f.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(f,h,g){return f.pipe(new o).pipe(new l("uncompressedSize")).pipe(h.compressWorker(g)).pipe(new l("compressedSize")).withStreamInfo("compression",h)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,a){var i=e("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},a.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,a){var i=e("./utils"),s=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var f=0;f<8;f++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?function(c,f,h,g){var u=s,m=g+h;c^=-1;for(var p=g;p<m;p++)c=c>>>8^u[255&(c^f[p])];return-1^c}(0|l,o,o.length,0):function(c,f,h,g){var u=s,m=g+h;c^=-1;for(var p=g;p<m;p++)c=c>>>8^u[255&(c^f.charCodeAt(p))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(e,n,a){var i=null;i=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:i}},{lie:37}],7:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=i?"uint8array":"array";function f(h,g){l.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=g,this.meta={}}a.magic="\b\0",o.inherits(f,l),f.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,h.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(g){h.push({data:g,meta:h.meta})}},a.compressWorker=function(h){return new f("Deflate",h)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,a){function i(u,m){var p,b="";for(p=0;p<m;p++)b+=String.fromCharCode(255&u),u>>>=8;return b}function s(u,m,p,b,d,v){var y,$,k=u.file,N=u.compression,A=v!==c.utf8encode,R=o.transformTo("string",v(k.name)),P=o.transformTo("string",c.utf8encode(k.name)),B=k.comment,K=o.transformTo("string",v(B)),E=o.transformTo("string",c.utf8encode(B)),L=P.length!==k.name.length,_=E.length!==B.length,W="",st="",V="",ot=k.dir,G=k.date,ft={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(ft.crc32=u.crc32,ft.compressedSize=u.compressedSize,ft.uncompressedSize=u.uncompressedSize);var I=0;m&&(I|=8),A||!L&&!_||(I|=2048);var O=0,lt=0;ot&&(O|=16),d==="UNIX"?(lt=798,O|=function(X,$t){var jt=X;return X||(jt=$t?16893:33204),(65535&jt)<<16}(k.unixPermissions,ot)):(lt=20,O|=function(X){return 63&(X||0)}(k.dosPermissions)),y=G.getUTCHours(),y<<=6,y|=G.getUTCMinutes(),y<<=5,y|=G.getUTCSeconds()/2,$=G.getUTCFullYear()-1980,$<<=4,$|=G.getUTCMonth()+1,$<<=5,$|=G.getUTCDate(),L&&(st=i(1,1)+i(f(R),4)+P,W+="up"+i(st.length,2)+st),_&&(V=i(1,1)+i(f(K),4)+E,W+="uc"+i(V.length,2)+V);var U="";return U+=`
\0`,U+=i(I,2),U+=N.magic,U+=i(y,2),U+=i($,2),U+=i(ft.crc32,4),U+=i(ft.compressedSize,4),U+=i(ft.uncompressedSize,4),U+=i(R.length,2),U+=i(W.length,2),{fileRecord:h.LOCAL_FILE_HEADER+U+R+W,dirRecord:h.CENTRAL_FILE_HEADER+i(lt,2)+U+i(K.length,2)+"\0\0\0\0"+i(O,4)+i(b,4)+R+W+K}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),f=e("../crc32"),h=e("../signature");function g(u,m,p,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(g,l),g.prototype.push=function(u){var m=u.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-b-1))/p:100}}))},g.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var m=this.streamFiles&&!u.file.dir;if(m){var p=s(u,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(u){this.accumulate=!1;var m=this.streamFiles&&!u.file.dir,p=s(u,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(b){return h.DATA_DESCRIPTOR+i(b.crc32,4)+i(b.compressedSize,4)+i(b.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var u=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-u,b=function(d,v,y,$,k){var N=o.transformTo("string",k($));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(d,2)+i(d,2)+i(v,4)+i(y,4)+i(N.length,2)+N}(this.dirRecords.length,p,u,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(u){this._sources.push(u);var m=this;return u.on("data",function(p){m.processChunk(p)}),u.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),u.on("error",function(p){m.error(p)}),this},g.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(u){var m=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var p=0;p<m.length;p++)try{m[p].error(u)}catch{}return!0},g.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,m=0;m<u.length;m++)u[m].lock()},n.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,a){var i=e("../compressions"),s=e("./ZipFileWorker");a.generateWorker=function(o,l,c){var f=new s(l.streamFiles,c,l.platform,l.encodeFileName),h=0;try{o.forEach(function(g,u){h++;var m=function(v,y){var $=v||y,k=i[$];if(!k)throw new Error($+" is not a valid compression method !");return k}(u.options.compression,l.compression),p=u.options.compressionOptions||l.compressionOptions||{},b=u.dir,d=u.date;u._compressWorker(m,p).withStreamInfo("file",{name:g,dir:b,date:d,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(f)}),f.entriesCount=h}catch(g){f.error(g)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,a){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(s,o){return new i().loadAsync(s,o)},i.external=e("./external"),n.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,a){var i=e("./utils"),s=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),f=e("./nodejsUtils");function h(g){return new s.Promise(function(u,m){var p=g.decompressed.getContentWorker().pipe(new c);p.on("error",function(b){m(b)}).on("end",function(){p.streamInfo.crc32!==g.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}n.exports=function(g,u){var m=this;return u=i.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),f.isNode&&f.isStream(g)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",g,!0,u.optimizedBinaryString,u.base64).then(function(p){var b=new l(u);return b.load(p),b}).then(function(p){var b=[s.Promise.resolve(p)],d=p.files;if(u.checkCRC32)for(var v=0;v<d.length;v++)b.push(h(d[v]));return s.Promise.all(b)}).then(function(p){for(var b=p.shift(),d=b.files,v=0;v<d.length;v++){var y=d[v],$=y.fileNameStr,k=i.resolve(y.fileNameStr);m.file(k,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:u.createFolders}),y.dir||(m.file(k).unsafeOriginalName=$)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,a){var i=e("../utils"),s=e("../stream/GenericWorker");function o(l,c){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(o,s),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(f){c.push({data:f,meta:{percent:0}})}).on("error",function(f){c.isPaused?this.generatedError=f:c.error(f)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,a){var i=e("readable-stream").Readable;function s(o,l,c){i.call(this,l),this._helper=o;var f=this;o.on("data",function(h,g){f.push(h)||f._helper.pause(),c&&c(g)}).on("error",function(h){f.emit("error",h)}).on("end",function(){f.push(null)})}e("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(e,n,a){function i(k,N,A){var R,P=o.getTypeOf(N),B=o.extend(A||{},f);B.date=B.date||new Date,B.compression!==null&&(B.compression=B.compression.toUpperCase()),typeof B.unixPermissions=="string"&&(B.unixPermissions=parseInt(B.unixPermissions,8)),B.unixPermissions&&16384&B.unixPermissions&&(B.dir=!0),B.dosPermissions&&16&B.dosPermissions&&(B.dir=!0),B.dir&&(k=d(k)),B.createFolders&&(R=b(k))&&v.call(this,R,!0);var K=P==="string"&&B.binary===!1&&B.base64===!1;A&&A.binary!==void 0||(B.binary=!K),(N instanceof h&&N.uncompressedSize===0||B.dir||!N||N.length===0)&&(B.base64=!1,B.binary=!0,N="",B.compression="STORE",P="string");var E=null;E=N instanceof h||N instanceof l?N:m.isNode&&m.isStream(N)?new p(k,N):o.prepareContent(k,N,B.binary,B.optimizedBinaryString,B.base64);var L=new g(k,E,B);this.files[k]=L}var s=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),f=e("./defaults"),h=e("./compressedObject"),g=e("./zipObject"),u=e("./generate"),m=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),b=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var N=k.lastIndexOf("/");return 0<N?k.substring(0,N):""},d=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},v=function(k,N){return N=N!==void 0?N:f.createFolders,k=d(k),this.files[k]||i.call(this,k,null,{dir:!0,createFolders:N}),this.files[k]};function y(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var $={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var N,A,R;for(N in this.files)R=this.files[N],(A=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&k(A,R)},filter:function(k){var N=[];return this.forEach(function(A,R){k(A,R)&&N.push(R)}),N},file:function(k,N,A){if(arguments.length!==1)return k=this.root+k,i.call(this,k,N,A),this;if(y(k)){var R=k;return this.filter(function(B,K){return!K.dir&&R.test(B)})}var P=this.files[this.root+k];return P&&!P.dir?P:null},folder:function(k){if(!k)return this;if(y(k))return this.filter(function(P,B){return B.dir&&k.test(P)});var N=this.root+k,A=v.call(this,N),R=this.clone();return R.root=A.name,R},remove:function(k){k=this.root+k;var N=this.files[k];if(N||(k.slice(-1)!=="/"&&(k+="/"),N=this.files[k]),N&&!N.dir)delete this.files[k];else for(var A=this.filter(function(P,B){return B.name.slice(0,k.length)===k}),R=0;R<A.length;R++)delete this.files[A[R].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var N,A={};try{if((A=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var R=A.comment||this.comment||"";N=u.generateWorker(this,A,R)}catch(P){(N=new l("error")).error(P)}return new c(N,A.type||"string",A.mimeType)},generateAsync:function(k,N){return this.generateInternalStream(k).accumulate(N)},generateNodeStream:function(k,N){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(N)}};n.exports=$},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,a){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),h=o.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===l&&this.data[g+1]===c&&this.data[g+2]===f&&this.data[g+3]===h)return g-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),f=o.charCodeAt(2),h=o.charCodeAt(3),g=this.readData(4);return l===g[0]&&c===g[1]&&f===g[2]&&h===g[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,n,a){var i=e("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(e,n,a){var i=e("./Uint8ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,a){var i=e("./DataReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,n,a){var i=e("./ArrayReader");function s(o){i.call(this,o)}e("../utils").inherits(s,i),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,a){var i=e("../utils"),s=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),f=e("./Uint8ArrayReader");n.exports=function(h){var g=i.getTypeOf(h);return i.checkSupport(g),g!=="string"||s.uint8array?g==="nodebuffer"?new c(h):s.uint8array?new f(i.transformTo("uint8array",h)):new o(i.transformTo("array",h)):new l(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,a){var i=e("./GenericWorker"),s=e("../utils");function o(l){i.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,i),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,a){var i=e("./GenericWorker"),s=e("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,i),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(o,s),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,a){var i=e("../utils"),s=e("./GenericWorker");function o(l){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){c.dataIsReady=!0,c.data=f,c.max=f&&f.length||0,c.type=i.getTypeOf(f),c.isPaused||c._tickAndRepeat()},function(f){c.error(f)})}i.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,a){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=i},{}],29:[function(e,n,a){var i=e("../utils"),s=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),f=e("../external"),h=null;if(c.nodestream)try{h=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(m,p){return new f.Promise(function(b,d){var v=[],y=m._internalType,$=m._outputType,k=m._mimeType;m.on("data",function(N,A){v.push(N),p&&p(A)}).on("error",function(N){v=[],d(N)}).on("end",function(){try{var N=function(A,R,P){switch(A){case"blob":return i.newBlob(i.transformTo("arraybuffer",R),P);case"base64":return l.encode(R);default:return i.transformTo(A,R)}}($,function(A,R){var P,B=0,K=null,E=0;for(P=0;P<R.length;P++)E+=R[P].length;switch(A){case"string":return R.join("");case"array":return Array.prototype.concat.apply([],R);case"uint8array":for(K=new Uint8Array(E),P=0;P<R.length;P++)K.set(R[P],B),B+=R[P].length;return K;case"nodebuffer":return Buffer.concat(R);default:throw new Error("concat : unsupported type '"+A+"'")}}(y,v),k);b(N)}catch(A){d(A)}v=[]}).resume()})}function u(m,p,b){var d=p;switch(p){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=p,this._mimeType=b,i.checkSupport(d),this._worker=m.pipe(new s(d)),m.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}u.prototype={accumulate:function(m){return g(this,m)},on:function(m,p){var b=this;return m==="data"?this._worker.on(m,function(d){p.call(b,d.data,d.meta)}):this._worker.on(m,function(){i.delay(p,arguments,b)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var i=new ArrayBuffer(0);try{a.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!e("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,a){for(var i=e("./utils"),s=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),f=0;f<256;f++)c[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;c[254]=c[254]=1;function h(){l.call(this,"utf-8 decode"),this.leftOver=null}function g(){l.call(this,"utf-8 encode")}a.utf8encode=function(u){return s.nodebuffer?o.newBufferFrom(u,"utf-8"):function(m){var p,b,d,v,y,$=m.length,k=0;for(v=0;v<$;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<$&&(64512&(d=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(d-56320),v++),k+=b<128?1:b<2048?2:b<65536?3:4;for(p=s.uint8array?new Uint8Array(k):new Array(k),v=y=0;y<k;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<$&&(64512&(d=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(d-56320),v++),b<128?p[y++]=b:(b<2048?p[y++]=192|b>>>6:(b<65536?p[y++]=224|b>>>12:(p[y++]=240|b>>>18,p[y++]=128|b>>>12&63),p[y++]=128|b>>>6&63),p[y++]=128|63&b);return p}(u)},a.utf8decode=function(u){return s.nodebuffer?i.transformTo("nodebuffer",u).toString("utf-8"):function(m){var p,b,d,v,y=m.length,$=new Array(2*y);for(p=b=0;p<y;)if((d=m[p++])<128)$[b++]=d;else if(4<(v=c[d]))$[b++]=65533,p+=v-1;else{for(d&=v===2?31:v===3?15:7;1<v&&p<y;)d=d<<6|63&m[p++],v--;1<v?$[b++]=65533:d<65536?$[b++]=d:(d-=65536,$[b++]=55296|d>>10&1023,$[b++]=56320|1023&d)}return $.length!==b&&($.subarray?$=$.subarray(0,b):$.length=b),i.applyFromCharCode($)}(u=i.transformTo(s.uint8array?"uint8array":"array",u))},i.inherits(h,l),h.prototype.processChunk=function(u){var m=i.transformTo(s.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(v,y){var $;for((y=y||v.length)>v.length&&(y=v.length),$=y-1;0<=$&&(192&v[$])==128;)$--;return $<0||$===0?y:$+c[v[$]]>y?$:y}(m),d=m;b!==m.length&&(s.uint8array?(d=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(d=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:a.utf8decode(d),meta:u.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=h,i.inherits(g,l),g.prototype.processChunk=function(u){this.push({data:a.utf8encode(u.data),meta:u.meta})},a.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,a){var i=e("./support"),s=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(p){return p}function f(p,b){for(var d=0;d<p.length;++d)b[d]=255&p.charCodeAt(d);return b}e("setimmediate"),a.newBlob=function(p,b){a.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return d.append(p),d.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(p,b,d){var v=[],y=0,$=p.length;if($<=d)return String.fromCharCode.apply(null,p);for(;y<$;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(y,Math.min(y+d,$)))):v.push(String.fromCharCode.apply(null,p.subarray(y,Math.min(y+d,$)))),y+=d;return v.join("")},stringifyByChar:function(p){for(var b="",d=0;d<p.length;d++)b+=String.fromCharCode(p[d]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function g(p){var b=65536,d=a.getTypeOf(p),v=!0;if(d==="uint8array"?v=h.applyCanBeUsed.uint8array:d==="nodebuffer"&&(v=h.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return h.stringifyByChunk(p,d,b)}catch{b=Math.floor(b/2)}return h.stringifyByChar(p)}function u(p,b){for(var d=0;d<p.length;d++)b[d]=p[d];return b}a.applyFromCharCode=g;var m={};m.string={string:c,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:function(p){return f(p,o.allocBuffer(p.length))}},m.array={string:g,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},m.arraybuffer={string:function(p){return g(new Uint8Array(p))},array:function(p){return u(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:g,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return o.newBufferFrom(p)}},m.nodebuffer={string:g,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:c},a.transformTo=function(p,b){if(b=b||"",!p)return b;a.checkSupport(p);var d=a.getTypeOf(b);return m[d][p](b)},a.resolve=function(p){for(var b=p.split("/"),d=[],v=0;v<b.length;v++){var y=b[v];y==="."||y===""&&v!==0&&v!==b.length-1||(y===".."?d.pop():d.push(y))}return d.join("/")},a.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(p)?"nodebuffer":i.uint8array&&p instanceof Uint8Array?"uint8array":i.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(p){if(!i[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(p){var b,d,v="";for(d=0;d<(p||"").length;d++)v+="\\x"+((b=p.charCodeAt(d))<16?"0":"")+b.toString(16).toUpperCase();return v},a.delay=function(p,b,d){setImmediate(function(){p.apply(d||null,b||[])})},a.inherits=function(p,b){function d(){}d.prototype=b.prototype,p.prototype=new d},a.extend=function(){var p,b,d={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&d[b]===void 0&&(d[b]=arguments[p][b]);return d},a.prepareContent=function(p,b,d,v,y){return l.Promise.resolve(b).then(function($){return i.blob&&($ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call($))!==-1)&&typeof FileReader<"u"?new l.Promise(function(k,N){var A=new FileReader;A.onload=function(R){k(R.target.result)},A.onerror=function(R){N(R.target.error)},A.readAsArrayBuffer($)}):$}).then(function($){var k=a.getTypeOf($);return k?(k==="arraybuffer"?$=a.transformTo("uint8array",$):k==="string"&&(y?$=s.decode($):d&&v!==!0&&($=function(N){return f(N,i.uint8array?new Uint8Array(N.length):new Array(N.length))}($))),$):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function f(h){this.files=[],this.loadOptions=h}f.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(g)+", expected "+s.pretty(h)+")")}},isSignature:function(h,g){var u=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===g;return this.reader.setIndex(u),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),g=c.uint8array?"uint8array":"array",u=s.transformTo(g,h);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,g,u,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),g=this.reader.readInt(4),u=this.reader.readData(g),this.zip64ExtensibleData[h]={id:h,length:g,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,g;for(h=0;h<this.files.length;h++)g=this.files[h],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(h=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var g=h;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var m=g-u;if(0<m)this.isSignature(g,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=i(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,a){var i=e("./reader/readerFor"),s=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),f=e("./compressions"),h=e("./support");function g(u,m){this.options=u,this.loadOptions=m}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var m,p;if(u.skip(22),this.fileNameLength=u.readInt(2),p=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var d in f)if(Object.prototype.hasOwnProperty.call(f,d)&&f[d].magic===b)return f[d];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var m=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(m),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var m,p,b,d=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<d;)m=u.readInt(2),p=u.readInt(2),b=u.readData(p),this.extraFields[m]={id:m,length:p,value:b};u.setIndex(d)},handleUTF8:function(){var u=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=s.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var d=s.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(d)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var m=i(u.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var m=i(u.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null}},n.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,a){function i(m,p,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var s=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),f=e("./stream/GenericWorker");i.prototype={internalStream:function(m){var p=null,b="string";try{if(!m)throw new Error("No output type specified.");var d=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!d&&(p=p.pipe(new l.Utf8EncodeWorker)),!v&&d&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(y){(p=new f("error")).error(y)}return new s(p,b,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof c&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,m,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof f?this._data:new o(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<h.length;u++)i.prototype[h[u]]=g;n.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,a){(function(i){var s,o,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var c=0,f=new l(m),h=i.document.createTextNode("");f.observe(h,{characterData:!0}),s=function(){h.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var p=i.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},i.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var g=new i.MessageChannel;g.port1.onmessage=m,s=function(){g.port2.postMessage(0)}}var u=[];function m(){var p,b;o=!0;for(var d=u.length;d;){for(b=u,u=[],p=-1;++p<d;)b[p]();d=u.length}o=!1}n.exports=function(p){u.push(p)!==1||o||s()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,a){var i=e("immediate");function s(){}var o={},l=["REJECTED"],c=["FULFILLED"],f=["PENDING"];function h(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,d!==s&&p(this,d)}function g(d,v,y){this.promise=d,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function u(d,v,y){i(function(){var $;try{$=v(y)}catch(k){return o.reject(d,k)}$===d?o.reject(d,new TypeError("Cannot resolve promise with itself")):o.resolve(d,$)})}function m(d){var v=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof v=="function")return function(){v.apply(d,arguments)}}function p(d,v){var y=!1;function $(A){y||(y=!0,o.reject(d,A))}function k(A){y||(y=!0,o.resolve(d,A))}var N=b(function(){v(k,$)});N.status==="error"&&$(N.value)}function b(d,v){var y={};try{y.value=d(v),y.status="success"}catch($){y.status="error",y.value=$}return y}(n.exports=h).prototype.finally=function(d){if(typeof d!="function")return this;var v=this.constructor;return this.then(function(y){return v.resolve(d()).then(function(){return y})},function(y){return v.resolve(d()).then(function(){throw y})})},h.prototype.catch=function(d){return this.then(null,d)},h.prototype.then=function(d,v){if(typeof d!="function"&&this.state===c||typeof v!="function"&&this.state===l)return this;var y=new this.constructor(s);return this.state!==f?u(y,this.state===c?d:v,this.outcome):this.queue.push(new g(y,d,v)),y},g.prototype.callFulfilled=function(d){o.resolve(this.promise,d)},g.prototype.otherCallFulfilled=function(d){u(this.promise,this.onFulfilled,d)},g.prototype.callRejected=function(d){o.reject(this.promise,d)},g.prototype.otherCallRejected=function(d){u(this.promise,this.onRejected,d)},o.resolve=function(d,v){var y=b(m,v);if(y.status==="error")return o.reject(d,y.value);var $=y.value;if($)p(d,$);else{d.state=c,d.outcome=v;for(var k=-1,N=d.queue.length;++k<N;)d.queue[k].callFulfilled(v)}return d},o.reject=function(d,v){d.state=l,d.outcome=v;for(var y=-1,$=d.queue.length;++y<$;)d.queue[y].callRejected(v);return d},h.resolve=function(d){return d instanceof this?d:o.resolve(new this(s),d)},h.reject=function(d){var v=new this(s);return o.reject(v,d)},h.all=function(d){var v=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=d.length,$=!1;if(!y)return this.resolve([]);for(var k=new Array(y),N=0,A=-1,R=new this(s);++A<y;)P(d[A],A);return R;function P(B,K){v.resolve(B).then(function(E){k[K]=E,++N!==y||$||($=!0,o.resolve(R,k))},function(E){$||($=!0,o.reject(R,E))})}},h.race=function(d){var v=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=d.length,$=!1;if(!y)return this.resolve([]);for(var k=-1,N=new this(s);++k<y;)A=d[k],v.resolve(A).then(function(R){$||($=!0,o.resolve(N,R))},function(R){$||($=!0,o.reject(N,R))});var A;return N}},{immediate:36}],38:[function(e,n,a){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,a){var i=e("./zlib/deflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),f=Object.prototype.toString,h=0,g=-1,u=0,m=8;function p(d){if(!(this instanceof p))return new p(d);this.options=s.assign({level:g,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},d||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=i.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(y!==h)throw new Error(l[y]);if(v.header&&i.deflateSetHeader(this.strm,v.header),v.dictionary){var $;if($=typeof v.dictionary=="string"?o.string2buf(v.dictionary):f.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(y=i.deflateSetDictionary(this.strm,$))!==h)throw new Error(l[y]);this._dict_set=!0}}function b(d,v){var y=new p(v);if(y.push(d,!0),y.err)throw y.msg||l[y.err];return y.result}p.prototype.push=function(d,v){var y,$,k=this.strm,N=this.options.chunkSize;if(this.ended)return!1;$=v===~~v?v:v===!0?4:0,typeof d=="string"?k.input=o.string2buf(d):f.call(d)==="[object ArrayBuffer]"?k.input=new Uint8Array(d):k.input=d,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(N),k.next_out=0,k.avail_out=N),(y=i.deflate(k,$))!==1&&y!==h)return this.onEnd(y),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||$!==4&&$!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(k.output,k.next_out))):this.onData(s.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&y!==1);return $===4?(y=i.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===h):$!==2||(this.onEnd(h),!(k.avail_out=0))},p.prototype.onData=function(d){this.chunks.push(d)},p.prototype.onEnd=function(d){d===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},a.Deflate=p,a.deflate=b,a.deflateRaw=function(d,v){return(v=v||{}).raw=!0,b(d,v)},a.gzip=function(d,v){return(v=v||{}).gzip=!0,b(d,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,a){var i=e("./zlib/inflate"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),f=e("./zlib/zstream"),h=e("./zlib/gzheader"),g=Object.prototype.toString;function u(p){if(!(this instanceof u))return new u(p);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var d=i.inflateInit2(this.strm,b.windowBits);if(d!==l.Z_OK)throw new Error(c[d]);this.header=new h,i.inflateGetHeader(this.strm,this.header)}function m(p,b){var d=new u(b);if(d.push(p,!0),d.err)throw d.msg||c[d.err];return d.result}u.prototype.push=function(p,b){var d,v,y,$,k,N,A=this.strm,R=this.options.chunkSize,P=this.options.dictionary,B=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?A.input=o.binstring2buf(p):g.call(p)==="[object ArrayBuffer]"?A.input=new Uint8Array(p):A.input=p,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new s.Buf8(R),A.next_out=0,A.avail_out=R),(d=i.inflate(A,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&P&&(N=typeof P=="string"?o.string2buf(P):g.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,d=i.inflateSetDictionary(this.strm,N)),d===l.Z_BUF_ERROR&&B===!0&&(d=l.Z_OK,B=!1),d!==l.Z_STREAM_END&&d!==l.Z_OK)return this.onEnd(d),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&d!==l.Z_STREAM_END&&(A.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(A.output,A.next_out),$=A.next_out-y,k=o.buf2string(A.output,y),A.next_out=$,A.avail_out=R-$,$&&s.arraySet(A.output,A.output,y,$,0),this.onData(k)):this.onData(s.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(B=!0)}while((0<A.avail_in||A.avail_out===0)&&d!==l.Z_STREAM_END);return d===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(d=i.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(A.avail_out=0))},u.prototype.onData=function(p){this.chunks.push(p)},u.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},a.Inflate=u,a.inflate=m,a.inflateRaw=function(p,b){return(b=b||{}).raw=!0,m(p,b)},a.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var f=c.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var h in f)f.hasOwnProperty(h)&&(l[h]=f[h])}}return l},a.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var s={arraySet:function(l,c,f,h,g){if(c.subarray&&l.subarray)l.set(c.subarray(f,f+h),g);else for(var u=0;u<h;u++)l[g+u]=c[f+u]},flattenChunks:function(l){var c,f,h,g,u,m;for(c=h=0,f=l.length;c<f;c++)h+=l[c].length;for(m=new Uint8Array(h),c=g=0,f=l.length;c<f;c++)u=l[c],m.set(u,g),g+=u.length;return m}},o={arraySet:function(l,c,f,h,g){for(var u=0;u<h;u++)l[g+u]=c[f+u]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,o))},a.setTyped(i)},{}],42:[function(e,n,a){var i=e("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new i.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function f(h,g){if(g<65537&&(h.subarray&&o||!h.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(h,g));for(var u="",m=0;m<g;m++)u+=String.fromCharCode(h[m]);return u}l[254]=l[254]=1,a.string2buf=function(h){var g,u,m,p,b,d=h.length,v=0;for(p=0;p<d;p++)(64512&(u=h.charCodeAt(p)))==55296&&p+1<d&&(64512&(m=h.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),v+=u<128?1:u<2048?2:u<65536?3:4;for(g=new i.Buf8(v),p=b=0;b<v;p++)(64512&(u=h.charCodeAt(p)))==55296&&p+1<d&&(64512&(m=h.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),u<128?g[b++]=u:(u<2048?g[b++]=192|u>>>6:(u<65536?g[b++]=224|u>>>12:(g[b++]=240|u>>>18,g[b++]=128|u>>>12&63),g[b++]=128|u>>>6&63),g[b++]=128|63&u);return g},a.buf2binstring=function(h){return f(h,h.length)},a.binstring2buf=function(h){for(var g=new i.Buf8(h.length),u=0,m=g.length;u<m;u++)g[u]=h.charCodeAt(u);return g},a.buf2string=function(h,g){var u,m,p,b,d=g||h.length,v=new Array(2*d);for(u=m=0;u<d;)if((p=h[u++])<128)v[m++]=p;else if(4<(b=l[p]))v[m++]=65533,u+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&u<d;)p=p<<6|63&h[u++],b--;1<b?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return f(v,m)},a.utf8border=function(h,g){var u;for((g=g||h.length)>h.length&&(g=h.length),u=g-1;0<=u&&(192&h[u])==128;)u--;return u<0||u===0?g:u+l[h[u]]>g?u:g}},{"./common":41}],43:[function(e,n,a){n.exports=function(i,s,o,l){for(var c=65535&i|0,f=i>>>16&65535|0,h=0;o!==0;){for(o-=h=2e3<o?2e3:o;f=f+(c=c+s[l++]|0)|0,--h;);c%=65521,f%=65521}return c|f<<16|0}},{}],44:[function(e,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,a){var i=function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o}();n.exports=function(s,o,l,c){var f=i,h=c+l;s^=-1;for(var g=c;g<h;g++)s=s>>>8^f[255&(s^o[g])];return-1^s}},{}],46:[function(e,n,a){var i,s=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),f=e("./messages"),h=0,g=4,u=0,m=-2,p=-1,b=4,d=2,v=8,y=9,$=286,k=30,N=19,A=2*$+1,R=15,P=3,B=258,K=B+P+1,E=42,L=113,_=1,W=2,st=3,V=4;function ot(w,H){return w.msg=f[H],H}function G(w){return(w<<1)-(4<w?9:0)}function ft(w){for(var H=w.length;0<=--H;)w[H]=0}function I(w){var H=w.state,M=H.pending;M>w.avail_out&&(M=w.avail_out),M!==0&&(s.arraySet(w.output,H.pending_buf,H.pending_out,M,w.next_out),w.next_out+=M,H.pending_out+=M,w.total_out+=M,w.avail_out-=M,H.pending-=M,H.pending===0&&(H.pending_out=0))}function O(w,H){o._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,H),w.block_start=w.strstart,I(w.strm)}function lt(w,H){w.pending_buf[w.pending++]=H}function U(w,H){w.pending_buf[w.pending++]=H>>>8&255,w.pending_buf[w.pending++]=255&H}function X(w,H){var M,x,C=w.max_chain_length,j=w.strstart,Z=w.prev_length,Y=w.nice_match,T=w.strstart>w.w_size-K?w.strstart-(w.w_size-K):0,J=w.window,at=w.w_mask,tt=w.prev,z=w.strstart+B,rt=J[j+Z-1],it=J[j+Z];w.prev_length>=w.good_match&&(C>>=2),Y>w.lookahead&&(Y=w.lookahead);do if(J[(M=H)+Z]===it&&J[M+Z-1]===rt&&J[M]===J[j]&&J[++M]===J[j+1]){j+=2,M++;do;while(J[++j]===J[++M]&&J[++j]===J[++M]&&J[++j]===J[++M]&&J[++j]===J[++M]&&J[++j]===J[++M]&&J[++j]===J[++M]&&J[++j]===J[++M]&&J[++j]===J[++M]&&j<z);if(x=B-(z-j),j=z-B,Z<x){if(w.match_start=H,Y<=(Z=x))break;rt=J[j+Z-1],it=J[j+Z]}}while((H=tt[H&at])>T&&--C!=0);return Z<=w.lookahead?Z:w.lookahead}function $t(w){var H,M,x,C,j,Z,Y,T,J,at,tt=w.w_size;do{if(C=w.window_size-w.lookahead-w.strstart,w.strstart>=tt+(tt-K)){for(s.arraySet(w.window,w.window,tt,tt,0),w.match_start-=tt,w.strstart-=tt,w.block_start-=tt,H=M=w.hash_size;x=w.head[--H],w.head[H]=tt<=x?x-tt:0,--M;);for(H=M=tt;x=w.prev[--H],w.prev[H]=tt<=x?x-tt:0,--M;);C+=tt}if(w.strm.avail_in===0)break;if(Z=w.strm,Y=w.window,T=w.strstart+w.lookahead,J=C,at=void 0,at=Z.avail_in,J<at&&(at=J),M=at===0?0:(Z.avail_in-=at,s.arraySet(Y,Z.input,Z.next_in,at,T),Z.state.wrap===1?Z.adler=l(Z.adler,Y,at,T):Z.state.wrap===2&&(Z.adler=c(Z.adler,Y,at,T)),Z.next_in+=at,Z.total_in+=at,at),w.lookahead+=M,w.lookahead+w.insert>=P)for(j=w.strstart-w.insert,w.ins_h=w.window[j],w.ins_h=(w.ins_h<<w.hash_shift^w.window[j+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[j+P-1])&w.hash_mask,w.prev[j&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=j,j++,w.insert--,!(w.lookahead+w.insert<P)););}while(w.lookahead<K&&w.strm.avail_in!==0)}function jt(w,H){for(var M,x;;){if(w.lookahead<K){if($t(w),w.lookahead<K&&H===h)return _;if(w.lookahead===0)break}if(M=0,w.lookahead>=P&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+P-1])&w.hash_mask,M=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),M!==0&&w.strstart-M<=w.w_size-K&&(w.match_length=X(w,M)),w.match_length>=P)if(x=o._tr_tally(w,w.strstart-w.match_start,w.match_length-P),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=P){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+P-1])&w.hash_mask,M=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else x=o._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(x&&(O(w,!1),w.strm.avail_out===0))return _}return w.insert=w.strstart<P-1?w.strstart:P-1,H===g?(O(w,!0),w.strm.avail_out===0?st:V):w.last_lit&&(O(w,!1),w.strm.avail_out===0)?_:W}function vt(w,H){for(var M,x,C;;){if(w.lookahead<K){if($t(w),w.lookahead<K&&H===h)return _;if(w.lookahead===0)break}if(M=0,w.lookahead>=P&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+P-1])&w.hash_mask,M=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=P-1,M!==0&&w.prev_length<w.max_lazy_match&&w.strstart-M<=w.w_size-K&&(w.match_length=X(w,M),w.match_length<=5&&(w.strategy===1||w.match_length===P&&4096<w.strstart-w.match_start)&&(w.match_length=P-1)),w.prev_length>=P&&w.match_length<=w.prev_length){for(C=w.strstart+w.lookahead-P,x=o._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-P),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=C&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+P-1])&w.hash_mask,M=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=P-1,w.strstart++,x&&(O(w,!1),w.strm.avail_out===0))return _}else if(w.match_available){if((x=o._tr_tally(w,0,w.window[w.strstart-1]))&&O(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return _}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(x=o._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<P-1?w.strstart:P-1,H===g?(O(w,!0),w.strm.avail_out===0?st:V):w.last_lit&&(O(w,!1),w.strm.avail_out===0)?_:W}function yt(w,H,M,x,C){this.good_length=w,this.max_lazy=H,this.nice_length=M,this.max_chain=x,this.func=C}function Nt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*A),this.dyn_dtree=new s.Buf16(2*(2*k+1)),this.bl_tree=new s.Buf16(2*(2*N+1)),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(R+1),this.heap=new s.Buf16(2*$+1),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*$+1),ft(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dt(w){var H;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=d,(H=w.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?E:L,w.adler=H.wrap===2?0:1,H.last_flush=h,o._tr_init(H),u):ot(w,m)}function ee(w){var H=Dt(w);return H===u&&function(M){M.window_size=2*M.w_size,ft(M.head),M.max_lazy_match=i[M.level].max_lazy,M.good_match=i[M.level].good_length,M.nice_match=i[M.level].nice_length,M.max_chain_length=i[M.level].max_chain,M.strstart=0,M.block_start=0,M.lookahead=0,M.insert=0,M.match_length=M.prev_length=P-1,M.match_available=0,M.ins_h=0}(w.state),H}function Wt(w,H,M,x,C,j){if(!w)return m;var Z=1;if(H===p&&(H=6),x<0?(Z=0,x=-x):15<x&&(Z=2,x-=16),C<1||y<C||M!==v||x<8||15<x||H<0||9<H||j<0||b<j)return ot(w,m);x===8&&(x=9);var Y=new Nt;return(w.state=Y).strm=w,Y.wrap=Z,Y.gzhead=null,Y.w_bits=x,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=C+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+P-1)/P),Y.window=new s.Buf8(2*Y.w_size),Y.head=new s.Buf16(Y.hash_size),Y.prev=new s.Buf16(Y.w_size),Y.lit_bufsize=1<<C+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new s.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=H,Y.strategy=j,Y.method=M,ee(w)}i=[new yt(0,0,0,0,function(w,H){var M=65535;for(M>w.pending_buf_size-5&&(M=w.pending_buf_size-5);;){if(w.lookahead<=1){if($t(w),w.lookahead===0&&H===h)return _;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var x=w.block_start+M;if((w.strstart===0||w.strstart>=x)&&(w.lookahead=w.strstart-x,w.strstart=x,O(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-K&&(O(w,!1),w.strm.avail_out===0))return _}return w.insert=0,H===g?(O(w,!0),w.strm.avail_out===0?st:V):(w.strstart>w.block_start&&(O(w,!1),w.strm.avail_out),_)}),new yt(4,4,8,4,jt),new yt(4,5,16,8,jt),new yt(4,6,32,32,jt),new yt(4,4,16,16,vt),new yt(8,16,32,32,vt),new yt(8,16,128,128,vt),new yt(8,32,128,256,vt),new yt(32,128,258,1024,vt),new yt(32,258,258,4096,vt)],a.deflateInit=function(w,H){return Wt(w,H,v,15,8,0)},a.deflateInit2=Wt,a.deflateReset=ee,a.deflateResetKeep=Dt,a.deflateSetHeader=function(w,H){return w&&w.state?w.state.wrap!==2?m:(w.state.gzhead=H,u):m},a.deflate=function(w,H){var M,x,C,j;if(!w||!w.state||5<H||H<0)return w?ot(w,m):m;if(x=w.state,!w.output||!w.input&&w.avail_in!==0||x.status===666&&H!==g)return ot(w,w.avail_out===0?-5:m);if(x.strm=w,M=x.last_flush,x.last_flush=H,x.status===E)if(x.wrap===2)w.adler=0,lt(x,31),lt(x,139),lt(x,8),x.gzhead?(lt(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),lt(x,255&x.gzhead.time),lt(x,x.gzhead.time>>8&255),lt(x,x.gzhead.time>>16&255),lt(x,x.gzhead.time>>24&255),lt(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),lt(x,255&x.gzhead.os),x.gzhead.extra&&x.gzhead.extra.length&&(lt(x,255&x.gzhead.extra.length),lt(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(w.adler=c(w.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=69):(lt(x,0),lt(x,0),lt(x,0),lt(x,0),lt(x,0),lt(x,x.level===9?2:2<=x.strategy||x.level<2?4:0),lt(x,3),x.status=L);else{var Z=v+(x.w_bits-8<<4)<<8;Z|=(2<=x.strategy||x.level<2?0:x.level<6?1:x.level===6?2:3)<<6,x.strstart!==0&&(Z|=32),Z+=31-Z%31,x.status=L,U(x,Z),x.strstart!==0&&(U(x,w.adler>>>16),U(x,65535&w.adler)),w.adler=1}if(x.status===69)if(x.gzhead.extra){for(C=x.pending;x.gzindex<(65535&x.gzhead.extra.length)&&(x.pending!==x.pending_buf_size||(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),I(w),C=x.pending,x.pending!==x.pending_buf_size));)lt(x,255&x.gzhead.extra[x.gzindex]),x.gzindex++;x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=73)}else x.status=73;if(x.status===73)if(x.gzhead.name){C=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),I(w),C=x.pending,x.pending===x.pending_buf_size)){j=1;break}j=x.gzindex<x.gzhead.name.length?255&x.gzhead.name.charCodeAt(x.gzindex++):0,lt(x,j)}while(j!==0);x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),j===0&&(x.gzindex=0,x.status=91)}else x.status=91;if(x.status===91)if(x.gzhead.comment){C=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),I(w),C=x.pending,x.pending===x.pending_buf_size)){j=1;break}j=x.gzindex<x.gzhead.comment.length?255&x.gzhead.comment.charCodeAt(x.gzindex++):0,lt(x,j)}while(j!==0);x.gzhead.hcrc&&x.pending>C&&(w.adler=c(w.adler,x.pending_buf,x.pending-C,C)),j===0&&(x.status=103)}else x.status=103;if(x.status===103&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&I(w),x.pending+2<=x.pending_buf_size&&(lt(x,255&w.adler),lt(x,w.adler>>8&255),w.adler=0,x.status=L)):x.status=L),x.pending!==0){if(I(w),w.avail_out===0)return x.last_flush=-1,u}else if(w.avail_in===0&&G(H)<=G(M)&&H!==g)return ot(w,-5);if(x.status===666&&w.avail_in!==0)return ot(w,-5);if(w.avail_in!==0||x.lookahead!==0||H!==h&&x.status!==666){var Y=x.strategy===2?function(T,J){for(var at;;){if(T.lookahead===0&&($t(T),T.lookahead===0)){if(J===h)return _;break}if(T.match_length=0,at=o._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++,at&&(O(T,!1),T.strm.avail_out===0))return _}return T.insert=0,J===g?(O(T,!0),T.strm.avail_out===0?st:V):T.last_lit&&(O(T,!1),T.strm.avail_out===0)?_:W}(x,H):x.strategy===3?function(T,J){for(var at,tt,z,rt,it=T.window;;){if(T.lookahead<=B){if($t(T),T.lookahead<=B&&J===h)return _;if(T.lookahead===0)break}if(T.match_length=0,T.lookahead>=P&&0<T.strstart&&(tt=it[z=T.strstart-1])===it[++z]&&tt===it[++z]&&tt===it[++z]){rt=T.strstart+B;do;while(tt===it[++z]&&tt===it[++z]&&tt===it[++z]&&tt===it[++z]&&tt===it[++z]&&tt===it[++z]&&tt===it[++z]&&tt===it[++z]&&z<rt);T.match_length=B-(rt-z),T.match_length>T.lookahead&&(T.match_length=T.lookahead)}if(T.match_length>=P?(at=o._tr_tally(T,1,T.match_length-P),T.lookahead-=T.match_length,T.strstart+=T.match_length,T.match_length=0):(at=o._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++),at&&(O(T,!1),T.strm.avail_out===0))return _}return T.insert=0,J===g?(O(T,!0),T.strm.avail_out===0?st:V):T.last_lit&&(O(T,!1),T.strm.avail_out===0)?_:W}(x,H):i[x.level].func(x,H);if(Y!==st&&Y!==V||(x.status=666),Y===_||Y===st)return w.avail_out===0&&(x.last_flush=-1),u;if(Y===W&&(H===1?o._tr_align(x):H!==5&&(o._tr_stored_block(x,0,0,!1),H===3&&(ft(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),I(w),w.avail_out===0))return x.last_flush=-1,u}return H!==g?u:x.wrap<=0?1:(x.wrap===2?(lt(x,255&w.adler),lt(x,w.adler>>8&255),lt(x,w.adler>>16&255),lt(x,w.adler>>24&255),lt(x,255&w.total_in),lt(x,w.total_in>>8&255),lt(x,w.total_in>>16&255),lt(x,w.total_in>>24&255)):(U(x,w.adler>>>16),U(x,65535&w.adler)),I(w),0<x.wrap&&(x.wrap=-x.wrap),x.pending!==0?u:1)},a.deflateEnd=function(w){var H;return w&&w.state?(H=w.state.status)!==E&&H!==69&&H!==73&&H!==91&&H!==103&&H!==L&&H!==666?ot(w,m):(w.state=null,H===L?ot(w,-3):u):m},a.deflateSetDictionary=function(w,H){var M,x,C,j,Z,Y,T,J,at=H.length;if(!w||!w.state||(j=(M=w.state).wrap)===2||j===1&&M.status!==E||M.lookahead)return m;for(j===1&&(w.adler=l(w.adler,H,at,0)),M.wrap=0,at>=M.w_size&&(j===0&&(ft(M.head),M.strstart=0,M.block_start=0,M.insert=0),J=new s.Buf8(M.w_size),s.arraySet(J,H,at-M.w_size,M.w_size,0),H=J,at=M.w_size),Z=w.avail_in,Y=w.next_in,T=w.input,w.avail_in=at,w.next_in=0,w.input=H,$t(M);M.lookahead>=P;){for(x=M.strstart,C=M.lookahead-(P-1);M.ins_h=(M.ins_h<<M.hash_shift^M.window[x+P-1])&M.hash_mask,M.prev[x&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=x,x++,--C;);M.strstart=x,M.lookahead=P-1,$t(M)}return M.strstart+=M.lookahead,M.block_start=M.strstart,M.insert=M.lookahead,M.lookahead=0,M.match_length=M.prev_length=P-1,M.match_available=0,w.next_in=Y,w.input=T,w.avail_in=Z,M.wrap=j,u},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,a){n.exports=function(i,s){var o,l,c,f,h,g,u,m,p,b,d,v,y,$,k,N,A,R,P,B,K,E,L,_,W;o=i.state,l=i.next_in,_=i.input,c=l+(i.avail_in-5),f=i.next_out,W=i.output,h=f-(s-i.avail_out),g=f+(i.avail_out-257),u=o.dmax,m=o.wsize,p=o.whave,b=o.wnext,d=o.window,v=o.hold,y=o.bits,$=o.lencode,k=o.distcode,N=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;t:do{y<15&&(v+=_[l++]<<y,y+=8,v+=_[l++]<<y,y+=8),R=$[v&N];e:for(;;){if(v>>>=P=R>>>24,y-=P,(P=R>>>16&255)===0)W[f++]=65535&R;else{if(!(16&P)){if(!(64&P)){R=$[(65535&R)+(v&(1<<P)-1)];continue e}if(32&P){o.mode=12;break t}i.msg="invalid literal/length code",o.mode=30;break t}B=65535&R,(P&=15)&&(y<P&&(v+=_[l++]<<y,y+=8),B+=v&(1<<P)-1,v>>>=P,y-=P),y<15&&(v+=_[l++]<<y,y+=8,v+=_[l++]<<y,y+=8),R=k[v&A];n:for(;;){if(v>>>=P=R>>>24,y-=P,!(16&(P=R>>>16&255))){if(!(64&P)){R=k[(65535&R)+(v&(1<<P)-1)];continue n}i.msg="invalid distance code",o.mode=30;break t}if(K=65535&R,y<(P&=15)&&(v+=_[l++]<<y,(y+=8)<P&&(v+=_[l++]<<y,y+=8)),u<(K+=v&(1<<P)-1)){i.msg="invalid distance too far back",o.mode=30;break t}if(v>>>=P,y-=P,(P=f-h)<K){if(p<(P=K-P)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break t}if(L=d,(E=0)===b){if(E+=m-P,P<B){for(B-=P;W[f++]=d[E++],--P;);E=f-K,L=W}}else if(b<P){if(E+=m+b-P,(P-=b)<B){for(B-=P;W[f++]=d[E++],--P;);if(E=0,b<B){for(B-=P=b;W[f++]=d[E++],--P;);E=f-K,L=W}}}else if(E+=b-P,P<B){for(B-=P;W[f++]=d[E++],--P;);E=f-K,L=W}for(;2<B;)W[f++]=L[E++],W[f++]=L[E++],W[f++]=L[E++],B-=3;B&&(W[f++]=L[E++],1<B&&(W[f++]=L[E++]))}else{for(E=f-K;W[f++]=W[E++],W[f++]=W[E++],W[f++]=W[E++],2<(B-=3););B&&(W[f++]=W[E++],1<B&&(W[f++]=W[E++]))}break}}break}}while(l<c&&f<g);l-=B=y>>3,v&=(1<<(y-=B<<3))-1,i.next_in=l,i.next_out=f,i.avail_in=l<c?c-l+5:5-(l-c),i.avail_out=f<g?g-f+257:257-(f-g),o.hold=v,o.bits=y}},{}],49:[function(e,n,a){var i=e("../utils/common"),s=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),f=1,h=2,g=0,u=-2,m=1,p=852,b=592;function d(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(E){var L;return E&&E.state?(L=E.state,E.total_in=E.total_out=L.total=0,E.msg="",L.wrap&&(E.adler=1&L.wrap),L.mode=m,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new i.Buf32(p),L.distcode=L.distdyn=new i.Buf32(b),L.sane=1,L.back=-1,g):u}function $(E){var L;return E&&E.state?((L=E.state).wsize=0,L.whave=0,L.wnext=0,y(E)):u}function k(E,L){var _,W;return E&&E.state?(W=E.state,L<0?(_=0,L=-L):(_=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?u:(W.window!==null&&W.wbits!==L&&(W.window=null),W.wrap=_,W.wbits=L,$(E))):u}function N(E,L){var _,W;return E?(W=new v,(E.state=W).window=null,(_=k(E,L))!==g&&(E.state=null),_):u}var A,R,P=!0;function B(E){if(P){var L;for(A=new i.Buf32(512),R=new i.Buf32(32),L=0;L<144;)E.lens[L++]=8;for(;L<256;)E.lens[L++]=9;for(;L<280;)E.lens[L++]=7;for(;L<288;)E.lens[L++]=8;for(c(f,E.lens,0,288,A,0,E.work,{bits:9}),L=0;L<32;)E.lens[L++]=5;c(h,E.lens,0,32,R,0,E.work,{bits:5}),P=!1}E.lencode=A,E.lenbits=9,E.distcode=R,E.distbits=5}function K(E,L,_,W){var st,V=E.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new i.Buf8(V.wsize)),W>=V.wsize?(i.arraySet(V.window,L,_-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(W<(st=V.wsize-V.wnext)&&(st=W),i.arraySet(V.window,L,_-W,st,V.wnext),(W-=st)?(i.arraySet(V.window,L,_-W,W,0),V.wnext=W,V.whave=V.wsize):(V.wnext+=st,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=st))),0}a.inflateReset=$,a.inflateReset2=k,a.inflateResetKeep=y,a.inflateInit=function(E){return N(E,15)},a.inflateInit2=N,a.inflate=function(E,L){var _,W,st,V,ot,G,ft,I,O,lt,U,X,$t,jt,vt,yt,Nt,Dt,ee,Wt,w,H,M,x,C=0,j=new i.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return u;(_=E.state).mode===12&&(_.mode=13),ot=E.next_out,st=E.output,ft=E.avail_out,V=E.next_in,W=E.input,G=E.avail_in,I=_.hold,O=_.bits,lt=G,U=ft,H=g;t:for(;;)switch(_.mode){case m:if(_.wrap===0){_.mode=13;break}for(;O<16;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(2&_.wrap&&I===35615){j[_.check=0]=255&I,j[1]=I>>>8&255,_.check=o(_.check,j,2,0),O=I=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&I)<<8)+(I>>8))%31){E.msg="incorrect header check",_.mode=30;break}if((15&I)!=8){E.msg="unknown compression method",_.mode=30;break}if(O-=4,w=8+(15&(I>>>=4)),_.wbits===0)_.wbits=w;else if(w>_.wbits){E.msg="invalid window size",_.mode=30;break}_.dmax=1<<w,E.adler=_.check=1,_.mode=512&I?10:12,O=I=0;break;case 2:for(;O<16;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(_.flags=I,(255&_.flags)!=8){E.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){E.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=I>>8&1),512&_.flags&&(j[0]=255&I,j[1]=I>>>8&255,_.check=o(_.check,j,2,0)),O=I=0,_.mode=3;case 3:for(;O<32;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}_.head&&(_.head.time=I),512&_.flags&&(j[0]=255&I,j[1]=I>>>8&255,j[2]=I>>>16&255,j[3]=I>>>24&255,_.check=o(_.check,j,4,0)),O=I=0,_.mode=4;case 4:for(;O<16;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}_.head&&(_.head.xflags=255&I,_.head.os=I>>8),512&_.flags&&(j[0]=255&I,j[1]=I>>>8&255,_.check=o(_.check,j,2,0)),O=I=0,_.mode=5;case 5:if(1024&_.flags){for(;O<16;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}_.length=I,_.head&&(_.head.extra_len=I),512&_.flags&&(j[0]=255&I,j[1]=I>>>8&255,_.check=o(_.check,j,2,0)),O=I=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(G<(X=_.length)&&(X=G),X&&(_.head&&(w=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),i.arraySet(_.head.extra,W,V,X,w)),512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,_.length-=X),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(G===0)break t;for(X=0;w=W[V+X++],_.head&&w&&_.length<65536&&(_.head.name+=String.fromCharCode(w)),w&&X<G;);if(512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,w)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(G===0)break t;for(X=0;w=W[V+X++],_.head&&w&&_.length<65536&&(_.head.comment+=String.fromCharCode(w)),w&&X<G;);if(512&_.flags&&(_.check=o(_.check,W,X,V)),G-=X,V+=X,w)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;O<16;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(I!==(65535&_.check)){E.msg="header crc mismatch",_.mode=30;break}O=I=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),E.adler=_.check=0,_.mode=12;break;case 10:for(;O<32;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}E.adler=_.check=d(I),O=I=0,_.mode=11;case 11:if(_.havedict===0)return E.next_out=ot,E.avail_out=ft,E.next_in=V,E.avail_in=G,_.hold=I,_.bits=O,2;E.adler=_.check=1,_.mode=12;case 12:if(L===5||L===6)break t;case 13:if(_.last){I>>>=7&O,O-=7&O,_.mode=27;break}for(;O<3;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}switch(_.last=1&I,O-=1,3&(I>>>=1)){case 0:_.mode=14;break;case 1:if(B(_),_.mode=20,L!==6)break;I>>>=2,O-=2;break t;case 2:_.mode=17;break;case 3:E.msg="invalid block type",_.mode=30}I>>>=2,O-=2;break;case 14:for(I>>>=7&O,O-=7&O;O<32;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if((65535&I)!=(I>>>16^65535)){E.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&I,O=I=0,_.mode=15,L===6)break t;case 15:_.mode=16;case 16:if(X=_.length){if(G<X&&(X=G),ft<X&&(X=ft),X===0)break t;i.arraySet(st,W,V,X,ot),G-=X,V+=X,ft-=X,ot+=X,_.length-=X;break}_.mode=12;break;case 17:for(;O<14;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(_.nlen=257+(31&I),I>>>=5,O-=5,_.ndist=1+(31&I),I>>>=5,O-=5,_.ncode=4+(15&I),I>>>=4,O-=4,286<_.nlen||30<_.ndist){E.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;O<3;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}_.lens[Z[_.have++]]=7&I,I>>>=3,O-=3}for(;_.have<19;)_.lens[Z[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,M={bits:_.lenbits},H=c(0,_.lens,0,19,_.lencode,0,_.work,M),_.lenbits=M.bits,H){E.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;yt=(C=_.lencode[I&(1<<_.lenbits)-1])>>>16&255,Nt=65535&C,!((vt=C>>>24)<=O);){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(Nt<16)I>>>=vt,O-=vt,_.lens[_.have++]=Nt;else{if(Nt===16){for(x=vt+2;O<x;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(I>>>=vt,O-=vt,_.have===0){E.msg="invalid bit length repeat",_.mode=30;break}w=_.lens[_.have-1],X=3+(3&I),I>>>=2,O-=2}else if(Nt===17){for(x=vt+3;O<x;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}O-=vt,w=0,X=3+(7&(I>>>=vt)),I>>>=3,O-=3}else{for(x=vt+7;O<x;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}O-=vt,w=0,X=11+(127&(I>>>=vt)),I>>>=7,O-=7}if(_.have+X>_.nlen+_.ndist){E.msg="invalid bit length repeat",_.mode=30;break}for(;X--;)_.lens[_.have++]=w}}if(_.mode===30)break;if(_.lens[256]===0){E.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,M={bits:_.lenbits},H=c(f,_.lens,0,_.nlen,_.lencode,0,_.work,M),_.lenbits=M.bits,H){E.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,M={bits:_.distbits},H=c(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,M),_.distbits=M.bits,H){E.msg="invalid distances set",_.mode=30;break}if(_.mode=20,L===6)break t;case 20:_.mode=21;case 21:if(6<=G&&258<=ft){E.next_out=ot,E.avail_out=ft,E.next_in=V,E.avail_in=G,_.hold=I,_.bits=O,l(E,U),ot=E.next_out,st=E.output,ft=E.avail_out,V=E.next_in,W=E.input,G=E.avail_in,I=_.hold,O=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;yt=(C=_.lencode[I&(1<<_.lenbits)-1])>>>16&255,Nt=65535&C,!((vt=C>>>24)<=O);){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(yt&&!(240&yt)){for(Dt=vt,ee=yt,Wt=Nt;yt=(C=_.lencode[Wt+((I&(1<<Dt+ee)-1)>>Dt)])>>>16&255,Nt=65535&C,!(Dt+(vt=C>>>24)<=O);){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}I>>>=Dt,O-=Dt,_.back+=Dt}if(I>>>=vt,O-=vt,_.back+=vt,_.length=Nt,yt===0){_.mode=26;break}if(32&yt){_.back=-1,_.mode=12;break}if(64&yt){E.msg="invalid literal/length code",_.mode=30;break}_.extra=15&yt,_.mode=22;case 22:if(_.extra){for(x=_.extra;O<x;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}_.length+=I&(1<<_.extra)-1,I>>>=_.extra,O-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;yt=(C=_.distcode[I&(1<<_.distbits)-1])>>>16&255,Nt=65535&C,!((vt=C>>>24)<=O);){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(!(240&yt)){for(Dt=vt,ee=yt,Wt=Nt;yt=(C=_.distcode[Wt+((I&(1<<Dt+ee)-1)>>Dt)])>>>16&255,Nt=65535&C,!(Dt+(vt=C>>>24)<=O);){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}I>>>=Dt,O-=Dt,_.back+=Dt}if(I>>>=vt,O-=vt,_.back+=vt,64&yt){E.msg="invalid distance code",_.mode=30;break}_.offset=Nt,_.extra=15&yt,_.mode=24;case 24:if(_.extra){for(x=_.extra;O<x;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}_.offset+=I&(1<<_.extra)-1,I>>>=_.extra,O-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){E.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ft===0)break t;if(X=U-ft,_.offset>X){if((X=_.offset-X)>_.whave&&_.sane){E.msg="invalid distance too far back",_.mode=30;break}$t=X>_.wnext?(X-=_.wnext,_.wsize-X):_.wnext-X,X>_.length&&(X=_.length),jt=_.window}else jt=st,$t=ot-_.offset,X=_.length;for(ft<X&&(X=ft),ft-=X,_.length-=X;st[ot++]=jt[$t++],--X;);_.length===0&&(_.mode=21);break;case 26:if(ft===0)break t;st[ot++]=_.length,ft--,_.mode=21;break;case 27:if(_.wrap){for(;O<32;){if(G===0)break t;G--,I|=W[V++]<<O,O+=8}if(U-=ft,E.total_out+=U,_.total+=U,U&&(E.adler=_.check=_.flags?o(_.check,st,U,ot-U):s(_.check,st,U,ot-U)),U=ft,(_.flags?I:d(I))!==_.check){E.msg="incorrect data check",_.mode=30;break}O=I=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;O<32;){if(G===0)break t;G--,I+=W[V++]<<O,O+=8}if(I!==(4294967295&_.total)){E.msg="incorrect length check",_.mode=30;break}O=I=0}_.mode=29;case 29:H=1;break t;case 30:H=-3;break t;case 31:return-4;case 32:default:return u}return E.next_out=ot,E.avail_out=ft,E.next_in=V,E.avail_in=G,_.hold=I,_.bits=O,(_.wsize||U!==E.avail_out&&_.mode<30&&(_.mode<27||L!==4))&&K(E,E.output,E.next_out,U-E.avail_out)?(_.mode=31,-4):(lt-=E.avail_in,U-=E.avail_out,E.total_in+=lt,E.total_out+=U,_.total+=U,_.wrap&&U&&(E.adler=_.check=_.flags?o(_.check,st,U,E.next_out-U):s(_.check,st,U,E.next_out-U)),E.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(lt==0&&U===0||L===4)&&H===g&&(H=-5),H)},a.inflateEnd=function(E){if(!E||!E.state)return u;var L=E.state;return L.window&&(L.window=null),E.state=null,g},a.inflateGetHeader=function(E,L){var _;return E&&E.state&&2&(_=E.state).wrap?((_.head=L).done=!1,g):u},a.inflateSetDictionary=function(E,L){var _,W=L.length;return E&&E.state?(_=E.state).wrap!==0&&_.mode!==11?u:_.mode===11&&s(1,L,W,0)!==_.check?-3:K(E,L,W,W)?(_.mode=31,-4):(_.havedict=1,g):u},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,a){var i=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,h,g,u,m,p,b,d){var v,y,$,k,N,A,R,P,B,K=d.bits,E=0,L=0,_=0,W=0,st=0,V=0,ot=0,G=0,ft=0,I=0,O=null,lt=0,U=new i.Buf16(16),X=new i.Buf16(16),$t=null,jt=0;for(E=0;E<=15;E++)U[E]=0;for(L=0;L<u;L++)U[h[g+L]]++;for(st=K,W=15;1<=W&&U[W]===0;W--);if(W<st&&(st=W),W===0)return m[p++]=20971520,m[p++]=20971520,d.bits=1,0;for(_=1;_<W&&U[_]===0;_++);for(st<_&&(st=_),E=G=1;E<=15;E++)if(G<<=1,(G-=U[E])<0)return-1;if(0<G&&(f===0||W!==1))return-1;for(X[1]=0,E=1;E<15;E++)X[E+1]=X[E]+U[E];for(L=0;L<u;L++)h[g+L]!==0&&(b[X[h[g+L]]++]=L);if(A=f===0?(O=$t=b,19):f===1?(O=s,lt-=257,$t=o,jt-=257,256):(O=l,$t=c,-1),E=_,N=p,ot=L=I=0,$=-1,k=(ft=1<<(V=st))-1,f===1&&852<ft||f===2&&592<ft)return 1;for(;;){for(R=E-ot,B=b[L]<A?(P=0,b[L]):b[L]>A?(P=$t[jt+b[L]],O[lt+b[L]]):(P=96,0),v=1<<E-ot,_=y=1<<V;m[N+(I>>ot)+(y-=v)]=R<<24|P<<16|B|0,y!==0;);for(v=1<<E-1;I&v;)v>>=1;if(v!==0?(I&=v-1,I+=v):I=0,L++,--U[E]==0){if(E===W)break;E=h[g+b[L]]}if(st<E&&(I&k)!==$){for(ot===0&&(ot=st),N+=_,G=1<<(V=E-ot);V+ot<W&&!((G-=U[V+ot])<=0);)V++,G<<=1;if(ft+=1<<V,f===1&&852<ft||f===2&&592<ft)return 1;m[$=I&k]=st<<24|V<<16|N-p|0}}return I!==0&&(m[N+I]=E-ot<<24|64<<16|0),d.bits=st,0}},{"../utils/common":41}],51:[function(e,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,a){var i=e("../utils/common"),s=0,o=1;function l(C){for(var j=C.length;0<=--j;)C[j]=0}var c=0,f=29,h=256,g=h+1+f,u=30,m=19,p=2*g+1,b=15,d=16,v=7,y=256,$=16,k=17,N=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(g+2));l(K);var E=new Array(2*u);l(E);var L=new Array(512);l(L);var _=new Array(256);l(_);var W=new Array(f);l(W);var st,V,ot,G=new Array(u);function ft(C,j,Z,Y,T){this.static_tree=C,this.extra_bits=j,this.extra_base=Z,this.elems=Y,this.max_length=T,this.has_stree=C&&C.length}function I(C,j){this.dyn_tree=C,this.max_code=0,this.stat_desc=j}function O(C){return C<256?L[C]:L[256+(C>>>7)]}function lt(C,j){C.pending_buf[C.pending++]=255&j,C.pending_buf[C.pending++]=j>>>8&255}function U(C,j,Z){C.bi_valid>d-Z?(C.bi_buf|=j<<C.bi_valid&65535,lt(C,C.bi_buf),C.bi_buf=j>>d-C.bi_valid,C.bi_valid+=Z-d):(C.bi_buf|=j<<C.bi_valid&65535,C.bi_valid+=Z)}function X(C,j,Z){U(C,Z[2*j],Z[2*j+1])}function $t(C,j){for(var Z=0;Z|=1&C,C>>>=1,Z<<=1,0<--j;);return Z>>>1}function jt(C,j,Z){var Y,T,J=new Array(b+1),at=0;for(Y=1;Y<=b;Y++)J[Y]=at=at+Z[Y-1]<<1;for(T=0;T<=j;T++){var tt=C[2*T+1];tt!==0&&(C[2*T]=$t(J[tt]++,tt))}}function vt(C){var j;for(j=0;j<g;j++)C.dyn_ltree[2*j]=0;for(j=0;j<u;j++)C.dyn_dtree[2*j]=0;for(j=0;j<m;j++)C.bl_tree[2*j]=0;C.dyn_ltree[2*y]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0}function yt(C){8<C.bi_valid?lt(C,C.bi_buf):0<C.bi_valid&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0}function Nt(C,j,Z,Y){var T=2*j,J=2*Z;return C[T]<C[J]||C[T]===C[J]&&Y[j]<=Y[Z]}function Dt(C,j,Z){for(var Y=C.heap[Z],T=Z<<1;T<=C.heap_len&&(T<C.heap_len&&Nt(j,C.heap[T+1],C.heap[T],C.depth)&&T++,!Nt(j,Y,C.heap[T],C.depth));)C.heap[Z]=C.heap[T],Z=T,T<<=1;C.heap[Z]=Y}function ee(C,j,Z){var Y,T,J,at,tt=0;if(C.last_lit!==0)for(;Y=C.pending_buf[C.d_buf+2*tt]<<8|C.pending_buf[C.d_buf+2*tt+1],T=C.pending_buf[C.l_buf+tt],tt++,Y===0?X(C,T,j):(X(C,(J=_[T])+h+1,j),(at=A[J])!==0&&U(C,T-=W[J],at),X(C,J=O(--Y),Z),(at=R[J])!==0&&U(C,Y-=G[J],at)),tt<C.last_lit;);X(C,y,j)}function Wt(C,j){var Z,Y,T,J=j.dyn_tree,at=j.stat_desc.static_tree,tt=j.stat_desc.has_stree,z=j.stat_desc.elems,rt=-1;for(C.heap_len=0,C.heap_max=p,Z=0;Z<z;Z++)J[2*Z]!==0?(C.heap[++C.heap_len]=rt=Z,C.depth[Z]=0):J[2*Z+1]=0;for(;C.heap_len<2;)J[2*(T=C.heap[++C.heap_len]=rt<2?++rt:0)]=1,C.depth[T]=0,C.opt_len--,tt&&(C.static_len-=at[2*T+1]);for(j.max_code=rt,Z=C.heap_len>>1;1<=Z;Z--)Dt(C,J,Z);for(T=z;Z=C.heap[1],C.heap[1]=C.heap[C.heap_len--],Dt(C,J,1),Y=C.heap[1],C.heap[--C.heap_max]=Z,C.heap[--C.heap_max]=Y,J[2*T]=J[2*Z]+J[2*Y],C.depth[T]=(C.depth[Z]>=C.depth[Y]?C.depth[Z]:C.depth[Y])+1,J[2*Z+1]=J[2*Y+1]=T,C.heap[1]=T++,Dt(C,J,1),2<=C.heap_len;);C.heap[--C.heap_max]=C.heap[1],function(it,bt){var Tt,kt,ne,Ct,xt,Ee,re=bt.dyn_tree,Ht=bt.max_code,ge=bt.stat_desc.static_tree,on=bt.stat_desc.has_stree,qe=bt.stat_desc.extra_bits,nr=bt.stat_desc.extra_base,Ke=bt.stat_desc.max_length,ln=0;for(Ct=0;Ct<=b;Ct++)it.bl_count[Ct]=0;for(re[2*it.heap[it.heap_max]+1]=0,Tt=it.heap_max+1;Tt<p;Tt++)Ke<(Ct=re[2*re[2*(kt=it.heap[Tt])+1]+1]+1)&&(Ct=Ke,ln++),re[2*kt+1]=Ct,Ht<kt||(it.bl_count[Ct]++,xt=0,nr<=kt&&(xt=qe[kt-nr]),Ee=re[2*kt],it.opt_len+=Ee*(Ct+xt),on&&(it.static_len+=Ee*(ge[2*kt+1]+xt)));if(ln!==0){do{for(Ct=Ke-1;it.bl_count[Ct]===0;)Ct--;it.bl_count[Ct]--,it.bl_count[Ct+1]+=2,it.bl_count[Ke]--,ln-=2}while(0<ln);for(Ct=Ke;Ct!==0;Ct--)for(kt=it.bl_count[Ct];kt!==0;)Ht<(ne=it.heap[--Tt])||(re[2*ne+1]!==Ct&&(it.opt_len+=(Ct-re[2*ne+1])*re[2*ne],re[2*ne+1]=Ct),kt--)}}(C,j),jt(J,rt,C.bl_count)}function w(C,j,Z){var Y,T,J=-1,at=j[1],tt=0,z=7,rt=4;for(at===0&&(z=138,rt=3),j[2*(Z+1)+1]=65535,Y=0;Y<=Z;Y++)T=at,at=j[2*(Y+1)+1],++tt<z&&T===at||(tt<rt?C.bl_tree[2*T]+=tt:T!==0?(T!==J&&C.bl_tree[2*T]++,C.bl_tree[2*$]++):tt<=10?C.bl_tree[2*k]++:C.bl_tree[2*N]++,J=T,rt=(tt=0)===at?(z=138,3):T===at?(z=6,3):(z=7,4))}function H(C,j,Z){var Y,T,J=-1,at=j[1],tt=0,z=7,rt=4;for(at===0&&(z=138,rt=3),Y=0;Y<=Z;Y++)if(T=at,at=j[2*(Y+1)+1],!(++tt<z&&T===at)){if(tt<rt)for(;X(C,T,C.bl_tree),--tt!=0;);else T!==0?(T!==J&&(X(C,T,C.bl_tree),tt--),X(C,$,C.bl_tree),U(C,tt-3,2)):tt<=10?(X(C,k,C.bl_tree),U(C,tt-3,3)):(X(C,N,C.bl_tree),U(C,tt-11,7));J=T,rt=(tt=0)===at?(z=138,3):T===at?(z=6,3):(z=7,4)}}l(G);var M=!1;function x(C,j,Z,Y){U(C,(c<<1)+(Y?1:0),3),function(T,J,at,tt){yt(T),lt(T,at),lt(T,~at),i.arraySet(T.pending_buf,T.window,J,at,T.pending),T.pending+=at}(C,j,Z)}a._tr_init=function(C){M||(function(){var j,Z,Y,T,J,at=new Array(b+1);for(T=Y=0;T<f-1;T++)for(W[T]=Y,j=0;j<1<<A[T];j++)_[Y++]=T;for(_[Y-1]=T,T=J=0;T<16;T++)for(G[T]=J,j=0;j<1<<R[T];j++)L[J++]=T;for(J>>=7;T<u;T++)for(G[T]=J<<7,j=0;j<1<<R[T]-7;j++)L[256+J++]=T;for(Z=0;Z<=b;Z++)at[Z]=0;for(j=0;j<=143;)K[2*j+1]=8,j++,at[8]++;for(;j<=255;)K[2*j+1]=9,j++,at[9]++;for(;j<=279;)K[2*j+1]=7,j++,at[7]++;for(;j<=287;)K[2*j+1]=8,j++,at[8]++;for(jt(K,g+1,at),j=0;j<u;j++)E[2*j+1]=5,E[2*j]=$t(j,5);st=new ft(K,A,h+1,g,b),V=new ft(E,R,0,u,b),ot=new ft(new Array(0),P,0,m,v)}(),M=!0),C.l_desc=new I(C.dyn_ltree,st),C.d_desc=new I(C.dyn_dtree,V),C.bl_desc=new I(C.bl_tree,ot),C.bi_buf=0,C.bi_valid=0,vt(C)},a._tr_stored_block=x,a._tr_flush_block=function(C,j,Z,Y){var T,J,at=0;0<C.level?(C.strm.data_type===2&&(C.strm.data_type=function(tt){var z,rt=4093624447;for(z=0;z<=31;z++,rt>>>=1)if(1&rt&&tt.dyn_ltree[2*z]!==0)return s;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return o;for(z=32;z<h;z++)if(tt.dyn_ltree[2*z]!==0)return o;return s}(C)),Wt(C,C.l_desc),Wt(C,C.d_desc),at=function(tt){var z;for(w(tt,tt.dyn_ltree,tt.l_desc.max_code),w(tt,tt.dyn_dtree,tt.d_desc.max_code),Wt(tt,tt.bl_desc),z=m-1;3<=z&&tt.bl_tree[2*B[z]+1]===0;z--);return tt.opt_len+=3*(z+1)+5+5+4,z}(C),T=C.opt_len+3+7>>>3,(J=C.static_len+3+7>>>3)<=T&&(T=J)):T=J=Z+5,Z+4<=T&&j!==-1?x(C,j,Z,Y):C.strategy===4||J===T?(U(C,2+(Y?1:0),3),ee(C,K,E)):(U(C,4+(Y?1:0),3),function(tt,z,rt,it){var bt;for(U(tt,z-257,5),U(tt,rt-1,5),U(tt,it-4,4),bt=0;bt<it;bt++)U(tt,tt.bl_tree[2*B[bt]+1],3);H(tt,tt.dyn_ltree,z-1),H(tt,tt.dyn_dtree,rt-1)}(C,C.l_desc.max_code+1,C.d_desc.max_code+1,at+1),ee(C,C.dyn_ltree,C.dyn_dtree)),vt(C),Y&&yt(C)},a._tr_tally=function(C,j,Z){return C.pending_buf[C.d_buf+2*C.last_lit]=j>>>8&255,C.pending_buf[C.d_buf+2*C.last_lit+1]=255&j,C.pending_buf[C.l_buf+C.last_lit]=255&Z,C.last_lit++,j===0?C.dyn_ltree[2*Z]++:(C.matches++,j--,C.dyn_ltree[2*(_[Z]+h+1)]++,C.dyn_dtree[2*O(j)]++),C.last_lit===C.lit_bufsize-1},a._tr_align=function(C){U(C,2,3),X(C,y,K),function(j){j.bi_valid===16?(lt(j,j.bi_buf),j.bi_buf=0,j.bi_valid=0):8<=j.bi_valid&&(j.pending_buf[j.pending++]=255&j.bi_buf,j.bi_buf>>=8,j.bi_valid-=8)}(C)}},{"../utils/common":41}],53:[function(e,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,a){(function(i){(function(s,o){if(!s.setImmediate){var l,c,f,h,g=1,u={},m=!1,p=s.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(s);b=b&&b.setTimeout?b:s,l={}.toString.call(s.process)==="[object process]"?function($){process.nextTick(function(){v($)})}:function(){if(s.postMessage&&!s.importScripts){var $=!0,k=s.onmessage;return s.onmessage=function(){$=!1},s.postMessage("","*"),s.onmessage=k,$}}()?(h="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",y,!1):s.attachEvent("onmessage",y),function($){s.postMessage(h+$,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function($){v($.data)},function($){f.port2.postMessage($)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function($){var k=p.createElement("script");k.onreadystatechange=function(){v($),k.onreadystatechange=null,c.removeChild(k),k=null},c.appendChild(k)}):function($){setTimeout(v,0,$)},b.setImmediate=function($){typeof $!="function"&&($=new Function(""+$));for(var k=new Array(arguments.length-1),N=0;N<k.length;N++)k[N]=arguments[N+1];var A={callback:$,args:k};return u[g]=A,l(g),g++},b.clearImmediate=d}function d($){delete u[$]}function v($){if(m)setTimeout(v,0,$);else{var k=u[$];if(k){m=!0;try{(function(N){var A=N.callback,R=N.args;switch(R.length){case 0:A();break;case 1:A(R[0]);break;case 2:A(R[0],R[1]);break;case 3:A(R[0],R[1],R[2]);break;default:A.apply(o,R)}})(k)}finally{d($),m=!1}}}}function y($){$.source===s&&typeof $.data=="string"&&$.data.indexOf(h)===0&&v(+$.data.slice(h.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Yr);var Ua=Yr.exports;const rr=Ma(Ua);class Wa{constructor(t,e){this.app=t,this.settings=e}get maxBackups(){var t;return((t=this.settings)==null?void 0:t.maxBackups)??5}get maxBackupAgeDays(){var t;return((t=this.settings)==null?void 0:t.maxBackupAgeDays)??30}async willExceedMaxBackups(t,e,n){const i=(await this.listBackups(t,e,n)).length,s=(n==null?void 0:n.maxBackups)??5,o=i+1;return o>s?o-s:0}async cleanupExcessBackups(t,e,n){const a=await this.listBackups(t,e,n),i=(n==null?void 0:n.maxBackups)??5;F(`${S} cleanupExcessBackups: found ${a.length} backups, max allowed: ${i}`);let s=0;if(a.length>i)for(let o=i;o<a.length;o++)F(`${S} cleanupExcessBackups: deleting backup ${o+1}/${a.length}`),await this.deleteBackup(t,e,a[o],n)&&s++;return F(`${S} cleanupExcessBackups: deleted ${s} backups`),s}async createBackup(t,e,n){try{const a=this.app.vault.getAbstractFileByPath(t);if(!a||!(a instanceof D.TFolder))return F(`${S} Draft folder not found: ${t}`),!1;const i=this.getAllFilesInFolder(a);if(i.length===0)return F(`${S} No files to backup in: ${t}`),!1;const s=t.split("/")[0]||"unknown",o=t.split("/")[1]||"drafts",l=`${Re(n)}/${s}/${o}/${e}`;await this.app.vault.adapter.exists(l)||await this.app.vault.createFolder(l);const h=`${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}${Be}`,g=`${l}/${h}`,u=new rr;for(const b of i){const d=b.path.substring(t.length+1),v=await this.app.vault.read(b);u.file(d,v)}const m=await u.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}),p=new Uint8Array(m).buffer;return await this.app.vault.createBinary(g,p),F(`${S} Created backup: ${g}`),!0}catch(a){return F(`${S} Failed to create backup:`,a),!1}}async listBackups(t,e,n){F(`${S} listBackups called for draftFolder: ${t}, draftId: ${e}`);try{const a=t.split("/")[0]||"unknown",i=t.split("/")[1]||"drafts",s=`${Re(n)}/${a}/${i}/${e}`;if(F(`${S} listBackups checking backupDir: ${s}`),!await this.app.vault.adapter.exists(s))return F(`${S} listBackups backupDir does not exist on disk`),[];const l=[];try{const f=await this.app.vault.adapter.list(s);F(`${S} listBackups adapter found ${f.files.length} files, ${f.folders.length} folders`);for(const h of f.files){const g=h.split("/").pop()||"";if(F(`${S} listBackups examining file: ${g}, endsWith .zip: ${g.endsWith(Be)}`),g.endsWith(Be)){const u=g.match(Zr);F(`${S} listBackups match for ${g}: ${(u==null?void 0:u[1])??"no match"}`),u&&l.push(u[1])}}}catch(f){return F(`${S} listBackups error reading backup directory: ${f}`),[]}const c=l.sort().reverse();return F(`${S} listBackups found ${c.length} backups for ${e}: [${c.join(", ")}]`),c}catch(a){return F(`${S} Failed to list backups:`,a),[]}}async restoreBackup(t,e,n,a){F(`${S} restoreBackup called for draftFolder: ${t}, draftId: ${e}, timestamp: ${n}`);try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${Re(a)}/${i}/${s}/${e}`,l=`${n}${Be}`,c=`${o}/${l}`;if(!await this.app.vault.adapter.stat(c))return F(`${S} Backup file not found: ${c}`),!1;const h=await this.app.vault.adapter.readBinary(c),g=await rr.loadAsync(h);this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t);for(const[m,p]of Object.entries(g.files))if(p.dir){const b=`${t}/${m}`;this.app.vault.getAbstractFileByPath(b)||await this.app.vault.createFolder(b)}else{const b=await p.async("text"),d=`${t}/${m}`,v=d.substring(0,d.lastIndexOf("/"));this.app.vault.getAbstractFileByPath(v)||await this.app.vault.createFolder(v);const y=this.app.vault.getAbstractFileByPath(d);y&&y instanceof D.TFile?await this.app.vault.modify(y,b):await this.app.vault.create(d,b)}return F(`${S} Restored backup: ${c}`),!0}catch(i){return F(`${S} Failed to restore backup:`,i),!1}}async deleteBackup(t,e,n,a){F(`${S} deleteBackup called for draftFolder: ${t}, draftId: ${e}, timestamp: ${n}`);try{const i=t.split("/")[0]||"unknown",s=t.split("/")[1]||"drafts",o=`${Re(a)}/${i}/${s}/${e}`,l=`${n}${Be}`,c=`${o}/${l}`;return await this.app.vault.adapter.stat(c)?(await this.app.vault.adapter.remove(c),F(`${S} Deleted backup: ${c}`),!0):(F(`${S} Backup file not found for deletion: ${c}`),!1)}catch(i){return F(`${S} Failed to delete backup:`,i),!1}}async clearOldBackups(t,e,n){F(`${S} clearOldBackups called for draftFolder: ${t}, draftId: ${e}`);try{const a=await this.listBackups(t,e,n),i=new Date;i.setDate(i.getDate()-this.maxBackupAgeDays);let s=0;for(const o of a)new Date(o.replace(/-/g,":"))<i&&(await this.deleteBackup(t,e,o,n),s++);F(`${S} clearOldBackups removed ${s} old backups for ${e}`)}catch(a){F(`${S} Failed to clear old backups:`,a)}}getAllFilesInFolder(t){const e=[];function n(a){for(const i of a.children)i instanceof D.TFile?e.push(i):i instanceof D.TFolder&&n(i)}return n(t),e}}class Ha{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null}async reorderChapters(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;for(let o=0;o<n.length;o++){const{chapterName:l}=n[o],c=`${s}/${l}${pt}`,f=this.app.vault.getAbstractFileByPath(c);if(f&&f instanceof D.TFile){let h=await this.app.vault.read(f);h.match(Ot)&&(h=h.replace(Ot,(g,u)=>{let m=u.replace(/^order:.*\n?/gm,"");return m.endsWith(`
`)||(m+=`
`),m+=`order: ${o+1}
`,`${St}
${m}${St}`}),await this.app.vault.modify(f,h))}}return!0}async listChapters(t,e){F(`${S} ChapterFileService.listChapters: projectPath=${t}, draftName=${e}`);const n=this.resolveProjectPath(t);if(!n)return F(`${S} ChapterFileService.listChapters: no project resolved`),[];const a=this.getDraftsFolderName(n);if(!a)return F(`${S} ChapterFileService.listChapters: no drafts folder found in project ${n}`),[];const i=`${n}/${a}/${e}`;F(`${S} ChapterFileService.listChapters: resolved project=${n}, draftsFolder=${a}, draftFolder=${i}`);const s=this.app.vault.getAbstractFileByPath(i),o=[];if(s&&s instanceof D.TFolder){F(`${S} ChapterFileService.listChapters: found folder with ${s.children.length} children`);for(const l of s.children)l instanceof D.TFile&&l.extension===pt.slice(1)&&(F(`${S} ChapterFileService.listChapters: processing file ${l.path}`),await zt(async()=>{const c=await this.app.vault.read(l);if(F(`${S} ChapterFileService.listChapters: content length ${c.length}`),!this.isValidChapter(c)){F(`${S} ChapterFileService.listChapters: ${l.path} is not a valid chapter (missing required fields)`);return}const f=c.match(Ot);let h,g;if(f){F(`${S} ChapterFileService.listChapters: found frontmatter`);const p=f[1].split(/\r?\n/);for(const b of p){const d=b.match(/^order:\s*(\d+)/i);d&&(h=parseInt(d[1],10));const v=b.match(/^chapter_name:\s*(.*)$/i);if(v){let y=v[1].trim();(y.startsWith('"')&&y.endsWith('"')||y.startsWith("'")&&y.endsWith("'"))&&(y=y.slice(1,-1)),y.length>0&&(g=y)}}}else F(`${S} ChapterFileService.listChapters: no frontmatter`);F(`${S} ChapterFileService.listChapters: parsed order=${h}, chapterName=${g}`);const u=g&&g.length>0?g:l.name.replace(new RegExp(`\\${pt}$`),""),m=typeof h=="number"&&!isNaN(h)?h:0;F(`${S} ChapterFileService.listChapters: adding chapter ${l.name} with name ${u}, order ${m}`),o.push({name:l.name.replace(new RegExp(`\\${pt}$`),""),chapterName:u,order:m})}))}else F(`${S} ChapterFileService.listChapters: no folder found`);return o.sort((l,c)=>l.order-c.order),F(`${S} ChapterFileService.listChapters: returning ${o.length} chapters`),o.map(({name:l,chapterName:c})=>({name:l,chapterName:c}))}async createChapter(t,e,n,a,i){F(`${S} createChapter called: chapterName=${n}, draft=${e}, draftId=${i}`);const s=this.resolveProjectPath(t);if(!s)return F(`${S} createChapter: no project resolved`),!1;const o=this.getDraftsFolderName(s);if(!o)return F(`${S} createChapter: no drafts folder found`),!1;const l=`${s}/${o}/${e}`,f=`${Vt(n,a==null?void 0:a.slugStyle)}${pt}`,h=`${l}/${f}`;if(this.app.vault.getAbstractFileByPath(h))return F(`${S} createChapter: file already exists at ${h}`),!1;let g=0,u=null;const m=this.app.vault.getAbstractFileByPath(l);if(m&&m instanceof D.TFolder)for(const y of m.children)y instanceof D.TFile&&y.extension===pt.slice(1)&&await zt(async()=>{const $=await this.app.vault.read(y);if(this.isValidChapter($)){const k=$.match(Ot);if(k){const N=k[1].split(/\r?\n/);for(const A of N){const R=A.match(/^order:\s*(\d+)/i);if(R){const P=parseInt(R[1],10);!isNaN(P)&&P>g&&(g=P)}if(!u){const P=A.match(/^id:\s*(.+)/i);P&&(u=P[1].trim())}}}}});const p=g+1;let b=`# ${n}`;const d=i||u||Ne();let v=`${St}
id: ${d}
order: ${p}
chapter_name: ${JSON.stringify(n)}
${St}
`;return await this.app.vault.create(h,`${v}${b}

`),F(`${S} createChapter: created ${h} with order ${p}, chapter_name "${n}", and draft id ${d}`),!0}async deleteChapter(t,e,n){F(`${S} deleteChapter called: chapterName=${n}, draft=${e}`);const a=this.resolveProjectPath(t);if(!a)return F(`${S} deleteChapter: no project resolved`),!1;const i=this.getDraftsFolderName(a);if(!i)return F(`${S} deleteChapter: no drafts folder found`),!1;const s=`${a}/${i}/${e}`,o=`${n}${pt}`,l=`${s}/${o}`,c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof D.TFile){await this.app.vault.delete(c);const f=await this.listChapters(t,e);for(let h=0;h<f.length;h++){const{name:g}=f[h],u=`${s}/${g}${pt}`,m=this.app.vault.getAbstractFileByPath(u);if(m&&m instanceof D.TFile){let p=await this.app.vault.read(m);p.match(Ot)&&(p=p.replace(Ot,(b,d)=>{let v=d.replace(/^order:.*\n?/gm,"");return v.endsWith(`
`)||(v+=`
`),v+=`order: ${h+1}
`,`${St}
${v}${St}`}),await this.app.vault.modify(m,p))}}return!0}return!1}async renameChapter(t,e,n,a){F(`${S} renameChapter called: ${n} -> ${a}`);const i=this.resolveProjectPath(t);if(!i)return F(`${S} renameChapter: no project resolved`),!1;const s=this.getDraftsFolderName(i);if(!s)return F(`${S} renameChapter: no drafts folder found`),!1;const o=`${i}/${s}/${e}`,l=`${o}/${n}${pt}`,c=`${o}/${a}${pt}`,f=this.app.vault.getAbstractFileByPath(l);if(!f||!(f instanceof D.TFile))return F(`${S} renameChapter: file not found at ${l}`),!1;let h=await this.app.vault.read(f),g=`# ${a}`;return h.match(Ot)&&(h=h.replace(Ot,(u,m)=>{let p=m.replace(/^chapter_name:.*\n?/gm,"");return p.endsWith(`
`)||(p+=`
`),p+=`chapter_name: ${JSON.stringify(a)}
`,`${St}
${p}${St}`})),h=h.replace(/^#.*$/m,g),n!==a?(await this.app.vault.create(c,h),await this.app.vault.delete(f)):await this.app.vault.modify(f,h),!0}async openChapter(t,e,n){const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}/${n}${pt}`,o=this.app.vault.getAbstractFileByPath(s);return o&&o instanceof D.TFile?(await zt(async()=>{await this.app.workspace.getLeaf().openFile(o)}),!0):!1}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=At((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof D.TFolder){for(const i of e.children)if(i instanceof D.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}hasRequiredChapterFields(t){const e=/^id:\s*\S+/im.test(t),n=/^order:\s*\d+/im.test(t),a=/^chapter_name:\s*\S+/im.test(t);return e&&n&&a}extractChapterMetadata(t){if(!this.hasRequiredChapterFields(t))return null;let e,n,a;const i=t.split(/\r?\n/);for(const s of i){const o=s.match(/^id:\s*(.+?)$/i);o&&(e=o[1].trim());const l=s.match(/^order:\s*(\d+)/i);l&&(n=parseInt(l[1],10));const c=s.match(/^chapter_name:\s*(.*)$/i);if(c){let f=c[1].trim();(f.startsWith('"')&&f.endsWith('"')||f.startsWith("'")&&f.endsWith("'"))&&(f=f.slice(1,-1)),f.length>0&&(a=f)}}return{id:e,order:n,chapterName:a}}isValidChapter(t){const e=t.match(Ot);return e?this.hasRequiredChapterFields(e[1]):!1}}class qr{constructor(t){this.app=t,F(`${S} TemplateService created`)}async render(t,e={}){let n=t||"";return F(`${S} TemplateService.render called with template: "${n.substring(0,100)}${n.length>100?"...":""}", vars:`,Object.keys(e)),!n.includes("{{")&&!n.includes("}}")?(F(`${S} Template doesn't contain template syntax, checking if it's a file path`),await zt(async()=>{const a=this.app.vault.getAbstractFileByPath(n);a&&a instanceof D.TFile?(F(`${S} Reading template from file: ${n}`),n=await this.app.vault.read(a),F(`${S} Template loaded from file, length: ${n.length} chars`)):F(`${S} Template path "${n}" is not a valid file, treating as inline template`)})):F(`${S} Template contains template syntax, treating as inline template`),F(`${S} Performing template variable substitution`),n=n.replace(/{{\s*(\w+(?:[-:]\w+)*)\s*}}/g,(a,i)=>{if(e[i]!==void 0)return F(`${S} Substituting variable {{${i}}} with provided value: "${e[i]}"`),e[i];try{const s=window.moment().format(i);return F(`${S} Substituting {{${i}}} with moment.js format: "${s}"`),s}catch{return F(`${S} Neither variable nor moment.js format found for {{${i}}}, returning as-is`),i}}),F(`${S} Template rendering complete, result length: ${n.length} chars`),n}}async function be(r,t){const e=r.vault.getAbstractFileByPath(t);if(!e||!(e instanceof D.TFile))return null;try{const n=await r.vault.read(e);return Va(n)}catch(n){return F(`${S} Error reading meta file:`,n),null}}async function Yn(r,t,e){const n=Za(e),a=r.vault.getAbstractFileByPath(t);a&&a instanceof D.TFile?await r.vault.modify(a,n):await r.vault.create(t,n)}async function ze(r,t,e,n,a){const i=`${t}/${Gt(a)}`;let s=await be(r,i);s||(s={version:Vr,total_drafts:0});const o=At(a),l=r.vault.getAbstractFileByPath(`${t}/${o}`);if(l&&l instanceof D.TFolder){const c=l.children.filter(f=>f instanceof D.TFolder);s.total_drafts=c.length}e!==void 0&&(s.current_active_draft=e,s.active_draft_last_modified=new Date().toISOString()),n&&Object.assign(s,n),s.total_drafts>0&&s.total_word_count&&(s.average_draft_word_count=Math.round(s.total_word_count/s.total_drafts)),await Yn(r,i,s)}function Va(r){const t=r.match(new RegExp(`${St}\\s*\\n([\\s\\S]*?)\\n${St}`));if(!t)return null;const e=t[1],n={},a=e.split(`
`);for(const i of a){const s=i.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(s){const o=s[1];let l=s[2].trim();/^-?\d+(\.\d+)?$/.test(l)?l=Number(l):(l.startsWith('"')&&l.endsWith('"')||l.startsWith("'")&&l.endsWith("'"))&&(l=l.slice(1,-1)),n[o]=l}}return n}function Za(r){const t=[St];if(r.version!==void 0&&t.push(`version: "${r.version}"`),r.current_active_draft!==void 0&&t.push(`current_active_draft: "${r.current_active_draft}"`),r.current_draft_word_count!==void 0&&t.push(`current_draft_word_count: ${r.current_draft_word_count}`),t.push(`total_drafts: ${r.total_drafts}`),r.target_word_count!==void 0&&t.push(`target_word_count: ${r.target_word_count}`),r.active_draft_last_modified!==void 0&&t.push(`active_draft_last_modified: "${r.active_draft_last_modified}"`),r.total_word_count!==void 0&&t.push(`total_word_count: ${r.total_word_count}`),r.average_draft_word_count!==void 0&&t.push(`average_draft_word_count: ${r.average_draft_word_count}`),r.project_type!==void 0&&t.push(`project_type: ${r.project_type}`),t.push(St),t.push(""),t.push("# Project Statistics"),t.push(""),r.current_active_draft&&t.push(`**Active Draft:** ${r.current_active_draft}`),r.current_draft_word_count!==void 0&&t.push(`**Current Draft Word Count:** ${r.current_draft_word_count.toLocaleString()}`),t.push(`**Total Drafts:** ${r.total_drafts}`),r.target_word_count&&t.push(`**Target Word Count:** ${r.target_word_count.toLocaleString()}`),r.active_draft_last_modified){const e=new Date(r.active_draft_last_modified);t.push(`**Last Modified:** ${e.toLocaleString()}`)}return r.total_word_count&&t.push(`**Total Word Count:** ${r.total_word_count.toLocaleString()}`),r.average_draft_word_count&&t.push(`**Average Draft Word Count:** ${r.average_draft_word_count.toLocaleString()}`),t.push(""),t.join(`
`)}const Ln=Object.freeze(Object.defineProperty({__proto__:null,readMetaFile:be,updateMetaStats:ze,writeMetaFile:Yn},Symbol.toStringTag,{value:"Module"}));class mn{constructor(t){var e,n,a;this.app=t,this.manager=((a=(n=(e=this.app.plugins).getPlugin)==null?void 0:n.call(e,"obsidian-writeaid-plugin"))==null?void 0:a.manager)??null,this.tpl=new qr(t),this.projectFileService=new qn(t,this)}async createProject(t,e,n,a,i){if(F(`${S} createProject called: projectName=${t}, singleFile=${e}`),!t)return F(`${S} createProject: project name is empty`),new D.Notice("Project name is required."),null;const s=a&&a!==""?`${a}/${t}`:t,o=`${s}/${At(i)}`;this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s),this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o);const l=`${s}/${Gt(i)}`;if(!this.app.vault.getAbstractFileByPath(l)){const f=e?Bt.SINGLE:Bt.MULTI,h=e?(i==null?void 0:i.defaultSingleTargetWordCount)??2e4:(i==null?void 0:i.defaultMultiTargetWordCount)??5e4;await ze(this.app,s,void 0,{project_type:f,target_word_count:h},i)}const c=n||"Draft 1";return await this.projectFileService.drafts.createDraft(c,void 0,s,i),s}async openProject(t){var s,o;const e=`${t}/${Gt((s=this.manager)==null?void 0:s.settings)}`,n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(n),!0;const a=Ie((o=this.manager)==null?void 0:o.settings),i=[`${t}/${t}${pt}`,`${t}/Chapter 1${pt}`,`${t}/Chapter 01${pt}`,`${t}/${a}`,`${t}/${At()}/Draft 1/${a}`];for(const l of i){const c=this.app.vault.getAbstractFileByPath(l);if(c&&c instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(c),!0}return new D.Notice("Could not find a file to open in the project."),!1}listAllFolders(){const t=this.app.vault.getRoot(),e=[""];function n(a){for(const i of a.children)i instanceof D.TFolder&&(e.push(i.path),n(i))}return n(t),e}async listProjects(){const t=this.listAllFolders(),e=t.filter(a=>!!a);F(`${S} allFolders:`,t),F(`${S} filteredFolders:`,e);const n=await ye(e,a=>this.isProjectFolder(a));return F(`${S} found ${e.length} folders, ${n.length} projects:`,n),n}async getProjectType(t){const e=`${t}/${Gt()}`,n=await be(this.app,e);if(n&&n.project_type){const a=n.project_type;if(Object.values(Bt).includes(a))return a}return null}getDraftsFolder(t){const e=`${t}/${At()}`;let n=this.app.vault.getAbstractFileByPath(e);if(n&&n instanceof D.TFolder)return n;const a=`${t}/Drafts`;return n=this.app.vault.getAbstractFileByPath(a),n&&n instanceof D.TFolder?n:null}async getManuscriptsFolder(t){const e=`${t}/${Gn()}`,n=this.app.vault.getAbstractFileByPath(e);return n&&n instanceof D.TFolder?n:null}async isProjectFolder(t){if(!t||typeof t!="string")return F(`${S} isProjectFolder: invalid path`),!1;const e=t.trim().replace(/\\/g,"/").replace(/\/+$/,"");try{const n=D.normalizePath(`${e}/${Gt()}`),a=await this.app.vault.adapter.exists(n),i=D.normalizePath(`${e}/${At()}`);let s=await this.app.vault.adapter.exists(i);if(!s){const o=D.normalizePath(`${e}/Drafts`);s=await this.app.vault.adapter.exists(o)}if(!a&&!s)return F(`${S} isProjectFolder ${t}: no meta.md or drafts folder found`),!1;if(a)try{const{readMetaFile:o}=await Promise.resolve().then(()=>Ln),{VALID_PROJECT_TYPES:l}=await Promise.resolve().then(()=>Ta),c=await o(this.app,n);if(!c||!l.includes(c.project_type))return!1}catch{return!1}return!0}catch{return!1}}}class Ga{constructor(t,e,n,a){var i,s,o;this.app=t,this.tpl=new qr(t),this.projectSvc=n,this.backupSvc=a,this.chapters=e,this.manager=((o=(s=(i=this.app.plugins).getPlugin)==null?void 0:s.call(i,"obsidian-writeaid-plugin"))==null?void 0:o.manager)??null}resolveProjectPath(t){var e;return t||((e=this.manager)==null?void 0:e.activeProject)||null}getDraftsFolderName(t){var a;const e=this.app.vault.getAbstractFileByPath(t),n=At((a=this.manager)==null?void 0:a.settings);if(e&&e instanceof D.TFolder){for(const i of e.children)if(i instanceof D.TFolder&&i.name.toLowerCase()===n.toLowerCase())return i.name}return null}async suggestNextDraftName(t){var i;const e=this.resolveProjectPath(t);if(!e)return"Draft 1";const n=`${e}/${Gt((i=this.manager)==null?void 0:i.settings)}`;let a=0;return await zt(async()=>{const s=await be(this.app,n);s&&typeof s.total_drafts=="number"&&(a=s.total_drafts)}),`Draft ${a+1}`}async createDraft(t,e,n,a){var h,g,u;F(`${S} createDraft called with draftName: ${t}, copyFromDraft: ${e}`);const i=this.resolveProjectPath(n);if(!i){F(`${S} createDraft: no project path resolved`),new D.Notice("No project folder detected. Please open a folder named after your project.");return}const o=this.getDraftsFolderName(i)||At((h=this.manager)==null?void 0:h.settings),l=`${i}/${o}`,c=`${l}/${t}`,f=i.split("/").pop()||i;if(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),e){F(`${S} createDraft: copying from draft ${e}`);const m=`${l}/${e}`,p=this.app.vault.getFiles().filter(v=>v.path.startsWith(m)),d=`${Vt(e,a==null?void 0:a.slugStyle)}${pt}`;for(const v of p){let y=v.path.substring(m.length+1);y===d&&(y=`${Vt(t,a==null?void 0:a.slugStyle)}${pt}`);const $=`${c}/${y}`,k=$.substring(0,$.lastIndexOf("/"));k!==c&&!this.app.vault.getAbstractFileByPath(k)&&await this.app.vault.createFolder(k);let N=await this.app.vault.read(v);N=Ya(N,t,f),await this.app.vault.create($,N)}}else{if((a==null?void 0:a.includeDraftOutline)===!0){const b=(a==null?void 0:a.outlineTemplate)??"",d=await this.tpl.render(b,{draftName:t});await this.app.vault.create(`${c}/${Ie((g=this.manager)==null?void 0:g.settings)}`,d)}if(await this.projectSvc.getProjectType(i)===Bt.SINGLE){const d=`${Vt(t,a==null?void 0:a.slugStyle)}${pt}`,v=`${c}/${d}`;if(!this.app.vault.getAbstractFileByPath(v)){const y=Ne(),$=`${St}
draft: ${t}
id: ${y}
project: ${f}
created: ${new Date().toISOString()}
${St}

`,k=await this.tpl.render("# {{draftName}}",{draftName:t});await this.app.vault.create(v,$+k)}}else{const b=this.app.vault.getAbstractFileByPath(c);let d=!1;if(b&&b instanceof D.TFolder){for(const v of b.children)if(v instanceof D.TFile&&v.extension===pt.slice(1)&&(await zt(async()=>{const y=await this.app.vault.read(v);this.chapters.isValidChapter(y)&&(d=!0)}),d))break}if(!d){const v=Ne();await this.chapters.createChapter(i,t,"Chapter 1",a,v)}}}await ze(this.app,i,t,void 0,(u=this.manager)==null?void 0:u.settings)}listDrafts(t){var a;const e=this.resolveProjectPath(t);if(F(`${S} listDrafts called with projectPath:`,t,"resolved to:",e),!e)return[];const n=this.projectSvc.getDraftsFolder(e);if(F(`${S} getDraftsFolder for ${e} returned:`,n==null?void 0:n.path,(a=n==null?void 0:n.children)==null?void 0:a.length),n&&n instanceof D.TFolder){const i=n.children.filter(s=>s instanceof D.TFolder).map(s=>s.name);return F(`${S} found drafts:`,i),i}return[]}async getDraftId(t){F(`${S} getDraftId called for draftFolder: ${t}`);try{const e=this.app.vault.getFiles().filter(n=>n.path.startsWith(t));for(const n of e)if(n.extension===pt.slice(1)){const i=(await this.app.vault.read(n)).match(Ot);if(i){const o=i[1].match(/^id:\s*(.+?)$/m);if(o){const l=o[1].trim();return F(`${S} getDraftId found: ${l}`),l}}}return F(`${S} getDraftId: no draft ID found in ${t}`),null}catch(e){return F(`${S} getDraftId error:`,e),null}}async ensureChaptersDraftId(t,e){const n=this.resolveProjectPath(t);if(!n)return;const a=this.getDraftsFolderName(n);if(!a)return;const i=`${n}/${a}/${e}`,s=await this.getDraftId(i);if(!s){F(`${S} ensureChaptersDraftId: no draft ID found for draft ${e}`);return}try{const o=this.app.vault.getFiles().filter(l=>l.path.startsWith(i));for(const l of o)if(l.extension===pt.slice(1)){const c=await this.app.vault.read(l),f=c.match(Ot);if(f){const h=f[1];if(!h.match(/^id:\s*/m)){const g=c.substring(f[0].length),u=h.split(`
`);u.push(`id: ${s}`);const m=u.join(`
`),p=`${St}
${m}
${St}${g}`;await this.app.vault.modify(l,p),F(`${S} ensureChaptersDraftId: added draft ID to ${l.path}`)}}}}catch(o){F(`${S} ensureChaptersDraftId error:`,o)}}async openDraft(t,e){var f,h,g,u;const n=this.resolveProjectPath(t);if(!n)return!1;const a=this.getDraftsFolderName(n);if(!a)return!1;const i=`${n}/${Gt((f=this.manager)==null?void 0:f.settings)}`,s=await be(this.app,i);if(((s==null?void 0:s.project_type)||Bt.MULTI)===Bt.SINGLE){const m=Vt(e,(g=(h=this.manager)==null?void 0:h.settings)==null?void 0:g.slugStyle),p=`${n}/${a}/${e}/${m}${pt}`,b=this.app.vault.getAbstractFileByPath(p);if(b&&b instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(b),!0}else{const m=await this.chapters.listChapters(n,e);if(m.length>0){const p=m[m.length-1],b=`${n}/${a}/${e}/${p.name}${pt}`,d=this.app.vault.getAbstractFileByPath(b);if(d&&d instanceof D.TFile)return await this.app.workspace.getLeaf().openFile(d),!0}}const l=`${n}/${a}/${e}/${Ie((u=this.manager)==null?void 0:u.settings)}`,c=this.app.vault.getAbstractFileByPath(l);return c&&c instanceof D.TFile?(await this.app.workspace.getLeaf().openFile(c),!0):!1}async renameDraft(t,e,n,a=!1,i){var f;F(`${S} renameDraft called: ${e} -> ${n}, renameFile: ${a}`);const s=this.resolveProjectPath(t);if(!s)return F(`${S} renameDraft: no project resolved`),!1;const o=this.getDraftsFolderName(s);if(!o)return F(`${S} renameDraft: no drafts folder found`),!1;const l=`${s}/${o}/${e}`,c=`${s}/${o}/${n}`;try{this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c);const h=this.app.vault.getFiles().filter(d=>d.path.startsWith(l));let g="";if(a){const d=i==null?void 0:i.slugStyle;g=Vt(n,d)}let u=null;for(const d of h){const v=d.path.substring(l.length+1);if(d.extension===pt.slice(1)&&!v.includes("/")){u=d;break}}for(const d of h){let v=d.path.substring(l.length+1),y=`${c}/${v}`;a&&g&&d===u&&!v.includes("/")&&(v=`${g}${pt}`,y=`${c}/${v}`);let $=await this.app.vault.read(d);d.extension===pt.slice(1)&&($=$.replace(new RegExp(`^(${St}\\s*\\n[\\s\\S]*?\\n)(draft:.*\\n)?`,"m"),(k,N)=>N.replace(/^draft:.*\n/m,"").replace(new RegExp(`^(${St}\\s*\\n)`),`$1draft: ${n}
`))),await this.app.vault.create(y,$),await this.app.vault.delete(d)}const m=this.app.vault.getAbstractFileByPath(l);m&&m instanceof D.TFolder&&await this.app.vault.delete(m,!0),await zt(async()=>{await Promise.resolve().then(()=>Ln).then(d=>{var v;return d.updateMetaStats(this.app,s,n,void 0,(v=this.manager)==null?void 0:v.settings)})});const p=`${c}/${Gt((f=this.manager)==null?void 0:f.settings)}`;return this.app.vault.getAbstractFileByPath(p)&&await zt(async()=>{const{readMetaFile:d,writeMetaFile:v}=await Promise.resolve().then(()=>Ln),y=await d(this.app,p);y&&(y.draft=n,await v(this.app,p,y))}),!0}catch{return!1}}async deleteDraft(t,e,n=!0){var o;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=`${a}/${i}/${e}`;try{const l=this.app.vault.getFiles().filter(f=>f.path.startsWith(s));if(n){const f=await this.getDraftId(s);f&&await this.backupSvc.createBackup(s,f,(o=this.manager)==null?void 0:o.settings)}for(const f of l)await zt(async()=>{await this.app.vault.delete(f)});const c=this.app.vault.getAbstractFileByPath(s);return c&&c instanceof D.TFolder&&await zt(async()=>{await this.app.vault.delete(c)}),!0}catch{return!1}}async generateManuscript(t,e,n){var p;const a=this.resolveProjectPath(t);if(!a)return!1;const i=this.getDraftsFolderName(a);if(!i)return!1;const s=await this.projectSvc.getProjectType(a),o=`${a}/${i}/${e}`;if(!this.app.vault.getAbstractFileByPath(o))return new D.Notice(`Draft folder ${o} does not exist.`),!1;const l=`${a}/${Gn((p=this.manager)==null?void 0:p.settings)}`;this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l);const c=a.split("/").pop()||a,f=(n==null?void 0:n.manuscriptNameTemplate)||"{{draftName}}";F(`${S} DraftFileService.generateManuscript - manuscriptNameTemplate: "${f}"`),F(`${S} DraftFileService.generateManuscript - settings object:`,n);const h=Vt(e,n==null?void 0:n.slugStyle),g=await this.tpl.render(f,{draftName:e,projectName:c,draftSlug:h}),u=`${l}/${g}${pt}`;let m=`# Manuscript for ${e}

`;if(s===Bt.SINGLE){const b=`${h}${pt}`,d=`${o}/${b}`,v=this.app.vault.getAbstractFileByPath(d);if(v&&v instanceof D.TFile){const y=await this.app.vault.read(v);m+=ar(fn(y));const $=this.app.vault.getAbstractFileByPath(u);if($&&$ instanceof D.TFile){if(!await new zn(this.app,u).open())return!1;F(`${S} Overwriting existing manuscript: ${u}`),await this.app.vault.modify($,m)}else F(`${S} Creating new manuscript: ${u}`),await this.app.vault.create(u,m)}else return new D.Notice(`Main draft file ${d} not found.`),!1}else if(s===Bt.MULTI){const b=await this.chapters.listChapters(a,e);if(b.length===0)return new D.Notice("No chapters found in draft."),!1;for(const v of b){const y=`${o}/${v.name}${pt}`,$=this.app.vault.getAbstractFileByPath(y);if($&&$ instanceof D.TFile){const k=await this.app.vault.read($),N=v.chapterName||v.name;m+=`## ${N}

`,m+=ar(fn(k)),m+=`

`}}const d=this.app.vault.getAbstractFileByPath(u);if(d&&d instanceof D.TFile){if(!await new zn(this.app,u).open())return!1;F(`${S} Overwriting existing manuscript: ${u}`),await this.app.vault.modify(d,m)}else F(`${S} Creating new manuscript: ${u}`),await this.app.vault.create(u,m)}return!0}getOutlineFile(t,e){var o;const n=this.resolveProjectPath(t);if(!n)return null;const a=this.getDraftsFolderName(n);if(!a)return null;const i=`${n}/${a}/${e}/${Ie((o=this.manager)==null?void 0:o.settings)}`,s=this.app.vault.getAbstractFileByPath(i);return s&&s instanceof D.TFile?s:null}async createOutline(t,e,n){var f;const a=this.resolveProjectPath(t);if(!a)throw new Error("Project not found");const i=this.getDraftsFolderName(a);if(!i)throw new Error("Drafts folder not found");const o=`${`${a}/${i}/${e}`}/${Ie((f=this.manager)==null?void 0:f.settings)}`;if(this.app.vault.getAbstractFileByPath(o))throw new Error("Outline file already exists");const c=await this.tpl.render(n,{draftName:e});await this.app.vault.create(o,c)}async calculateDraftWordCount(t,e){var a,i,s;const n=this.resolveProjectPath(t);if(!n)return F(`${S} No project path found for word count calculation`),0;try{const o=this.getDraftsFolderName(n);if(!o)return F(`${S} No drafts folder found in project`),0;const l=`${n}/${o}/${e}`,c=this.app.vault.getAbstractFileByPath(n);if(!c||!(c instanceof D.TFolder))return F(`${S} Project folder not found at: ${n}`),0;const f=`${n}/${Gt((a=this.manager)==null?void 0:a.settings)}`,h=await be(this.app,f),g=(h==null?void 0:h.project_type)||Bt.MULTI;if(F(`${S} Calculating word count for ${g} project, draft: ${e}`),g===Bt.SINGLE){const u=Vt(e,(s=(i=this.manager)==null?void 0:i.settings)==null?void 0:s.slugStyle),m=`${l}/${u}${pt}`,p=this.app.vault.getAbstractFileByPath(m);if(F(`${S} Looking for single-file draft at: ${m}`),p&&p instanceof D.TFile){const b=await this.app.vault.read(p),d=fn(b),v=In(d);return F(`${S} Single-file draft word count: ${v}`),v}F(`${S} Draft file not found for single-file project`)}else{const u=this.app.vault.getAbstractFileByPath(l);if(!u||!(u instanceof D.TFolder))return F(`${S} Draft folder not found at: ${l}`),0;let m=0;for(const p of u.children)if(p instanceof D.TFile&&p.extension==="md"){const b=await this.app.vault.read(p);if(this.chapters.isValidChapter(b)){const d=fn(b),v=In(d);F(`${S} Chapter "${p.name}" word count: ${v}`),m+=v}}return F(`${S} Multi-file draft total word count: ${m}`),m}}catch(o){F(`${S} Error calculating draft word count:`,o)}return 0}}function fn(r){return r.replace(Ot,"").trim()}function ar(r){return r.replace(/^#{1,6} .*\n/,"").trim()}function Ya(r,t,e){const n=r.match(Ot);if(!n)return r;const a=n[1],i=r.substring(n[0].length),s=a.split(`
`),o=[];let l=!1;for(const f of s)f.match(/^draft:/i)?o.push(`draft: ${t}`):f.match(/^id:/i)?(o.push(`id: ${Ne()}`),l=!0):f.match(/^project:/i)?o.push(`project: ${e}`):f.match(/^created:/i)?o.push(`created: ${new Date().toISOString()}`):o.push(f);l||o.push(`id: ${Ne()}`);const c=o.join(`
`);return`${St}
${c}
${St}${i}`}class qn{constructor(t,e,n){this.chapters=new Ha(t),this.backups=new Wa(t,n),this.drafts=new Ga(t,this.chapters,e,this.backups)}}function Et(){}const qa=r=>r;function _t(r,t){for(const e in t)r[e]=t[e];return r}function Kr(r){return r()}function ir(){return Object.create(null)}function Fe(r){r.forEach(Kr)}function nn(r){return typeof r=="function"}function Rt(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function Ka(r){return Object.keys(r).length===0}function Xt(r,t,e,n){if(r){const a=Xr(r,t,e,n);return r[0](a)}}function Xr(r,t,e,n){return r[1]&&n?_t(e.ctx.slice(),r[1](n(t))):e.ctx}function Jt(r,t,e,n){return r[2],t.dirty}function Qt(r,t,e,n,a,i){if(a){const s=Xr(t,e,n,i);r.p(s,a)}}function te(r){if(r.ctx.length>32){const t=[],e=r.ctx.length/32;for(let n=0;n<e;n++)t[n]=-1;return t}return-1}function Pt(r){const t={};for(const e in r)e[0]!=="$"&&(t[e]=r[e]);return t}function sr(r,t){const e={};t=new Set(t);for(const n in r)!t.has(n)&&n[0]!=="$"&&(e[n]=r[n]);return e}function un(r){return r??""}const Jr=typeof window<"u";let Xa=Jr?()=>window.performance.now():()=>Date.now(),Kn=Jr?r=>requestAnimationFrame(r):Et;const Le=new Set;function Qr(r){Le.forEach(t=>{t.c(r)||(Le.delete(t),t.f())}),Le.size!==0&&Kn(Qr)}function Ja(r){let t;return Le.size===0&&Kn(Qr),{promise:new Promise(e=>{Le.add(t={c:r,f:e})}),abort(){Le.delete(t)}}}function nt(r,t){r.appendChild(t)}function ta(r){if(!r)return document;const t=r.getRootNode?r.getRootNode():r.ownerDocument;return t&&t.host?t:r.ownerDocument}function Qa(r){const t=ct("style");return t.textContent="/* empty */",ti(ta(r),t),t.sheet}function ti(r,t){return nt(r.head||r,t),t.sheet}function wt(r,t,e){r.insertBefore(t,e||null)}function mt(r){r.parentNode&&r.parentNode.removeChild(r)}function ea(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function ct(r){return document.createElement(r)}function na(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Lt(r){return document.createTextNode(r)}function gt(){return Lt(" ")}function $n(){return Lt("")}function ue(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function et(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function gn(r,t){for(const e in t)et(r,e,t[e])}function ei(r){return Array.from(r.childNodes)}function Ge(r,t){t=""+t,r.data!==t&&(r.data=t)}function wn(r,t){r.value=t??""}function ke(r,t,e,n){e==null?r.style.removeProperty(t):r.style.setProperty(t,e,"")}function ae(r,t,e){r.classList.toggle(t,!!e)}function ni(r,t,{bubbles:e=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:t,bubbles:e,cancelable:n})}const vn=new Map;let bn=0;function ri(r){let t=5381,e=r.length;for(;e--;)t=(t<<5)-t^r.charCodeAt(e);return t>>>0}function ai(r,t){const e={stylesheet:Qa(t),rules:{}};return vn.set(r,e),e}function ii(r,t,e,n,a,i,s,o=0){const l=16.666/n;let c=`{
`;for(let b=0;b<=1;b+=l){const d=t+(e-t)*i(b);c+=b*100+`%{${s(d,1-d)}}
`}const f=c+`100% {${s(e,1-e)}}
}`,h=`__svelte_${ri(f)}_${o}`,g=ta(r),{stylesheet:u,rules:m}=vn.get(g)||ai(g,r);m[h]||(m[h]=!0,u.insertRule(`@keyframes ${h} ${f}`,u.cssRules.length));const p=r.style.animation||"";return r.style.animation=`${p?`${p}, `:""}${h} ${n}ms linear ${a}ms 1 both`,bn+=1,h}function si(r,t){const e=(r.style.animation||"").split(", "),n=e.filter(t?i=>i.indexOf(t)<0:i=>i.indexOf("__svelte")===-1),a=e.length-n.length;a&&(r.style.animation=n.join(", "),bn-=a,bn||oi())}function oi(){Kn(()=>{bn||(vn.forEach(r=>{const{ownerNode:t}=r.stylesheet;t&&mt(t)}),vn.clear())})}function li(r,t,e,n){if(!t)return Et;const a=r.getBoundingClientRect();if(t.left===a.left&&t.right===a.right&&t.top===a.top&&t.bottom===a.bottom)return Et;const{delay:i=0,duration:s=300,easing:o=qa,start:l=Xa()+i,end:c=l+s,tick:f=Et,css:h}=e(r,{from:t,to:a},n);let g=!0,u=!1,m;function p(){h&&(m=ii(r,0,1,s,i,o,h)),i||(u=!0)}function b(){h&&si(r,m),g=!1}return Ja(d=>{if(!u&&d>=l&&(u=!0),u&&d>=c&&(f(1,0),b()),!g)return!1;if(u){const v=d-l,y=0+1*o(v/s);f(y,1-y)}return!0}),p(),f(0,1),b}function ci(r){const t=getComputedStyle(r);if(t.position!=="absolute"&&t.position!=="fixed"){const{width:e,height:n}=t,a=r.getBoundingClientRect();r.style.position="absolute",r.style.width=e,r.style.height=n,fi(r,a)}}function fi(r,t){const e=r.getBoundingClientRect();if(t.left!==e.left||t.top!==e.top){const n=getComputedStyle(r),a=n.transform==="none"?"":n.transform;r.style.transform=`${a} translate(${t.left-e.left}px, ${t.top-e.top}px)`}}let en;function Qe(r){en=r}function Xn(){if(!en)throw new Error("Function called outside component initialization");return en}function ui(r){Xn().$$.on_mount.push(r)}function Mn(r){Xn().$$.on_destroy.push(r)}function di(){const r=Xn();return(t,e,{cancelable:n=!1}={})=>{const a=r.$$.callbacks[t];if(a){const i=ni(t,e,{cancelable:n});return a.slice().forEach(s=>{s.call(r,i)}),!i.defaultPrevented}return!0}}const Oe=[],tn=[];let Me=[];const or=[],hi=Promise.resolve();let Un=!1;function pi(){Un||(Un=!0,hi.then(ra))}function Wn(r){Me.push(r)}const Dn=new Set;let Te=0;function ra(){if(Te!==0)return;const r=en;do{try{for(;Te<Oe.length;){const t=Oe[Te];Te++,Qe(t),mi(t.$$)}}catch(t){throw Oe.length=0,Te=0,t}for(Qe(null),Oe.length=0,Te=0;tn.length;)tn.pop()();for(let t=0;t<Me.length;t+=1){const e=Me[t];Dn.has(e)||(Dn.add(e),e())}Me.length=0}while(Oe.length);for(;or.length;)or.pop()();Un=!1,Dn.clear(),Qe(r)}function mi(r){if(r.fragment!==null){r.update(),Fe(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Wn)}}function gi(r){const t=[],e=[];Me.forEach(n=>r.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),Me=t}const hn=new Set;let Pe;function Yt(){Pe={r:0,c:[],p:Pe}}function qt(){Pe.r||Fe(Pe.c),Pe=Pe.p}function q(r,t){r&&r.i&&(hn.delete(r),r.i(t))}function Q(r,t,e,n){if(r&&r.o){if(hn.has(r))return;hn.add(r),Pe.c.push(()=>{hn.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}function $e(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function wi(r,t){r.d(1),t.delete(r.key)}function vi(r,t){Q(r,1,1,()=>{t.delete(r.key)})}function bi(r,t){r.f(),vi(r,t)}function aa(r,t,e,n,a,i,s,o,l,c,f,h){let g=r.length,u=i.length,m=g;const p={};for(;m--;)p[r[m].key]=m;const b=[],d=new Map,v=new Map,y=[];for(m=u;m--;){const A=h(a,i,m),R=e(A);let P=s.get(R);P?y.push(()=>P.p(A,t)):(P=c(R,A),P.c()),d.set(R,b[m]=P),R in p&&v.set(R,Math.abs(m-p[R]))}const $=new Set,k=new Set;function N(A){q(A,1),A.m(o,f),s.set(A.key,A),f=A.first,u--}for(;g&&u;){const A=b[u-1],R=r[g-1],P=A.key,B=R.key;A===R?(f=A.first,g--,u--):d.has(B)?!s.has(P)||$.has(P)?N(A):k.has(B)?g--:v.get(P)>v.get(B)?(k.add(P),N(A)):($.add(B),g--):(l(R,s),g--)}for(;g--;){const A=r[g];d.has(A.key)||l(A,s)}for(;u;)N(b[u-1]);return Fe(y),b}function ie(r,t){const e={},n={},a={$$scope:1};let i=r.length;for(;i--;){const s=r[i],o=t[i];if(o){for(const l in s)l in o||(n[l]=1);for(const l in o)a[l]||(e[l]=o[l],a[l]=1);r[i]=o}else for(const l in s)a[l]=1}for(const s in n)s in e||(e[s]=void 0);return e}function he(r){return typeof r=="object"&&r!==null?r:{}}function ht(r){r&&r.c()}function ut(r,t,e){const{fragment:n,after_update:a}=r.$$;n&&n.m(t,e),Wn(()=>{const i=r.$$.on_mount.map(Kr).filter(nn);r.$$.on_destroy?r.$$.on_destroy.push(...i):Fe(i),r.$$.on_mount=[]}),a.forEach(Wn)}function dt(r,t){const e=r.$$;e.fragment!==null&&(gi(e.after_update),Fe(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function _i(r,t){r.$$.dirty[0]===-1&&(Oe.push(r),pi(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function Mt(r,t,e,n,a,i,s=null,o=[-1]){const l=en;Qe(r);const c=r.$$={fragment:null,ctx:[],props:i,update:Et,not_equal:a,bound:ir(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:ir(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let f=!1;if(c.ctx=e?e(r,t.props||{},(h,g,...u)=>{const m=u.length?u[0]:g;return c.ctx&&a(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),f&&_i(r,h)),g}):[],c.update(),f=!0,Fe(c.before_update),c.fragment=n?n(c.ctx):!1,t.target){if(t.hydrate){const h=ei(t.target);c.fragment&&c.fragment.l(h),h.forEach(mt)}else c.fragment&&c.fragment.c();t.intro&&q(r.$$.fragment),ut(r,t.target,t.anchor),ra()}Qe(l)}class Ut{constructor(){En(this,"$$");En(this,"$$set")}$destroy(){dt(this,1),this.$destroy=Et}$on(t,e){if(!nn(e))return Et;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const a=n.indexOf(e);a!==-1&&n.splice(a,1)}}$set(t){this.$$set&&!Ka(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const yi="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yi);function ki(r){let t,e,n,a,i;const s=r[6].default,o=Xt(s,r,r[5],null);return{c(){t=ct("button"),o&&o.c(),et(t,"class",e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`),et(t,"aria-label",r[3]),t.disabled=r[1],et(t,"style",r[2])},m(l,c){wt(l,t,c),o&&o.m(t,null),n=!0,a||(i=ue(t,"click",function(){nn(r[4])&&r[4].apply(this,arguments)}),a=!0)},p(l,[c]){r=l,o&&o.p&&(!n||c&32)&&Qt(o,s,r,r[5],n?Jt(s,r[5],c,null):te(r[5]),null),(!n||c&1&&e!==(e=`wa-button ${r[0]==="primary"?"primary":r[0]==="ghost"?"ghost":""}`))&&et(t,"class",e),(!n||c&8)&&et(t,"aria-label",r[3]),(!n||c&2)&&(t.disabled=r[1]),(!n||c&4)&&et(t,"style",r[2])},i(l){n||(q(o,l),n=!0)},o(l){Q(o,l),n=!1},d(l){l&&mt(t),o&&o.d(l),a=!1,i()}}}function $i(r,t,e){let{$$slots:n={},$$scope:a}=t,{variant:i="default"}=t,{disabled:s=!1}=t,{style:o=""}=t,{title:l=""}=t,{clickHandler:c=void 0}=t;return r.$$set=f=>{"variant"in f&&e(0,i=f.variant),"disabled"in f&&e(1,s=f.disabled),"style"in f&&e(2,o=f.style),"title"in f&&e(3,l=f.title),"clickHandler"in f&&e(4,c=f.clickHandler),"$$scope"in f&&e(5,a=f.$$scope)},[i,s,o,l,c,a,n]}class _e extends Ut{constructor(t){super(),Mt(this,t,$i,ki,Rt,{variant:0,disabled:1,style:2,title:3,clickHandler:4})}}function Ci(r){let t,e,n,a,i,s,o;const l=r[7].default,c=Xt(l,r,r[6],null);return{c(){t=ct("button"),e=ct("span"),c&&c.c(),et(e,"class",n=un(r[5]?"spinning":"")+" svelte-10fbbmm"),et(t,"class",a=un(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"),et(t,"aria-label",r[0]),t.disabled=r[2],et(t,"title",r[3])},m(f,h){wt(f,t,h),nt(t,e),c&&c.m(e,null),i=!0,s||(o=ue(t,"click",function(){nn(r[4])&&r[4].apply(this,arguments)}),s=!0)},p(f,[h]){r=f,c&&c.p&&(!i||h&64)&&Qt(c,l,r,r[6],i?Jt(l,r[6],h,null):te(r[6]),null),(!i||h&32&&n!==(n=un(r[5]?"spinning":"")+" svelte-10fbbmm"))&&et(e,"class",n),(!i||h&2&&a!==(a=un(`wa-icon-btn clickable-icon ${r[1]==="ghost"?"ghost":""}`)+" svelte-10fbbmm"))&&et(t,"class",a),(!i||h&1)&&et(t,"aria-label",r[0]),(!i||h&4)&&(t.disabled=r[2]),(!i||h&8)&&et(t,"title",r[3])},i(f){i||(q(c,f),i=!0)},o(f){Q(c,f),i=!1},d(f){f&&mt(t),c&&c.d(f),s=!1,o()}}}function Si(r,t,e){let{$$slots:n={},$$scope:a}=t,{ariaLabel:i=""}=t,{variant:s="default"}=t,{disabled:o=!1}=t,{title:l}=t,{clickHandler:c=void 0}=t,{spinning:f=!1}=t;return r.$$set=h=>{"ariaLabel"in h&&e(0,i=h.ariaLabel),"variant"in h&&e(1,s=h.variant),"disabled"in h&&e(2,o=h.disabled),"title"in h&&e(3,l=h.title),"clickHandler"in h&&e(4,c=h.clickHandler),"spinning"in h&&e(5,f=h.spinning),"$$scope"in h&&e(6,a=h.$$scope)},[i,s,o,l,c,f,a,n]}class oe extends Ut{constructor(t){super(),Mt(this,t,Si,Ci,Rt,{ariaLabel:0,variant:1,disabled:2,title:3,clickHandler:4,spinning:5})}}const We=Math.min,Zt=Math.max,_n=Math.round,dn=Math.floor,fe=r=>({x:r,y:r}),Fi={left:"right",right:"left",bottom:"top",top:"bottom"},xi={start:"end",end:"start"};function lr(r,t,e){return Zt(r,We(t,e))}function rn(r,t){return typeof r=="function"?r(t):r}function Ce(r){return r.split("-")[0]}function an(r){return r.split("-")[1]}function ia(r){return r==="x"?"y":"x"}function sa(r){return r==="y"?"height":"width"}const Ei=new Set(["top","bottom"]);function ve(r){return Ei.has(Ce(r))?"y":"x"}function oa(r){return ia(ve(r))}function Di(r,t,e){e===void 0&&(e=!1);const n=an(r),a=oa(r),i=sa(a);let s=a==="x"?n===(e?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=yn(s)),[s,yn(s)]}function Pi(r){const t=yn(r);return[Hn(r),t,Hn(t)]}function Hn(r){return r.replace(/start|end/g,t=>xi[t])}const cr=["left","right"],fr=["right","left"],ji=["top","bottom"],Ni=["bottom","top"];function Ai(r,t,e){switch(r){case"top":case"bottom":return e?t?fr:cr:t?cr:fr;case"left":case"right":return t?ji:Ni;default:return[]}}function Ti(r,t,e,n){const a=an(r);let i=Ai(Ce(r),e==="start",n);return a&&(i=i.map(s=>s+"-"+a),t&&(i=i.concat(i.map(Hn)))),i}function yn(r){return r.replace(/left|right|bottom|top/g,t=>Fi[t])}function Bi(r){return{top:0,right:0,bottom:0,left:0,...r}}function Oi(r){return typeof r!="number"?Bi(r):{top:r,right:r,bottom:r,left:r}}function kn(r){const{x:t,y:e,width:n,height:a}=r;return{width:n,height:a,top:e,left:t,right:t+n,bottom:e+a,x:t,y:e}}function ur(r,t,e){let{reference:n,floating:a}=r;const i=ve(t),s=oa(t),o=sa(s),l=Ce(t),c=i==="y",f=n.x+n.width/2-a.width/2,h=n.y+n.height/2-a.height/2,g=n[o]/2-a[o]/2;let u;switch(l){case"top":u={x:f,y:n.y-a.height};break;case"bottom":u={x:f,y:n.y+n.height};break;case"right":u={x:n.x+n.width,y:h};break;case"left":u={x:n.x-a.width,y:h};break;default:u={x:n.x,y:n.y}}switch(an(t)){case"start":u[s]-=g*(e&&c?-1:1);break;case"end":u[s]+=g*(e&&c?-1:1);break}return u}const Ri=async(r,t,e)=>{const{placement:n="bottom",strategy:a="absolute",middleware:i=[],platform:s}=e,o=i.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(t));let c=await s.getElementRects({reference:r,floating:t,strategy:a}),{x:f,y:h}=ur(c,n,l),g=n,u={},m=0;for(let p=0;p<o.length;p++){const{name:b,fn:d}=o[p],{x:v,y,data:$,reset:k}=await d({x:f,y:h,initialPlacement:n,placement:g,strategy:a,middlewareData:u,rects:c,platform:s,elements:{reference:r,floating:t}});f=v??f,h=y??h,u={...u,[b]:{...u[b],...$}},k&&m<=50&&(m++,typeof k=="object"&&(k.placement&&(g=k.placement),k.rects&&(c=k.rects===!0?await s.getElementRects({reference:r,floating:t,strategy:a}):k.rects),{x:f,y:h}=ur(c,g,l)),p=-1)}return{x:f,y:h,placement:g,strategy:a,middlewareData:u}};async function Jn(r,t){var e;t===void 0&&(t={});const{x:n,y:a,platform:i,rects:s,elements:o,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:f="viewport",elementContext:h="floating",altBoundary:g=!1,padding:u=0}=rn(t,r),m=Oi(u),b=o[g?h==="floating"?"reference":"floating":h],d=kn(await i.getClippingRect({element:(e=await(i.isElement==null?void 0:i.isElement(b)))==null||e?b:b.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:c,rootBoundary:f,strategy:l})),v=h==="floating"?{x:n,y:a,width:s.floating.width,height:s.floating.height}:s.reference,y=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),$=await(i.isElement==null?void 0:i.isElement(y))?await(i.getScale==null?void 0:i.getScale(y))||{x:1,y:1}:{x:1,y:1},k=kn(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:v,offsetParent:y,strategy:l}):v);return{top:(d.top-k.top+m.top)/$.y,bottom:(k.bottom-d.bottom+m.bottom)/$.y,left:(d.left-k.left+m.left)/$.x,right:(k.right-d.right+m.right)/$.x}}const Ii=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var e,n;const{placement:a,middlewareData:i,rects:s,initialPlacement:o,platform:l,elements:c}=t,{mainAxis:f=!0,crossAxis:h=!0,fallbackPlacements:g,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...b}=rn(r,t);if((e=i.arrow)!=null&&e.alignmentOffset)return{};const d=Ce(a),v=ve(o),y=Ce(o)===o,$=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=g||(y||!p?[yn(o)]:Pi(o)),N=m!=="none";!g&&N&&k.push(...Ti(o,p,m,$));const A=[o,...k],R=await Jn(t,b),P=[];let B=((n=i.flip)==null?void 0:n.overflows)||[];if(f&&P.push(R[d]),h){const _=Di(a,s,$);P.push(R[_[0]],R[_[1]])}if(B=[...B,{placement:a,overflows:P}],!P.every(_=>_<=0)){var K,E;const _=(((K=i.flip)==null?void 0:K.index)||0)+1,W=A[_];if(W&&(!(h==="alignment"?v!==ve(W):!1)||B.every(ot=>ve(ot.placement)===v?ot.overflows[0]>0:!0)))return{data:{index:_,overflows:B},reset:{placement:W}};let st=(E=B.filter(V=>V.overflows[0]<=0).sort((V,ot)=>V.overflows[1]-ot.overflows[1])[0])==null?void 0:E.placement;if(!st)switch(u){case"bestFit":{var L;const V=(L=B.filter(ot=>{if(N){const G=ve(ot.placement);return G===v||G==="y"}return!0}).map(ot=>[ot.placement,ot.overflows.filter(G=>G>0).reduce((G,ft)=>G+ft,0)]).sort((ot,G)=>ot[1]-G[1])[0])==null?void 0:L[0];V&&(st=V);break}case"initialPlacement":st=o;break}if(a!==st)return{reset:{placement:st}}}return{}}}},zi=new Set(["left","top"]);async function Li(r,t){const{placement:e,platform:n,elements:a}=r,i=await(n.isRTL==null?void 0:n.isRTL(a.floating)),s=Ce(e),o=an(e),l=ve(e)==="y",c=zi.has(s)?-1:1,f=i&&l?-1:1,h=rn(t,r);let{mainAxis:g,crossAxis:u,alignmentAxis:m}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return o&&typeof m=="number"&&(u=o==="end"?m*-1:m),l?{x:u*f,y:g*c}:{x:g*c,y:u*f}}const Mi=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var e,n;const{x:a,y:i,placement:s,middlewareData:o}=t,l=await Li(t,r);return s===((e=o.offset)==null?void 0:e.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:a+l.x,y:i+l.y,data:{...l,placement:s}}}}},Ui=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:e,y:n,placement:a}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:o={fn:b=>{let{x:d,y:v}=b;return{x:d,y:v}}},...l}=rn(r,t),c={x:e,y:n},f=await Jn(t,l),h=ve(Ce(a)),g=ia(h);let u=c[g],m=c[h];if(i){const b=g==="y"?"top":"left",d=g==="y"?"bottom":"right",v=u+f[b],y=u-f[d];u=lr(v,u,y)}if(s){const b=h==="y"?"top":"left",d=h==="y"?"bottom":"right",v=m+f[b],y=m-f[d];m=lr(v,m,y)}const p=o.fn({...t,[g]:u,[h]:m});return{...p,data:{x:p.x-e,y:p.y-n,enabled:{[g]:i,[h]:s}}}}}},Wi=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var e,n;const{placement:a,rects:i,platform:s,elements:o}=t,{apply:l=()=>{},...c}=rn(r,t),f=await Jn(t,c),h=Ce(a),g=an(a),u=ve(a)==="y",{width:m,height:p}=i.floating;let b,d;h==="top"||h==="bottom"?(b=h,d=g===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(d=h,b=g==="end"?"top":"bottom");const v=p-f.top-f.bottom,y=m-f.left-f.right,$=We(p-f[b],v),k=We(m-f[d],y),N=!t.middlewareData.shift;let A=$,R=k;if((e=t.middlewareData.shift)!=null&&e.enabled.x&&(R=y),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(A=v),N&&!g){const B=Zt(f.left,0),K=Zt(f.right,0),E=Zt(f.top,0),L=Zt(f.bottom,0);u?R=m-2*(B!==0||K!==0?B+K:Zt(f.left,f.right)):A=p-2*(E!==0||L!==0?E+L:Zt(f.top,f.bottom))}await l({...t,availableWidth:R,availableHeight:A});const P=await s.getDimensions(o.floating);return m!==P.width||p!==P.height?{reset:{rects:!0}}:{}}}};function Cn(){return typeof window<"u"}function Ye(r){return la(r)?(r.nodeName||"").toLowerCase():"#document"}function Kt(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function pe(r){var t;return(t=(la(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function la(r){return Cn()?r instanceof Node||r instanceof Kt(r).Node:!1}function le(r){return Cn()?r instanceof Element||r instanceof Kt(r).Element:!1}function de(r){return Cn()?r instanceof HTMLElement||r instanceof Kt(r).HTMLElement:!1}function dr(r){return!Cn()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Kt(r).ShadowRoot}const Hi=new Set(["inline","contents"]);function sn(r){const{overflow:t,overflowX:e,overflowY:n,display:a}=ce(r);return/auto|scroll|overlay|hidden|clip/.test(t+n+e)&&!Hi.has(a)}const Vi=new Set(["table","td","th"]);function Zi(r){return Vi.has(Ye(r))}const Gi=[":popover-open",":modal"];function Sn(r){return Gi.some(t=>{try{return r.matches(t)}catch{return!1}})}const Yi=["transform","translate","scale","rotate","perspective"],qi=["transform","translate","scale","rotate","perspective","filter"],Ki=["paint","layout","strict","content"];function Qn(r){const t=tr(),e=le(r)?ce(r):r;return Yi.some(n=>e[n]?e[n]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||qi.some(n=>(e.willChange||"").includes(n))||Ki.some(n=>(e.contain||"").includes(n))}function Xi(r){let t=Se(r);for(;de(t)&&!He(t);){if(Qn(t))return t;if(Sn(t))return null;t=Se(t)}return null}function tr(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Ji=new Set(["html","body","#document"]);function He(r){return Ji.has(Ye(r))}function ce(r){return Kt(r).getComputedStyle(r)}function Fn(r){return le(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Se(r){if(Ye(r)==="html")return r;const t=r.assignedSlot||r.parentNode||dr(r)&&r.host||pe(r);return dr(t)?t.host:t}function ca(r){const t=Se(r);return He(t)?r.ownerDocument?r.ownerDocument.body:r.body:de(t)&&sn(t)?t:ca(t)}function Ve(r,t,e){var n;t===void 0&&(t=[]),e===void 0&&(e=!0);const a=ca(r),i=a===((n=r.ownerDocument)==null?void 0:n.body),s=Kt(a);if(i){const o=Vn(s);return t.concat(s,s.visualViewport||[],sn(a)?a:[],o&&e?Ve(o):[])}return t.concat(a,Ve(a,[],e))}function Vn(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function fa(r){const t=ce(r);let e=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=de(r),i=a?r.offsetWidth:e,s=a?r.offsetHeight:n,o=_n(e)!==i||_n(n)!==s;return o&&(e=i,n=s),{width:e,height:n,$:o}}function er(r){return le(r)?r:r.contextElement}function Ue(r){const t=er(r);if(!de(t))return fe(1);const e=t.getBoundingClientRect(),{width:n,height:a,$:i}=fa(t);let s=(i?_n(e.width):e.width)/n,o=(i?_n(e.height):e.height)/a;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const Qi=fe(0);function ua(r){const t=Kt(r);return!tr()||!t.visualViewport?Qi:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function ts(r,t,e){return t===void 0&&(t=!1),!e||t&&e!==Kt(r)?!1:t}function Ae(r,t,e,n){t===void 0&&(t=!1),e===void 0&&(e=!1);const a=r.getBoundingClientRect(),i=er(r);let s=fe(1);t&&(n?le(n)&&(s=Ue(n)):s=Ue(r));const o=ts(i,e,n)?ua(i):fe(0);let l=(a.left+o.x)/s.x,c=(a.top+o.y)/s.y,f=a.width/s.x,h=a.height/s.y;if(i){const g=Kt(i),u=n&&le(n)?Kt(n):n;let m=g,p=Vn(m);for(;p&&n&&u!==m;){const b=Ue(p),d=p.getBoundingClientRect(),v=ce(p),y=d.left+(p.clientLeft+parseFloat(v.paddingLeft))*b.x,$=d.top+(p.clientTop+parseFloat(v.paddingTop))*b.y;l*=b.x,c*=b.y,f*=b.x,h*=b.y,l+=y,c+=$,m=Kt(p),p=Vn(m)}}return kn({width:f,height:h,x:l,y:c})}function xn(r,t){const e=Fn(r).scrollLeft;return t?t.left+e:Ae(pe(r)).left+e}function da(r,t){const e=r.getBoundingClientRect(),n=e.left+t.scrollLeft-xn(r,e),a=e.top+t.scrollTop;return{x:n,y:a}}function es(r){let{elements:t,rect:e,offsetParent:n,strategy:a}=r;const i=a==="fixed",s=pe(n),o=t?Sn(t.floating):!1;if(n===s||o&&i)return e;let l={scrollLeft:0,scrollTop:0},c=fe(1);const f=fe(0),h=de(n);if((h||!h&&!i)&&((Ye(n)!=="body"||sn(s))&&(l=Fn(n)),de(n))){const u=Ae(n);c=Ue(n),f.x=u.x+n.clientLeft,f.y=u.y+n.clientTop}const g=s&&!h&&!i?da(s,l):fe(0);return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+f.x+g.x,y:e.y*c.y-l.scrollTop*c.y+f.y+g.y}}function ns(r){return Array.from(r.getClientRects())}function rs(r){const t=pe(r),e=Fn(r),n=r.ownerDocument.body,a=Zt(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),i=Zt(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let s=-e.scrollLeft+xn(r);const o=-e.scrollTop;return ce(n).direction==="rtl"&&(s+=Zt(t.clientWidth,n.clientWidth)-a),{width:a,height:i,x:s,y:o}}const hr=25;function as(r,t){const e=Kt(r),n=pe(r),a=e.visualViewport;let i=n.clientWidth,s=n.clientHeight,o=0,l=0;if(a){i=a.width,s=a.height;const f=tr();(!f||f&&t==="fixed")&&(o=a.offsetLeft,l=a.offsetTop)}const c=xn(n);if(c<=0){const f=n.ownerDocument,h=f.body,g=getComputedStyle(h),u=f.compatMode==="CSS1Compat"&&parseFloat(g.marginLeft)+parseFloat(g.marginRight)||0,m=Math.abs(n.clientWidth-h.clientWidth-u);m<=hr&&(i-=m)}else c<=hr&&(i+=c);return{width:i,height:s,x:o,y:l}}const is=new Set(["absolute","fixed"]);function ss(r,t){const e=Ae(r,!0,t==="fixed"),n=e.top+r.clientTop,a=e.left+r.clientLeft,i=de(r)?Ue(r):fe(1),s=r.clientWidth*i.x,o=r.clientHeight*i.y,l=a*i.x,c=n*i.y;return{width:s,height:o,x:l,y:c}}function pr(r,t,e){let n;if(t==="viewport")n=as(r,e);else if(t==="document")n=rs(pe(r));else if(le(t))n=ss(t,e);else{const a=ua(r);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return kn(n)}function ha(r,t){const e=Se(r);return e===t||!le(e)||He(e)?!1:ce(e).position==="fixed"||ha(e,t)}function os(r,t){const e=t.get(r);if(e)return e;let n=Ve(r,[],!1).filter(o=>le(o)&&Ye(o)!=="body"),a=null;const i=ce(r).position==="fixed";let s=i?Se(r):r;for(;le(s)&&!He(s);){const o=ce(s),l=Qn(s);!l&&o.position==="fixed"&&(a=null),(i?!l&&!a:!l&&o.position==="static"&&!!a&&is.has(a.position)||sn(s)&&!l&&ha(r,s))?n=n.filter(f=>f!==s):a=o,s=Se(s)}return t.set(r,n),n}function ls(r){let{element:t,boundary:e,rootBoundary:n,strategy:a}=r;const s=[...e==="clippingAncestors"?Sn(t)?[]:os(t,this._c):[].concat(e),n],o=s[0],l=s.reduce((c,f)=>{const h=pr(t,f,a);return c.top=Zt(h.top,c.top),c.right=We(h.right,c.right),c.bottom=We(h.bottom,c.bottom),c.left=Zt(h.left,c.left),c},pr(t,o,a));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function cs(r){const{width:t,height:e}=fa(r);return{width:t,height:e}}function fs(r,t,e){const n=de(t),a=pe(t),i=e==="fixed",s=Ae(r,!0,i,t);let o={scrollLeft:0,scrollTop:0};const l=fe(0);function c(){l.x=xn(a)}if(n||!n&&!i)if((Ye(t)!=="body"||sn(a))&&(o=Fn(t)),n){const u=Ae(t,!0,i,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else a&&c();i&&!n&&a&&c();const f=a&&!n&&!i?da(a,o):fe(0),h=s.left+o.scrollLeft-l.x-f.x,g=s.top+o.scrollTop-l.y-f.y;return{x:h,y:g,width:s.width,height:s.height}}function Pn(r){return ce(r).position==="static"}function mr(r,t){if(!de(r)||ce(r).position==="fixed")return null;if(t)return t(r);let e=r.offsetParent;return pe(r)===e&&(e=e.ownerDocument.body),e}function pa(r,t){const e=Kt(r);if(Sn(r))return e;if(!de(r)){let a=Se(r);for(;a&&!He(a);){if(le(a)&&!Pn(a))return a;a=Se(a)}return e}let n=mr(r,t);for(;n&&Zi(n)&&Pn(n);)n=mr(n,t);return n&&He(n)&&Pn(n)&&!Qn(n)?e:n||Xi(r)||e}const us=async function(r){const t=this.getOffsetParent||pa,e=this.getDimensions,n=await e(r.floating);return{reference:fs(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function ds(r){return ce(r).direction==="rtl"}const ma={convertOffsetParentRelativeRectToViewportRelativeRect:es,getDocumentElement:pe,getClippingRect:ls,getOffsetParent:pa,getElementRects:us,getClientRects:ns,getDimensions:cs,getScale:Ue,isElement:le,isRTL:ds};function ga(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function hs(r,t){let e=null,n;const a=pe(r);function i(){var o;clearTimeout(n),(o=e)==null||o.disconnect(),e=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),i();const c=r.getBoundingClientRect(),{left:f,top:h,width:g,height:u}=c;if(o||t(),!g||!u)return;const m=dn(h),p=dn(a.clientWidth-(f+g)),b=dn(a.clientHeight-(h+u)),d=dn(f),y={rootMargin:-m+"px "+-p+"px "+-b+"px "+-d+"px",threshold:Zt(0,We(1,l))||1};let $=!0;function k(N){const A=N[0].intersectionRatio;if(A!==l){if(!$)return s();A?s(!1,A):n=setTimeout(()=>{s(!1,1e-7)},1e3)}A===1&&!ga(c,r.getBoundingClientRect())&&s(),$=!1}try{e=new IntersectionObserver(k,{...y,root:a.ownerDocument})}catch{e=new IntersectionObserver(k,y)}e.observe(r)}return s(!0),i}function wa(r,t,e,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=er(r),f=a||i?[...c?Ve(c):[],...Ve(t)]:[];f.forEach(d=>{a&&d.addEventListener("scroll",e,{passive:!0}),i&&d.addEventListener("resize",e)});const h=c&&o?hs(c,e):null;let g=-1,u=null;s&&(u=new ResizeObserver(d=>{let[v]=d;v&&v.target===c&&u&&(u.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var y;(y=u)==null||y.observe(t)})),e()}),c&&!l&&u.observe(c),u.observe(t));let m,p=l?Ae(r):null;l&&b();function b(){const d=Ae(r);p&&!ga(p,d)&&e(),p=d,m=requestAnimationFrame(b)}return e(),()=>{var d;f.forEach(v=>{a&&v.removeEventListener("scroll",e),i&&v.removeEventListener("resize",e)}),h==null||h(),(d=u)==null||d.disconnect(),u=null,l&&cancelAnimationFrame(m)}}const va=Mi,ba=Ui,_a=Ii,ya=Wi,ps=(r,t,e)=>{const n=new Map,a={platform:ma,...e},i={...a.platform,_c:n};return Ri(r,t,{...a,platform:i})},ms=Object.freeze(Object.defineProperty({__proto__:null,autoUpdate:wa,computePosition:ps,flip:_a,getOverflowAncestors:Ve,offset:va,platform:ma,shift:ba,size:ya},Symbol.toStringTag,{value:"Module"}));/**
 * @license lucide-svelte v0.546.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const gr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};function wr(r,t,e){const n=r.slice();return n[11]=t[e][0],n[12]=t[e][1],n}function jn(r){let t,e=[r[12]],n={};for(let a=0;a<e.length;a+=1)n=_t(n,e[a]);return{c(){t=na(r[11]),gn(t,n)},m(a,i){wt(a,t,i)},p(a,i){gn(t,n=ie(e,[i&32&&a[12]]))},d(a){a&&mt(t)}}}function vr(r){let t=r[11],e,n=r[11]&&jn(r);return{c(){n&&n.c(),e=$n()},m(a,i){n&&n.m(a,i),wt(a,e,i)},p(a,i){a[11]?t?Rt(t,a[11])?(n.d(1),n=jn(a),t=a[11],n.c(),n.m(e.parentNode,e)):n.p(a,i):(n=jn(a),t=a[11],n.c(),n.m(e.parentNode,e)):t&&(n.d(1),n=null,t=a[11])},d(a){a&&mt(e),n&&n.d(a)}}}function gs(r){let t,e,n,a,i,s=$e(r[5]),o=[];for(let g=0;g<s.length;g+=1)o[g]=vr(wr(r,s,g));const l=r[10].default,c=Xt(l,r,r[9],null);let f=[gr,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:a=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],h={};for(let g=0;g<f.length;g+=1)h=_t(h,f[g]);return{c(){t=na("svg");for(let g=0;g<o.length;g+=1)o[g].c();e=$n(),c&&c.c(),gn(t,h)},m(g,u){wt(g,t,u);for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(t,null);nt(t,e),c&&c.m(t,null),i=!0},p(g,[u]){if(u&32){s=$e(g[5]);let m;for(m=0;m<s.length;m+=1){const p=wr(g,s,m);o[m]?o[m].p(p,u):(o[m]=vr(p),o[m].c(),o[m].m(t,e))}for(;m<o.length;m+=1)o[m].d(1);o.length=s.length}c&&c.p&&(!i||u&512)&&Qt(c,l,g,g[9],i?Jt(l,g[9],u,null):te(g[9]),null),gn(t,h=ie(f,[gr,u&128&&g[7],(!i||u&4)&&{width:g[2]},(!i||u&4)&&{height:g[2]},(!i||u&2)&&{stroke:g[1]},(!i||u&28&&n!==(n=g[4]?Number(g[3])*24/Number(g[2]):g[3]))&&{"stroke-width":n},(!i||u&257&&a!==(a=g[6]("lucide-icon","lucide",g[0]?`lucide-${g[0]}`:"",g[8].class)))&&{class:a}]))},i(g){i||(q(c,g),i=!0)},o(g){Q(c,g),i=!1},d(g){g&&mt(t),ea(o,g),c&&c.d(g)}}}function ws(r,t,e){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let a=sr(t,n),{$$slots:i={},$$scope:s}=t,{name:o=void 0}=t,{color:l="currentColor"}=t,{size:c=24}=t,{strokeWidth:f=2}=t,{absoluteStrokeWidth:h=!1}=t,{iconNode:g=[]}=t;const u=(...m)=>m.filter((p,b,d)=>!!p&&d.indexOf(p)===b).join(" ");return r.$$set=m=>{e(8,t=_t(_t({},t),Pt(m))),e(7,a=sr(t,n)),"name"in m&&e(0,o=m.name),"color"in m&&e(1,l=m.color),"size"in m&&e(2,c=m.size),"strokeWidth"in m&&e(3,f=m.strokeWidth),"absoluteStrokeWidth"in m&&e(4,h=m.absoluteStrokeWidth),"iconNode"in m&&e(5,g=m.iconNode),"$$scope"in m&&e(9,s=m.$$scope)},t=Pt(t),[o,l,c,f,h,g,u,a,t,s,i]}class me extends Ut{constructor(t){super(),Mt(this,t,ws,gs,Rt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}function vs(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function bs(r){let t,e;const n=[{name:"arrow-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[vs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function _s(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class ka extends Ut{constructor(t){super(),Mt(this,t,_s,bs,Rt,{})}}function ys(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function ks(r){let t,e;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[ys]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function $s(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class $a extends Ut{constructor(t){super(),Mt(this,t,$s,ks,Rt,{})}}function Cs(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ss(r){let t,e;const n=[{name:"book-open-check"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Cs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Fs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M12 21V7"}],["path",{d:"m16 12 2 2 4-4"}],["path",{d:"M22 6V4a1 1 0 0 0-1-1h-5a4 4 0 0 0-4 4 4 4 0 0 0-4-4H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h6a3 3 0 0 1 3 3 3 3 0 0 1 3-3h6a1 1 0 0 0 1-1v-1.3"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class xs extends Ut{constructor(t){super(),Mt(this,t,Fs,Ss,Rt,{})}}function Es(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ds(r){let t,e;const n=[{name:"chevron-down"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Es]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ps(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"m6 9 6 6 6-6"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class js extends Ut{constructor(t){super(),Mt(this,t,Ps,Ds,Rt,{})}}function Ns(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function As(r){let t,e;const n=[{name:"copy"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ns]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ts(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Bs extends Ut{constructor(t){super(),Mt(this,t,Ts,As,Rt,{})}}function Os(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Rs(r){let t,e;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Os]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Is(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Ca extends Ut{constructor(t){super(),Mt(this,t,Is,Rs,Rt,{})}}function zs(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ls(r){let t,e;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[zs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ms(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Sa extends Ut{constructor(t){super(),Mt(this,t,Ms,Ls,Rt,{})}}function Us(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Ws(r){let t,e;const n=[{name:"rotate-ccw"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Us]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Hs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Fa extends Ut{constructor(t){super(),Mt(this,t,Hs,Ws,Rt,{})}}function Vs(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function Zs(r){let t,e;const n=[{name:"trash"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Vs]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Gs(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class xa extends Ut{constructor(t){super(),Mt(this,t,Gs,Zs,Rt,{})}}function Ys(r){let t;const e=r[2].default,n=Xt(e,r,r[3],null);return{c(){n&&n.c()},m(a,i){n&&n.m(a,i),t=!0},p(a,i){n&&n.p&&(!t||i&8)&&Qt(n,e,a,a[3],t?Jt(e,a[3],i,null):te(a[3]),null)},i(a){t||(q(n,a),t=!0)},o(a){Q(n,a),t=!1},d(a){n&&n.d(a)}}}function qs(r){let t,e;const n=[{name:"x"},r[1],{iconNode:r[0]}];let a={$$slots:{default:[Ys]},$$scope:{ctx:r}};for(let i=0;i<n.length;i+=1)a=_t(a,n[i]);return t=new me({props:a}),{c(){ht(t.$$.fragment)},m(i,s){ut(t,i,s),e=!0},p(i,[s]){const o=s&3?ie(n,[n[0],s&2&&he(i[1]),s&1&&{iconNode:i[0]}]):{};s&8&&(o.$$scope={dirty:s,ctx:i}),t.$set(o)},i(i){e||(q(t.$$.fragment,i),e=!0)},o(i){Q(t.$$.fragment,i),e=!1},d(i){dt(t,i)}}}function Ks(r,t,e){let{$$slots:n={},$$scope:a}=t;const i=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return r.$$set=s=>{e(1,t=_t(_t({},t),Pt(s))),"$$scope"in s&&e(3,a=s.$$scope)},t=Pt(t),[i,t,n,a]}class Xs extends Ut{constructor(t){super(),Mt(this,t,Ks,qs,Rt,{})}}function br(r,t,e){const n=r.slice();return n[38]=t[e],n[40]=e,n}function _r(r){let t,e,n;return{c(){t=ct("label"),e=Lt(r[2]),et(t,"class","wa-select-label-text"),et(t,"for",n="wa-select-"+r[7])},m(a,i){wt(a,t,i),nt(t,e)},p(a,i){i[0]&4&&Ge(e,a[2]),i[0]&128&&n!==(n="wa-select-"+a[7])&&et(t,"for",n)},d(a){a&&mt(t)}}}function Js(r){let t,e;return{c(){t=ct("span"),e=Lt(r[1]),et(t,"class","wa-select-placeholder")},m(n,a){wt(n,t,a),nt(t,e)},p(n,a){a[0]&2&&Ge(e,n[1])},d(n){n&&mt(t)}}}function Qs(r){let t,e;return{c(){t=ct("span"),e=Lt(r[16]),et(t,"class","wa-select-label")},m(n,a){wt(n,t,a),nt(t,e)},p(n,a){a[0]&65536&&Ge(e,n[16])},d(n){n&&mt(t)}}}function yr(r){let t,e,n,a,i;return e=new Xs({}),{c(){t=ct("button"),ht(e.$$.fragment),et(t,"type","button"),et(t,"class","wa-select-clear"),et(t,"aria-label","Clear selection")},m(s,o){wt(s,t,o),ut(e,t,null),n=!0,a||(i=ue(t,"click",r[21]),a=!0)},p:Et,i(s){n||(q(e.$$.fragment,s),n=!0)},o(s){Q(e.$$.fragment,s),n=!1},d(s){s&&mt(t),dt(e),a=!1,i()}}}function kr(r){let t,e,n;return e=new js({}),{c(){t=ct("div"),ht(e.$$.fragment),et(t,"class","wa-select-chevron"),ae(t,"rotated",r[9])},m(a,i){wt(a,t,i),ut(e,t,null),n=!0},p(a,i){(!n||i[0]&512)&&ae(t,"rotated",a[9])},i(a){n||(q(e.$$.fragment,a),n=!0)},o(a){Q(e.$$.fragment,a),n=!1},d(a){a&&mt(t),dt(e)}}}function $r(r){let t,e,n,a=r[4]&&Cr(r);function i(l,c){return l[10].length===0?eo:to}let s=i(r),o=s(r);return{c(){t=ct("div"),a&&a.c(),e=gt(),n=ct("div"),o.c(),et(n,"class","wa-select-list"),et(t,"class","wa-select-dropdown")},m(l,c){wt(l,t,c),a&&a.m(t,null),nt(t,e),nt(t,n),o.m(n,null),r[30](t)},p(l,c){l[4]?a?a.p(l,c):(a=Cr(l),a.c(),a.m(t,e)):a&&(a.d(1),a=null),s===(s=i(l))&&o?o.p(l,c):(o.d(1),o=s(l),o&&(o.c(),o.m(n,null)))},d(l){l&&mt(t),a&&a.d(),o.d(),r[30](null)}}}function Cr(r){let t,e,n,a;return{c(){t=ct("div"),e=ct("input"),et(e,"type","text"),et(e,"class","wa-select-search-input"),et(e,"placeholder","Search..."),e.value=r[13],et(t,"class","wa-select-search")},m(i,s){wt(i,t,s),nt(t,e),r[27](e),n||(a=ue(e,"input",r[23]),n=!0)},p(i,s){s[0]&8192&&e.value!==i[13]&&(e.value=i[13])},d(i){i&&mt(t),r[27](null),n=!1,a()}}}function to(r){let t=[],e=new Map,n,a=$e(r[10]);const i=s=>s[38].value;for(let s=0;s<a.length;s+=1){let o=br(r,a,s),l=i(o);e.set(l,t[s]=Sr(l,o))}return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=$n()},m(s,o){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(s,o);wt(s,n,o)},p(s,o){o[0]&1197056&&(a=$e(s[10]),t=aa(t,o,i,1,s,a,e,n.parentNode,wi,Sr,n,br))},d(s){s&&mt(n);for(let o=0;o<t.length;o+=1)t[o].d(s)}}}function eo(r){let t;return{c(){t=ct("div"),t.textContent="No options available",et(t,"class","wa-select-empty")},m(e,n){wt(e,t,n)},p:Et,d(e){e&&mt(t)}}}function Sr(r,t){let e,n=t[38].label+"",a,i,s,o,l;function c(){return t[28](t[38])}function f(){return t[29](t[40])}return{key:r,first:null,c(){e=ct("button"),a=Lt(n),i=gt(),et(e,"type","button"),et(e,"class","wa-select-option"),et(e,"data-select-index",s=t[40]),ae(e,"selected",t[14]===t[40]),ae(e,"active",t[17]()===t[38].value),this.first=e},m(h,g){wt(h,e,g),nt(e,a),nt(e,i),o||(l=[ue(e,"click",c),ue(e,"mouseenter",f)],o=!0)},p(h,g){t=h,g[0]&1024&&n!==(n=t[38].label+"")&&Ge(a,n),g[0]&1024&&s!==(s=t[40])&&et(e,"data-select-index",s),g[0]&17408&&ae(e,"selected",t[14]===t[40]),g[0]&132096&&ae(e,"active",t[17]()===t[38].value)},d(h){h&&mt(e),o=!1,Fe(l)}}}function no(r){let t,e,n,a,i,s,o,l,c,f,h,g,u,m=r[2]&&_r(r);function p(k,N){return k[0]?Qs:Js}let b=p(r),d=b(r),v=r[5]&&r[0]&&yr(r),y=r[6]&&kr(r),$=r[9]&&$r(r);return{c(){t=ct("div"),m&&m.c(),e=gt(),n=ct("div"),a=ct("div"),d.c(),i=gt(),s=ct("div"),v&&v.c(),o=gt(),y&&y.c(),f=gt(),$&&$.c(),et(a,"class","wa-select-value"),et(s,"class","wa-select-controls"),et(n,"id",l="wa-select-"+r[7]),et(n,"class","wa-select-trigger"),et(n,"role","button"),et(n,"tabindex",c=r[3]?-1:0),et(n,"style",r[8]),ae(n,"open",r[9]),ae(n,"disabled",r[3]),ae(n,"has-value",r[0]),et(t,"class","wa-select-container wa-select")},m(k,N){wt(k,t,N),m&&m.m(t,null),nt(t,e),nt(t,n),nt(n,a),d.m(a,null),nt(n,i),nt(n,s),v&&v.m(s,null),nt(s,o),y&&y.m(s,null),r[25](n),nt(t,f),$&&$.m(t,null),h=!0,g||(u=[ue(n,"click",r[26]),ue(n,"keydown",r[22])],g=!0)},p(k,N){k[2]?m?m.p(k,N):(m=_r(k),m.c(),m.m(t,e)):m&&(m.d(1),m=null),b===(b=p(k))&&d?d.p(k,N):(d.d(1),d=b(k),d&&(d.c(),d.m(a,null))),k[5]&&k[0]?v?(v.p(k,N),N[0]&33&&q(v,1)):(v=yr(k),v.c(),q(v,1),v.m(s,o)):v&&(Yt(),Q(v,1,1,()=>{v=null}),qt()),k[6]?y?(y.p(k,N),N[0]&64&&q(y,1)):(y=kr(k),y.c(),q(y,1),y.m(s,null)):y&&(Yt(),Q(y,1,1,()=>{y=null}),qt()),(!h||N[0]&128&&l!==(l="wa-select-"+k[7]))&&et(n,"id",l),(!h||N[0]&8&&c!==(c=k[3]?-1:0))&&et(n,"tabindex",c),(!h||N[0]&256)&&et(n,"style",k[8]),(!h||N[0]&512)&&ae(n,"open",k[9]),(!h||N[0]&8)&&ae(n,"disabled",k[3]),(!h||N[0]&1)&&ae(n,"has-value",k[0]),k[9]?$?$.p(k,N):($=$r(k),$.c(),$.m(t,null)):$&&($.d(1),$=null)},i(k){h||(q(v),q(y),h=!0)},o(k){Q(v),Q(y),h=!1},d(k){k&&mt(t),m&&m.d(),d.d(),v&&v.d(),y&&y.d(),r[25](null),$&&$.d(),g=!1,Fe(u)}}}function ro(r,t,e){let n,{items:a=[]}=t,{value:i=null}=t,{placeholder:s="Select..."}=t,{label:o=""}=t,{disabled:l=!1}=t,{searchable:c=!1}=t,{clearable:f=!1}=t,{showChevron:h=!0}=t,{name:g=""}=t,{containerStyles:u=""}=t,m=!1,p="",b=[],d=-1,v,y,$,k=null;const N=di();function A(){return i?typeof i=="string"?i:i.value||"":""}function R(){p?e(10,b=a.filter(U=>U.label.toLowerCase().includes(p.toLowerCase())||U.value.toLowerCase().includes(p.toLowerCase()))):e(10,b=a),e(14,d=-1)}function P(){l||m||(e(9,m=!0),e(13,p=""),R(),c&&setTimeout(()=>{$&&$.focus()},0),v&&y&&K())}function B(){e(9,m=!1),e(13,p=""),e(14,d=-1)}function K(){if(!v||!y)return;const U=[va(6),_a({padding:8,fallbackAxisSideDirection:"end"}),ba({padding:8}),ya({padding:8,apply({availableHeight:X}){Object.assign(y.style,{maxHeight:`${Math.min(X-10,350)}px`,width:`${v.offsetWidth}px`})}})];k=wa(v,y,async()=>{const{computePosition:X}=await Promise.resolve().then(()=>ms),{x:$t,y:jt,placement:vt}=await X(v,y,{middleware:U,placement:"bottom-start"});y.setAttribute("data-placement",vt),Object.assign(y.style,{left:`${$t}px`,top:`${jt}px`})})}function E(U){e(0,i=U),B(),N("select",U)}function L(U){U.stopPropagation(),e(0,i=null),B(),N("clear")}function _(U){if(!m){(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),P());return}switch(U.key){case"ArrowDown":U.preventDefault(),e(14,d=Math.min(d+1,b.length-1)),W();break;case"ArrowUp":U.preventDefault(),e(14,d=Math.max(d-1,-1)),W();break;case"Enter":U.preventDefault(),d>=0?E(b[d]):B();break;case"Escape":U.preventDefault(),B();break}}function W(){if(d<0)return;const U=document.querySelector(`[data-select-index="${d}"]`);U&&U.scrollIntoView({block:"nearest"})}function st(U){e(13,p=U.target.value),R()}function V(U){if(m&&v&&y){const X=U.target;!v.contains(X)&&!y.contains(X)&&B()}}ui(()=>{document.addEventListener("click",V),R()}),Mn(()=>{document.removeEventListener("click",V),k&&k()});function ot(U){tn[U?"unshift":"push"](()=>{v=U,e(11,v)})}const G=()=>m?B():P();function ft(U){tn[U?"unshift":"push"](()=>{$=U,e(15,$)})}const I=U=>E(U),O=U=>e(14,d=U);function lt(U){tn[U?"unshift":"push"](()=>{y=U,e(12,y),e(9,m),e(11,v)})}return r.$$set=U=>{"items"in U&&e(24,a=U.items),"value"in U&&e(0,i=U.value),"placeholder"in U&&e(1,s=U.placeholder),"label"in U&&e(2,o=U.label),"disabled"in U&&e(3,l=U.disabled),"searchable"in U&&e(4,c=U.searchable),"clearable"in U&&e(5,f=U.clearable),"showChevron"in U&&e(6,h=U.showChevron),"name"in U&&e(7,g=U.name),"containerStyles"in U&&e(8,u=U.containerStyles)},r.$$.update=()=>{var U;if(r.$$.dirty[0]&16777219&&e(16,n=i?typeof i=="string"?((U=a.find(X=>X.value===i))==null?void 0:U.label)||i:i.label||s:s),r.$$.dirty[0]&1025&&i!==void 0&&b.length>0){const X=A();e(14,d=b.findIndex($t=>$t.value===X))}r.$$.dirty[0]&6656&&m&&y&&v&&(e(12,y.style.width=`${v.offsetWidth}px`,y),e(12,y.style.top=`${v.offsetTop+v.offsetHeight+6}px`,y))},R(),[i,s,o,l,c,f,h,g,u,m,b,v,y,p,d,$,n,A,P,B,E,L,_,st,a,ot,G,ft,I,O,lt]}class ao extends Ut{constructor(t){super(),Mt(this,t,ro,no,Rt,{items:24,value:0,placeholder:1,label:2,disabled:3,searchable:4,clearable:5,showChevron:6,name:7,containerStyles:8},null,[-1,-1])}}class Fr extends D.Modal{constructor(t,e,n,a="draft"){super(t),this.name=e,this.onConfirm=n,this.type=a}onOpen(){const{contentEl:t}=this;t.addClass("wa-centered-modal");const e=this.type==="chapter"?"chapter":"draft";t.createEl("h3",{text:`Delete ${e} '${this.name}'?`}),this.type==="draft"&&t.createEl("p",{text:"This will create a backup copy before deleting."});const n=t.createDiv({cls:"modal-button-row wa-button-group"}),a=n.createEl("button",{text:"Delete",cls:"mod-cta wa-button"}),i=n.createEl("button",{text:"Cancel",cls:"wa-button"});a.onclick=async()=>{F(`${S} ConfirmDeleteModal: confirmed delete for ${this.type} "${this.name}"`),this.close(),await this.onConfirm()},i.onclick=()=>{F(`${S} ConfirmDeleteModal: cancelled delete for ${this.type} "${this.name}"`),this.close()}}}class io extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:`Duplicate Draft: ${this.props.sourceDraftName}`});let e="";new D.Setting(t).setName("New draft name").addText(n=>n.setPlaceholder(this.props.suggestedName).setValue(this.props.suggestedName).onChange(a=>e=a)),new D.Setting(t).addButton(n=>n.setButtonText("Duplicate").setCta().onClick(()=>{const a=e&&e.trim()?e.trim():this.props.suggestedName;F(`${S} DuplicateDraftModal: duplicating draft from "${this.props.sourceDraftName}" to "${a}"`),this.close(),this.props.onSubmit(a)}))}onClose(){this.contentEl.empty()}}class so extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var i;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Chapter"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New chapter name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new chapter name",cls:"wa-rename-input",attr:{"aria-label":"New chapter name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("div",{cls:"wa-rename-btn-row"}),a=n.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=n.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var s,o;(s=this.inputEl)==null||s.focus(),(o=this.inputEl)==null||o.select()},0),(i=this.inputEl)==null||i.addEventListener("keydown",s=>{s.key==="Enter"?this.submit():s.key==="Escape"&&this.close()}),a.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var e,n,a;const t=(e=this.inputEl)==null?void 0:e.value.trim();if(!t){this.errorEl&&(this.errorEl.textContent="Chapter name cannot be empty.",this.errorEl.style.display=""),(n=this.inputEl)==null||n.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameChapterModal: renaming chapter from "${this.oldName}" to "${t}"`),this.onSubmit(t),this.close()}}class oo extends D.Modal{constructor(t,e,n){super(t),this.oldName=e,this.onSubmit=n}onOpen(){var s;const{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"Rename Draft"}),t.createEl("div",{text:`Current name: '${this.oldName}'`,cls:"wa-rename-info"});const e=t.createEl("label",{text:"New draft name",cls:"wa-rename-label"});this.inputEl=t.createEl("input",{type:"text",value:this.oldName,placeholder:"Enter new draft name",cls:"wa-rename-input",attr:{"aria-label":"New draft name"}}),e.appendChild(this.inputEl),this.errorEl=t.createEl("div",{cls:"wa-rename-error"}),this.errorEl.style.color="var(--color-red, #d43c3c)",this.errorEl.style.display="none";const n=t.createEl("label",{cls:"wa-rename-checkbox-label"});this.checkboxEl=n.createEl("input",{type:"checkbox",attr:{checked:"checked"}}),n.appendText(" Also rename the main draft file (filename)");const a=t.createEl("div",{cls:"wa-rename-btn-row"}),i=a.createEl("button",{text:"Rename",cls:"mod-cta"});this.cancelBtn=a.createEl("button",{text:"Cancel",cls:"mod-cancel"}),setTimeout(()=>{var o,l;(o=this.inputEl)==null||o.focus(),(l=this.inputEl)==null||l.select()},0),(s=this.inputEl)==null||s.addEventListener("keydown",o=>{o.key==="Enter"?this.submit():o.key==="Escape"&&this.close()}),i.addEventListener("click",()=>this.submit()),this.cancelBtn.addEventListener("click",()=>this.close())}submit(){var n,a,i;const t=(n=this.inputEl)==null?void 0:n.value.trim(),e=this.checkboxEl?this.checkboxEl.checked:!1;if(!t){this.errorEl&&(this.errorEl.textContent="Draft name cannot be empty.",this.errorEl.style.display=""),(a=this.inputEl)==null||a.focus();return}if(t===this.oldName){this.errorEl&&(this.errorEl.textContent="Please enter a different name.",this.errorEl.style.display=""),(i=this.inputEl)==null||i.focus();return}this.errorEl&&(this.errorEl.style.display="none"),F(`${S} RenameDraftModal: renaming draft from "${this.oldName}" to "${t}", renameFile: ${e}`),this.onSubmit(t,e),this.close()}}function Ea(r){const t=r-1;return t*t*t+1}function lo(r,{from:t,to:e},n={}){const a=getComputedStyle(r),i=a.transform==="none"?"":a.transform,[s,o]=a.transformOrigin.split(" ").map(parseFloat),l=t.left+t.width*s/e.width-(e.left+s),c=t.top+t.height*o/e.height-(e.top+o),{delay:f=0,duration:h=u=>Math.sqrt(u)*120,easing:g=Ea}=n;return{delay:f,duration:nn(h)?h(Math.sqrt(l*l+c*c)):h,easing:g,css:(u,m)=>{const p=m*l,b=m*c,d=u+m*t.width/e.width,v=u+m*t.height/e.height;return`transform: ${i} translate(${p}px, ${b}px) scale(${d}, ${v});`}}}function xr(r,t,e){const n=r.slice();return n[64]=t[e],n[66]=e,n}function Er(r,t,e){const n=r.slice();return n[67]=t[e],n}function co(r){let t,e;return t=new Fa({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function fo(r){let t;return{c(){t=Lt("New Project")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function Dr(r){let t;return{c(){t=ct("div"),t.textContent="No projects found.",et(t,"class","wa-muted"),ke(t,"margin","4rem auto 0"),ke(t,"font-size","18px"),ke(t,"width","fit-content")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function Pr(r){let t,e,n,a,i,s;return i=new ao({props:{name:"wa-project-select",value:r[3],items:r[7],placeholder:"Choose a project...",showChevron:!0,disabled:Oo,clearable:!1,searchable:!1}}),i.$on("select",r[41]),{c(){t=ct("div"),e=ct("label"),e.textContent="Select project",n=gt(),a=ct("div"),ht(i.$$.fragment),et(e,"for","wa-project-select"),et(a,"class","wa-row"),ke(t,"margin","20px 0")},m(o,l){wt(o,t,l),nt(t,e),nt(t,n),nt(t,a),ut(i,a,null),s=!0},p(o,l){const c={};l[0]&8&&(c.value=o[3]),l[0]&128&&(c.items=o[7]),i.$set(c)},i(o){s||(q(i.$$.fragment,o),s=!0)},o(o){Q(i.$$.fragment,o),s=!1},d(o){o&&mt(t),dt(i)}}}function jr(r){let t,e,n,a,i,s,o,l,c,f,h,g,u,m,p,b;o=new oe({props:{ariaLabel:"Toggle draft sort order",title:void 0,clickHandler:r[42],$$slots:{default:[po]},$$scope:{ctx:r}}}),f=new _e({props:{title:"New draft",clickHandler:r[23],variant:"primary",$$slots:{default:[mo]},$$scope:{ctx:r}}}),g=new oe({props:{ariaLabel:"Refresh drafts",title:void 0,clickHandler:r[20],disabled:r[8],spinning:r[8],$$slots:{default:[go]},$$scope:{ctx:r}}});let d=r[9]&&Nr(r),v=r[5].length===0&&Ar(),y=r[5].length>0&&Tr(r);return{c(){t=ct("div"),e=ct("div"),n=ct("div"),a=ct("div"),i=ct("div"),i.textContent="Drafts",s=gt(),ht(o.$$.fragment),l=gt(),c=ct("div"),ht(f.$$.fragment),h=gt(),ht(g.$$.fragment),u=gt(),d&&d.c(),m=gt(),v&&v.c(),p=gt(),y&&y.c(),et(i,"class","wa-title"),et(a,"class","wa-button-group"),et(c,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","draft-controls"),ke(t,"margin-top","16px")},m($,k){wt($,t,k),nt(t,e),nt(e,n),nt(n,a),nt(a,i),nt(a,s),ut(o,a,null),nt(n,l),nt(n,c),ut(f,c,null),nt(c,h),ut(g,c,null),nt(t,u),d&&d.m(t,null),nt(t,m),v&&v.m(t,null),nt(t,p),y&&y.m(t,null),b=!0},p($,k){const N={};k[0]&2048&&(N.clickHandler=$[42]),k[0]&2048|k[2]&256&&(N.$$scope={dirty:k,ctx:$}),o.$set(N);const A={};k[2]&256&&(A.$$scope={dirty:k,ctx:$}),f.$set(A);const R={};k[0]&256&&(R.disabled=$[8]),k[0]&256&&(R.spinning=$[8]),k[2]&256&&(R.$$scope={dirty:k,ctx:$}),g.$set(R),$[9]?d?(d.p($,k),k[0]&512&&q(d,1)):(d=Nr($),d.c(),q(d,1),d.m(t,m)):d&&(Yt(),Q(d,1,1,()=>{d=null}),qt()),$[5].length===0?v||(v=Ar(),v.c(),v.m(t,p)):v&&(v.d(1),v=null),$[5].length>0?y?(y.p($,k),k[0]&32&&q(y,1)):(y=Tr($),y.c(),q(y,1),y.m(t,null)):y&&(Yt(),Q(y,1,1,()=>{y=null}),qt())},i($){b||(q(o.$$.fragment,$),q(f.$$.fragment,$),q(g.$$.fragment,$),q(d),q(y),b=!0)},o($){Q(o.$$.fragment,$),Q(f.$$.fragment,$),Q(g.$$.fragment,$),Q(d),Q(y),b=!1},d($){$&&mt(t),dt(o),dt(f),dt(g),d&&d.d(),v&&v.d(),y&&y.d()}}}function uo(r){let t,e;return t=new ka({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function ho(r){let t,e;return t=new $a({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function po(r){let t,e,n,a;const i=[ho,uo],s=[];function o(l,c){return l[11]?0:1}return t=o(r),e=s[t]=i[t](r),{c(){e.c(),n=$n()},m(l,c){s[t].m(l,c),wt(l,n,c),a=!0},p(l,c){let f=t;t=o(l),t!==f&&(Yt(),Q(s[f],1,1,()=>{s[f]=null}),qt(),e=s[t],e||(e=s[t]=i[t](l),e.c()),q(e,1),e.m(n.parentNode,n))},i(l){a||(q(e),a=!0)},o(l){Q(e),a=!1},d(l){l&&mt(n),s[t].d(l)}}}function mo(r){let t;return{c(){t=Lt("New Draft")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function go(r){let t,e;return t=new Fa({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Nr(r){let t,e,n,a,i,s,o,l,c;return a=new _e({props:{clickHandler:r[22],variant:"primary",$$slots:{default:[wo]},$$scope:{ctx:r}}}),s=new _e({props:{clickHandler:r[44],$$slots:{default:[vo]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("input"),n=gt(),ht(a.$$.fragment),i=gt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Draft name"),et(t,"class","create-inline wa-row")},m(f,h){wt(f,t,h),nt(t,e),wn(e,r[10]),nt(t,n),ut(a,t,null),nt(t,i),ut(s,t,null),o=!0,l||(c=ue(e,"input",r[43]),l=!0)},p(f,h){h[0]&1024&&e.value!==f[10]&&wn(e,f[10]);const g={};h[2]&256&&(g.$$scope={dirty:h,ctx:f}),a.$set(g);const u={};h[0]&1536&&(u.clickHandler=f[44]),h[2]&256&&(u.$$scope={dirty:h,ctx:f}),s.$set(u)},i(f){o||(q(a.$$.fragment,f),q(s.$$.fragment,f),o=!0)},o(f){Q(a.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&mt(t),dt(a),dt(s),l=!1,c()}}}function wo(r){let t;return{c(){t=Lt("Create")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function vo(r){let t;return{c(){t=Lt("Cancel")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function Ar(r){let t;return{c(){t=ct("div"),t.textContent="No drafts found."},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function Tr(r){let t,e,n=$e(r[5]),a=[];for(let s=0;s<n.length;s+=1)a[s]=Rr(Er(r,n,s));const i=s=>Q(a[s],1,1,()=>{a[s]=null});return{c(){t=ct("div");for(let s=0;s<a.length;s+=1)a[s].c();et(t,"class","wa-draft-list")},m(s,o){wt(s,t,o);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(t,null);e=!0},p(s,o){if(o[0]&251662368|o[1]&8){n=$e(s[5]);let l;for(l=0;l<n.length;l+=1){const c=Er(s,n,l);a[l]?(a[l].p(c,o),q(a[l],1)):(a[l]=Rr(c),a[l].c(),q(a[l],1),a[l].m(t,null))}for(Yt(),l=n.length;l<a.length;l+=1)i(l);qt()}},i(s){if(!e){for(let o=0;o<n.length;o+=1)q(a[o]);e=!0}},o(s){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)Q(a[o]);e=!1},d(s){s&&mt(t),ea(a,s)}}}function Br(r){let t;return{c(){t=ct("span"),t.textContent="●",et(t,"class","wa-draft-active-indicator"),et(t,"title","Active draft")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function bo(r){let t,e;return t=new Ca({props:{size:xe}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Or(r){let t,e;function n(){return r[46](r[67])}return t=new oe({props:{ariaLabel:"Set active draft",title:void 0,clickHandler:n,$$slots:{default:[_o]},$$scope:{ctx:r}}}),{c(){ht(t.$$.fragment)},m(a,i){ut(t,a,i),e=!0},p(a,i){r=a;const s={};i[0]&32&&(s.clickHandler=n),i[2]&256&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(a){e||(q(t.$$.fragment,a),e=!0)},o(a){Q(t.$$.fragment,a),e=!1},d(a){dt(t,a)}}}function _o(r){let t,e;return t=new xs({props:{size:xe}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function yo(r){let t,e;return t=new Sa({props:{size:xe}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function ko(r){let t,e;return t=new Bs({props:{size:xe}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function $o(r){let t,e;return t=new xa({props:{size:xe}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Rr(r){let t,e,n,a=r[67]+"",i,s,o,l,c,f,h,g,u,m,p,b,d,v,y=r[12]===r[67]&&Br();function $(){return r[45](r[67])}l=new oe({props:{ariaLabel:"Open draft",title:void 0,clickHandler:$,$$slots:{default:[bo]},$$scope:{ctx:r}}});let k=r[12]!==r[67]&&Or(r);function N(){return r[47](r[67])}h=new oe({props:{ariaLabel:"Rename draft",title:void 0,clickHandler:N,$$slots:{default:[yo]},$$scope:{ctx:r}}});function A(){return r[48](r[67])}u=new oe({props:{ariaLabel:"Duplicate draft",title:void 0,clickHandler:A,$$slots:{default:[ko]},$$scope:{ctx:r}}});function R(){return r[49](r[67])}return p=new oe({props:{ariaLabel:"Delete draft",title:void 0,clickHandler:R,$$slots:{default:[$o]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("div"),y&&y.c(),n=gt(),i=Lt(a),s=gt(),o=ct("div"),ht(l.$$.fragment),c=gt(),k&&k.c(),f=gt(),ht(h.$$.fragment),g=gt(),ht(u.$$.fragment),m=gt(),ht(p.$$.fragment),b=gt(),et(e,"class","wa-draft-name wa-row"),et(o,"class","wa-draft-actions"),et(t,"class",d="wa-draft-item "+(r[12]===r[67]?"active":""))},m(P,B){wt(P,t,B),nt(t,e),y&&y.m(e,null),nt(e,n),nt(e,i),nt(t,s),nt(t,o),ut(l,o,null),nt(o,c),k&&k.m(o,null),nt(o,f),ut(h,o,null),nt(o,g),ut(u,o,null),nt(o,m),ut(p,o,null),nt(t,b),v=!0},p(P,B){r=P,r[12]===r[67]?y||(y=Br(),y.c(),y.m(e,n)):y&&(y.d(1),y=null),(!v||B[0]&32)&&a!==(a=r[67]+"")&&Ge(i,a);const K={};B[0]&32&&(K.clickHandler=$),B[2]&256&&(K.$$scope={dirty:B,ctx:r}),l.$set(K),r[12]!==r[67]?k?(k.p(r,B),B[0]&4128&&q(k,1)):(k=Or(r),k.c(),q(k,1),k.m(o,f)):k&&(Yt(),Q(k,1,1,()=>{k=null}),qt());const E={};B[0]&32&&(E.clickHandler=N),B[2]&256&&(E.$$scope={dirty:B,ctx:r}),h.$set(E);const L={};B[0]&32&&(L.clickHandler=A),B[2]&256&&(L.$$scope={dirty:B,ctx:r}),u.$set(L);const _={};B[0]&32&&(_.clickHandler=R),B[2]&256&&(_.$$scope={dirty:B,ctx:r}),p.$set(_),(!v||B[0]&4128&&d!==(d="wa-draft-item "+(r[12]===r[67]?"active":"")))&&et(t,"class",d)},i(P){v||(q(l.$$.fragment,P),q(k),q(h.$$.fragment,P),q(u.$$.fragment,P),q(p.$$.fragment,P),v=!0)},o(P){Q(l.$$.fragment,P),Q(k),Q(h.$$.fragment,P),Q(u.$$.fragment,P),Q(p.$$.fragment,P),v=!1},d(P){P&&mt(t),y&&y.d(),dt(l),k&&k.d(),dt(h),dt(u),dt(p)}}}function Ir(r){let t,e,n,a,i,s,o,l,c,f,h,g;o=new _e({props:{clickHandler:r[50],variant:"primary",$$slots:{default:[Co]},$$scope:{ctx:r}}});let u=r[15]&&zr(r);const m=[Do,Eo,xo],p=[];function b(d,v){return d[14]?0:d[13].length===0?1:2}return f=b(r),h=p[f]=m[f](r),{c(){t=ct("div"),e=ct("div"),n=ct("div"),a=ct("div"),a.textContent="Chapters",i=gt(),s=ct("div"),ht(o.$$.fragment),l=gt(),u&&u.c(),c=gt(),h.c(),et(a,"class","wa-title"),et(s,"class","wa-button-group"),et(n,"class","wa-row justify-between"),et(e,"class","wa-panel-header"),et(t,"class","chapter-controls"),ke(t,"margin-top","18px")},m(d,v){wt(d,t,v),nt(t,e),nt(e,n),nt(n,a),nt(n,i),nt(n,s),ut(o,s,null),nt(t,l),u&&u.m(t,null),nt(t,c),p[f].m(t,null),g=!0},p(d,v){const y={};v[0]&32768&&(y.clickHandler=d[50]),v[2]&256&&(y.$$scope={dirty:v,ctx:d}),o.$set(y),d[15]?u?(u.p(d,v),v[0]&32768&&q(u,1)):(u=zr(d),u.c(),q(u,1),u.m(t,c)):u&&(Yt(),Q(u,1,1,()=>{u=null}),qt());let $=f;f=b(d),f===$?p[f].p(d,v):(Yt(),Q(p[$],1,1,()=>{p[$]=null}),qt(),h=p[f],h?h.p(d,v):(h=p[f]=m[f](d),h.c()),q(h,1),h.m(t,null))},i(d){g||(q(o.$$.fragment,d),q(u),q(h),g=!0)},o(d){Q(o.$$.fragment,d),Q(u),Q(h),g=!1},d(d){d&&mt(t),dt(o),u&&u.d(),p[f].d()}}}function Co(r){let t;return{c(){t=Lt("New Chapter")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function zr(r){let t,e,n,a,i,s,o,l,c;return a=new _e({props:{clickHandler:r[52],variant:"primary",$$slots:{default:[So]},$$scope:{ctx:r}}}),s=new _e({props:{clickHandler:r[53],$$slots:{default:[Fo]},$$scope:{ctx:r}}}),{c(){t=ct("div"),e=ct("input"),n=gt(),ht(a.$$.fragment),i=gt(),ht(s.$$.fragment),et(e,"class","wa-create-draft-input"),et(e,"type","text"),et(e,"placeholder","Chapter name"),et(t,"class","create-inline wa-row")},m(f,h){wt(f,t,h),nt(t,e),wn(e,r[16]),nt(t,n),ut(a,t,null),nt(t,i),ut(s,t,null),o=!0,l||(c=ue(e,"input",r[51]),l=!0)},p(f,h){h[0]&65536&&e.value!==f[16]&&wn(e,f[16]);const g={};h[0]&229393&&(g.clickHandler=f[52]),h[2]&256&&(g.$$scope={dirty:h,ctx:f}),a.$set(g);const u={};h[0]&229376&&(u.clickHandler=f[53]),h[2]&256&&(u.$$scope={dirty:h,ctx:f}),s.$set(u)},i(f){o||(q(a.$$.fragment,f),q(s.$$.fragment,f),o=!0)},o(f){Q(a.$$.fragment,f),Q(s.$$.fragment,f),o=!1},d(f){f&&mt(t),dt(a),dt(s),l=!1,c()}}}function So(r){let t;return{c(){t=Lt("Create")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function Fo(r){let t;return{c(){t=Lt("Cancel")},m(e,n){wt(e,t,n)},d(e){e&&mt(t)}}}function xo(r){let t,e=[],n=new Map,a,i=$e(r[13]);const s=o=>o[64].chapterName;for(let o=0;o<i.length;o+=1){let l=xr(r,i,o),c=s(l);n.set(c,e[o]=Lr(c,l))}return{c(){t=ct("div");for(let o=0;o<e.length;o+=1)e[o].c();et(t,"class","wa-draft-list")},m(o,l){wt(o,t,l);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);a=!0},p(o,l){if(l[0]&1610620928|l[1]&7){i=$e(o[13]),Yt();for(let c=0;c<e.length;c+=1)e[c].r();e=aa(e,l,s,1,o,i,n,t,bi,Lr,null,xr);for(let c=0;c<e.length;c+=1)e[c].a();qt()}},i(o){if(!a){for(let l=0;l<i.length;l+=1)q(e[l]);a=!0}},o(o){for(let l=0;l<e.length;l+=1)Q(e[l]);a=!1},d(o){o&&mt(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function Eo(r){let t;return{c(){t=ct("div"),t.textContent="No chapters found.",ke(t,"margin-top","1em")},m(e,n){wt(e,t,n)},p:Et,i:Et,o:Et,d(e){e&&mt(t)}}}function Do(r){let t;return{c(){t=ct("div"),t.textContent="Loading chapters..."},m(e,n){wt(e,t,n)},p:Et,i:Et,o:Et,d(e){e&&mt(t)}}}function Po(r){let t,e;return t=new $a({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function jo(r){let t,e;return t=new ka({}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function No(r){let t,e;return t=new Ca({props:{size:xe}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Ao(r){let t,e;return t=new Sa({props:{size:xe}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function To(r){let t,e;return t=new xa({props:{size:xe}}),{c(){ht(t.$$.fragment)},m(n,a){ut(t,n,a),e=!0},p:Et,i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){Q(t.$$.fragment,n),e=!1},d(n){dt(t,n)}}}function Lr(r,t){let e,n,a=t[64].chapterName+"",i,s,o,l,c,f,h,g,u,m,p,b,d,v,y=Et,$;function k(){return t[54](t[66])}l=new _e({props:{title:"Move chapter up",clickHandler:k,disabled:t[66]===0,$$slots:{default:[Po]},$$scope:{ctx:t}}});function N(){return t[55](t[66])}f=new _e({props:{title:"Move chapter down",clickHandler:N,disabled:t[66]===t[13].length-1,$$slots:{default:[jo]},$$scope:{ctx:t}}});function A(){return t[56](t[64])}g=new oe({props:{ariaLabel:"Open chapter",title:void 0,clickHandler:A,$$slots:{default:[No]},$$scope:{ctx:t}}});function R(){return t[57](t[64])}m=new oe({props:{ariaLabel:"Rename chapter",title:void 0,clickHandler:R,$$slots:{default:[Ao]},$$scope:{ctx:t}}});function P(){return t[58](t[64])}return b=new oe({props:{ariaLabel:"Delete chapter",title:void 0,clickHandler:P,$$slots:{default:[To]},$$scope:{ctx:t}}}),{key:r,first:null,c(){e=ct("div"),n=ct("div"),i=Lt(a),s=gt(),o=ct("div"),ht(l.$$.fragment),c=gt(),ht(f.$$.fragment),h=gt(),ht(g.$$.fragment),u=gt(),ht(m.$$.fragment),p=gt(),ht(b.$$.fragment),d=gt(),et(n,"class","wa-draft-name"),et(o,"class","wa-draft-actions"),et(e,"class","wa-draft-item"),this.first=e},m(B,K){wt(B,e,K),nt(e,n),nt(n,i),nt(e,s),nt(e,o),ut(l,o,null),nt(o,c),ut(f,o,null),nt(o,h),ut(g,o,null),nt(o,u),ut(m,o,null),nt(o,p),ut(b,o,null),nt(e,d),$=!0},p(B,K){t=B,(!$||K[0]&8192)&&a!==(a=t[64].chapterName+"")&&Ge(i,a);const E={};K[0]&8192&&(E.clickHandler=k),K[0]&8192&&(E.disabled=t[66]===0),K[2]&256&&(E.$$scope={dirty:K,ctx:t}),l.$set(E);const L={};K[0]&8192&&(L.clickHandler=N),K[0]&8192&&(L.disabled=t[66]===t[13].length-1),K[2]&256&&(L.$$scope={dirty:K,ctx:t}),f.$set(L);const _={};K[0]&8192&&(_.clickHandler=A),K[2]&256&&(_.$$scope={dirty:K,ctx:t}),g.$set(_);const W={};K[0]&8192&&(W.clickHandler=R),K[2]&256&&(W.$$scope={dirty:K,ctx:t}),m.$set(W);const st={};K[0]&8192&&(st.clickHandler=P),K[2]&256&&(st.$$scope={dirty:K,ctx:t}),b.$set(st)},r(){v=e.getBoundingClientRect()},f(){ci(e),y()},a(){y(),y=li(e,v,lo,{duration:500,easing:Ea})},i(B){$||(q(l.$$.fragment,B),q(f.$$.fragment,B),q(g.$$.fragment,B),q(m.$$.fragment,B),q(b.$$.fragment,B),$=!0)},o(B){Q(l.$$.fragment,B),Q(f.$$.fragment,B),Q(g.$$.fragment,B),Q(m.$$.fragment,B),Q(b.$$.fragment,B),$=!1},d(B){B&&mt(e),dt(l),dt(f),dt(g),dt(m),dt(b)}}}function Bo(r){var y;let t,e,n,a,i,s,o,l,c,f,h,g,u,m;s=new oe({props:{ariaLabel:"Refresh projects",clickHandler:r[40],title:void 0,spinning:r[6],$$slots:{default:[co]},$$scope:{ctx:r}}}),c=new _e({props:{title:"Create New Project",clickHandler:r[35],variant:"primary",style:"width: 40%; margin: 0 auto;",$$slots:{default:[fo]},$$scope:{ctx:r}}});let p=r[2].length===0&&Dr(),b=r[2].length>0&&Pr(r),d=r[4]&&jr(r),v=r[4]&&((y=r[0])==null?void 0:y.activeDraft)&&r[18]&&Ir(r);return{c(){t=ct("div"),e=ct("div"),n=ct("div"),n.textContent=`${Ft} Projects`,a=gt(),i=ct("div"),ht(s.$$.fragment),o=gt(),l=ct("div"),ht(c.$$.fragment),f=gt(),p&&p.c(),h=gt(),b&&b.c(),g=gt(),d&&d.c(),u=gt(),v&&v.c(),et(n,"class","wa-title"),et(e,"class","wa-row justify-between"),et(l,"class","wa-row"),ke(l,"margin","18px 0 10px 0"),et(t,"class","project-list wa-panel")},m($,k){wt($,t,k),nt(t,e),nt(e,n),nt(e,a),nt(e,i),ut(s,i,null),nt(t,o),nt(t,l),ut(c,l,null),nt(t,f),p&&p.m(t,null),nt(t,h),b&&b.m(t,null),nt(t,g),d&&d.m(t,null),nt(t,u),v&&v.m(t,null),m=!0},p($,k){var R;const N={};k[0]&64&&(N.spinning=$[6]),k[2]&256&&(N.$$scope={dirty:k,ctx:$}),s.$set(N);const A={};k[2]&256&&(A.$$scope={dirty:k,ctx:$}),c.$set(A),$[2].length===0?p||(p=Dr(),p.c(),p.m(t,h)):p&&(p.d(1),p=null),$[2].length>0?b?(b.p($,k),k[0]&4&&q(b,1)):(b=Pr($),b.c(),q(b,1),b.m(t,g)):b&&(Yt(),Q(b,1,1,()=>{b=null}),qt()),$[4]?d?(d.p($,k),k[0]&16&&q(d,1)):(d=jr($),d.c(),q(d,1),d.m(t,u)):d&&(Yt(),Q(d,1,1,()=>{d=null}),qt()),$[4]&&((R=$[0])!=null&&R.activeDraft)&&$[18]?v?(v.p($,k),k[0]&262161&&q(v,1)):(v=Ir($),v.c(),q(v,1),v.m(t,null)):v&&(Yt(),Q(v,1,1,()=>{v=null}),qt())},i($){m||(q(s.$$.fragment,$),q(c.$$.fragment,$),q(b),q(d),q(v),m=!0)},o($){Q(s.$$.fragment,$),Q(c.$$.fragment,$),Q(b),Q(d),Q(v),m=!1},d($){$&&mt(t),dt(s),dt(c),p&&p.d(),b&&b.d(),d&&d.d(),v&&v.d()}}}let Oo=!1,Ro="";const xe=20;let Io=null;function zo(r,t,e){let{manager:n}=t,{projectService:a}=t,{projectFileService:i}=t,s=null,o=[],l,c=null,f=[],h=!1,g=[],u=!1,m=!1,p="",b=!0,d=null,v=null,y=[],$=!1,k=!1,N="",A="",R=!1,P=!1;Mn(()=>{try{n&&v&&n.removeActiveProjectListener(v)}catch{}});async function B(z=!1){if(!a)return[];e(6,h=!0);const rt=new Promise(xt=>setTimeout(xt,400)),it=[...o],bt=s;let Tt=[],kt=[];try{Tt=a.listAllFolders(),kt=[];for(const xt of Tt)await a.isProjectFolder(xt)&&kt.push(xt)}catch{kt=[]}const ne=kt.filter(xt=>!it.includes(xt)),Ct=it.filter(xt=>!kt.includes(xt));if(z&&ne.length>0&&new D.Notice(`${ne.length} new project${ne.length>1?"s":""} discovered.`),z&&Ct.length>0&&new D.Notice(`${Ct.length} project${Ct.length>1?"s":""} removed.`),e(2,o=kt),e(7,g=kt.map(xt=>({value:xt,label:xt}))),kt.length===0)e(1,s=null),e(3,l=void 0),e(4,c=null),n!=null&&n.setActiveProject&&await n.setActiveProject(null);else if(kt.length===1){e(1,s=kt[0]),e(3,l=g[0]),e(4,c=kt[0]),n!=null&&n.setActiveProject&&await n.setActiveProject(kt[0]);try{F(`${S} panel refresh selected single project '${c}'`)}catch{}}else if(bt&&!kt.includes(bt)){e(1,s=kt[0]),e(3,l=g[0]),e(4,c=kt[0]),n!=null&&n.setActiveProject&&await n.setActiveProject(kt[0]);try{F(`${S} panel refresh selected fallback project '${c}'`)}catch{}}else if(bt){const xt=g.find(Ee=>Ee.value===bt);if(xt){e(1,s=bt),e(3,l=xt),e(4,c=xt.value);try{F(`${S} panel refresh kept project '${c}'`)}catch{}}else e(1,s=null),e(3,l=void 0),e(4,c=null),n!=null&&n.setActiveProject&&await n.setActiveProject(null)}else e(1,s=null),e(3,l=void 0),e(4,c=null);return await rt,e(6,h=!1),c&&await K(),c&&(n!=null&&n.activeDraft)&&await E(),kt}async function K(){if(!i||!c){e(5,f=[]);return}const z=d;e(8,u=!0);const rt=new Promise(it=>setTimeout(it,400));try{e(5,f=i.drafts.listDrafts(c)||[]),e(5,f=Array.from(f)),f.sort((it,bt)=>it>bt?1:it<bt?-1:0),b||f.reverse();try{F(`${S} refreshDrafts: loaded ${f.length} drafts, preserving active draft: ${z}`)}catch{}}catch{e(5,f=[])}finally{await rt,e(8,u=!1)}}async function E(){if(!n||!i)return;e(14,$=!0);const z=new Promise(rt=>setTimeout(rt,400));try{if(!c){e(13,y=[]),e(18,R=!1);return}const rt=`${c}/${Gt(n==null?void 0:n.settings)}`,it=await be(n.app,rt);if(e(18,R=(it==null?void 0:it.project_type)==="multi-file"),!R){e(13,y=[]);return}if(!(n!=null&&n.activeDraft)){e(13,y=[]);return}let bt=[];bt=await i.chapters.listChapters(c,n.activeDraft),e(13,y=Array.isArray(bt)?bt:[])}catch{e(13,y=[]),e(18,R=!1)}finally{await z,e(14,$=!1)}}async function L(){if(!n||!c||!p.trim())return;const z=p.trim();try{await n.createNewDraft(z,Ro||void 0,c),e(12,d=n.activeDraft),new D.Notice(`Draft "${z}" created.`)}catch(rt){F(`${S} Failed to create draft:`,rt),new D.Notice("Failed to create draft.")}e(10,p=""),e(9,m=!1),await K()}async function _(){e(9,m=!0)}async function W(z){if(!i||!n||!c)return;let rt=!1;rt=await i.drafts.openDraft(c,z),rt||n!=null&&n.setActiveDraft&&await n.setActiveDraft(z,c),await K(),await E()}async function st(z){if(!n||!c)return;const rt=`${z} Copy`;new io(n.app,{sourceDraftName:z,suggestedName:rt,onSubmit:async it=>{if(n)try{await n.createNewDraft(it,z,c||void 0),await K(),new D.Notice(`Draft '${it}' created as duplicate of '${z}'.`)}catch(bt){F(`${S} Failed to duplicate draft:`,bt),new D.Notice("Failed to duplicate draft.")}}}).open()}async function V(z){if(!n||!c)return;new oo(n.app,z,async(it,bt)=>{try{F(`${S} renameDraft: user entered: ${it}, renameFile: ${bt}`),await n.renameDraft(z,it,c||void 0,bt),F(`${S} renameDraft: rename successful, refreshing drafts`),await K(),new D.Notice(`Draft '${z}' renamed to '${it}'.`)}catch(Tt){F(`${S} renameDraft: error:`,Tt),new D.Notice("Failed to rename draft.")}}).open()}async function ot(z){if(!n||!c)return;new Fr(n.app,z,async()=>{n&&(await n.deleteDraft(z,c||void 0),await K())},"draft").open()}async function G(z){z&&(n!=null&&n.setActiveProject&&await n.setActiveProject(z),e(1,s=z),e(4,c=z),e(12,d=(n==null?void 0:n.activeDraft)??null),await K(),await E())}async function ft(z){if(z===0||!n||!c||!n.activeDraft)return;const rt=y.slice();[rt[z-1],rt[z]]=[rt[z],rt[z-1]];const it=rt.map((bt,Tt)=>({chapterName:bt.chapterName||"",order:Tt+1}));await n.reorderChapters(c,n.activeDraft,it),await E()}async function I(z){if(z===y.length-1||!n||!c||!n.activeDraft)return;const rt=y.slice();[rt[z],rt[z+1]]=[rt[z+1],rt[z]];const it=rt.map((bt,Tt)=>({chapterName:bt.chapterName||"",order:Tt+1}));await n.reorderChapters(c,n.activeDraft,it),await E()}async function O(z){!c||!(n!=null&&n.activeDraft)||await n.openChapter(c,n.activeDraft,z)}function lt(z){if(!c||!(n!=null&&n.activeDraft))return;new so(n.app,z,async it=>{!(n!=null&&n.activeDraft)||!c||(await n.renameChapter(c,n.activeDraft,z,it),await E())}).open()}function U(z){new Fr(n.app,z,async()=>{!(n!=null&&n.activeDraft)||!c||(await n.deleteChapter(c,n.activeDraft,z),await E())},"chapter").open()}async function X(z){c&&(n!=null&&n.setActiveDraft&&await n.setActiveDraft(z,c),e(12,d=(n==null?void 0:n.activeDraft)??null),await K(),await E())}async function $t(){if(!n||!a)return;const z=n.app,{CreateProjectModal:rt}=await Promise.resolve().then(()=>il);let it=null;new rt(z,async(Tt,kt,ne)=>{if(!Tt||!n||!a)return;const Ct=n.listAllFolders();if((await ye(Ct,ge=>n.projectService.isProjectFolder(ge))).map(ge=>ge.split("/").pop()||ge).includes(Tt)){new D.Notice(`A project with the name "${Tt}" already exists. Please choose a different name.`);return}if(it=await a.createProject(Tt,kt,ne,void 0,n.settings),!it)return;let re=[],Ht=null;for(let ge=0;ge<20;ge++){await new Promise(qe=>setTimeout(qe,100)),re=await B();const on=re.find(qe=>qe===it);if(Ht=typeof on=="string"?on:null,Ht)break}typeof Ht=="string"&&Ht&&(e(1,s=Ht),e(3,l={value:Ht,label:Ht}),e(4,c=Ht),n.setActiveDraft&&await n.setActiveDraft(ne??"Draft 1",Ht),await K(),await E(),n.openProject&&await n.openProject(Ht))}).open()}Mn(()=>{It(()=>{n&&n.removeActiveDraftListener}),It(()=>{n&&typeof n.removeActiveProjectListener=="function"&&v&&n.removeActiveProjectListener(v)})});const jt=()=>B(!0),vt=z=>{const rt=z.detail;e(3,l=rt),e(4,c=typeof rt=="string"?rt:rt?rt.value:void 0),e(1,s=c??null),G(c??null)},yt=()=>{e(11,b=!b),K()};function Nt(){p=this.value,e(10,p)}const Dt=()=>{e(9,m=!1),e(10,p="")},ee=z=>W(z),Wt=z=>X(z),w=z=>V(z),H=z=>st(z),M=z=>ot(z),x=()=>e(15,k=!k);function C(){N=this.value,e(16,N)}const j=async()=>{!c||!(n!=null&&n.activeDraft)||!N.trim()||(await n.createChapter(c,n.activeDraft,N.trim()),e(16,N=""),e(17,A=""),e(15,k=!1),await E())},Z=()=>{e(15,k=!1),e(16,N=""),e(17,A="")},Y=z=>ft(z),T=z=>I(z),J=z=>O(z.name),at=z=>lt(z.chapterName||""),tt=z=>U(z.chapterName||"");return r.$$set=z=>{"manager"in z&&e(0,n=z.manager),"projectService"in z&&e(36,a=z.projectService),"projectFileService"in z&&e(37,i=z.projectFileService)},r.$$.update=()=>{if(r.$$.dirty[0]&1|r.$$.dirty[1]&480&&n&&a&&i&&!P){e(39,P=!0),F(`${S} ProjectPanel initializing with manager`),e(12,d=n.activeDraft??null),e(1,s=n.activeProject??null);const z=rt=>{e(12,d=rt),F(`${S} active draft updated -> ${rt}`),E()};n.addActiveDraftListener(z),e(38,v=rt=>{e(1,s=rt),F(`${S} active project updated -> ${rt}`),rt?B():(e(3,l=void 0),e(4,c=null),e(5,f=[]),e(13,y=[]),e(18,R=!1))}),n.addActiveProjectListener(v),B()}},[n,s,o,l,c,f,h,g,u,m,p,b,d,y,$,k,N,A,R,B,K,E,L,_,W,st,V,ot,G,ft,I,O,lt,U,X,$t,a,i,v,P,jt,vt,yt,Nt,Dt,ee,Wt,w,H,M,x,C,j,Z,Y,T,J,at,tt]}class Lo extends Ut{constructor(t){super(),Mt(this,t,zo,Bo,Rt,{manager:0,projectService:36,projectFileService:37},null,[-1,-1,-1])}}const we="writeaid-project-panel";class Mo extends D.ItemView{constructor(t,e,n){super(t),this.panelEl=null,this.selectedProject=null,this.app=e,this.manager=n,this.projectService=new mn(e),this.projectFileService=new qn(e,this.projectService)}getViewType(){return we}getDisplayText(){return`${Ft} Projects`}getIcon(){return Zn}async onOpen(){this.panelEl=this.contentEl.createEl("div",{cls:"writeaid-project-panel"});try{if(!this.manager){F(`${S} Manager not available in ProjectPanelView.onOpen`),new D.Notice(`${Ft}: manager not available, cannot mount project panel.`);return}F(`${S} Mounting ProjectPanel with manager:`,!!this.manager),this.projectPanel=new Lo({target:this.panelEl,props:{manager:this.manager,projectService:this.projectService,projectFileService:this.projectFileService}}),F(`${S} ProjectPanel mounted successfully`)}catch(t){F(`${S} failed to mount project panel:`,t),new D.Notice(`${Ft}: failed to mount project panel. Check console for details.`)}}async onClose(){if(this.projectPanel){try{this.projectPanel.$destroy()}catch(t){F(`${S} Error destroying project panel:`,t)}this.projectPanel=void 0}}refreshDraftsSection(){this.projectPanel&&typeof this.projectPanel.refreshDrafts=="function"&&(F(`${S} Refreshing drafts section in project panel`),this.projectPanel.refreshDrafts())}}function Uo(r){return async()=>{F(`${S} List backups command called`);let t;const e=r.app.workspace.getLeavesOfType(we);if(e.length>0){const a=e[0].view;t=()=>{a.refreshDraftsSection()}}new La(r.app,r,t).open()}}function Wo(r){return()=>(F(`${S} Create new draft command called`),r.createNewDraftPrompt())}async function Ho(r){F(`${S} createOutlineCommand called`);try{const t=r.activeProject,e=r.activeDraft;if(!t||!e){new D.Notice("No active project or draft selected. Please select a project and draft first.");return}const n=r.projectFileService.drafts.getOutlineFile(t,e);if(n){new D.Notice(`Outline file already exists: ${n.path}`);return}await r.projectFileService.drafts.createOutline(t,e,r.settings.outlineTemplate),new D.Notice(`Outline created for draft: ${e}`),F(`${S} Outline created successfully for draft: ${e}`)}catch(t){F(`${S} Error creating outline:`,t),new D.Notice(`Failed to create outline: ${t.message}`)}}function Vo(r){return async()=>{var i;const t=r.projectFileService.drafts,e=r.activeProject,n=r.activeDraft;if(F(`${S} Generate manuscript command called`),F(`${S} Active project: ${e}, active draft: ${n}`),F(`${S} Manager settings manuscript template: ${(i=r.settings)==null?void 0:i.manuscriptNameTemplate}`),!Ze(e,n))return;await t.generateManuscript(e,n,r.settings)?new D.Notice("Manuscript generated successfully."):new D.Notice("Failed to generate manuscript.")}}function Mr(r){const t={},e=r.match(Ot);if(e){const n=e[1],a=n.match(/^id:\s*(.+?)$/m),i=n.match(/^draft:\s*(.+?)$/m),s=n.match(/^project:\s*(.+?)$/m),o=n.match(/^created:\s*(.+?)$/m);a&&(t.id=a[1].trim()),i&&(t.draft=i[1].trim()),s&&(t.project=s[1].trim()),o&&(t.created=o[1].trim())}return t}function Ur(r){return!!(r.id&&r.draft&&r.project&&r.created)}function Nn(r,t,e){return{id:r.id||Ne(),draft:r.draft||t,project:r.project||e,created:r.created||new Date().toISOString()}}function An(r,t){const e=r.match(Ot);if(e){const n=e[1],a=r.substring(e[0].length),i=n.split(`
`),s=[],o=new Set;for(const c of i)c.match(/^id:/i)?(s.push(`id: ${t.id}`),o.add("id")):c.match(/^draft:/i)?(s.push(`draft: ${t.draft}`),o.add("draft")):c.match(/^project:/i)?(s.push(`project: ${t.project}`),o.add("project")):c.match(/^created:/i)?(s.push(`created: ${t.created}`),o.add("created")):s.push(c);o.has("id")||s.push(`id: ${t.id}`),o.has("draft")||s.push(`draft: ${t.draft}`),o.has("project")||s.push(`project: ${t.project}`),o.has("created")||s.push(`created: ${t.created}`);const l=s.join(`
`);return`${St}
${l}
${St}${a}`}else return`${St}
id: ${t.id}
draft: ${t.draft}
project: ${t.project}
created: ${t.created}
${St}

`+r}class Zo extends D.SuggestModal{constructor(t,e,n){super(t),this.onSelect=n,this.files=[],this.files=e,this.setPlaceholder("Select a file to initialize as draft file..."),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"esc",purpose:"to cancel"}]),this.setTitle("Select File for Draft Metadata")}getSuggestions(){return this.files}renderSuggestion(t,e){e.createEl("div",{text:t.name})}async onChooseSuggestion(t){await this.onSelect(t)}}function Go(r){return async()=>{const t=r.activeProject,e=r.activeDraft;F(`${S} Initialize draft file command called`),F(`${S} Active project: ${t}, active draft: ${e}`);try{if(!Ze(t,e)){F(`${S} Initialize draft file: active project/draft check failed`);return}if(!t||!e){F(`${S} Initialize draft file: no active project or draft`),new D.Notice("Active project or draft not found.");return}const n=At(r.settings),a=r.app.vault.getAbstractFileByPath(t);let i=n;if(a&&a instanceof D.TFolder){for(const g of a.children)if(g instanceof D.TFolder&&g.name.toLowerCase()===n.toLowerCase()){i=g.name;break}}const s=`${t}/${i}/${e}`,o=t.split("/").pop()||t;F(`${S} Initialize draft file: using drafts folder: ${i}`);const l=r.app.vault.getAbstractFileByPath(s);if(!l||!(l instanceof D.TFolder)){F(`${S} Initialize draft file: draft folder not found at ${s}`),new D.Notice("Draft folder not found.");return}const c=l.children.filter(g=>g instanceof D.TFile&&g.extension==="md").filter(g=>!g.path.includes("/Chapters/")&&g.name!=="outline.md");if(F(`${S} Found ${c.length} markdown files in draft folder`),c.length===0){F(`${S} No files found, creating new draft file`);const g=Nn({},e,o),u=An("",g),m=`${e}${pt}`;await r.app.vault.create(`${s}/${m}`,u),new D.Notice(`Draft file created with metadata for "${e}".`);return}if(c.length===1){const g=c[0],u=await r.app.vault.read(g),m=Mr(u);if(Ur(m)){F(`${S} Initialize draft file: file already has complete metadata`),new D.Notice(`"${g.name}" already has complete draft metadata.`);return}F(`${S} Adding missing metadata to ${g.name}`);const p=Nn(m,e,o),b=An(u,p);await r.app.vault.modify(g,b),F(`${S} Initialize draft file: successfully updated ${g.name}`),new D.Notice(`Draft metadata added to "${g.name}".`);return}F(`${S} Multiple files found, showing selection modal`);const f=c.map(g=>({path:g.path,name:g.name,file:g}));new Zo(r.app,f,async g=>{const u=g.file,m=await r.app.vault.read(u),p=Mr(m);if(Ur(p)){F(`${S} Initialize draft file: selected file already has complete metadata`),new D.Notice(`"${u.name}" already has complete draft metadata.`);return}F(`${S} Adding missing metadata to ${u.name}`);const b=Nn(p,e,o),d=An(m,b);await r.app.vault.modify(u,d),F(`${S} Initialize draft file: successfully updated ${u.name} from modal`),new D.Notice(`Draft metadata added to "${u.name}".`)}).open()}catch(n){F(`${S} Initialize draft file command error:`,n),new D.Notice("Failed to initialize draft file metadata.")}}}function Yo(r){return()=>(F(`${S} Switch draft command called`),r.switchDraftPrompt())}function qo(r){return async()=>{F(`${S} Navigate to next chapter command called`);const t=r.app.workspace.getActiveFile();if(!t){F(`${S} navigateToNextChapter: no active file`),new D.Notice("No file is currently open.");return}const e=t.path,n=At(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${pt}$`));if(!a){F(`${S} navigateToNextChapter: file is not a chapter`),new D.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{F(`${S} navigateToNextChapter: looking for next chapter after ${o}`);const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(h=>h.name===o);if(c===-1){new D.Notice("Unable to find the current chapter in the draft.");return}if(c>=l.length-1)return;const f=l[c+1];await r.openChapter(i,s,f.name)}catch(l){F(`${S} Failed to navigate to next chapter:`,l),new D.Notice("Failed to navigate to next chapter.")}}}function Ko(r){return async()=>{F(`${S} Navigate to previous chapter command called`);const t=r.app.workspace.getActiveFile();if(!t){F(`${S} navigateToPreviousChapter: no active file`),new D.Notice("No file is currently open.");return}const e=t.path,n=At(r.settings),a=e.match(new RegExp(`^(.+)/${n}/(.+)/(.+)\\${pt}$`));if(!a){F(`${S} navigateToPreviousChapter: file is not a chapter`),new D.Notice("The current file is not a chapter.");return}const i=a[1],s=a[2],o=a[3];try{F(`${S} navigateToPreviousChapter: looking for previous chapter before ${o}`);const l=await r.projectFileService.chapters.listChapters(i,s),c=l.findIndex(h=>h.name===o);if(c===-1){F(`${S} navigateToPreviousChapter: current chapter not found`),new D.Notice("Unable to find the current chapter in the draft.");return}if(c<=0){F(`${S} navigateToPreviousChapter: already at first chapter`);return}const f=l[c-1];await r.openChapter(i,s,f.name)}catch(l){F(`${S} Failed to navigate to previous chapter:`,l),new D.Notice("Failed to navigate to previous chapter.")}}}async function Xo(r,t,e){const n=`${t}/${Gt(e)}`,a=await be(r,n);if(!a||a.project_type!==Bt.SINGLE)return new D.Notice(`Project is not a ${Bt.SINGLE} project.`),!1;a.project_type=Bt.MULTI,await Yn(r,n,a);const i=At(e),s=r.vault.getAbstractFileByPath(`${t}/${i}`);if(!s||!(s instanceof D.TFolder))return new D.Notice("Drafts folder not found."),!1;let o=!1;for(const l of s.children)if(l instanceof D.TFolder){const c=Vt(l.name),f=l.children.find(h=>h instanceof D.TFile&&h.name===`${c}${pt}`);if(f){const h=`${l.path}/Chapter 1${pt}`;if(f.path!==h){const g=await r.vault.read(f);await r.vault.create(h,g),await r.vault.delete(f),o=!0}}}return o?new D.Notice(`Converted to multi-file project. Draft files renamed to "Chapter 1${pt}".`):new D.Notice("Converted to multi-file project. No draft files needed renaming."),!0}async function Jo(r,t,e){if(!t){new D.Notice("No active project selected.");return}await Xo(r,t,e)}function Qo(r){return()=>(F(`${S} Create new project command called`),r.createNewProjectPrompt())}function tl(r){return()=>(F(`${S} Select active project command called`),r.selectActiveProjectPrompt())}function el(r,t){return()=>{F(`${S} Toggle project panel command called`);const e={type:we,active:!0},n=t.workspace.getLeavesOfType(we);if(n.length>0){F(`${S} Revealing existing project panel`);const a=n[0];t.workspace.revealLeaf(a)}else{F(`${S} Creating new project panel`);let a=t.workspace.getRightLeaf(!1);a||(a=t.workspace.getRightLeaf(!0)),a.setViewState(e),t.workspace.revealLeaf(a)}}}function nl(r){return()=>(F(`${S} Update project metadata command called`),r.updateProjectMetadataPrompt())}class rl extends D.Modal{constructor(t,e,n,a){super(t),this.path=e,this.onCreateAnyway=n,this.onOpenExisting=a}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Project already exists"}),t.createEl("p",{text:`A folder named '${this.path}' already exists in the vault.`}),new D.Setting(t).addButton(e=>e.setButtonText("Open Existing").onClick(()=>{F(`${S} ConfirmExistingProjectModal: opening existing project "${this.path}"`),this.close(),this.onOpenExisting()})),new D.Setting(t).addButton(e=>e.setButtonText("Create Anyway").setCta().onClick(()=>{F(`${S} ConfirmExistingProjectModal: creating new project anyway "${this.path}"`),this.close(),this.onCreateAnyway(!0)})),new D.Setting(t).addButton(e=>e.setButtonText("Cancel").onClick(()=>{F(`${S} ConfirmExistingProjectModal: cancelled for project "${this.path}"`),this.close()}))}onClose(){this.contentEl.empty()}}class al extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Draft"});const e=this.props.suggestedName;let n="",a="";new D.Setting(t).setName("Draft name").addText(s=>s.setPlaceholder(e).onChange(o=>n=o));const i=this.props.drafts;i.length>0&&new D.Setting(t).setName("Copy from existing draft").addDropdown(s=>{s.addOption("","Start blank");for(const o of i)s.addOption(o,o);s.onChange(o=>a=o)}),new D.Setting(t).addButton(s=>s.setButtonText("Create").setCta().onClick(()=>{const o=n&&n.trim()?n.trim():e;F(`${S} CreateDraftModal: creating draft "${o}", copyFrom: "${a||"none"}"`),this.close(),this.props.onSubmit(o,a||void 0)}))}onClose(){this.contentEl.empty()}}class Da extends D.Modal{constructor(t,e){super(t),this.onSubmit=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Create New Project"});let e="",n=!0,a="Draft 1";new D.Setting(t).setName("Project folder name").addText(i=>i.onChange(s=>e=s)),new D.Setting(t).setName("Project type").addDropdown(i=>{i.addOption("single","Single-file project"),i.addOption("multi","Multi-file project (chapters)"),i.onChange(s=>n=s==="single")}),new D.Setting(t).setName("Initial draft name (optional)").addText(i=>i.setPlaceholder("Draft 1").onChange(s=>a=s||"Draft 1")),new D.Setting(t).addButton(i=>i.setButtonText("Create Project").setCta().onClick(()=>{F(`${S} CreateProjectModal: creating project "${e}", singleFile: ${n}, initialDraftName: ${a}`),this.close(),this.onSubmit(e,n,a||void 0)}))}onClose(){this.contentEl.empty()}}const il=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectModal:Da},Symbol.toStringTag,{value:"Module"}));class Tn extends D.Modal{constructor(t,e){super(t),this.props=e}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Select Project for Draft"});let e="";const n=this.props.folders||[];new D.Setting(t).setName("Project folder").addDropdown(a=>{a.addOption("","(Vault root)");for(const i of n)a.addOption(i,i||"(Vault root)");a.onChange(i=>e=i)}),new D.Setting(t).addButton(a=>a.setButtonText("Select").setCta().onClick(()=>{F(`${S} SelectProjectModal: selected project "${e||"(Vault root)"}"`),this.close(),this.props.onSubmit(e||"")}))}onClose(){this.contentEl.empty()}}class sl extends D.Modal{constructor(t,e,n){super(t),this.drafts=e,this.onSubmit=n}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Switch Active Draft"});for(const e of this.drafts)new D.Setting(t).setName(e).addButton(n=>n.setButtonText("Select").onClick(()=>{F(`${S} SwitchDraftModal: selected draft "${e}"`),this.close(),this.onSubmit(e)}))}onClose(){this.contentEl.empty()}}class ol{constructor(t,e,n){var a;this.activeDraft=null,this.activeProject=null,this.activeProjectListeners=[],this.activeDraftListeners=[],this.panelRefreshListeners=[],this._panelRefreshTimer=null,this._panelRefreshDebounceMs=250,this.app=t,this.plugin=e,this.settings=e==null?void 0:e.settings,typeof n=="number"&&Number.isFinite(n)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(n))),this.activeProject=((a=this.settings)==null?void 0:a.activeProject)||null,this.projectService=new mn(t),this.projectFileService=new qn(t,this.projectService,this.settings)}async reorderChapters(t,e,n){return await this.projectFileService.chapters.reorderChapters(t,e,n)}async listChapters(t,e){return await this.projectFileService.chapters.listChapters(t,e)}async createChapter(t,e,n){const a=At(this.settings),i=`${t}/${a}/${e}`,s=await this.projectFileService.drafts.getDraftId(i);return await this.projectFileService.chapters.createChapter(t,e,n,this.settings,s||void 0)}async deleteChapter(t,e,n){return await this.projectFileService.chapters.deleteChapter(t,e,n)}async renameChapter(t,e,n,a){return await this.projectFileService.chapters.renameChapter(t,e,n,a)}async openChapter(t,e,n){return await this.projectFileService.chapters.openChapter(t,e,n)}get panelRefreshDebounceMs(){return this._panelRefreshDebounceMs}set panelRefreshDebounceMs(t){typeof t=="number"&&Number.isFinite(t)&&(this._panelRefreshDebounceMs=Math.max(0,Math.floor(t)))}addActiveProjectListener(t){this.activeProjectListeners.push(t)}addActiveDraftListener(t){this.activeDraftListeners.push(t)}removeActiveDraftListener(t){this.activeDraftListeners=this.activeDraftListeners.filter(e=>e!==t)}notifyActiveDraftListeners(t){for(const e of this.activeDraftListeners)It(()=>e(t))}addPanelRefreshListener(t){this.panelRefreshListeners.push(t)}removePanelRefreshListener(t){this.panelRefreshListeners=this.panelRefreshListeners.filter(e=>e!==t)}notifyPanelRefresh(){try{this._panelRefreshTimer&&clearTimeout(this._panelRefreshTimer),this._panelRefreshTimer=setTimeout(()=>{for(const t of this.panelRefreshListeners)It(()=>t());this._panelRefreshTimer=null},this._panelRefreshDebounceMs)}catch{for(const t of this.panelRefreshListeners)It(()=>t())}}removeActiveProjectListener(t){this.activeProjectListeners=this.activeProjectListeners.filter(e=>e!==t)}async setActiveProject(t){t&&(t=t.trim().replace(/^\/+/,"").replace(/\/+$/,"")),F(`${S} setActiveProject called with '${t}'`),this.activeProject=t,await zt(async()=>{if(this.plugin){const e=this.plugin;e.settings||(e.settings={}),e.settings.activeProject=t??void 0,typeof e.saveSettings=="function"&&await e.saveSettings()}});for(const e of this.activeProjectListeners)It(()=>e(t))}async createNewProjectPrompt(){new Da(this.app,async(t,e,n,a)=>{if(!t){new D.Notice("Project name is required.");return}const i=this.listAllFolders();if((await ye(i,f=>this.projectService.isProjectFolder(f))).map(f=>f.split("/").pop()||f).includes(t)){new D.Notice(`A project with the name "${t}" already exists. Please choose a different name.`);return}const l=a&&a!==""?`${a}/${t}`:t;this.app.vault.getAbstractFileByPath(l)?new rl(this.app,l,async f=>{f&&(await this.createNewProject(t,e,n,a),await this.openProject(l))},async()=>{await this.openProject(l)}).open():(await this.createNewProject(t,e,n,a),await this.openProject(l))}).open()}async openProject(t){return await this.projectService.openProject(t)}async createNewProject(t,e,n,a){const i=await this.projectService.createProject(t,e,n,a,this.settings);if(i){await this.setActiveProject(i);const s=n||"Draft 1";await this.setActiveDraft(s,i),It(()=>this.notifyPanelRefresh())}return i}listAllFolders(){return this.projectService.listAllFolders()}async createNewDraftPrompt(){const t=this.listAllFolders(),e=await ye(t,n=>this.projectService.isProjectFolder(n));new Tn(this.app,{folders:e,onSubmit:async n=>{const a=await this.suggestNextDraftName(n);new al(this.app,{suggestedName:a,drafts:this.listDrafts(n),projectPath:n,onSubmit:async(i,s)=>{await this.createNewDraft(i,s,n),new D.Notice(`Draft "${i}" created in ${n}.`)}}).open()}}).open()}async switchDraftPrompt(){const t=this.listDrafts();if(t.length===0){new D.Notice("No drafts found in the current project.");return}new sl(this.app,t,async e=>{await this.setActiveDraft(e)&&new D.Notice(`Switched to draft: ${e}`)}).open()}async updateProjectMetadataPrompt(){if(this.activeProject){await ze(this.app,this.activeProject,void 0,void 0,this.settings),new D.Notice(`Metadata updated for ${this.activeProject}`);return}(async()=>{const t=this.listAllFolders(),e=await ye(t,n=>this.projectService.isProjectFolder(n));new Tn(this.app,{folders:e,onSubmit:async n=>{await ze(this.app,n,void 0,void 0,this.settings),new D.Notice(`Metadata updated for ${n}`)}}).open()})()}async selectActiveProjectPrompt(){const t=this.listAllFolders(),e=await ye(t,n=>this.projectService.isProjectFolder(n));if(e.length===0){new D.Notice(`No ${Ft} projects found in the vault.`);return}new Tn(this.app,{folders:e,onSubmit:async n=>{await this.setActiveProject(n),new D.Notice(`Active project set to ${n}`)}}).open()}async createNewDraft(t,e,n){const a=n||this.activeProject||this.getCurrentProjectPath();if(!a){new D.Notice("No project folder detected. Please open a folder named after your project.");return}if(this.listDrafts(a).includes(t)){new D.Notice(`Draft with name "${t}" already exists. Please choose a different name.`);return}if(await this.projectFileService.drafts.createDraft(t,e,a,this.settings),It(()=>this.notifyPanelRefresh()),a&&t)try{await this.setActiveDraft(t,a,!1)}catch{}}listDrafts(t){return this.projectFileService.drafts.listDrafts(t)}async setActiveDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();return a?(this.activeDraft=t,await zt(async()=>{F(`${S} Calculating word count for draft: ${t}`);const i=await this.projectFileService.drafts.calculateDraftWordCount(a,t);F(`${S} Word count calculated: ${i}`),await ze(this.app,a,t,{current_draft_word_count:i},this.settings)}),this.notifyActiveDraftListeners(this.activeDraft),n&&new D.Notice(`Active draft set to ${t}`),!0):(n&&new D.Notice("No project selected to set active draft on."),!1)}async renameDraft(t,e,n,a=!1){const i=n||this.activeProject||this.getCurrentProjectPath();if(!i)return new D.Notice("No project selected to rename draft."),!1;const s=this.activeDraft===t;return await this.projectFileService.drafts.renameDraft(i,t,e,a,this.settings)?(s&&(this.activeDraft=e),new D.Notice(`Renamed draft ${t} → ${e}`),!0):(new D.Notice("Failed to rename draft."),!1)}async deleteDraft(t,e,n=!0){const a=e||this.activeProject||this.getCurrentProjectPath();if(!a)return new D.Notice("No project selected to delete draft."),!1;if(await this.projectFileService.drafts.deleteDraft(a,t,n)){new D.Notice(`Deleted draft ${t}`);const s=this.listDrafts(a);if(s.length>0){if(this.activeDraft===t||!this.activeDraft){let o;if(s.length===1)o=s[0];else{const l=[...s].sort((c,f)=>c.localeCompare(f));if(this.activeDraft===t){const c=l.findIndex(f=>f===t);if(c!==-1){const f=c<l.length-1?c:0;o=l[f]}else o=l[0]}else o=this.activeDraft}await this.setActiveDraft(o,a,!1)}}else this.activeDraft=null,this.notifyActiveDraftListeners(null);return!0}return new D.Notice("Failed to delete draft."),!1}async suggestNextDraftName(t){return await this.projectFileService.drafts.suggestNextDraftName(t)}getCurrentProjectPath(){const t=this.app.workspace.getActiveFile();if(!t)return null;const e=t.parent;return e?e.path:null}}class ll extends D.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,F(`${S} Settings tab created`),typeof e.registerSettingsChangedCallback=="function"&&e.registerSettingsChangedCallback(()=>{F(`${S} Settings changed externally, refreshing UI`),this.containerEl&&this.containerEl.parentElement&&this.display()})}display(){const{containerEl:t}=this;t.empty(),t.createEl("h2",{text:`${Ft} Settings`}),F(`${S} Displaying settings UI`);const e=this.plugin;t.createEl("h3",{text:"Templates"}),new D.Setting(t).setName("Include outline file on draft creation").setDesc("If enabled, each new draft will include an outline file using the outline template.").addToggle(o=>o.setValue(!!e.settings.includeDraftOutline).onChange(l=>{F(`${S} Include draft outline changed: ${l}`),e.settings.includeDraftOutline=l,e.saveSettings()})),new D.Setting(t).setName("Outline template").setDesc("Template for outline files. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for outline template`),new Bn(this.app,l=>{F(`${S} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Outline template").setDesc("Template for outline documents. Use {{draftName}}").addTextArea(o=>{o.setValue(e.settings.outlineTemplate||""),o.inputEl.setAttribute("data-setting","outline")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for outline template`),new Bn(this.app,l=>{F(`${S} Outline template selected: ${l}`),e.settings.outlineTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Chapter template").setDesc("Template for newly created chapter files. Use {{chapterTitle}}").addTextArea(o=>{o.setValue(e.settings.chapterTemplate||""),o.inputEl.setAttribute("data-setting","chapter")}).addButton(o=>o.setButtonText("Pick file...").onClick(()=>{F(`${S} Opening file picker for chapter template`),new Bn(this.app,l=>{F(`${S} Chapter template selected: ${l}`),e.settings.chapterTemplate=l,this.display()}).open()})),new D.Setting(t).setName("Manuscript name template").setDesc("Template for manuscript filenames. Use {{draftName}}, {{projectName}}, and moment.js date qualifiers like {{YYYY-MM-DD}}").addText(o=>{o.setValue(e.settings.manuscriptNameTemplate||"{{draftName}}"),o.inputEl.setAttribute("data-setting","manuscript")}),new D.Setting(t).addButton(o=>o.setButtonText("Save Templates").setCta().onClick(async()=>{var h,g;F(`${S} Save Templates button clicked`);const l=t.querySelector('textarea[data-setting="outline"]'),c=t.querySelector('textarea[data-setting="chapter"]'),f=t.querySelector('input[data-setting="manuscript"]');F(`${S} Found inputs - outline: ${!!l}, chapter: ${!!c}, manuscript: ${!!f}`),F(`${S} Manuscript input value: "${f==null?void 0:f.value}"`),l&&(e.settings.outlineTemplate=l.value),c&&(e.settings.chapterTemplate=c.value),f&&(e.settings.manuscriptNameTemplate=f.value),F(`${S} Saving templates: outline=${(h=e.settings.outlineTemplate)==null?void 0:h.substring(0,50)}..., chapter=${(g=e.settings.chapterTemplate)==null?void 0:g.substring(0,50)}..., manuscript=${e.settings.manuscriptNameTemplate}`),await e.saveSettings(),new D.Notice("Templates saved successfully!")})),t.createEl("h3",{text:"Filenames"}),new D.Setting(t).setName("Draft filename slug style").setDesc("How per-draft main filenames are generated").addDropdown(o=>{o.addOption("compact","compact (draft1)"),o.addOption("kebab","kebab (draft-1)"),o.setValue(e.settings.slugStyle||"compact"),o.onChange(l=>{F(`${S} Slug style changed: ${l}`),e.settings.slugStyle=l,e.saveSettings();const c=t.querySelector(".wat-slug-preview");c&&(c.textContent=`Example: Draft 1 → ${Vt("Draft 1",l)}${pt}`)})});let n="Draft 1";new D.Setting(t).setName("Sample draft name").setDesc("Type a sample draft name to preview the generated filename").addText(o=>o.setPlaceholder("Draft 1").setValue(n).onChange(l=>{n=l||"Draft 1";const c=t.querySelector(".wat-slug-preview");if(c){const f=Vt(n,e.settings.slugStyle);c.textContent=`Example: ${n} → ${f}${pt}`}}));const a=t.createDiv({cls:"wat-slug-preview"}),i=Vt(n,e.settings.slugStyle);a.setText(`Example: ${n} → ${i}${pt}`),t.createEl("h3",{text:"Folders & Files"}),new D.Setting(t).setName("Drafts folder name").setDesc("Name of the folder containing draft subfolders (default: drafts)").addText(o=>o.setValue(e.settings.draftsFolderName||"drafts").onChange(l=>{F(`${S} Drafts folder name changed: ${l}`),e.settings.draftsFolderName=l||"drafts",e.saveSettings()})),new D.Setting(t).setName("Manuscripts folder name").setDesc("Name of the folder containing generated manuscripts (default: manuscripts)").addText(o=>o.setValue(e.settings.manuscriptsFolderName||"manuscripts").onChange(l=>{F(`${S} Manuscripts folder name changed: ${l}`),e.settings.manuscriptsFolderName=l||"manuscripts",e.saveSettings()})),new D.Setting(t).setName("Backups folder name").setDesc("Name of the folder containing draft backups (default: .writeaid-backups)").addText(o=>o.setValue(e.settings.backupsFolderName||".writeaid-backups").onChange(l=>{F(`${S} Backups folder name changed: ${l}`),e.settings.backupsFolderName=l||".writeaid-backups",e.saveSettings()})),new D.Setting(t).setName("Meta file name").setDesc(`Name of the project metadata file (default: ${se.META})`).addText(o=>o.setValue(e.settings.metaFileName||se.META).onChange(l=>{F(`${S} Meta file name changed: ${l}`),e.settings.metaFileName=l||se.META,e.saveSettings()})),new D.Setting(t).setName("Outline file name").setDesc(`Name of the draft outline file (default: ${se.OUTLINE})`).addText(o=>o.setValue(e.settings.outlineFileName||se.OUTLINE).onChange(l=>{F(`${S} Outline file name changed: ${l}`),e.settings.outlineFileName=l||se.OUTLINE,e.saveSettings()})),t.createEl("h3",{text:"Word Count Targets"}),new D.Setting(t).setName("Default target word count for multi-file projects").setDesc("Target word count automatically set for new multi-file projects (chapters)").addText(o=>o.setValue(String(e.settings.defaultMultiTargetWordCount??5e4)).setPlaceholder("50000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(F(`${S} Default multi-file target word count changed: ${c}`),e.settings.defaultMultiTargetWordCount=c,e.saveSettings())})),new D.Setting(t).setName(`Default target word count for ${Bt.SINGLE} projects`).setDesc(`Target word count automatically set for new ${Bt.SINGLE} projects`).addText(o=>o.setValue(String(e.settings.defaultSingleTargetWordCount??2e4)).setPlaceholder("20000").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>0&&(F(`${S} Default ${Bt.SINGLE} target word count changed: ${c}`),e.settings.defaultSingleTargetWordCount=c,e.saveSettings())})),t.createEl("h3",{text:"Backup Settings"}),new D.Setting(t).setName("Maximum number of backups per draft").setDesc("Maximum number of backup files to keep per draft (default: 5)").addText(o=>o.setValue(String(e.settings.maxBackups??5)).setPlaceholder("5").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(F(`${S} Max backups changed: ${c}`),e.settings.maxBackups=c,e.saveSettings())})),new D.Setting(t).setName("Maximum backup age (days)").setDesc("Automatically delete backups older than this many days (default: 30)").addText(o=>o.setValue(String(e.settings.maxBackupAgeDays??30)).setPlaceholder("30").onChange(l=>{const c=parseInt(l,10);!isNaN(c)&&c>=0&&(F(`${S} Max backup age changed: ${c}`),e.settings.maxBackupAgeDays=c,e.saveSettings())})),t.createEl("h3",{text:"UI & Startup"}),t.createEl("p",{text:"Most settings take effect immediately. Settings marked with ⚠️ require a plugin reload to take effect.",cls:"setting-item-description"}),new D.Setting(t).setName("Ribbon placement").setDesc(`Place the ${Ft} icon on the left or right ribbon`).addDropdown(o=>{o.addOption("left","Left"),o.addOption("right","Right"),o.setValue(e.settings.ribbonPlacement||"left"),o.onChange(l=>{F(`${S} Ribbon placement changed: ${l}`),e.settings.ribbonPlacement=l,e.saveSettings(),typeof this.plugin.moveRibbon=="function"&&(l==="left"||l==="right")&&this.plugin.moveRibbon(l),this.display()})}),new D.Setting(t).setName("Always show ribbon").setDesc(`If enabled, the ${Ft} ribbon icon will always be visible regardless of whether projects are detected`).addToggle(o=>o.setValue(!!e.settings.ribbonAlwaysShow).onChange(l=>{F(`${S} Always show ribbon changed: ${l}`),e.settings.ribbonAlwaysShow=l,e.saveSettings(),typeof this.plugin.refreshRibbonVisibility=="function"&&this.plugin.refreshRibbonVisibility()})),new D.Setting(t).setName("Auto-open project panel on startup").setDesc(`If enabled, the ${Ft} project panel will open on plugin load when an active project is saved. ⚠️ Requires plugin reload to take effect.`).addToggle(o=>o.setValue(!!e.settings.autoOpenPanelOnStartup).onChange(l=>{F(`${S} Auto-open panel on startup changed: ${l}`),e.settings.autoOpenPanelOnStartup=l,e.saveSettings()})),new D.Setting(t).setName("Auto-select persisted project on startup").setDesc("If enabled, the persisted active project will be selected as the plugin's active project on load without opening the panel. ⚠️ Requires plugin reload to take effect.").addToggle(o=>o.setValue(!!e.settings.autoSelectProjectOnStartup).onChange(l=>{F(`${S} Auto-select project on startup changed: ${l}`),e.settings.autoSelectProjectOnStartup=l,e.saveSettings()})),new D.Setting(t).setName(`Enable ${Ft} debug logs`).setDesc(`When enabled, ${Ft} will set window.__${Ft.toUpperCase()}__ to true to show verbose runtime logs useful during development.`).addToggle(o=>o.setValue(!!e.settings.debug).onChange(l=>{F(`${S} Debug logs setting changed: ${l}`),e.settings.debug=l,window.__WRITEAID_DEBUG__=!!l,e.saveSettings(),l?new D.Notice(`${Ft}: debug logs enabled — verbose logs will appear in the DevTools console.`):new D.Notice(`${Ft}: debug logs disabled.`)})),t.createEl("h3",{text:"Panel performance"}),new D.Setting(t).setName("Panel refresh debounce (ms)").setDesc("Debounce timeout (milliseconds) for side-panel refresh notifications. Lower values mean more frequent refreshes; 0 disables debouncing.").addText(o=>{const l=e.settings.panelRefreshDebounceMs,c=Number(l??Je);o.setPlaceholder(String(Je)),o.setValue(String(c));let f=null;const h=g=>{const u=Number(g);if(!Number.isFinite(u)||u<De){new D.Notice(`Please enter a valid number ≥ ${De}.`);return}const m=Math.min(Math.floor(u),Xe);F(`${S} Panel refresh debounce changed: ${m}ms`),e.settings.panelRefreshDebounceMs=m;try{const p=e.saveSettings();p&&typeof p.catch=="function"&&p.catch(()=>{})}catch{}this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=m),o.inputEl.value=String(m),f&&(f.value=String(m))};try{const g=o.inputEl;g.setAttribute("type","number"),g.setAttribute("min",String(De)),g.setAttribute("max",String(Xe)),g.setAttribute("step","50"),g.setAttribute("aria-label","Panel refresh debounce in milliseconds"),It(()=>{g.insertAdjacentHTML("afterend",'<span class="wa-unit">ms</span>')}),f=document.createElement("input"),f.type="range",f.min=String(De),f.max=String(Xe),f.step="50",f.value=String(c),f.className="wa-debounce-range",It(()=>{const u=g.nextSibling;u&&u.parentElement?u.insertAdjacentElement("afterend",f):g.insertAdjacentElement("afterend",f)}),o.onChange(u=>{const m=Number(u);h(m)}),f.addEventListener("input",u=>{const m=Number(u.target.value);o.inputEl.value=String(m),h(m)})}catch{o.onChange(g=>{const u=Number(g);if(!Number.isFinite(u)||u<De){new D.Notice(`Please enter a valid number ≥ ${De}.`);return}const m=Math.min(Math.floor(u),Xe);e.settings.panelRefreshDebounceMs=m,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=m)})}}).addButton(o=>o.setButtonText("Reset").setTooltip(`Reset to default (${Je} ms)`).onClick(()=>{const l=Je;e.settings.panelRefreshDebounceMs=l,e.saveSettings(),this.plugin.manager&&typeof this.plugin.manager=="object"&&"panelRefreshDebounceMs"in this.plugin.manager&&(this.plugin.manager.panelRefreshDebounceMs=l),this.display()}))}}class Bn extends D.Modal{constructor(t,e){super(t),this.currentFolder=null,this.expanded={},this.onPick=e,F(`${S} FilePickerModal created`)}onOpen(){F(`${S} FilePickerModal opened`);const t=this.app.vault.getRoot();this.currentFolder=t,this.expanded={},this.render()}render(){const{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Select template file"}),!this.currentFolder)return;const e=this.currentFolder.path?this.currentFolder.path.split("/"):[],n=t.createDiv({cls:"wat-breadcrumbs"}),a=n.createEl("a",{text:"(Vault root)",href:"#"});a.onclick=c=>{c.preventDefault(),this.currentFolder=this.app.vault.getRoot(),this.render()};let i="";for(const c of e){i=i?`${i}/${c}`:c,n.createDiv({text:" / "});const f=n.createEl("a",{text:c,href:"#"}),h=i;f.onclick=g=>{g.preventDefault();const u=this.app.vault.getAbstractFileByPath(h);u&&u instanceof D.TFolder&&(this.currentFolder=u,this.render())}}const o=t.createDiv({cls:"wat-controls"}).createEl("button",{text:"Up"});o.onclick=c=>{var g;if(c.preventDefault(),!this.currentFolder)return;const f=((g=this.currentFolder.parent)==null?void 0:g.path)||"",h=f?this.app.vault.getAbstractFileByPath(f):this.app.vault.getRoot();h&&h instanceof D.TFolder&&(this.currentFolder=h,this.render())};const l=t.createDiv({cls:"wat-list"});for(const c of this.currentFolder.children)if(c instanceof D.TFolder){const f=l.createDiv({cls:"wat-row folder-row"}),h=f.createEl("button",{text:this.expanded[c.path]?"▾":"▸"});h.onclick=u=>{u.preventDefault(),this.expanded[c.path]=!this.expanded[c.path],this.render()};const g=f.createEl("a",{text:c.name,href:"#"});if(g.onclick=u=>{u.preventDefault(),this.currentFolder=c,this.render()},this.expanded[c.path]){const u=l.createDiv({cls:"wat-sub"});for(const m of c.children)if(m instanceof D.TFolder){const b=u.createDiv({cls:"wat-row sub-folder"}).createEl("a",{text:m.name,href:"#"});b.onclick=d=>{d.preventDefault(),this.currentFolder=m,this.render()}}else if(m instanceof D.TFile&&m.path.toLowerCase().endsWith(pt)){const b=u.createDiv({cls:"wat-row sub-file"}).createEl("a",{text:m.name,href:"#"});b.onclick=d=>{d.preventDefault(),F(`${S} File selected from file picker: ${m.path}`),this.close(),this.onPick(m.path)}}}}else if(c instanceof D.TFile&&c.path.toLowerCase().endsWith(pt)){const h=l.createDiv({cls:"wat-row file-row"}).createEl("a",{text:c.name,href:"#"});h.onclick=g=>{g.preventDefault(),F(`${S} File selected from file picker: ${c.path}`),this.close(),this.onPick(c.path)}}}onClose(){this.contentEl.empty()}}const cl=":root{--wa-bg: var(--background-primary, #ffffff);--wa-surface: var(--background-modifier-hover, #f7f7fb);--wa-muted: var(--text-muted, #6b7280);--wa-text: var(--text-normal, #0f172a);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(15, 23, 42, .08);--wa-radius: 8px;--wa-gap: 8px;--select-bg: var(--background-primary, #fff);--select-border: var(--background-modifier-border, #ccc);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #222);--select-placeholder: var(--text-muted, #888);--select-dropdown-bg: var(--background-secondary, #f6f6f6);--select-dropdown-border: var(--background-modifier-border, #e0e0e0);--select-option-hover: #f0f0ff;--select-option-active: #eaeaff;--select-chevron: var(--text-muted, #888)}@media (prefers-color-scheme: dark){:root{--wa-bg: var(--background-primary, #0b0b0c);--wa-surface: var(--background-modifier-hover, #121212);--wa-muted: var(--text-muted, #9aa4b2);--wa-text: var(--text-normal, #e6eef8);--wa-accent: var(--interactive-accent, #8b5cf6);--wa-border: rgba(255, 255, 255, .06)}}.theme-dark{--wa-bg: var(--background-primary, #23232b);--wa-surface: var(--background-modifier-hover, #2a2a4a);--wa-muted: var(--text-muted, #aaa);--wa-text: var(--text-normal, #e0e0e0);--wa-accent: var(--interactive-accent, #7c5cff);--wa-border: rgba(255, 255, 255, .06);--select-bg: var(--background-primary, #23232b);--select-border: var(--background-modifier-border, #333);--select-border-focus: var(--interactive-accent, #7c5cff);--select-text: var(--text-normal, #e0e0e0);--select-placeholder: var(--text-muted, #aaa);--select-dropdown-bg: var(--background-secondary, #23233a);--select-dropdown-border: var(--background-modifier-border, #333);--select-option-hover: #2a2a4a;--select-option-active: #2a2a4a;--select-chevron: var(--text-muted, #aaa)}.theme-dark .wa-panel{background:var(--background-primary, #23232b);color:var(--text-normal, #e0e0e0);border:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-title{color:var(--text-title, var(--text-normal, #e0e0e0))}.theme-dark .wa-muted{color:var(--text-faint, var(--text-muted, #aaa))}.theme-dark .wa-draft-list{background:var(--background-secondary, #23233a)}.theme-dark .wa-draft-item{color:var(--text-normal, #e0e0e0);border-bottom:1px solid var(--background-modifier-border, #333)}.theme-dark .wa-draft-item.active{background:var(--background-modifier-active, #2a2a4a)}.theme-dark .wa-draft-name{color:var(--text-normal, #e0e0e0)}",fl="button:hover{cursor:pointer}.writeaid-ribbon{padding-left:6px}.writeaid-ribbon .wa-icon{display:inline-block;vertical-align:middle}.writeaid-ribbon .wa-icon svg{width:16px;height:16px;fill:currentColor;display:block}.view-content:has(.writeaid-project-panel){padding:0}.writeaid-project-panel{height:100%;display:flex;flex-direction:column}.create-inline{margin-top:8px;justify-content:center}.wa-panel.project-list{padding:1em;height:100%;border-radius:0}.wa-panel-header{display:flex;flex-direction:column}.wa-draft-item.active .wa-draft-name{font-weight:700;color:var(--color-accent, #3b82f6)}.wa-draft-active-indicator{color:var(--color-accent, #3b82f6);font-size:1em;vertical-align:middle}@keyframes spin{to{transform:rotate(360deg)}}:root{--wa-slider-track-height: 6px;--wa-slider-thumb-size: 12px;--wa-slider-accent: var(--interactive-accent, #7c5cff);--wa-slider-background: var(--background-modifier-host, #eee);--wa-slider-gap: 12px}.wa-debounce-range{margin-left:var(--wa-slider-gap);vertical-align:middle;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:var(--wa-slider-track-height);background:linear-gradient(90deg,var(--wa-slider-accent) 0%,var(--wa-slider-accent) 50%,var(--wa-slider-background) 50%,var(--wa-slider-background) 100%);border-radius:999px;outline:none}.wa-debounce-range::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);box-shadow:0 0 0 4px #0000000d;cursor:pointer}.wa-debounce-range::-moz-range-thumb{width:var(--wa-slider-thumb-size);height:var(--wa-slider-thumb-size);border-radius:50%;background:var(--wa-slider-accent);cursor:pointer}.wa-unit{color:var(--text-muted, #666);margin-left:6px}.justify-between{justify-content:space-between}.wa-rename-info{margin-bottom:8px;color:var(--text-muted, #888);font-size:.95em}.wa-rename-label{display:block;font-weight:500;margin-bottom:4px;color:var(--text-normal, #222)}.wa-rename-input{width:100%;padding:7px 10px;font-size:1em;border:1px solid var(--background-modifier-border, #ccc);border-radius:5px;margin-bottom:10px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s}.wa-rename-input:focus{border-color:var(--interactive-accent, #7c5cff);outline:none}.wa-rename-checkbox-label{display:flex;align-items:center;gap:6px;margin-bottom:10px;font-size:.97em;color:var(--text-muted, #666)}.wa-rename-btn-row{display:flex;gap:10px;margin-top:8px;justify-content:flex-end}.wa-rename-btn-row button{min-width:80px;padding:6px 14px;font-size:1em;border-radius:4px;border:none;cursor:pointer;transition:background .2s}.wa-rename-btn-row .mod-cta{background:var(--interactive-accent, #7c5cff);color:#fff;font-weight:600}.wa-rename-btn-row .mod-cta:hover{background:#5a3fd6}.wa-rename-btn-row .mod-cancel{background:var(--background-modifier-border, #eee);color:var(--text-muted, #666)}.wa-rename-btn-row .mod-cancel:hover{background:#e0e0e0}.wa-rename-error{min-height:18px;margin-bottom:4px;font-size:.97em;color:var(--color-red, #d43c3c);transition:opacity .2s}.wa-create-draft-input{width:100%;padding:8px 12px;font-size:1.05em;border:1.5px solid var(--background-modifier-border, #bbb);border-radius:6px;box-sizing:border-box;background:var(--background-primary, #fff);color:var(--text-normal, #222);transition:border .2s,box-shadow .2s;outline:none;box-shadow:0 1px 2px #3c3c3c0a}.wa-create-draft-input:focus{border-color:var(--interactive-accent, #7c5cff);box-shadow:0 2px 8px #7c5cff14;background:var(--background-secondary, #fafaff)}.wa-panel{background:var(--background-primary, #fff);color:var(--text-normal, #222);padding:1em}.wa-title{font-size:1.2em;font-weight:600;color:var(--text-title, var(--text-normal, #222))}.wa-muted{color:var(--text-faint, var(--text-muted, #888))}.wa-row{display:flex;gap:8px;align-items:center;width:100%}.wa-button-group{display:flex;gap:8px;align-items:center}.wa-draft-list{background:var(--background-secondary, #f6f6f6);border-radius:6px;padding:8px 0;margin-top:8px}.wa-draft-item{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-bottom:1px solid var(--background-modifier-border, #e0e0e0);background:transparent;color:var(--text-normal, #222);transition:background .15s}.wa-draft-item:last-child{border-bottom:none}.wa-draft-item.active{background:var(--background-modifier-active, #eaeaff)}.wa-draft-name{font-size:1em;font-weight:500;color:var(--text-normal, #222)}.wa-draft-actions{display:flex;gap:6px}.wa-select-container.wa-select{position:relative;width:100%;display:flex;flex-direction:column;gap:4px}.wa-select-label-text{font-size:.9em;font-weight:500;color:var(--select-text, var(--text-normal, #222))}.wa-select-trigger{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:6px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));cursor:pointer;transition:all .2s ease;min-height:38px;font-size:1em}.wa-select-trigger:hover:not(.disabled){border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.open{border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-trigger.disabled{opacity:.6;cursor:not-allowed;background:var(--disabled-background, #f3f3f3)}.wa-select-value{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.wa-select-label,.wa-select-placeholder{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wa-select-placeholder{color:var(--select-placeholder, var(--text-muted, #888))}.wa-select-controls{display:flex;align-items:center;gap:4px;flex-shrink:0;margin-left:8px}.wa-select-clear{display:flex;align-items:center;justify-content:center;width:20px;height:20px;padding:0;border:none;background:none;color:var(--select-chevron, var(--text-muted, #888));cursor:pointer;border-radius:3px;transition:background .2s;font-size:.8em}.wa-select-clear:hover{background:var(--background-modifier-hover, #f0f0f0)}.wa-select-chevron{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:var(--select-chevron, var(--text-muted, #888));font-size:.7em;transition:transform .3s cubic-bezier(.4,0,.2,1)}.wa-select-chevron.rotated{transform:rotate(180deg)}.wa-select-dropdown{position:absolute;z-index:1000;background:var(--select-dropdown-bg, var(--background-secondary, #f6f6f6));border:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0));border-radius:8px;box-shadow:0 4px 12px #00000026,0 2px 4px #0000001a;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .15s ease-out}@keyframes slideIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.wa-select-dropdown[data-placement*=top]{animation:slideInTop .15s ease-out}@keyframes slideInTop{0%{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}.wa-select-search{padding:8px;border-bottom:1px solid var(--select-dropdown-border, var(--background-modifier-border, #e0e0e0))}.wa-select-search-input{width:100%;padding:6px 8px;border:1px solid var(--select-border, var(--background-modifier-border, #ccc));border-radius:4px;background:var(--select-bg, var(--background-primary, #fff));color:var(--select-text, var(--text-normal, #222));font-size:.95em}.wa-select-search-input:focus{outline:none;border-color:var(--select-border-focus, var(--interactive-accent, #7c5cff))}.wa-select-list{flex:1;overflow-y:auto;max-height:300px}.wa-select-list::-webkit-scrollbar{width:6px}.wa-select-list::-webkit-scrollbar-track{background:transparent}.wa-select-list::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb-bg, rgba(0, 0, 0, .2));border-radius:3px}.wa-select-list::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover-bg, rgba(0, 0, 0, .3))}.wa-select-empty{padding:12px 10px;text-align:center;color:var(--select-placeholder, var(--text-muted, #888));font-size:.95em}.wa-select-option{width:100%;margin-top:2px;padding:8px 10px;border-radius:0;box-shadow:none!important;border:none;background:transparent;color:var(--select-text, var(--text-normal, #222));text-align:left;cursor:pointer;transition:background .15s;font-size:.95em}.wa-select-option:hover{background:var(--select-option-hover, #f0f0ff);box-shadow:none!important}.wa-select-option.selected{background:var(--select-option-active, #eaeaff);box-shadow:none!important}.wa-select-option.active{background:var(--select-option-active, #eaeaff);font-weight:500;box-shadow:none!important}";if(typeof globalThis<"u"){const r=globalThis;r.__BROWSER__||(r.__BROWSER__=!0)}function Wr(r,t=20){return r.length<=t?r:r.substring(0,t-3)+"..."}const Pa={outlineTemplate:`# {{draftName}} Outline

## Overview
Brief description of the story goes here.

## Characters
- Character 1: Description
- Character 2: Description

## Plot Points
- Opening: 
- Middle: 
- Climax: 
- Resolution: 

## Chapters
- Chapter 1: Title
- Chapter 2: Title
- Chapter 3: Title`,chapterTemplate:`# {{chapterName}}

## Summary
Chapter summary goes here.

## Scene 1
Scene content goes here.

## Scene 2
Scene content goes here.`,manuscriptNameTemplate:"{{draftName}}",slugStyle:"compact",ribbonPlacement:"left",ribbonAlwaysShow:!1,autoOpenPanelOnStartup:!0,autoSelectProjectOnStartup:!0,activeProject:void 0,panelRefreshDebounceMs:250,debug:!1,includeDraftOutline:!1,draftsFolderName:je.DRAFTS,manuscriptsFolderName:je.MANUSCRIPTS,backupsFolderName:je.BACKUPS,metaFileName:se.META,outlineFileName:se.OUTLINE,maxBackups:5,maxBackupAgeDays:30};function Hr(r){return Object.assign({},Pa,r??{})}class ul extends D.Plugin{constructor(){super(...arguments),this.settings=Pa,this.settingsChangedCallbacks=[]}async loadSettings(){const t=await this.loadData();this.settings=Hr(t),t&&t.activeProject!==void 0&&(this.settings.activeProject=t.activeProject),this.manager&&(this.manager.settings=this.settings),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){F(`${S} Error in settings changed callback:`,n)}})}async saveSettings(){await zt(async()=>{const e=Hr(this.settings);await this.saveData(e),this.settings=e})===void 0&&await this.saveData(this.settings),this.manager&&(this.manager.settings=this.settings,F(`${S} Updated manager settings reference, manuscript template: ${this.settings.manuscriptNameTemplate}`)),this.settingsChangedCallbacks.forEach(e=>{try{e()}catch(n){F(`${S} Error in settings changed callback:`,n)}})}registerSettingsChangedCallback(t){this.settingsChangedCallbacks.push(t)}async runBackupCleanup(){if(this.manager)try{const e=await new mn(this.app).listProjects();for(const n of e){const a=At(this.settings),i=`${n}/${a}`,s=this.app.vault.getAbstractFileByPath(i);if(!(!s||!(s instanceof D.TFolder))){for(const o of s.children)if(o instanceof D.TFolder){const l=`${i}/${o.name}`,c=await this.manager.projectFileService.drafts.getDraftId(l);c&&await this.manager.projectFileService.backups.clearOldBackups(l,c,this.manager.settings)}}}F(`${S} Backup cleanup completed on startup`)}catch(t){F(`${S} Error during backup cleanup:`,t)}}async onload(){await this.loadSettings(),this.manager=new ol(this.app,this,typeof this.settings.panelRefreshDebounceMs=="number"?this.settings.panelRefreshDebounceMs:void 0),F(`${S} Manager created:`,!!this.manager);const t=new mn(this.app);this.app.workspace.onLayoutReady(async()=>{let a=null;if(this.settings.autoSelectProjectOnStartup!==!1){const i=await t.listProjects();if(i.length===1)a=i[0];else if(i.length>1){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");F(`${S} lastActiveRaw='${s}', normalized='${o}', includes=${o&&i.includes(o)}`),o&&i.includes(o)?a=o:a=i[0]}else if(i.length===0){const s=this.settings.activeProject,o=s==null?void 0:s.trim().replace(/^\/+/,"").replace(/\/+$/,"");await t.isProjectFolder(s||"")&&(F(`${S} activating saved project '${o}' as it exists and has valid meta file`),a=o??null)}}if(F(`${S} toActivate='${a}'`),a){await this.manager.setActiveProject(a),this.settings.activeProject=a;const i=await be(this.app,`${a}/${Gt(this.settings)}`);if(i!=null&&i.current_active_draft&&this.manager.listDrafts(a).includes(i.current_active_draft)&&(F(`${S} auto-restoring draft '${i.current_active_draft}' for project '${a}'`),await this.manager.setActiveDraft(i.current_active_draft,a,!1)),await this.saveSettings(),this.settings.autoOpenPanelOnStartup){const s=this.app.workspace.getLeavesOfType(we);if(s.length>0)this.app.workspace.revealLeaf(s[0]);else{let o=null;this.settings.ribbonPlacement==="right"?o=this.app.workspace.getRightLeaf(!0):o=this.app.workspace.getLeftLeaf(!0);const l={type:we,active:!0};o.setViewState(l),this.app.workspace.revealLeaf(o)}}}else await this.manager.setActiveProject(null),this.settings.activeProject=void 0,await this.saveSettings()}),this.statusBarEl=this.addStatusBarItem(),this.statusBarEl.setText(`${Ft}: No active project`),this.runBackupCleanup().catch(a=>{F(`${S} Failed to run backup cleanup on startup:`,a)}),It(()=>{this.waStyleEl||(this.waStyleEl=document.createElement("style"),this.waStyleEl.setAttribute("data-writeaid-style",""),this.waStyleEl.textContent=cl+fl,this.waStyleEl.classList.add("writeaid-plugin-style"),document.head.appendChild(this.waStyleEl))}),await this.loadSettings(),It(()=>{window.__WRITEAID_DEBUG__=!!this.settings.debug}),F(`${S} Loading ${Ft} Novel Multi-Draft Plugin`),this.manager.addActiveProjectListener(a=>{this.statusBarEl&&(a?(this.statusBarEl.setText(`${Ft}: ${Wr(a)}`),F(`${S} active project updated -> ${a}`)):this.statusBarEl.setText(`${Ft}: No active project`))}),this.manager.activeProject&&this.statusBarEl.setText(`${Ft}: ${Wr(this.manager.activeProject)}`),F(`${S} Registering ProjectPanelView with manager:`,!!this.manager),this.registerView(we,a=>(F(`${S} Creating ProjectPanelView instance with manager:`,!!this.manager),new Mo(a,this.app,this.manager)));const e=this.addRibbonIcon(Zn,`${Ft} Projects`,()=>{});e.classList.add("writeaid-ribbon"),this.ribbonEl=e,e.setAttr("aria-label",`${Ft} Projects`),e.onclick=()=>{const a=this.app.workspace.getLeavesOfType(we);if(a.length>0){const i=a[0];this.app.workspace.revealLeaf(i)}else{let i=this.app.workspace.getLeftLeaf(!1);i||(i=this.app.workspace.getLeftLeaf(!0));const s={type:we,active:!0};i.setViewState(s),this.app.workspace.revealLeaf(i)}};const n=async()=>{await zt(async()=>{if(this.settings.ribbonAlwaysShow){e.style.display="";return}const i=t.listAllFolders();(await ye(i,o=>t.isProjectFolder(o))).length>0?e.style.display="":e.style.display="none"})===void 0&&(e.style.display="")};this.refreshRibbonVisibility=n,n().catch(()=>{}),this.settings.ribbonPlacement==="right"&&this.moveRibbon("right"),this.registerEvent(this.app.vault.on("create",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("delete",()=>{n().catch(()=>{})})),this.registerEvent(this.app.vault.on("modify",()=>{n().catch(()=>{})})),this.addCommand({id:"create-new-draft",name:"Create New Draft",callback:Wo(this.manager)}),this.addCommand({id:"create-outline",name:"Create Outline",callback:()=>Ho(this.manager)}),this.addCommand({id:"create-new-project",name:"Create New Project",callback:Qo(this.manager)}),this.addCommand({id:"switch-draft",name:"Switch Active Draft",callback:Yo(this.manager)}),this.addCommand({id:"update-project-metadata",name:"Update Project Metadata",callback:nl(this.manager)}),this.addCommand({id:"select-active-project",name:"Select Active Project",callback:tl(this.manager)}),this.addCommand({id:"generate-manuscript",name:"Generate Manuscript",callback:Vo(this.manager)}),this.addCommand({id:"toggle-project-panel",name:`Toggle ${Ft} Project Panel`,callback:el(this.manager,this.app)}),this.addCommand({id:"convert-single-to-multi-file-project",name:"Convert Single-File Project to Multi-File",callback:()=>{var a,i;return Jo(this.app,this.manager.activeProject||((i=(a=this.manager).getCurrentProjectPath)==null?void 0:i.call(a))||void 0,this.manager.settings)}}),this.addCommand({id:"navigate-to-next-chapter",name:"Navigate to Next Chapter",callback:qo(this.manager)}),this.addCommand({id:"navigate-to-previous-chapter",name:"Navigate to Previous Chapter",callback:Ko(this.manager)}),this.addCommand({id:"create-backup",name:"Create Backup",callback:Ra(this.manager)}),this.addCommand({id:"list-and-restore-backups",name:"List and Restore Backups",callback:Uo(this.manager)}),this.addCommand({id:"delete-backup",name:"Delete Oldest Backup",callback:Ia(this.manager)}),this.addCommand({id:"clear-old-backups",name:"Clear Old Backups",callback:Ba(this.manager)}),this.addCommand({id:"initialize-draft-file",name:"Initialize Draft File Metadata",callback:Go(this.manager)}),this.addSettingTab(new ll(this.app,this))}moveRibbon(t){It(()=>{if(!this.ribbonEl)return;const e=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-right"),n=this.app.workspace.containerEl.querySelector(".workspace-ribbon.mod-left");t==="right"&&e?e.appendChild(this.ribbonEl):t==="left"&&n&&n.appendChild(this.ribbonEl)})}onunload(){this.statusBarEl&&this.statusBarEl.parentElement&&this.statusBarEl.parentElement.removeChild(this.statusBarEl),F(`${S} Unloading ${Ft} Novel Multi-Draft Plugin`),this.waStyleEl&&this.waStyleEl.parentElement&&this.waStyleEl.parentElement.removeChild(this.waStyleEl)}}module.exports=ul;
//# sourceMappingURL=main.js.map
